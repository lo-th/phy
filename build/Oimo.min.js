!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).OIMO={})}(this,(function(t){"use strict";let s=performance||Date;var a=a||{};a.collision||(a.collision={}),a.collision.broadphase||(a.collision.broadphase={}),a.collision.broadphase.BroadPhase=class{constructor(t){this._type=t,this._numProxies=0,this._proxyList=null,this._proxyListLast=null,this._proxyPairList=null,this._incremental=!1,this._testCount=0,this._proxyPairPool=null,this._idCount=0,this._convexSweep=new a.collision.broadphase._BroadPhase.ConvexSweepGeometry,this._aabb=new a.collision.broadphase._BroadPhase.AabbGeometry,this.identity=new a.common.Transform,this.zero=new a.common.Vec3,this.rayCastHit=new a.collision.geometry.RayCastHit}createProxy(t,i){return null}destroyProxy(t){}moveProxy(t,i,s){}isOverlapping(t,i){return t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ}collectPairs(){}getProxyPairList(){return this._proxyPairList}isIncremental(){return this._incremental}getTestCount(){return this._testCount}rayCast(t,i,s){}convexCast(t,i,s,a){}aabbTest(t,i){}},a.collision.geometry||(a.collision.geometry={}),a.collision.geometry.Geometry=class{constructor(t){this._type=t,this._volume=0}_updateMass(){}_computeAabb(t,i){}_rayCastLocal(t,i,s,a,o,n,e){return!1}getType(){return this._type}getVolume(){return this._volume}rayCast(t,i,s,a){let o,n,e,r,_,l,h,c,m,b,p,x;if(o=t.x,n=t.y,e=t.z,r=i.x,_=i.y,l=i.z,o-=s._positionX,n-=s._positionY,e-=s._positionZ,r-=s._positionX,_-=s._positionY,l-=s._positionZ,h=s._rotation00*o+s._rotation10*n+s._rotation20*e,c=s._rotation01*o+s._rotation11*n+s._rotation21*e,m=s._rotation02*o+s._rotation12*n+s._rotation22*e,o=h,n=c,e=m,b=s._rotation00*r+s._rotation10*_+s._rotation20*l,p=s._rotation01*r+s._rotation11*_+s._rotation21*l,x=s._rotation02*r+s._rotation12*_+s._rotation22*l,r=b,_=p,l=x,this._rayCastLocal(o,n,e,r,_,l,a)){let t,i,o,n,e,r,_=a.position;t=_.x,i=_.y,o=_.z;let l,h,c,m,b,p,x=a.normal;n=x.x,e=x.y,r=x.z,l=s._rotation00*t+s._rotation01*i+s._rotation02*o,h=s._rotation10*t+s._rotation11*i+s._rotation12*o,c=s._rotation20*t+s._rotation21*i+s._rotation22*o,t=l,i=h,o=c,m=s._rotation00*n+s._rotation01*e+s._rotation02*r,b=s._rotation10*n+s._rotation11*e+s._rotation12*r,p=s._rotation20*n+s._rotation21*e+s._rotation22*r,n=m,e=b,r=p,t+=s._positionX,i+=s._positionY,o+=s._positionZ;let f=a.position;f.x=t,f.y=i,f.z=o;let u=a.normal;return u.x=n,u.y=e,u.z=r,!0}return!1}},a.collision.geometry.ConvexGeometry=class extends a.collision.geometry.Geometry{constructor(t){super(t),this._gjkMargin=a.common.Setting.defaultGJKMargin,this._useGjkRayCast=!1}getGjkMergin(){return this._gjkMargin}setGjkMergin(t){t<0&&(t=0),this._gjkMargin=t}computeLocalSupportingVertex(t,i){}rayCast(t,i,s,o){return this._useGjkRayCast?a.collision.narrowphase.detector.gjkepa.GjkEpa.instance.rayCast(this,s,t,i,o):super.rayCast(t,i,s,o)}},a.collision.broadphase._BroadPhase||(a.collision.broadphase._BroadPhase={}),a.collision.broadphase._BroadPhase.ConvexSweepGeometry=class extends a.collision.geometry.ConvexGeometry{constructor(){super(-1)}init(t,i,s){let o,n,e,r,_,l,h,c,m;this.c=t,o=s.x,n=s.y,e=s.z,h=i._rotation00*o+i._rotation10*n+i._rotation20*e,c=i._rotation01*o+i._rotation11*n+i._rotation21*e,m=i._rotation02*o+i._rotation12*n+i._rotation22*e,r=h,_=c,l=m,this.localTranslation=new a.common.Vec3;let b=this.localTranslation;b.x=r,b.y=_,b.z=l,this._gjkMargin=t._gjkMargin}computeLocalSupportingVertex(t,i){this.c.computeLocalSupportingVertex(t,i);let s=this.localTranslation;if(t.x*s.x+t.y*s.y+t.z*s.z>0){let t=this.localTranslation;i.x+=t.x,i.y+=t.y,i.z+=t.z}}},a.collision.broadphase._BroadPhase.AabbGeometry=class extends a.collision.geometry.ConvexGeometry{constructor(){super(-1),this.min=new a.common.Vec3,this.max=new a.common.Vec3}computeLocalSupportingVertex(t,i){i.x=t.x>0?this.max.x:this.min.x,i.y=t.y>0?this.max.y:this.min.y,i.z=t.z>0?this.max.z:this.min.z}},a.collision.broadphase.BroadPhaseProxyCallback=class{constructor(){}process(t){}},a.collision.broadphase.BroadPhaseType=class{},a.collision.broadphase.Proxy=class{constructor(t,i){this.userData=t,this._id=i,this._prev=null,this._next=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}getId(){return this._id}getFatAabb(){let t=new a.collision.geometry.Aabb;return t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ,t}getFatAabbTo(t){t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ}},a.collision.broadphase.ProxyPair=class{constructor(){this._p1=null,this._p2=null}getProxy1(){return this._p1}getProxy2(){return this._p2}getNext(){return this._next}},a.collision.broadphase.bruteforce||(a.collision.broadphase.bruteforce={}),a.collision.broadphase.bruteforce.BruteForceBroadPhase=class extends a.collision.broadphase.BroadPhase{constructor(){super(1),this._incremental=!1}createProxy(t,i){let s=new a.collision.broadphase.Proxy(t,this._idCount++);return this._numProxies++,null==this._proxyList?(this._proxyList=s,this._proxyListLast=s):(this._proxyListLast._next=s,s._prev=this._proxyListLast,this._proxyListLast=s),s._aabbMinX=i._minX,s._aabbMinY=i._minY,s._aabbMinZ=i._minZ,s._aabbMaxX=i._maxX,s._aabbMaxY=i._maxY,s._aabbMaxZ=i._maxZ,s}destroyProxy(t){this._numProxies--;let i=t._prev,s=t._next;null!=i&&(i._next=s),null!=s&&(s._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null,t.userData=null}moveProxy(t,i,s){t._aabbMinX=i._minX,t._aabbMinY=i._minY,t._aabbMinZ=i._minZ,t._aabbMaxX=i._maxX,t._aabbMaxY=i._maxY,t._aabbMaxZ=i._maxZ}collectPairs(){let t=this._proxyPairList;if(null!=t){for(;t._p1=null,t._p2=null,t=t._next,null!=t;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}this._testCount=0;let i=this._proxyList;for(;null!=i;){let t=i._next,s=i._next;for(;null!=s;){let t=s._next;if(this._testCount++,i._aabbMinX<s._aabbMaxX&&i._aabbMaxX>s._aabbMinX&&i._aabbMinY<s._aabbMaxY&&i._aabbMaxY>s._aabbMinY&&i._aabbMinZ<s._aabbMaxZ&&i._aabbMaxZ>s._aabbMinZ){let t=this._proxyPairPool;null!=t?(this._proxyPairPool=t._next,t._next=null):t=new a.collision.broadphase.ProxyPair;let o=t;null==this._proxyPairList||(o._next=this._proxyPairList),this._proxyPairList=o,o._p1=i,o._p2=s}s=t}i=t}}rayCast(t,i,s){let a,o,n,e,r,_;a=t.x,o=t.y,n=t.z,e=i.x,r=i.y,_=i.z;let l=this._proxyList;for(;null!=l;){let t,i=l._next,h=a,c=o,m=n,b=e,p=r,x=_,f=l._aabbMinX,u=l._aabbMinY,y=l._aabbMinZ,g=l._aabbMaxX,v=l._aabbMaxY,d=l._aabbMaxZ;if(f>(h>b?h:b)||g<(h<b?h:b)||u>(c>p?c:p)||v<(c<p?c:p)||y>(m>x?m:x)||d<(m<x?m:x))t=!1;else{let i,s,a=b-h,o=p-c,n=x-m,e=a<0?-a:a,r=o<0?-o:o,_=n<0?-n:n,l=.5*(g-f),X=.5*(v-u),z=.5*(d-y),Y=h-.5*(g+f),Z=c-.5*(v+u),M=m-.5*(d+y),I=Z*n-M*o;if((I<0?-I:I)-(X*_+z*r)>0)s=!0;else{let t=M*a-Y*n;s=(t<0?-t:t)-(z*e+l*_)>0}if(s)i=!0;else{let t=Y*o-Z*a;i=(t<0?-t:t)-(l*r+X*e)>0}t=!i}t&&s.process(l),l=i}}convexCast(t,i,s,o){let n=this._proxyList;for(;null!=n;){let e=n._next,r=this._aabb.min;r.x=n._aabbMinX,r.y=n._aabbMinY,r.z=n._aabbMinZ;let _=this._aabb.max;_.x=n._aabbMaxX,_.y=n._aabbMaxY,_.z=n._aabbMaxZ,this._convexSweep.init(t,i,s);let l=a.collision.narrowphase.detector.gjkepa.GjkEpa.instance;0==l.computeClosestPointsImpl(this._convexSweep,this._aabb,i,this.identity,null,!1)&&l.distance<=0&&o.process(n),n=e}}aabbTest(t,i){let s=this._proxyList;for(;null!=s;){let a=s._next;t._minX<s._aabbMaxX&&t._maxX>s._aabbMinX&&t._minY<s._aabbMaxY&&t._maxY>s._aabbMinY&&t._minZ<s._aabbMaxZ&&t._maxZ>s._aabbMinZ&&i.process(s),s=a}}},a.collision.broadphase.bvh||(a.collision.broadphase.bvh={}),a.collision.broadphase.bvh.BvhBroadPhase=class extends a.collision.broadphase.BroadPhase{constructor(){super(2),this._incremental=!0,this._tree=new a.collision.broadphase.bvh.BvhTree,this.movedProxies=new Array(1024),this.numMovedProxies=0}collide(t,i){this._testCount++;let s=0==t._height,o=0==i._height;if(t==i){if(s)return;return this.collide(t._children[0],i),void this.collide(t._children[1],i)}if(t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ){if(s&&o){let s=this._proxyPairPool;null!=s?(this._proxyPairPool=s._next,s._next=null):s=new a.collision.broadphase.ProxyPair;let o=s;return null==this._proxyPairList||(o._next=this._proxyPairList),this._proxyPairList=o,o._p1=t._proxy,void(o._p2=i._proxy)}o||t._height>i._height?(this.collide(t._children[0],i),this.collide(t._children[1],i)):(this.collide(i._children[0],t),this.collide(i._children[1],t))}}rayCastRecursive(t,i,s,a,o,n,e,r){let _,l=i,h=s,c=a,m=o,b=n,p=e,x=t._aabbMinX,f=t._aabbMinY,u=t._aabbMinZ,y=t._aabbMaxX,g=t._aabbMaxY,v=t._aabbMaxZ;if(x>(l>m?l:m)||y<(l<m?l:m)||f>(h>b?h:b)||g<(h<b?h:b)||u>(c>p?c:p)||v<(c<p?c:p))_=!1;else{let t,i,s=m-l,a=b-h,o=p-c,n=s<0?-s:s,e=a<0?-a:a,r=o<0?-o:o,d=.5*(y-x),X=.5*(g-f),z=.5*(v-u),Y=l-.5*(y+x),Z=h-.5*(g+f),M=c-.5*(v+u),I=Z*o-M*a;if((I<0?-I:I)-(X*r+z*e)>0)i=!0;else{let t=M*s-Y*o;i=(t<0?-t:t)-(z*n+d*r)>0}if(i)t=!0;else{let i=Y*a-Z*s;t=(i<0?-i:i)-(d*e+X*n)>0}_=!t}_&&(0!=t._height?(this.rayCastRecursive(t._children[0],i,s,a,o,n,e,r),this.rayCastRecursive(t._children[1],i,s,a,o,n,e,r)):r.process(t._proxy))}convexCastRecursive(t,i,s,o,n){let e=this._aabb.min;e.x=t._aabbMinX,e.y=t._aabbMinY,e.z=t._aabbMinZ;let r=this._aabb.max;r.x=t._aabbMaxX,r.y=t._aabbMaxY,r.z=t._aabbMaxZ,this._convexSweep.init(i,s,o);let _=a.collision.narrowphase.detector.gjkepa.GjkEpa.instance;0==_.computeClosestPointsImpl(this._convexSweep,this._aabb,s,this.identity,null,!1)&&_.distance<=0&&(0!=t._height?(this.convexCastRecursive(t._children[0],i,s,o,n),this.convexCastRecursive(t._children[1],i,s,o,n)):n.process(t._proxy))}aabbTestRecursive(t,i,s){t._aabbMinX<i._maxX&&t._aabbMaxX>i._minX&&t._aabbMinY<i._maxY&&t._aabbMaxY>i._minY&&t._aabbMinZ<i._maxZ&&t._aabbMaxZ>i._minZ&&(0!=t._height?(this.aabbTestRecursive(t._children[0],i,s),this.aabbTestRecursive(t._children[1],i,s)):s.process(t._proxy))}createProxy(t,i){let s=new a.collision.broadphase.bvh.BvhProxy(t,this._idCount++);this._numProxies++,null==this._proxyList?(this._proxyList=s,this._proxyListLast=s):(this._proxyListLast._next=s,s._prev=this._proxyListLast,this._proxyListLast=s),s._aabbMinX=i._minX,s._aabbMinY=i._minY,s._aabbMinZ=i._minZ,s._aabbMaxX=i._maxX,s._aabbMaxY=i._maxY,s._aabbMaxZ=i._maxZ;let o=a.common.Setting.bvhProxyPadding;s._aabbMinX-=o,s._aabbMinY-=o,s._aabbMinZ-=o,s._aabbMaxX+=o,s._aabbMaxY+=o,s._aabbMaxZ+=o;let n=this._tree,e=n._nodePool;null!=e?(n._nodePool=e._next,e._next=null):e=new a.collision.broadphase.bvh.BvhNode;let r=e;if(r._proxy=s,s._leaf=r,r._aabbMinX=s._aabbMinX,r._aabbMinY=s._aabbMinY,r._aabbMinZ=s._aabbMinZ,r._aabbMaxX=s._aabbMaxX,r._aabbMaxY=s._aabbMaxY,r._aabbMaxZ=s._aabbMaxZ,n._numLeaves++,null==n.leafList?(n.leafList=r,n.leafListLast=r):(n.leafListLast._nextLeaf=r,r._prevLeaf=n.leafListLast,n.leafListLast=r),null==n._root)n._root=r;else{let t=n._root;for(;t._height>0;){let i=n._strategy._decideInsertion(t,r);if(-1==i)break;t=t._children[i]}let i=t._parent,s=n._nodePool;null!=s?(n._nodePool=s._next,s._next=null):s=new a.collision.broadphase.bvh.BvhNode;let o=s;if(null==i)n._root=o;else{let s=t._childIndex;i._children[s]=o,o._parent=i,o._childIndex=s}let e=t._childIndex;o._children[e]=t,t._parent=o,t._childIndex=e;let _=1^t._childIndex;for(o._children[_]=r,r._parent=o,r._childIndex=_;null!=o;){if(n._strategy._balancingEnabled&&o._height>=2){let t=o._parent,i=o._children[0],s=o._children[1],a=i._height-s._height,e=o._childIndex;if(a>1){let s=i._children[0],a=i._children[1];if(s._height>a._height){i._children[1]=o,o._parent=i,o._childIndex=1,o._children[0]=a,a._parent=o,a._childIndex=0;let t=i._children[0],s=i._children[1];i._aabbMinX=t._aabbMinX<s._aabbMinX?t._aabbMinX:s._aabbMinX,i._aabbMinY=t._aabbMinY<s._aabbMinY?t._aabbMinY:s._aabbMinY,i._aabbMinZ=t._aabbMinZ<s._aabbMinZ?t._aabbMinZ:s._aabbMinZ,i._aabbMaxX=t._aabbMaxX>s._aabbMaxX?t._aabbMaxX:s._aabbMaxX,i._aabbMaxY=t._aabbMaxY>s._aabbMaxY?t._aabbMaxY:s._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>s._aabbMaxZ?t._aabbMaxZ:s._aabbMaxZ;let n=i._children[0]._height,e=i._children[1]._height;i._height=(n>e?n:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=o._children[0]._height,h=o._children[1]._height;o._height=(l>h?l:h)+1}else{i._children[0]=o,o._parent=i,o._childIndex=0,o._children[0]=s,s._parent=o,s._childIndex=0;let t=i._children[0],a=i._children[1];i._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,i._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,i._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,i._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,i._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let n=i._children[0]._height,e=i._children[1]._height;i._height=(n>e?n:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=o._children[0]._height,h=o._children[1]._height;o._height=(l>h?l:h)+1}null!=t?(t._children[e]=i,i._parent=t,i._childIndex=e):(n._root=i,i._parent=null),o=i}else if(a<-1){let i=s._children[0],a=s._children[1];if(i._height>a._height){s._children[1]=o,o._parent=s,o._childIndex=1,o._children[1]=a,a._parent=o,a._childIndex=1;let t=s._children[0],i=s._children[1];s._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,s._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,s._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,s._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,s._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let n=s._children[0]._height,e=s._children[1]._height;s._height=(n>e?n:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=o._children[0]._height,h=o._children[1]._height;o._height=(l>h?l:h)+1}else{s._children[0]=o,o._parent=s,o._childIndex=0,o._children[1]=i,i._parent=o,i._childIndex=1;let t=s._children[0],a=s._children[1];s._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,s._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,s._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,s._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,s._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let n=s._children[0]._height,e=s._children[1]._height;s._height=(n>e?n:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=o._children[0]._height,h=o._children[1]._height;o._height=(l>h?l:h)+1}null!=t?(t._children[e]=s,s._parent=t,s._childIndex=e):(n._root=s,s._parent=null),o=s}}let t=o._children[0]._height,i=o._children[1]._height;o._height=(t>i?t:i)+1;let s=o._children[0],a=o._children[1];o._aabbMinX=s._aabbMinX<a._aabbMinX?s._aabbMinX:a._aabbMinX,o._aabbMinY=s._aabbMinY<a._aabbMinY?s._aabbMinY:a._aabbMinY,o._aabbMinZ=s._aabbMinZ<a._aabbMinZ?s._aabbMinZ:a._aabbMinZ,o._aabbMaxX=s._aabbMaxX>a._aabbMaxX?s._aabbMaxX:a._aabbMaxX,o._aabbMaxY=s._aabbMaxY>a._aabbMaxY?s._aabbMaxY:a._aabbMaxY,o._aabbMaxZ=s._aabbMaxZ>a._aabbMaxZ?s._aabbMaxZ:a._aabbMaxZ,o=o._parent}}if(!s._moved){if(s._moved=!0,this.movedProxies.length==this.numMovedProxies){let t=new Array(this.numMovedProxies<<1),i=0,s=this.numMovedProxies;for(;i<s;){let s=i++;t[s]=this.movedProxies[s],this.movedProxies[s]=null}this.movedProxies=t}this.movedProxies[this.numMovedProxies++]=s}return s}destroyProxy(t){this._numProxies--;let i=t._prev,s=t._next;null!=i&&(i._next=s),null!=s&&(s._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null;let a=t,o=this._tree,n=a._leaf;o._numLeaves--;let e=n._prevLeaf,r=n._nextLeaf;if(null!=e&&(e._nextLeaf=r),null!=r&&(r._prevLeaf=e),n==o.leafList&&(o.leafList=o.leafList._nextLeaf),n==o.leafListLast&&(o.leafListLast=o.leafListLast._prevLeaf),n._nextLeaf=null,n._prevLeaf=null,o._root==n)o._root=null;else{let t=n._parent,i=t._children[1^n._childIndex],s=t._parent;if(null==s)i._parent=null,i._childIndex=0,o._root=i,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=o._nodePool,o._nodePool=t;else{i._parent=s;let a=t._childIndex;s._children[a]=i,i._parent=s,i._childIndex=a,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=o._nodePool,o._nodePool=t;let n=s;for(;null!=n;){if(o._strategy._balancingEnabled&&n._height>=2){let t=n._parent,i=n._children[0],s=n._children[1],a=i._height-s._height,e=n._childIndex;if(a>1){let s=i._children[0],a=i._children[1];if(s._height>a._height){i._children[1]=n,n._parent=i,n._childIndex=1,n._children[0]=a,a._parent=n,a._childIndex=0;let t=i._children[0],s=i._children[1];i._aabbMinX=t._aabbMinX<s._aabbMinX?t._aabbMinX:s._aabbMinX,i._aabbMinY=t._aabbMinY<s._aabbMinY?t._aabbMinY:s._aabbMinY,i._aabbMinZ=t._aabbMinZ<s._aabbMinZ?t._aabbMinZ:s._aabbMinZ,i._aabbMaxX=t._aabbMaxX>s._aabbMaxX?t._aabbMaxX:s._aabbMaxX,i._aabbMaxY=t._aabbMaxY>s._aabbMaxY?t._aabbMaxY:s._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>s._aabbMaxZ?t._aabbMaxZ:s._aabbMaxZ;let o=i._children[0]._height,e=i._children[1]._height;i._height=(o>e?o:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}else{i._children[0]=n,n._parent=i,n._childIndex=0,n._children[0]=s,s._parent=n,s._childIndex=0;let t=i._children[0],a=i._children[1];i._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,i._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,i._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,i._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,i._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let o=i._children[0]._height,e=i._children[1]._height;i._height=(o>e?o:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}null!=t?(t._children[e]=i,i._parent=t,i._childIndex=e):(o._root=i,i._parent=null),n=i}else if(a<-1){let i=s._children[0],a=s._children[1];if(i._height>a._height){s._children[1]=n,n._parent=s,n._childIndex=1,n._children[1]=a,a._parent=n,a._childIndex=1;let t=s._children[0],i=s._children[1];s._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,s._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,s._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,s._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,s._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let o=s._children[0]._height,e=s._children[1]._height;s._height=(o>e?o:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}else{s._children[0]=n,n._parent=s,n._childIndex=0,n._children[1]=i,i._parent=n,i._childIndex=1;let t=s._children[0],a=s._children[1];s._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,s._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,s._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,s._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,s._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let o=s._children[0]._height,e=s._children[1]._height;s._height=(o>e?o:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}null!=t?(t._children[e]=s,s._parent=t,s._childIndex=e):(o._root=s,s._parent=null),n=s}}let t=n._children[0]._height,i=n._children[1]._height;n._height=(t>i?t:i)+1;let s=n._children[0],a=n._children[1];n._aabbMinX=s._aabbMinX<a._aabbMinX?s._aabbMinX:a._aabbMinX,n._aabbMinY=s._aabbMinY<a._aabbMinY?s._aabbMinY:a._aabbMinY,n._aabbMinZ=s._aabbMinZ<a._aabbMinZ?s._aabbMinZ:a._aabbMinZ,n._aabbMaxX=s._aabbMaxX>a._aabbMaxX?s._aabbMaxX:a._aabbMaxX,n._aabbMaxY=s._aabbMaxY>a._aabbMaxY?s._aabbMaxY:a._aabbMaxY,n._aabbMaxZ=s._aabbMaxZ>a._aabbMaxZ?s._aabbMaxZ:a._aabbMaxZ,n=n._parent}}}a._leaf=null,n._next=null,n._childIndex=0,n._children[0]=null,n._children[1]=null,n._childIndex=0,n._parent=null,n._height=0,n._proxy=null,n._next=o._nodePool,o._nodePool=n,a.userData=null,a._next=null,a._prev=null,a._moved&&(a._moved=!1)}moveProxy(t,i,s){let o=t;if(o._aabbMinX<=i._minX&&o._aabbMaxX>=i._maxX&&o._aabbMinY<=i._minY&&o._aabbMaxY>=i._maxY&&o._aabbMinZ<=i._minZ&&o._aabbMaxZ>=i._maxZ)return;o._aabbMinX=i._minX,o._aabbMinY=i._minY,o._aabbMinZ=i._minZ,o._aabbMaxX=i._maxX,o._aabbMaxY=i._maxY,o._aabbMaxZ=i._maxZ;let n=a.common.Setting.bvhProxyPadding;if(o._aabbMinX-=n,o._aabbMinY-=n,o._aabbMinZ-=n,o._aabbMaxX+=n,o._aabbMaxY+=n,o._aabbMaxZ+=n,null!=s){let t,i,a,n,e,r,_,l,h,c,m,b;n=0,e=0,r=0,t=s.x,i=s.y,a=s.z,_=n<t?n:t,l=e<i?e:i,h=r<a?r:a,c=n>t?n:t,m=e>i?e:i,b=r>a?r:a,o._aabbMinX+=_,o._aabbMinY+=l,o._aabbMinZ+=h,o._aabbMaxX+=c,o._aabbMaxY+=m,o._aabbMaxZ+=b}if(!o._moved){if(o._moved=!0,this.movedProxies.length==this.numMovedProxies){let t=new Array(this.numMovedProxies<<1),i=0,s=this.numMovedProxies;for(;i<s;){let s=i++;t[s]=this.movedProxies[s],this.movedProxies[s]=null}this.movedProxies=t}this.movedProxies[this.numMovedProxies++]=o}}collectPairs(){let t=this._proxyPairList;if(null!=t){for(;t._p1=null,t._p2=null,t=t._next,null!=t;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}if(this._testCount=0,this._numProxies<2)return;let i=this.numMovedProxies/this._numProxies<a.common.Setting.bvhIncrementalCollisionThreshold,s=0,o=this.numMovedProxies;for(;s<o;){let t=s++,o=this.movedProxies[t];if(o._moved){let t=this._tree,s=o._leaf;t._numLeaves--;let n=s._prevLeaf,e=s._nextLeaf;if(null!=n&&(n._nextLeaf=e),null!=e&&(e._prevLeaf=n),s==t.leafList&&(t.leafList=t.leafList._nextLeaf),s==t.leafListLast&&(t.leafListLast=t.leafListLast._prevLeaf),s._nextLeaf=null,s._prevLeaf=null,t._root==s)t._root=null;else{let i=s._parent,a=i._children[1^s._childIndex],o=i._parent;if(null==o)a._parent=null,a._childIndex=0,t._root=a,i._next=null,i._childIndex=0,i._children[0]=null,i._children[1]=null,i._childIndex=0,i._parent=null,i._height=0,i._proxy=null,i._next=t._nodePool,t._nodePool=i;else{a._parent=o;let s=i._childIndex;o._children[s]=a,a._parent=o,a._childIndex=s,i._next=null,i._childIndex=0,i._children[0]=null,i._children[1]=null,i._childIndex=0,i._parent=null,i._height=0,i._proxy=null,i._next=t._nodePool,t._nodePool=i;let n=o;for(;null!=n;){if(t._strategy._balancingEnabled&&n._height>=2){let i=n._parent,s=n._children[0],a=n._children[1],o=s._height-a._height,e=n._childIndex;if(o>1){let a=s._children[0],o=s._children[1];if(a._height>o._height){s._children[1]=n,n._parent=s,n._childIndex=1,n._children[0]=o,o._parent=n,o._childIndex=0;let t=s._children[0],i=s._children[1];s._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,s._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,s._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,s._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,s._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let a=s._children[0]._height,e=s._children[1]._height;s._height=(a>e?a:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}else{s._children[0]=n,n._parent=s,n._childIndex=0,n._children[0]=a,a._parent=n,a._childIndex=0;let t=s._children[0],i=s._children[1];s._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,s._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,s._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,s._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,s._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let o=s._children[0]._height,e=s._children[1]._height;s._height=(o>e?o:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}null!=i?(i._children[e]=s,s._parent=i,s._childIndex=e):(t._root=s,s._parent=null),n=s}else if(o<-1){let s=a._children[0],o=a._children[1];if(s._height>o._height){a._children[1]=n,n._parent=a,n._childIndex=1,n._children[1]=o,o._parent=n,o._childIndex=1;let t=a._children[0],i=a._children[1];a._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,a._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,a._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,a._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,a._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,a._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let s=a._children[0]._height,e=a._children[1]._height;a._height=(s>e?s:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}else{a._children[0]=n,n._parent=a,n._childIndex=0,n._children[1]=s,s._parent=n,s._childIndex=1;let t=a._children[0],i=a._children[1];a._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,a._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,a._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,a._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,a._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,a._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let o=a._children[0]._height,e=a._children[1]._height;a._height=(o>e?o:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}null!=i?(i._children[e]=a,a._parent=i,a._childIndex=e):(t._root=a,a._parent=null),n=a}}let i=n._children[0]._height,s=n._children[1]._height;n._height=(i>s?i:s)+1;let a=n._children[0],o=n._children[1];n._aabbMinX=a._aabbMinX<o._aabbMinX?a._aabbMinX:o._aabbMinX,n._aabbMinY=a._aabbMinY<o._aabbMinY?a._aabbMinY:o._aabbMinY,n._aabbMinZ=a._aabbMinZ<o._aabbMinZ?a._aabbMinZ:o._aabbMinZ,n._aabbMaxX=a._aabbMaxX>o._aabbMaxX?a._aabbMaxX:o._aabbMaxX,n._aabbMaxY=a._aabbMaxY>o._aabbMaxY?a._aabbMaxY:o._aabbMaxY,n._aabbMaxZ=a._aabbMaxZ>o._aabbMaxZ?a._aabbMaxZ:o._aabbMaxZ,n=n._parent}}}o._leaf=null,s._next=null,s._childIndex=0,s._children[0]=null,s._children[1]=null,s._childIndex=0,s._parent=null,s._height=0,s._proxy=null,s._next=t._nodePool,t._nodePool=s;let r=this._tree,_=r._nodePool;null!=_?(r._nodePool=_._next,_._next=null):_=new a.collision.broadphase.bvh.BvhNode;let l=_;if(l._proxy=o,o._leaf=l,l._aabbMinX=o._aabbMinX,l._aabbMinY=o._aabbMinY,l._aabbMinZ=o._aabbMinZ,l._aabbMaxX=o._aabbMaxX,l._aabbMaxY=o._aabbMaxY,l._aabbMaxZ=o._aabbMaxZ,r._numLeaves++,null==r.leafList?(r.leafList=l,r.leafListLast=l):(r.leafListLast._nextLeaf=l,l._prevLeaf=r.leafListLast,r.leafListLast=l),null==r._root)r._root=l;else{let t=r._root;for(;t._height>0;){let i=r._strategy._decideInsertion(t,l);if(-1==i)break;t=t._children[i]}let i=t._parent,s=r._nodePool;null!=s?(r._nodePool=s._next,s._next=null):s=new a.collision.broadphase.bvh.BvhNode;let o=s;if(null==i)r._root=o;else{let s=t._childIndex;i._children[s]=o,o._parent=i,o._childIndex=s}let n=t._childIndex;o._children[n]=t,t._parent=o,t._childIndex=n;let e=1^t._childIndex;for(o._children[e]=l,l._parent=o,l._childIndex=e;null!=o;){if(r._strategy._balancingEnabled&&o._height>=2){let t=o._parent,i=o._children[0],s=o._children[1],a=i._height-s._height,n=o._childIndex;if(a>1){let s=i._children[0],a=i._children[1];if(s._height>a._height){i._children[1]=o,o._parent=i,o._childIndex=1,o._children[0]=a,a._parent=o,a._childIndex=0;let t=i._children[0],s=i._children[1];i._aabbMinX=t._aabbMinX<s._aabbMinX?t._aabbMinX:s._aabbMinX,i._aabbMinY=t._aabbMinY<s._aabbMinY?t._aabbMinY:s._aabbMinY,i._aabbMinZ=t._aabbMinZ<s._aabbMinZ?t._aabbMinZ:s._aabbMinZ,i._aabbMaxX=t._aabbMaxX>s._aabbMaxX?t._aabbMaxX:s._aabbMaxX,i._aabbMaxY=t._aabbMaxY>s._aabbMaxY?t._aabbMaxY:s._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>s._aabbMaxZ?t._aabbMaxZ:s._aabbMaxZ;let n=i._children[0]._height,e=i._children[1]._height;i._height=(n>e?n:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=o._children[0]._height,h=o._children[1]._height;o._height=(l>h?l:h)+1}else{i._children[0]=o,o._parent=i,o._childIndex=0,o._children[0]=s,s._parent=o,s._childIndex=0;let t=i._children[0],a=i._children[1];i._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,i._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,i._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,i._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,i._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let n=i._children[0]._height,e=i._children[1]._height;i._height=(n>e?n:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=o._children[0]._height,h=o._children[1]._height;o._height=(l>h?l:h)+1}null!=t?(t._children[n]=i,i._parent=t,i._childIndex=n):(r._root=i,i._parent=null),o=i}else if(a<-1){let i=s._children[0],a=s._children[1];if(i._height>a._height){s._children[1]=o,o._parent=s,o._childIndex=1,o._children[1]=a,a._parent=o,a._childIndex=1;let t=s._children[0],i=s._children[1];s._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,s._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,s._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,s._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,s._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let n=s._children[0]._height,e=s._children[1]._height;s._height=(n>e?n:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=o._children[0]._height,h=o._children[1]._height;o._height=(l>h?l:h)+1}else{s._children[0]=o,o._parent=s,o._childIndex=0,o._children[1]=i,i._parent=o,i._childIndex=1;let t=s._children[0],a=s._children[1];s._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,s._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,s._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,s._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,s._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let n=s._children[0]._height,e=s._children[1]._height;s._height=(n>e?n:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=o._children[0]._height,h=o._children[1]._height;o._height=(l>h?l:h)+1}null!=t?(t._children[n]=s,s._parent=t,s._childIndex=n):(r._root=s,s._parent=null),o=s}}let t=o._children[0]._height,i=o._children[1]._height;o._height=(t>i?t:i)+1;let s=o._children[0],a=o._children[1];o._aabbMinX=s._aabbMinX<a._aabbMinX?s._aabbMinX:a._aabbMinX,o._aabbMinY=s._aabbMinY<a._aabbMinY?s._aabbMinY:a._aabbMinY,o._aabbMinZ=s._aabbMinZ<a._aabbMinZ?s._aabbMinZ:a._aabbMinZ,o._aabbMaxX=s._aabbMaxX>a._aabbMaxX?s._aabbMaxX:a._aabbMaxX,o._aabbMaxY=s._aabbMaxY>a._aabbMaxY?s._aabbMaxY:a._aabbMaxY,o._aabbMaxZ=s._aabbMaxZ>a._aabbMaxZ?s._aabbMaxZ:a._aabbMaxZ,o=o._parent}}i&&this.collide(this._tree._root,o._leaf),o._moved=!1}this.movedProxies[t]=null}i||this.collide(this._tree._root,this._tree._root),this.numMovedProxies=0}rayCast(t,i,s){if(null==this._tree._root)return;let a,o,n,e,r,_;a=t.x,o=t.y,n=t.z,e=i.x,r=i.y,_=i.z,this.rayCastRecursive(this._tree._root,a,o,n,e,r,_,s)}convexCast(t,i,s,a){null!=this._tree._root&&this.convexCastRecursive(this._tree._root,t,i,s,a)}aabbTest(t,i){null!=this._tree._root&&this.aabbTestRecursive(this._tree._root,t,i)}getTreeBalance(){return this._tree._getBalance()}},a.collision.broadphase.bvh.BvhInsertionStrategy=class{},a.collision.broadphase.bvh.BvhNode=class{constructor(){this._next=null,this._prevLeaf=null,this._nextLeaf=null,this._children=new Array(2),this._childIndex=0,this._parent=null,this._height=0,this._proxy=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}},a.collision.broadphase.bvh.BvhProxy=class extends a.collision.broadphase.Proxy{constructor(t,i){super(t,i),this._leaf=null,this._moved=!1}},a.collision.broadphase.bvh.BvhStrategy=class{constructor(){this._insertionStrategy=0,this._balancingEnabled=!1}_decideInsertion(t,i){switch(this._insertionStrategy){case 0:let s,a,o;s=i._aabbMinX+i._aabbMaxX,a=i._aabbMinY+i._aabbMaxY,o=i._aabbMinZ+i._aabbMaxZ;let n,e,r,_,l,h,c=t._children[0],m=t._children[1];return n=c._aabbMinX+c._aabbMaxX,e=c._aabbMinY+c._aabbMaxY,r=c._aabbMinZ+c._aabbMaxZ,_=m._aabbMinX+m._aabbMaxX,l=m._aabbMinY+m._aabbMaxY,h=m._aabbMinZ+m._aabbMaxZ,n-=s,e-=a,r-=o,_-=s,l-=a,h-=o,n*n+e*e+r*r<_*_+l*l+h*h?0:1;case 1:let b,p,x,f,u,y,g=t._children[0],v=t._children[1],d=t._aabbMaxY-t._aabbMinY,X=t._aabbMaxZ-t._aabbMinZ;b=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,p=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,x=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,f=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,u=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,y=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let z=u-p,Y=y-x,Z=2*((f-b)*(z+Y)+z*Y),M=2*Z,I=2*(Z-2*((t._aabbMaxX-t._aabbMinX)*(d+X)+d*X)),V=I;if(b=g._aabbMinX<i._aabbMinX?g._aabbMinX:i._aabbMinX,p=g._aabbMinY<i._aabbMinY?g._aabbMinY:i._aabbMinY,x=g._aabbMinZ<i._aabbMinZ?g._aabbMinZ:i._aabbMinZ,f=g._aabbMaxX>i._aabbMaxX?g._aabbMaxX:i._aabbMaxX,u=g._aabbMaxY>i._aabbMaxY?g._aabbMaxY:i._aabbMaxY,y=g._aabbMaxZ>i._aabbMaxZ?g._aabbMaxZ:i._aabbMaxZ,0==g._height){let t=u-p,i=y-x;V=I+2*((f-b)*(t+i)+t*i)}else{let t=u-p,i=y-x,s=g._aabbMaxY-g._aabbMinY,a=g._aabbMaxZ-g._aabbMinZ;V=I+(2*((f-b)*(t+i)+t*i)-2*((g._aabbMaxX-g._aabbMinX)*(s+a)+s*a))}let w=I;if(b=v._aabbMinX<i._aabbMinX?v._aabbMinX:i._aabbMinX,p=v._aabbMinY<i._aabbMinY?v._aabbMinY:i._aabbMinY,x=v._aabbMinZ<i._aabbMinZ?v._aabbMinZ:i._aabbMinZ,f=v._aabbMaxX>i._aabbMaxX?v._aabbMaxX:i._aabbMaxX,u=v._aabbMaxY>i._aabbMaxY?v._aabbMaxY:i._aabbMaxY,y=v._aabbMaxZ>i._aabbMaxZ?v._aabbMaxZ:i._aabbMaxZ,0==v._height){let t=u-p,i=y-x;w=I+2*((f-b)*(t+i)+t*i)}else{let t=u-p,i=y-x,s=v._aabbMaxY-v._aabbMinY,a=v._aabbMaxZ-v._aabbMinZ;w=I+(2*((f-b)*(t+i)+t*i)-2*((v._aabbMaxX-v._aabbMinX)*(s+a)+s*a))}return M<V?M<w?-1:1:V<w?0:1;default:return console.log("src/oimo/collision/broadphase/bvh/BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this._insertionStrategy),-1}}_splitLeaves(t,i,s){let a,o,n,e=1/(s-i);a=0,o=0,n=0;let r,_,l,h=i;for(;h<s;){let i=t[h++];i._tmpX=i._aabbMaxX+i._aabbMinX,i._tmpY=i._aabbMaxY+i._aabbMinY,i._tmpZ=i._aabbMaxZ+i._aabbMinZ,a+=i._tmpX,o+=i._tmpY,n+=i._tmpZ}a*=e,o*=e,n*=e,r=0,_=0,l=0;let c=i;for(;c<s;){let i,s,e,h=t[c++];i=h._tmpX-a,s=h._tmpY-o,e=h._tmpZ-n,i*=i,s*=s,e*=e,r+=i,_+=s,l+=e}let m=_,b=l,p=i,x=s-1;if(r>m)if(r>b){let i=a;for(;;){for(;!(t[p]._tmpX<=i);)++p;for(;!(t[x]._tmpX>=i);)--x;if(p>=x)break;let s=t[p];t[p]=t[x],t[x]=s,++p,--x}}else{let i=n;for(;;){for(;!(t[p]._tmpZ<=i);)++p;for(;!(t[x]._tmpZ>=i);)--x;if(p>=x)break;let s=t[p];t[p]=t[x],t[x]=s,++p,--x}}else if(m>b){let i=o;for(;;){for(;!(t[p]._tmpY<=i);)++p;for(;!(t[x]._tmpY>=i);)--x;if(p>=x)break;let s=t[p];t[p]=t[x],t[x]=s,++p,--x}}else{let i=n;for(;;){for(;!(t[p]._tmpZ<=i);)++p;for(;!(t[x]._tmpZ>=i);)--x;if(p>=x)break;let s=t[p];t[p]=t[x],t[x]=s,++p,--x}}return p}},a.collision.broadphase.bvh.BvhTree=class{constructor(){this._root=null,this._numLeaves=0,this._strategy=new a.collision.broadphase.bvh.BvhStrategy,this._nodePool=null,this.leafList=null,this.leafListLast=null,this.tmp=new Array(1024)}_print(t,i){if(null==i&&(i=""),null!=t)if(0==t._height)console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:39:",i+t._proxy._id);else{let s,a,o,n;this._print(t._children[0],i+"  "),a=t._aabbMaxX-t._aabbMinX,o=t._aabbMaxY-t._aabbMinY,n=t._aabbMaxZ-t._aabbMinZ;if(a*(o+n)+o*n>0){let i,a,o;i=t._aabbMaxX-t._aabbMinX,a=t._aabbMaxY-t._aabbMinY,o=t._aabbMaxZ-t._aabbMinZ;s=(1e3*(i*(a+o)+a*o)+.5|0)/1e3}else{let i,a,o;i=t._aabbMaxX-t._aabbMinX,a=t._aabbMaxY-t._aabbMinY,o=t._aabbMaxZ-t._aabbMinZ;s=(1e3*(i*(a+o)+a*o)-.5|0)/1e3}console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:42:",i+"#"+t._height+", "+s),this._print(t._children[1],i+"  ")}}_getBalance(){return this.getBalanceRecursive(this._root)}deleteRecursive(t){if(0==t._height){let i=t._prevLeaf,s=t._nextLeaf;return null!=i&&(i._nextLeaf=s),null!=s&&(s._prevLeaf=i),t==this.leafList&&(this.leafList=this.leafList._nextLeaf),t==this.leafListLast&&(this.leafListLast=this.leafListLast._prevLeaf),t._nextLeaf=null,t._prevLeaf=null,t._proxy._leaf=null,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,void(this._nodePool=t)}this.deleteRecursive(t._children[0]),this.deleteRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}decomposeRecursive(t){if(0==t._height)return t._childIndex=0,void(t._parent=null);this.decomposeRecursive(t._children[0]),this.decomposeRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}buildTopDownRecursive(t,i,s){if(s-i==1){let s=t[i],a=s._proxy;return s._aabbMinX=a._aabbMinX,s._aabbMinY=a._aabbMinY,s._aabbMinZ=a._aabbMinZ,s._aabbMaxX=a._aabbMaxX,s._aabbMaxY=a._aabbMaxY,s._aabbMaxZ=a._aabbMaxZ,s}let o=this._strategy._splitLeaves(t,i,s),n=this.buildTopDownRecursive(t,i,o),e=this.buildTopDownRecursive(t,o,s),r=this._nodePool;null!=r?(this._nodePool=r._next,r._next=null):r=new a.collision.broadphase.bvh.BvhNode;let _=r;_._children[0]=n,n._parent=_,n._childIndex=0,_._children[1]=e,e._parent=_,e._childIndex=1;let l=_._children[0],h=_._children[1];_._aabbMinX=l._aabbMinX<h._aabbMinX?l._aabbMinX:h._aabbMinX,_._aabbMinY=l._aabbMinY<h._aabbMinY?l._aabbMinY:h._aabbMinY,_._aabbMinZ=l._aabbMinZ<h._aabbMinZ?l._aabbMinZ:h._aabbMinZ,_._aabbMaxX=l._aabbMaxX>h._aabbMaxX?l._aabbMaxX:h._aabbMaxX,_._aabbMaxY=l._aabbMaxY>h._aabbMaxY?l._aabbMaxY:h._aabbMaxY,_._aabbMaxZ=l._aabbMaxZ>h._aabbMaxZ?l._aabbMaxZ:h._aabbMaxZ;let c=_._children[0]._height,m=_._children[1]._height;return _._height=(c>m?c:m)+1,_}getBalanceRecursive(t){if(null==t||0==t._height)return 0;let i=t._children[0]._height-t._children[1]._height;return i<0&&(i=-i),i+this.getBalanceRecursive(t._children[0])+this.getBalanceRecursive(t._children[1])}},a.collision.geometry.Aabb=class{constructor(){this._minX=0,this._minY=0,this._minZ=0,this._maxX=0,this._maxY=0,this._maxZ=0}init(t,i){return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this._maxX=i.x,this._maxY=i.y,this._maxZ=i.z,this}getMin(){let t=new a.common.Vec3;return t.x=this._minX,t.y=this._minY,t.z=this._minZ,t}getMinTo(t){t.x=this._minX,t.y=this._minY,t.z=this._minZ}setMin(t){return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this}getMax(){let t=new a.common.Vec3;return t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ,t}getMaxTo(t){t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ}setMax(t){return this._maxX=t.x,this._maxY=t.y,this._maxZ=t.z,this}getCenter(){let t,i,s,o=new a.common.Vec3;return t=this._minX+this._maxX,i=this._minY+this._maxY,s=this._minZ+this._maxZ,t*=.5,i*=.5,s*=.5,o.x=t,o.y=i,o.z=s,o}getCenterTo(t){let i,s,a;i=this._minX+this._maxX,s=this._minY+this._maxY,a=this._minZ+this._maxZ,i*=.5,s*=.5,a*=.5,t.x=i,t.y=s,t.z=a}getExtents(){let t,i,s,o=new a.common.Vec3;return t=this._maxX-this._minX,i=this._maxY-this._minY,s=this._maxZ-this._minZ,t*=.5,i*=.5,s*=.5,o.x=t,o.y=i,o.z=s,o}getExtentsTo(t){let i,s,a;i=this._maxX-this._minX,s=this._maxY-this._minY,a=this._maxZ-this._minZ,i*=.5,s*=.5,a*=.5,t.x=i,t.y=s,t.z=a}combine(t){return this._minX=this._minX<t._minX?this._minX:t._minX,this._minY=this._minY<t._minY?this._minY:t._minY,this._minZ=this._minZ<t._minZ?this._minZ:t._minZ,this._maxX=this._maxX>t._maxX?this._maxX:t._maxX,this._maxY=this._maxY>t._maxY?this._maxY:t._maxY,this._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,this}combined(t){let i=new a.collision.geometry.Aabb;return i._minX=this._minX<t._minX?this._minX:t._minX,i._minY=this._minY<t._minY?this._minY:t._minY,i._minZ=this._minZ<t._minZ?this._minZ:t._minZ,i._maxX=this._maxX>t._maxX?this._maxX:t._maxX,i._maxY=this._maxY>t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,i}overlap(t){return this._minX<t._maxX&&this._maxX>t._minX&&this._minY<t._maxY&&this._maxY>t._minY&&this._minZ<t._maxZ&&this._maxZ>t._minZ}getIntersection(t){let i=new a.collision.geometry.Aabb;return i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ,i}getIntersectionTo(t,i){i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ}copyFrom(t){return this._minX=t._minX,this._minY=t._minY,this._minZ=t._minZ,this._maxX=t._maxX,this._maxY=t._maxY,this._maxZ=t._maxZ,this}clone(){let t=new a.collision.geometry.Aabb;return t._minX=this._minX,t._minY=this._minY,t._minZ=this._minZ,t._maxX=this._maxX,t._maxY=this._maxY,t._maxZ=this._maxZ,t}},a.collision.geometry.BoxGeometry=class extends a.collision.geometry.ConvexGeometry{constructor(t){super(1),this._halfExtentsX=t.x,this._halfExtentsY=t.y,this._halfExtentsZ=t.z,this._halfAxisXX=t.x,this._halfAxisXY=0,this._halfAxisXZ=0,this._halfAxisYX=0,this._halfAxisYY=t.y,this._halfAxisYZ=0,this._halfAxisZX=0,this._halfAxisZY=0,this._halfAxisZZ=t.z,this._updateMass();let i=t.x<t.y?t.z<t.x?t.z:t.x:t.z<t.y?t.z:t.y;this._gjkMargin>.2*i&&(this._gjkMargin=.2*i)}getHalfExtents(){let t=new a.common.Vec3;return t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ,t}getHalfExtentsTo(t){t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ}_updateMass(){let t,i,s;this._volume=this._halfExtentsX*this._halfExtentsY*this._halfExtentsZ*8,t=this._halfExtentsX*this._halfExtentsX,i=this._halfExtentsY*this._halfExtentsY,s=this._halfExtentsZ*this._halfExtentsZ,this._inertiaCoeff00=.3333333333333333*(i+s),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(s+t),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(t+i)}_computeAabb(t,i){let s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X;c=i._rotation00*this._halfAxisXX+i._rotation01*this._halfAxisXY+i._rotation02*this._halfAxisXZ,m=i._rotation10*this._halfAxisXX+i._rotation11*this._halfAxisXY+i._rotation12*this._halfAxisXZ,b=i._rotation20*this._halfAxisXX+i._rotation21*this._halfAxisXY+i._rotation22*this._halfAxisXZ,s=c,a=m,o=b,p=i._rotation00*this._halfAxisYX+i._rotation01*this._halfAxisYY+i._rotation02*this._halfAxisYZ,x=i._rotation10*this._halfAxisYX+i._rotation11*this._halfAxisYY+i._rotation12*this._halfAxisYZ,f=i._rotation20*this._halfAxisYX+i._rotation21*this._halfAxisYY+i._rotation22*this._halfAxisYZ,n=p,e=x,r=f,u=i._rotation00*this._halfAxisZX+i._rotation01*this._halfAxisZY+i._rotation02*this._halfAxisZZ,y=i._rotation10*this._halfAxisZX+i._rotation11*this._halfAxisZY+i._rotation12*this._halfAxisZZ,g=i._rotation20*this._halfAxisZX+i._rotation21*this._halfAxisZY+i._rotation22*this._halfAxisZZ,_=u,l=y,h=g,s<0&&(s=-s),a<0&&(a=-a),o<0&&(o=-o),n<0&&(n=-n),e<0&&(e=-e),r<0&&(r=-r),_<0&&(_=-_),l<0&&(l=-l),h<0&&(h=-h),v=s+n,d=a+e,X=o+r,v+=_,d+=l,X+=h,t._minX=i._positionX-v,t._minY=i._positionY-d,t._minZ=i._positionZ-X,t._maxX=i._positionX+v,t._maxY=i._positionY+d,t._maxZ=i._positionZ+X}computeLocalSupportingVertex(t,i){let s,a,o,n,e,r;s=this._gjkMargin,a=this._gjkMargin,o=this._gjkMargin,s<this._halfExtentsX||(s=this._halfExtentsX),a<this._halfExtentsY||(a=this._halfExtentsY),o<this._halfExtentsZ||(o=this._halfExtentsZ),n=this._halfExtentsX-s,e=this._halfExtentsY-a,r=this._halfExtentsZ-o,i.x=t.x>0?n:-n,i.y=t.y>0?e:-e,i.z=t.z>0?r:-r}_rayCastLocal(t,i,s,a,o,n,e){let r=this._halfExtentsX,_=this._halfExtentsY,l=this._halfExtentsZ,h=a-t,c=o-i,m=n-s,b=0,p=0,x=0,f=1,u=1,y=1;if(h>-1e-6&&h<1e-6){if(t<=-r||t>=r)return!1}else{let i=1/h,s=(-r-t)*i,a=(r-t)*i;if(s>a){let t=s;s=a,a=t}s>0&&(b=s),a<1&&(f=a)}if(c>-1e-6&&c<1e-6){if(i<=-_||i>=_)return!1}else{let t=1/c,s=(-_-i)*t,a=(_-i)*t;if(s>a){let t=s;s=a,a=t}s>0&&(p=s),a<1&&(u=a)}if(m>-1e-6&&m<1e-6){if(s<=-l||s>=l)return!1}else{let t=1/m,i=(-l-s)*t,a=(l-s)*t;if(i>a){let t=i;i=a,a=t}i>0&&(x=i),a<1&&(y=a)}if(b>=1||p>=1||x>=1||f<=0||u<=0||y<=0)return!1;let g=b,v=f,d=0;if(p>g&&(g=p,d=1),x>g&&(g=x,d=2),u<v&&(v=u),y<v&&(v=y),g>v)return!1;if(0==g)return!1;switch(d){case 0:e.normal.init(h>0?-1:1,0,0);break;case 1:e.normal.init(0,c>0?-1:1,0);break;case 2:e.normal.init(0,0,m>0?-1:1)}return e.position.init(t+g*h,i+g*c,s+g*m),e.fraction=g,!0}},a.collision.geometry.CapsuleGeometry=class extends a.collision.geometry.ConvexGeometry{constructor(t,i){super(4),this._radius=t,this._halfHeight=i,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,i=this._halfHeight*this._halfHeight,s=6.28318530717958*t*this._halfHeight,a=3.14159265358979*t*this._radius*4/3;this._volume=s+a;let o=0==this._volume?0:1/this._volume,n=o*(s*(.25*t+i/3)+a*(.4*t+this._halfHeight*this._radius*.75+i));this._inertiaCoeff00=n,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=o*(s*t*.5+a*t*.4),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=n}_computeAabb(t,i){let s,a,o,n,e,r;s=this._radius,a=this._radius,o=this._radius,n=i._rotation01,e=i._rotation11,r=i._rotation21,n<0&&(n=-n),e<0&&(e=-e),r<0&&(r=-r),n*=this._halfHeight,e*=this._halfHeight,r*=this._halfHeight,s+=n,a+=e,o+=r,t._minX=i._positionX-s,t._minY=i._positionY-a,t._minZ=i._positionZ-o,t._maxX=i._positionX+s,t._maxY=i._positionY+a,t._maxZ=i._positionZ+o}computeLocalSupportingVertex(t,i){t.y>0?i.init(0,this._halfHeight,0):i.init(0,-this._halfHeight,0)}_rayCastLocal(t,i,s,a,o,n,e){let r=this._halfHeight,_=a-t,l=n-s,h=0,c=1,m=_*_+l*l,b=t*_+s*l,p=t*t+s*s-this._radius*this._radius,x=b*b-m*p;if(x<0)return!1;if(m>0){let t=Math.sqrt(x);if(h=(-b-t)/m,c=(-b+t)/m,h>=1||c<=0)return!1}else{if(p>=0)return!1;h=0,c=1}let f,u,y,g,v,d,X,z,Y,Z,M=i+(o-i)*h;if(M>-r&&M<r){if(h>0){f=h;let i=e.normal.init(t+_*f,0,s+l*f),a=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z);return a>0&&(a=1/a),i.x*=a,i.y*=a,i.z*=a,e.position.init(t+f*_,M,s+f*l),e.fraction=f,!0}return!1}if(u=0,y=M<0?-r:r,g=0,v=t-0,d=i-y,X=s-0,z=a-t,Y=o-i,Z=n-s,m=z*z+Y*Y+Z*Z,b=v*z+d*Y+X*Z,p=v*v+d*d+X*X-this._radius*this._radius,x=b*b-m*p,x<0)return!1;let I,V,w,L,k,A,B=(-b-Math.sqrt(x))/m;if(B<0||B>1)return!1;I=v+z*B,V=d+Y*B,w=X+Z*B;let P=I*I+V*V+w*w;P>0&&(P=1/Math.sqrt(P)),L=I*P,k=V*P,A=w*P,I+=0,V+=y,w+=0;let S=e.position;S.x=I,S.y=V,S.z=w;let T=e.normal;return T.x=L,T.y=k,T.z=A,e.fraction=B,!0}},a.collision.geometry.ConeGeometry=class extends a.collision.geometry.ConvexGeometry{constructor(t,i){super(3),this._radius=t,this._halfHeight=i,this.sinTheta=t/Math.sqrt(t*t+4*i*i),this.cosTheta=2*i/Math.sqrt(t*t+4*i*i),this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2/3,this._inertiaCoeff00=.05*(3*t+2*i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.05*(3*t+2*i)}_computeAabb(t,i){let s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z;s=i._rotation01,a=i._rotation11,o=i._rotation21,n=s*s,e=a*a,r=o*o,c=Math.sqrt(1-n),m=Math.sqrt(1-e),b=Math.sqrt(1-r),c*=this._radius,m*=this._radius,b*=this._radius,_=s*this._halfHeight,l=a*this._halfHeight,h=o*this._halfHeight,p=-_,x=-l,f=-h,p-=c,x-=m,f-=b,u=-_,y=-l,g=-h,u+=c,y+=m,g+=b,v=p>u?p:u,d=x>y?x:y,X=f>g?f:g,v>_||(v=_),d>l||(d=l),X>h||(X=h),z=p<u?p:u,Y=x<y?x:y,Z=f<g?f:g,z<_||(z=_),Y<l||(Y=l),Z<h||(Z=h),t._minX=i._positionX+z,t._minY=i._positionY+Y,t._minZ=i._positionZ+Z,t._maxX=i._positionX+v,t._maxY=i._positionY+d,t._maxZ=i._positionZ+X}computeLocalSupportingVertex(t,i){let s=t.x,a=t.y,o=t.z;if(a>0&&a*a>this.sinTheta*this.sinTheta*(s*s+a*a+o*o))return i.init(0,this._halfHeight-this._gjkMargin/this.sinTheta,0),void(i.y<0&&(i.y=0));let n=t.x,e=t.z,r=n*n+e*e,_=2*this._halfHeight,l=(_-this._gjkMargin)/_*this._radius-this._gjkMargin/this.cosTheta;l<0&&(l=0);let h=r>0?l/Math.sqrt(r):0,c=this._halfHeight-this._gjkMargin;c<0&&(c=0),i.x=n*h,i.y=-c,i.z=e*h}_rayCastLocal(t,i,s,a,o,n,e){let r=i,_=this._halfHeight,l=a-t,h=o-i,c=n-s,m=0,b=1;if(h>-1e-6&&h<1e-6){if(i<=-_||i>=_)return!1}else{let t=1/h,s=(-_-i)*t,a=(_-i)*t;if(s>a){let t=s;s=a,a=t}s>0&&(m=s),a<1&&(b=a)}if(m>=1||b<=0)return!1;let p=0,x=0;r=i-_;let f,u=this.cosTheta*this.cosTheta,y=u*(l*l+h*h+c*c)-h*h,g=u*(t*l+r*h+s*c)-r*h,v=u*(t*t+r*r+s*s)-r*r,d=g*g-y*v;if(0!=y){if(d<0)return!1;let t=Math.sqrt(d);if(y<0){if(h>0){if(p=0,x=(-g+t)/y,x<=0)return!1}else if(p=(-g-t)/y,x=1,p>=1)return!1}else if(p=(-g-t)/y,x=(-g+t)/y,p>=1||x<=0)return!1}else{let t=-v/(2*g);if(g>0){if(p=0,x=t,t<=0)return!1}else if(p=t,x=1,t>=1)return!1}if(r+=_,x<=m||b<=p)return!1;if(p<m){if(f=m,0==f)return!1;e.normal.init(0,h>0?-1:1,0)}else{if(f=p,0==f)return!1;let i=e.normal.init(t+l*f,0,s+c*f),a=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z);a>0&&(a=1/a),i.x*=a,i.y*=a,i.z*=a;let o=this.cosTheta;i.x*=o,i.y*=o,i.z*=o,e.normal.y+=this.sinTheta}return e.position.init(t+f*l,r+f*h,s+f*c),e.fraction=f,!0}},a.collision.geometry.ConvexHullGeometry=class extends a.collision.geometry.ConvexGeometry{constructor(t){super(5),this._numVertices=t.length,this._vertices=new Array(this._numVertices),this._tmpVertices=new Array(this._numVertices);let i=0,s=this._numVertices;for(;i<s;){let s=i++;this._vertices[s]=t[s],this._tmpVertices[s]=new a.common.Vec3}this._useGjkRayCast=!0,this._updateMass()}getVertices(){return this._vertices}_updateMass(){this._volume=1,this._inertiaCoeff00=1,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=1,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=1;let t=this._vertices[0].x,i=this._vertices[0].y,s=this._vertices[0].z,a=this._vertices[0].x,o=this._vertices[0].y,n=this._vertices[0].z,e=1,r=this._numVertices;for(;e<r;){let r=e++,_=this._vertices[r].x,l=this._vertices[r].y,h=this._vertices[r].z;_<t?t=_:_>a&&(a=_),l<i?i=l:l>o&&(o=l),h<s?s=h:h>n&&(n=h)}let _=a-t,l=o-i,h=n-s;this._volume=_*l*h;let c=.25*((t+a)*(t+a)+(i+o)*(i+o)+(s+n)*(s+n));_=_*_*.25,l=l*l*.25,h=h*h*.25,this._inertiaCoeff00=.3333333333333333*(l+h)+c,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(h+_)+c,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(_+l)+c}_computeAabb(t,i){let s,a,o,n,e,r,_,l,h,c,m,b;_=this._gjkMargin,l=this._gjkMargin,h=this._gjkMargin;let p,x,f,u,y,g,v=this._vertices[0];c=v.x,m=v.y,b=v.z,u=i._rotation00*c+i._rotation01*m+i._rotation02*b,y=i._rotation10*c+i._rotation11*m+i._rotation12*b,g=i._rotation20*c+i._rotation21*m+i._rotation22*b,p=u,x=y,f=g,p+=i._positionX,x+=i._positionY,f+=i._positionZ,s=p,a=x,o=f,n=p,e=x,r=f;let d=1,X=this._numVertices;for(;d<X;){let t,_,l,h=this._vertices[d++];c=h.x,m=h.y,b=h.z,t=i._rotation00*c+i._rotation01*m+i._rotation02*b,_=i._rotation10*c+i._rotation11*m+i._rotation12*b,l=i._rotation20*c+i._rotation21*m+i._rotation22*b,p=t,x=_,f=l,p+=i._positionX,x+=i._positionY,f+=i._positionZ,s<p||(s=p),a<x||(a=x),o<f||(o=f),n>p||(n=p),e>x||(e=x),r>f||(r=f)}t._minX=s-_,t._minY=a-l,t._minZ=o-h,t._maxX=n+_,t._maxY=e+l,t._maxZ=r+h}computeLocalSupportingVertex(t,i){let s=this._vertices[0],a=s.x*t.x+s.y*t.y+s.z*t.z,o=0,n=1,e=this._numVertices;for(;n<e;){let i=n++,s=this._vertices[i],e=s.x*t.x+s.y*t.y+s.z*t.z;e>a&&(a=e,o=i)}let r=this._vertices[o];i.x=r.x,i.y=r.y,i.z=r.z}},a.collision.geometry.CylinderGeometry=class extends a.collision.geometry.ConvexGeometry{constructor(t,i){super(2),this._radius=t,this._halfHeight=i,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2,this._inertiaCoeff00=.08333333333333333*(3*t+i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.5*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*t+i)}_computeAabb(t,i){let s,a,o,n,e,r,_,l,h,c,m,b,p,x,f;s=i._rotation01,a=i._rotation11,o=i._rotation21,s<0&&(s=-s),a<0&&(a=-a),o<0&&(o=-o),n=s*s,e=a*a,r=o*o,c=Math.sqrt(1-n),m=Math.sqrt(1-e),b=Math.sqrt(1-r),c*=this._radius,m*=this._radius,b*=this._radius,_=s*this._halfHeight,l=a*this._halfHeight,h=o*this._halfHeight,p=c+_,x=m+l,f=b+h,t._minX=i._positionX-p,t._minY=i._positionY-x,t._minZ=i._positionZ-f,t._maxX=i._positionX+p,t._maxY=i._positionY+x,t._maxZ=i._positionZ+f}computeLocalSupportingVertex(t,i){let s=t.x,a=t.z,o=s*s+a*a,n=this._radius-this._gjkMargin;n<0&&(n=0);let e=o>0?n/Math.sqrt(o):0,r=this._halfHeight-this._gjkMargin;r<0&&(r=0),i.x=s*e,i.y=t.y>0?r:-r,i.z=a*e}_rayCastLocal(t,i,s,a,o,n,e){let r=this._halfHeight,_=a-t,l=o-i,h=n-s,c=0,m=1;if(l>-1e-6&&l<1e-6){if(i<=-r||i>=r)return!1}else{let t=1/l,s=(-r-i)*t,a=(r-i)*t;if(s>a){let t=s;s=a,a=t}s>0&&(c=s),a<1&&(m=a)}if(c>=1||m<=0)return!1;let b,p=0,x=1,f=_*_+h*h,u=t*_+s*h,y=t*t+s*s-this._radius*this._radius,g=u*u-f*y;if(g<0)return!1;if(f>0){let t=Math.sqrt(g);if(p=(-u-t)/f,x=(-u+t)/f,p>=1||x<=0)return!1}else{if(y>=0)return!1;p=0,x=1}if(x<=c||m<=p)return!1;if(p<c){if(b=c,0==b)return!1;e.normal.init(0,l>0?-1:1,0)}else{if(b=p,0==b)return!1;let i=e.normal.init(t+_*b,0,s+h*b),a=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z);a>0&&(a=1/a),i.x*=a,i.y*=a,i.z*=a}return e.position.init(t+b*_,i+b*l,s+b*h),e.fraction=b,!0}},a.collision.geometry.GeometryType=class{},a.collision.geometry.RayCastHit=class{constructor(){this.position=new a.common.Vec3,this.normal=new a.common.Vec3,this.fraction=0}},a.collision.geometry.SphereGeometry=class extends a.collision.geometry.ConvexGeometry{constructor(t){super(0),this._radius=t,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}_updateMass(){this._volume=4.188790204786386*this._radius*this._radius*this._radius,this._inertiaCoeff00=.4*this._radius*this._radius,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.4*this._radius*this._radius,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.4*this._radius*this._radius}_computeAabb(t,i){let s,a,o;s=this._radius,a=this._radius,o=this._radius,t._minX=i._positionX-s,t._minY=i._positionY-a,t._minZ=i._positionZ-o,t._maxX=i._positionX+s,t._maxY=i._positionY+a,t._maxZ=i._positionZ+o}computeLocalSupportingVertex(t,i){i.zero()}_rayCastLocal(t,i,s,a,o,n,e){let r,_,l;r=a-t,_=o-i,l=n-s;let h=r*r+_*_+l*l,c=t*r+i*_+s*l,m=c*c-h*(t*t+i*i+s*s-this._radius*this._radius);if(m<0)return!1;let b,p,x,f,u,y,g=(-c-Math.sqrt(m))/h;if(g<0||g>1)return!1;b=t+r*g,p=i+_*g,x=s+l*g;let v=b*b+p*p+x*x;v>0&&(v=1/Math.sqrt(v)),f=b*v,u=p*v,y=x*v;let d=e.position;d.x=b,d.y=p,d.z=x;let X=e.normal;return X.x=f,X.y=u,X.z=y,e.fraction=g,!0}},a.collision.narrowphase||(a.collision.narrowphase={}),a.collision.narrowphase.CollisionMatrix=class{constructor(){this.detectors=new Array(8),this.detectors[0]=new Array(8),this.detectors[1]=new Array(8),this.detectors[2]=new Array(8),this.detectors[3]=new Array(8),this.detectors[4]=new Array(8),this.detectors[5]=new Array(8);let t=new a.collision.narrowphase.detector.GjkEpaDetector;this.detectors[0][0]=new a.collision.narrowphase.detector.SphereSphereDetector,this.detectors[0][1]=new a.collision.narrowphase.detector.SphereBoxDetector(!1),this.detectors[0][2]=t,this.detectors[0][3]=t,this.detectors[0][4]=new a.collision.narrowphase.detector.SphereCapsuleDetector(!1),this.detectors[0][5]=t,this.detectors[1][0]=new a.collision.narrowphase.detector.SphereBoxDetector(!0),this.detectors[1][1]=new a.collision.narrowphase.detector.BoxBoxDetector,this.detectors[1][2]=t,this.detectors[1][3]=t,this.detectors[1][4]=t,this.detectors[1][5]=t,this.detectors[2][0]=t,this.detectors[2][1]=t,this.detectors[2][2]=t,this.detectors[2][3]=t,this.detectors[2][4]=t,this.detectors[2][5]=t,this.detectors[3][0]=t,this.detectors[3][1]=t,this.detectors[3][2]=t,this.detectors[3][3]=t,this.detectors[3][4]=t,this.detectors[3][5]=t,this.detectors[4][0]=new a.collision.narrowphase.detector.SphereCapsuleDetector(!0),this.detectors[4][1]=t,this.detectors[4][2]=t,this.detectors[4][3]=t,this.detectors[4][4]=new a.collision.narrowphase.detector.CapsuleCapsuleDetector,this.detectors[4][5]=t,this.detectors[5][0]=t,this.detectors[5][1]=t,this.detectors[5][2]=t,this.detectors[5][3]=t,this.detectors[5][4]=t,this.detectors[5][5]=t}getDetector(t,i){return this.detectors[t][i]}},a.collision.narrowphase.DetectorResult=class{constructor(){this.numPoints=0,this.normal=new a.common.Vec3,this.points=new Array(a.common.Setting.maxManifoldPoints),this.incremental=!1;let t=0,i=a.common.Setting.maxManifoldPoints;for(;t<i;)this.points[t++]=new a.collision.narrowphase.DetectorResultPoint}getMaxDepth(){let t=0,i=0,s=this.numPoints;for(;i<s;){let s=i++;this.points[s].depth>t&&(t=this.points[s].depth)}return t}clear(){this.numPoints=0;let t=0,i=this.points;for(;t<i.length;){let s=i[t];++t,s.position1.zero(),s.position2.zero(),s.depth=0,s.id=0}this.normal.zero()}},a.collision.narrowphase.DetectorResultPoint=class{constructor(){this.position1=new a.common.Vec3,this.position2=new a.common.Vec3,this.depth=0,this.id=0}},a.collision.narrowphase.detector||(a.collision.narrowphase.detector={}),a.collision.narrowphase.detector.Detector=class{constructor(t){this.swapped=t}setNormal(t,i,s,a){let o=t.normal;if(o.x=i,o.y=s,o.z=a,this.swapped){let i=t.normal;i.x=-i.x,i.y=-i.y,i.z=-i.z}}addPoint(t,i,s,a,o,n,e,r,_){let l=t.points[t.numPoints++];if(l.depth=r,l.id=_,this.swapped){let t=l.position1;t.x=o,t.y=n,t.z=e;let r=l.position2;r.x=i,r.y=s,r.z=a}else{let t=l.position1;t.x=i,t.y=s,t.z=a;let r=l.position2;r.x=o,r.y=n,r.z=e}}detectImpl(t,i,s,a,o,n){}detect(t,i,s,a,o,n){t.numPoints=0;let e=0,r=t.points;for(;e<r.length;){let t=r[e];++e,t.position1.zero(),t.position2.zero(),t.depth=0,t.id=0}t.normal.zero(),this.swapped?this.detectImpl(t,s,i,o,a,n):this.detectImpl(t,i,s,a,o,n)}},a.collision.narrowphase.detector.BoxBoxDetector=class extends a.collision.narrowphase.detector.Detector{constructor(){super(!1),this.clipper=new a.collision.narrowphase.detector._BoxBoxDetector.FaceClipper}detectImpl(t,i,s,o,n,e){let r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P=i,S=s;t.incremental=!1,r=o._positionX,_=o._positionY,l=o._positionZ,h=n._positionX,c=n._positionY,m=n._positionZ,b=h-r,p=c-_,x=m-l,f=o._rotation00,u=o._rotation10,y=o._rotation20,g=o._rotation01,v=o._rotation11,d=o._rotation21,X=o._rotation02,z=o._rotation12,Y=o._rotation22,Z=n._rotation00,M=n._rotation10,I=n._rotation20,V=n._rotation01,w=n._rotation11,L=n._rotation21,k=n._rotation02,A=n._rotation12,B=n._rotation22;let T,C,j,R,q,E,D,N,F,W,J,G,O,U,H,Q,K,$,tt=P._halfExtentsX,it=P._halfExtentsY,st=P._halfExtentsZ,at=S._halfExtentsX,ot=S._halfExtentsY,nt=S._halfExtentsZ;T=f*tt,C=u*tt,j=y*tt,R=g*it,q=v*it,E=d*it,D=X*st,N=z*st,F=Y*st,W=Z*at,J=M*at,G=I*at,O=V*ot,U=w*ot,H=L*ot,Q=k*nt,K=A*nt,$=B*nt;let et,rt,_t,lt=Infinity,ht=-1,ct=0;et=0,rt=0,_t=0;let mt=tt,bt=f*W+u*J+y*G,pt=f*O+u*U+y*H,xt=f*Q+u*K+y*$;bt<0&&(bt=-bt),pt<0&&(pt=-pt),xt<0&&(xt=-xt);let ft=bt+pt+xt,ut=f*b+u*p+y*x,yt=mt+ft,gt=ut<0,vt=gt?-ut:ut;if(!(vt<yt))return;{let t=yt-vt;t<Infinity&&(lt=t,ht=0,et=f,rt=u,_t=y,ct=gt?-1:1)}mt=it;let dt=g*W+v*J+d*G,Xt=g*O+v*U+d*H,zt=g*Q+v*K+d*$;dt<0&&(dt=-dt),Xt<0&&(Xt=-Xt),zt<0&&(zt=-zt),ft=dt+Xt+zt,ut=g*b+v*p+d*x;let Yt=mt+ft,Zt=ut<0,Mt=Zt?-ut:ut;if(!(Mt<Yt))return;{let t=Yt-Mt;t<lt&&(lt=t,ht=1,et=g,rt=v,_t=d,ct=Zt?-1:1)}mt=st;let It=X*W+z*J+Y*G,Vt=X*O+z*U+Y*H,wt=X*Q+z*K+Y*$;It<0&&(It=-It),Vt<0&&(Vt=-Vt),wt<0&&(wt=-wt),ft=It+Vt+wt,ut=X*b+z*p+Y*x;let Lt=mt+ft,kt=ut<0,At=kt?-ut:ut;if(!(At<Lt))return;{let t=Lt-At;t<lt&&(lt=t,ht=2,et=X,rt=z,_t=Y,ct=kt?-1:1)}lt>a.common.Setting.linearSlop?lt-=a.common.Setting.linearSlop:lt=0;let Bt=Z*T+M*C+I*j,Pt=Z*R+M*q+I*E,St=Z*D+M*N+I*F;Bt<0&&(Bt=-Bt),Pt<0&&(Pt=-Pt),St<0&&(St=-St),mt=Bt+Pt+St,ft=at,ut=Z*b+M*p+I*x;let Tt=mt+ft,Ct=ut<0,jt=Ct?-ut:ut;if(!(jt<Tt))return;{let t=Tt-jt;t<lt&&(lt=t,ht=3,et=Z,rt=M,_t=I,ct=Ct?-1:1)}let Rt=V*T+w*C+L*j,qt=V*R+w*q+L*E,Et=V*D+w*N+L*F;Rt<0&&(Rt=-Rt),qt<0&&(qt=-qt),Et<0&&(Et=-Et),mt=Rt+qt+Et,ft=ot,ut=V*b+w*p+L*x;let Dt=mt+ft,Nt=ut<0,Ft=Nt?-ut:ut;if(!(Ft<Dt))return;{let t=Dt-Ft;t<lt&&(lt=t,ht=4,et=V,rt=w,_t=L,ct=Nt?-1:1)}let Wt=k*T+A*C+B*j,Jt=k*R+A*q+B*E,Gt=k*D+A*N+B*F;Wt<0&&(Wt=-Wt),Jt<0&&(Jt=-Jt),Gt<0&&(Gt=-Gt),mt=Wt+Jt+Gt,ft=nt,ut=k*b+A*p+B*x;let Ot,Ut,Ht,Qt,Kt,$t,ti,ii,si,ai,oi,ni,ei,ri,_i,li,hi,ci,mi,bi,pi,xi=mt+ft,fi=ut<0,ui=fi?-ut:ut;if(!(ui<xi))return;{let t=xi-ui;t<lt&&(lt=t,ht=5,et=k,rt=A,_t=B,ct=fi?-1:1)}if(lt>a.common.Setting.linearSlop?lt-=a.common.Setting.linearSlop:lt=0,Ot=u*I-y*M,Ut=y*Z-f*I,Ht=f*M-u*Z,0!=Ot||0!=Ut||0!=Ht){let t=Ot*Ot+Ut*Ut+Ht*Ht;t>0&&(t=1/Math.sqrt(t)),Ot*=t,Ut*=t,Ht*=t;let i=Ot*R+Ut*q+Ht*E,s=Ot*D+Ut*N+Ht*F;i<0&&(i=-i),s<0&&(s=-s),mt=i+s;let a=Ot*O+Ut*U+Ht*H,o=Ot*Q+Ut*K+Ht*$;a<0&&(a=-a),o<0&&(o=-o),ft=a+o,ut=Ot*b+Ut*p+Ht*x;let n=mt+ft,e=ut<0,r=e?-ut:ut;if(!(r<n))return;{let t=n-r;t<lt&&(lt=t,ht=6,et=Ot,rt=Ut,_t=Ht,ct=e?-1:1)}}if(Ot=u*L-y*w,Ut=y*V-f*L,Ht=f*w-u*V,0!=Ot||0!=Ut||0!=Ht){let t=Ot*Ot+Ut*Ut+Ht*Ht;t>0&&(t=1/Math.sqrt(t)),Ot*=t,Ut*=t,Ht*=t;let i=Ot*R+Ut*q+Ht*E,s=Ot*D+Ut*N+Ht*F;i<0&&(i=-i),s<0&&(s=-s),mt=i+s;let a=Ot*W+Ut*J+Ht*G,o=Ot*Q+Ut*K+Ht*$;a<0&&(a=-a),o<0&&(o=-o),ft=a+o,ut=Ot*b+Ut*p+Ht*x;let n=mt+ft,e=ut<0,r=e?-ut:ut;if(!(r<n))return;{let t=n-r;t<lt&&(lt=t,ht=7,et=Ot,rt=Ut,_t=Ht,ct=e?-1:1)}}if(Ot=u*B-y*A,Ut=y*k-f*B,Ht=f*A-u*k,0!=Ot||0!=Ut||0!=Ht){let t=Ot*Ot+Ut*Ut+Ht*Ht;t>0&&(t=1/Math.sqrt(t)),Ot*=t,Ut*=t,Ht*=t;let i=Ot*R+Ut*q+Ht*E,s=Ot*D+Ut*N+Ht*F;i<0&&(i=-i),s<0&&(s=-s),mt=i+s;let a=Ot*W+Ut*J+Ht*G,o=Ot*O+Ut*U+Ht*H;a<0&&(a=-a),o<0&&(o=-o),ft=a+o,ut=Ot*b+Ut*p+Ht*x;let n=mt+ft,e=ut<0,r=e?-ut:ut;if(!(r<n))return;{let t=n-r;t<lt&&(lt=t,ht=8,et=Ot,rt=Ut,_t=Ht,ct=e?-1:1)}}if(Ot=v*I-d*M,Ut=d*Z-g*I,Ht=g*M-v*Z,0!=Ot||0!=Ut||0!=Ht){let t=Ot*Ot+Ut*Ut+Ht*Ht;t>0&&(t=1/Math.sqrt(t)),Ot*=t,Ut*=t,Ht*=t;let i=Ot*T+Ut*C+Ht*j,s=Ot*D+Ut*N+Ht*F;i<0&&(i=-i),s<0&&(s=-s),mt=i+s;let a=Ot*O+Ut*U+Ht*H,o=Ot*Q+Ut*K+Ht*$;a<0&&(a=-a),o<0&&(o=-o),ft=a+o,ut=Ot*b+Ut*p+Ht*x;let n=mt+ft,e=ut<0,r=e?-ut:ut;if(!(r<n))return;{let t=n-r;t<lt&&(lt=t,ht=9,et=Ot,rt=Ut,_t=Ht,ct=e?-1:1)}}if(Ot=v*L-d*w,Ut=d*V-g*L,Ht=g*w-v*V,0!=Ot||0!=Ut||0!=Ht){let t=Ot*Ot+Ut*Ut+Ht*Ht;t>0&&(t=1/Math.sqrt(t)),Ot*=t,Ut*=t,Ht*=t;let i=Ot*T+Ut*C+Ht*j,s=Ot*D+Ut*N+Ht*F;i<0&&(i=-i),s<0&&(s=-s),mt=i+s;let a=Ot*W+Ut*J+Ht*G,o=Ot*Q+Ut*K+Ht*$;a<0&&(a=-a),o<0&&(o=-o),ft=a+o,ut=Ot*b+Ut*p+Ht*x;let n=mt+ft,e=ut<0,r=e?-ut:ut;if(!(r<n))return;{let t=n-r;t<lt&&(lt=t,ht=10,et=Ot,rt=Ut,_t=Ht,ct=e?-1:1)}}if(Ot=v*B-d*A,Ut=d*k-g*B,Ht=g*A-v*k,0!=Ot||0!=Ut||0!=Ht){let t=Ot*Ot+Ut*Ut+Ht*Ht;t>0&&(t=1/Math.sqrt(t)),Ot*=t,Ut*=t,Ht*=t;let i=Ot*T+Ut*C+Ht*j,s=Ot*D+Ut*N+Ht*F;i<0&&(i=-i),s<0&&(s=-s),mt=i+s;let a=Ot*W+Ut*J+Ht*G,o=Ot*O+Ut*U+Ht*H;a<0&&(a=-a),o<0&&(o=-o),ft=a+o,ut=Ot*b+Ut*p+Ht*x;let n=mt+ft,e=ut<0,r=e?-ut:ut;if(!(r<n))return;{let t=n-r;t<lt&&(lt=t,ht=11,et=Ot,rt=Ut,_t=Ht,ct=e?-1:1)}}if(Ot=z*I-Y*M,Ut=Y*Z-X*I,Ht=X*M-z*Z,0!=Ot||0!=Ut||0!=Ht){let t=Ot*Ot+Ut*Ut+Ht*Ht;t>0&&(t=1/Math.sqrt(t)),Ot*=t,Ut*=t,Ht*=t;let i=Ot*T+Ut*C+Ht*j,s=Ot*R+Ut*q+Ht*E;i<0&&(i=-i),s<0&&(s=-s),mt=i+s;let a=Ot*O+Ut*U+Ht*H,o=Ot*Q+Ut*K+Ht*$;a<0&&(a=-a),o<0&&(o=-o),ft=a+o,ut=Ot*b+Ut*p+Ht*x;let n=mt+ft,e=ut<0,r=e?-ut:ut;if(!(r<n))return;{let t=n-r;t<lt&&(lt=t,ht=12,et=Ot,rt=Ut,_t=Ht,ct=e?-1:1)}}if(Ot=z*L-Y*w,Ut=Y*V-X*L,Ht=X*w-z*V,0!=Ot||0!=Ut||0!=Ht){let t=Ot*Ot+Ut*Ut+Ht*Ht;t>0&&(t=1/Math.sqrt(t)),Ot*=t,Ut*=t,Ht*=t;let i=Ot*T+Ut*C+Ht*j,s=Ot*R+Ut*q+Ht*E;i<0&&(i=-i),s<0&&(s=-s),mt=i+s;let a=Ot*W+Ut*J+Ht*G,o=Ot*Q+Ut*K+Ht*$;a<0&&(a=-a),o<0&&(o=-o),ft=a+o,ut=Ot*b+Ut*p+Ht*x;let n=mt+ft,e=ut<0,r=e?-ut:ut;if(!(r<n))return;{let t=n-r;t<lt&&(lt=t,ht=13,et=Ot,rt=Ut,_t=Ht,ct=e?-1:1)}}if(Ot=z*B-Y*A,Ut=Y*k-X*B,Ht=X*A-z*k,0!=Ot||0!=Ut||0!=Ht){let t=Ot*Ot+Ut*Ut+Ht*Ht;t>0&&(t=1/Math.sqrt(t)),Ot*=t,Ut*=t,Ht*=t;let i=Ot*T+Ut*C+Ht*j,s=Ot*R+Ut*q+Ht*E;i<0&&(i=-i),s<0&&(s=-s),mt=i+s;let a=Ot*W+Ut*J+Ht*G,o=Ot*O+Ut*U+Ht*H;a<0&&(a=-a),o<0&&(o=-o),ft=a+o,ut=Ot*b+Ut*p+Ht*x;let n=mt+ft,e=ut<0,r=e?-ut:ut;if(!(r<n))return;{let t=n-r;t<lt&&(lt=t,ht=14,et=Ot,rt=Ut,_t=Ht,ct=e?-1:1)}}if(ht>=6){et*=ct,rt*=ct,_t*=ct;let i,s,a,o,n,e,b,p,x,P,S,tt,it,st,at,ot=(ht-6)/3|0,nt=ht-6-3*ot;switch(ot){case 0:b=f,p=u,x=y;let t=D*et+N*rt+F*_t>0;R*et+q*rt+E*_t>0?t?(i=R+D,s=q+N,a=E+F):(i=R-D,s=q-N,a=E-F):t?(i=D-R,s=N-q,a=F-E):(i=R+D,s=q+N,a=E+F,i=-i,s=-s,a=-a);break;case 1:b=g,p=v,x=d;let o=D*et+N*rt+F*_t>0;T*et+C*rt+j*_t>0?o?(i=T+D,s=C+N,a=j+F):(i=T-D,s=C-N,a=j-F):o?(i=D-T,s=N-C,a=F-j):(i=T+D,s=C+N,a=j+F,i=-i,s=-s,a=-a);break;default:b=X,p=z,x=Y;let n=R*et+q*rt+E*_t>0;T*et+C*rt+j*_t>0?n?(i=T+R,s=C+q,a=j+E):(i=T-R,s=C-q,a=j-E):n?(i=R-T,s=q-C,a=E-j):(i=T+R,s=C+q,a=j+E,i=-i,s=-s,a=-a)}switch(i=r+i,s=_+s,a=l+a,nt){case 0:P=Z,S=M,tt=I;let t=Q*et+K*rt+$*_t>0;O*et+U*rt+H*_t>0?t?(o=O+Q,n=U+K,e=H+$):(o=O-Q,n=U-K,e=H-$):t?(o=Q-O,n=K-U,e=$-H):(o=O+Q,n=U+K,e=H+$,o=-o,n=-n,e=-e);break;case 1:P=V,S=w,tt=L;let i=Q*et+K*rt+$*_t>0;W*et+J*rt+G*_t>0?i?(o=W+Q,n=J+K,e=G+$):(o=W-Q,n=J-K,e=G-$):i?(o=Q-W,n=K-J,e=$-G):(o=W+Q,n=J+K,e=G+$,o=-o,n=-n,e=-e);break;default:P=k,S=A,tt=B;let s=O*et+U*rt+H*_t>0;W*et+J*rt+G*_t>0?s?(o=W+O,n=J+U,e=G+H):(o=W-O,n=J-U,e=G-H):s?(o=O-W,n=U-J,e=H-G):(o=W+O,n=J+U,e=G+H,o=-o,n=-n,e=-e)}o=h-o,n=c-n,e=m-e,it=i-o,st=s-n,at=a-e;let mt,bt,pt,xt,ft,ut,yt,gt,vt,dt=b*P+p*S+x*tt,Xt=b*it+p*st+x*at,zt=P*it+S*st+tt*at,Yt=1/(1-dt*dt),Zt=(dt*zt-Xt)*Yt,Mt=(zt-dt*Xt)*Yt;return mt=i+b*Zt,bt=s+p*Zt,pt=a+x*Zt,xt=o+P*Mt,ft=n+S*Mt,ut=e+tt*Mt,yt=-et,gt=-rt,vt=-_t,this.setNormal(t,yt,gt,vt),void this.addPoint(t,mt,bt,pt,xt,ft,ut,lt,4)}if(ht>=3){ct=-ct,b=-b,p=-p,x=-x;let t=P;P=S,S=t;let i=tt;tt=at,at=i;let s=it;it=ot,ot=s;let a=st;st=nt,nt=a,Qt=r,Kt=_,$t=l,r=h,_=c,l=m,h=Qt,c=Kt,m=$t,Qt=f,Kt=u,$t=y,f=Z,u=M,y=I,Z=Qt,M=Kt,I=$t,Qt=g,Kt=v,$t=d,g=V,v=w,d=L,V=Qt,w=Kt,L=$t,Qt=X,Kt=z,$t=Y,X=k,z=A,Y=B,k=Qt,A=Kt,B=$t,Qt=T,Kt=C,$t=j,T=W,C=J,j=G,W=Qt,J=Kt,G=$t,Qt=R,Kt=q,$t=E,R=O,q=U,E=H,O=Qt,U=Kt,H=$t,Qt=D,Kt=N,$t=F,D=Q,N=K,F=$,Q=Qt,K=Kt,$=$t,ht-=3,ti=!0}else ti=!1;switch(ht){case 0:ii=T,si=C,ai=j,oi=f,ni=u,ei=y,ri=g,_i=v,li=d,hi=X,ci=z,mi=Y,bi=it,pi=st;break;case 1:ii=R,si=q,ai=E,oi=g,ni=v,ei=d,ri=X,_i=z,li=Y,hi=f,ci=u,mi=y,bi=st,pi=tt;break;default:ii=D,si=N,ai=F,oi=X,ni=z,ei=Y,ri=f,_i=u,li=y,hi=g,ci=v,mi=d,bi=tt,pi=it}if(ct<0){ii=-ii,si=-si,ai=-ai,oi=-oi,ni=-ni,ei=-ei,Qt=ri,Kt=_i,$t=li,ri=hi,_i=ci,li=mi,hi=Qt,ci=Kt,mi=$t;let t=bi;bi=pi,pi=t}ii+=r,si+=_,ai+=l;let yi,gi,vi,di,Xi,zi,Yi,Zi,Mi,Ii,Vi,wi,Li=1,ki=0,Ai=oi*Z+ni*M+ei*I;switch(Ai<Li&&(Li=Ai,ki=0),-Ai<Li&&(Li=-Ai,ki=1),Ai=oi*V+ni*w+ei*L,Ai<Li&&(Li=Ai,ki=2),-Ai<Li&&(Li=-Ai,ki=3),Ai=oi*k+ni*A+ei*B,Ai<Li&&(Li=Ai,ki=4),-Ai<Li&&(Li=-Ai,ki=5),ki){case 0:yi=W+O,gi=J+U,vi=G+H,yi+=Q,gi+=K,vi+=$,di=W-O,Xi=J-U,zi=G-H,di+=Q,Xi+=K,zi+=$,Yi=W-O,Zi=J-U,Mi=G-H,Yi-=Q,Zi-=K,Mi-=$,Ii=W+O,Vi=J+U,wi=G+H,Ii-=Q,Vi-=K,wi-=$;break;case 1:yi=O-W,gi=U-J,vi=H-G,yi+=Q,gi+=K,vi+=$,di=O-W,Xi=U-J,zi=H-G,di-=Q,Xi-=K,zi-=$,Yi=W+O,Zi=J+U,Mi=G+H,Yi=-Yi,Zi=-Zi,Mi=-Mi,Yi-=Q,Zi-=K,Mi-=$,Ii=W+O,Vi=J+U,wi=G+H,Ii=-Ii,Vi=-Vi,wi=-wi,Ii+=Q,Vi+=K,wi+=$;break;case 2:yi=W+O,gi=J+U,vi=G+H,yi+=Q,gi+=K,vi+=$,di=W+O,Xi=J+U,zi=G+H,di-=Q,Xi-=K,zi-=$,Yi=O-W,Zi=U-J,Mi=H-G,Yi-=Q,Zi-=K,Mi-=$,Ii=O-W,Vi=U-J,wi=H-G,Ii+=Q,Vi+=K,wi+=$;break;case 3:yi=W-O,gi=J-U,vi=G-H,yi+=Q,gi+=K,vi+=$,di=W+O,Xi=J+U,zi=G+H,di=-di,Xi=-Xi,zi=-zi,di+=Q,Xi+=K,zi+=$,Yi=W+O,Zi=J+U,Mi=G+H,Yi=-Yi,Zi=-Zi,Mi=-Mi,Yi-=Q,Zi-=K,Mi-=$,Ii=W-O,Vi=J-U,wi=G-H,Ii-=Q,Vi-=K,wi-=$;break;case 4:yi=W+O,gi=J+U,vi=G+H,yi+=Q,gi+=K,vi+=$,di=O-W,Xi=U-J,zi=H-G,di+=Q,Xi+=K,zi+=$,Yi=W+O,Zi=J+U,Mi=G+H,Yi=-Yi,Zi=-Zi,Mi=-Mi,Yi+=Q,Zi+=K,Mi+=$,Ii=W-O,Vi=J-U,wi=G-H,Ii+=Q,Vi+=K,wi+=$;break;default:yi=W+O,gi=J+U,vi=G+H,yi-=Q,gi-=K,vi-=$,di=W-O,Xi=J-U,zi=G-H,di-=Q,Xi-=K,zi-=$,Yi=W+O,Zi=J+U,Mi=G+H,Yi=-Yi,Zi=-Zi,Mi=-Mi,Yi-=Q,Zi-=K,Mi-=$,Ii=O-W,Vi=U-J,wi=H-G,Ii-=Q,Vi-=K,wi-=$}yi+=b,gi+=p,vi+=x,di+=b,Xi+=p,zi+=x,Yi+=b,Zi+=p,Mi+=x,Ii+=b,Vi+=p,wi+=x;let Bi=this.clipper;Bi.w=bi,Bi.h=pi,Bi.numVertices=0,Bi.numTmpVertices=0;let Pi=this.clipper,Si=Pi.vertices[Pi.numVertices++];Si.x=yi*ri+gi*_i+vi*li,Si.y=yi*hi+gi*ci+vi*mi,Si.wx=yi,Si.wy=gi,Si.wz=vi;let Ti=this.clipper,Ci=Ti.vertices[Ti.numVertices++];Ci.x=di*ri+Xi*_i+zi*li,Ci.y=di*hi+Xi*ci+zi*mi,Ci.wx=di,Ci.wy=Xi,Ci.wz=zi;let ji=this.clipper,Ri=ji.vertices[ji.numVertices++];Ri.x=Yi*ri+Zi*_i+Mi*li,Ri.y=Yi*hi+Zi*ci+Mi*mi,Ri.wx=Yi,Ri.wy=Zi,Ri.wz=Mi;let qi,Ei,Di,Ni=this.clipper,Fi=Ni.vertices[Ni.numVertices++];Fi.x=Ii*ri+Vi*_i+wi*li,Fi.y=Ii*hi+Vi*ci+wi*mi,Fi.wx=Ii,Fi.wy=Vi,Fi.wz=wi,this.clipper.clip(),this.clipper.reduce(),ti?(qi=oi,Ei=ni,Di=ei):(qi=-oi,Ei=-ni,Di=-ei),this.setNormal(t,qi,Ei,Di);let Wi=0,Ji=this.clipper.numVertices;for(;Wi<Ji;){let i,s,o,n,e,h,c=Wi++,m=this.clipper.vertices[c];i=m.wx,s=m.wy,o=m.wz,i+=r,s+=_,o+=l,n=ii-i,e=si-s,h=ai-o;let b,p,x,f=n*oi+e*ni+h*ei;b=i+oi*f,p=s+ni*f,x=o+ei*f,f>-a.common.Setting.contactPersistenceThreshold&&(ti?this.addPoint(t,i,s,o,b,p,x,f,c):this.addPoint(t,b,p,x,i,s,o,f,c))}}},a.collision.narrowphase.detector._BoxBoxDetector||(a.collision.narrowphase.detector._BoxBoxDetector={}),a.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex=class{constructor(){this.x=0,this.y=0,this.wx=0,this.wy=0,this.wz=0}},a.collision.narrowphase.detector._BoxBoxDetector.FaceClipper=class{constructor(){this.w=0,this.h=0,this.numVertices=0,this.numTmpVertices=0,this.vertices=new Array(8),this.tmpVertices=new Array(8),this.vertices[0]=new a.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[0]=new a.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[1]=new a.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[1]=new a.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[2]=new a.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[2]=new a.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[3]=new a.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[3]=new a.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[4]=new a.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[4]=new a.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[5]=new a.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[5]=new a.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[6]=new a.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[6]=new a.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[7]=new a.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[7]=new a.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex}clip(){let t=0,i=this.numVertices;for(;t<i;){let i=t++,s=this.vertices[i],a=this.vertices[(i+1)%this.numVertices],o=this.w+s.x,n=this.w+a.x;if(o>0&&n>0){let t=this.tmpVertices[this.numTmpVertices++];t.x=s.x,t.y=s.y,t.wx=s.wx,t.wy=s.wy,t.wz=s.wz}else if(o>0&&n<=0){let t=this.tmpVertices[this.numTmpVertices++];t.x=s.x,t.y=s.y,t.wx=s.wx,t.wy=s.wy,t.wz=s.wz;let i=o/(o-n),e=this.tmpVertices[this.numTmpVertices++];e.x=s.x+(a.x-s.x)*i,e.y=s.y+(a.y-s.y)*i,e.wx=s.wx+(a.wx-s.wx)*i,e.wy=s.wy+(a.wy-s.wy)*i,e.wz=s.wz+(a.wz-s.wz)*i}else if(o<=0&&n>0){let t=o/(o-n),i=this.tmpVertices[this.numTmpVertices++];i.x=s.x+(a.x-s.x)*t,i.y=s.y+(a.y-s.y)*t,i.wx=s.wx+(a.wx-s.wx)*t,i.wy=s.wy+(a.wy-s.wy)*t,i.wz=s.wz+(a.wz-s.wz)*t}}let s=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=s,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let a=0,o=this.numVertices;for(;a<o;){let t=a++,i=this.vertices[t],s=this.vertices[(t+1)%this.numVertices],o=this.w-i.x,n=this.w-s.x;if(o>0&&n>0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz}else if(o>0&&n<=0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz;let a=o/(o-n),e=this.tmpVertices[this.numTmpVertices++];e.x=i.x+(s.x-i.x)*a,e.y=i.y+(s.y-i.y)*a,e.wx=i.wx+(s.wx-i.wx)*a,e.wy=i.wy+(s.wy-i.wy)*a,e.wz=i.wz+(s.wz-i.wz)*a}else if(o<=0&&n>0){let t=o/(o-n),a=this.tmpVertices[this.numTmpVertices++];a.x=i.x+(s.x-i.x)*t,a.y=i.y+(s.y-i.y)*t,a.wx=i.wx+(s.wx-i.wx)*t,a.wy=i.wy+(s.wy-i.wy)*t,a.wz=i.wz+(s.wz-i.wz)*t}}let n=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=n,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let e=0,r=this.numVertices;for(;e<r;){let t=e++,i=this.vertices[t],s=this.vertices[(t+1)%this.numVertices],a=this.h+i.y,o=this.h+s.y;if(a>0&&o>0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz}else if(a>0&&o<=0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz;let n=a/(a-o),e=this.tmpVertices[this.numTmpVertices++];e.x=i.x+(s.x-i.x)*n,e.y=i.y+(s.y-i.y)*n,e.wx=i.wx+(s.wx-i.wx)*n,e.wy=i.wy+(s.wy-i.wy)*n,e.wz=i.wz+(s.wz-i.wz)*n}else if(a<=0&&o>0){let t=a/(a-o),n=this.tmpVertices[this.numTmpVertices++];n.x=i.x+(s.x-i.x)*t,n.y=i.y+(s.y-i.y)*t,n.wx=i.wx+(s.wx-i.wx)*t,n.wy=i.wy+(s.wy-i.wy)*t,n.wz=i.wz+(s.wz-i.wz)*t}}let _=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=_,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let l=0,h=this.numVertices;for(;l<h;){let t=l++,i=this.vertices[t],s=this.vertices[(t+1)%this.numVertices],a=this.h-i.y,o=this.h-s.y;if(a>0&&o>0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz}else if(a>0&&o<=0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz;let n=a/(a-o),e=this.tmpVertices[this.numTmpVertices++];e.x=i.x+(s.x-i.x)*n,e.y=i.y+(s.y-i.y)*n,e.wx=i.wx+(s.wx-i.wx)*n,e.wy=i.wy+(s.wy-i.wy)*n,e.wz=i.wz+(s.wz-i.wz)*n}else if(a<=0&&o>0){let t=a/(a-o),n=this.tmpVertices[this.numTmpVertices++];n.x=i.x+(s.x-i.x)*t,n.y=i.y+(s.y-i.y)*t,n.wx=i.wx+(s.wx-i.wx)*t,n.wy=i.wy+(s.wy-i.wy)*t,n.wz=i.wz+(s.wz-i.wz)*t}}let c=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=c,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}reduce(){if(this.numVertices<4)return;let t=-1/0,i=Infinity,s=-1/0,a=Infinity,o=null,n=null,e=null,r=null,_=0,l=this.numVertices;for(;_<l;){let l=_++,h=this.vertices[l],c=1*h.x+1*h.y,m=-1*h.x+1*h.y;0==l?(t=c,o=h,i=c,n=h,s=m,e=h,a=m,r=h):(c>t&&(t=c,o=h),c<i&&(i=c,n=h),m>s&&(s=m,e=h),m<a&&(a=m,r=h))}let h=this.tmpVertices[this.numTmpVertices++];h.x=o.x,h.y=o.y,h.wx=o.wx,h.wy=o.wy,h.wz=o.wz;let c=this.tmpVertices[this.numTmpVertices++];c.x=e.x,c.y=e.y,c.wx=e.wx,c.wy=e.wy,c.wz=e.wz;let m=this.tmpVertices[this.numTmpVertices++];m.x=n.x,m.y=n.y,m.wx=n.wx,m.wy=n.wy,m.wz=n.wz;let b=this.tmpVertices[this.numTmpVertices++];b.x=r.x,b.y=r.y,b.wx=r.wx,b.wy=r.wy,b.wz=r.wz;let p=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=p,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}},a.collision.narrowphase.detector.BoxBoxDetectorMacro=class{},a.collision.narrowphase.detector.CachedDetectorData=class{constructor(){}_clear(){null!=this._gjkCache&&this._gjkCache.clear()}},a.collision.narrowphase.detector.CapsuleCapsuleDetector=class extends a.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,s,a,o,n){let e,r,_,l,h,c,m=i,b=s;t.incremental=!1,e=a._rotation01,r=a._rotation11,_=a._rotation21,l=o._rotation01,h=o._rotation11,c=o._rotation21;let p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S=m._halfHeight,T=b._halfHeight,C=m._radius,j=b._radius;p=a._positionX+e*-S,x=a._positionY+r*-S,f=a._positionZ+_*-S,u=a._positionX+e*S,y=a._positionY+r*S,g=a._positionZ+_*S,v=o._positionX+l*-T,d=o._positionY+h*-T,X=o._positionZ+c*-T,z=o._positionX+l*T,Y=o._positionY+h*T,Z=o._positionZ+c*T,M=p-v,I=x-d,V=f-X,w=u-p,L=y-x,k=g-f,A=z-v,B=Y-d,P=Z-X;let R,q,E,D,N,F,W,J,G,O,U,H=-(M*w+I*L+V*k),Q=M*A+I*B+V*P,K=S*S*4,$=w*A+L*B+k*P,tt=T*T*4;if(0==K&&0==tt)R=0,q=0;else if(0==K)R=0,q=Q,q=Q<0?0:Q>tt?1:Q/tt;else if(0==tt)q=0,R=H,R=H<0?0:H>K?1:H/K;else{let t=K*tt-$*$;0==t?R=0:(R=$*Q+tt*H,R<0?R=0:R>t?R=1:R/=t),q=R*$+Q,q<0?(q=0,R=H,R=H<0?0:H>K?1:H/K):q>tt?(q=1,R=$+H,R<0?R=0:R>K?R=1:R/=K):q/=tt}E=p+w*R,D=x+L*R,N=f+k*R,F=v+A*q,W=d+B*q,J=X+P*q,G=E-F,O=D-W,U=N-J;let it=G*G+O*O+U*U;if(it>=(C+j)*(C+j))return;let st,at,ot,nt,et,rt,_t,lt,ht,ct=Math.sqrt(it);ct>0?(st=G*(1/ct),at=O*(1/ct),ot=U*(1/ct)):(st=1,at=0,ot=0),this.setNormal(t,st,at,ot),nt=E+st*-C,et=D+at*-C,rt=N+ot*-C,_t=F+st*j,lt=W+at*j,ht=J+ot*j,this.addPoint(t,nt,et,rt,_t,lt,ht,C+j-ct,0)}},a.collision.narrowphase.detector.GjkEpaDetector=class extends a.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,s,o,n,e){let r,_,l,h,c,m,b=a.collision.narrowphase.detector.gjkepa.GjkEpa.instance,p=i,x=s,f=b.computeClosestPointsImpl(p,x,o,n,a.common.Setting.enableGJKCaching?e:null,!0);if(t.incremental=!0,f!=a.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED)return void console.log("src/oimo/collision/narrowphase/detector/GjkEpaDetector.hx:28:","GJK/EPA failed: status="+f);if(b.distance>p._gjkMargin+x._gjkMargin)return;let u=b.closestPoint1;r=u.x,_=u.y,l=u.z;let y,g,v,d=b.closestPoint2;if(h=d.x,c=d.y,m=d.z,y=r-h,g=_-c,v=l-m,y*y+g*g+v*v==0)return;b.distance<0&&(y=-y,g=-g,v=-v);let X=y*y+g*g+v*v;X>0&&(X=1/Math.sqrt(X)),y*=X,g*=X,v*=X,this.setNormal(t,y,g,v),r+=y*-p._gjkMargin,_+=g*-p._gjkMargin,l+=v*-p._gjkMargin,h+=y*x._gjkMargin,c+=g*x._gjkMargin,m+=v*x._gjkMargin,this.addPoint(t,r,_,l,h,c,m,p._gjkMargin+x._gjkMargin-b.distance,0)}},a.collision.narrowphase.detector.SphereBoxDetector=class extends a.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,i,s,a,o,n){let e,r,_,l,h,c,m=s;t.incremental=!1,e=m._halfExtentsX,r=m._halfExtentsY,_=m._halfExtentsZ,l=-e,h=-r,c=-_;let b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V=i._radius;if(b=a._positionX-o._positionX,p=a._positionY-o._positionY,x=a._positionZ-o._positionZ,g=o._rotation00*b+o._rotation10*p+o._rotation20*x,v=o._rotation01*b+o._rotation11*p+o._rotation21*x,d=o._rotation02*b+o._rotation12*p+o._rotation22*x,f=g,u=v,y=d,l<f&&e>f&&h<u&&r>u&&c<y&&_>y){let i,s,n,l,h,c;i=f<0?-f:f,s=u<0?-u:u,n=y<0?-y:y,i=e-i,s=r-s,n=_-n;let m,b,p,x,g,v,d,X,z,Y,Z,M,I,w,L,k,A,B,P,S,T,C,j,R,q,E,D,N;return i<s?i<n?(f>0?(l=1,h=0,c=0):(l=-1,h=0,c=0),b=0,p=1,x=1,m=i):(y>0?(l=0,h=0,c=1):(l=0,h=0,c=-1),b=1,p=1,x=0,m=n):s<n?(u>0?(l=0,h=1,c=0):(l=0,h=-1,c=0),b=1,p=0,x=1,m=s):(y>0?(l=0,h=0,c=1):(l=0,h=0,c=-1),b=1,p=1,x=0,m=n),g=b*f,v=p*u,d=x*y,X=l*e,z=h*r,Y=c*_,X+=g,z+=v,Y+=d,A=o._rotation00*X+o._rotation01*z+o._rotation02*Y,B=o._rotation10*X+o._rotation11*z+o._rotation12*Y,P=o._rotation20*X+o._rotation21*z+o._rotation22*Y,Z=A,M=B,I=P,S=o._rotation00*l+o._rotation01*h+o._rotation02*c,T=o._rotation10*l+o._rotation11*h+o._rotation12*c,C=o._rotation20*l+o._rotation21*h+o._rotation22*c,w=S,L=T,k=C,this.setNormal(t,w,L,k),j=a._positionX+w*-V,R=a._positionY+L*-V,q=a._positionZ+k*-V,E=o._positionX+Z,D=o._positionY+M,N=o._positionZ+I,void this.addPoint(t,j,R,q,E,D,N,m,0)}e-=1e-9,r-=1e-9,_-=1e-9,l+=1e-9,h+=1e-9,c+=1e-9,X=f<e?f:e,z=u<r?u:r,Y=y<_?y:_,X>l||(X=l),z>h||(z=h),Y>c||(Y=c),Z=f-X,M=u-z,I=y-Y;let w,L,k,A,B,P,S,T,C,j,R,q,E,D,N,F=Z*Z+M*M+I*I;if(F>=V*V)return;F=Math.sqrt(F),S=o._rotation00*X+o._rotation01*z+o._rotation02*Y,T=o._rotation10*X+o._rotation11*z+o._rotation12*Y,C=o._rotation20*X+o._rotation21*z+o._rotation22*Y,w=S,L=T,k=C,j=o._rotation00*Z+o._rotation01*M+o._rotation02*I,R=o._rotation10*Z+o._rotation11*M+o._rotation12*I,q=o._rotation20*Z+o._rotation21*M+o._rotation22*I,A=j,B=R,P=q;let W,J,G,O,U,H,Q=A*A+B*B+P*P;Q>0&&(Q=1/Math.sqrt(Q)),E=A*Q,D=B*Q,N=P*Q,this.setNormal(t,E,D,N),W=a._positionX+E*-V,J=a._positionY+D*-V,G=a._positionZ+N*-V,O=o._positionX+w,U=o._positionY+L,H=o._positionZ+k,this.addPoint(t,W,J,G,O,U,H,V-F,0)}},a.collision.narrowphase.detector.SphereCapsuleDetector=class extends a.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,i,s,a,o,n){let e=s;t.incremental=!1;let r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z=e._halfHeight,M=i._radius,I=e._radius;r=o._rotation01,_=o._rotation11,l=o._rotation21,h=a._positionX,c=a._positionY,m=a._positionZ,b=o._positionX+r*-Z,p=o._positionY+_*-Z,x=o._positionZ+l*-Z,f=o._positionX+r*Z,u=o._positionY+_*Z,y=o._positionZ+l*Z,g=h-b,v=c-p,d=m-x,X=f-b,z=u-p,Y=y-x;let V,w,L,k,A,B,P=Z*Z*4,S=g*X+v*z+d*Y;S<0?S=0:S>P?S=1:S/=P,V=b+X*S,w=p+z*S,L=x+Y*S,k=h-V,A=c-w,B=m-L;let T=k*k+A*A+B*B;if(T>=(M+I)*(M+I))return;let C,j,R,q,E,D,N,F,W,J=Math.sqrt(T);J>0?(C=k*(1/J),j=A*(1/J),R=B*(1/J)):(C=1,j=0,R=0),this.setNormal(t,C,j,R),q=h+C*-M,E=c+j*-M,D=m+R*-M,N=V+C*I,F=w+j*I,W=L+R*I,this.addPoint(t,q,E,D,N,F,W,M+I-J,0)}},a.collision.narrowphase.detector.SphereSphereDetector=class extends a.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,s,a,o,n){let e,r,_;t.incremental=!1,e=a._positionX-o._positionX,r=a._positionY-o._positionY,_=a._positionZ-o._positionZ;let l=i._radius,h=s._radius,c=e*e+r*r+_*_;if(c>=(l+h)*(l+h))return;let m,b,p,x,f,u,y,g,v,d=Math.sqrt(c);d>0?(m=e*(1/d),b=r*(1/d),p=_*(1/d)):(m=1,b=0,p=0),this.setNormal(t,m,b,p),x=a._positionX+m*-l,f=a._positionY+b*-l,u=a._positionZ+p*-l,y=o._positionX+m*h,g=o._positionY+b*h,v=o._positionZ+p*h,this.addPoint(t,x,f,u,y,g,v,l+h-d,0)}},a.collision.narrowphase.detector.gjkepa||(a.collision.narrowphase.detector.gjkepa={}),a.collision.narrowphase.detector.gjkepa.EpaPolyhedron=class{constructor(){this._vertices=new Array(a.common.Setting.maxEPAVertices),this._center=new a.common.Vec3,this._numVertices=0,this._triangleList=null,this._triangleListLast=null,this._numTriangles=0,this._trianglePool=null,this._vertexPool=null}dumpHoleEdge(t){}validate(){let t=this._triangleList;for(;null!=t;){if(t._vertices[0]._tmpEdgeLoopOuterTriangle=null,t._vertices[0]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[0])return this._status=2,!1;if(null==t._adjacentTriangles[0])return this._status=3,!1;if(t._vertices[1]._tmpEdgeLoopOuterTriangle=null,t._vertices[1]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[1])return this._status=2,!1;if(null==t._adjacentTriangles[1])return this._status=3,!1;if(t._vertices[2]._tmpEdgeLoopOuterTriangle=null,t._vertices[2]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[2])return this._status=2,!1;if(null==t._adjacentTriangles[2])return this._status=3,!1;t=t._next}return!0}findEdgeLoop(t,i,s){if(i._tmpDfsId==t)return;i._tmpDfsId=t;let a=i.tmp;a.x=s.x,a.y=s.y,a.z=s.z;let o=i._vertices[0].v;a.x-=o.x,a.y-=o.y,a.z-=o.z;let n=i.tmp,e=i._normal;if(i._tmpDfsVisible=n.x*e.x+n.y*e.y+n.z*e.z>0,!i._tmpDfsVisible)return void(this._status=6);let r=0;for(;r<3;){let a=r++,o=i._adjacentTriangles[a];if(null==o)continue;let n=o.tmp;n.x=s.x,n.y=s.y,n.z=s.z;let e=o._vertices[0].v;n.x-=e.x,n.y-=e.y,n.z-=e.z;let _=o.tmp,l=o._normal;if(o._tmpDfsVisible=_.x*l.x+_.y*l.y+_.z*l.z>0,o._tmpDfsVisible)this.findEdgeLoop(t,o,s);else{let t=i._vertices[a];t._tmpEdgeLoopNext=i._vertices[i._nextIndex[a]],t._tmpEdgeLoopOuterTriangle=o}}let _=i._adjacentTriangles[0];if(null!=_){let t=i._adjacentPairIndex[0];_._adjacentTriangles[t]=null,_._adjacentPairIndex[t]=-1,i._adjacentTriangles[0]=null,i._adjacentPairIndex[0]=-1}let l=i._adjacentTriangles[1];if(null!=l){let t=i._adjacentPairIndex[1];l._adjacentTriangles[t]=null,l._adjacentPairIndex[t]=-1,i._adjacentTriangles[1]=null,i._adjacentPairIndex[1]=-1}let h=i._adjacentTriangles[2];if(null!=h){let t=i._adjacentPairIndex[2];h._adjacentTriangles[t]=null,h._adjacentPairIndex[t]=-1,i._adjacentTriangles[2]=null,i._adjacentPairIndex[2]=-1}this._numTriangles--;let c=i._prev,m=i._next;null!=c&&(c._next=m),null!=m&&(m._prev=c),i==this._triangleList&&(this._triangleList=this._triangleList._next),i==this._triangleListLast&&(this._triangleListLast=this._triangleListLast._prev),i._next=null,i._prev=null,i.removeReferences(),i._next=this._trianglePool,this._trianglePool=i}_init(t,i,s,o){this._status=0,this._numVertices=4,this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=s,this._vertices[3]=o;let n=this._center,e=t.v;n.x=e.x,n.y=e.y,n.z=e.z;let r=i.v;n.x+=r.x,n.y+=r.y,n.z+=r.z;let _=s.v;n.x+=_.x,n.y+=_.y,n.z+=_.z;let l=o.v;n.x+=l.x,n.y+=l.y,n.z+=l.z,n.x*=.25,n.y*=.25,n.z*=.25;let h=this._trianglePool;null!=h?(this._trianglePool=h._next,h._next=null):h=new a.collision.narrowphase.detector.gjkepa.EpaTriangle;let c=h,m=this._trianglePool;null!=m?(this._trianglePool=m._next,m._next=null):m=new a.collision.narrowphase.detector.gjkepa.EpaTriangle;let b=m,p=this._trianglePool;null!=p?(this._trianglePool=p._next,p._next=null):p=new a.collision.narrowphase.detector.gjkepa.EpaTriangle;let x=p,f=this._trianglePool;null!=f?(this._trianglePool=f._next,f._next=null):f=new a.collision.narrowphase.detector.gjkepa.EpaTriangle;let u=f;return c.init(t,i,s,this._center,!0)||(this._status=1),b.init(t,i,o,this._center,!0)||(this._status=1),x.init(t,s,o,this._center,!0)||(this._status=1),u.init(i,s,o,this._center,!0)||(this._status=1),c.setAdjacentTriangle(b)||(this._status=1),c.setAdjacentTriangle(x)||(this._status=1),c.setAdjacentTriangle(u)||(this._status=1),b.setAdjacentTriangle(x)||(this._status=1),b.setAdjacentTriangle(u)||(this._status=1),x.setAdjacentTriangle(u)||(this._status=1),this._numTriangles++,null==this._triangleList?(this._triangleList=c,this._triangleListLast=c):(this._triangleListLast._next=c,c._prev=this._triangleListLast,this._triangleListLast=c),this._numTriangles++,null==this._triangleList?(this._triangleList=b,this._triangleListLast=b):(this._triangleListLast._next=b,b._prev=this._triangleListLast,this._triangleListLast=b),this._numTriangles++,null==this._triangleList?(this._triangleList=x,this._triangleListLast=x):(this._triangleListLast._next=x,x._prev=this._triangleListLast,this._triangleListLast=x),this._numTriangles++,null==this._triangleList?(this._triangleList=u,this._triangleListLast=u):(this._triangleListLast._next=u,u._prev=this._triangleListLast,this._triangleListLast=u),0==this._status}_addVertex(t,i){this._vertices[this._numVertices++]=t;let s=i._vertices[0];if(this.findEdgeLoop(this._numVertices,i,t.v),0!=this._status)return!1;let o=s,n=null,e=null;for(;;){if(null==o._tmpEdgeLoopNext)return this._dumpAsObjModel(),this._status=4,!1;if(null==o._tmpEdgeLoopOuterTriangle)return this._status=5,!1;let i=this._trianglePool;null!=i?(this._trianglePool=i._next,i._next=null):i=new a.collision.narrowphase.detector.gjkepa.EpaTriangle;let r=i;if(null==e&&(e=r),r.init(o,o._tmpEdgeLoopNext,t,this._center,!1)||(this._status=1),0!=this._status)return!1;if(this._numTriangles++,null==this._triangleList?(this._triangleList=r,this._triangleListLast=r):(this._triangleListLast._next=r,r._prev=this._triangleListLast,this._triangleListLast=r),r.setAdjacentTriangle(o._tmpEdgeLoopOuterTriangle)||(this._status=1),null!=n&&(r.setAdjacentTriangle(n)||(this._status=1)),n=r,o=o._tmpEdgeLoopNext,o==s)break}return n.setAdjacentTriangle(e)||(this._status=1),0==this._status&&this.validate()}_dumpAsObjModel(){}},a.collision.narrowphase.detector.gjkepa.EpaPolyhedronState=class{},a.collision.narrowphase.detector.gjkepa.EpaTriangle=class{constructor(){this.id=++a.collision.narrowphase.detector.gjkepa.EpaTriangle.count,this._next=null,this._prev=null,this._normal=new a.common.Vec3,this._distanceSq=0,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._vertices=new Array(3),this._adjacentTriangles=new Array(3),this._adjacentPairIndex=new Array(3),this.tmp=new a.common.Vec3,this._nextIndex=new Array(3),this._nextIndex[0]=1,this._nextIndex[1]=2,this._nextIndex[2]=0}init(t,i,s,a,o){let n,e,r,_,l,h,c,m,b,p,x,f;null==o&&(o=!1);let u=t.v;n=u.x,e=u.y,r=u.z;let y=i.v;_=y.x,l=y.y,h=y.z;let g,v,d,X,z,Y,Z,M,I,V,w,L,k=s.v;c=k.x,m=k.y,b=k.z,p=a.x,x=a.y,f=a.z,g=_-n,v=l-e,d=h-r,X=c-n,z=m-e,Y=b-r,Z=n-p,M=e-x,I=r-f,V=v*Y-d*z,w=d*X-g*Y,L=g*z-v*X;let A=!1;if(Z*V+M*w+I*L<0)if(o){let t=i;i=s,s=t,V*=-1,w*=-1,L*=-1}else A=!0;this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=s;let B=this._normal;B.x=V,B.y=w,B.z=L;let P,S,T,C,j,R,q,E,D,N,F,W,J,G,O,U,H,Q,K,$,tt,it,st,at,ot,nt,et,rt,_t,lt,ht=t.v,ct=i.v,mt=s.v,bt=this.tmp;P=ht.x,S=ht.y,T=ht.z,C=ct.x,j=ct.y,R=ct.z,q=mt.x,E=mt.y,D=mt.z,N=C-P,F=j-S,W=R-T,J=q-C,G=E-j,O=D-R,U=P-q,H=S-E,Q=T-D,K=F*O-W*G,$=W*J-N*O,tt=N*G-F*J,it=F*tt-W*$,st=W*K-N*tt,at=N*$-F*K,ot=G*tt-O*$,nt=O*K-J*tt,et=J*$-G*K,rt=H*tt-Q*$,_t=Q*K-U*tt,lt=U*$-H*K;let pt,xt,ft,ut=-1;if(pt=0,xt=0,ft=0,P*it+S*st+T*at<0){let t,i,s,a,o,n,e,r,_;t=ht.x,i=ht.y,s=ht.z,a=ct.x,o=ct.y,n=ct.z,e=a-t,r=o-i,_=n-s;let l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)bt.x=t,bt.y=i,bt.z=s;else if(l>1)bt.x=a,bt.y=o,bt.z=n;else{let a,o,n;a=t+e*l,o=i+r*l,n=s+_*l,bt.x=a,bt.y=o,bt.z=n}ut=bt.x*bt.x+bt.y*bt.y+bt.z*bt.z,pt=bt.x,xt=bt.y,ft=bt.z}if(C*ot+j*nt+R*et<0){let t,i,s,a,o,n,e,r,_;t=ct.x,i=ct.y,s=ct.z,a=mt.x,o=mt.y,n=mt.z,e=a-t,r=o-i,_=n-s;let l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)bt.x=t,bt.y=i,bt.z=s;else if(l>1)bt.x=a,bt.y=o,bt.z=n;else{let a,o,n;a=t+e*l,o=i+r*l,n=s+_*l,bt.x=a,bt.y=o,bt.z=n}let h=bt.x*bt.x+bt.y*bt.y+bt.z*bt.z;(ut<0||h<ut)&&(ut=h,pt=bt.x,xt=bt.y,ft=bt.z)}if(q*rt+E*_t+D*lt<0){let t,i,s,a,o,n,e,r,_;t=ht.x,i=ht.y,s=ht.z,a=mt.x,o=mt.y,n=mt.z,e=a-t,r=o-i,_=n-s;let l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)bt.x=t,bt.y=i,bt.z=s;else if(l>1)bt.x=a,bt.y=o,bt.z=n;else{let a,o,n;a=t+e*l,o=i+r*l,n=s+_*l,bt.x=a,bt.y=o,bt.z=n}let h=bt.x*bt.x+bt.y*bt.y+bt.z*bt.z;(ut<0||h<ut)&&(ut=h,pt=bt.x,xt=bt.y,ft=bt.z)}if(ut>0)bt.x=pt,bt.y=xt,bt.z=ft;else{let t=K*K+$*$+tt*tt;t>0&&(t=1/Math.sqrt(t)),K*=t,$*=t,tt*=t;let i=K*K+$*$+tt*tt;i=(P*K+S*$+T*tt)/i,pt=K*i,xt=$*i,ft=tt*i,bt.x=pt,bt.y=xt,bt.z=ft}let yt=this.tmp;return this._distanceSq=yt.x*yt.x+yt.y*yt.y+yt.z*yt.z,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=-1,this._adjacentPairIndex[1]=-1,this._adjacentPairIndex[2]=-1,!A}setAdjacentTriangle(t){let i=0;return this._vertices[0]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[0]]==t._vertices[0]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=0,i=1),this._vertices[0]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[0]]==t._vertices[1]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=0,++i),this._vertices[0]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[0]]==t._vertices[2]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=0,++i),this._vertices[1]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[1]]==t._vertices[0]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=1,++i),this._vertices[1]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[1]]==t._vertices[1]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=1,++i),this._vertices[1]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[1]]==t._vertices[2]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=1,++i),this._vertices[2]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[2]]==t._vertices[0]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=2,++i),this._vertices[2]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[2]]==t._vertices[1]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=2,++i),this._vertices[2]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[2]]==t._vertices[2]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=2,++i),1==i}removeAdjacentTriangles(){let t=this._adjacentTriangles[0];if(null!=t){let i=this._adjacentPairIndex[0];t._adjacentTriangles[i]=null,t._adjacentPairIndex[i]=-1,this._adjacentTriangles[0]=null,this._adjacentPairIndex[0]=-1}let i=this._adjacentTriangles[1];if(null!=i){let t=this._adjacentPairIndex[1];i._adjacentTriangles[t]=null,i._adjacentPairIndex[t]=-1,this._adjacentTriangles[1]=null,this._adjacentPairIndex[1]=-1}let s=this._adjacentTriangles[2];if(null!=s){let t=this._adjacentPairIndex[2];s._adjacentTriangles[t]=null,s._adjacentPairIndex[t]=-1,this._adjacentTriangles[2]=null,this._adjacentPairIndex[2]=-1}}removeReferences(){this._next=null,this._prev=null,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._distanceSq=0,this._vertices[0]=null,this._vertices[1]=null,this._vertices[2]=null,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=0,this._adjacentPairIndex[1]=0,this._adjacentPairIndex[2]=0}dump(){}},a.collision.narrowphase.detector.gjkepa.EpaVertex=class{constructor(){this.randId=1e5*Math.random()|0,this.v=new a.common.Vec3,this.w1=new a.common.Vec3,this.w2=new a.common.Vec3}init(t,i,s){let a=this.v;a.x=t.x,a.y=t.y,a.z=t.z;let o=this.w1;o.x=i.x,o.y=i.y,o.z=i.z;let n=this.w2;return n.x=s.x,n.y=s.y,n.z=s.z,this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null,this}removeReferences(){this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null}},a.collision.narrowphase.detector.gjkepa.GjkCache=class{constructor(){this.prevClosestDir=new a.common.Vec3}clear(){this.prevClosestDir.zero()}},a.common||(a.common={}),a.common.Vec3=class{constructor(t,i,s){null==s&&(s=0),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.z=s,a.common.Vec3.numCreations++}init(t,i,s){return this.x=t,this.y=i,this.z=s,this}zero(){return this.x=0,this.y=0,this.z=0,this}add(t){return new a.common.Vec3(this.x+t.x,this.y+t.y,this.z+t.z)}add3(t,i,s){return new a.common.Vec3(this.x+t,this.y+i,this.z+s)}addScaled(t,i){return new a.common.Vec3(this.x+t.x*i,this.y+t.y*i,this.z+t.z*i)}sub(t){return new a.common.Vec3(this.x-t.x,this.y-t.y,this.z-t.z)}sub3(t,i,s){return new a.common.Vec3(this.x-t,this.y-i,this.z-s)}scale(t){return new a.common.Vec3(this.x*t,this.y*t,this.z*t)}scale3(t,i,s){return new a.common.Vec3(this.x*t,this.y*i,this.z*s)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new a.common.Vec3(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}addEq(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}add3Eq(t,i,s){return this.x+=t,this.y+=i,this.z+=s,this}addScaledEq(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}subEq(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}sub3Eq(t,i,s){return this.x-=t,this.y-=i,this.z-=s,this}scaleEq(t){return this.x*=t,this.y*=t,this.z*=t,this}scale3Eq(t,i,s){return this.x*=t,this.y*=i,this.z*=s,this}crossEq(t){let i=this.z*t.x-this.x*t.z,s=this.x*t.y-this.y*t.x;return this.x=this.y*t.z-this.z*t.y,this.y=i,this.z=s,this}mulMat3(t){return new a.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02,this.x*t.e10+this.y*t.e11+this.z*t.e12,this.x*t.e20+this.y*t.e21+this.z*t.e22)}mulMat4(t){return new a.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23)}mulTransform(t){let i,s,o,n,e,r;i=this.x,s=this.y,o=this.z,n=t._rotation00*i+t._rotation01*s+t._rotation02*o,e=t._rotation10*i+t._rotation11*s+t._rotation12*o,r=t._rotation20*i+t._rotation21*s+t._rotation22*o,i=n,s=e,o=r,i+=t._positionX,s+=t._positionY,o+=t._positionZ;let _=new a.common.Vec3;return _.x=i,_.y=s,_.z=o,_}mulMat3Eq(t){let i=this.x*t.e10+this.y*t.e11+this.z*t.e12,s=this.x*t.e20+this.y*t.e21+this.z*t.e22;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02,this.y=i,this.z=s,this}mulMat4Eq(t){let i=this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,s=this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.y=i,this.z=s,this}mulTransformEq(t){let i,s,a,o,n,e;return i=this.x,s=this.y,a=this.z,o=t._rotation00*i+t._rotation01*s+t._rotation02*a,n=t._rotation10*i+t._rotation11*s+t._rotation12*a,e=t._rotation20*i+t._rotation21*s+t._rotation22*a,i=o,s=n,a=e,i+=t._positionX,s+=t._positionY,a+=t._positionZ,this.x=i,this.y=s,this.z=a,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalized(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),new a.common.Vec3(this.x*t,this.y*t,this.z*t)}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),this.x*=t,this.y*=t,this.z*=t,this}negate(){return new a.common.Vec3(-this.x,-this.y,-this.z)}negateEq(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}clone(){return new a.common.Vec3(this.x,this.y,this.z)}toString(){return"Vec3["+(this.x>0?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+", "+(this.y>0?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+", "+(this.z>0?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+"]"}},a.common.Transform=class{constructor(){this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1}identity(){return this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1,this}getPosition(){let t=new a.common.Vec3;return t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ,t}getPositionTo(t){t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ}setPosition(t){return this._positionX=t.x,this._positionY=t.y,this._positionZ=t.z,this}translate(t){let i,s,a;i=t.x,s=t.y,a=t.z,this._positionX+=i,this._positionY+=s,this._positionZ+=a}getRotation(){let t=new a.common.Mat3;return t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22,t}getRotationTo(t){t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22}setRotation(t){return this._rotation00=t.e00,this._rotation01=t.e01,this._rotation02=t.e02,this._rotation10=t.e10,this._rotation11=t.e11,this._rotation12=t.e12,this._rotation20=t.e20,this._rotation21=t.e21,this._rotation22=t.e22,this}setRotationXyz(t){let i,s,a;i=t.x,s=t.y,a=t.z;let o=Math.sin(i),n=Math.sin(s),e=Math.sin(a),r=Math.cos(i),_=Math.cos(s),l=Math.cos(a);this._rotation00=_*l,this._rotation01=-_*e,this._rotation02=n,this._rotation10=r*e+l*o*n,this._rotation11=r*l-o*n*e,this._rotation12=-_*o,this._rotation20=o*e-r*l*n,this._rotation21=l*o+r*n*e,this._rotation22=r*_}rotate(t){let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y;i=t.e00,s=t.e01,a=t.e02,o=t.e10,n=t.e11,e=t.e12,r=t.e20,_=t.e21,l=t.e22,h=i*this._rotation00+s*this._rotation10+a*this._rotation20,c=i*this._rotation01+s*this._rotation11+a*this._rotation21,m=i*this._rotation02+s*this._rotation12+a*this._rotation22,b=o*this._rotation00+n*this._rotation10+e*this._rotation20,p=o*this._rotation01+n*this._rotation11+e*this._rotation21,x=o*this._rotation02+n*this._rotation12+e*this._rotation22,f=r*this._rotation00+_*this._rotation10+l*this._rotation20,u=r*this._rotation01+_*this._rotation11+l*this._rotation21,y=r*this._rotation02+_*this._rotation12+l*this._rotation22,this._rotation00=h,this._rotation01=c,this._rotation02=m,this._rotation10=b,this._rotation11=p,this._rotation12=x,this._rotation20=f,this._rotation21=u,this._rotation22=y}rotateXyz(t){let i,s,a,o,n,e,r,_,l,h,c,m;i=t.x,s=t.y,a=t.z;let b,p,x,f,u,y,g,v,d,X=Math.sin(i),z=Math.sin(s),Y=Math.sin(a),Z=Math.cos(i),M=Math.cos(s),I=Math.cos(a);o=M*I,n=-M*Y,e=z,r=Z*Y+I*X*z,_=Z*I-X*z*Y,l=-M*X,h=X*Y-Z*I*z,c=I*X+Z*z*Y,m=Z*M,b=o*this._rotation00+n*this._rotation10+e*this._rotation20,p=o*this._rotation01+n*this._rotation11+e*this._rotation21,x=o*this._rotation02+n*this._rotation12+e*this._rotation22,f=r*this._rotation00+_*this._rotation10+l*this._rotation20,u=r*this._rotation01+_*this._rotation11+l*this._rotation21,y=r*this._rotation02+_*this._rotation12+l*this._rotation22,g=h*this._rotation00+c*this._rotation10+m*this._rotation20,v=h*this._rotation01+c*this._rotation11+m*this._rotation21,d=h*this._rotation02+c*this._rotation12+m*this._rotation22,this._rotation00=b,this._rotation01=p,this._rotation02=x,this._rotation10=f,this._rotation11=u,this._rotation12=y,this._rotation20=g,this._rotation21=v,this._rotation22=d}getOrientation(){let t,i,s,o,n,e=new a.common.Quat,r=this._rotation00,_=this._rotation11,l=this._rotation22,h=r+_+l;return h>0?(n=Math.sqrt(h+1),o=.5*n,n=.5/n,t=(this._rotation21-this._rotation12)*n,i=(this._rotation02-this._rotation20)*n,s=(this._rotation10-this._rotation01)*n):r>_?r>l?(n=Math.sqrt(r-_-l+1),t=.5*n,n=.5/n,i=(this._rotation01+this._rotation10)*n,s=(this._rotation02+this._rotation20)*n,o=(this._rotation21-this._rotation12)*n):(n=Math.sqrt(l-r-_+1),s=.5*n,n=.5/n,t=(this._rotation02+this._rotation20)*n,i=(this._rotation12+this._rotation21)*n,o=(this._rotation10-this._rotation01)*n):_>l?(n=Math.sqrt(_-l-r+1),i=.5*n,n=.5/n,t=(this._rotation01+this._rotation10)*n,s=(this._rotation12+this._rotation21)*n,o=(this._rotation02-this._rotation20)*n):(n=Math.sqrt(l-r-_+1),s=.5*n,n=.5/n,t=(this._rotation02+this._rotation20)*n,i=(this._rotation12+this._rotation21)*n,o=(this._rotation10-this._rotation01)*n),e.x=t,e.y=i,e.z=s,e.w=o,e}getOrientationTo(t){let i,s,a,o,n,e=this._rotation00,r=this._rotation11,_=this._rotation22,l=e+r+_;l>0?(n=Math.sqrt(l+1),o=.5*n,n=.5/n,i=(this._rotation21-this._rotation12)*n,s=(this._rotation02-this._rotation20)*n,a=(this._rotation10-this._rotation01)*n):e>r?e>_?(n=Math.sqrt(e-r-_+1),i=.5*n,n=.5/n,s=(this._rotation01+this._rotation10)*n,a=(this._rotation02+this._rotation20)*n,o=(this._rotation21-this._rotation12)*n):(n=Math.sqrt(_-e-r+1),a=.5*n,n=.5/n,i=(this._rotation02+this._rotation20)*n,s=(this._rotation12+this._rotation21)*n,o=(this._rotation10-this._rotation01)*n):r>_?(n=Math.sqrt(r-_-e+1),s=.5*n,n=.5/n,i=(this._rotation01+this._rotation10)*n,a=(this._rotation12+this._rotation21)*n,o=(this._rotation02-this._rotation20)*n):(n=Math.sqrt(_-e-r+1),a=.5*n,n=.5/n,i=(this._rotation02+this._rotation20)*n,s=(this._rotation12+this._rotation21)*n,o=(this._rotation10-this._rotation01)*n),t.x=i,t.y=s,t.z=a,t.w=o}setOrientation(t){let i,s,a,o;i=t.x,s=t.y,a=t.z,o=t.w;let n=2*i,e=2*s,r=2*a,_=i*n,l=s*e,h=a*r,c=i*e,m=s*r,b=i*r,p=o*n,x=o*e,f=o*r;return this._rotation00=1-l-h,this._rotation01=c-f,this._rotation02=b+x,this._rotation10=c+f,this._rotation11=1-_-h,this._rotation12=m-p,this._rotation20=b-x,this._rotation21=m+p,this._rotation22=1-_-l,this}clone(){let t=new a.common.Transform;return t._positionX=this._positionX,t._positionY=this._positionY,t._positionZ=this._positionZ,t._rotation00=this._rotation00,t._rotation01=this._rotation01,t._rotation02=this._rotation02,t._rotation10=this._rotation10,t._rotation11=this._rotation11,t._rotation12=this._rotation12,t._rotation20=this._rotation20,t._rotation21=this._rotation21,t._rotation22=this._rotation22,t}copyFrom(t){return this._positionX=t._positionX,this._positionY=t._positionY,this._positionZ=t._positionZ,this._rotation00=t._rotation00,this._rotation01=t._rotation01,this._rotation02=t._rotation02,this._rotation10=t._rotation10,this._rotation11=t._rotation11,this._rotation12=t._rotation12,this._rotation20=t._rotation20,this._rotation21=t._rotation21,this._rotation22=t._rotation22,this}},a.common.Setting=class{},a.collision.narrowphase.detector.gjkepa.GjkEpa=class{constructor(){this.s=new Array(4),this.w1=new Array(4),this.w2=new Array(4),this.baseDirs=new Array(3),this.baseDirs[0]=new a.common.Vec3(1,0,0),this.baseDirs[1]=new a.common.Vec3(0,1,0),this.baseDirs[2]=new a.common.Vec3(0,0,1),this.tl1=new a.common.Vec3,this.tl2=new a.common.Vec3,this.rayX=new a.common.Vec3,this.rayR=new a.common.Vec3,this.tempTransform=new a.common.Transform,this.s[0]=new a.common.Vec3,this.w1[0]=new a.common.Vec3,this.w2[0]=new a.common.Vec3,this.s[1]=new a.common.Vec3,this.w1[1]=new a.common.Vec3,this.w2[1]=new a.common.Vec3,this.s[2]=new a.common.Vec3,this.w1[2]=new a.common.Vec3,this.w2[2]=new a.common.Vec3,this.s[3]=new a.common.Vec3,this.w1[3]=new a.common.Vec3,this.w2[3]=new a.common.Vec3,this.dir=new a.common.Vec3,this.closest=new a.common.Vec3,this.closestPoint1=new a.common.Vec3,this.closestPoint2=new a.common.Vec3,this.polyhedron=new a.collision.narrowphase.detector.gjkepa.EpaPolyhedron}computeClosestPointsImpl(t,i,s,o,n,e){this.c1=t,this.c2=i,this.tf1=s,this.tf2=o;let r=this.s,_=this.w1,l=this.w2,h=this.closest,c=this.dir;if(null!=n?(null==n._gjkCache&&(n._gjkCache=new a.collision.narrowphase.detector.gjkepa.GjkCache),this.loadCache(n._gjkCache)):c.zero(),c.x*c.x+c.y*c.y+c.z*c.z==0){let t,i,a;t=o._positionX-s._positionX,i=o._positionY-s._positionY,a=o._positionZ-s._positionZ,c.x=t,c.y=i,c.z=a,c.x*c.x+c.y*c.y+c.z*c.z<1e-6&&c.init(1,0,0)}this.simplexSize=0,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let m=this.s[this.simplexSize],b=this.w1[this.simplexSize];m.x=b.x,m.y=b.y,m.z=b.z;let p=this.w2[this.simplexSize];m.x-=p.x,m.y-=p.y,m.z-=p.z,this.simplexSize=1;let x=0;for(;x<40;){let a=0;switch(this.simplexSize){case 1:let t=r[0];h.x=t.x,h.y=t.y,h.z=t.z,a=1;break;case 2:let i,s,o,n,e,_,l=r[0];i=l.x,s=l.y,o=l.z;let c,m,b,p=r[1];n=p.x,e=p.y,_=p.z,c=n-i,m=e-s,b=_-o;let x=c*i+m*s+b*o;if(x=-x/(c*c+m*m+b*b),x<0)h.x=i,h.y=s,h.z=o,a=1;else if(x>1)h.x=n,h.y=e,h.z=_,a=2;else{let t,n,e;t=i+c*x,n=s+m*x,e=o+b*x,h.x=t,h.y=n,h.z=e,a=3}break;case 3:let f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,q,E,D,N,F,W,J=r[0],G=r[1],O=r[2];f=J.x,u=J.y,y=J.z,g=G.x,v=G.y,d=G.z,X=O.x,z=O.y,Y=O.z,Z=g-f,M=v-u,I=d-y,V=X-g,w=z-v,L=Y-d,k=f-X,A=u-z,B=y-Y,P=M*L-I*w,S=I*V-Z*L,T=Z*w-M*V,C=M*T-I*S,j=I*P-Z*T,R=Z*S-M*P,q=w*T-L*S,E=L*P-V*T,D=V*S-w*P,N=A*T-B*S,F=B*P-k*T,W=k*S-A*P;let U,H,Q,K=-1,$=0;if(U=0,H=0,Q=0,f*C+u*j+y*R<0){let t,i,s,a,o,n,e,r,_;t=J.x,i=J.y,s=J.z,a=G.x,o=G.y,n=G.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}$=l,K=h.x*h.x+h.y*h.y+h.z*h.z,U=h.x,H=h.y,Q=h.z}if(g*q+v*E+d*D<0){let t,i,s,a,o,n,e,r,_;t=G.x,i=G.y,s=G.z,a=O.x,o=O.y,n=O.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(K<0||m<K)&&($=l<<1,K=m,U=h.x,H=h.y,Q=h.z)}if(X*N+z*F+Y*W<0){let t,i,s,a,o,n,e,r,_;t=J.x,i=J.y,s=J.z,a=O.x,o=O.y,n=O.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(K<0||m<K)&&($=1&l|(2&l)<<1,K=m,U=h.x,H=h.y,Q=h.z)}if(K>0)h.x=U,h.y=H,h.z=Q,a=$;else{let t=P*P+S*S+T*T;t>0&&(t=1/Math.sqrt(t)),P*=t,S*=t,T*=t;let i=P*P+S*S+T*T;i=(f*P+u*S+y*T)/i,U=P*i,H=S*i,Q=T*i,h.x=U,h.y=H,h.z=Q,a=7}break;case 4:let tt,it,st,at,ot,nt,et,rt,_t,lt,ht,ct,mt,bt,pt,xt,ft,ut,yt,gt,vt,dt,Xt,zt,Yt,Zt,Mt,It,Vt,wt,Lt,kt,At,Bt,Pt,St,Tt,Ct,jt,Rt=r[0],qt=r[1],Et=r[2],Dt=r[3];tt=Rt.x,it=Rt.y,st=Rt.z,at=qt.x,ot=qt.y,nt=qt.z,et=Et.x,rt=Et.y,_t=Et.z,lt=Dt.x,ht=Dt.y,ct=Dt.z,mt=at-tt,bt=ot-it,pt=nt-st,xt=et-tt,ft=rt-it,ut=_t-st,yt=lt-tt,gt=ht-it,vt=ct-st,dt=et-at,Xt=rt-ot,zt=_t-nt,Yt=lt-at,Zt=ht-ot,Mt=ct-nt,It=bt*ut-pt*ft,Vt=pt*xt-mt*ut,wt=mt*ft-bt*xt,Lt=ft*vt-ut*gt,kt=ut*yt-xt*vt,At=xt*gt-ft*yt,Bt=gt*pt-vt*bt,Pt=vt*mt-yt*pt,St=yt*bt-gt*mt,Tt=Zt*zt-Mt*Xt,Ct=Mt*dt-Yt*zt,jt=Yt*Xt-Zt*dt;let Nt,Ft,Wt,Jt=mt*Tt+bt*Ct+pt*jt>0?1:-1,Gt=-1,Ot=0;if(Nt=0,Ft=0,Wt=0,(tt*It+it*Vt+st*wt)*Jt<0){let t,i,s,a,o,n,e,r,_,l,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L;t=Rt.x,i=Rt.y,s=Rt.z,a=qt.x,o=qt.y,n=qt.z,e=Et.x,r=Et.y,_=Et.z,l=a-t,c=o-i,m=n-s,b=e-a,p=r-o,x=_-n,f=t-e,u=i-r,y=s-_,g=c*x-m*p,v=m*b-l*x,d=l*p-c*b,X=c*d-m*v,z=m*g-l*d,Y=l*v-c*g,Z=p*d-x*v,M=x*g-b*d,I=b*v-p*g,V=u*d-y*v,w=y*g-f*d,L=f*v-u*g;let k,A,B,P,S=-1,T=0;if(k=0,A=0,B=0,t*X+i*z+s*Y<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=qt.x,o=qt.y,n=qt.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}T=l,S=h.x*h.x+h.y*h.y+h.z*h.z,k=h.x,A=h.y,B=h.z}if(a*Z+o*M+n*I<0){let t,i,s,a,o,n,e,r,_;t=qt.x,i=qt.y,s=qt.z,a=Et.x,o=Et.y,n=Et.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(S<0||m<S)&&(T=l<<1,S=m,k=h.x,A=h.y,B=h.z)}if(e*V+r*w+_*L<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=Et.x,o=Et.y,n=Et.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=h.x,A=h.y,B=h.z)}if(S>0)h.x=k,h.y=A,h.z=B,P=T;else{let a=g*g+v*v+d*d;a>0&&(a=1/Math.sqrt(a)),g*=a,v*=a,d*=a;let o=g*g+v*v+d*d;o=(t*g+i*v+s*d)/o,k=g*o,A=v*o,B=d*o,h.x=k,h.y=A,h.z=B,P=7}Ot=P,Gt=h.x*h.x+h.y*h.y+h.z*h.z,Nt=h.x,Ft=h.y,Wt=h.z}if((tt*Lt+it*kt+st*At)*Jt<0){let t,i,s,a,o,n,e,r,_,l,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L;t=Rt.x,i=Rt.y,s=Rt.z,a=Et.x,o=Et.y,n=Et.z,e=Dt.x,r=Dt.y,_=Dt.z,l=a-t,c=o-i,m=n-s,b=e-a,p=r-o,x=_-n,f=t-e,u=i-r,y=s-_,g=c*x-m*p,v=m*b-l*x,d=l*p-c*b,X=c*d-m*v,z=m*g-l*d,Y=l*v-c*g,Z=p*d-x*v,M=x*g-b*d,I=b*v-p*g,V=u*d-y*v,w=y*g-f*d,L=f*v-u*g;let k,A,B,P,S=-1,T=0;if(k=0,A=0,B=0,t*X+i*z+s*Y<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=Et.x,o=Et.y,n=Et.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}T=l,S=h.x*h.x+h.y*h.y+h.z*h.z,k=h.x,A=h.y,B=h.z}if(a*Z+o*M+n*I<0){let t,i,s,a,o,n,e,r,_;t=Et.x,i=Et.y,s=Et.z,a=Dt.x,o=Dt.y,n=Dt.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(S<0||m<S)&&(T=l<<1,S=m,k=h.x,A=h.y,B=h.z)}if(e*V+r*w+_*L<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=Dt.x,o=Dt.y,n=Dt.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=h.x,A=h.y,B=h.z)}if(S>0)h.x=k,h.y=A,h.z=B,P=T;else{let a=g*g+v*v+d*d;a>0&&(a=1/Math.sqrt(a)),g*=a,v*=a,d*=a;let o=g*g+v*v+d*d;o=(t*g+i*v+s*d)/o,k=g*o,A=v*o,B=d*o,h.x=k,h.y=A,h.z=B,P=7}let C=h.x*h.x+h.y*h.y+h.z*h.z;(Gt<0||C<Gt)&&(Ot=1&P|(6&P)<<1,Gt=C,Nt=h.x,Ft=h.y,Wt=h.z)}if((tt*Bt+it*Pt+st*St)*Jt<0){let t,i,s,a,o,n,e,r,_,l,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L;t=Rt.x,i=Rt.y,s=Rt.z,a=qt.x,o=qt.y,n=qt.z,e=Dt.x,r=Dt.y,_=Dt.z,l=a-t,c=o-i,m=n-s,b=e-a,p=r-o,x=_-n,f=t-e,u=i-r,y=s-_,g=c*x-m*p,v=m*b-l*x,d=l*p-c*b,X=c*d-m*v,z=m*g-l*d,Y=l*v-c*g,Z=p*d-x*v,M=x*g-b*d,I=b*v-p*g,V=u*d-y*v,w=y*g-f*d,L=f*v-u*g;let k,A,B,P,S=-1,T=0;if(k=0,A=0,B=0,t*X+i*z+s*Y<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=qt.x,o=qt.y,n=qt.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}T=l,S=h.x*h.x+h.y*h.y+h.z*h.z,k=h.x,A=h.y,B=h.z}if(a*Z+o*M+n*I<0){let t,i,s,a,o,n,e,r,_;t=qt.x,i=qt.y,s=qt.z,a=Dt.x,o=Dt.y,n=Dt.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(S<0||m<S)&&(T=l<<1,S=m,k=h.x,A=h.y,B=h.z)}if(e*V+r*w+_*L<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=Dt.x,o=Dt.y,n=Dt.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=h.x,A=h.y,B=h.z)}if(S>0)h.x=k,h.y=A,h.z=B,P=T;else{let a=g*g+v*v+d*d;a>0&&(a=1/Math.sqrt(a)),g*=a,v*=a,d*=a;let o=g*g+v*v+d*d;o=(t*g+i*v+s*d)/o,k=g*o,A=v*o,B=d*o,h.x=k,h.y=A,h.z=B,P=7}let C=h.x*h.x+h.y*h.y+h.z*h.z;(Gt<0||C<Gt)&&(Ot=3&P|(4&P)<<1,Gt=C,Nt=h.x,Ft=h.y,Wt=h.z)}if((at*Tt+ot*Ct+nt*jt)*Jt<0){let t,i,s,a,o,n,e,r,_,l,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L;t=qt.x,i=qt.y,s=qt.z,a=Et.x,o=Et.y,n=Et.z,e=Dt.x,r=Dt.y,_=Dt.z,l=a-t,c=o-i,m=n-s,b=e-a,p=r-o,x=_-n,f=t-e,u=i-r,y=s-_,g=c*x-m*p,v=m*b-l*x,d=l*p-c*b,X=c*d-m*v,z=m*g-l*d,Y=l*v-c*g,Z=p*d-x*v,M=x*g-b*d,I=b*v-p*g,V=u*d-y*v,w=y*g-f*d,L=f*v-u*g;let k,A,B,P,S=-1,T=0;if(k=0,A=0,B=0,t*X+i*z+s*Y<0){let t,i,s,a,o,n,e,r,_;t=qt.x,i=qt.y,s=qt.z,a=Et.x,o=Et.y,n=Et.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}T=l,S=h.x*h.x+h.y*h.y+h.z*h.z,k=h.x,A=h.y,B=h.z}if(a*Z+o*M+n*I<0){let t,i,s,a,o,n,e,r,_;t=Et.x,i=Et.y,s=Et.z,a=Dt.x,o=Dt.y,n=Dt.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(S<0||m<S)&&(T=l<<1,S=m,k=h.x,A=h.y,B=h.z)}if(e*V+r*w+_*L<0){let t,i,s,a,o,n,e,r,_;t=qt.x,i=qt.y,s=qt.z,a=Dt.x,o=Dt.y,n=Dt.z,e=a-t,r=o-i,_=n-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=a,h.y=o,h.z=n,l=2;else{let a,o,n;a=t+e*c,o=i+r*c,n=s+_*c,h.x=a,h.y=o,h.z=n,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=h.x,A=h.y,B=h.z)}if(S>0)h.x=k,h.y=A,h.z=B,P=T;else{let a=g*g+v*v+d*d;a>0&&(a=1/Math.sqrt(a)),g*=a,v*=a,d*=a;let o=g*g+v*v+d*d;o=(t*g+i*v+s*d)/o,k=g*o,A=v*o,B=d*o,h.x=k,h.y=A,h.z=B,P=7}let C=h.x*h.x+h.y*h.y+h.z*h.z;(Gt<0||C<Gt)&&(Ot=P<<1,Gt=C,Nt=h.x,Ft=h.y,Wt=h.z)}Gt>0?(h.x=Nt,h.y=Ft,h.z=Wt,a=Ot):(h.zero(),a=15)}if(h.x*h.x+h.y*h.y+h.z*h.z<1e-8){if(!e)return this.distance=0,0;switch(this.simplexSize){case 1:this.pointToTetrahedron();break;case 2:this.lineToTetrahedron();break;case 3:this.triangleToTetrahedron()}if(4==this.simplexSize){let a=this.computeDepth(t,i,s,o,r,_,l);return 0!=a?(this.distance=0,a):(this.distance=-this.depth,0)}return this.distance=0,1}this.shrinkSimplex(a),c.x=h.x,c.y=h.y,c.z=h.z,c.x=-c.x,c.y=-c.y,c.z=-c.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let m=this.s[this.simplexSize],b=this.w1[this.simplexSize];m.x=b.x,m.y=b.y,m.z=b.z;let p=this.w2[this.simplexSize];if(m.x-=p.x,m.y-=p.y,m.z-=p.z,c.x*c.x+c.y*c.y+c.z*c.z<1e-8)throw new Error("!?");let f=r[this.simplexSize];if(f.x*c.x+f.y*c.y+f.z*c.z-(h.x*c.x+h.y*c.y+h.z*c.z)<1e-8)return this.interpolateClosestPoints(),this.distance=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z),null!=n&&null!=n._gjkCache&&this.saveCache(n._gjkCache),0;this.simplexSize++,++x}return 2}convexCastImpl(t,i,s,a,o,n,e){this.c1=t,this.c2=i,this.tf1=s,this.tf2=a;let r,_,l,h=this.s,c=this.closest,m=this.dir;if(r=a._positionX-s._positionX,_=a._positionY-s._positionY,l=a._positionZ-s._positionZ,m.x=r,m.y=_,m.z=l,m.x*m.x+m.y*m.y+m.z*m.z<1e-6&&m.init(1,0,0),this.simplexSize=0,null!=this.c1)this.computeWitnessPoint1(!0);else{let t=this.w1[this.simplexSize];t.x=this.tf1._positionX,t.y=this.tf1._positionY,t.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);let b=this.s[this.simplexSize],p=this.w1[this.simplexSize];b.x=p.x,b.y=p.y,b.z=p.z;let x=this.w2[this.simplexSize];b.x-=x.x,b.y-=x.y,b.z-=x.z,this.simplexSize=1;let f=0,u=0,y=this.rayX,g=this.rayR;for(y.zero(),g.x=n.x,g.y=n.y,g.z=n.z,g.x-=o.x,g.y-=o.y,g.z-=o.z;f<40;){let t=0;switch(this.simplexSize){case 1:let i=h[0];c.x=i.x,c.y=i.y,c.z=i.z,t=1;break;case 2:let s,a,o,n,e,r,_=h[0];s=_.x,a=_.y,o=_.z;let l,m,b,p=h[1];n=p.x,e=p.y,r=p.z,l=n-s,m=e-a,b=r-o;let x=l*s+m*a+b*o;if(x=-x/(l*l+m*m+b*b),x<0)c.x=s,c.y=a,c.z=o,t=1;else if(x>1)c.x=n,c.y=e,c.z=r,t=2;else{let i,n,e;i=s+l*x,n=a+m*x,e=o+b*x,c.x=i,c.y=n,c.z=e,t=3}break;case 3:let f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,q,E,D,N,F,W,J=h[0],G=h[1],O=h[2];f=J.x,u=J.y,y=J.z,g=G.x,v=G.y,d=G.z,X=O.x,z=O.y,Y=O.z,Z=g-f,M=v-u,I=d-y,V=X-g,w=z-v,L=Y-d,k=f-X,A=u-z,B=y-Y,P=M*L-I*w,S=I*V-Z*L,T=Z*w-M*V,C=M*T-I*S,j=I*P-Z*T,R=Z*S-M*P,q=w*T-L*S,E=L*P-V*T,D=V*S-w*P,N=A*T-B*S,F=B*P-k*T,W=k*S-A*P;let U,H,Q,K=-1,$=0;if(U=0,H=0,Q=0,f*C+u*j+y*R<0){let t,i,s,a,o,n,e,r,_;t=J.x,i=J.y,s=J.z,a=G.x,o=G.y,n=G.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}$=l,K=c.x*c.x+c.y*c.y+c.z*c.z,U=c.x,H=c.y,Q=c.z}if(g*q+v*E+d*D<0){let t,i,s,a,o,n,e,r,_;t=G.x,i=G.y,s=G.z,a=O.x,o=O.y,n=O.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(K<0||m<K)&&($=l<<1,K=m,U=c.x,H=c.y,Q=c.z)}if(X*N+z*F+Y*W<0){let t,i,s,a,o,n,e,r,_;t=J.x,i=J.y,s=J.z,a=O.x,o=O.y,n=O.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(K<0||m<K)&&($=1&l|(2&l)<<1,K=m,U=c.x,H=c.y,Q=c.z)}if(K>0)c.x=U,c.y=H,c.z=Q,t=$;else{let i=P*P+S*S+T*T;i>0&&(i=1/Math.sqrt(i)),P*=i,S*=i,T*=i;let s=P*P+S*S+T*T;s=(f*P+u*S+y*T)/s,U=P*s,H=S*s,Q=T*s,c.x=U,c.y=H,c.z=Q,t=7}break;case 4:let tt,it,st,at,ot,nt,et,rt,_t,lt,ht,ct,mt,bt,pt,xt,ft,ut,yt,gt,vt,dt,Xt,zt,Yt,Zt,Mt,It,Vt,wt,Lt,kt,At,Bt,Pt,St,Tt,Ct,jt,Rt=h[0],qt=h[1],Et=h[2],Dt=h[3];tt=Rt.x,it=Rt.y,st=Rt.z,at=qt.x,ot=qt.y,nt=qt.z,et=Et.x,rt=Et.y,_t=Et.z,lt=Dt.x,ht=Dt.y,ct=Dt.z,mt=at-tt,bt=ot-it,pt=nt-st,xt=et-tt,ft=rt-it,ut=_t-st,yt=lt-tt,gt=ht-it,vt=ct-st,dt=et-at,Xt=rt-ot,zt=_t-nt,Yt=lt-at,Zt=ht-ot,Mt=ct-nt,It=bt*ut-pt*ft,Vt=pt*xt-mt*ut,wt=mt*ft-bt*xt,Lt=ft*vt-ut*gt,kt=ut*yt-xt*vt,At=xt*gt-ft*yt,Bt=gt*pt-vt*bt,Pt=vt*mt-yt*pt,St=yt*bt-gt*mt,Tt=Zt*zt-Mt*Xt,Ct=Mt*dt-Yt*zt,jt=Yt*Xt-Zt*dt;let Nt,Ft,Wt,Jt=mt*Tt+bt*Ct+pt*jt>0?1:-1,Gt=-1,Ot=0;if(Nt=0,Ft=0,Wt=0,(tt*It+it*Vt+st*wt)*Jt<0){let t,i,s,a,o,n,e,r,_,l,h,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L;t=Rt.x,i=Rt.y,s=Rt.z,a=qt.x,o=qt.y,n=qt.z,e=Et.x,r=Et.y,_=Et.z,l=a-t,h=o-i,m=n-s,b=e-a,p=r-o,x=_-n,f=t-e,u=i-r,y=s-_,g=h*x-m*p,v=m*b-l*x,d=l*p-h*b,X=h*d-m*v,z=m*g-l*d,Y=l*v-h*g,Z=p*d-x*v,M=x*g-b*d,I=b*v-p*g,V=u*d-y*v,w=y*g-f*d,L=f*v-u*g;let k,A,B,P,S=-1,T=0;if(k=0,A=0,B=0,t*X+i*z+s*Y<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=qt.x,o=qt.y,n=qt.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}T=l,S=c.x*c.x+c.y*c.y+c.z*c.z,k=c.x,A=c.y,B=c.z}if(a*Z+o*M+n*I<0){let t,i,s,a,o,n,e,r,_;t=qt.x,i=qt.y,s=qt.z,a=Et.x,o=Et.y,n=Et.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=l<<1,S=m,k=c.x,A=c.y,B=c.z)}if(e*V+r*w+_*L<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=Et.x,o=Et.y,n=Et.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=c.x,A=c.y,B=c.z)}if(S>0)c.x=k,c.y=A,c.z=B,P=T;else{let a=g*g+v*v+d*d;a>0&&(a=1/Math.sqrt(a)),g*=a,v*=a,d*=a;let o=g*g+v*v+d*d;o=(t*g+i*v+s*d)/o,k=g*o,A=v*o,B=d*o,c.x=k,c.y=A,c.z=B,P=7}Ot=P,Gt=c.x*c.x+c.y*c.y+c.z*c.z,Nt=c.x,Ft=c.y,Wt=c.z}if((tt*Lt+it*kt+st*At)*Jt<0){let t,i,s,a,o,n,e,r,_,l,h,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L;t=Rt.x,i=Rt.y,s=Rt.z,a=Et.x,o=Et.y,n=Et.z,e=Dt.x,r=Dt.y,_=Dt.z,l=a-t,h=o-i,m=n-s,b=e-a,p=r-o,x=_-n,f=t-e,u=i-r,y=s-_,g=h*x-m*p,v=m*b-l*x,d=l*p-h*b,X=h*d-m*v,z=m*g-l*d,Y=l*v-h*g,Z=p*d-x*v,M=x*g-b*d,I=b*v-p*g,V=u*d-y*v,w=y*g-f*d,L=f*v-u*g;let k,A,B,P,S=-1,T=0;if(k=0,A=0,B=0,t*X+i*z+s*Y<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=Et.x,o=Et.y,n=Et.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}T=l,S=c.x*c.x+c.y*c.y+c.z*c.z,k=c.x,A=c.y,B=c.z}if(a*Z+o*M+n*I<0){let t,i,s,a,o,n,e,r,_;t=Et.x,i=Et.y,s=Et.z,a=Dt.x,o=Dt.y,n=Dt.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=l<<1,S=m,k=c.x,A=c.y,B=c.z)}if(e*V+r*w+_*L<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=Dt.x,o=Dt.y,n=Dt.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=c.x,A=c.y,B=c.z)}if(S>0)c.x=k,c.y=A,c.z=B,P=T;else{let a=g*g+v*v+d*d;a>0&&(a=1/Math.sqrt(a)),g*=a,v*=a,d*=a;let o=g*g+v*v+d*d;o=(t*g+i*v+s*d)/o,k=g*o,A=v*o,B=d*o,c.x=k,c.y=A,c.z=B,P=7}let C=c.x*c.x+c.y*c.y+c.z*c.z;(Gt<0||C<Gt)&&(Ot=1&P|(6&P)<<1,Gt=C,Nt=c.x,Ft=c.y,Wt=c.z)}if((tt*Bt+it*Pt+st*St)*Jt<0){let t,i,s,a,o,n,e,r,_,l,h,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L;t=Rt.x,i=Rt.y,s=Rt.z,a=qt.x,o=qt.y,n=qt.z,e=Dt.x,r=Dt.y,_=Dt.z,l=a-t,h=o-i,m=n-s,b=e-a,p=r-o,x=_-n,f=t-e,u=i-r,y=s-_,g=h*x-m*p,v=m*b-l*x,d=l*p-h*b,X=h*d-m*v,z=m*g-l*d,Y=l*v-h*g,Z=p*d-x*v,M=x*g-b*d,I=b*v-p*g,V=u*d-y*v,w=y*g-f*d,L=f*v-u*g;let k,A,B,P,S=-1,T=0;if(k=0,A=0,B=0,t*X+i*z+s*Y<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=qt.x,o=qt.y,n=qt.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}T=l,S=c.x*c.x+c.y*c.y+c.z*c.z,k=c.x,A=c.y,B=c.z}if(a*Z+o*M+n*I<0){let t,i,s,a,o,n,e,r,_;t=qt.x,i=qt.y,s=qt.z,a=Dt.x,o=Dt.y,n=Dt.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=l<<1,S=m,k=c.x,A=c.y,B=c.z)}if(e*V+r*w+_*L<0){let t,i,s,a,o,n,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,a=Dt.x,o=Dt.y,n=Dt.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=c.x,A=c.y,B=c.z)}if(S>0)c.x=k,c.y=A,c.z=B,P=T;else{let a=g*g+v*v+d*d;a>0&&(a=1/Math.sqrt(a)),g*=a,v*=a,d*=a;let o=g*g+v*v+d*d;o=(t*g+i*v+s*d)/o,k=g*o,A=v*o,B=d*o,c.x=k,c.y=A,c.z=B,P=7}let C=c.x*c.x+c.y*c.y+c.z*c.z;(Gt<0||C<Gt)&&(Ot=3&P|(4&P)<<1,Gt=C,Nt=c.x,Ft=c.y,Wt=c.z)}if((at*Tt+ot*Ct+nt*jt)*Jt<0){let t,i,s,a,o,n,e,r,_,l,h,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L;t=qt.x,i=qt.y,s=qt.z,a=Et.x,o=Et.y,n=Et.z,e=Dt.x,r=Dt.y,_=Dt.z,l=a-t,h=o-i,m=n-s,b=e-a,p=r-o,x=_-n,f=t-e,u=i-r,y=s-_,g=h*x-m*p,v=m*b-l*x,d=l*p-h*b,X=h*d-m*v,z=m*g-l*d,Y=l*v-h*g,Z=p*d-x*v,M=x*g-b*d,I=b*v-p*g,V=u*d-y*v,w=y*g-f*d,L=f*v-u*g;let k,A,B,P,S=-1,T=0;if(k=0,A=0,B=0,t*X+i*z+s*Y<0){let t,i,s,a,o,n,e,r,_;t=qt.x,i=qt.y,s=qt.z,a=Et.x,o=Et.y,n=Et.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}T=l,S=c.x*c.x+c.y*c.y+c.z*c.z,k=c.x,A=c.y,B=c.z}if(a*Z+o*M+n*I<0){let t,i,s,a,o,n,e,r,_;t=Et.x,i=Et.y,s=Et.z,a=Dt.x,o=Dt.y,n=Dt.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=l<<1,S=m,k=c.x,A=c.y,B=c.z)}if(e*V+r*w+_*L<0){let t,i,s,a,o,n,e,r,_;t=qt.x,i=qt.y,s=qt.z,a=Dt.x,o=Dt.y,n=Dt.z,e=a-t,r=o-i,_=n-s;let l,h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=s,l=1;else if(h>1)c.x=a,c.y=o,c.z=n,l=2;else{let a,o,n;a=t+e*h,o=i+r*h,n=s+_*h,c.x=a,c.y=o,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=c.x,A=c.y,B=c.z)}if(S>0)c.x=k,c.y=A,c.z=B,P=T;else{let a=g*g+v*v+d*d;a>0&&(a=1/Math.sqrt(a)),g*=a,v*=a,d*=a;let o=g*g+v*v+d*d;o=(t*g+i*v+s*d)/o,k=g*o,A=v*o,B=d*o,c.x=k,c.y=A,c.z=B,P=7}let C=c.x*c.x+c.y*c.y+c.z*c.z;(Gt<0||C<Gt)&&(Ot=P<<1,Gt=C,Nt=c.x,Ft=c.y,Wt=c.z)}Gt>0?(c.x=Nt,c.y=Ft,c.z=Wt,t=Ot):(c.zero(),t=15)}if(this.shrinkSimplex(t),c.x*c.x+c.y*c.y+c.z*c.z<1e-8){if(0==u||4==this.simplexSize)return e.fraction=u,!1;this.interpolateClosestPoints(),e.fraction=u;let t=e.normal;t.x=m.x,t.y=m.y,t.z=m.z;let i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);i>0&&(i=1/i),t.x*=i,t.y*=i,t.z*=i;let s=e.position,a=this.closestPoint1;return s.x=a.x,s.y=a.y,s.z=a.z,s.x+=o.x*u,s.y+=o.y*u,s.z+=o.z*u,!0}if(m.x=c.x,m.y=c.y,m.z=c.z,m.x=-m.x,m.y=-m.y,m.z=-m.z,null!=this.c1)this.computeWitnessPoint1(!0);else{let t=this.w1[this.simplexSize];t.x=this.tf1._positionX,t.y=this.tf1._positionY,t.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);let i=this.s[this.simplexSize],s=this.w1[this.simplexSize];i.x=s.x,i.y=s.y,i.z=s.z;let a=this.w2[this.simplexSize];i.x-=a.x,i.y-=a.y,i.z-=a.z;let n=h[this.simplexSize];if(n.x-=y.x,n.y-=y.y,n.z-=y.z,m.x*m.x+m.y*m.y+m.z*m.z<1e-8)throw new Error("!?");let r=h[this.simplexSize],_=r.x*m.x+r.y*m.y+r.z*m.z;if(_<0){if(g.x*m.x+g.y*m.y+g.z*m.z>=0)return!1;let t=_/(g.x*m.x+g.y*m.y+g.z*m.z);if(u+=t,u>=1)return!1;y.x+=g.x*t,y.y+=g.y*t,y.z+=g.z*t;let i=0,s=this.simplexSize+1;for(;i<s;){let s=h[i++],a=-t;s.x+=g.x*a,s.y+=g.y*a,s.z+=g.z*a}}let l=!1,b=0,p=this.simplexSize;for(;b<p;){let t=b++,i=h[t].x-h[this.simplexSize].x,s=h[t].y-h[this.simplexSize].y,a=h[t].z-h[this.simplexSize].z;if(i*i+s*s+a*a<1e-8){l=!0;break}}l||this.simplexSize++,++f}return!1}interpolateClosestPoints(){switch(this.simplexSize){case 1:let t=this.closestPoint1,i=this.w1[0];t.x=i.x,t.y=i.y,t.z=i.z;let s=this.closestPoint2,a=this.w2[0];s.x=a.x,s.y=a.y,s.z=a.z;break;case 2:let o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z=this.closest;o=Z.x,n=Z.y,e=Z.z;let M=this.s[0];r=M.x,_=M.y,l=M.z;let I=this.w1[0];h=I.x,c=I.y,m=I.z;let V=this.w2[0];b=V.x,p=V.y,x=V.z;let w=this.s[1];f=w.x,u=w.y,y=w.z;let L=this.w1[1];g=L.x,v=L.y,d=L.z;let k,A,B,P=this.w2[1];X=P.x,z=P.y,Y=P.z,k=f-r,A=u-_,B=y-l;let S,T,C,j=k*k+A*A+B*B;0!=j&&(j=1/j),S=o-r,T=n-_,C=e-l;let R,q,E,D,N,F,W,J,G,O=(S*k+T*A+C*B)*j;R=g-h,q=v-c,E=d-m,D=h+R*O,N=c+q*O,F=m+E*O,R=X-b,q=z-p,E=Y-x,W=b+R*O,J=p+q*O,G=x+E*O;let U=this.closestPoint1;U.x=D,U.y=N,U.z=F;let H=this.closestPoint2;H.x=W,H.y=J,H.z=G;break;case 3:let Q,K,$,tt,it,st,at,ot,nt,et,rt,_t,lt,ht,ct,mt,bt,pt,xt,ft,ut,yt,gt,vt,dt,Xt,zt,Yt,Zt,Mt,It=this.closest;Q=It.x,K=It.y,$=It.z;let Vt=this.s[0];tt=Vt.x,it=Vt.y,st=Vt.z;let wt=this.w1[0];at=wt.x,ot=wt.y,nt=wt.z;let Lt=this.w2[0];et=Lt.x,rt=Lt.y,_t=Lt.z;let kt=this.s[1];lt=kt.x,ht=kt.y,ct=kt.z;let At=this.w1[1];mt=At.x,bt=At.y,pt=At.z;let Bt=this.w2[1];xt=Bt.x,ft=Bt.y,ut=Bt.z;let Pt=this.s[2];yt=Pt.x,gt=Pt.y,vt=Pt.z;let St=this.w1[2];dt=St.x,Xt=St.y,zt=St.z;let Tt,Ct,jt,Rt,qt,Et,Dt,Nt,Ft,Wt=this.w2[2];Yt=Wt.x,Zt=Wt.y,Mt=Wt.z,Tt=lt-tt,Ct=ht-it,jt=ct-st,Rt=yt-tt,qt=gt-it,Et=vt-st,Dt=Q-tt,Nt=K-it,Ft=$-st;let Jt=Tt*Tt+Ct*Ct+jt*jt,Gt=Tt*Rt+Ct*qt+jt*Et,Ot=Rt*Rt+qt*qt+Et*Et,Ut=Tt*Dt+Ct*Nt+jt*Ft,Ht=Rt*Dt+qt*Nt+Et*Ft,Qt=Jt*Ot-Gt*Gt;0!=Qt&&(Qt=1/Qt);let Kt,$t,ti,ii,si,ai,oi,ni,ei,ri=(Ut*Ot-Ht*Gt)*Qt,_i=(-Ut*Gt+Ht*Jt)*Qt;Kt=mt-at,$t=bt-ot,ti=pt-nt,ii=at+Kt*ri,si=ot+$t*ri,ai=nt+ti*ri,Kt=dt-at,$t=Xt-ot,ti=zt-nt,ii+=Kt*_i,si+=$t*_i,ai+=ti*_i,Kt=xt-et,$t=ft-rt,ti=ut-_t,oi=et+Kt*ri,ni=rt+$t*ri,ei=_t+ti*ri,Kt=Yt-et,$t=Zt-rt,ti=Mt-_t,oi+=Kt*_i,ni+=$t*_i,ei+=ti*_i;let li=this.closestPoint1;li.x=ii,li.y=si,li.z=ai;let hi=this.closestPoint2;hi.x=oi,hi.y=ni,hi.z=ei;break;default:throw new Error("!?")}}loadCache(t){let i=this.dir,s=t.prevClosestDir;i.x=s.x,i.y=s.y,i.z=s.z}saveCache(t){let i=t.prevClosestDir,s=this.closest;i.x=s.x,i.y=s.y,i.z=s.z,i.x=-i.x,i.y=-i.y,i.z=-i.z}shrinkSimplex(t){switch(this.simplexSize=t,this.simplexSize=(5&this.simplexSize)+(this.simplexSize>>1&5),this.simplexSize=(3&this.simplexSize)+(this.simplexSize>>2&3),t){case 2:let t=this.s[0],i=this.s[1];t.x=i.x,t.y=i.y,t.z=i.z;let s=this.w1[0],a=this.w1[1];s.x=a.x,s.y=a.y,s.z=a.z;let o=this.w2[0],n=this.w2[1];o.x=n.x,o.y=n.y,o.z=n.z;break;case 4:let e=this.s[0],r=this.s[2];e.x=r.x,e.y=r.y,e.z=r.z;let _=this.w1[0],l=this.w1[2];_.x=l.x,_.y=l.y,_.z=l.z;let h=this.w2[0],c=this.w2[2];h.x=c.x,h.y=c.y,h.z=c.z;break;case 5:let m=this.s[1],b=this.s[2];m.x=b.x,m.y=b.y,m.z=b.z;let p=this.w1[1],x=this.w1[2];p.x=x.x,p.y=x.y,p.z=x.z;let f=this.w2[1],u=this.w2[2];f.x=u.x,f.y=u.y,f.z=u.z;break;case 6:let y=this.s[0],g=this.s[2];y.x=g.x,y.y=g.y,y.z=g.z;let v=this.w1[0],d=this.w1[2];v.x=d.x,v.y=d.y,v.z=d.z;let X=this.w2[0],z=this.w2[2];X.x=z.x,X.y=z.y,X.z=z.z;break;case 8:let Y=this.s[0],Z=this.s[3];Y.x=Z.x,Y.y=Z.y,Y.z=Z.z;let M=this.w1[0],I=this.w1[3];M.x=I.x,M.y=I.y,M.z=I.z;let V=this.w2[0],w=this.w2[3];V.x=w.x,V.y=w.y,V.z=w.z;break;case 9:let L=this.s[1],k=this.s[3];L.x=k.x,L.y=k.y,L.z=k.z;let A=this.w1[1],B=this.w1[3];A.x=B.x,A.y=B.y,A.z=B.z;let P=this.w2[1],S=this.w2[3];P.x=S.x,P.y=S.y,P.z=S.z;break;case 10:let T=this.s[0],C=this.s[3];T.x=C.x,T.y=C.y,T.z=C.z;let j=this.w1[0],R=this.w1[3];j.x=R.x,j.y=R.y,j.z=R.z;let q=this.w2[0],E=this.w2[3];q.x=E.x,q.y=E.y,q.z=E.z;break;case 11:let D=this.s[2],N=this.s[3];D.x=N.x,D.y=N.y,D.z=N.z;let F=this.w1[2],W=this.w1[3];F.x=W.x,F.y=W.y,F.z=W.z;let J=this.w2[2],G=this.w2[3];J.x=G.x,J.y=G.y,J.z=G.z;break;case 12:let O=this.s[0],U=this.s[2];O.x=U.x,O.y=U.y,O.z=U.z;let H=this.w1[0],Q=this.w1[2];H.x=Q.x,H.y=Q.y,H.z=Q.z;let K=this.w2[0],$=this.w2[2];K.x=$.x,K.y=$.y,K.z=$.z;let tt=this.s[1],it=this.s[3];tt.x=it.x,tt.y=it.y,tt.z=it.z;let st=this.w1[1],at=this.w1[3];st.x=at.x,st.y=at.y,st.z=at.z;let ot=this.w2[1],nt=this.w2[3];ot.x=nt.x,ot.y=nt.y,ot.z=nt.z;break;case 13:let et=this.s[1],rt=this.s[3];et.x=rt.x,et.y=rt.y,et.z=rt.z;let _t=this.w1[1],lt=this.w1[3];_t.x=lt.x,_t.y=lt.y,_t.z=lt.z;let ht=this.w2[1],ct=this.w2[3];ht.x=ct.x,ht.y=ct.y,ht.z=ct.z;break;case 14:let mt=this.s[0],bt=this.s[3];mt.x=bt.x,mt.y=bt.y,mt.z=bt.z;let pt=this.w1[0],xt=this.w1[3];pt.x=xt.x,pt.y=xt.y,pt.z=xt.z;let ft=this.w2[0],ut=this.w2[3];ft.x=ut.x,ft.y=ut.y,ft.z=ut.z}}computeWitnessPoint1(t){let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f=this.dir;o=f.x,n=f.y,e=f.z,h=this.tf1._rotation00*o+this.tf1._rotation10*n+this.tf1._rotation20*e,c=this.tf1._rotation01*o+this.tf1._rotation11*n+this.tf1._rotation21*e,m=this.tf1._rotation02*o+this.tf1._rotation12*n+this.tf1._rotation22*e,r=h,_=c,l=m;let u=this.dir;if(u.x=r,u.y=_,u.z=l,this.c1.computeLocalSupportingVertex(this.dir,this.w1[this.simplexSize]),t){let t=this.dir,i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);i>0&&(i=1/i),t.x*=i,t.y*=i,t.z*=i;let s=this.w1[this.simplexSize],a=this.dir,o=this.c1._gjkMargin;s.x+=a.x*o,s.y+=a.y*o,s.z+=a.z*o}let y,g,v,d=this.w1[this.simplexSize];i=d.x,s=d.y,a=d.z,y=this.tf1._rotation00*i+this.tf1._rotation01*s+this.tf1._rotation02*a,g=this.tf1._rotation10*i+this.tf1._rotation11*s+this.tf1._rotation12*a,v=this.tf1._rotation20*i+this.tf1._rotation21*s+this.tf1._rotation22*a,b=y,p=g,x=v,b+=this.tf1._positionX,p+=this.tf1._positionY,x+=this.tf1._positionZ;let X=this.w1[this.simplexSize];X.x=b,X.y=p,X.z=x;let z=this.dir;z.x=o,z.y=n,z.z=e}computeWitnessPoint2(t){let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f=this.dir;o=f.x,n=f.y,e=f.z,h=this.tf2._rotation00*o+this.tf2._rotation10*n+this.tf2._rotation20*e,c=this.tf2._rotation01*o+this.tf2._rotation11*n+this.tf2._rotation21*e,m=this.tf2._rotation02*o+this.tf2._rotation12*n+this.tf2._rotation22*e,r=h,_=c,l=m,r=-r,_=-_,l=-l;let u=this.dir;if(u.x=r,u.y=_,u.z=l,this.c2.computeLocalSupportingVertex(this.dir,this.w2[this.simplexSize]),t){let t=this.dir,i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);i>0&&(i=1/i),t.x*=i,t.y*=i,t.z*=i;let s=this.w2[this.simplexSize],a=this.dir,o=this.c2._gjkMargin;s.x+=a.x*o,s.y+=a.y*o,s.z+=a.z*o}let y,g,v,d=this.w2[this.simplexSize];i=d.x,s=d.y,a=d.z,y=this.tf2._rotation00*i+this.tf2._rotation01*s+this.tf2._rotation02*a,g=this.tf2._rotation10*i+this.tf2._rotation11*s+this.tf2._rotation12*a,v=this.tf2._rotation20*i+this.tf2._rotation21*s+this.tf2._rotation22*a,b=y,p=g,x=v,b+=this.tf2._positionX,p+=this.tf2._positionY,x+=this.tf2._positionZ;let X=this.w2[this.simplexSize];X.x=b,X.y=p,X.z=x;let z=this.dir;z.x=o,z.y=n,z.z=e}pointToTetrahedron(){let t=0;for(;t<3;){let i=this.dir,s=this.baseDirs[t++];i.x=s.x,i.y=s.y,i.z=s.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let a=this.s[this.simplexSize],o=this.w1[this.simplexSize];a.x=o.x,a.y=o.y,a.z=o.z;let n=this.w2[this.simplexSize];if(a.x-=n.x,a.y-=n.y,a.z-=n.z,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;let e=this.dir;e.x=-e.x,e.y=-e.y,e.z=-e.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let r=this.s[this.simplexSize],_=this.w1[this.simplexSize];r.x=_.x,r.y=_.y,r.z=_.z;let l=this.w2[this.simplexSize];if(r.x-=l.x,r.y-=l.y,r.z-=l.z,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}}lineToTetrahedron(){let t,i,s,a,o,n,e,r,_,l,h,c,m=this.dir;t=m.x,i=m.y,s=m.z;let b=this.s[0];a=b.x,o=b.y,n=b.z;let p=this.s[1];e=p.x,r=p.y,_=p.z,l=a-e,h=o-r,c=n-_;let x=0;for(;x<3;){let t,i,s,a,o,n,e=this.baseDirs[x++];t=e.x,i=e.y,s=e.z,a=h*s-c*i,o=c*t-l*s,n=l*i-h*t;let r=this.dir;r.x=a,r.y=o,r.z=n,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let _=this.s[this.simplexSize],m=this.w1[this.simplexSize];_.x=m.x,_.y=m.y,_.z=m.z;let b=this.w2[this.simplexSize];if(_.x-=b.x,_.y-=b.y,_.z-=b.z,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;let p=this.dir;p.x=-p.x,p.y=-p.y,p.z=-p.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let f=this.s[this.simplexSize],u=this.w1[this.simplexSize];f.x=u.x,f.y=u.y,f.z=u.z;let y=this.w2[this.simplexSize];if(f.x-=y.x,f.y-=y.y,f.z-=y.z,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}let f=this.dir;f.x=t,f.y=i,f.z=s}triangleToTetrahedron(){let t,i,s,a=this.dir;for(t=a.x,i=a.y,s=a.z;;){let t,i,s,a,o,n,e,r,_,l,h,c,m,b,p,x=this.s[0];t=x.x,i=x.y,s=x.z;let f=this.s[1];a=f.x,o=f.y,n=f.z;let u,y,g,v=this.s[2];e=v.x,r=v.y,_=v.z,l=a-t,h=o-i,c=n-s,m=e-t,b=r-i,p=_-s,u=h*p-c*b,y=c*m-l*p,g=l*b-h*m;let d=this.dir;d.x=u,d.y=y,d.z=g,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let X=this.s[this.simplexSize],z=this.w1[this.simplexSize];X.x=z.x,X.y=z.y,X.z=z.z;let Y=this.w2[this.simplexSize];if(X.x-=Y.x,X.y-=Y.y,X.z-=Y.z,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;let Z=this.dir;Z.x=-Z.x,Z.y=-Z.y,Z.z=-Z.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let M=this.s[this.simplexSize],I=this.w1[this.simplexSize];M.x=I.x,M.y=I.y,M.z=I.z;let V=this.w2[this.simplexSize];if(M.x-=V.x,M.y-=V.y,M.z-=V.z,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;break}let o=this.dir;o.x=t,o.y=i,o.z=s}isValidTetrahedron(){let t=this.s[2].x-this.s[0].x,i=this.s[2].y-this.s[0].y,s=this.s[2].z-this.s[0].z,a=this.s[3].x-this.s[0].x,o=this.s[3].y-this.s[0].y,n=this.s[3].z-this.s[0].z,e=(this.s[1].x-this.s[0].x)*(i*n-s*o)-(this.s[1].y-this.s[0].y)*(t*n-s*a)+(this.s[1].z-this.s[0].z)*(t*o-i*a);return e>1e-12||e<-1e-12}computeDepth(t,i,s,o,n,e,r){let _=this.polyhedron;for(;_._numTriangles>0;){let t=_._triangleList;_._numTriangles--;let i=t._prev,s=t._next;null!=i&&(i._next=s),null!=s&&(s._prev=i),t==_._triangleList&&(_._triangleList=_._triangleList._next),t==_._triangleListLast&&(_._triangleListLast=_._triangleListLast._prev),t._next=null,t._prev=null,t.removeReferences(),t._next=_._trianglePool,_._trianglePool=t}for(;_._numVertices>0;){let t=_._vertices[--_._numVertices];t.removeReferences(),t._next=_._vertexPool,_._vertexPool=t}let l=this.polyhedron,h=this.polyhedron,c=h._vertexPool;null!=c?(h._vertexPool=c._next,c._next=null):c=new a.collision.narrowphase.detector.gjkepa.EpaVertex;let m=c.init(n[0],e[0],r[0]),b=this.polyhedron,p=b._vertexPool;null!=p?(b._vertexPool=p._next,p._next=null):p=new a.collision.narrowphase.detector.gjkepa.EpaVertex;let x=p.init(n[1],e[1],r[1]),f=this.polyhedron,u=f._vertexPool;null!=u?(f._vertexPool=u._next,u._next=null):u=new a.collision.narrowphase.detector.gjkepa.EpaVertex;let y=u.init(n[2],e[2],r[2]),g=this.polyhedron,v=g._vertexPool;if(null!=v?(g._vertexPool=v._next,v._next=null):v=new a.collision.narrowphase.detector.gjkepa.EpaVertex,!l._init(m,x,y,v.init(n[3],e[3],r[3])))return a.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT;this.simplexSize=0;let d=this.s[0],X=this.w1[0],z=this.w2[0],Y=0;for(;Y<40;){let t=this.polyhedron._triangleList,i=Infinity,s=null;for(;null!=t;)t._distanceSq<i&&(i=t._distanceSq,s=t),t=t._next;let o=s,n=this.dir,e=o._normal;n.x=e.x,n.y=e.y,n.z=e.z;let r=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z);r>0&&(r=1/r),n.x*=r,n.y*=r,n.z*=r,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let _=this.s[this.simplexSize],l=this.w1[this.simplexSize];_.x=l.x,_.y=l.y,_.z=l.z;let h=this.w2[this.simplexSize];_.x-=h.x,_.y-=h.y,_.z-=h.z;let c=o._vertices[0],m=o._vertices[1],b=o._vertices[2],p=c.v,x=this.dir,f=this.dir;if(d.x*f.x+d.y*f.y+d.z*f.z-(p.x*x.x+p.y*x.y+p.z*x.z)<1e-6||39==Y){let t=this.closest,i=this.dir;t.x=i.x,t.y=i.y,t.z=i.z;let s,o,n,e=this.dir,r=c.v,_=this.dir,l=(e.x*r.x+e.y*r.y+e.z*r.z)/(_.x*_.x+_.y*_.y+_.z*_.z);t.x*=l,t.y*=l,t.z*=l;let h,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,q=this.closest;s=q.x,o=q.y,n=q.z;let E=c.v;h=E.x,p=E.y,x=E.z;let D=c.w1;f=D.x,u=D.y,y=D.z;let N=c.w2;g=N.x,v=N.y,d=N.z;let F=m.v;X=F.x,z=F.y,Y=F.z;let W=m.w1;Z=W.x,M=W.y,I=W.z;let J=m.w2;V=J.x,w=J.y,L=J.z;let G=b.v;k=G.x,A=G.y,B=G.z;let O=b.w1;P=O.x,S=O.y,T=O.z;let U,H,Q,K,$,tt,it,st,at,ot=b.w2;C=ot.x,j=ot.y,R=ot.z,U=X-h,H=z-p,Q=Y-x,K=k-h,$=A-p,tt=B-x,it=s-h,st=o-p,at=n-x;let nt=U*U+H*H+Q*Q,et=U*K+H*$+Q*tt,rt=K*K+$*$+tt*tt,_t=U*it+H*st+Q*at,lt=K*it+$*st+tt*at,ht=nt*rt-et*et;0!=ht&&(ht=1/ht);let ct,mt,bt,pt,xt,ft,ut,yt,gt,vt=(_t*rt-lt*et)*ht,dt=(-_t*et+lt*nt)*ht;ct=Z-f,mt=M-u,bt=I-y,pt=f+ct*vt,xt=u+mt*vt,ft=y+bt*vt,ct=P-f,mt=S-u,bt=T-y,pt+=ct*dt,xt+=mt*dt,ft+=bt*dt,ct=V-g,mt=w-v,bt=L-d,ut=g+ct*vt,yt=v+mt*vt,gt=d+bt*vt,ct=C-g,mt=j-v,bt=R-d,ut+=ct*dt,yt+=mt*dt,gt+=bt*dt;let Xt=this.closestPoint1;Xt.x=pt,Xt.y=xt,Xt.z=ft;let zt=this.closestPoint2;zt.x=ut,zt.y=yt,zt.z=gt;let Yt=this.closest;return this.depth=Math.sqrt(Yt.x*Yt.x+Yt.y*Yt.y+Yt.z*Yt.z),a.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED}let u=this.polyhedron,y=u._vertexPool;null!=y?(u._vertexPool=y._next,y._next=null):y=new a.collision.narrowphase.detector.gjkepa.EpaVertex;let g=y.init(d,X,z);if(!this.polyhedron._addVertex(g,o))return a.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX;++Y}return a.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE}computeClosestPoints(t,i,s,a,o){return this.computeClosestPointsImpl(t,i,s,a,o,!0)}computeDistance(t,i,s,a,o){return this.computeClosestPointsImpl(t,i,s,a,o,!1)}convexCast(t,i,s,a,o,n,e){return this.convexCastImpl(t,i,s,a,o,n,e)}rayCast(t,i,s,a,o){let n=this.tempTransform;n._positionX=s.x,n._positionY=s.y,n._positionZ=s.z;let e=this.tl1,r=this.tl2;return e.x=a.x,e.y=a.y,e.z=a.z,e.x-=s.x,e.y-=s.y,e.z-=s.z,r.zero(),this.convexCastImpl(null,t,n,i,e,r,o)}static getInstance(){return a.collision.narrowphase.detector.gjkepa.GjkEpa.instance}},a.collision.narrowphase.detector.gjkepa.GjkEpaLog=class{},a.collision.narrowphase.detector.gjkepa.GjkEpaResultState=class{},a.collision.narrowphase.detector.gjkepa.SimplexUtil=class{static projectOrigin2(t,i,s){let a,o,n,e,r,_,l,h,c;a=t.x,o=t.y,n=t.z,e=i.x,r=i.y,_=i.z,l=e-a,h=r-o,c=_-n;let m,b,p,x=l*a+h*o+c*n;return x=-x/(l*l+h*h+c*c),x<0?(s.x=a,s.y=o,s.z=n,1):x>1?(s.x=e,s.y=r,s.z=_,2):(m=a+l*x,b=o+h*x,p=n+c*x,s.x=m,s.y=b,s.z=p,3)}static projectOrigin3(t,i,s,a){let o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B;o=t.x,n=t.y,e=t.z,r=i.x,_=i.y,l=i.z,h=s.x,c=s.y,m=s.z,b=r-o,p=_-n,x=l-e,f=h-r,u=c-_,y=m-l,g=o-h,v=n-c,d=e-m,X=p*y-x*u,z=x*f-b*y,Y=b*u-p*f,Z=p*Y-x*z,M=x*X-b*Y,I=b*z-p*X,V=u*Y-y*z,w=y*X-f*Y,L=f*z-u*X,k=v*Y-d*z,A=d*X-g*Y,B=g*z-v*X;let P,S,T,C=-1,j=0;if(P=0,S=0,T=0,o*Z+n*M+e*I<0){let s,o,n,e,r,_,l,h,c;s=t.x,o=t.y,n=t.z,e=i.x,r=i.y,_=i.z,l=e-s,h=r-o,c=_-n;let m,b=l*s+h*o+c*n;if(b=-b/(l*l+h*h+c*c),b<0)a.x=s,a.y=o,a.z=n,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let t,i,e;t=s+l*b,i=o+h*b,e=n+c*b,a.x=t,a.y=i,a.z=e,m=3}j=m,C=a.x*a.x+a.y*a.y+a.z*a.z,P=a.x,S=a.y,T=a.z}if(r*V+_*w+l*L<0){let t,o,n,e,r,_,l,h,c;t=i.x,o=i.y,n=i.z,e=s.x,r=s.y,_=s.z,l=e-t,h=r-o,c=_-n;let m,b=l*t+h*o+c*n;if(b=-b/(l*l+h*h+c*c),b<0)a.x=t,a.y=o,a.z=n,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let i,s,e;i=t+l*b,s=o+h*b,e=n+c*b,a.x=i,a.y=s,a.z=e,m=3}let p=a.x*a.x+a.y*a.y+a.z*a.z;(C<0||p<C)&&(j=m<<1,C=p,P=a.x,S=a.y,T=a.z)}if(h*k+c*A+m*B<0){let i,o,n,e,r,_,l,h,c;i=t.x,o=t.y,n=t.z,e=s.x,r=s.y,_=s.z,l=e-i,h=r-o,c=_-n;let m,b=l*i+h*o+c*n;if(b=-b/(l*l+h*h+c*c),b<0)a.x=i,a.y=o,a.z=n,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let t,s,e;t=i+l*b,s=o+h*b,e=n+c*b,a.x=t,a.y=s,a.z=e,m=3}let p=a.x*a.x+a.y*a.y+a.z*a.z;(C<0||p<C)&&(j=1&m|(2&m)<<1,C=p,P=a.x,S=a.y,T=a.z)}if(C>0)return a.x=P,a.y=S,a.z=T,j;let R=X*X+z*z+Y*Y;R>0&&(R=1/Math.sqrt(R)),X*=R,z*=R,Y*=R;let q=X*X+z*z+Y*Y;return q=(o*X+n*z+e*Y)/q,P=X*q,S=z*q,T=Y*q,a.x=P,a.y=S,a.z=T,7}static projectOrigin4(t,i,s,a,o){let n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,q,E,D,N;n=t.x,e=t.y,r=t.z,_=i.x,l=i.y,h=i.z,c=s.x,m=s.y,b=s.z,p=a.x,x=a.y,f=a.z,u=_-n,y=l-e,g=h-r,v=c-n,d=m-e,X=b-r,z=p-n,Y=x-e,Z=f-r,M=c-_,I=m-l,V=b-h,w=p-_,L=x-l,k=f-h,A=y*X-g*d,B=g*v-u*X,P=u*d-y*v,S=d*Z-X*Y,T=X*z-v*Z,C=v*Y-d*z,j=Y*g-Z*y,R=Z*u-z*g,q=z*y-Y*u,E=L*V-k*I,D=k*M-w*V,N=w*I-L*M;let F,W,J,G=u*E+y*D+g*N>0?1:-1,O=-1,U=0;if(F=0,W=0,J=0,(n*A+e*B+r*P)*G<0){let a,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B;a=t.x,n=t.y,e=t.z,r=i.x,_=i.y,l=i.z,h=s.x,c=s.y,m=s.z,b=r-a,p=_-n,x=l-e,f=h-r,u=c-_,y=m-l,g=a-h,v=n-c,d=e-m,X=p*y-x*u,z=x*f-b*y,Y=b*u-p*f,Z=p*Y-x*z,M=x*X-b*Y,I=b*z-p*X,V=u*Y-y*z,w=y*X-f*Y,L=f*z-u*X,k=v*Y-d*z,A=d*X-g*Y,B=g*z-v*X;let P,S,T,C,j=-1,R=0;if(P=0,S=0,T=0,a*Z+n*M+e*I<0){let s,a,n,e,r,_,l,h,c;s=t.x,a=t.y,n=t.z,e=i.x,r=i.y,_=i.z,l=e-s,h=r-a,c=_-n;let m,b=l*s+h*a+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=s,o.y=a,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let t,i,e;t=s+l*b,i=a+h*b,e=n+c*b,o.x=t,o.y=i,o.z=e,m=3}R=m,j=o.x*o.x+o.y*o.y+o.z*o.z,P=o.x,S=o.y,T=o.z}if(r*V+_*w+l*L<0){let t,a,n,e,r,_,l,h,c;t=i.x,a=i.y,n=i.z,e=s.x,r=s.y,_=s.z,l=e-t,h=r-a,c=_-n;let m,b=l*t+h*a+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=t,o.y=a,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let i,s,e;i=t+l*b,s=a+h*b,e=n+c*b,o.x=i,o.y=s,o.z=e,m=3}let p=o.x*o.x+o.y*o.y+o.z*o.z;(j<0||p<j)&&(R=m<<1,j=p,P=o.x,S=o.y,T=o.z)}if(h*k+c*A+m*B<0){let i,a,n,e,r,_,l,h,c;i=t.x,a=t.y,n=t.z,e=s.x,r=s.y,_=s.z,l=e-i,h=r-a,c=_-n;let m,b=l*i+h*a+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=i,o.y=a,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let t,s,e;t=i+l*b,s=a+h*b,e=n+c*b,o.x=t,o.y=s,o.z=e,m=3}let p=o.x*o.x+o.y*o.y+o.z*o.z;(j<0||p<j)&&(R=1&m|(2&m)<<1,j=p,P=o.x,S=o.y,T=o.z)}if(j>0)o.x=P,o.y=S,o.z=T,C=R;else{let t=X*X+z*z+Y*Y;t>0&&(t=1/Math.sqrt(t)),X*=t,z*=t,Y*=t;let i=X*X+z*z+Y*Y;i=(a*X+n*z+e*Y)/i,P=X*i,S=z*i,T=Y*i,o.x=P,o.y=S,o.z=T,C=7}U=C,O=o.x*o.x+o.y*o.y+o.z*o.z,F=o.x,W=o.y,J=o.z}if((n*S+e*T+r*C)*G<0){let i,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B;i=t.x,n=t.y,e=t.z,r=s.x,_=s.y,l=s.z,h=a.x,c=a.y,m=a.z,b=r-i,p=_-n,x=l-e,f=h-r,u=c-_,y=m-l,g=i-h,v=n-c,d=e-m,X=p*y-x*u,z=x*f-b*y,Y=b*u-p*f,Z=p*Y-x*z,M=x*X-b*Y,I=b*z-p*X,V=u*Y-y*z,w=y*X-f*Y,L=f*z-u*X,k=v*Y-d*z,A=d*X-g*Y,B=g*z-v*X;let P,S,T,C,j=-1,R=0;if(P=0,S=0,T=0,i*Z+n*M+e*I<0){let i,a,n,e,r,_,l,h,c;i=t.x,a=t.y,n=t.z,e=s.x,r=s.y,_=s.z,l=e-i,h=r-a,c=_-n;let m,b=l*i+h*a+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=i,o.y=a,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let t,s,e;t=i+l*b,s=a+h*b,e=n+c*b,o.x=t,o.y=s,o.z=e,m=3}R=m,j=o.x*o.x+o.y*o.y+o.z*o.z,P=o.x,S=o.y,T=o.z}if(r*V+_*w+l*L<0){let t,i,n,e,r,_,l,h,c;t=s.x,i=s.y,n=s.z,e=a.x,r=a.y,_=a.z,l=e-t,h=r-i,c=_-n;let m,b=l*t+h*i+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=t,o.y=i,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let s,a,e;s=t+l*b,a=i+h*b,e=n+c*b,o.x=s,o.y=a,o.z=e,m=3}let p=o.x*o.x+o.y*o.y+o.z*o.z;(j<0||p<j)&&(R=m<<1,j=p,P=o.x,S=o.y,T=o.z)}if(h*k+c*A+m*B<0){let i,s,n,e,r,_,l,h,c;i=t.x,s=t.y,n=t.z,e=a.x,r=a.y,_=a.z,l=e-i,h=r-s,c=_-n;let m,b=l*i+h*s+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=i,o.y=s,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let t,a,e;t=i+l*b,a=s+h*b,e=n+c*b,o.x=t,o.y=a,o.z=e,m=3}let p=o.x*o.x+o.y*o.y+o.z*o.z;(j<0||p<j)&&(R=1&m|(2&m)<<1,j=p,P=o.x,S=o.y,T=o.z)}if(j>0)o.x=P,o.y=S,o.z=T,C=R;else{let t=X*X+z*z+Y*Y;t>0&&(t=1/Math.sqrt(t)),X*=t,z*=t,Y*=t;let s=X*X+z*z+Y*Y;s=(i*X+n*z+e*Y)/s,P=X*s,S=z*s,T=Y*s,o.x=P,o.y=S,o.z=T,C=7}let q=o.x*o.x+o.y*o.y+o.z*o.z;(O<0||q<O)&&(U=1&C|(6&C)<<1,O=q,F=o.x,W=o.y,J=o.z)}if((n*j+e*R+r*q)*G<0){let s,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B;s=t.x,n=t.y,e=t.z,r=i.x,_=i.y,l=i.z,h=a.x,c=a.y,m=a.z,b=r-s,p=_-n,x=l-e,f=h-r,u=c-_,y=m-l,g=s-h,v=n-c,d=e-m,X=p*y-x*u,z=x*f-b*y,Y=b*u-p*f,Z=p*Y-x*z,M=x*X-b*Y,I=b*z-p*X,V=u*Y-y*z,w=y*X-f*Y,L=f*z-u*X,k=v*Y-d*z,A=d*X-g*Y,B=g*z-v*X;let P,S,T,C,j=-1,R=0;if(P=0,S=0,T=0,s*Z+n*M+e*I<0){let s,a,n,e,r,_,l,h,c;s=t.x,a=t.y,n=t.z,e=i.x,r=i.y,_=i.z,l=e-s,h=r-a,c=_-n;let m,b=l*s+h*a+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=s,o.y=a,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let t,i,e;t=s+l*b,i=a+h*b,e=n+c*b,o.x=t,o.y=i,o.z=e,m=3}R=m,j=o.x*o.x+o.y*o.y+o.z*o.z,P=o.x,S=o.y,T=o.z}if(r*V+_*w+l*L<0){let t,s,n,e,r,_,l,h,c;t=i.x,s=i.y,n=i.z,e=a.x,r=a.y,_=a.z,l=e-t,h=r-s,c=_-n;let m,b=l*t+h*s+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=t,o.y=s,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let i,a,e;i=t+l*b,a=s+h*b,e=n+c*b,o.x=i,o.y=a,o.z=e,m=3}let p=o.x*o.x+o.y*o.y+o.z*o.z;(j<0||p<j)&&(R=m<<1,j=p,P=o.x,S=o.y,T=o.z)}if(h*k+c*A+m*B<0){let i,s,n,e,r,_,l,h,c;i=t.x,s=t.y,n=t.z,e=a.x,r=a.y,_=a.z,l=e-i,h=r-s,c=_-n;let m,b=l*i+h*s+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=i,o.y=s,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let t,a,e;t=i+l*b,a=s+h*b,e=n+c*b,o.x=t,o.y=a,o.z=e,m=3}let p=o.x*o.x+o.y*o.y+o.z*o.z;(j<0||p<j)&&(R=1&m|(2&m)<<1,j=p,P=o.x,S=o.y,T=o.z)}if(j>0)o.x=P,o.y=S,o.z=T,C=R;else{let t=X*X+z*z+Y*Y;t>0&&(t=1/Math.sqrt(t)),X*=t,z*=t,Y*=t;let i=X*X+z*z+Y*Y;i=(s*X+n*z+e*Y)/i,P=X*i,S=z*i,T=Y*i,o.x=P,o.y=S,o.z=T,C=7}let q=o.x*o.x+o.y*o.y+o.z*o.z;(O<0||q<O)&&(U=3&C|(4&C)<<1,O=q,F=o.x,W=o.y,J=o.z)}if((_*E+l*D+h*N)*G<0){let t,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B;t=i.x,n=i.y,e=i.z,r=s.x,_=s.y,l=s.z,h=a.x,c=a.y,m=a.z,b=r-t,p=_-n,x=l-e,f=h-r,u=c-_,y=m-l,g=t-h,v=n-c,d=e-m,X=p*y-x*u,z=x*f-b*y,Y=b*u-p*f,Z=p*Y-x*z,M=x*X-b*Y,I=b*z-p*X,V=u*Y-y*z,w=y*X-f*Y,L=f*z-u*X,k=v*Y-d*z,A=d*X-g*Y,B=g*z-v*X;let P,S,T,C,j=-1,R=0;if(P=0,S=0,T=0,t*Z+n*M+e*I<0){let t,a,n,e,r,_,l,h,c;t=i.x,a=i.y,n=i.z,e=s.x,r=s.y,_=s.z,l=e-t,h=r-a,c=_-n;let m,b=l*t+h*a+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=t,o.y=a,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let i,s,e;i=t+l*b,s=a+h*b,e=n+c*b,o.x=i,o.y=s,o.z=e,m=3}R=m,j=o.x*o.x+o.y*o.y+o.z*o.z,P=o.x,S=o.y,T=o.z}if(r*V+_*w+l*L<0){let t,i,n,e,r,_,l,h,c;t=s.x,i=s.y,n=s.z,e=a.x,r=a.y,_=a.z,l=e-t,h=r-i,c=_-n;let m,b=l*t+h*i+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=t,o.y=i,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let s,a,e;s=t+l*b,a=i+h*b,e=n+c*b,o.x=s,o.y=a,o.z=e,m=3}let p=o.x*o.x+o.y*o.y+o.z*o.z;(j<0||p<j)&&(R=m<<1,j=p,P=o.x,S=o.y,T=o.z)}if(h*k+c*A+m*B<0){let t,s,n,e,r,_,l,h,c;t=i.x,s=i.y,n=i.z,e=a.x,r=a.y,_=a.z,l=e-t,h=r-s,c=_-n;let m,b=l*t+h*s+c*n;if(b=-b/(l*l+h*h+c*c),b<0)o.x=t,o.y=s,o.z=n,m=1;else if(b>1)o.x=e,o.y=r,o.z=_,m=2;else{let i,a,e;i=t+l*b,a=s+h*b,e=n+c*b,o.x=i,o.y=a,o.z=e,m=3}let p=o.x*o.x+o.y*o.y+o.z*o.z;(j<0||p<j)&&(R=1&m|(2&m)<<1,j=p,P=o.x,S=o.y,T=o.z)}if(j>0)o.x=P,o.y=S,o.z=T,C=R;else{let i=X*X+z*z+Y*Y;i>0&&(i=1/Math.sqrt(i)),X*=i,z*=i,Y*=i;let s=X*X+z*z+Y*Y;s=(t*X+n*z+e*Y)/s,P=X*s,S=z*s,T=Y*s,o.x=P,o.y=S,o.z=T,C=7}let q=o.x*o.x+o.y*o.y+o.z*o.z;(O<0||q<O)&&(U=C<<1,O=q,F=o.x,W=o.y,J=o.z)}return O>0?(o.x=F,o.y=W,o.z=J,U):(o.zero(),15)}},a.common.Mat3=class{constructor(t,i,s,o,n,e,r,_,l){null==l&&(l=1),null==_&&(_=0),null==r&&(r=0),null==e&&(e=0),null==n&&(n=1),null==o&&(o=0),null==s&&(s=0),null==i&&(i=0),null==t&&(t=1),this.e00=t,this.e01=i,this.e02=s,this.e10=o,this.e11=n,this.e12=e,this.e20=r,this.e21=_,this.e22=l,a.common.Mat3.numCreations++}init(t,i,s,a,o,n,e,r,_){return this.e00=t,this.e01=i,this.e02=s,this.e10=a,this.e11=o,this.e12=n,this.e20=e,this.e21=r,this.e22=_,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e10=0,this.e11=1,this.e12=0,this.e20=0,this.e21=0,this.e22=1,this}add(t){return new a.common.Mat3(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22)}sub(t){return new a.common.Mat3(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22)}scale(t){return new a.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*t,this.e11*t,this.e12*t,this.e20*t,this.e21*t,this.e22*t)}mul(t){return new a.common.Mat3(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22)}addEq(t){return this.e00+=t.e00,this.e01+=t.e01,this.e02+=t.e02,this.e10+=t.e10,this.e11+=t.e11,this.e12+=t.e12,this.e20+=t.e20,this.e21+=t.e21,this.e22+=t.e22,this}subEq(t){return this.e00-=t.e00,this.e01-=t.e01,this.e02-=t.e02,this.e10-=t.e10,this.e11-=t.e11,this.e12-=t.e12,this.e20-=t.e20,this.e21-=t.e21,this.e22-=t.e22,this}scaleEq(t){return this.e00*=t,this.e01*=t,this.e02*=t,this.e10*=t,this.e11*=t,this.e12*=t,this.e20*=t,this.e21*=t,this.e22*=t,this}mulEq(t){let i=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,s=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,a=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,o=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,n=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,e=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,r=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,_=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e01=i,this.e02=s,this.e10=a,this.e11=o,this.e12=n,this.e20=e,this.e21=r,this.e22=_,this}prependScale(t,i,s){return new a.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*i,this.e11*i,this.e12*i,this.e20*s,this.e21*s,this.e22*s)}appendScale(t,i,s){return new a.common.Mat3(this.e00*t,this.e01*i,this.e02*s,this.e10*t,this.e11*i,this.e12*s,this.e20*t,this.e21*i,this.e22*s)}prependRotation(t,i,s,o){let n=Math.sin(t),e=Math.cos(t),r=1-e,_=i*i*r+e,l=i*s*r-o*n,h=i*o*r+s*n,c=s*i*r+o*n,m=s*s*r+e,b=s*o*r-i*n,p=o*i*r-s*n,x=o*s*r+i*n,f=o*o*r+e;return new a.common.Mat3(_*this.e00+l*this.e10+h*this.e20,_*this.e01+l*this.e11+h*this.e21,_*this.e02+l*this.e12+h*this.e22,c*this.e00+m*this.e10+b*this.e20,c*this.e01+m*this.e11+b*this.e21,c*this.e02+m*this.e12+b*this.e22,p*this.e00+x*this.e10+f*this.e20,p*this.e01+x*this.e11+f*this.e21,p*this.e02+x*this.e12+f*this.e22)}appendRotation(t,i,s,o){let n=Math.sin(t),e=Math.cos(t),r=1-e,_=i*i*r+e,l=i*s*r-o*n,h=i*o*r+s*n,c=s*i*r+o*n,m=s*s*r+e,b=s*o*r-i*n,p=o*i*r-s*n,x=o*s*r+i*n,f=o*o*r+e;return new a.common.Mat3(this.e00*_+this.e01*c+this.e02*p,this.e00*l+this.e01*m+this.e02*x,this.e00*h+this.e01*b+this.e02*f,this.e10*_+this.e11*c+this.e12*p,this.e10*l+this.e11*m+this.e12*x,this.e10*h+this.e11*b+this.e12*f,this.e20*_+this.e21*c+this.e22*p,this.e20*l+this.e21*m+this.e22*x,this.e20*h+this.e21*b+this.e22*f)}prependScaleEq(t,i,s){return this.e00*=t,this.e01*=t,this.e02*=t,this.e10*=i,this.e11*=i,this.e12*=i,this.e20*=s,this.e21*=s,this.e22*=s,this}appendScaleEq(t,i,s){return this.e00*=t,this.e01*=i,this.e02*=s,this.e10*=t,this.e11*=i,this.e12*=s,this.e20*=t,this.e21*=i,this.e22*=s,this}prependRotationEq(t,i,s,a){let o=Math.sin(t),n=Math.cos(t),e=1-n,r=i*i*e+n,_=i*s*e-a*o,l=i*a*e+s*o,h=s*i*e+a*o,c=s*s*e+n,m=s*a*e-i*o,b=a*i*e-s*o,p=a*s*e+i*o,x=a*a*e+n,f=h*this.e00+c*this.e10+m*this.e20,u=h*this.e01+c*this.e11+m*this.e21,y=h*this.e02+c*this.e12+m*this.e22,g=b*this.e00+p*this.e10+x*this.e20,v=b*this.e01+p*this.e11+x*this.e21,d=b*this.e02+p*this.e12+x*this.e22;return this.e00=r*this.e00+_*this.e10+l*this.e20,this.e01=r*this.e01+_*this.e11+l*this.e21,this.e02=r*this.e02+_*this.e12+l*this.e22,this.e10=f,this.e11=u,this.e12=y,this.e20=g,this.e21=v,this.e22=d,this}appendRotationEq(t,i,s,a){let o=Math.sin(t),n=Math.cos(t),e=1-n,r=i*i*e+n,_=i*s*e-a*o,l=i*a*e+s*o,h=s*i*e+a*o,c=s*s*e+n,m=s*a*e-i*o,b=a*i*e-s*o,p=a*s*e+i*o,x=a*a*e+n,f=this.e00*_+this.e01*c+this.e02*p,u=this.e00*l+this.e01*m+this.e02*x,y=this.e10*_+this.e11*c+this.e12*p,g=this.e10*l+this.e11*m+this.e12*x,v=this.e20*_+this.e21*c+this.e22*p,d=this.e20*l+this.e21*m+this.e22*x;return this.e00=this.e00*r+this.e01*h+this.e02*b,this.e01=f,this.e02=u,this.e10=this.e10*r+this.e11*h+this.e12*b,this.e11=y,this.e12=g,this.e20=this.e20*r+this.e21*h+this.e22*b,this.e21=v,this.e22=d,this}transpose(){return new a.common.Mat3(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)}transposeEq(){let t=this.e01,i=this.e02,s=this.e12;return this.e00=this.e00,this.e01=this.e10,this.e02=this.e20,this.e10=t,this.e11=this.e11,this.e12=this.e21,this.e20=i,this.e21=s,this.e22=this.e22,this}determinant(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)}trace(){return this.e00+this.e11+this.e22}inverse(){let t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,s=this.e10*this.e21-this.e11*this.e20,o=this.e00*t-this.e01*i+this.e02*s;return 0!=o&&(o=1/o),new a.common.Mat3(t*o,-(this.e01*this.e22-this.e02*this.e21)*o,(this.e01*this.e12-this.e02*this.e11)*o,-i*o,(this.e00*this.e22-this.e02*this.e20)*o,-(this.e00*this.e12-this.e02*this.e10)*o,s*o,-(this.e00*this.e21-this.e01*this.e20)*o,(this.e00*this.e11-this.e01*this.e10)*o)}inverseEq(){let t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,s=this.e10*this.e21-this.e11*this.e20,a=this.e00*t-this.e01*i+this.e02*s;0!=a&&(a=1/a);let o=(this.e01*this.e12-this.e02*this.e11)*a,n=(this.e00*this.e22-this.e02*this.e20)*a,e=-(this.e00*this.e12-this.e02*this.e10)*a,r=-(this.e00*this.e21-this.e01*this.e20)*a,_=(this.e00*this.e11-this.e01*this.e10)*a;return this.e00=t*a,this.e01=-(this.e01*this.e22-this.e02*this.e21)*a,this.e02=o,this.e10=-i*a,this.e11=n,this.e12=e,this.e20=s*a,this.e21=r,this.e22=_,this}toArray(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]:[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this}clone(){return new a.common.Mat3(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)}fromQuat(t){let i=t.x,s=t.y,a=t.z,o=t.w,n=2*i,e=2*s,r=2*a,_=i*n,l=s*e,h=a*r,c=i*e,m=s*r,b=i*r,p=o*n,x=o*e,f=o*r;return this.e00=1-l-h,this.e01=c-f,this.e02=b+x,this.e10=c+f,this.e11=1-_-h,this.e12=m-p,this.e20=b-x,this.e21=m+p,this.e22=1-_-l,this}toQuat(){let t,i=new a.common.Quat,s=this.e00,o=this.e11,n=this.e22,e=s+o+n;return e>0?(t=Math.sqrt(e+1),i.w=.5*t,t=.5/t,i.x=(this.e21-this.e12)*t,i.y=(this.e02-this.e20)*t,i.z=(this.e10-this.e01)*t):s>o?s>n?(t=Math.sqrt(s-o-n+1),i.x=.5*t,t=.5/t,i.y=(this.e01+this.e10)*t,i.z=(this.e02+this.e20)*t,i.w=(this.e21-this.e12)*t):(t=Math.sqrt(n-s-o+1),i.z=.5*t,t=.5/t,i.x=(this.e02+this.e20)*t,i.y=(this.e12+this.e21)*t,i.w=(this.e10-this.e01)*t):o>n?(t=Math.sqrt(o-n-s+1),i.y=.5*t,t=.5/t,i.x=(this.e01+this.e10)*t,i.z=(this.e12+this.e21)*t,i.w=(this.e02-this.e20)*t):(t=Math.sqrt(n-s-o+1),i.z=.5*t,t=.5/t,i.x=(this.e02+this.e20)*t,i.y=(this.e12+this.e21)*t,i.w=(this.e10-this.e01)*t),i}fromEulerXyz(t){let i=Math.sin(t.x),s=Math.sin(t.y),a=Math.sin(t.z),o=Math.cos(t.x),n=Math.cos(t.y),e=Math.cos(t.z);return this.e00=n*e,this.e01=-n*a,this.e02=s,this.e10=o*a+e*i*s,this.e11=o*e-i*s*a,this.e12=-n*i,this.e20=i*a-o*e*s,this.e21=e*i+o*s*a,this.e22=o*n,this}toEulerXyz(){let t=this.e02;if(t<=-1){let t=Math.atan2(this.e21,this.e11);return new a.common.Vec3(.5*t,-1.570796326794895,.5*-t)}if(t>=1){let t=Math.atan2(this.e21,this.e11);return new a.common.Vec3(.5*t,1.570796326794895,.5*t)}return new a.common.Vec3(Math.atan2(-this.e12,this.e22),Math.asin(t),Math.atan2(-this.e01,this.e00))}getRow(t){return 0==t?new a.common.Vec3(this.e00,this.e01,this.e02):1==t?new a.common.Vec3(this.e10,this.e11,this.e12):2==t?new a.common.Vec3(this.e20,this.e21,this.e22):null}getCol(t){return 0==t?new a.common.Vec3(this.e00,this.e10,this.e20):1==t?new a.common.Vec3(this.e01,this.e11,this.e21):2==t?new a.common.Vec3(this.e02,this.e12,this.e22):null}getRowTo(t,i){0==t?i.init(this.e00,this.e01,this.e02):1==t?i.init(this.e10,this.e11,this.e12):2==t?i.init(this.e20,this.e21,this.e22):i.zero()}getColTo(t,i){0==t?i.init(this.e00,this.e10,this.e20):1==t?i.init(this.e01,this.e11,this.e21):2==t?i.init(this.e02,this.e12,this.e22):i.zero()}fromRows(t,i,s){return this.e00=t.x,this.e01=t.y,this.e02=t.z,this.e10=i.x,this.e11=i.y,this.e12=i.z,this.e20=s.x,this.e21=s.y,this.e22=s.z,this}fromCols(t,i,s){return this.e00=t.x,this.e01=i.x,this.e02=s.x,this.e10=t.y,this.e11=i.y,this.e12=s.y,this.e20=t.z,this.e21=i.z,this.e22=s.z,this}toString(){return"Mat3["+(this.e00>0?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(this.e01>0?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(this.e02>0?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+",\n     "+(this.e10>0?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(this.e11>0?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(this.e12>0?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+",\n     "+(this.e20>0?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(this.e21>0?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(this.e22>0?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+"]"}},a.common.Mat4=class{constructor(t,i,s,o,n,e,r,_,l,h,c,m,b,p,x,f){null==f&&(f=1),null==x&&(x=0),null==p&&(p=0),null==b&&(b=0),null==m&&(m=0),null==c&&(c=1),null==h&&(h=0),null==l&&(l=0),null==_&&(_=0),null==r&&(r=0),null==e&&(e=1),null==n&&(n=0),null==o&&(o=0),null==s&&(s=0),null==i&&(i=0),null==t&&(t=1),this.e00=t,this.e01=i,this.e02=s,this.e03=o,this.e10=n,this.e11=e,this.e12=r,this.e13=_,this.e20=l,this.e21=h,this.e22=c,this.e23=m,this.e30=b,this.e31=p,this.e32=x,this.e33=f,a.common.Mat4.numCreations++}init(t,i,s,a,o,n,e,r,_,l,h,c,m,b,p,x){return this.e00=t,this.e01=i,this.e02=s,this.e03=a,this.e10=o,this.e11=n,this.e12=e,this.e13=r,this.e20=_,this.e21=l,this.e22=h,this.e23=c,this.e30=m,this.e31=b,this.e32=p,this.e33=x,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=1,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=1,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}add(t){return new a.common.Mat4(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e03+t.e03,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e13+t.e13,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22,this.e23+t.e23,this.e30+t.e30,this.e31+t.e31,this.e32+t.e32,this.e33+t.e33)}sub(t){return new a.common.Mat4(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e03-t.e03,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e13-t.e13,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22,this.e23-t.e23,this.e30-t.e30,this.e31-t.e31,this.e32-t.e32,this.e33-t.e33)}scale(t){return new a.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*t,this.e11*t,this.e12*t,this.e13*t,this.e20*t,this.e21*t,this.e22*t,this.e23*t,this.e30*t,this.e31*t,this.e32*t,this.e33*t)}mul(t){return new a.common.Mat4(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33)}addEq(t){return this.e00+=t.e00,this.e01+=t.e01,this.e02+=t.e02,this.e03+=t.e03,this.e10+=t.e10,this.e11+=t.e11,this.e12+=t.e12,this.e13+=t.e13,this.e20+=t.e20,this.e21+=t.e21,this.e22+=t.e22,this.e23+=t.e23,this.e30+=t.e30,this.e31+=t.e31,this.e32+=t.e32,this.e33+=t.e33,this}subEq(t){return this.e00-=t.e00,this.e01-=t.e01,this.e02-=t.e02,this.e03-=t.e03,this.e10-=t.e10,this.e11-=t.e11,this.e12-=t.e12,this.e13-=t.e13,this.e20-=t.e20,this.e21-=t.e21,this.e22-=t.e22,this.e23-=t.e23,this.e30-=t.e30,this.e31-=t.e31,this.e32-=t.e32,this.e33-=t.e33,this}scaleEq(t){return this.e00*=t,this.e01*=t,this.e02*=t,this.e03*=t,this.e10*=t,this.e11*=t,this.e12*=t,this.e13*=t,this.e20*=t,this.e21*=t,this.e22*=t,this.e23*=t,this.e30*=t,this.e31*=t,this.e32*=t,this.e33*=t,this}mulEq(t){let i=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,s=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,a=this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,o=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,n=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,e=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,r=this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,_=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,l=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,h=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,c=this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,m=this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,b=this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,p=this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,x=this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e01=i,this.e02=s,this.e03=a,this.e10=o,this.e11=n,this.e12=e,this.e13=r,this.e20=_,this.e21=l,this.e22=h,this.e23=c,this.e30=m,this.e31=b,this.e32=p,this.e33=x,this}prependScale(t,i,s){return new a.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*i,this.e11*i,this.e12*i,this.e13*i,this.e20*s,this.e21*s,this.e22*s,this.e23*s,this.e30,this.e31,this.e32,this.e33)}appendScale(t,i,s){return new a.common.Mat4(this.e00*t,this.e01*i,this.e02*s,this.e03,this.e10*t,this.e11*i,this.e12*s,this.e13,this.e20*t,this.e21*i,this.e22*s,this.e23,this.e30*t,this.e31*i,this.e32*s,this.e33)}prependRotation(t,i,s,o){let n=Math.sin(t),e=Math.cos(t),r=1-e,_=i*i*r+e,l=i*s*r-o*n,h=i*o*r+s*n,c=s*i*r+o*n,m=s*s*r+e,b=s*o*r-i*n,p=o*i*r-s*n,x=o*s*r+i*n,f=o*o*r+e;return new a.common.Mat4(_*this.e00+l*this.e10+h*this.e20,_*this.e01+l*this.e11+h*this.e21,_*this.e02+l*this.e12+h*this.e22,_*this.e03+l*this.e13+h*this.e23,c*this.e00+m*this.e10+b*this.e20,c*this.e01+m*this.e11+b*this.e21,c*this.e02+m*this.e12+b*this.e22,c*this.e03+m*this.e13+b*this.e23,p*this.e00+x*this.e10+f*this.e20,p*this.e01+x*this.e11+f*this.e21,p*this.e02+x*this.e12+f*this.e22,p*this.e03+x*this.e13+f*this.e23,this.e30,this.e31,this.e32,this.e33)}appendRotation(t,i,s,o){let n=Math.sin(t),e=Math.cos(t),r=1-e,_=i*i*r+e,l=i*s*r-o*n,h=i*o*r+s*n,c=s*i*r+o*n,m=s*s*r+e,b=s*o*r-i*n,p=o*i*r-s*n,x=o*s*r+i*n,f=o*o*r+e;return new a.common.Mat4(this.e00*_+this.e01*c+this.e02*p,this.e00*l+this.e01*m+this.e02*x,this.e00*h+this.e01*b+this.e02*f,this.e03,this.e10*_+this.e11*c+this.e12*p,this.e10*l+this.e11*m+this.e12*x,this.e10*h+this.e11*b+this.e12*f,this.e13,this.e20*_+this.e21*c+this.e22*p,this.e20*l+this.e21*m+this.e22*x,this.e20*h+this.e21*b+this.e22*f,this.e23,this.e30*_+this.e31*c+this.e32*p,this.e30*l+this.e31*m+this.e32*x,this.e30*h+this.e31*b+this.e32*f,this.e33)}prependTranslation(t,i,s){return new a.common.Mat4(this.e00+t*this.e30,this.e01+t*this.e31,this.e02+t*this.e32,this.e03+t*this.e33,this.e10+i*this.e30,this.e11+i*this.e31,this.e12+i*this.e32,this.e13+i*this.e33,this.e20+s*this.e30,this.e21+s*this.e31,this.e22+s*this.e32,this.e23+s*this.e33,this.e30,this.e31,this.e32,this.e33)}appendTranslation(t,i,s){return new a.common.Mat4(this.e00,this.e01,this.e02,this.e00*t+this.e01*i+this.e02*s+this.e03,this.e10,this.e11,this.e12,this.e10*t+this.e11*i+this.e12*s+this.e13,this.e20,this.e21,this.e22,this.e20*t+this.e21*i+this.e22*s+this.e23,this.e30,this.e31,this.e32,this.e30*t+this.e31*i+this.e32*s+this.e33)}prependScaleEq(t,i,s){return this.e00*=t,this.e01*=t,this.e02*=t,this.e03*=t,this.e10*=i,this.e11*=i,this.e12*=i,this.e13*=i,this.e20*=s,this.e21*=s,this.e22*=s,this.e23*=s,this.e30=this.e30,this.e31=this.e31,this.e32=this.e32,this.e33=this.e33,this}appendScaleEq(t,i,s){return this.e00*=t,this.e01*=i,this.e02*=s,this.e03=this.e03,this.e10*=t,this.e11*=i,this.e12*=s,this.e13=this.e13,this.e20*=t,this.e21*=i,this.e22*=s,this.e23=this.e23,this.e30*=t,this.e31*=i,this.e32*=s,this.e33=this.e33,this}prependRotationEq(t,i,s,a){let o=Math.sin(t),n=Math.cos(t),e=1-n,r=i*i*e+n,_=i*s*e-a*o,l=i*a*e+s*o,h=s*i*e+a*o,c=s*s*e+n,m=s*a*e-i*o,b=a*i*e-s*o,p=a*s*e+i*o,x=a*a*e+n,f=h*this.e00+c*this.e10+m*this.e20,u=h*this.e01+c*this.e11+m*this.e21,y=h*this.e02+c*this.e12+m*this.e22,g=h*this.e03+c*this.e13+m*this.e23,v=b*this.e00+p*this.e10+x*this.e20,d=b*this.e01+p*this.e11+x*this.e21,X=b*this.e02+p*this.e12+x*this.e22,z=b*this.e03+p*this.e13+x*this.e23;return this.e00=r*this.e00+_*this.e10+l*this.e20,this.e01=r*this.e01+_*this.e11+l*this.e21,this.e02=r*this.e02+_*this.e12+l*this.e22,this.e03=r*this.e03+_*this.e13+l*this.e23,this.e10=f,this.e11=u,this.e12=y,this.e13=g,this.e20=v,this.e21=d,this.e22=X,this.e23=z,this.e30=this.e30,this.e31=this.e31,this.e32=this.e32,this.e33=this.e33,this}appendRotationEq(t,i,s,a){let o=Math.sin(t),n=Math.cos(t),e=1-n,r=i*i*e+n,_=i*s*e-a*o,l=i*a*e+s*o,h=s*i*e+a*o,c=s*s*e+n,m=s*a*e-i*o,b=a*i*e-s*o,p=a*s*e+i*o,x=a*a*e+n,f=this.e00*_+this.e01*c+this.e02*p,u=this.e00*l+this.e01*m+this.e02*x,y=this.e10*_+this.e11*c+this.e12*p,g=this.e10*l+this.e11*m+this.e12*x,v=this.e20*_+this.e21*c+this.e22*p,d=this.e20*l+this.e21*m+this.e22*x,X=this.e30*_+this.e31*c+this.e32*p,z=this.e30*l+this.e31*m+this.e32*x;return this.e00=this.e00*r+this.e01*h+this.e02*b,this.e01=f,this.e02=u,this.e03=this.e03,this.e10=this.e10*r+this.e11*h+this.e12*b,this.e11=y,this.e12=g,this.e13=this.e13,this.e20=this.e20*r+this.e21*h+this.e22*b,this.e21=v,this.e22=d,this.e23=this.e23,this.e30=this.e30*r+this.e31*h+this.e32*b,this.e31=X,this.e32=z,this.e33=this.e33,this}prependTranslationEq(t,i,s){return this.e00+=t*this.e30,this.e01+=t*this.e31,this.e02+=t*this.e32,this.e03+=t*this.e33,this.e10+=i*this.e30,this.e11+=i*this.e31,this.e12+=i*this.e32,this.e13+=i*this.e33,this.e20+=s*this.e30,this.e21+=s*this.e31,this.e22+=s*this.e32,this.e23+=s*this.e33,this.e30=this.e30,this.e31=this.e31,this.e32=this.e32,this.e33=this.e33,this}appendTranslationEq(t,i,s){let a=this.e00*t+this.e01*i+this.e02*s+this.e03,o=this.e10*t+this.e11*i+this.e12*s+this.e13,n=this.e20*t+this.e21*i+this.e22*s+this.e23,e=this.e30*t+this.e31*i+this.e32*s+this.e33;return this.e00=this.e00,this.e01=this.e01,this.e02=this.e02,this.e03=a,this.e10=this.e10,this.e11=this.e11,this.e12=this.e12,this.e13=o,this.e20=this.e20,this.e21=this.e21,this.e22=this.e22,this.e23=n,this.e30=this.e30,this.e31=this.e31,this.e32=this.e32,this.e33=e,this}transpose(){return new a.common.Mat4(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)}transposeEq(){let t=this.e01,i=this.e02,s=this.e12,a=this.e03,o=this.e13,n=this.e23;return this.e00=this.e00,this.e01=this.e10,this.e02=this.e20,this.e03=this.e30,this.e10=t,this.e11=this.e11,this.e12=this.e21,this.e13=this.e31,this.e20=i,this.e21=s,this.e22=this.e22,this.e23=this.e32,this.e30=a,this.e31=o,this.e32=n,this.e33=this.e33,this}determinant(){let t=this.e20*this.e31-this.e21*this.e30,i=this.e20*this.e32-this.e22*this.e30,s=this.e20*this.e33-this.e23*this.e30,a=this.e21*this.e32-this.e22*this.e31,o=this.e21*this.e33-this.e23*this.e31,n=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*n-this.e12*o+this.e13*a)-this.e01*(this.e10*n-this.e12*s+this.e13*i)+this.e02*(this.e10*o-this.e11*s+this.e13*t)-this.e03*(this.e10*a-this.e11*i+this.e12*t)}trace(){return this.e00+this.e11+this.e22+this.e33}inverse(){let t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,s=this.e00*this.e13-this.e03*this.e10,o=this.e01*this.e12-this.e02*this.e11,n=this.e01*this.e13-this.e03*this.e11,e=this.e02*this.e13-this.e03*this.e12,r=this.e20*this.e31-this.e21*this.e30,_=this.e20*this.e32-this.e22*this.e30,l=this.e20*this.e33-this.e23*this.e30,h=this.e21*this.e32-this.e22*this.e31,c=this.e21*this.e33-this.e23*this.e31,m=this.e22*this.e33-this.e23*this.e32,b=this.e11*m-this.e12*c+this.e13*h,p=this.e10*m-this.e12*l+this.e13*_,x=this.e10*c-this.e11*l+this.e13*r,f=this.e10*h-this.e11*_+this.e12*r,u=this.e00*b-this.e01*p+this.e02*x-this.e03*f;return 0!=u&&(u=1/u),new a.common.Mat4(b*u,-(this.e01*m-this.e02*c+this.e03*h)*u,(this.e31*e-this.e32*n+this.e33*o)*u,-(this.e21*e-this.e22*n+this.e23*o)*u,-p*u,(this.e00*m-this.e02*l+this.e03*_)*u,-(this.e30*e-this.e32*s+this.e33*i)*u,(this.e20*e-this.e22*s+this.e23*i)*u,x*u,-(this.e00*c-this.e01*l+this.e03*r)*u,(this.e30*n-this.e31*s+this.e33*t)*u,-(this.e20*n-this.e21*s+this.e23*t)*u,-f*u,(this.e00*h-this.e01*_+this.e02*r)*u,-(this.e30*o-this.e31*i+this.e32*t)*u,(this.e20*o-this.e21*i+this.e22*t)*u)}inverseEq(){let t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,s=this.e00*this.e13-this.e03*this.e10,a=this.e01*this.e12-this.e02*this.e11,o=this.e01*this.e13-this.e03*this.e11,n=this.e02*this.e13-this.e03*this.e12,e=this.e20*this.e31-this.e21*this.e30,r=this.e20*this.e32-this.e22*this.e30,_=this.e20*this.e33-this.e23*this.e30,l=this.e21*this.e32-this.e22*this.e31,h=this.e21*this.e33-this.e23*this.e31,c=this.e22*this.e33-this.e23*this.e32,m=this.e11*c-this.e12*h+this.e13*l,b=this.e10*c-this.e12*_+this.e13*r,p=this.e10*h-this.e11*_+this.e13*e,x=this.e10*l-this.e11*r+this.e12*e,f=this.e00*m-this.e01*b+this.e02*p-this.e03*x;0!=f&&(f=1/f);let u=(this.e00*c-this.e02*_+this.e03*r)*f,y=-(this.e00*h-this.e01*_+this.e03*e)*f,g=-(this.e20*o-this.e21*s+this.e23*t)*f,v=(this.e00*l-this.e01*r+this.e02*e)*f,d=-(this.e30*a-this.e31*i+this.e32*t)*f,X=(this.e20*a-this.e21*i+this.e22*t)*f;return this.e00=m*f,this.e01=-(this.e01*c-this.e02*h+this.e03*l)*f,this.e02=(this.e31*n-this.e32*o+this.e33*a)*f,this.e03=-(this.e21*n-this.e22*o+this.e23*a)*f,this.e10=-b*f,this.e11=u,this.e12=-(this.e30*n-this.e32*s+this.e33*i)*f,this.e13=(this.e20*n-this.e22*s+this.e23*i)*f,this.e20=p*f,this.e21=y,this.e22=(this.e30*o-this.e31*s+this.e33*t)*f,this.e23=g,this.e30=-x*f,this.e31=v,this.e32=d,this.e33=X,this}lookAt(t,i,s,a,o,n,e,r,_){let l=t-a,h=i-o,c=s-n,m=1/Math.sqrt(l*l+h*h+c*c);l*=m,h*=m,c*=m;let b=r*c-_*h,p=_*l-e*c,x=e*h-r*l;m=1/Math.sqrt(b*b+p*p+x*x),b*=m,p*=m,x*=m;let f=h*x-c*p,u=c*b-l*x,y=l*p-h*b;return this.e00=b,this.e01=p,this.e02=x,this.e03=-(b*t+p*i+x*s),this.e10=f,this.e11=u,this.e12=y,this.e13=-(f*t+u*i+y*s),this.e20=l,this.e21=h,this.e22=c,this.e23=-(l*t+h*i+c*s),this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}perspective(t,i,s,a){let o=1/Math.tan(.5*t),n=a/(s-a);return this.e00=o/i,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=o,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=n,this.e23=s*n,this.e30=0,this.e31=0,this.e32=-1,this.e33=0,this}ortho(t,i,s,a){let o=1/(s-a);return this.e00=2/t,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=2/i,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=o,this.e23=s*o,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}toArray(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]:[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=t.e03,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=t.e13,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=t.e23,this.e30=t.e30,this.e31=t.e31,this.e32=t.e32,this.e33=t.e33,this}fromMat3(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=0,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=0,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}fromTransform(t){return this.e00=t._rotation00,this.e01=t._rotation01,this.e02=t._rotation02,this.e10=t._rotation10,this.e11=t._rotation11,this.e12=t._rotation12,this.e20=t._rotation20,this.e21=t._rotation21,this.e22=t._rotation22,this.e03=t._positionX,this.e13=t._positionY,this.e23=t._positionZ,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}clone(){return new a.common.Mat4(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)}toString(){return"Mat4["+(this.e00>0?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(this.e01>0?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(this.e02>0?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+", "+(this.e03>0?(1e7*this.e03+.5|0)/1e7:(1e7*this.e03-.5|0)/1e7)+",\n    "+(this.e10>0?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(this.e11>0?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(this.e12>0?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+", "+(this.e13>0?(1e7*this.e13+.5|0)/1e7:(1e7*this.e13-.5|0)/1e7)+",\n    "+(this.e20>0?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(this.e21>0?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(this.e22>0?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+", "+(this.e23>0?(1e7*this.e23+.5|0)/1e7:(1e7*this.e23-.5|0)/1e7)+",\n    "+(this.e30>0?(1e7*this.e30+.5|0)/1e7:(1e7*this.e30-.5|0)/1e7)+", "+(this.e31>0?(1e7*this.e31+.5|0)/1e7:(1e7*this.e31-.5|0)/1e7)+", "+(this.e32>0?(1e7*this.e32+.5|0)/1e7:(1e7*this.e32-.5|0)/1e7)+", "+(this.e33>0?(1e7*this.e33+.5|0)/1e7:(1e7*this.e33-.5|0)/1e7)+"]"}},a.common.MathUtil=class{static abs(t){return t>0?t:-t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static tan(t){return Math.tan(t)}static asin(t){return Math.asin(t)}static acos(t){return Math.acos(t)}static atan(t){return Math.atan(t)}static safeAsin(t){return t<=-1?-1.570796326794895:t>=1?1.570796326794895:Math.asin(t)}static safeAcos(t){return t<=-1?3.14159265358979:t>=1?0:Math.acos(t)}static atan2(t,i){return Math.atan2(t,i)}static sqrt(t){return Math.sqrt(t)}static clamp(t,i,s){return t<i?i:t>s?s:t}static rand(){return Math.random()}static randIn(t,i){return t+Math.random()*(i-t)}static randVec3In(t,i){return new a.common.Vec3(t+Math.random()*(i-t),t+Math.random()*(i-t),t+Math.random()*(i-t))}static randVec3(){return new a.common.Vec3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1)}},a.common.Pool=class{constructor(){this.stackVec3=new Array(256),this.sizeVec3=0,this.stackMat3=new Array(256),this.sizeMat3=0,this.stackMat4=new Array(256),this.sizeMat4=0,this.stackQuat=new Array(256),this.sizeQuat=0}vec3(){return 0==this.sizeVec3?new a.common.Vec3:this.stackVec3[--this.sizeVec3]}mat3(){return 0==this.sizeMat3?new a.common.Mat3:this.stackMat3[--this.sizeMat3]}mat4(){return 0==this.sizeMat4?new a.common.Mat4:this.stackMat4[--this.sizeMat4]}quat(){return 0==this.sizeQuat?new a.common.Quat:this.stackQuat[--this.sizeQuat]}dispose(t,i,s,a){if(null!=t){if(t.zero(),this.sizeVec3==this.stackVec3.length){let t=new Array(this.sizeVec3<<1),i=0,s=this.sizeVec3;for(;i<s;){let s=i++;t[s]=this.stackVec3[s],this.stackVec3[s]=null}this.stackVec3=t}this.stackVec3[this.sizeVec3++]=t}if(null!=i){if(i.e00=1,i.e01=0,i.e02=0,i.e10=0,i.e11=1,i.e12=0,i.e20=0,i.e21=0,i.e22=1,this.sizeMat3==this.stackMat3.length){let t=new Array(this.sizeMat3<<1),i=0,s=this.sizeMat3;for(;i<s;){let s=i++;t[s]=this.stackMat3[s],this.stackMat3[s]=null}this.stackMat3=t}this.stackMat3[this.sizeMat3++]=i}if(null!=s){if(s.e00=1,s.e01=0,s.e02=0,s.e03=0,s.e10=0,s.e11=1,s.e12=0,s.e13=0,s.e20=0,s.e21=0,s.e22=1,s.e23=0,s.e30=0,s.e31=0,s.e32=0,s.e33=1,this.sizeMat4==this.stackMat4.length){let t=new Array(this.sizeMat4<<1),i=0,s=this.sizeMat4;for(;i<s;){let s=i++;t[s]=this.stackMat4[s],this.stackMat4[s]=null}this.stackMat4=t}this.stackMat4[this.sizeMat4++]=s}if(null!=a){if(a.x=0,a.y=0,a.z=0,a.w=1,this.sizeQuat==this.stackQuat.length){let t=new Array(this.sizeQuat<<1),i=0,s=this.sizeQuat;for(;i<s;){let s=i++;t[s]=this.stackQuat[s],this.stackQuat[s]=null}this.stackQuat=t}this.stackQuat[this.sizeQuat++]=a}}disposeVec3(t){if(t.zero(),this.sizeVec3==this.stackVec3.length){let t=new Array(this.sizeVec3<<1),i=0,s=this.sizeVec3;for(;i<s;){let s=i++;t[s]=this.stackVec3[s],this.stackVec3[s]=null}this.stackVec3=t}this.stackVec3[this.sizeVec3++]=t}disposeMat3(t){if(t.e00=1,t.e01=0,t.e02=0,t.e10=0,t.e11=1,t.e12=0,t.e20=0,t.e21=0,t.e22=1,this.sizeMat3==this.stackMat3.length){let t=new Array(this.sizeMat3<<1),i=0,s=this.sizeMat3;for(;i<s;){let s=i++;t[s]=this.stackMat3[s],this.stackMat3[s]=null}this.stackMat3=t}this.stackMat3[this.sizeMat3++]=t}disposeMat4(t){if(t.e00=1,t.e01=0,t.e02=0,t.e03=0,t.e10=0,t.e11=1,t.e12=0,t.e13=0,t.e20=0,t.e21=0,t.e22=1,t.e23=0,t.e30=0,t.e31=0,t.e32=0,t.e33=1,this.sizeMat4==this.stackMat4.length){let t=new Array(this.sizeMat4<<1),i=0,s=this.sizeMat4;for(;i<s;){let s=i++;t[s]=this.stackMat4[s],this.stackMat4[s]=null}this.stackMat4=t}this.stackMat4[this.sizeMat4++]=t}disposeQuat(t){if(t.x=0,t.y=0,t.z=0,t.w=1,this.sizeQuat==this.stackQuat.length){let t=new Array(this.sizeQuat<<1),i=0,s=this.sizeQuat;for(;i<s;){let s=i++;t[s]=this.stackQuat[s],this.stackQuat[s]=null}this.stackQuat=t}this.stackQuat[this.sizeQuat++]=t}},a.common.Quat=class{constructor(t,i,s,o){null==o&&(o=1),null==s&&(s=0),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.z=s,this.w=o,a.common.Quat.numCreations++}identity(){return this.x=0,this.y=0,this.z=0,this.w=1,this}init(t,i,s,a){return this.x=t,this.y=i,this.z=s,this.w=a,this}add(t){return new a.common.Quat(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}sub(t){return new a.common.Quat(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}scale(t){return new a.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)}addEq(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}subEq(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}scaleEq(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}normalized(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),new a.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}setArc(t,i){let s=t.x,a=t.y,o=t.z,n=i.x,e=i.y,r=i.z,_=s*n+a*e+o*r;return this.w=Math.sqrt(.5*(1+_)),0==this.w?(n=s*s,e=a*a,r=o*o,n<e?n<r?(_=1/Math.sqrt(e+r),this.x=0,this.y=o*_,this.z=-a*_):(_=1/Math.sqrt(n+e),this.z=0,this.x=a*_,this.y=-s*_):e<r?(_=1/Math.sqrt(r+n),this.y=0,this.z=s*_,this.x=-o*_):(_=1/Math.sqrt(n+e),this.z=0,this.x=a*_,this.y=-s*_),this):(_=.5/this.w,this.x=(a*r-o*e)*_,this.y=(o*n-s*r)*_,this.z=(s*e-a*n)*_,this)}slerp(t,i){let s,o,n,e,r=this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;if(r<0?(r=-r,s=-t.x,o=-t.y,n=-t.z,e=-t.w):(s=t.x,o=t.y,n=t.z,e=t.w),r>.999999){let t=new a.common.Quat(this.x+(s-this.x)*i,this.y+(o-this.y)*i,this.z+(n-this.z)*i,this.w+(e-this.w)*i),r=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w);return r>0&&(r=1/r),t.x*=r,t.y*=r,t.z*=r,t.w*=r,t}let _=i*Math.acos(r);s-=this.x*r,o-=this.y*r,n-=this.z*r,e-=this.w*r;let l=1/Math.sqrt(s*s+o*o+n*n+e*e);s*=l,o*=l,n*=l,e*=l;let h=Math.sin(_),c=Math.cos(_);return new a.common.Quat(this.x*c+s*h,this.y*c+o*h,this.z*c+n*h,this.w*c+e*h)}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}clone(){return new a.common.Quat(this.x,this.y,this.z,this.w)}fromMat3(t){let i,s=t.e00,a=t.e11,o=t.e22,n=s+a+o;return n>0?(i=Math.sqrt(n+1),this.w=.5*i,i=.5/i,this.x=(t.e21-t.e12)*i,this.y=(t.e02-t.e20)*i,this.z=(t.e10-t.e01)*i):s>a?s>o?(i=Math.sqrt(s-a-o+1),this.x=.5*i,i=.5/i,this.y=(t.e01+t.e10)*i,this.z=(t.e02+t.e20)*i,this.w=(t.e21-t.e12)*i):(i=Math.sqrt(o-s-a+1),this.z=.5*i,i=.5/i,this.x=(t.e02+t.e20)*i,this.y=(t.e12+t.e21)*i,this.w=(t.e10-t.e01)*i):a>o?(i=Math.sqrt(a-o-s+1),this.y=.5*i,i=.5/i,this.x=(t.e01+t.e10)*i,this.z=(t.e12+t.e21)*i,this.w=(t.e02-t.e20)*i):(i=Math.sqrt(o-s-a+1),this.z=.5*i,i=.5/i,this.x=(t.e02+t.e20)*i,this.y=(t.e12+t.e21)*i,this.w=(t.e10-t.e01)*i),this}toMat3(){let t=new a.common.Mat3,i=this.x,s=this.y,o=this.z,n=this.w,e=2*i,r=2*s,_=2*o,l=i*e,h=s*r,c=o*_,m=i*r,b=s*_,p=i*_,x=n*e,f=n*r,u=n*_;return t.e00=1-h-c,t.e01=m-u,t.e02=p+f,t.e10=m+u,t.e11=1-l-c,t.e12=b-x,t.e20=p-f,t.e21=b+x,t.e22=1-l-h,t}toString(){return"Quat["+(this.x>0?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+" i,\n    "+(this.y>0?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+" j,\n    "+(this.z>0?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+" k,\n    "+(this.w>0?(1e7*this.w+.5|0)/1e7:(1e7*this.w-.5|0)/1e7)+"]"}},a.dynamics||(a.dynamics={}),a.dynamics.Contact=class{constructor(){this._next=null,this._prev=null,this._link1=new a.dynamics.ContactLink,this._link2=new a.dynamics.ContactLink,this._s1=null,this._s2=null,this._b1=null,this._b2=null,this._detector=null,this._cachedDetectorData=new a.collision.narrowphase.detector.CachedDetectorData,this._detectorResult=new a.collision.narrowphase.DetectorResult,this._latest=!1,this._shouldBeSkipped=!1,this._manifold=new a.dynamics.constraint.contact.Manifold,this._updater=new a.dynamics.constraint.contact.ManifoldUpdater(this._manifold),this._contactConstraint=new a.dynamics.constraint.contact.ContactConstraint(this._manifold),this._touching=!1}_updateManifold(){if(null==this._detector)return;let t=this._touching,i=this._detectorResult;if(this._detector.detect(i,this._s1._geom,this._s2._geom,this._s1._transform,this._s2._transform,this._cachedDetectorData),this._touching=i.numPoints>0,this._touching?(this._manifold._buildBasis(i.normal),i.getMaxDepth()>a.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold?this._contactConstraint._positionCorrectionAlgorithm=a.common.Setting.alternativeContactPositionCorrectionAlgorithm:this._contactConstraint._positionCorrectionAlgorithm=a.common.Setting.defaultContactPositionCorrectionAlgorithm,i.incremental?this._updater.incrementalUpdate(i,this._b1._transform,this._b2._transform):this._updater.totalUpdate(i,this._b1._transform,this._b2._transform)):this._manifold._clear(),this._touching&&!t){let t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.beginContact(this),null!=i&&i.beginContact(this)}if(!this._touching&&t){let t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.endContact(this),null!=i&&i.endContact(this)}if(this._touching){let t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.preSolve(this),null!=i&&i.preSolve(this)}}_postSolve(){let t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.postSolve(this),null!=i&&i.postSolve(this)}getShape1(){return this._s1}getShape2(){return this._s2}isTouching(){return this._touching}getManifold(){return this._manifold}getContactConstraint(){return this._contactConstraint}getPrev(){return this._prev}getNext(){return this._next}},a.dynamics.ContactLink=class{constructor(){this._prev=null,this._next=null,this._contact=null,this._other=null}getContact(){return this._contact}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}},a.dynamics.ContactManager=class{constructor(t){this._broadPhase=t,this._collisionMatrix=new a.collision.narrowphase.CollisionMatrix,this._numContacts=0}createContacts(){let t=this._broadPhase._proxyPairList;for(;null!=t;){let i=t._next;for(;;){let i,s;if(t._p1._id<t._p2._id?(i=t._p1.userData,s=t._p2.userData):(i=t._p2.userData,s=t._p1.userData),!this.shouldCollide(i,s))break;let o,n=i._rigidBody,e=s._rigidBody;o=n._numContactLinks<e._numContactLinks?n._contactLinkList:e._contactLinkList;let r=i._id,_=s._id,l=!1;for(;null!=o;){let t=o._contact;if(t._s1._id==r&&t._s2._id==_){t._latest=!0,l=!0;break}o=o._next}if(!l){let t=this._contactPool;null!=t?(this._contactPool=t._next,t._next=null):t=new a.dynamics.Contact;let o=t;null==this._contactList?(this._contactList=o,this._contactListLast=o):(this._contactListLast._next=o,o._prev=this._contactListLast,this._contactListLast=o),o._latest=!0;let n=this._collisionMatrix.detectors[i._geom._type][s._geom._type];o._s1=i,o._s2=s,o._b1=i._rigidBody,o._b2=s._rigidBody,o._touching=!1,null==o._b1._contactLinkList?(o._b1._contactLinkList=o._link1,o._b1._contactLinkListLast=o._link1):(o._b1._contactLinkListLast._next=o._link1,o._link1._prev=o._b1._contactLinkListLast,o._b1._contactLinkListLast=o._link1),null==o._b2._contactLinkList?(o._b2._contactLinkList=o._link2,o._b2._contactLinkListLast=o._link2):(o._b2._contactLinkListLast._next=o._link2,o._link2._prev=o._b2._contactLinkListLast,o._b2._contactLinkListLast=o._link2),o._b1._numContactLinks++,o._b2._numContactLinks++,o._link1._other=o._b2,o._link2._other=o._b1,o._link1._contact=o,o._link2._contact=o,o._detector=n;let e=o._contactConstraint;e._s1=i,e._s2=s,e._b1=e._s1._rigidBody,e._b2=e._s2._rigidBody,e._tf1=e._b1._transform,e._tf2=e._b2._transform,this._numContacts++}break}t=i}}destroyOutdatedContacts(){let t=this._broadPhase._incremental,i=this._contactList;for(;null!=i;){let s=i._next;for(;;){if(i._latest){i._latest=!1,i._shouldBeSkipped=!1;break}if(!t){let t=i._prev,s=i._next;if(null!=t&&(t._next=s),null!=s&&(s._prev=t),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){let t=i._s1._contactCallback,s=i._s2._contactCallback;t==s&&(s=null),null!=t&&t.endContact(i),null!=s&&s.endContact(i)}let a=i._link1._prev,o=i._link1._next;null!=a&&(a._next=o),null!=o&&(o._prev=a),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;let n=i._link2._prev,e=i._link2._next;null!=n&&(n._next=e),null!=e&&(e._prev=n),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;let r=i._contactConstraint;r._s1=null,r._s2=null,r._b1=null,r._b2=null,r._tf1=null,r._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}let s=i._s1,a=i._s2,o=s._rigidBody,n=a._rigidBody;if((o._sleeping||1==o._type)&&(n._sleeping||1==n._type)){i._shouldBeSkipped=!0;break}let e=s._aabb,r=a._aabb,_=s._proxy,l=a._proxy;if(!(_._aabbMinX<l._aabbMaxX&&_._aabbMaxX>l._aabbMinX&&_._aabbMinY<l._aabbMaxY&&_._aabbMaxY>l._aabbMinY&&_._aabbMinZ<l._aabbMaxZ&&_._aabbMaxZ>l._aabbMinZ&&this.shouldCollide(s,a))){let t=i._prev,s=i._next;if(null!=t&&(t._next=s),null!=s&&(s._prev=t),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){let t=i._s1._contactCallback,s=i._s2._contactCallback;t==s&&(s=null),null!=t&&t.endContact(i),null!=s&&s.endContact(i)}let a=i._link1._prev,o=i._link1._next;null!=a&&(a._next=o),null!=o&&(o._prev=a),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;let n=i._link2._prev,e=i._link2._next;null!=n&&(n._next=e),null!=e&&(e._prev=n),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;let r=i._contactConstraint;r._s1=null,r._s2=null,r._b1=null,r._b2=null,r._tf1=null,r._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}i._shouldBeSkipped=!(e._minX<r._maxX&&e._maxX>r._minX&&e._minY<r._maxY&&e._maxY>r._minY&&e._minZ<r._maxZ&&e._maxZ>r._minZ);break}i=s}}shouldCollide(t,i){let s,a,o=t._rigidBody,n=i._rigidBody;if(o==n)return!1;if(0!=o._type&&0!=n._type)return!1;if(!(t._collisionGroup&i._collisionMask&&i._collisionGroup&t._collisionMask))return!1;for(o._numJointLinks<n._numJointLinks?(s=o._jointLinkList,a=n):(s=n._jointLinkList,a=o);null!=s;){if(s._other==a&&!s._joint._allowCollision)return!1;s=s._next}return!0}_updateContacts(){this._broadPhase.collectPairs(),this.createContacts(),this.destroyOutdatedContacts()}_postSolve(){let t=this._contactList;for(;null!=t;){let i=t._next;t._touching&&t._postSolve(),t=i}}getNumContacts(){return this._numContacts}getContactList(){return this._contactList}},a.dynamics.Island=class{constructor(){this.rigidBodies=new Array(a.common.Setting.islandInitialRigidBodyArraySize),this.solvers=new Array(a.common.Setting.islandInitialConstraintArraySize),this.solversSi=new Array(a.common.Setting.islandInitialConstraintArraySize),this.solversNgs=new Array(a.common.Setting.islandInitialConstraintArraySize),this.numRigidBodies=0,this.numSolvers=0,this.numSolversSi=0,this.numSolversNgs=0}_clear(){for(;this.numRigidBodies>0;)this.rigidBodies[--this.numRigidBodies]=null;for(;this.numSolvers>0;)this.solvers[--this.numSolvers]=null;for(;this.numSolversSi>0;)this.solversSi[--this.numSolversSi]=null;for(;this.numSolversNgs>0;)this.solversNgs[--this.numSolversNgs]=null}_addRigidBody(t){if(this.numRigidBodies==this.rigidBodies.length){let t=new Array(this.numRigidBodies<<1),i=0,s=this.numRigidBodies;for(;i<s;){let s=i++;t[s]=this.rigidBodies[s],this.rigidBodies[s]=null}this.rigidBodies=t}t._addedToIsland=!0,this.rigidBodies[this.numRigidBodies++]=t}_addConstraintSolver(t,i){if(this.numSolvers==this.solvers.length){let t=new Array(this.numSolvers<<1),i=0,s=this.numSolvers;for(;i<s;){let s=i++;t[s]=this.solvers[s],this.solvers[s]=null}this.solvers=t}if(t._addedToIsland=!0,this.solvers[this.numSolvers++]=t,i==a.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE){if(this.numSolversSi==this.solversSi.length){let t=new Array(this.numSolversSi<<1),i=0,s=this.numSolversSi;for(;i<s;){let s=i++;t[s]=this.solversSi[s],this.solversSi[s]=null}this.solversSi=t}this.solversSi[this.numSolversSi++]=t}if(i==a.dynamics.constraint.PositionCorrectionAlgorithm.NGS){if(this.numSolversNgs==this.solversNgs.length){let t=new Array(this.numSolversNgs<<1),i=0,s=this.numSolversNgs;for(;i<s;){let s=i++;t[s]=this.solversNgs[s],this.solversNgs[s]=null}this.solversNgs=t}this.solversNgs[this.numSolversNgs++]=t}}_stepSingleRigidBody(t,i){let s=t.dt,o=i._ptransform,n=i._transform;if(o._positionX=n._positionX,o._positionY=n._positionY,o._positionZ=n._positionZ,o._rotation00=n._rotation00,o._rotation01=n._rotation01,o._rotation02=n._rotation02,o._rotation10=n._rotation10,o._rotation11=n._rotation11,o._rotation12=n._rotation12,o._rotation20=n._rotation20,o._rotation21=n._rotation21,o._rotation22=n._rotation22,i._linearContactImpulseX=0,i._linearContactImpulseY=0,i._linearContactImpulseZ=0,i._angularContactImpulseX=0,i._angularContactImpulseY=0,i._angularContactImpulseZ=0,i._autoSleep&&i._velX*i._velX+i._velY*i._velY+i._velZ*i._velZ<a.common.Setting.sleepingVelocityThreshold*a.common.Setting.sleepingVelocityThreshold&&i._angVelX*i._angVelX+i._angVelY*i._angVelY+i._angVelZ*i._angVelZ<a.common.Setting.sleepingAngularVelocityThreshold*a.common.Setting.sleepingAngularVelocityThreshold?(i._sleepTime+=s,i._sleepTime>a.common.Setting.sleepingTimeThreshold&&(i._sleeping=!0,i._sleepTime=0)):i._sleepTime=0,!i._sleeping){if(0==i._type){let t,a,o,n,e,r,_,l,h,c=s*i._linearDamping,m=c*c,b=1/(1+c+m*(.5+.16666666666666666*c+.041666666666666664*m)),p=s*i._angularDamping,x=p*p,f=1/(1+p+x*(.5+.16666666666666666*p+.041666666666666664*x));t=this.gravityX*i._gravityScale,a=this.gravityY*i._gravityScale,o=this.gravityZ*i._gravityScale,t+=i._forceX*i._invMass,a+=i._forceY*i._invMass,o+=i._forceZ*i._invMass,_=i._invInertia00*i._torqueX+i._invInertia01*i._torqueY+i._invInertia02*i._torqueZ,l=i._invInertia10*i._torqueX+i._invInertia11*i._torqueY+i._invInertia12*i._torqueZ,h=i._invInertia20*i._torqueX+i._invInertia21*i._torqueY+i._invInertia22*i._torqueZ,n=_,e=l,r=h,i._velX+=t*s,i._velY+=a*s,i._velZ+=o*s,i._velX*=b,i._velY*=b,i._velZ*=b,i._angVelX+=n*s,i._angVelY+=e*s,i._angVelZ+=r*s,i._angVelX*=f,i._angVelY*=f,i._angVelZ*=f}i._integrate(s);let t=i._shapeList;for(;null!=t;){let s,a,o,n,e,r,_,l,h,c,m,b,p=t._next,x=i._ptransform,f=i._transform,u=t._ptransform,y=t._localTransform;s=x._rotation00*y._rotation00+x._rotation01*y._rotation10+x._rotation02*y._rotation20,a=x._rotation00*y._rotation01+x._rotation01*y._rotation11+x._rotation02*y._rotation21,o=x._rotation00*y._rotation02+x._rotation01*y._rotation12+x._rotation02*y._rotation22,n=x._rotation10*y._rotation00+x._rotation11*y._rotation10+x._rotation12*y._rotation20,e=x._rotation10*y._rotation01+x._rotation11*y._rotation11+x._rotation12*y._rotation21,r=x._rotation10*y._rotation02+x._rotation11*y._rotation12+x._rotation12*y._rotation22,_=x._rotation20*y._rotation00+x._rotation21*y._rotation10+x._rotation22*y._rotation20,l=x._rotation20*y._rotation01+x._rotation21*y._rotation11+x._rotation22*y._rotation21,h=x._rotation20*y._rotation02+x._rotation21*y._rotation12+x._rotation22*y._rotation22,u._rotation00=s,u._rotation01=a,u._rotation02=o,u._rotation10=n,u._rotation11=e,u._rotation12=r,u._rotation20=_,u._rotation21=l,u._rotation22=h,c=x._rotation00*y._positionX+x._rotation01*y._positionY+x._rotation02*y._positionZ,m=x._rotation10*y._positionX+x._rotation11*y._positionY+x._rotation12*y._positionZ,b=x._rotation20*y._positionX+x._rotation21*y._positionY+x._rotation22*y._positionZ,u._positionX=c,u._positionY=m,u._positionZ=b,u._positionX+=x._positionX,u._positionY+=x._positionY,u._positionZ+=x._positionZ;let g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T,C=t._transform,j=t._localTransform;if(g=f._rotation00*j._rotation00+f._rotation01*j._rotation10+f._rotation02*j._rotation20,v=f._rotation00*j._rotation01+f._rotation01*j._rotation11+f._rotation02*j._rotation21,d=f._rotation00*j._rotation02+f._rotation01*j._rotation12+f._rotation02*j._rotation22,X=f._rotation10*j._rotation00+f._rotation11*j._rotation10+f._rotation12*j._rotation20,z=f._rotation10*j._rotation01+f._rotation11*j._rotation11+f._rotation12*j._rotation21,Y=f._rotation10*j._rotation02+f._rotation11*j._rotation12+f._rotation12*j._rotation22,Z=f._rotation20*j._rotation00+f._rotation21*j._rotation10+f._rotation22*j._rotation20,M=f._rotation20*j._rotation01+f._rotation21*j._rotation11+f._rotation22*j._rotation21,I=f._rotation20*j._rotation02+f._rotation21*j._rotation12+f._rotation22*j._rotation22,C._rotation00=g,C._rotation01=v,C._rotation02=d,C._rotation10=X,C._rotation11=z,C._rotation12=Y,C._rotation20=Z,C._rotation21=M,C._rotation22=I,V=f._rotation00*j._positionX+f._rotation01*j._positionY+f._rotation02*j._positionZ,w=f._rotation10*j._positionX+f._rotation11*j._positionY+f._rotation12*j._positionZ,L=f._rotation20*j._positionX+f._rotation21*j._positionY+f._rotation22*j._positionZ,C._positionX=V,C._positionY=w,C._positionZ=L,C._positionX+=f._positionX,C._positionY+=f._positionY,C._positionZ+=f._positionZ,t._geom._computeAabb(t._aabb,t._ptransform),k=t._aabb._minX,A=t._aabb._minY,B=t._aabb._minZ,P=t._aabb._maxX,S=t._aabb._maxY,T=t._aabb._maxZ,t._geom._computeAabb(t._aabb,t._transform),t._aabb._minX=k<t._aabb._minX?k:t._aabb._minX,t._aabb._minY=A<t._aabb._minY?A:t._aabb._minY,t._aabb._minZ=B<t._aabb._minZ?B:t._aabb._minZ,t._aabb._maxX=P>t._aabb._maxX?P:t._aabb._maxX,t._aabb._maxY=S>t._aabb._maxY?S:t._aabb._maxY,t._aabb._maxZ=T>t._aabb._maxZ?T:t._aabb._maxZ,null!=t._proxy){let i,s,a;i=t._transform._positionX-t._ptransform._positionX,s=t._transform._positionY-t._ptransform._positionY,a=t._transform._positionZ-t._ptransform._positionZ;let o=t.displacement;o.x=i,o.y=s,o.z=a,t._rigidBody._world._broadPhase.moveProxy(t._proxy,t._aabb,t.displacement)}t=p}}}_step(t,i,s){let o=t.dt,n=!0,e=0,r=this.numRigidBodies;for(;e<r;){let t=this.rigidBodies[e++],i=t._ptransform,s=t._transform;if(i._positionX=s._positionX,i._positionY=s._positionY,i._positionZ=s._positionZ,i._rotation00=s._rotation00,i._rotation01=s._rotation01,i._rotation02=s._rotation02,i._rotation10=s._rotation10,i._rotation11=s._rotation11,i._rotation12=s._rotation12,i._rotation20=s._rotation20,i._rotation21=s._rotation21,i._rotation22=s._rotation22,t._linearContactImpulseX=0,t._linearContactImpulseY=0,t._linearContactImpulseZ=0,t._angularContactImpulseX=0,t._angularContactImpulseY=0,t._angularContactImpulseZ=0,t._sleeping=!1,t._autoSleep&&t._velX*t._velX+t._velY*t._velY+t._velZ*t._velZ<a.common.Setting.sleepingVelocityThreshold*a.common.Setting.sleepingVelocityThreshold&&t._angVelX*t._angVelX+t._angVelY*t._angVelY+t._angVelZ*t._angVelZ<a.common.Setting.sleepingAngularVelocityThreshold*a.common.Setting.sleepingAngularVelocityThreshold?t._sleepTime+=o:t._sleepTime=0,t._sleepTime<a.common.Setting.sleepingTimeThreshold&&(n=!1),0==t._type){let i,s,a,n,e,r,_,l,h,c=o*t._linearDamping,m=c*c,b=1/(1+c+m*(.5+.16666666666666666*c+.041666666666666664*m)),p=o*t._angularDamping,x=p*p,f=1/(1+p+x*(.5+.16666666666666666*p+.041666666666666664*x));i=this.gravityX*t._gravityScale,s=this.gravityY*t._gravityScale,a=this.gravityZ*t._gravityScale,i+=t._forceX*t._invMass,s+=t._forceY*t._invMass,a+=t._forceZ*t._invMass,_=t._invInertia00*t._torqueX+t._invInertia01*t._torqueY+t._invInertia02*t._torqueZ,l=t._invInertia10*t._torqueX+t._invInertia11*t._torqueY+t._invInertia12*t._torqueZ,h=t._invInertia20*t._torqueX+t._invInertia21*t._torqueY+t._invInertia22*t._torqueZ,n=_,e=l,r=h,t._velX+=i*o,t._velY+=s*o,t._velZ+=a*o,t._velX*=b,t._velY*=b,t._velZ*=b,t._angVelX+=n*o,t._angVelY+=e*o,t._angVelZ+=r*o,t._angVelX*=f,t._angVelY*=f,t._angVelZ*=f}}if(n){let t=0,i=this.numRigidBodies;for(;t<i;){let i=this.rigidBodies[t++];i._sleeping=!0,i._sleepTime=0}return}let _=0,l=this.numSolvers;for(;_<l;)this.solvers[_++].preSolveVelocity(t);let h=0,c=this.numSolvers;for(;h<c;)this.solvers[h++].warmStart(t);let m=0;for(;m<i;){++m;let t=0,i=this.numSolvers;for(;t<i;)this.solvers[t++].solveVelocity()}let b=0,p=this.numSolvers;for(;b<p;)this.solvers[b++].postSolveVelocity(t);let x=0,f=this.numRigidBodies;for(;x<f;)this.rigidBodies[x++]._integrate(o);let u=0,y=this.numSolversSi;for(;u<y;)this.solversSi[u++].preSolvePosition(t);let g=0;for(;g<s;){++g;let t=0,i=this.numSolversSi;for(;t<i;)this.solversSi[t++].solvePositionSplitImpulse()}let v=0,d=this.numRigidBodies;for(;v<d;)this.rigidBodies[v++]._integratePseudoVelocity();let X=0,z=this.numSolversNgs;for(;X<z;)this.solversNgs[X++].preSolvePosition(t);let Y=0;for(;Y<s;){++Y;let i=0,s=this.numSolversNgs;for(;i<s;)this.solversNgs[i++].solvePositionNgs(t)}let Z=0,M=this.numSolvers;for(;Z<M;)this.solvers[Z++].postSolve();let I=0,V=this.numRigidBodies;for(;I<V;){let t=this.rigidBodies[I++],i=t._shapeList;for(;null!=i;){let s,a,o,n,e,r,_,l,h,c,m,b,p=i._next,x=t._ptransform,f=t._transform,u=i._ptransform,y=i._localTransform;s=x._rotation00*y._rotation00+x._rotation01*y._rotation10+x._rotation02*y._rotation20,a=x._rotation00*y._rotation01+x._rotation01*y._rotation11+x._rotation02*y._rotation21,o=x._rotation00*y._rotation02+x._rotation01*y._rotation12+x._rotation02*y._rotation22,n=x._rotation10*y._rotation00+x._rotation11*y._rotation10+x._rotation12*y._rotation20,e=x._rotation10*y._rotation01+x._rotation11*y._rotation11+x._rotation12*y._rotation21,r=x._rotation10*y._rotation02+x._rotation11*y._rotation12+x._rotation12*y._rotation22,_=x._rotation20*y._rotation00+x._rotation21*y._rotation10+x._rotation22*y._rotation20,l=x._rotation20*y._rotation01+x._rotation21*y._rotation11+x._rotation22*y._rotation21,h=x._rotation20*y._rotation02+x._rotation21*y._rotation12+x._rotation22*y._rotation22,u._rotation00=s,u._rotation01=a,u._rotation02=o,u._rotation10=n,u._rotation11=e,u._rotation12=r,u._rotation20=_,u._rotation21=l,u._rotation22=h,c=x._rotation00*y._positionX+x._rotation01*y._positionY+x._rotation02*y._positionZ,m=x._rotation10*y._positionX+x._rotation11*y._positionY+x._rotation12*y._positionZ,b=x._rotation20*y._positionX+x._rotation21*y._positionY+x._rotation22*y._positionZ,u._positionX=c,u._positionY=m,u._positionZ=b,u._positionX+=x._positionX,u._positionY+=x._positionY,u._positionZ+=x._positionZ;let g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T,C=i._transform,j=i._localTransform;if(g=f._rotation00*j._rotation00+f._rotation01*j._rotation10+f._rotation02*j._rotation20,v=f._rotation00*j._rotation01+f._rotation01*j._rotation11+f._rotation02*j._rotation21,d=f._rotation00*j._rotation02+f._rotation01*j._rotation12+f._rotation02*j._rotation22,X=f._rotation10*j._rotation00+f._rotation11*j._rotation10+f._rotation12*j._rotation20,z=f._rotation10*j._rotation01+f._rotation11*j._rotation11+f._rotation12*j._rotation21,Y=f._rotation10*j._rotation02+f._rotation11*j._rotation12+f._rotation12*j._rotation22,Z=f._rotation20*j._rotation00+f._rotation21*j._rotation10+f._rotation22*j._rotation20,M=f._rotation20*j._rotation01+f._rotation21*j._rotation11+f._rotation22*j._rotation21,I=f._rotation20*j._rotation02+f._rotation21*j._rotation12+f._rotation22*j._rotation22,C._rotation00=g,C._rotation01=v,C._rotation02=d,C._rotation10=X,C._rotation11=z,C._rotation12=Y,C._rotation20=Z,C._rotation21=M,C._rotation22=I,V=f._rotation00*j._positionX+f._rotation01*j._positionY+f._rotation02*j._positionZ,w=f._rotation10*j._positionX+f._rotation11*j._positionY+f._rotation12*j._positionZ,L=f._rotation20*j._positionX+f._rotation21*j._positionY+f._rotation22*j._positionZ,C._positionX=V,C._positionY=w,C._positionZ=L,C._positionX+=f._positionX,C._positionY+=f._positionY,C._positionZ+=f._positionZ,i._geom._computeAabb(i._aabb,i._ptransform),k=i._aabb._minX,A=i._aabb._minY,B=i._aabb._minZ,P=i._aabb._maxX,S=i._aabb._maxY,T=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=k<i._aabb._minX?k:i._aabb._minX,i._aabb._minY=A<i._aabb._minY?A:i._aabb._minY,i._aabb._minZ=B<i._aabb._minZ?B:i._aabb._minZ,i._aabb._maxX=P>i._aabb._maxX?P:i._aabb._maxX,i._aabb._maxY=S>i._aabb._maxY?S:i._aabb._maxY,i._aabb._maxZ=T>i._aabb._maxZ?T:i._aabb._maxZ,null!=i._proxy){let t,s,a;t=i._transform._positionX-i._ptransform._positionX,s=i._transform._positionY-i._ptransform._positionY,a=i._transform._positionZ-i._ptransform._positionZ;let o=i.displacement;o.x=t,o.y=s,o.z=a,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=p}}}},a.dynamics.TimeStep=class{constructor(){this.dt=0,this.invDt=0,this.dtRatio=1}},a.dynamics.World=class{constructor(t,i){switch(null==t&&(t=2),t){case 1:this._broadPhase=new a.collision.broadphase.bruteforce.BruteForceBroadPhase;break;case 2:this._broadPhase=new a.collision.broadphase.bvh.BvhBroadPhase}this._contactManager=new a.dynamics.ContactManager(this._broadPhase),null==i&&(i=new a.common.Vec3(0,-9.80665,0)),this._gravity=new a.common.Vec3(i.x,i.y,i.z),this._rigidBodyList=null,this._rigidBodyListLast=null,this._jointList=null,this._jointListLast=null,this._numRigidBodies=0,this._numShapes=0,this._numJoints=0,this._numIslands=0,this._numVelocityIterations=10,this._numPositionIterations=5,this._rayCastWrapper=new a.dynamics._World.RayCastWrapper,this._convexCastWrapper=new a.dynamics._World.ConvexCastWrapper,this._aabbTestWrapper=new a.dynamics._World.AabbTestWrapper,this._island=new a.dynamics.Island,this._solversInIslands=new Array(a.common.Setting.islandInitialConstraintArraySize),this._rigidBodyStack=new Array(a.common.Setting.islandInitialRigidBodyArraySize),this._timeStep=new a.dynamics.TimeStep,this._pool=new a.common.Pool,this._shapeIdCount=0}_updateContacts(){let t=s.now()/1e3;this._contactManager._updateContacts(),a.dynamics.common.Performance.broadPhaseCollisionTime=1e3*(s.now()/1e3-t);let i=s.now()/1e3,o=this._contactManager._contactList;for(;null!=o;){let t=o._next;o._shouldBeSkipped||o._updateManifold(),o=t}a.dynamics.common.Performance.narrowPhaseCollisionTime=1e3*(s.now()/1e3-i)}_solveIslands(){let t=s.now()/1e3;if(a.common.Setting.disableSleeping){let t=this._rigidBodyList;for(;null!=t;)t._sleeping=!1,t._sleepTime=0,t=t._next}if(this._rigidBodyStack.length<this._numRigidBodies){let t=this._rigidBodyStack.length<<1;for(;t<this._numRigidBodies;)t<<=1;this._rigidBodyStack=new Array(t)}this._numIslands=0;let i=this._island,o=this._gravity;i.gravityX=o.x,i.gravityY=o.y,i.gravityZ=o.z;let n=this._rigidBodyList;for(this._numSolversInIslands=0;null!=n;){let t=n._next;for(;!n._addedToIsland&&!n._sleeping&&1!=n._type;){if(0==n._numContactLinks&&0==n._numJointLinks){this._island._stepSingleRigidBody(this._timeStep,n),this._numIslands++;break}this.buildIsland(n),this._island._step(this._timeStep,this._numVelocityIterations,this._numPositionIterations),this._island._clear(),this._numIslands++;break}n=t}for(this._contactManager._postSolve(),n=this._rigidBodyList;null!=n;)n._addedToIsland=!1,n=n._next;for(n=this._rigidBodyList;null!=n;)n._forceX=0,n._forceY=0,n._forceZ=0,n._torqueX=0,n._torqueY=0,n._torqueZ=0,n=n._next;for(;this._numSolversInIslands>0;)this._solversInIslands[--this._numSolversInIslands]._addedToIsland=!1,this._solversInIslands[this._numSolversInIslands]=null;a.dynamics.common.Performance.dynamicsTime=1e3*(s.now()/1e3-t)}buildIsland(t){let i=1;for(this._island._addRigidBody(t),this._rigidBodyStack[0]=t;i>0;){let t=this._rigidBodyStack[--i];if(this._rigidBodyStack[i]=null,1==t._type)continue;let s=t._contactLinkList;for(;null!=s;){let t=s._next,a=s._contact._contactConstraint,o=s._contact._contactConstraint._solver;if(a.isTouching()&&!o._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){let t=new Array(this._numSolversInIslands<<1),i=0,s=this._numSolversInIslands;for(;i<s;){let s=i++;t[s]=this._solversInIslands[s],this._solversInIslands[s]=null}this._solversInIslands=t}this._solversInIslands[this._numSolversInIslands++]=o,this._island._addConstraintSolver(o,a._positionCorrectionAlgorithm);let t=s._other;t._addedToIsland||(this._island._addRigidBody(t),this._rigidBodyStack[i++]=t)}s=t}let a=t._jointLinkList;for(;null!=a;){let t=a._next,s=a._joint,o=s._solver;if(!o._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){let t=new Array(this._numSolversInIslands<<1),i=0,s=this._numSolversInIslands;for(;i<s;){let s=i++;t[s]=this._solversInIslands[s],this._solversInIslands[s]=null}this._solversInIslands=t}this._solversInIslands[this._numSolversInIslands++]=o,this._island._addConstraintSolver(o,s._positionCorrectionAlgorithm);let t=a._other;t._addedToIsland||(this._island._addRigidBody(t),this._rigidBodyStack[i++]=t)}a=t}}}_drawBvh(t,i){t.drawBvh&&this._drawBvhNode(t,i._root,0,t.style.bvhNodeColor)}_drawBvhNode(t,i,s,o){if(null!=i){if(s>=t.drawBvhMinLevel&&s<=t.drawBvhMaxLevel){let s=this._pool,n=0==s.sizeVec3?new a.common.Vec3:s.stackVec3[--s.sizeVec3],e=this._pool,r=0==e.sizeVec3?new a.common.Vec3:e.stackVec3[--e.sizeVec3],_=n;_.x=i._aabbMinX,_.y=i._aabbMinY,_.z=i._aabbMinZ;let l=r;l.x=i._aabbMaxX,l.y=i._aabbMaxY,l.z=i._aabbMaxZ,t.aabb(n,r,o);let h=this._pool;if(null!=n){if(n.zero(),h.sizeVec3==h.stackVec3.length){let t=new Array(h.sizeVec3<<1),i=0,s=h.sizeVec3;for(;i<s;){let s=i++;t[s]=h.stackVec3[s],h.stackVec3[s]=null}h.stackVec3=t}h.stackVec3[h.sizeVec3++]=n}let c=this._pool;if(null!=r){if(r.zero(),c.sizeVec3==c.stackVec3.length){let t=new Array(c.sizeVec3<<1),i=0,s=c.sizeVec3;for(;i<s;){let s=i++;t[s]=c.stackVec3[s],c.stackVec3[s]=null}c.stackVec3=t}c.stackVec3[c.sizeVec3++]=r}}this._drawBvhNode(t,i._children[0],s+1,o),this._drawBvhNode(t,i._children[1],s+1,o)}}_drawRigidBodies(t){let i=t.style,s=this._rigidBodyList;for(;null!=s;){let o=s._next;if(t.drawBases){let i=t.style;t.basis(s._transform,i.basisLength,i.basisColorX,i.basisColorY,i.basisColorZ)}let n=null,e=0==s._type;e||(n=2==s._type?i.kinematicShapeColor:i.staticShapeColor);let r=s._shapeList;for(;null!=r;){let o=r._next;if(e&&(n=1&r._id?s._sleeping?i.sleepingShapeColor2:s._sleepTime>a.common.Setting.sleepingTimeThreshold?i.sleepyShapeColor2:i.shapeColor2:s._sleeping?i.sleepingShapeColor1:s._sleepTime>a.common.Setting.sleepingTimeThreshold?i.sleepyShapeColor1:i.shapeColor1),t.drawShapes){let i=r._geom,s=r._transform;switch(i._type){case 0:t.sphere(s,i._radius,n);break;case 1:let o=i,e=this._pool,r=0==e.sizeVec3?new a.common.Vec3:e.stackVec3[--e.sizeVec3],_=r;_.x=o._halfExtentsX,_.y=o._halfExtentsY,_.z=o._halfExtentsZ,t.box(s,r,n);let l=this._pool;if(null!=r){if(r.zero(),l.sizeVec3==l.stackVec3.length){let t=new Array(l.sizeVec3<<1),i=0,s=l.sizeVec3;for(;i<s;){let s=i++;t[s]=l.stackVec3[s],l.stackVec3[s]=null}l.stackVec3=t}l.stackVec3[l.sizeVec3++]=r}break;case 2:let h=i;t.cylinder(s,h._radius,h._halfHeight,n);break;case 3:let c=i;t.cone(s,c._radius,c._halfHeight,n);break;case 4:let m=i;t.capsule(s,m._radius,m._halfHeight,n);break;case 5:let b=i,p=b._numVertices,x=this._pool,f=0==x.sizeVec3?new a.common.Vec3:x.stackVec3[--x.sizeVec3],u=this._pool,y=0==u.sizeVec3?new a.common.Vec3:u.stackVec3[--u.sizeVec3],g=this._pool,v=0==g.sizeVec3?new a.common.Vec3:g.stackVec3[--g.sizeVec3],d=this._pool,X=0==d.sizeVec3?new a.common.Vec3:d.stackVec3[--d.sizeVec3],z=this._pool,Y=0==z.sizeVec3?new a.common.Vec3:z.stackVec3[--z.sizeVec3],Z=this._pool,M=0==Z.sizeVec3?new a.common.Vec3:Z.stackVec3[--Z.sizeVec3],I=this._pool,V=0==I.sizeMat3?new a.common.Mat3:I.stackMat3[--I.sizeMat3],w=this._pool,L=0==w.sizeVec3?new a.common.Vec3:w.stackVec3[--w.sizeVec3],k=V;k.e00=s._rotation00,k.e01=s._rotation01,k.e02=s._rotation02,k.e10=s._rotation10,k.e11=s._rotation11,k.e12=s._rotation12,k.e20=s._rotation20,k.e21=s._rotation21,k.e22=s._rotation22;let A=L;A.x=s._positionX,A.y=s._positionY,A.z=s._positionZ;let B=0;for(;B<p;){let t=B++,i=b._tmpVertices[t],s=b._vertices[t];i.x=s.x,i.y=s.y,i.z=s.z;let a=i.x*V.e10+i.y*V.e11+i.z*V.e12,o=i.x*V.e20+i.y*V.e21+i.z*V.e22;i.x=i.x*V.e00+i.y*V.e01+i.z*V.e02,i.y=a,i.z=o,i.x+=L.x,i.y+=L.y,i.z+=L.z}if(p>30){let i=0;for(;i<p;){let s=i++,a=b._tmpVertices[s];f.x=a.x,f.y=a.y,f.z=a.z;let o=b._tmpVertices[(s+1)%p];y.x=o.x,y.y=o.y,y.z=o.z,t.line(f,y,n)}}else if(this._debugDraw.wireframe||p>10){let i=0;for(;i<p;){let s=i++,a=b._tmpVertices[s];f.x=a.x,f.y=a.y,f.z=a.z;let o=0;for(;o<s;){let i=b._tmpVertices[o++];y.x=i.x,y.y=i.y,y.z=i.z,t.line(f,y,n)}}}else{let i=0;for(;i<p;){let s=i++,a=b._tmpVertices[s];f.x=a.x,f.y=a.y,f.z=a.z;let o=0;for(;o<s;){let i=o++,s=b._tmpVertices[i];y.x=s.x,y.y=s.y,y.z=s.z;let a=0;for(;a<i;){let i=b._tmpVertices[a++];v.x=i.x,v.y=i.y,v.z=i.z,X.x=y.x,X.y=y.y,X.z=y.z;let s=X;s.x-=f.x,s.y-=f.y,s.z-=f.z,Y.x=v.x,Y.y=v.y,Y.z=v.z;let o=Y;o.x-=f.x,o.y-=f.y,o.z-=f.z,M.x=X.x,M.y=X.y,M.z=X.z;let e=M,r=e.z*Y.x-e.x*Y.z,_=e.x*Y.y-e.y*Y.x;e.x=e.y*Y.z-e.z*Y.y,e.y=r,e.z=_;let l=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);l>0&&(l=1/l),e.x*=l,e.y*=l,e.z*=l,t.triangle(f,y,v,M,M,M,n),M.x=-M.x,M.y=-M.y,M.z=-M.z,t.triangle(f,v,y,M,M,M,n)}}}}let P=this._pool;if(null!=f){if(f.zero(),P.sizeVec3==P.stackVec3.length){let t=new Array(P.sizeVec3<<1),i=0,s=P.sizeVec3;for(;i<s;){let s=i++;t[s]=P.stackVec3[s],P.stackVec3[s]=null}P.stackVec3=t}P.stackVec3[P.sizeVec3++]=f}let S=this._pool;if(null!=y){if(y.zero(),S.sizeVec3==S.stackVec3.length){let t=new Array(S.sizeVec3<<1),i=0,s=S.sizeVec3;for(;i<s;){let s=i++;t[s]=S.stackVec3[s],S.stackVec3[s]=null}S.stackVec3=t}S.stackVec3[S.sizeVec3++]=y}let T=this._pool;if(null!=v){if(v.zero(),T.sizeVec3==T.stackVec3.length){let t=new Array(T.sizeVec3<<1),i=0,s=T.sizeVec3;for(;i<s;){let s=i++;t[s]=T.stackVec3[s],T.stackVec3[s]=null}T.stackVec3=t}T.stackVec3[T.sizeVec3++]=v}let C=this._pool;if(null!=X){if(X.zero(),C.sizeVec3==C.stackVec3.length){let t=new Array(C.sizeVec3<<1),i=0,s=C.sizeVec3;for(;i<s;){let s=i++;t[s]=C.stackVec3[s],C.stackVec3[s]=null}C.stackVec3=t}C.stackVec3[C.sizeVec3++]=X}let j=this._pool;if(null!=Y){if(Y.zero(),j.sizeVec3==j.stackVec3.length){let t=new Array(j.sizeVec3<<1),i=0,s=j.sizeVec3;for(;i<s;){let s=i++;t[s]=j.stackVec3[s],j.stackVec3[s]=null}j.stackVec3=t}j.stackVec3[j.sizeVec3++]=Y}let R=this._pool;if(null!=M){if(M.zero(),R.sizeVec3==R.stackVec3.length){let t=new Array(R.sizeVec3<<1),i=0,s=R.sizeVec3;for(;i<s;){let s=i++;t[s]=R.stackVec3[s],R.stackVec3[s]=null}R.stackVec3=t}R.stackVec3[R.sizeVec3++]=M}let q=this._pool;if(null!=V){if(V.e00=1,V.e01=0,V.e02=0,V.e10=0,V.e11=1,V.e12=0,V.e20=0,V.e21=0,V.e22=1,q.sizeMat3==q.stackMat3.length){let t=new Array(q.sizeMat3<<1),i=0,s=q.sizeMat3;for(;i<s;){let s=i++;t[s]=q.stackMat3[s],q.stackMat3[s]=null}q.stackMat3=t}q.stackMat3[q.sizeMat3++]=V}let E=this._pool;if(null!=L){if(L.zero(),E.sizeVec3==E.stackVec3.length){let t=new Array(E.sizeVec3<<1),i=0,s=E.sizeVec3;for(;i<s;){let s=i++;t[s]=E.stackVec3[s],E.stackVec3[s]=null}E.stackVec3=t}E.stackVec3[E.sizeVec3++]=L}}}if(t.drawAabbs){let s=r._aabb,o=i.aabbColor,n=this._pool,e=0==n.sizeVec3?new a.common.Vec3:n.stackVec3[--n.sizeVec3],_=this._pool,l=0==_.sizeVec3?new a.common.Vec3:_.stackVec3[--_.sizeVec3],h=e;h.x=s._minX,h.y=s._minY,h.z=s._minZ;let c=l;c.x=s._maxX,c.y=s._maxY,c.z=s._maxZ,t.aabb(e,l,o);let m=this._pool;if(null!=e){if(e.zero(),m.sizeVec3==m.stackVec3.length){let t=new Array(m.sizeVec3<<1),i=0,s=m.sizeVec3;for(;i<s;){let s=i++;t[s]=m.stackVec3[s],m.stackVec3[s]=null}m.stackVec3=t}m.stackVec3[m.sizeVec3++]=e}let b=this._pool;if(null!=l){if(l.zero(),b.sizeVec3==b.stackVec3.length){let t=new Array(b.sizeVec3<<1),i=0,s=b.sizeVec3;for(;i<s;){let s=i++;t[s]=b.stackVec3[s],b.stackVec3[s]=null}b.stackVec3=t}b.stackVec3[b.sizeVec3++]=l}}r=o}s=o}}_drawConstraints(t){let i=t.style;if(t.drawPairs||t.drawContacts){let s=this._contactManager._contactList;for(;null!=s;){let o=s._next;if(t.drawPairs){let o=i.pairColor,n=this._pool,e=0==n.sizeVec3?new a.common.Vec3:n.stackVec3[--n.sizeVec3],r=this._pool,_=0==r.sizeVec3?new a.common.Vec3:r.stackVec3[--r.sizeVec3],l=e;l.x=s._s1._transform._positionX,l.y=s._s1._transform._positionY,l.z=s._s1._transform._positionZ;let h=_;h.x=s._s2._transform._positionX,h.y=s._s2._transform._positionY,h.z=s._s2._transform._positionZ,t.line(e,_,o);let c=this._pool;if(null!=e){if(e.zero(),c.sizeVec3==c.stackVec3.length){let t=new Array(c.sizeVec3<<1),i=0,s=c.sizeVec3;for(;i<s;){let s=i++;t[s]=c.stackVec3[s],c.stackVec3[s]=null}c.stackVec3=t}c.stackVec3[c.sizeVec3++]=e}let m=this._pool;if(null!=_){if(_.zero(),m.sizeVec3==m.stackVec3.length){let t=new Array(m.sizeVec3<<1),i=0,s=m.sizeVec3;for(;i<s;){let s=i++;t[s]=m.stackVec3[s],m.stackVec3[s]=null}m.stackVec3=t}m.stackVec3[m.sizeVec3++]=_}}if(t.drawContacts){let i=s._contactConstraint,o=s._contactConstraint._manifold._points,n=0,e=s._contactConstraint._manifold._numPoints;for(;n<e;){let s=o[n++],e=t.style,r=this._pool,_=0==r.sizeVec3?new a.common.Vec3:r.stackVec3[--r.sizeVec3],l=this._pool,h=0==l.sizeVec3?new a.common.Vec3:l.stackVec3[--l.sizeVec3],c=this._pool,m=0==c.sizeVec3?new a.common.Vec3:c.stackVec3[--c.sizeVec3],b=this._pool,p=0==b.sizeVec3?new a.common.Vec3:b.stackVec3[--b.sizeVec3],x=this._pool,f=0==x.sizeVec3?new a.common.Vec3:x.stackVec3[--x.sizeVec3],u=_;u.x=s._pos1X,u.y=s._pos1Y,u.z=s._pos1Z;let y=h;y.x=s._pos2X,y.y=s._pos2Y,y.z=s._pos2Z;let g=m;g.x=i._manifold._normalX,g.y=i._manifold._normalY,g.z=i._manifold._normalZ;let v=p;v.x=i._manifold._tangentX,v.y=i._manifold._tangentY,v.z=i._manifold._tangentZ;let d=f;if(d.x=i._manifold._binormalX,d.y=i._manifold._binormalY,d.z=i._manifold._binormalZ,s._disabled)t.point(_,e.disabledContactColor),t.point(h,e.disabledContactColor),t.line(_,h,e.disabledContactColor);else if(s._warmStarted){let i;switch(3&s._id){case 0:i=e.contactColor;break;case 1:i=e.contactColor2;break;case 2:i=e.contactColor3;break;default:i=e.contactColor4}t.point(_,i),t.point(h,i),t.line(_,h,e.contactColor)}else t.point(_,e.newContactColor),t.point(h,e.newContactColor),t.line(_,h,e.newContactColor);h.x=_.x,h.y=_.y,h.z=_.z;let X=h,z=e.contactNormalLength;if(X.x+=m.x*z,X.y+=m.y*z,X.z+=m.z*z,t.line(_,h,e.contactNormalColor),t.drawContactBases){h.x=_.x,h.y=_.y,h.z=_.z;let i=h,s=e.contactTangentLength;i.x+=p.x*s,i.y+=p.y*s,i.z+=p.z*s,t.line(_,h,e.contactTangentColor),h.x=_.x,h.y=_.y,h.z=_.z;let a=h,o=e.contactBinormalLength;a.x+=f.x*o,a.y+=f.y*o,a.z+=f.z*o,t.line(_,h,e.contactBinormalColor)}let Y=this._pool;if(null!=_){if(_.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,s=Y.sizeVec3;for(;i<s;){let s=i++;t[s]=Y.stackVec3[s],Y.stackVec3[s]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=_}let Z=this._pool;if(null!=h){if(h.zero(),Z.sizeVec3==Z.stackVec3.length){let t=new Array(Z.sizeVec3<<1),i=0,s=Z.sizeVec3;for(;i<s;){let s=i++;t[s]=Z.stackVec3[s],Z.stackVec3[s]=null}Z.stackVec3=t}Z.stackVec3[Z.sizeVec3++]=h}let M=this._pool;if(null!=m){if(m.zero(),M.sizeVec3==M.stackVec3.length){let t=new Array(M.sizeVec3<<1),i=0,s=M.sizeVec3;for(;i<s;){let s=i++;t[s]=M.stackVec3[s],M.stackVec3[s]=null}M.stackVec3=t}M.stackVec3[M.sizeVec3++]=m}let I=this._pool;if(null!=p){if(p.zero(),I.sizeVec3==I.stackVec3.length){let t=new Array(I.sizeVec3<<1),i=0,s=I.sizeVec3;for(;i<s;){let s=i++;t[s]=I.stackVec3[s],I.stackVec3[s]=null}I.stackVec3=t}I.stackVec3[I.sizeVec3++]=p}let V=this._pool;if(null!=f){if(f.zero(),V.sizeVec3==V.stackVec3.length){let t=new Array(V.sizeVec3<<1),i=0,s=V.sizeVec3;for(;i<s;){let s=i++;t[s]=V.stackVec3[s],V.stackVec3[s]=null}V.stackVec3=t}V.stackVec3[V.sizeVec3++]=f}}}s=o}}if(t.drawJoints){let i=this._jointList;for(;null!=i;){let s=i._next,o=this._pool,n=0==o.sizeVec3?new a.common.Vec3:o.stackVec3[--o.sizeVec3],e=this._pool,r=0==e.sizeVec3?new a.common.Vec3:e.stackVec3[--e.sizeVec3],_=n;_.x=i._b1._transform._positionX,_.y=i._b1._transform._positionY,_.z=i._b1._transform._positionZ;let l=r;l.x=i._b2._transform._positionX,l.y=i._b2._transform._positionY,l.z=i._b2._transform._positionZ;let h=this._pool,c=0==h.sizeVec3?new a.common.Vec3:h.stackVec3[--h.sizeVec3],m=this._pool,b=0==m.sizeVec3?new a.common.Vec3:m.stackVec3[--m.sizeVec3],p=this._pool,x=0==p.sizeVec3?new a.common.Vec3:p.stackVec3[--p.sizeVec3],f=this._pool,u=0==f.sizeVec3?new a.common.Vec3:f.stackVec3[--f.sizeVec3],y=this._pool,g=0==y.sizeVec3?new a.common.Vec3:y.stackVec3[--y.sizeVec3],v=this._pool,d=0==v.sizeVec3?new a.common.Vec3:v.stackVec3[--v.sizeVec3],X=this._pool,z=0==X.sizeVec3?new a.common.Vec3:X.stackVec3[--X.sizeVec3],Y=this._pool,Z=0==Y.sizeVec3?new a.common.Vec3:Y.stackVec3[--Y.sizeVec3],M=c;M.x=i._anchor1X,M.y=i._anchor1Y,M.z=i._anchor1Z;let I=b;I.x=i._anchor2X,I.y=i._anchor2Y,I.z=i._anchor2Z;let V=x;V.x=i._basisX1X,V.y=i._basisX1Y,V.z=i._basisX1Z;let w=u;w.x=i._basisY1X,w.y=i._basisY1Y,w.z=i._basisY1Z;let L=g;L.x=i._basisZ1X,L.y=i._basisZ1Y,L.z=i._basisZ1Z;let k=d;k.x=i._basisX2X,k.y=i._basisX2Y,k.z=i._basisX2Z;let A=z;A.x=i._basisY2X,A.y=i._basisY2Y,A.z=i._basisY2Z;let B=Z;if(B.x=i._basisZ2X,B.y=i._basisZ2Y,B.z=i._basisZ2Z,t.line(n,c,t.style.jointLineColor),t.line(r,b,t.style.jointLineColor),t.drawJointLimits)switch(i._type){case 0:break;case 1:let s=i._lm;this._drawRotationalLimit(t,c,u,g,z,t.style.jointRotationalConstraintRadius,s.lowerLimit,s.upperLimit,t.style.jointLineColor);break;case 2:let o=i,n=t.style.jointLineColor,e=o._rotLm,r=o._translLm;this._drawRotationalLimit(t,b,u,g,z,t.style.jointRotationalConstraintRadius,e.lowerLimit,e.upperLimit,n),this._drawTranslationalLimit(t,c,x,r.lowerLimit,r.upperLimit,n);break;case 3:let _=i._lm;this._drawTranslationalLimit(t,c,x,_.lowerLimit,_.upperLimit,t.style.jointLineColor);break;case 4:let l=i,h=t.style.jointRotationalConstraintRadius,m=t.style.jointLineColor,p=l._lm1,f=l._lm2;this._drawRotationalLimit(t,c,u,g,u,h,l._angleX-p.upperLimit,l._angleX-p.lowerLimit,m),this._drawRotationalLimit(t,b,d,z,d,h,f.lowerLimit-l._angleZ,f.upperLimit-l._angleZ,m);break;case 5:let y=i,v=t.style.jointRotationalConstraintRadius,X=t.style.jointLineColor,Y=y._twistLm;this._drawRotationalLimit(t,b,z,Z,z,v,Y.lowerLimit-y._twistAngle,Y.upperLimit-y._twistAngle,X),this._drawEllipseOnSphere(t,c,x,u,g,y._maxSwingAngle1,y._maxSwingAngle2,v,X);let M=this._pool,I=0==M.sizeVec3?new a.common.Vec3:M.stackVec3[--M.sizeVec3];I.x=b.x,I.y=b.y,I.z=b.z;let V=I;V.x+=d.x*v,V.y+=d.y*v,V.z+=d.z*v,t.line(b,V,X);let w=this._pool;if(null!=V){if(V.zero(),w.sizeVec3==w.stackVec3.length){let t=new Array(w.sizeVec3<<1),i=0,s=w.sizeVec3;for(;i<s;){let s=i++;t[s]=w.stackVec3[s],w.stackVec3[s]=null}w.stackVec3=t}w.stackVec3[w.sizeVec3++]=V}break;case 6:let L=i,k=t.style.jointRotationalConstraintRadius,A=t.style.jointLineColor,B=L._rotLms[0],P=L._rotLms[1],S=L._rotLms[2];this._drawTranslationalLimit3D(t,c,x,u,g,L._translLms[0],L._translLms[1],L._translLms[2],A);let T=this._pool,C=0==T.sizeVec3?new a.common.Vec3:T.stackVec3[--T.sizeVec3],j=C;j.x=L._axisYX,j.y=L._axisYY,j.z=L._axisYZ;let R=this._pool,q=0==R.sizeVec3?new a.common.Vec3:R.stackVec3[--R.sizeVec3];q.x=x.x,q.y=x.y,q.z=x.z;let E=q,D=this._pool,N=0==D.sizeVec3?new a.common.Vec3:D.stackVec3[--D.sizeVec3];N.x=x.x,N.y=x.y,N.z=x.z;let F=N,W=F.z*C.x-F.x*C.z,J=F.x*C.y-F.y*C.x;F.x=F.y*C.z-F.z*C.y,F.y=W,F.z=J,this._drawRotationalLimit(t,b,u,g,u,k,L._angleX-B.upperLimit,L._angleX-B.lowerLimit,A),this._drawRotationalLimit(t,b,E,F,E,k,P.lowerLimit-L._angleY,P.upperLimit-L._angleY,A),this._drawRotationalLimit(t,b,d,z,d,k,S.lowerLimit-L._angleZ,S.upperLimit-L._angleZ,A)}t.line(c,b,t.style.jointErrorColor);let P=this._pool;if(null!=n){if(n.zero(),P.sizeVec3==P.stackVec3.length){let t=new Array(P.sizeVec3<<1),i=0,s=P.sizeVec3;for(;i<s;){let s=i++;t[s]=P.stackVec3[s],P.stackVec3[s]=null}P.stackVec3=t}P.stackVec3[P.sizeVec3++]=n}let S=this._pool;if(null!=r){if(r.zero(),S.sizeVec3==S.stackVec3.length){let t=new Array(S.sizeVec3<<1),i=0,s=S.sizeVec3;for(;i<s;){let s=i++;t[s]=S.stackVec3[s],S.stackVec3[s]=null}S.stackVec3=t}S.stackVec3[S.sizeVec3++]=r}let T=this._pool;if(null!=c){if(c.zero(),T.sizeVec3==T.stackVec3.length){let t=new Array(T.sizeVec3<<1),i=0,s=T.sizeVec3;for(;i<s;){let s=i++;t[s]=T.stackVec3[s],T.stackVec3[s]=null}T.stackVec3=t}T.stackVec3[T.sizeVec3++]=c}let C=this._pool;if(null!=b){if(b.zero(),C.sizeVec3==C.stackVec3.length){let t=new Array(C.sizeVec3<<1),i=0,s=C.sizeVec3;for(;i<s;){let s=i++;t[s]=C.stackVec3[s],C.stackVec3[s]=null}C.stackVec3=t}C.stackVec3[C.sizeVec3++]=b}let j=this._pool;if(null!=x){if(x.zero(),j.sizeVec3==j.stackVec3.length){let t=new Array(j.sizeVec3<<1),i=0,s=j.sizeVec3;for(;i<s;){let s=i++;t[s]=j.stackVec3[s],j.stackVec3[s]=null}j.stackVec3=t}j.stackVec3[j.sizeVec3++]=x}let R=this._pool;if(null!=u){if(u.zero(),R.sizeVec3==R.stackVec3.length){let t=new Array(R.sizeVec3<<1),i=0,s=R.sizeVec3;for(;i<s;){let s=i++;t[s]=R.stackVec3[s],R.stackVec3[s]=null}R.stackVec3=t}R.stackVec3[R.sizeVec3++]=u}let q=this._pool;if(null!=g){if(g.zero(),q.sizeVec3==q.stackVec3.length){let t=new Array(q.sizeVec3<<1),i=0,s=q.sizeVec3;for(;i<s;){let s=i++;t[s]=q.stackVec3[s],q.stackVec3[s]=null}q.stackVec3=t}q.stackVec3[q.sizeVec3++]=g}let E=this._pool;if(null!=d){if(d.zero(),E.sizeVec3==E.stackVec3.length){let t=new Array(E.sizeVec3<<1),i=0,s=E.sizeVec3;for(;i<s;){let s=i++;t[s]=E.stackVec3[s],E.stackVec3[s]=null}E.stackVec3=t}E.stackVec3[E.sizeVec3++]=d}let D=this._pool;if(null!=z){if(z.zero(),D.sizeVec3==D.stackVec3.length){let t=new Array(D.sizeVec3<<1),i=0,s=D.sizeVec3;for(;i<s;){let s=i++;t[s]=D.stackVec3[s],D.stackVec3[s]=null}D.stackVec3=t}D.stackVec3[D.sizeVec3++]=z}let N=this._pool;if(null!=Z){if(Z.zero(),N.sizeVec3==N.stackVec3.length){let t=new Array(N.sizeVec3<<1),i=0,s=N.sizeVec3;for(;i<s;){let s=i++;t[s]=N.stackVec3[s],N.stackVec3[s]=null}N.stackVec3=t}N.stackVec3[N.sizeVec3++]=Z}i=s}}}_drawRotationalLimit(t,i,s,o,n,e,r,_,l){if(r!=_){let h=this._pool,c=0==h.sizeVec3?new a.common.Vec3:h.stackVec3[--h.sizeVec3];c.x=i.x,c.y=i.y,c.z=i.z;let m=c;m.x+=n.x*e,m.y+=n.y*e,m.z+=n.z*e,t.line(i,m,l);let b=this._pool;if(null!=m){if(m.zero(),b.sizeVec3==b.stackVec3.length){let t=new Array(b.sizeVec3<<1),i=0,s=b.sizeVec3;for(;i<s;){let s=i++;t[s]=b.stackVec3[s],b.stackVec3[s]=null}b.stackVec3=t}b.stackVec3[b.sizeVec3++]=m}r>_?t.ellipse(i,s,o,e,e,l):t.arc(i,s,o,e,e,r,_,!0,l)}}_drawTranslationalLimit(t,i,s,o,n,e){if(o<n){let r=this._pool,_=0==r.sizeVec3?new a.common.Vec3:r.stackVec3[--r.sizeVec3];_.x=i.x,_.y=i.y,_.z=i.z;let l=_;l.x+=s.x*o,l.y+=s.y*o,l.z+=s.z*o;let h=this._pool,c=0==h.sizeVec3?new a.common.Vec3:h.stackVec3[--h.sizeVec3];c.x=i.x,c.y=i.y,c.z=i.z;let m=c;m.x+=s.x*n,m.y+=s.y*n,m.z+=s.z*n,t.line(l,m,e);let b=this._pool;if(null!=l){if(l.zero(),b.sizeVec3==b.stackVec3.length){let t=new Array(b.sizeVec3<<1),i=0,s=b.sizeVec3;for(;i<s;){let s=i++;t[s]=b.stackVec3[s],b.stackVec3[s]=null}b.stackVec3=t}b.stackVec3[b.sizeVec3++]=l}let p=this._pool;if(null!=m){if(m.zero(),p.sizeVec3==p.stackVec3.length){let t=new Array(p.sizeVec3<<1),i=0,s=p.sizeVec3;for(;i<s;){let s=i++;t[s]=p.stackVec3[s],p.stackVec3[s]=null}p.stackVec3=t}p.stackVec3[p.sizeVec3++]=m}}}_drawTranslationalLimit3D(t,i,s,o,n,e,r,_,l){let h=e.lowerLimit,c=e.upperLimit,m=r.lowerLimit,b=r.upperLimit,p=_.lowerLimit,x=_.upperLimit,f=this._pool;0==f.sizeVec3?new a.common.Vec3:--f.sizeVec3;let u=this._pool;0==u.sizeVec3?new a.common.Vec3:--u.sizeVec3;let y=this._pool,g=0==y.sizeVec3?new a.common.Vec3:y.stackVec3[--y.sizeVec3];g.x=i.x,g.y=i.y,g.z=i.z;let v=g;v.x+=s.x*h,v.y+=s.y*h,v.z+=s.z*h,v.x+=o.x*m,v.y+=o.y*m,v.z+=o.z*m,v.x+=n.x*p,v.y+=n.y*p,v.z+=n.z*p;let d=this._pool,X=0==d.sizeVec3?new a.common.Vec3:d.stackVec3[--d.sizeVec3];X.x=i.x,X.y=i.y,X.z=i.z;let z=X;z.x+=s.x*h,z.y+=s.y*h,z.z+=s.z*h,z.x+=o.x*m,z.y+=o.y*m,z.z+=o.z*m,z.x+=n.x*x,z.y+=n.y*x,z.z+=n.z*x;let Y=this._pool,Z=0==Y.sizeVec3?new a.common.Vec3:Y.stackVec3[--Y.sizeVec3];Z.x=i.x,Z.y=i.y,Z.z=i.z;let M=Z;M.x+=s.x*h,M.y+=s.y*h,M.z+=s.z*h,M.x+=o.x*b,M.y+=o.y*b,M.z+=o.z*b,M.x+=n.x*p,M.y+=n.y*p,M.z+=n.z*p;let I=this._pool,V=0==I.sizeVec3?new a.common.Vec3:I.stackVec3[--I.sizeVec3];V.x=i.x,V.y=i.y,V.z=i.z;let w=V;w.x+=s.x*h,w.y+=s.y*h,w.z+=s.z*h,w.x+=o.x*b,w.y+=o.y*b,w.z+=o.z*b,w.x+=n.x*x,w.y+=n.y*x,w.z+=n.z*x;let L=this._pool,k=0==L.sizeVec3?new a.common.Vec3:L.stackVec3[--L.sizeVec3];k.x=i.x,k.y=i.y,k.z=i.z;let A=k;A.x+=s.x*c,A.y+=s.y*c,A.z+=s.z*c,A.x+=o.x*m,A.y+=o.y*m,A.z+=o.z*m,A.x+=n.x*p,A.y+=n.y*p,A.z+=n.z*p;let B=this._pool,P=0==B.sizeVec3?new a.common.Vec3:B.stackVec3[--B.sizeVec3];P.x=i.x,P.y=i.y,P.z=i.z;let S=P;S.x+=s.x*c,S.y+=s.y*c,S.z+=s.z*c,S.x+=o.x*m,S.y+=o.y*m,S.z+=o.z*m,S.x+=n.x*x,S.y+=n.y*x,S.z+=n.z*x;let T=this._pool,C=0==T.sizeVec3?new a.common.Vec3:T.stackVec3[--T.sizeVec3];C.x=i.x,C.y=i.y,C.z=i.z;let j=C;j.x+=s.x*c,j.y+=s.y*c,j.z+=s.z*c,j.x+=o.x*b,j.y+=o.y*b,j.z+=o.z*b,j.x+=n.x*p,j.y+=n.y*p,j.z+=n.z*p;let R=this._pool,q=0==R.sizeVec3?new a.common.Vec3:R.stackVec3[--R.sizeVec3];q.x=i.x,q.y=i.y,q.z=i.z;let E=q;E.x+=s.x*c,E.y+=s.y*c,E.z+=s.z*c,E.x+=o.x*b,E.y+=o.y*b,E.z+=o.z*b,E.x+=n.x*x,E.y+=n.y*x,E.z+=n.z*x,t.line(v,A,l),t.line(M,j,l),t.line(z,S,l),t.line(w,E,l),t.line(v,M,l),t.line(A,j,l),t.line(z,w,l),t.line(S,E,l),t.line(v,z,l),t.line(A,S,l),t.line(M,w,l),t.line(j,E,l);let D=this._pool;if(null!=v){if(v.zero(),D.sizeVec3==D.stackVec3.length){let t=new Array(D.sizeVec3<<1),i=0,s=D.sizeVec3;for(;i<s;){let s=i++;t[s]=D.stackVec3[s],D.stackVec3[s]=null}D.stackVec3=t}D.stackVec3[D.sizeVec3++]=v}let N=this._pool;if(null!=z){if(z.zero(),N.sizeVec3==N.stackVec3.length){let t=new Array(N.sizeVec3<<1),i=0,s=N.sizeVec3;for(;i<s;){let s=i++;t[s]=N.stackVec3[s],N.stackVec3[s]=null}N.stackVec3=t}N.stackVec3[N.sizeVec3++]=z}let F=this._pool;if(null!=M){if(M.zero(),F.sizeVec3==F.stackVec3.length){let t=new Array(F.sizeVec3<<1),i=0,s=F.sizeVec3;for(;i<s;){let s=i++;t[s]=F.stackVec3[s],F.stackVec3[s]=null}F.stackVec3=t}F.stackVec3[F.sizeVec3++]=M}let W=this._pool;if(null!=w){if(w.zero(),W.sizeVec3==W.stackVec3.length){let t=new Array(W.sizeVec3<<1),i=0,s=W.sizeVec3;for(;i<s;){let s=i++;t[s]=W.stackVec3[s],W.stackVec3[s]=null}W.stackVec3=t}W.stackVec3[W.sizeVec3++]=w}let J=this._pool;if(null!=A){if(A.zero(),J.sizeVec3==J.stackVec3.length){let t=new Array(J.sizeVec3<<1),i=0,s=J.sizeVec3;for(;i<s;){let s=i++;t[s]=J.stackVec3[s],J.stackVec3[s]=null}J.stackVec3=t}J.stackVec3[J.sizeVec3++]=A}let G=this._pool;if(null!=S){if(S.zero(),G.sizeVec3==G.stackVec3.length){let t=new Array(G.sizeVec3<<1),i=0,s=G.sizeVec3;for(;i<s;){let s=i++;t[s]=G.stackVec3[s],G.stackVec3[s]=null}G.stackVec3=t}G.stackVec3[G.sizeVec3++]=S}let O=this._pool;if(null!=j){if(j.zero(),O.sizeVec3==O.stackVec3.length){let t=new Array(O.sizeVec3<<1),i=0,s=O.sizeVec3;for(;i<s;){let s=i++;t[s]=O.stackVec3[s],O.stackVec3[s]=null}O.stackVec3=t}O.stackVec3[O.sizeVec3++]=j}let U=this._pool;if(null!=E){if(E.zero(),U.sizeVec3==U.stackVec3.length){let t=new Array(U.sizeVec3<<1),i=0,s=U.sizeVec3;for(;i<s;){let s=i++;t[s]=U.stackVec3[s],U.stackVec3[s]=null}U.stackVec3=t}U.stackVec3[U.sizeVec3++]=E}}_drawEllipseOnSphere(t,i,s,o,n,e,r,_,l){let h=0,c=this._pool,m=0==c.sizeVec3?new a.common.Vec3:c.stackVec3[--c.sizeVec3],b=this._pool,p=0==b.sizeQuat?new a.common.Quat:b.stackQuat[--b.sizeQuat],x=this._pool,f=0==x.sizeMat3?new a.common.Mat3:x.stackMat3[--x.sizeMat3],u=this._pool,y=0==u.sizeVec3?new a.common.Vec3:u.stackVec3[--u.sizeVec3],g=0;for(;g<17;){let c=g++,b=Math.cos(h)*e,x=Math.sin(h)*r,u=Math.sqrt(b*b+x*x),v=Math.sin(.5*u),d=Math.cos(.5*u),X=m.zero();X.x+=o.x*b,X.y+=o.y*b,X.z+=o.z*b,X.x+=n.x*x,X.y+=n.y*x,X.z+=n.z*x;let z=1/u*v;m.x*=z,m.y*=z,m.z*=z,p.x=m.x,p.y=m.y,p.z=m.z,p.w=d;let Y=p.x,Z=p.y,M=p.z,I=p.w,V=2*Y,w=2*Z,L=2*M,k=Y*V,A=Z*w,B=M*L,P=Y*w,S=Z*L,T=Y*L,C=I*V,j=I*w,R=I*L;f.e00=1-A-B,f.e01=P-R,f.e02=T+j,f.e10=P+R,f.e11=1-k-B,f.e12=S-C,f.e20=T-j,f.e21=S+C,f.e22=1-k-A;let q=this._pool,E=0==q.sizeVec3?new a.common.Vec3:q.stackVec3[--q.sizeVec3];E.x+=s.x*_,E.y+=s.y*_,E.z+=s.z*_;let D=E,N=D.x*f.e10+D.y*f.e11+D.z*f.e12,F=D.x*f.e20+D.y*f.e21+D.z*f.e22;D.x=D.x*f.e00+D.y*f.e01+D.z*f.e02,D.y=N,D.z=F,D.x+=i.x,D.y+=i.y,D.z+=i.z,c>=1&&t.line(y,D,l);let W=this._pool;if(null!=y){if(y.zero(),W.sizeVec3==W.stackVec3.length){let t=new Array(W.sizeVec3<<1),i=0,s=W.sizeVec3;for(;i<s;){let s=i++;t[s]=W.stackVec3[s],W.stackVec3[s]=null}W.stackVec3=t}W.stackVec3[W.sizeVec3++]=y}y=D,h+=.39269908169872375}let v=this._pool;if(null!=m){if(m.zero(),v.sizeVec3==v.stackVec3.length){let t=new Array(v.sizeVec3<<1),i=0,s=v.sizeVec3;for(;i<s;){let s=i++;t[s]=v.stackVec3[s],v.stackVec3[s]=null}v.stackVec3=t}v.stackVec3[v.sizeVec3++]=m}let d=this._pool;if(null!=p){if(p.x=0,p.y=0,p.z=0,p.w=1,d.sizeQuat==d.stackQuat.length){let t=new Array(d.sizeQuat<<1),i=0,s=d.sizeQuat;for(;i<s;){let s=i++;t[s]=d.stackQuat[s],d.stackQuat[s]=null}d.stackQuat=t}d.stackQuat[d.sizeQuat++]=p}let X=this._pool;if(null!=f){if(f.e00=1,f.e01=0,f.e02=0,f.e10=0,f.e11=1,f.e12=0,f.e20=0,f.e21=0,f.e22=1,X.sizeMat3==X.stackMat3.length){let t=new Array(X.sizeMat3<<1),i=0,s=X.sizeMat3;for(;i<s;){let s=i++;t[s]=X.stackMat3[s],X.stackMat3[s]=null}X.stackMat3=t}X.stackMat3[X.sizeMat3++]=f}let z=this._pool;if(null!=y){if(y.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,s=z.sizeVec3;for(;i<s;){let s=i++;t[s]=z.stackVec3[s],z.stackVec3[s]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=y}}step(t){this._timeStep.dt>0&&(this._timeStep.dtRatio=t/this._timeStep.dt),this._timeStep.dt=t,this._timeStep.invDt=1/t;let i=s.now()/1e3;this._updateContacts(),this._solveIslands(),a.dynamics.common.Performance.totalTime=1e3*(s.now()/1e3-i)}addRigidBody(t){if(null!=t._world)throw new Error("A rigid body cannot belong to multiple worlds.");null==this._rigidBodyList?(this._rigidBodyList=t,this._rigidBodyListLast=t):(this._rigidBodyListLast._next=t,t._prev=this._rigidBodyListLast,this._rigidBodyListLast=t),t._world=this;let i=t._shapeList;for(;null!=i;){let t=i._next;i._proxy=this._broadPhase.createProxy(i,i._aabb),i._id=this._shapeIdCount++,this._numShapes++,i=t}this._numRigidBodies++}removeRigidBody(t){if(t._world!=this)throw new Error("The rigid body doesn't belong to the world.");let i=t._prev,s=t._next;null!=i&&(i._next=s),null!=s&&(s._prev=i),t==this._rigidBodyList&&(this._rigidBodyList=this._rigidBodyList._next),t==this._rigidBodyListLast&&(this._rigidBodyListLast=this._rigidBodyListLast._prev),t._next=null,t._prev=null,t._world=null;let a=t._shapeList;for(;null!=a;){let t=a._next;this._broadPhase.destroyProxy(a._proxy),a._proxy=null,a._id=-1;let i=a._rigidBody._contactLinkList;for(;null!=i;){let t=i._next,s=i._contact;if(s._s1==a||s._s2==a){let t=i._other;t._sleeping=!1,t._sleepTime=0;let a=this._contactManager,o=s._prev,n=s._next;if(null!=o&&(o._next=n),null!=n&&(n._prev=o),s==a._contactList&&(a._contactList=a._contactList._next),s==a._contactListLast&&(a._contactListLast=a._contactListLast._prev),s._next=null,s._prev=null,s._touching){let t=s._s1._contactCallback,i=s._s2._contactCallback;t==i&&(i=null),null!=t&&t.endContact(s),null!=i&&i.endContact(s)}let e=s._link1._prev,r=s._link1._next;null!=e&&(e._next=r),null!=r&&(r._prev=e),s._link1==s._b1._contactLinkList&&(s._b1._contactLinkList=s._b1._contactLinkList._next),s._link1==s._b1._contactLinkListLast&&(s._b1._contactLinkListLast=s._b1._contactLinkListLast._prev),s._link1._next=null,s._link1._prev=null;let _=s._link2._prev,l=s._link2._next;null!=_&&(_._next=l),null!=l&&(l._prev=_),s._link2==s._b2._contactLinkList&&(s._b2._contactLinkList=s._b2._contactLinkList._next),s._link2==s._b2._contactLinkListLast&&(s._b2._contactLinkListLast=s._b2._contactLinkListLast._prev),s._link2._next=null,s._link2._prev=null,s._b1._numContactLinks--,s._b2._numContactLinks--,s._link1._other=null,s._link2._other=null,s._link1._contact=null,s._link2._contact=null,s._s1=null,s._s2=null,s._b1=null,s._b2=null,s._touching=!1,s._cachedDetectorData._clear(),s._manifold._clear(),s._detector=null;let h=s._contactConstraint;h._s1=null,h._s2=null,h._b1=null,h._b2=null,h._tf1=null,h._tf2=null,s._next=a._contactPool,a._contactPool=s,a._numContacts--}i=t}this._numShapes--,a=t}this._numRigidBodies--}addJoint(t){if(null!=t._world)throw new Error("A joint cannot belong to multiple worlds.");null==this._jointList?(this._jointList=t,this._jointListLast=t):(this._jointListLast._next=t,t._prev=this._jointListLast,this._jointListLast=t),t._world=this,t._link1._other=t._b2,t._link2._other=t._b1,null==t._b1._jointLinkList?(t._b1._jointLinkList=t._link1,t._b1._jointLinkListLast=t._link1):(t._b1._jointLinkListLast._next=t._link1,t._link1._prev=t._b1._jointLinkListLast,t._b1._jointLinkListLast=t._link1),null==t._b2._jointLinkList?(t._b2._jointLinkList=t._link2,t._b2._jointLinkListLast=t._link2):(t._b2._jointLinkListLast._next=t._link2,t._link2._prev=t._b2._jointLinkListLast,t._b2._jointLinkListLast=t._link2),t._b1._numJointLinks++,t._b2._numJointLinks++;let i=t._b1;i._sleeping=!1,i._sleepTime=0;let s=t._b2;s._sleeping=!1,s._sleepTime=0,t._syncAnchors(),this._numJoints++}removeJoint(t){if(t._world!=this)throw new Error("The joint doesn't belong to the world.");let i=t._prev,s=t._next;null!=i&&(i._next=s),null!=s&&(s._prev=i),t==this._jointList&&(this._jointList=this._jointList._next),t==this._jointListLast&&(this._jointListLast=this._jointListLast._prev),t._next=null,t._prev=null,t._world=null;let a=t._link1._prev,o=t._link1._next;null!=a&&(a._next=o),null!=o&&(o._prev=a),t._link1==t._b1._jointLinkList&&(t._b1._jointLinkList=t._b1._jointLinkList._next),t._link1==t._b1._jointLinkListLast&&(t._b1._jointLinkListLast=t._b1._jointLinkListLast._prev),t._link1._next=null,t._link1._prev=null;let n=t._link2._prev,e=t._link2._next;null!=n&&(n._next=e),null!=e&&(e._prev=n),t._link2==t._b2._jointLinkList&&(t._b2._jointLinkList=t._b2._jointLinkList._next),t._link2==t._b2._jointLinkListLast&&(t._b2._jointLinkListLast=t._b2._jointLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._link1._other=null,t._link2._other=null,t._b1._numJointLinks--,t._b2._numJointLinks--;let r=t._b1;r._sleeping=!1,r._sleepTime=0;let _=t._b2;_._sleeping=!1,_._sleepTime=0,this._numJoints--}setDebugDraw(t){this._debugDraw=t}getDebugDraw(){return this._debugDraw}debugDraw(){null!=this._debugDraw&&(2==this._broadPhase._type&&this._drawBvh(this._debugDraw,this._broadPhase._tree),this._drawRigidBodies(this._debugDraw),this._drawConstraints(this._debugDraw))}rayCast(t,i,s){let a=this._rayCastWrapper.begin;a.x=t.x,a.y=t.y,a.z=t.z;let o=this._rayCastWrapper.end;o.x=i.x,o.y=i.y,o.z=i.z,this._rayCastWrapper.callback=s,this._broadPhase.rayCast(t,i,this._rayCastWrapper)}convexCast(t,i,s,a){this._convexCastWrapper.convex=t;let o=this._convexCastWrapper.begin;o._positionX=i._positionX,o._positionY=i._positionY,o._positionZ=i._positionZ,o._rotation00=i._rotation00,o._rotation01=i._rotation01,o._rotation02=i._rotation02,o._rotation10=i._rotation10,o._rotation11=i._rotation11,o._rotation12=i._rotation12,o._rotation20=i._rotation20,o._rotation21=i._rotation21,o._rotation22=i._rotation22;let n=this._convexCastWrapper.translation;n.x=s.x,n.y=s.y,n.z=s.z,this._convexCastWrapper.callback=a,this._broadPhase.convexCast(t,i,s,this._convexCastWrapper)}aabbTest(t,i){this._aabbTestWrapper._aabb.copyFrom(t),this._aabbTestWrapper._callback=i,this._broadPhase.aabbTest(t,this._aabbTestWrapper)}getRigidBodyList(){return this._rigidBodyList}getJointList(){return this._jointList}getBroadPhase(){return this._broadPhase}getContactManager(){return this._contactManager}getNumRigidBodies(){return this._numRigidBodies}getNumJoints(){return this._numJoints}getNumShapes(){return this._numShapes}getNumIslands(){return this._numIslands}getNumVelocityIterations(){return this._numVelocityIterations}setNumVelocityIterations(t){this._numVelocityIterations=t}getNumPositionIterations(){return this._numPositionIterations}setNumPositionIterations(t){this._numPositionIterations=t}getGravity(){return this._gravity}setGravity(t){let i=this._gravity;i.x=t.x,i.y=t.y,i.z=t.z}},a.dynamics._World||(a.dynamics._World={}),a.dynamics._World.RayCastWrapper=class extends a.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new a.collision.geometry.RayCastHit,this.begin=new a.common.Vec3,this.end=new a.common.Vec3,this.callback=null}process(t){let i=t.userData;i._geom.rayCast(this.begin,this.end,i._transform,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)}},a.dynamics._World.ConvexCastWrapper=class extends a.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new a.collision.geometry.RayCastHit,this.begin=new a.common.Transform,this.translation=new a.common.Vec3,this.zero=new a.common.Vec3,this.callback=null,this.convex=null}process(t){let i=t.userData,s=i._geom._type;s<0||s>5||a.collision.narrowphase.detector.gjkepa.GjkEpa.instance.convexCast(this.convex,i._geom,this.begin,i._transform,this.translation,this.zero,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)}},a.dynamics._World.AabbTestWrapper=class extends a.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this._aabb=new a.collision.geometry.Aabb,this._callback=null}process(t){let i=t.userData,s=i._aabb;s._minX<this._aabb._maxX&&s._maxX>this._aabb._minX&&s._minY<this._aabb._maxY&&s._maxY>this._aabb._minY&&s._minZ<this._aabb._maxZ&&s._maxZ>this._aabb._minZ&&this._callback.process(i)}},a.dynamics.callback||(a.dynamics.callback={}),a.dynamics.callback.AabbTestCallback=class{constructor(){}process(t){}},a.dynamics.callback.ContactCallback=class{constructor(){}beginContact(t){}preSolve(t){}postSolve(t){}endContact(t){}},a.dynamics.callback.RayCastCallback=class{constructor(){}process(t,i){}},a.dynamics.callback.RayCastClosest=class extends a.dynamics.callback.RayCastCallback{constructor(){super(),this.position=new a.common.Vec3,this.normal=new a.common.Vec3,this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}clear(){this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}process(t,i){if(i.fraction<this.fraction){this.shape=t,this.hit=!0,this.fraction=i.fraction;let s=this.position,a=i.position;s.x=a.x,s.y=a.y,s.z=a.z;let o=this.normal,n=i.normal;o.x=n.x,o.y=n.y,o.z=n.z}}},a.dynamics.common||(a.dynamics.common={}),a.dynamics.common.DebugDraw=class{constructor(){this.p=new a.common.Pool,this.wireframe=!1,this.drawShapes=!0,this.drawBvh=!1,this.drawBvhMinLevel=0,this.drawBvhMaxLevel=65536,this.drawAabbs=!1,this.drawBases=!1,this.drawPairs=!1,this.drawContacts=!1,this.drawJoints=!0,this.drawJointLimits=!1,this.sphereCoords=new Array(5),this.tmpSphereVerts=new Array(5),this.tmpSphereNorms=new Array(5);let t=0;for(;t<5;){let i=t++,s=0==i||4==i?1:8;this.sphereCoords[i]=new Array(s),this.tmpSphereVerts[i]=new Array(s),this.tmpSphereNorms[i]=new Array(s);let o=0;for(;o<8;){let t=o++,s=.7853981633974475*i,n=.7853981633974475*t;this.sphereCoords[i][t]=new a.common.Vec3(Math.sin(s)*Math.cos(n),Math.cos(s),-Math.sin(s)*Math.sin(n)),this.tmpSphereVerts[i][t]=new a.common.Vec3,this.tmpSphereNorms[i][t]=new a.common.Vec3}}this.circleCoords=new Array(8),this.circleCoordsShift=new Array(8),this.tmpCircleVerts1=new Array(8),this.tmpCircleVerts2=new Array(8),this.tmpCircleNorms=new Array(8);let i=0;for(;i<8;){let t=i++;this.circleCoords[t]=new a.common.Vec3(Math.cos(.7853981633974475*t),0,-Math.sin(.7853981633974475*t)),this.circleCoordsShift[t]=new a.common.Vec3(Math.cos(.7853981633974475*(t+.5)),0,-Math.sin(.7853981633974475*(t+.5))),this.tmpCircleVerts1[t]=new a.common.Vec3,this.tmpCircleVerts2[t]=new a.common.Vec3,this.tmpCircleNorms[t]=new a.common.Vec3}this.style=new a.dynamics.common.DebugDrawStyle}aabb(t,i,s){let o=this.p,n=(0==o.sizeVec3?new a.common.Vec3:o.stackVec3[--o.sizeVec3]).init(t.x,t.y,t.z),e=this.p,r=(0==e.sizeVec3?new a.common.Vec3:e.stackVec3[--e.sizeVec3]).init(t.x,t.y,i.z),_=this.p,l=(0==_.sizeVec3?new a.common.Vec3:_.stackVec3[--_.sizeVec3]).init(t.x,i.y,t.z),h=this.p,c=(0==h.sizeVec3?new a.common.Vec3:h.stackVec3[--h.sizeVec3]).init(t.x,i.y,i.z),m=this.p,b=(0==m.sizeVec3?new a.common.Vec3:m.stackVec3[--m.sizeVec3]).init(i.x,t.y,t.z),p=this.p,x=(0==p.sizeVec3?new a.common.Vec3:p.stackVec3[--p.sizeVec3]).init(i.x,t.y,i.z),f=this.p,u=(0==f.sizeVec3?new a.common.Vec3:f.stackVec3[--f.sizeVec3]).init(i.x,i.y,t.z),y=this.p,g=(0==y.sizeVec3?new a.common.Vec3:y.stackVec3[--y.sizeVec3]).init(i.x,i.y,i.z);this.line(n,r,s),this.line(l,c,s),this.line(b,x,s),this.line(u,g,s),this.line(n,l,s),this.line(r,c,s),this.line(b,u,s),this.line(x,g,s),this.line(n,b,s),this.line(r,x,s),this.line(l,u,s),this.line(c,g,s);let v=this.p;if(null!=n){if(n.zero(),v.sizeVec3==v.stackVec3.length){let t=new Array(v.sizeVec3<<1),i=0,s=v.sizeVec3;for(;i<s;){let s=i++;t[s]=v.stackVec3[s],v.stackVec3[s]=null}v.stackVec3=t}v.stackVec3[v.sizeVec3++]=n}let d=this.p;if(null!=r){if(r.zero(),d.sizeVec3==d.stackVec3.length){let t=new Array(d.sizeVec3<<1),i=0,s=d.sizeVec3;for(;i<s;){let s=i++;t[s]=d.stackVec3[s],d.stackVec3[s]=null}d.stackVec3=t}d.stackVec3[d.sizeVec3++]=r}let X=this.p;if(null!=l){if(l.zero(),X.sizeVec3==X.stackVec3.length){let t=new Array(X.sizeVec3<<1),i=0,s=X.sizeVec3;for(;i<s;){let s=i++;t[s]=X.stackVec3[s],X.stackVec3[s]=null}X.stackVec3=t}X.stackVec3[X.sizeVec3++]=l}let z=this.p;if(null!=c){if(c.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,s=z.sizeVec3;for(;i<s;){let s=i++;t[s]=z.stackVec3[s],z.stackVec3[s]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=c}let Y=this.p;if(null!=b){if(b.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,s=Y.sizeVec3;for(;i<s;){let s=i++;t[s]=Y.stackVec3[s],Y.stackVec3[s]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=b}let Z=this.p;if(null!=x){if(x.zero(),Z.sizeVec3==Z.stackVec3.length){let t=new Array(Z.sizeVec3<<1),i=0,s=Z.sizeVec3;for(;i<s;){let s=i++;t[s]=Z.stackVec3[s],Z.stackVec3[s]=null}Z.stackVec3=t}Z.stackVec3[Z.sizeVec3++]=x}let M=this.p;if(null!=u){if(u.zero(),M.sizeVec3==M.stackVec3.length){let t=new Array(M.sizeVec3<<1),i=0,s=M.sizeVec3;for(;i<s;){let s=i++;t[s]=M.stackVec3[s],M.stackVec3[s]=null}M.stackVec3=t}M.stackVec3[M.sizeVec3++]=u}let I=this.p;if(null!=g){if(g.zero(),I.sizeVec3==I.stackVec3.length){let t=new Array(I.sizeVec3<<1),i=0,s=I.sizeVec3;for(;i<s;){let s=i++;t[s]=I.stackVec3[s],I.stackVec3[s]=null}I.stackVec3=t}I.stackVec3[I.sizeVec3++]=g}}basis(t,i,s,o,n){let e=this.p,r=0==e.sizeVec3?new a.common.Vec3:e.stackVec3[--e.sizeVec3],_=this.p,l=0==_.sizeMat3?new a.common.Mat3:_.stackMat3[--_.sizeMat3],h=this.p,c=0==h.sizeVec3?new a.common.Vec3:h.stackVec3[--h.sizeVec3],m=this.p,b=0==m.sizeVec3?new a.common.Vec3:m.stackVec3[--m.sizeVec3],p=this.p,x=0==p.sizeVec3?new a.common.Vec3:p.stackVec3[--p.sizeVec3],f=r;f.x=t._positionX,f.y=t._positionY,f.z=t._positionZ;let u=l;u.e00=t._rotation00,u.e01=t._rotation01,u.e02=t._rotation02,u.e10=t._rotation10,u.e11=t._rotation11,u.e12=t._rotation12,u.e20=t._rotation20,u.e21=t._rotation21,u.e22=t._rotation22,c.init(l.e00,l.e10,l.e20),b.init(l.e01,l.e11,l.e21),x.init(l.e02,l.e12,l.e22),c.x*=i,c.y*=i,c.z*=i;let y=c;y.x+=r.x,y.y+=r.y,y.z+=r.z,b.x*=i,b.y*=i,b.z*=i;let g=b;g.x+=r.x,g.y+=r.y,g.z+=r.z,x.x*=i,x.y*=i,x.z*=i;let v=x;v.x+=r.x,v.y+=r.y,v.z+=r.z,this.line(r,c,s),this.line(r,b,o),this.line(r,x,n);let d=this.p;if(null!=r){if(r.zero(),d.sizeVec3==d.stackVec3.length){let t=new Array(d.sizeVec3<<1),i=0,s=d.sizeVec3;for(;i<s;){let s=i++;t[s]=d.stackVec3[s],d.stackVec3[s]=null}d.stackVec3=t}d.stackVec3[d.sizeVec3++]=r}let X=this.p;if(null!=l){if(l.e00=1,l.e01=0,l.e02=0,l.e10=0,l.e11=1,l.e12=0,l.e20=0,l.e21=0,l.e22=1,X.sizeMat3==X.stackMat3.length){let t=new Array(X.sizeMat3<<1),i=0,s=X.sizeMat3;for(;i<s;){let s=i++;t[s]=X.stackMat3[s],X.stackMat3[s]=null}X.stackMat3=t}X.stackMat3[X.sizeMat3++]=l}let z=this.p;if(null!=c){if(c.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,s=z.sizeVec3;for(;i<s;){let s=i++;t[s]=z.stackVec3[s],z.stackVec3[s]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=c}let Y=this.p;if(null!=b){if(b.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,s=Y.sizeVec3;for(;i<s;){let s=i++;t[s]=Y.stackVec3[s],Y.stackVec3[s]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=b}let Z=this.p;if(null!=x){if(x.zero(),Z.sizeVec3==Z.stackVec3.length){let t=new Array(Z.sizeVec3<<1),i=0,s=Z.sizeVec3;for(;i<s;){let s=i++;t[s]=Z.stackVec3[s],Z.stackVec3[s]=null}Z.stackVec3=t}Z.stackVec3[Z.sizeVec3++]=x}}ellipse(t,i,s,a,o,n){this.arc(t,i,s,a,o,0,6.28318530717958,!1,n)}arc(t,i,s,o,n,e,r,_,l){let h=this.p,c=0==h.sizeVec3?new a.common.Vec3:h.stackVec3[--h.sizeVec3];c.x=i.x,c.y=i.y,c.z=i.z;let m=c;m.x*=o,m.y*=o,m.z*=o,i=m;let b=this.p,p=0==b.sizeVec3?new a.common.Vec3:b.stackVec3[--b.sizeVec3];p.x=s.x,p.y=s.y,p.z=s.z;let x=p;x.x*=n,x.y*=n,x.z*=n,s=x;let f=r-e;f<0&&(f=-f);let u=f/.5235987755982984+.5|0;0==u&&(u=1);let y=e,g=(r-e)/u,v=this.p,d=0==v.sizeVec3?new a.common.Vec3:v.stackVec3[--v.sizeVec3];d.x=t.x,d.y=t.y,d.z=t.z;let X=d,z=Math.cos(e);X.x+=m.x*z,X.y+=m.y*z,X.z+=m.z*z;let Y=Math.sin(e);X.x+=x.x*Y,X.y+=x.y*Y,X.z+=x.z*Y;let Z=X;_&&this.line(t,X,l);let M=0,I=u;for(;M<I;){++M,y+=g;let i=this.p,s=0==i.sizeVec3?new a.common.Vec3:i.stackVec3[--i.sizeVec3];s.x=t.x,s.y=t.y,s.z=t.z;let o=s,n=Math.cos(y);o.x+=m.x*n,o.y+=m.y*n,o.z+=m.z*n;let e=Math.sin(y);o.x+=x.x*e,o.y+=x.y*e,o.z+=x.z*e,this.line(Z,o,l);let r=this.p;if(null!=Z){if(Z.zero(),r.sizeVec3==r.stackVec3.length){let t=new Array(r.sizeVec3<<1),i=0,s=r.sizeVec3;for(;i<s;){let s=i++;t[s]=r.stackVec3[s],r.stackVec3[s]=null}r.stackVec3=t}r.stackVec3[r.sizeVec3++]=Z}Z=o}_&&this.line(t,Z,l);let V=this.p;if(null!=Z){if(Z.zero(),V.sizeVec3==V.stackVec3.length){let t=new Array(V.sizeVec3<<1),i=0,s=V.sizeVec3;for(;i<s;){let s=i++;t[s]=V.stackVec3[s],V.stackVec3[s]=null}V.stackVec3=t}V.stackVec3[V.sizeVec3++]=Z}let w=this.p;if(null!=m){if(m.zero(),w.sizeVec3==w.stackVec3.length){let t=new Array(w.sizeVec3<<1),i=0,s=w.sizeVec3;for(;i<s;){let s=i++;t[s]=w.stackVec3[s],w.stackVec3[s]=null}w.stackVec3=t}w.stackVec3[w.sizeVec3++]=m}let L=this.p;if(null!=x){if(x.zero(),L.sizeVec3==L.stackVec3.length){let t=new Array(L.sizeVec3<<1),i=0,s=L.sizeVec3;for(;i<s;){let s=i++;t[s]=L.stackVec3[s],L.stackVec3[s]=null}L.stackVec3=t}L.stackVec3[L.sizeVec3++]=x}}cone(t,i,s,o){let n=this.p,e=0==n.sizeVec3?new a.common.Vec3:n.stackVec3[--n.sizeVec3],r=this.p,_=0==r.sizeVec3?new a.common.Vec3:r.stackVec3[--r.sizeVec3],l=this.p,h=0==l.sizeVec3?new a.common.Vec3:l.stackVec3[--l.sizeVec3],c=this.p,m=0==c.sizeVec3?new a.common.Vec3:c.stackVec3[--c.sizeVec3],b=this.p,p=0==b.sizeMat3?new a.common.Mat3:b.stackMat3[--b.sizeMat3],x=m;x.x=t._positionX,x.y=t._positionY,x.z=t._positionZ;let f=p;f.e00=t._rotation00,f.e01=t._rotation01,f.e02=t._rotation02,f.e10=t._rotation10,f.e11=t._rotation11,f.e12=t._rotation12,f.e20=t._rotation20,f.e21=t._rotation21,f.e22=t._rotation22,e.init(p.e00,p.e10,p.e20),_.init(p.e01,p.e11,p.e21),h.init(p.e02,p.e12,p.e22);let u=this.p,y=0==u.sizeVec3?new a.common.Vec3:u.stackVec3[--u.sizeVec3];y.x=m.x,y.y=m.y,y.z=m.z;let g=y;g.x+=_.x*s,g.y+=_.y*s,g.z+=_.z*s;let v=this.p,d=0==v.sizeVec3?new a.common.Vec3:v.stackVec3[--v.sizeVec3];d.x=m.x,d.y=m.y,d.z=m.z;let X=d,z=-s;if(X.x+=_.x*z,X.y+=_.y*z,X.z+=_.z*z,this.wireframe){let t=this.p,s=0==t.sizeVec3?new a.common.Vec3:t.stackVec3[--t.sizeVec3];s.x=X.x,s.y=X.y,s.z=X.z;let n=s,r=-i;n.x+=e.x*r,n.y+=e.y*r,n.z+=e.z*r,n.x+=0*h.x,n.y+=0*h.y,n.z+=0*h.z;let _=this.p,l=0==_.sizeVec3?new a.common.Vec3:_.stackVec3[--_.sizeVec3];l.x=X.x,l.y=X.y,l.z=X.z;let c=l;c.x+=e.x*i,c.y+=e.y*i,c.z+=e.z*i,c.x+=0*h.x,c.y+=0*h.y,c.z+=0*h.z;let m=this.p,b=0==m.sizeVec3?new a.common.Vec3:m.stackVec3[--m.sizeVec3];b.x=X.x,b.y=X.y,b.z=X.z;let p=b;p.x+=0*e.x,p.y+=0*e.y,p.z+=0*e.z;let x=-i;p.x+=h.x*x,p.y+=h.y*x,p.z+=h.z*x;let f=this.p,u=0==f.sizeVec3?new a.common.Vec3:f.stackVec3[--f.sizeVec3];u.x=X.x,u.y=X.y,u.z=X.z;let y=u;y.x+=0*e.x,y.y+=0*e.y,y.z+=0*e.z,y.x+=h.x*i,y.y+=h.y*i,y.z+=h.z*i,this.ellipse(X,e,h,i,i,o),this.line(g,n,o),this.line(g,c,o),this.line(g,p,o),this.line(g,y,o);let v=this.p;if(null!=n){if(n.zero(),v.sizeVec3==v.stackVec3.length){let t=new Array(v.sizeVec3<<1),i=0,s=v.sizeVec3;for(;i<s;){let s=i++;t[s]=v.stackVec3[s],v.stackVec3[s]=null}v.stackVec3=t}v.stackVec3[v.sizeVec3++]=n}let d=this.p;if(null!=c){if(c.zero(),d.sizeVec3==d.stackVec3.length){let t=new Array(d.sizeVec3<<1),i=0,s=d.sizeVec3;for(;i<s;){let s=i++;t[s]=d.stackVec3[s],d.stackVec3[s]=null}d.stackVec3=t}d.stackVec3[d.sizeVec3++]=c}let z=this.p;if(null!=p){if(p.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,s=z.sizeVec3;for(;i<s;){let s=i++;t[s]=z.stackVec3[s],z.stackVec3[s]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=p}let Y=this.p;if(null!=y){if(y.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,s=Y.sizeVec3;for(;i<s;){let s=i++;t[s]=Y.stackVec3[s],Y.stackVec3[s]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=y}}else{let t=1/Math.sqrt(i*i+4*s*s),n=2*s*t,e=i*t,r=0;for(;r<8;){let t=r++,a=this.tmpCircleNorms[t],o=this.circleCoords[t];a.x=o.x,a.y=o.y,a.z=o.z,a.x*=n,a.y*=n,a.z*=n,a.y+=e;let l=this.tmpCircleNorms[t],h=l.x*p.e10+l.y*p.e11+l.z*p.e12,c=l.x*p.e20+l.y*p.e21+l.z*p.e22;l.x=l.x*p.e00+l.y*p.e01+l.z*p.e02,l.y=h,l.z=c;let b=this.tmpCircleVerts1[t],x=this.circleCoordsShift[t];b.x=x.x,b.y=x.y,b.z=x.z,b.x*=n,b.y*=n,b.z*=n,b.y+=e;let f=this.tmpCircleVerts1[t],u=f.x*p.e10+f.y*p.e11+f.z*p.e12,y=f.x*p.e20+f.y*p.e21+f.z*p.e22;f.x=f.x*p.e00+f.y*p.e01+f.z*p.e02,f.y=u,f.z=y;let g=this.tmpCircleVerts2[t],v=this.circleCoords[t];g.x=v.x,g.y=v.y,g.z=v.z;let d=g.x*p.e10+g.y*p.e11+g.z*p.e12,X=g.x*p.e20+g.y*p.e21+g.z*p.e22;g.x=g.x*p.e00+g.y*p.e01+g.z*p.e02,g.y=d,g.z=X,g.x*=i,g.y*=i,g.z*=i,g.x+=m.x,g.y+=m.y,g.z+=m.z;let z=this.tmpCircleVerts2[t],Y=-s;z.x+=_.x*Y,z.y+=_.y*Y,z.z+=_.z*Y}let l=0;for(;l<8;){let t=l++,i=this.tmpCircleVerts2[t],s=this.tmpCircleVerts2[(t+1)%8],n=this.tmpCircleVerts1[t];this.triangle(g,i,s,n,this.tmpCircleNorms[t],this.tmpCircleNorms[(t+1)%8],o),i=this.tmpCircleVerts2[(t+1)%8],s=this.tmpCircleVerts2[t];let e=this.p,r=0==e.sizeVec3?new a.common.Vec3:e.stackVec3[--e.sizeVec3];r.x=_.x,r.y=_.y,r.z=_.z;let h=r;h.x=-h.x,h.y=-h.y,h.z=-h.z,n=h,this.triangle(X,i,s,h,h,h,o);let c=this.p;if(null!=h){if(h.zero(),c.sizeVec3==c.stackVec3.length){let t=new Array(c.sizeVec3<<1),i=0,s=c.sizeVec3;for(;i<s;){let s=i++;t[s]=c.stackVec3[s],c.stackVec3[s]=null}c.stackVec3=t}c.stackVec3[c.sizeVec3++]=h}}}let Y=this.p;if(null!=g){if(g.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,s=Y.sizeVec3;for(;i<s;){let s=i++;t[s]=Y.stackVec3[s],Y.stackVec3[s]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=g}let Z=this.p;if(null!=X){if(X.zero(),Z.sizeVec3==Z.stackVec3.length){let t=new Array(Z.sizeVec3<<1),i=0,s=Z.sizeVec3;for(;i<s;){let s=i++;t[s]=Z.stackVec3[s],Z.stackVec3[s]=null}Z.stackVec3=t}Z.stackVec3[Z.sizeVec3++]=X}let M=this.p;if(null!=m){if(m.zero(),M.sizeVec3==M.stackVec3.length){let t=new Array(M.sizeVec3<<1),i=0,s=M.sizeVec3;for(;i<s;){let s=i++;t[s]=M.stackVec3[s],M.stackVec3[s]=null}M.stackVec3=t}M.stackVec3[M.sizeVec3++]=m}let I=this.p;if(null!=p){if(p.e00=1,p.e01=0,p.e02=0,p.e10=0,p.e11=1,p.e12=0,p.e20=0,p.e21=0,p.e22=1,I.sizeMat3==I.stackMat3.length){let t=new Array(I.sizeMat3<<1),i=0,s=I.sizeMat3;for(;i<s;){let s=i++;t[s]=I.stackMat3[s],I.stackMat3[s]=null}I.stackMat3=t}I.stackMat3[I.sizeMat3++]=p}let V=this.p;if(null!=e){if(e.zero(),V.sizeVec3==V.stackVec3.length){let t=new Array(V.sizeVec3<<1),i=0,s=V.sizeVec3;for(;i<s;){let s=i++;t[s]=V.stackVec3[s],V.stackVec3[s]=null}V.stackVec3=t}V.stackVec3[V.sizeVec3++]=e}let w=this.p;if(null!=_){if(_.zero(),w.sizeVec3==w.stackVec3.length){let t=new Array(w.sizeVec3<<1),i=0,s=w.sizeVec3;for(;i<s;){let s=i++;t[s]=w.stackVec3[s],w.stackVec3[s]=null}w.stackVec3=t}w.stackVec3[w.sizeVec3++]=_}let L=this.p;if(null!=h){if(h.zero(),L.sizeVec3==L.stackVec3.length){let t=new Array(L.sizeVec3<<1),i=0,s=L.sizeVec3;for(;i<s;){let s=i++;t[s]=L.stackVec3[s],L.stackVec3[s]=null}L.stackVec3=t}L.stackVec3[L.sizeVec3++]=h}}cylinder(t,i,s,o){let n=this.p,e=0==n.sizeVec3?new a.common.Vec3:n.stackVec3[--n.sizeVec3],r=this.p,_=0==r.sizeVec3?new a.common.Vec3:r.stackVec3[--r.sizeVec3],l=this.p,h=0==l.sizeVec3?new a.common.Vec3:l.stackVec3[--l.sizeVec3],c=this.p,m=0==c.sizeVec3?new a.common.Vec3:c.stackVec3[--c.sizeVec3],b=this.p,p=0==b.sizeMat3?new a.common.Mat3:b.stackMat3[--b.sizeMat3],x=m;x.x=t._positionX,x.y=t._positionY,x.z=t._positionZ;let f=p;f.e00=t._rotation00,f.e01=t._rotation01,f.e02=t._rotation02,f.e10=t._rotation10,f.e11=t._rotation11,f.e12=t._rotation12,f.e20=t._rotation20,f.e21=t._rotation21,f.e22=t._rotation22,e.init(p.e00,p.e10,p.e20),_.init(p.e01,p.e11,p.e21),h.init(p.e02,p.e12,p.e22);let u=this.p,y=0==u.sizeVec3?new a.common.Vec3:u.stackVec3[--u.sizeVec3];y.x=m.x,y.y=m.y,y.z=m.z;let g=y;g.x+=_.x*s,g.y+=_.y*s,g.z+=_.z*s;let v=this.p,d=0==v.sizeVec3?new a.common.Vec3:v.stackVec3[--v.sizeVec3];d.x=m.x,d.y=m.y,d.z=m.z;let X=d,z=-s;if(X.x+=_.x*z,X.y+=_.y*z,X.z+=_.z*z,this.wireframe){let t=this.p,s=0==t.sizeVec3?new a.common.Vec3:t.stackVec3[--t.sizeVec3];s.x=g.x,s.y=g.y,s.z=g.z;let n=s,r=-i;n.x+=e.x*r,n.y+=e.y*r,n.z+=e.z*r,n.x+=0*h.x,n.y+=0*h.y,n.z+=0*h.z;let _=this.p,l=0==_.sizeVec3?new a.common.Vec3:_.stackVec3[--_.sizeVec3];l.x=g.x,l.y=g.y,l.z=g.z;let c=l;c.x+=e.x*i,c.y+=e.y*i,c.z+=e.z*i,c.x+=0*h.x,c.y+=0*h.y,c.z+=0*h.z;let m=this.p,b=0==m.sizeVec3?new a.common.Vec3:m.stackVec3[--m.sizeVec3];b.x=g.x,b.y=g.y,b.z=g.z;let p=b;p.x+=0*e.x,p.y+=0*e.y,p.z+=0*e.z;let x=-i;p.x+=h.x*x,p.y+=h.y*x,p.z+=h.z*x;let f=this.p,u=0==f.sizeVec3?new a.common.Vec3:f.stackVec3[--f.sizeVec3];u.x=g.x,u.y=g.y,u.z=g.z;let y=u;y.x+=0*e.x,y.y+=0*e.y,y.z+=0*e.z,y.x+=h.x*i,y.y+=h.y*i,y.z+=h.z*i;let v=this.p,d=0==v.sizeVec3?new a.common.Vec3:v.stackVec3[--v.sizeVec3];d.x=X.x,d.y=X.y,d.z=X.z;let z=d,Y=-i;z.x+=e.x*Y,z.y+=e.y*Y,z.z+=e.z*Y,z.x+=0*h.x,z.y+=0*h.y,z.z+=0*h.z;let Z=this.p,M=0==Z.sizeVec3?new a.common.Vec3:Z.stackVec3[--Z.sizeVec3];M.x=X.x,M.y=X.y,M.z=X.z;let I=M;I.x+=e.x*i,I.y+=e.y*i,I.z+=e.z*i,I.x+=0*h.x,I.y+=0*h.y,I.z+=0*h.z;let V=this.p,w=0==V.sizeVec3?new a.common.Vec3:V.stackVec3[--V.sizeVec3];w.x=X.x,w.y=X.y,w.z=X.z;let L=w;L.x+=0*e.x,L.y+=0*e.y,L.z+=0*e.z;let k=-i;L.x+=h.x*k,L.y+=h.y*k,L.z+=h.z*k;let A=this.p,B=0==A.sizeVec3?new a.common.Vec3:A.stackVec3[--A.sizeVec3];B.x=X.x,B.y=X.y,B.z=X.z;let P=B;P.x+=0*e.x,P.y+=0*e.y,P.z+=0*e.z,P.x+=h.x*i,P.y+=h.y*i,P.z+=h.z*i,this.ellipse(g,e,h,i,i,o),this.ellipse(X,e,h,i,i,o),this.line(n,z,o),this.line(c,I,o),this.line(p,L,o),this.line(y,P,o);let S=this.p;if(null!=n){if(n.zero(),S.sizeVec3==S.stackVec3.length){let t=new Array(S.sizeVec3<<1),i=0,s=S.sizeVec3;for(;i<s;){let s=i++;t[s]=S.stackVec3[s],S.stackVec3[s]=null}S.stackVec3=t}S.stackVec3[S.sizeVec3++]=n}let T=this.p;if(null!=c){if(c.zero(),T.sizeVec3==T.stackVec3.length){let t=new Array(T.sizeVec3<<1),i=0,s=T.sizeVec3;for(;i<s;){let s=i++;t[s]=T.stackVec3[s],T.stackVec3[s]=null}T.stackVec3=t}T.stackVec3[T.sizeVec3++]=c}let C=this.p;if(null!=p){if(p.zero(),C.sizeVec3==C.stackVec3.length){let t=new Array(C.sizeVec3<<1),i=0,s=C.sizeVec3;for(;i<s;){let s=i++;t[s]=C.stackVec3[s],C.stackVec3[s]=null}C.stackVec3=t}C.stackVec3[C.sizeVec3++]=p}let j=this.p;if(null!=y){if(y.zero(),j.sizeVec3==j.stackVec3.length){let t=new Array(j.sizeVec3<<1),i=0,s=j.sizeVec3;for(;i<s;){let s=i++;t[s]=j.stackVec3[s],j.stackVec3[s]=null}j.stackVec3=t}j.stackVec3[j.sizeVec3++]=y}let R=this.p;if(null!=z){if(z.zero(),R.sizeVec3==R.stackVec3.length){let t=new Array(R.sizeVec3<<1),i=0,s=R.sizeVec3;for(;i<s;){let s=i++;t[s]=R.stackVec3[s],R.stackVec3[s]=null}R.stackVec3=t}R.stackVec3[R.sizeVec3++]=z}let q=this.p;if(null!=I){if(I.zero(),q.sizeVec3==q.stackVec3.length){let t=new Array(q.sizeVec3<<1),i=0,s=q.sizeVec3;for(;i<s;){let s=i++;t[s]=q.stackVec3[s],q.stackVec3[s]=null}q.stackVec3=t}q.stackVec3[q.sizeVec3++]=I}let E=this.p;if(null!=L){if(L.zero(),E.sizeVec3==E.stackVec3.length){let t=new Array(E.sizeVec3<<1),i=0,s=E.sizeVec3;for(;i<s;){let s=i++;t[s]=E.stackVec3[s],E.stackVec3[s]=null}E.stackVec3=t}E.stackVec3[E.sizeVec3++]=L}let D=this.p;if(null!=P){if(P.zero(),D.sizeVec3==D.stackVec3.length){let t=new Array(D.sizeVec3<<1),i=0,s=D.sizeVec3;for(;i<s;){let s=i++;t[s]=D.stackVec3[s],D.stackVec3[s]=null}D.stackVec3=t}D.stackVec3[D.sizeVec3++]=P}}else{let t=0;for(;t<8;){let a=t++,o=this.tmpCircleNorms[a],n=this.circleCoords[a];o.x=n.x,o.y=n.y,o.z=n.z;let e=o.x*p.e10+o.y*p.e11+o.z*p.e12,r=o.x*p.e20+o.y*p.e21+o.z*p.e22;o.x=o.x*p.e00+o.y*p.e01+o.z*p.e02,o.y=e,o.z=r;let l=this.tmpCircleVerts1[a],h=this.tmpCircleNorms[a];l.x=h.x,l.y=h.y,l.z=h.z,l.x*=i,l.y*=i,l.z*=i,l.x+=m.x,l.y+=m.y,l.z+=m.z;let c=this.tmpCircleVerts2[a],b=this.tmpCircleVerts1[a];c.x=b.x,c.y=b.y,c.z=b.z;let x=this.tmpCircleVerts1[a];x.x+=_.x*s,x.y+=_.y*s,x.z+=_.z*s;let f=this.tmpCircleVerts2[a],u=-s;f.x+=_.x*u,f.y+=_.y*u,f.z+=_.z*u}let n=0;for(;n<8;){let t=n++,i=g,s=this.tmpCircleVerts1[t],e=this.tmpCircleVerts1[(t+1)%8],r=_;this.triangle(g,s,e,r,r,r,o),i=X,s=this.tmpCircleVerts2[(t+1)%8],e=this.tmpCircleVerts2[t];let l=this.p,h=0==l.sizeVec3?new a.common.Vec3:l.stackVec3[--l.sizeVec3];h.x=_.x,h.y=_.y,h.z=_.z;let c=h;c.x=-c.x,c.y=-c.y,c.z=-c.z,r=c,this.triangle(X,s,e,c,c,c,o);let m=this.p;if(null!=c){if(c.zero(),m.sizeVec3==m.stackVec3.length){let t=new Array(m.sizeVec3<<1),i=0,s=m.sizeVec3;for(;i<s;){let s=i++;t[s]=m.stackVec3[s],m.stackVec3[s]=null}m.stackVec3=t}m.stackVec3[m.sizeVec3++]=c}i=this.tmpCircleVerts1[t],s=this.tmpCircleVerts2[t],e=this.tmpCircleVerts2[(t+1)%8],r=this.tmpCircleNorms[t];let b=this.tmpCircleNorms[(t+1)%8];this.rect(i,s,e,this.tmpCircleVerts1[(t+1)%8],r,r,b,b,o)}}let Y=this.p;if(null!=g){if(g.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,s=Y.sizeVec3;for(;i<s;){let s=i++;t[s]=Y.stackVec3[s],Y.stackVec3[s]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=g}let Z=this.p;if(null!=X){if(X.zero(),Z.sizeVec3==Z.stackVec3.length){let t=new Array(Z.sizeVec3<<1),i=0,s=Z.sizeVec3;for(;i<s;){let s=i++;t[s]=Z.stackVec3[s],Z.stackVec3[s]=null}Z.stackVec3=t}Z.stackVec3[Z.sizeVec3++]=X}let M=this.p;if(null!=m){if(m.zero(),M.sizeVec3==M.stackVec3.length){let t=new Array(M.sizeVec3<<1),i=0,s=M.sizeVec3;for(;i<s;){let s=i++;t[s]=M.stackVec3[s],M.stackVec3[s]=null}M.stackVec3=t}M.stackVec3[M.sizeVec3++]=m}let I=this.p;if(null!=p){if(p.e00=1,p.e01=0,p.e02=0,p.e10=0,p.e11=1,p.e12=0,p.e20=0,p.e21=0,p.e22=1,I.sizeMat3==I.stackMat3.length){let t=new Array(I.sizeMat3<<1),i=0,s=I.sizeMat3;for(;i<s;){let s=i++;t[s]=I.stackMat3[s],I.stackMat3[s]=null}I.stackMat3=t}I.stackMat3[I.sizeMat3++]=p}let V=this.p;if(null!=e){if(e.zero(),V.sizeVec3==V.stackVec3.length){let t=new Array(V.sizeVec3<<1),i=0,s=V.sizeVec3;for(;i<s;){let s=i++;t[s]=V.stackVec3[s],V.stackVec3[s]=null}V.stackVec3=t}V.stackVec3[V.sizeVec3++]=e}let w=this.p;if(null!=_){if(_.zero(),w.sizeVec3==w.stackVec3.length){let t=new Array(w.sizeVec3<<1),i=0,s=w.sizeVec3;for(;i<s;){let s=i++;t[s]=w.stackVec3[s],w.stackVec3[s]=null}w.stackVec3=t}w.stackVec3[w.sizeVec3++]=_}let L=this.p;if(null!=h){if(h.zero(),L.sizeVec3==L.stackVec3.length){let t=new Array(L.sizeVec3<<1),i=0,s=L.sizeVec3;for(;i<s;){let s=i++;t[s]=L.stackVec3[s],L.stackVec3[s]=null}L.stackVec3=t}L.stackVec3[L.sizeVec3++]=h}}capsule(t,i,s,o){let n=this.p,e=0==n.sizeVec3?new a.common.Vec3:n.stackVec3[--n.sizeVec3],r=this.p,_=0==r.sizeVec3?new a.common.Vec3:r.stackVec3[--r.sizeVec3],l=this.p,h=0==l.sizeVec3?new a.common.Vec3:l.stackVec3[--l.sizeVec3],c=this.p,m=0==c.sizeVec3?new a.common.Vec3:c.stackVec3[--c.sizeVec3],b=this.p,p=0==b.sizeMat3?new a.common.Mat3:b.stackMat3[--b.sizeMat3],x=m;x.x=t._positionX,x.y=t._positionY,x.z=t._positionZ;let f=p;f.e00=t._rotation00,f.e01=t._rotation01,f.e02=t._rotation02,f.e10=t._rotation10,f.e11=t._rotation11,f.e12=t._rotation12,f.e20=t._rotation20,f.e21=t._rotation21,f.e22=t._rotation22,e.init(p.e00,p.e10,p.e20),_.init(p.e01,p.e11,p.e21),h.init(p.e02,p.e12,p.e22);let u=this.tmpSphereVerts,y=this.tmpSphereNorms,g=0;for(;g<5;){let t=g++,i=this.tmpSphereVerts[t].length,s=0;for(;s<i;){let i=s++,a=y[t][i],o=this.sphereCoords[t][i];a.x=o.x,a.y=o.y,a.z=o.z;let n=a.x*p.e10+a.y*p.e11+a.z*p.e12,e=a.x*p.e20+a.y*p.e21+a.z*p.e22;a.x=a.x*p.e00+a.y*p.e01+a.z*p.e02,a.y=n,a.z=e}}let v=0;for(;v<4;){let t=v++;if(0==t){let t=0;for(;t<3;){let a=t++,o=this.tmpSphereVerts[a].length,n=0;for(;n<o;){let t=n++,o=u[a][t],e=y[a][t];o.x=e.x,o.y=e.y,o.z=e.z,o.x*=i,o.y*=i,o.z*=i,o.x+=m.x,o.y+=m.y,o.z+=m.z,o.x+=_.x*s,o.y+=_.y*s,o.z+=_.z*s}}}if(2==t){let t=2;for(;t<5;){let a=t++,o=this.tmpSphereVerts[a].length,n=0;for(;n<o;){let t=n++,o=u[a][t],e=y[a][t];o.x=e.x,o.y=e.y,o.z=e.z,o.x*=i,o.y*=i,o.z*=i,o.x+=m.x,o.y+=m.y,o.z+=m.z;let r=-s;o.x+=_.x*r,o.y+=_.y*r,o.z+=_.z*r}}}let a=0;for(;a<8;){let i,s,n,e,r,_,l,h,c=a++;0==t?this.wireframe?(i=u[0][0],s=u[1][c],this.line(i,s,o)):(i=u[0][0],s=u[1][c],n=u[1][(c+1)%8],r=y[0][0],_=y[1][c],l=y[1][(c+1)%8],this.triangle(i,s,n,r,_,l,o)):3==t?this.wireframe?(i=u[4][0],s=u[t][(c+1)%8],n=u[t][c],this.line(i,s,o),this.line(s,n,o)):(i=u[4][0],s=u[t][(c+1)%8],n=u[t][c],r=y[4][0],_=y[t][(c+1)%8],l=y[t][c],this.triangle(i,s,n,r,_,l,o)):this.wireframe?(i=u[t][c],s=u[t][(c+1)%8],n=u[t+1][c],this.line(i,s,o),this.line(i,n,o)):(i=u[t][c],s=u[t][(c+1)%8],n=u[t+1][c],e=u[t+1][(c+1)%8],r=y[t][c],_=y[t][(c+1)%8],l=y[t+1][c],h=y[t+1][(c+1)%8],this.rect(i,n,e,s,r,l,h,_,o))}}let d=this.p,X=0==d.sizeVec3?new a.common.Vec3:d.stackVec3[--d.sizeVec3];X.x=m.x,X.y=m.y,X.z=m.z;let z=X;z.x+=_.x*s,z.y+=_.y*s,z.z+=_.z*s;let Y=this.p,Z=0==Y.sizeVec3?new a.common.Vec3:Y.stackVec3[--Y.sizeVec3];Z.x=m.x,Z.y=m.y,Z.z=m.z;let M=Z,I=-s;if(M.x+=_.x*I,M.y+=_.y*I,M.z+=_.z*I,this.wireframe){let t=this.p,s=0==t.sizeVec3?new a.common.Vec3:t.stackVec3[--t.sizeVec3];s.x=z.x,s.y=z.y,s.z=z.z;let n=s,r=-i;n.x+=e.x*r,n.y+=e.y*r,n.z+=e.z*r,n.x+=0*h.x,n.y+=0*h.y,n.z+=0*h.z;let _=this.p,l=0==_.sizeVec3?new a.common.Vec3:_.stackVec3[--_.sizeVec3];l.x=z.x,l.y=z.y,l.z=z.z;let c=l;c.x+=e.x*i,c.y+=e.y*i,c.z+=e.z*i,c.x+=0*h.x,c.y+=0*h.y,c.z+=0*h.z;let m=this.p,b=0==m.sizeVec3?new a.common.Vec3:m.stackVec3[--m.sizeVec3];b.x=z.x,b.y=z.y,b.z=z.z;let p=b;p.x+=0*e.x,p.y+=0*e.y,p.z+=0*e.z;let x=-i;p.x+=h.x*x,p.y+=h.y*x,p.z+=h.z*x;let f=this.p,u=0==f.sizeVec3?new a.common.Vec3:f.stackVec3[--f.sizeVec3];u.x=z.x,u.y=z.y,u.z=z.z;let y=u;y.x+=0*e.x,y.y+=0*e.y,y.z+=0*e.z,y.x+=h.x*i,y.y+=h.y*i,y.z+=h.z*i;let g=this.p,v=0==g.sizeVec3?new a.common.Vec3:g.stackVec3[--g.sizeVec3];v.x=M.x,v.y=M.y,v.z=M.z;let d=v,X=-i;d.x+=e.x*X,d.y+=e.y*X,d.z+=e.z*X,d.x+=0*h.x,d.y+=0*h.y,d.z+=0*h.z;let Y=this.p,Z=0==Y.sizeVec3?new a.common.Vec3:Y.stackVec3[--Y.sizeVec3];Z.x=M.x,Z.y=M.y,Z.z=M.z;let I=Z;I.x+=e.x*i,I.y+=e.y*i,I.z+=e.z*i,I.x+=0*h.x,I.y+=0*h.y,I.z+=0*h.z;let V=this.p,w=0==V.sizeVec3?new a.common.Vec3:V.stackVec3[--V.sizeVec3];w.x=M.x,w.y=M.y,w.z=M.z;let L=w;L.x+=0*e.x,L.y+=0*e.y,L.z+=0*e.z;let k=-i;L.x+=h.x*k,L.y+=h.y*k,L.z+=h.z*k;let A=this.p,B=0==A.sizeVec3?new a.common.Vec3:A.stackVec3[--A.sizeVec3];B.x=M.x,B.y=M.y,B.z=M.z;let P=B;P.x+=0*e.x,P.y+=0*e.y,P.z+=0*e.z,P.x+=h.x*i,P.y+=h.y*i,P.z+=h.z*i,this.ellipse(z,e,h,i,i,o),this.ellipse(M,e,h,i,i,o),this.line(n,d,o),this.line(c,I,o),this.line(p,L,o),this.line(y,P,o);let S=this.p;if(null!=n){if(n.zero(),S.sizeVec3==S.stackVec3.length){let t=new Array(S.sizeVec3<<1),i=0,s=S.sizeVec3;for(;i<s;){let s=i++;t[s]=S.stackVec3[s],S.stackVec3[s]=null}S.stackVec3=t}S.stackVec3[S.sizeVec3++]=n}let T=this.p;if(null!=c){if(c.zero(),T.sizeVec3==T.stackVec3.length){let t=new Array(T.sizeVec3<<1),i=0,s=T.sizeVec3;for(;i<s;){let s=i++;t[s]=T.stackVec3[s],T.stackVec3[s]=null}T.stackVec3=t}T.stackVec3[T.sizeVec3++]=c}let C=this.p;if(null!=p){if(p.zero(),C.sizeVec3==C.stackVec3.length){let t=new Array(C.sizeVec3<<1),i=0,s=C.sizeVec3;for(;i<s;){let s=i++;t[s]=C.stackVec3[s],C.stackVec3[s]=null}C.stackVec3=t}C.stackVec3[C.sizeVec3++]=p}let j=this.p;if(null!=y){if(y.zero(),j.sizeVec3==j.stackVec3.length){let t=new Array(j.sizeVec3<<1),i=0,s=j.sizeVec3;for(;i<s;){let s=i++;t[s]=j.stackVec3[s],j.stackVec3[s]=null}j.stackVec3=t}j.stackVec3[j.sizeVec3++]=y}let R=this.p;if(null!=d){if(d.zero(),R.sizeVec3==R.stackVec3.length){let t=new Array(R.sizeVec3<<1),i=0,s=R.sizeVec3;for(;i<s;){let s=i++;t[s]=R.stackVec3[s],R.stackVec3[s]=null}R.stackVec3=t}R.stackVec3[R.sizeVec3++]=d}let q=this.p;if(null!=I){if(I.zero(),q.sizeVec3==q.stackVec3.length){let t=new Array(q.sizeVec3<<1),i=0,s=q.sizeVec3;for(;i<s;){let s=i++;t[s]=q.stackVec3[s],q.stackVec3[s]=null}q.stackVec3=t}q.stackVec3[q.sizeVec3++]=I}let E=this.p;if(null!=L){if(L.zero(),E.sizeVec3==E.stackVec3.length){let t=new Array(E.sizeVec3<<1),i=0,s=E.sizeVec3;for(;i<s;){let s=i++;t[s]=E.stackVec3[s],E.stackVec3[s]=null}E.stackVec3=t}E.stackVec3[E.sizeVec3++]=L}let D=this.p;if(null!=P){if(P.zero(),D.sizeVec3==D.stackVec3.length){let t=new Array(D.sizeVec3<<1),i=0,s=D.sizeVec3;for(;i<s;){let s=i++;t[s]=D.stackVec3[s],D.stackVec3[s]=null}D.stackVec3=t}D.stackVec3[D.sizeVec3++]=P}}else{let t=0;for(;t<8;){let a=t++,o=this.tmpCircleNorms[a],n=this.circleCoords[a];o.x=n.x,o.y=n.y,o.z=n.z;let e=o.x*p.e10+o.y*p.e11+o.z*p.e12,r=o.x*p.e20+o.y*p.e21+o.z*p.e22;o.x=o.x*p.e00+o.y*p.e01+o.z*p.e02,o.y=e,o.z=r;let l=this.tmpCircleVerts1[a],h=this.tmpCircleNorms[a];l.x=h.x,l.y=h.y,l.z=h.z,l.x*=i,l.y*=i,l.z*=i,l.x+=m.x,l.y+=m.y,l.z+=m.z;let c=this.tmpCircleVerts2[a],b=this.tmpCircleVerts1[a];c.x=b.x,c.y=b.y,c.z=b.z;let x=this.tmpCircleVerts1[a];x.x+=_.x*s,x.y+=_.y*s,x.z+=_.z*s;let f=this.tmpCircleVerts2[a],u=-s;f.x+=_.x*u,f.y+=_.y*u,f.z+=_.z*u}let a=0;for(;a<8;){let t=a++,i=this.tmpCircleNorms[t],s=this.tmpCircleNorms[(t+1)%8];this.rect(this.tmpCircleVerts1[t],this.tmpCircleVerts2[t],this.tmpCircleVerts2[(t+1)%8],this.tmpCircleVerts1[(t+1)%8],i,i,s,s,o)}}let V=this.p;if(null!=z){if(z.zero(),V.sizeVec3==V.stackVec3.length){let t=new Array(V.sizeVec3<<1),i=0,s=V.sizeVec3;for(;i<s;){let s=i++;t[s]=V.stackVec3[s],V.stackVec3[s]=null}V.stackVec3=t}V.stackVec3[V.sizeVec3++]=z}let w=this.p;if(null!=M){if(M.zero(),w.sizeVec3==w.stackVec3.length){let t=new Array(w.sizeVec3<<1),i=0,s=w.sizeVec3;for(;i<s;){let s=i++;t[s]=w.stackVec3[s],w.stackVec3[s]=null}w.stackVec3=t}w.stackVec3[w.sizeVec3++]=M}let L=this.p;if(null!=m){if(m.zero(),L.sizeVec3==L.stackVec3.length){let t=new Array(L.sizeVec3<<1),i=0,s=L.sizeVec3;for(;i<s;){let s=i++;t[s]=L.stackVec3[s],L.stackVec3[s]=null}L.stackVec3=t}L.stackVec3[L.sizeVec3++]=m}let k=this.p;if(null!=p){if(p.e00=1,p.e01=0,p.e02=0,p.e10=0,p.e11=1,p.e12=0,p.e20=0,p.e21=0,p.e22=1,k.sizeMat3==k.stackMat3.length){let t=new Array(k.sizeMat3<<1),i=0,s=k.sizeMat3;for(;i<s;){let s=i++;t[s]=k.stackMat3[s],k.stackMat3[s]=null}k.stackMat3=t}k.stackMat3[k.sizeMat3++]=p}let A=this.p;if(null!=e){if(e.zero(),A.sizeVec3==A.stackVec3.length){let t=new Array(A.sizeVec3<<1),i=0,s=A.sizeVec3;for(;i<s;){let s=i++;t[s]=A.stackVec3[s],A.stackVec3[s]=null}A.stackVec3=t}A.stackVec3[A.sizeVec3++]=e}let B=this.p;if(null!=_){if(_.zero(),B.sizeVec3==B.stackVec3.length){let t=new Array(B.sizeVec3<<1),i=0,s=B.sizeVec3;for(;i<s;){let s=i++;t[s]=B.stackVec3[s],B.stackVec3[s]=null}B.stackVec3=t}B.stackVec3[B.sizeVec3++]=_}let P=this.p;if(null!=h){if(h.zero(),P.sizeVec3==P.stackVec3.length){let t=new Array(P.sizeVec3<<1),i=0,s=P.sizeVec3;for(;i<s;){let s=i++;t[s]=P.stackVec3[s],P.stackVec3[s]=null}P.stackVec3=t}P.stackVec3[P.sizeVec3++]=h}}sphere(t,i,s){let o=this.p,n=0==o.sizeVec3?new a.common.Vec3:o.stackVec3[--o.sizeVec3],e=this.p,r=0==e.sizeMat3?new a.common.Mat3:e.stackMat3[--e.sizeMat3],_=n;_.x=t._positionX,_.y=t._positionY,_.z=t._positionZ;let l=r;l.e00=t._rotation00,l.e01=t._rotation01,l.e02=t._rotation02,l.e10=t._rotation10,l.e11=t._rotation11,l.e12=t._rotation12,l.e20=t._rotation20,l.e21=t._rotation21,l.e22=t._rotation22;let h=this.tmpSphereVerts,c=this.tmpSphereNorms,m=0;for(;m<5;){let t=m++,s=this.tmpSphereVerts[t].length,a=0;for(;a<s;){let s=a++,o=c[t][s],e=this.sphereCoords[t][s];o.x=e.x,o.y=e.y,o.z=e.z;let _=o.x*r.e10+o.y*r.e11+o.z*r.e12,l=o.x*r.e20+o.y*r.e21+o.z*r.e22;o.x=o.x*r.e00+o.y*r.e01+o.z*r.e02,o.y=_,o.z=l;let m=h[t][s],b=c[t][s];m.x=b.x,m.y=b.y,m.z=b.z,m.x*=i,m.y*=i,m.z*=i,m.x+=n.x,m.y+=n.y,m.z+=n.z}}let b=0;for(;b<4;){let t=b++,i=0;for(;i<8;){let a,o,n,e,r,_,l,m,b=i++;0==t?this.wireframe?(a=h[0][0],o=h[1][b],this.line(a,o,s)):(a=h[0][0],o=h[1][b],n=h[1][(b+1)%8],r=c[0][0],_=c[1][b],l=c[1][(b+1)%8],this.triangle(a,o,n,r,_,l,s)):3==t?this.wireframe?(a=h[4][0],o=h[t][(b+1)%8],n=h[t][b],this.line(a,o,s),this.line(o,n,s)):(a=h[4][0],o=h[t][(b+1)%8],n=h[t][b],r=c[4][0],_=c[t][(b+1)%8],l=c[t][b],this.triangle(a,o,n,r,_,l,s)):this.wireframe?(a=h[t][b],o=h[t][(b+1)%8],n=h[t+1][b],this.line(a,o,s),this.line(a,n,s)):(a=h[t][b],o=h[t][(b+1)%8],n=h[t+1][b],e=h[t+1][(b+1)%8],r=c[t][b],_=c[t][(b+1)%8],l=c[t+1][b],m=c[t+1][(b+1)%8],this.rect(a,n,e,o,r,l,m,_,s))}}let p=this.p;if(null!=n){if(n.zero(),p.sizeVec3==p.stackVec3.length){let t=new Array(p.sizeVec3<<1),i=0,s=p.sizeVec3;for(;i<s;){let s=i++;t[s]=p.stackVec3[s],p.stackVec3[s]=null}p.stackVec3=t}p.stackVec3[p.sizeVec3++]=n}let x=this.p;if(null!=r){if(r.e00=1,r.e01=0,r.e02=0,r.e10=0,r.e11=1,r.e12=0,r.e20=0,r.e21=0,r.e22=1,x.sizeMat3==x.stackMat3.length){let t=new Array(x.sizeMat3<<1),i=0,s=x.sizeMat3;for(;i<s;){let s=i++;t[s]=x.stackMat3[s],x.stackMat3[s]=null}x.stackMat3=t}x.stackMat3[x.sizeMat3++]=r}}box(t,i,s){let o=this.p,n=0==o.sizeVec3?new a.common.Vec3:o.stackVec3[--o.sizeVec3],e=this.p,r=0==e.sizeVec3?new a.common.Vec3:e.stackVec3[--e.sizeVec3],_=this.p,l=0==_.sizeVec3?new a.common.Vec3:_.stackVec3[--_.sizeVec3],h=this.p,c=0==h.sizeVec3?new a.common.Vec3:h.stackVec3[--h.sizeVec3],m=this.p,b=0==m.sizeMat3?new a.common.Mat3:m.stackMat3[--m.sizeMat3],p=c;p.x=t._positionX,p.y=t._positionY,p.z=t._positionZ;let x=b;x.e00=t._rotation00,x.e01=t._rotation01,x.e02=t._rotation02,x.e10=t._rotation10,x.e11=t._rotation11,x.e12=t._rotation12,x.e20=t._rotation20,x.e21=t._rotation21,x.e22=t._rotation22,n.init(b.e00,b.e10,b.e20),r.init(b.e01,b.e11,b.e21),l.init(b.e02,b.e12,b.e22);let f=i.x,u=i.y,y=i.z,g=this.p,v=0==g.sizeVec3?new a.common.Vec3:g.stackVec3[--g.sizeVec3];v.x=c.x,v.y=c.y,v.z=c.z;let d=v,X=-f;d.x+=n.x*X,d.y+=n.y*X,d.z+=n.z*X;let z=-u;d.x+=r.x*z,d.y+=r.y*z,d.z+=r.z*z;let Y=-y;d.x+=l.x*Y,d.y+=l.y*Y,d.z+=l.z*Y;let Z=this.p,M=0==Z.sizeVec3?new a.common.Vec3:Z.stackVec3[--Z.sizeVec3];M.x=c.x,M.y=c.y,M.z=c.z;let I=M,V=-f;I.x+=n.x*V,I.y+=n.y*V,I.z+=n.z*V;let w=-u;I.x+=r.x*w,I.y+=r.y*w,I.z+=r.z*w,I.x+=l.x*y,I.y+=l.y*y,I.z+=l.z*y;let L=this.p,k=0==L.sizeVec3?new a.common.Vec3:L.stackVec3[--L.sizeVec3];k.x=c.x,k.y=c.y,k.z=c.z;let A=k,B=-f;A.x+=n.x*B,A.y+=n.y*B,A.z+=n.z*B,A.x+=r.x*u,A.y+=r.y*u,A.z+=r.z*u;let P=-y;A.x+=l.x*P,A.y+=l.y*P,A.z+=l.z*P;let S=this.p,T=0==S.sizeVec3?new a.common.Vec3:S.stackVec3[--S.sizeVec3];T.x=c.x,T.y=c.y,T.z=c.z;let C=T,j=-f;C.x+=n.x*j,C.y+=n.y*j,C.z+=n.z*j,C.x+=r.x*u,C.y+=r.y*u,C.z+=r.z*u,C.x+=l.x*y,C.y+=l.y*y,C.z+=l.z*y;let R=this.p,q=0==R.sizeVec3?new a.common.Vec3:R.stackVec3[--R.sizeVec3];q.x=c.x,q.y=c.y,q.z=c.z;let E=q;E.x+=n.x*f,E.y+=n.y*f,E.z+=n.z*f;let D=-u;E.x+=r.x*D,E.y+=r.y*D,E.z+=r.z*D;let N=-y;E.x+=l.x*N,E.y+=l.y*N,E.z+=l.z*N;let F=this.p,W=0==F.sizeVec3?new a.common.Vec3:F.stackVec3[--F.sizeVec3];W.x=c.x,W.y=c.y,W.z=c.z;let J=W;J.x+=n.x*f,J.y+=n.y*f,J.z+=n.z*f;let G=-u;J.x+=r.x*G,J.y+=r.y*G,J.z+=r.z*G,J.x+=l.x*y,J.y+=l.y*y,J.z+=l.z*y;let O=this.p,U=0==O.sizeVec3?new a.common.Vec3:O.stackVec3[--O.sizeVec3];U.x=c.x,U.y=c.y,U.z=c.z;let H=U;H.x+=n.x*f,H.y+=n.y*f,H.z+=n.z*f,H.x+=r.x*u,H.y+=r.y*u,H.z+=r.z*u;let Q=-y;H.x+=l.x*Q,H.y+=l.y*Q,H.z+=l.z*Q;let K=this.p,$=0==K.sizeVec3?new a.common.Vec3:K.stackVec3[--K.sizeVec3];$.x=c.x,$.y=c.y,$.z=c.z;let tt=$;if(tt.x+=n.x*f,tt.y+=n.y*f,tt.z+=n.z*f,tt.x+=r.x*u,tt.y+=r.y*u,tt.z+=r.z*u,tt.x+=l.x*y,tt.y+=l.y*y,tt.z+=l.z*y,this.wireframe)this.line(d,I,s),this.line(A,C,s),this.line(E,J,s),this.line(H,tt,s),this.line(d,A,s),this.line(I,C,s),this.line(E,H,s),this.line(J,tt,s),this.line(d,E,s),this.line(I,J,s),this.line(A,H,s),this.line(C,tt,s);else{let t=this.p,i=0==t.sizeVec3?new a.common.Vec3:t.stackVec3[--t.sizeVec3];i.x=n.x,i.y=n.y,i.z=n.z;let o=i;o.x=-o.x,o.y=-o.y,o.z=-o.z;let e=this.p,_=0==e.sizeVec3?new a.common.Vec3:e.stackVec3[--e.sizeVec3];_.x=r.x,_.y=r.y,_.z=r.z;let h=_;h.x=-h.x,h.y=-h.y,h.z=-h.z;let c=this.p,m=0==c.sizeVec3?new a.common.Vec3:c.stackVec3[--c.sizeVec3];m.x=l.x,m.y=l.y,m.z=l.z;let b=m;b.x=-b.x,b.y=-b.y,b.z=-b.z,this.rect(d,I,C,A,o,o,o,o,s),this.rect(E,H,tt,J,n,n,n,n,s),this.rect(d,E,J,I,h,h,h,h,s),this.rect(A,C,tt,H,r,r,r,r,s),this.rect(d,A,H,E,b,b,b,b,s),this.rect(I,J,tt,C,l,l,l,l,s);let p=this.p;if(null!=o){if(o.zero(),p.sizeVec3==p.stackVec3.length){let t=new Array(p.sizeVec3<<1),i=0,s=p.sizeVec3;for(;i<s;){let s=i++;t[s]=p.stackVec3[s],p.stackVec3[s]=null}p.stackVec3=t}p.stackVec3[p.sizeVec3++]=o}let x=this.p;if(null!=h){if(h.zero(),x.sizeVec3==x.stackVec3.length){let t=new Array(x.sizeVec3<<1),i=0,s=x.sizeVec3;for(;i<s;){let s=i++;t[s]=x.stackVec3[s],x.stackVec3[s]=null}x.stackVec3=t}x.stackVec3[x.sizeVec3++]=h}let f=this.p;if(null!=b){if(b.zero(),f.sizeVec3==f.stackVec3.length){let t=new Array(f.sizeVec3<<1),i=0,s=f.sizeVec3;for(;i<s;){let s=i++;t[s]=f.stackVec3[s],f.stackVec3[s]=null}f.stackVec3=t}f.stackVec3[f.sizeVec3++]=b}}let it=this.p;if(null!=d){if(d.zero(),it.sizeVec3==it.stackVec3.length){let t=new Array(it.sizeVec3<<1),i=0,s=it.sizeVec3;for(;i<s;){let s=i++;t[s]=it.stackVec3[s],it.stackVec3[s]=null}it.stackVec3=t}it.stackVec3[it.sizeVec3++]=d}let st=this.p;if(null!=I){if(I.zero(),st.sizeVec3==st.stackVec3.length){let t=new Array(st.sizeVec3<<1),i=0,s=st.sizeVec3;for(;i<s;){let s=i++;t[s]=st.stackVec3[s],st.stackVec3[s]=null}st.stackVec3=t}st.stackVec3[st.sizeVec3++]=I}let at=this.p;if(null!=A){if(A.zero(),at.sizeVec3==at.stackVec3.length){let t=new Array(at.sizeVec3<<1),i=0,s=at.sizeVec3;for(;i<s;){let s=i++;t[s]=at.stackVec3[s],at.stackVec3[s]=null}at.stackVec3=t}at.stackVec3[at.sizeVec3++]=A}let ot=this.p;if(null!=C){if(C.zero(),ot.sizeVec3==ot.stackVec3.length){let t=new Array(ot.sizeVec3<<1),i=0,s=ot.sizeVec3;for(;i<s;){let s=i++;t[s]=ot.stackVec3[s],ot.stackVec3[s]=null}ot.stackVec3=t}ot.stackVec3[ot.sizeVec3++]=C}let nt=this.p;if(null!=E){if(E.zero(),nt.sizeVec3==nt.stackVec3.length){let t=new Array(nt.sizeVec3<<1),i=0,s=nt.sizeVec3;for(;i<s;){let s=i++;t[s]=nt.stackVec3[s],nt.stackVec3[s]=null}nt.stackVec3=t}nt.stackVec3[nt.sizeVec3++]=E}let et=this.p;if(null!=J){if(J.zero(),et.sizeVec3==et.stackVec3.length){let t=new Array(et.sizeVec3<<1),i=0,s=et.sizeVec3;for(;i<s;){let s=i++;t[s]=et.stackVec3[s],et.stackVec3[s]=null}et.stackVec3=t}et.stackVec3[et.sizeVec3++]=J}let rt=this.p;if(null!=H){if(H.zero(),rt.sizeVec3==rt.stackVec3.length){let t=new Array(rt.sizeVec3<<1),i=0,s=rt.sizeVec3;for(;i<s;){let s=i++;t[s]=rt.stackVec3[s],rt.stackVec3[s]=null}rt.stackVec3=t}rt.stackVec3[rt.sizeVec3++]=H}let _t=this.p;if(null!=tt){if(tt.zero(),_t.sizeVec3==_t.stackVec3.length){let t=new Array(_t.sizeVec3<<1),i=0,s=_t.sizeVec3;for(;i<s;){let s=i++;t[s]=_t.stackVec3[s],_t.stackVec3[s]=null}_t.stackVec3=t}_t.stackVec3[_t.sizeVec3++]=tt}let lt=this.p;if(null!=c){if(c.zero(),lt.sizeVec3==lt.stackVec3.length){let t=new Array(lt.sizeVec3<<1),i=0,s=lt.sizeVec3;for(;i<s;){let s=i++;t[s]=lt.stackVec3[s],lt.stackVec3[s]=null}lt.stackVec3=t}lt.stackVec3[lt.sizeVec3++]=c}let ht=this.p;if(null!=b){if(b.e00=1,b.e01=0,b.e02=0,b.e10=0,b.e11=1,b.e12=0,b.e20=0,b.e21=0,b.e22=1,ht.sizeMat3==ht.stackMat3.length){let t=new Array(ht.sizeMat3<<1),i=0,s=ht.sizeMat3;for(;i<s;){let s=i++;t[s]=ht.stackMat3[s],ht.stackMat3[s]=null}ht.stackMat3=t}ht.stackMat3[ht.sizeMat3++]=b}let ct=this.p;if(null!=n){if(n.zero(),ct.sizeVec3==ct.stackVec3.length){let t=new Array(ct.sizeVec3<<1),i=0,s=ct.sizeVec3;for(;i<s;){let s=i++;t[s]=ct.stackVec3[s],ct.stackVec3[s]=null}ct.stackVec3=t}ct.stackVec3[ct.sizeVec3++]=n}let mt=this.p;if(null!=r){if(r.zero(),mt.sizeVec3==mt.stackVec3.length){let t=new Array(mt.sizeVec3<<1),i=0,s=mt.sizeVec3;for(;i<s;){let s=i++;t[s]=mt.stackVec3[s],mt.stackVec3[s]=null}mt.stackVec3=t}mt.stackVec3[mt.sizeVec3++]=r}let bt=this.p;if(null!=l){if(l.zero(),bt.sizeVec3==bt.stackVec3.length){let t=new Array(bt.sizeVec3<<1),i=0,s=bt.sizeVec3;for(;i<s;){let s=i++;t[s]=bt.stackVec3[s],bt.stackVec3[s]=null}bt.stackVec3=t}bt.stackVec3[bt.sizeVec3++]=l}}rect(t,i,s,a,o,n,e,r,_){this.triangle(t,i,s,o,n,e,_),this.triangle(t,s,a,o,e,r,_)}point(t,i){}triangle(t,i,s,a,o,n,e){}line(t,i,s){}},a.dynamics.common.DebugDrawStyle=class{constructor(){this.basisColorZ=new a.common.Vec3(0,0,1),this.basisColorY=new a.common.Vec3(0,1,0),this.basisColorX=new a.common.Vec3(1,0,0),this.basisLength=.5,this.jointRotationalConstraintRadius=.3,this.jointErrorColor=new a.common.Vec3(1,.1,.1),this.jointLineColor=new a.common.Vec3(.8,.8,.8),this.contactBinormalLength=.5,this.contactTangentLength=.5,this.contactNormalLength=.5,this.contactBinormalColor=new a.common.Vec3(.2,.2,1),this.contactTangentColor=new a.common.Vec3(.1,.8,.1),this.contactNormalColor=new a.common.Vec3(1,.1,.1),this.disabledContactColor=new a.common.Vec3(.5,.1,.1),this.newContactColor=new a.common.Vec3(1,1,.1),this.contactColor4=new a.common.Vec3(.8,.1,1),this.contactColor3=new a.common.Vec3(.1,.8,.6),this.contactColor2=new a.common.Vec3(1,.6,.1),this.contactColor=new a.common.Vec3(1,.1,.1),this.pairColor=new a.common.Vec3(1,1,.1),this.bvhNodeColor=new a.common.Vec3(.4,.4,.4),this.aabbColor=new a.common.Vec3(1,.1,.1),this.kinematicShapeColor=new a.common.Vec3(1,.5,.1),this.staticShapeColor=new a.common.Vec3(.7,.7,.7),this.sleepingShapeColor2=new a.common.Vec3(.2,.8,.5),this.sleepingShapeColor1=new a.common.Vec3(.3,.3,.8),this.sleepyShapeColor2=new a.common.Vec3(.6,.8,.3),this.sleepyShapeColor1=new a.common.Vec3(.5,.25,.6),this.shapeColor2=new a.common.Vec3(1,.8,.1),this.shapeColor1=new a.common.Vec3(.7,.2,.4)}},a.dynamics.common.Performance=class{},a.dynamics.constraint||(a.dynamics.constraint={}),a.dynamics.constraint.ConstraintSolver=class{constructor(){this._b1=null,this._b2=null,this._addedToIsland=!1}preSolveVelocity(t){}warmStart(t){}solveVelocity(){}postSolveVelocity(t){}preSolvePosition(t){}solvePositionSplitImpulse(){}solvePositionNgs(t){}postSolve(){}},a.dynamics.constraint.PositionCorrectionAlgorithm=class{},a.dynamics.constraint.contact||(a.dynamics.constraint.contact={}),a.dynamics.constraint.contact.ContactConstraint=class{constructor(t){this._solver=new a.dynamics.constraint.solver.pgs.PgsContactConstraintSolver(this),this._manifold=t}_getVelocitySolverInfo(t,i){let s,o,n,e,r,_,l,h,c;i.b1=this._b1,i.b2=this._b2,s=this._manifold._normalX,o=this._manifold._normalY,n=this._manifold._normalZ,e=this._manifold._tangentX,r=this._manifold._tangentY,_=this._manifold._tangentZ,l=this._manifold._binormalX,h=this._manifold._binormalY,c=this._manifold._binormalZ;let m=Math.sqrt(this._s1._friction*this._s2._friction),b=Math.sqrt(this._s1._restitution*this._s2._restitution),p=this._manifold._numPoints;i.numRows=0;let x=0;for(;x<p;){let p=this._manifold._points[x++];if(p._depth<0){p._disabled=!0;let t=p._impulse;t.impulseN=0,t.impulseT=0,t.impulseB=0,t.impulseP=0,t.impulseLX=0,t.impulseLY=0,t.impulseLZ=0;continue}p._disabled=!1;let f=i.rows[i.numRows++];f.friction=m,f.cfm=0;let u=f.jacobianN;u.lin1X=s,u.lin1Y=o,u.lin1Z=n,u.lin2X=s,u.lin2Y=o,u.lin2Z=n,u.ang1X=p._relPos1Y*n-p._relPos1Z*o,u.ang1Y=p._relPos1Z*s-p._relPos1X*n,u.ang1Z=p._relPos1X*o-p._relPos1Y*s,u.ang2X=p._relPos2Y*n-p._relPos2Z*o,u.ang2Y=p._relPos2Z*s-p._relPos2X*n,u.ang2Z=p._relPos2X*o-p._relPos2Y*s,u=f.jacobianT,u.lin1X=e,u.lin1Y=r,u.lin1Z=_,u.lin2X=e,u.lin2Y=r,u.lin2Z=_,u.ang1X=p._relPos1Y*_-p._relPos1Z*r,u.ang1Y=p._relPos1Z*e-p._relPos1X*_,u.ang1Z=p._relPos1X*r-p._relPos1Y*e,u.ang2X=p._relPos2Y*_-p._relPos2Z*r,u.ang2Y=p._relPos2Z*e-p._relPos2X*_,u.ang2Z=p._relPos2X*r-p._relPos2Y*e,u=f.jacobianB,u.lin1X=l,u.lin1Y=h,u.lin1Z=c,u.lin2X=l,u.lin2Y=h,u.lin2Z=c,u.ang1X=p._relPos1Y*c-p._relPos1Z*h,u.ang1Y=p._relPos1Z*l-p._relPos1X*c,u.ang1Z=p._relPos1X*h-p._relPos1Y*l,u.ang2X=p._relPos2Y*c-p._relPos2Z*h,u.ang2Y=p._relPos2Z*l-p._relPos2X*c,u.ang2Z=p._relPos2X*h-p._relPos2Y*l,u=f.jacobianN;let y=u.lin1X*this._b1._velX+u.lin1Y*this._b1._velY+u.lin1Z*this._b1._velZ+(u.ang1X*this._b1._angVelX+u.ang1Y*this._b1._angVelY+u.ang1Z*this._b1._angVelZ)-(u.lin2X*this._b2._velX+u.lin2Y*this._b2._velY+u.lin2Z*this._b2._velZ+(u.ang2X*this._b2._angVelX+u.ang2Y*this._b2._angVelY+u.ang2Z*this._b2._angVelZ));if(y<-a.common.Setting.contactEnableBounceThreshold&&!p._warmStarted?f.rhs=-y*b:f.rhs=0,this._positionCorrectionAlgorithm==a.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE&&p._depth>a.common.Setting.linearSlop){let i=(p._depth-a.common.Setting.linearSlop)*a.common.Setting.velocityBaumgarte*t.invDt;f.rhs<i&&(f.rhs=i)}if(!p._warmStarted){let t=p._impulse;t.impulseN=0,t.impulseT=0,t.impulseB=0,t.impulseP=0,t.impulseLX=0,t.impulseLY=0,t.impulseLZ=0}f.impulse=p._impulse}}_getPositionSolverInfo(t){let i,s,o;t.b1=this._b1,t.b2=this._b2,i=this._manifold._normalX,s=this._manifold._normalY,o=this._manifold._normalZ;let n=this._manifold._numPoints;t.numRows=0;let e=0;for(;e<n;){let n=this._manifold._points[e++];if(n._disabled)continue;let r=t.rows[t.numRows++],_=r.jacobianN;_.lin1X=i,_.lin1Y=s,_.lin1Z=o,_.lin2X=i,_.lin2Y=s,_.lin2Z=o,_.ang1X=n._relPos1Y*o-n._relPos1Z*s,_.ang1Y=n._relPos1Z*i-n._relPos1X*o,_.ang1Z=n._relPos1X*s-n._relPos1Y*i,_.ang2X=n._relPos2Y*o-n._relPos2Z*s,_.ang2Y=n._relPos2Z*i-n._relPos2X*o,_.ang2Z=n._relPos2X*s-n._relPos2Y*i,r.rhs=n._depth-a.common.Setting.linearSlop,r.rhs<0&&(r.rhs=0),r.impulse=n._impulse}}_syncManifold(){this._manifold._updateDepthsAndPositions(this._tf1,this._tf2)}getShape1(){return this._s1}getShape2(){return this._s2}getManifold(){return this._manifold}isTouching(){let t=0,i=this._manifold._numPoints;for(;t<i;)if(this._manifold._points[t++]._depth>=0)return!0;return!1}},a.dynamics.constraint.contact.ContactImpulse=class{constructor(){this.impulseN=0,this.impulseT=0,this.impulseB=0,this.impulseP=0,this.impulseLX=0,this.impulseLY=0,this.impulseLZ=0}copyFrom(t){this.impulseN=t.impulseN,this.impulseT=t.impulseT,this.impulseB=t.impulseB,this.impulseLX=t.impulseLX,this.impulseLY=t.impulseLY,this.impulseLZ=t.impulseLZ}},a.dynamics.constraint.contact.Manifold=class{constructor(){this._normalX=0,this._normalY=0,this._normalZ=0,this._tangentX=0,this._tangentY=0,this._tangentZ=0,this._binormalX=0,this._binormalY=0,this._binormalZ=0,this._numPoints=0,this._points=new Array(a.common.Setting.maxManifoldPoints);let t=0,i=a.common.Setting.maxManifoldPoints;for(;t<i;)this._points[t++]=new a.dynamics.constraint.contact.ManifoldPoint}_clear(){let t=0,i=this._numPoints;for(;t<i;){let i=this._points[t++];i._localPos1X=0,i._localPos1Y=0,i._localPos1Z=0,i._localPos2X=0,i._localPos2Y=0,i._localPos2Z=0,i._relPos1X=0,i._relPos1Y=0,i._relPos1Z=0,i._relPos2X=0,i._relPos2Y=0,i._relPos2Z=0,i._pos1X=0,i._pos1Y=0,i._pos1Z=0,i._pos2X=0,i._pos2Y=0,i._pos2Z=0,i._depth=0;let s=i._impulse;s.impulseN=0,s.impulseT=0,s.impulseB=0,s.impulseP=0,s.impulseLX=0,s.impulseLY=0,s.impulseLZ=0,i._warmStarted=!1,i._disabled=!1,i._id=-1}this._numPoints=0}_buildBasis(t){this._normalX=t.x,this._normalY=t.y,this._normalZ=t.z;let i,s,a,o,n,e,r=t.x,_=t.y,l=t.z,h=r*r,c=_*_,m=l*l;if(h<c)if(h<m){let t=1/Math.sqrt(c+m);i=0,s=-l*t,a=_*t,o=_*a-l*s,n=-r*a,e=r*s}else{let t=1/Math.sqrt(h+c);i=-_*t,s=r*t,a=0,o=-l*s,n=l*i,e=r*s-_*i}else if(c<m){let t=1/Math.sqrt(h+m);i=l*t,s=0,a=-r*t,o=_*a,n=l*i-r*a,e=-_*i}else{let t=1/Math.sqrt(h+c);i=-_*t,s=r*t,a=0,o=-l*s,n=l*i,e=r*s-_*i}this._tangentX=i,this._tangentY=s,this._tangentZ=a,this._binormalX=o,this._binormalY=n,this._binormalZ=e}_updateDepthsAndPositions(t,i){let s=0,a=this._numPoints;for(;s<a;){let a,o,n,e,r,_,l,h,c,m=this._points[s++];a=t._rotation00*m._localPos1X+t._rotation01*m._localPos1Y+t._rotation02*m._localPos1Z,o=t._rotation10*m._localPos1X+t._rotation11*m._localPos1Y+t._rotation12*m._localPos1Z,n=t._rotation20*m._localPos1X+t._rotation21*m._localPos1Y+t._rotation22*m._localPos1Z,m._relPos1X=a,m._relPos1Y=o,m._relPos1Z=n,e=i._rotation00*m._localPos2X+i._rotation01*m._localPos2Y+i._rotation02*m._localPos2Z,r=i._rotation10*m._localPos2X+i._rotation11*m._localPos2Y+i._rotation12*m._localPos2Z,_=i._rotation20*m._localPos2X+i._rotation21*m._localPos2Y+i._rotation22*m._localPos2Z,m._relPos2X=e,m._relPos2Y=r,m._relPos2Z=_,m._pos1X=m._relPos1X+t._positionX,m._pos1Y=m._relPos1Y+t._positionY,m._pos1Z=m._relPos1Z+t._positionZ,m._pos2X=m._relPos2X+i._positionX,m._pos2Y=m._relPos2Y+i._positionY,m._pos2Z=m._relPos2Z+i._positionZ,l=m._pos1X-m._pos2X,h=m._pos1Y-m._pos2Y,c=m._pos1Z-m._pos2Z,m._depth=-(l*this._normalX+h*this._normalY+c*this._normalZ)}}getNormal(){let t=new a.common.Vec3;return t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ,t}getNormalTo(t){t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ}getTangent(){let t=new a.common.Vec3;return t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ,t}getTangentTo(t){t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ}getBinormal(){let t=new a.common.Vec3;return t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ,t}getBinormalTo(t){t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ}getPoints(){return this._points}getNumPoints(){return this._numPoints}},a.dynamics.constraint.contact.ManifoldPoint=class{constructor(){this._localPos1X=0,this._localPos1Y=0,this._localPos1Z=0,this._localPos2X=0,this._localPos2Y=0,this._localPos2Z=0,this._relPos1X=0,this._relPos1Y=0,this._relPos1Z=0,this._relPos2X=0,this._relPos2Y=0,this._relPos2Z=0,this._pos1X=0,this._pos1Y=0,this._pos1Z=0,this._pos2X=0,this._pos2Y=0,this._pos2Z=0,this._depth=0,this._impulse=new a.dynamics.constraint.contact.ContactImpulse,this._warmStarted=!1,this._disabled=!1,this._id=-1}getPosition1(){let t=new a.common.Vec3;return t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z,t}getPosition1To(t){t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z}getPosition2(){let t=new a.common.Vec3;return t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z,t}getPosition2To(t){t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z}getDepth(){return this._depth}isWarmStarted(){return this._warmStarted}getNormalImpulse(){return this._impulse.impulseN}getTangentImpulse(){return this._impulse.impulseT}getBinormalImpulse(){return this._impulse.impulseB}isEnabled(){return!this._disabled}},a.dynamics.constraint.contact.ManifoldUpdater=class{constructor(t){this._manifold=t,this.numOldPoints=0,this.oldPoints=new Array(a.common.Setting.maxManifoldPoints);let i=0,s=a.common.Setting.maxManifoldPoints;for(;i<s;)this.oldPoints[i++]=new a.dynamics.constraint.contact.ManifoldPoint}removeOutdatedPoints(){let t=this._manifold._numPoints;for(;--t>=0;){let i,s,o,n=this._manifold._points[t];i=n._pos1X-n._pos2X,s=n._pos1Y-n._pos2Y,o=n._pos1Z-n._pos2Z;let e=this._manifold._normalX*i+this._manifold._normalY*s+this._manifold._normalZ*o;e>a.common.Setting.contactPersistenceThreshold?this.removeManifoldPoint(t):(i+=this._manifold._normalX*-e,s+=this._manifold._normalY*-e,o+=this._manifold._normalZ*-e,i*i+s*s+o*o>a.common.Setting.contactPersistenceThreshold*a.common.Setting.contactPersistenceThreshold&&this.removeManifoldPoint(t))}}removeManifoldPoint(t){let i=--this._manifold._numPoints;if(t!=i){let s=this._manifold._points[t];this._manifold._points[t]=this._manifold._points[i],this._manifold._points[i]=s}let s=this._manifold._points[i];s._localPos1X=0,s._localPos1Y=0,s._localPos1Z=0,s._localPos2X=0,s._localPos2Y=0,s._localPos2Z=0,s._relPos1X=0,s._relPos1Y=0,s._relPos1Z=0,s._relPos2X=0,s._relPos2Y=0,s._relPos2Z=0,s._pos1X=0,s._pos1Y=0,s._pos1Z=0,s._pos2X=0,s._pos2Y=0,s._pos2Z=0,s._depth=0;let a=s._impulse;a.impulseN=0,a.impulseT=0,a.impulseB=0,a.impulseP=0,a.impulseLX=0,a.impulseLY=0,a.impulseLZ=0,s._warmStarted=!1,s._disabled=!1,s._id=-1}addManifoldPoint(t,i,s){let o=this._manifold._numPoints;if(o==a.common.Setting.maxManifoldPoints){let a=this.computeTargetIndex(t,i,s),o=this._manifold._points[a],n=t.position1;o._pos1X=n.x,o._pos1Y=n.y,o._pos1Z=n.z;let e,r,_,l,h,c,m=t.position2;o._pos2X=m.x,o._pos2Y=m.y,o._pos2Z=m.z,o._relPos1X=o._pos1X-i._positionX,o._relPos1Y=o._pos1Y-i._positionY,o._relPos1Z=o._pos1Z-i._positionZ,o._relPos2X=o._pos2X-s._positionX,o._relPos2Y=o._pos2Y-s._positionY,o._relPos2Z=o._pos2Z-s._positionZ,e=i._rotation00*o._relPos1X+i._rotation10*o._relPos1Y+i._rotation20*o._relPos1Z,r=i._rotation01*o._relPos1X+i._rotation11*o._relPos1Y+i._rotation21*o._relPos1Z,_=i._rotation02*o._relPos1X+i._rotation12*o._relPos1Y+i._rotation22*o._relPos1Z,o._localPos1X=e,o._localPos1Y=r,o._localPos1Z=_,l=s._rotation00*o._relPos2X+s._rotation10*o._relPos2Y+s._rotation20*o._relPos2Z,h=s._rotation01*o._relPos2X+s._rotation11*o._relPos2Y+s._rotation21*o._relPos2Z,c=s._rotation02*o._relPos2X+s._rotation12*o._relPos2Y+s._rotation22*o._relPos2Z,o._localPos2X=l,o._localPos2Y=h,o._localPos2Z=c,o._depth=t.depth;let b=o._impulse;return b.impulseN=0,b.impulseT=0,b.impulseB=0,b.impulseP=0,b.impulseLX=0,b.impulseLY=0,b.impulseLZ=0,o._id=t.id,o._warmStarted=!1,void(o._disabled=!1)}let n=this._manifold._points[o],e=t.position1;n._pos1X=e.x,n._pos1Y=e.y,n._pos1Z=e.z;let r,_,l,h,c,m,b=t.position2;n._pos2X=b.x,n._pos2Y=b.y,n._pos2Z=b.z,n._relPos1X=n._pos1X-i._positionX,n._relPos1Y=n._pos1Y-i._positionY,n._relPos1Z=n._pos1Z-i._positionZ,n._relPos2X=n._pos2X-s._positionX,n._relPos2Y=n._pos2Y-s._positionY,n._relPos2Z=n._pos2Z-s._positionZ,r=i._rotation00*n._relPos1X+i._rotation10*n._relPos1Y+i._rotation20*n._relPos1Z,_=i._rotation01*n._relPos1X+i._rotation11*n._relPos1Y+i._rotation21*n._relPos1Z,l=i._rotation02*n._relPos1X+i._rotation12*n._relPos1Y+i._rotation22*n._relPos1Z,n._localPos1X=r,n._localPos1Y=_,n._localPos1Z=l,h=s._rotation00*n._relPos2X+s._rotation10*n._relPos2Y+s._rotation20*n._relPos2Z,c=s._rotation01*n._relPos2X+s._rotation11*n._relPos2Y+s._rotation21*n._relPos2Z,m=s._rotation02*n._relPos2X+s._rotation12*n._relPos2Y+s._rotation22*n._relPos2Z,n._localPos2X=h,n._localPos2Y=c,n._localPos2Z=m,n._depth=t.depth;let p=n._impulse;p.impulseN=0,p.impulseT=0,p.impulseB=0,p.impulseP=0,p.impulseLX=0,p.impulseLY=0,p.impulseLZ=0,n._id=t.id,n._warmStarted=!1,n._disabled=!1,this._manifold._numPoints++}computeTargetIndex(t,i,s){let a,o,n,e=this._manifold._points[0],r=this._manifold._points[1],_=this._manifold._points[2],l=this._manifold._points[3],h=e._depth,c=0;r._depth>h&&(h=r._depth,c=1),_._depth>h&&(h=_._depth,c=2),l._depth>h&&(h=l._depth,c=3);let m=t.position1;a=m.x,o=m.y,n=m.z,a-=i._positionX,o-=i._positionY,n-=i._positionZ;let b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,q=r._relPos1X,E=r._relPos1Y,D=r._relPos1Z,N=_._relPos1X,F=_._relPos1Y,W=_._relPos1Z,J=l._relPos1X,G=l._relPos1Y,O=l._relPos1Z;b=N-q,p=F-E,x=W-D,f=a-J,u=o-G,y=n-O,g=J-q,v=G-E,d=O-D,X=a-N,z=o-F,Y=n-W,Z=a-q,M=o-E,I=n-D,V=J-N,w=G-F,L=O-W,k=p*y-x*u,A=x*f-b*y,B=b*u-p*f,P=v*Y-d*z,S=d*X-g*Y,T=g*z-v*X,C=M*L-I*w,j=I*V-Z*L,R=Z*w-M*V;let U,H,Q,K,$,tt,it,st,at,ot,nt,et,rt,_t,lt,ht,ct,mt,bt,pt,xt,ft,ut,yt,gt,vt,dt,Xt=k*k+A*A+B*B,zt=P*P+S*S+T*T,Yt=C*C+j*j+R*R,Zt=e._relPos1X,Mt=e._relPos1Y,It=e._relPos1Z,Vt=_._relPos1X,wt=_._relPos1Y,Lt=_._relPos1Z,kt=l._relPos1X,At=l._relPos1Y,Bt=l._relPos1Z;U=Vt-Zt,H=wt-Mt,Q=Lt-It,K=a-kt,$=o-At,tt=n-Bt,it=kt-Zt,st=At-Mt,at=Bt-It,ot=a-Vt,nt=o-wt,et=n-Lt,rt=a-Zt,_t=o-Mt,lt=n-It,ht=kt-Vt,ct=At-wt,mt=Bt-Lt,bt=H*tt-Q*$,pt=Q*K-U*tt,xt=U*$-H*K,ft=st*et-at*nt,ut=at*ot-it*et,yt=it*nt-st*ot,gt=_t*mt-lt*ct,vt=lt*ht-rt*mt,dt=rt*ct-_t*ht;let Pt,St,Tt,Ct,jt,Rt,qt,Et,Dt,Nt,Ft,Wt,Jt,Gt,Ot,Ut,Ht,Qt,Kt,$t,ti,ii,si,ai,oi,ni,ei,ri=bt*bt+pt*pt+xt*xt,_i=ft*ft+ut*ut+yt*yt,li=gt*gt+vt*vt+dt*dt,hi=ri>_i?ri>li?ri:li:_i>li?_i:li,ci=e._relPos1X,mi=e._relPos1Y,bi=e._relPos1Z,pi=r._relPos1X,xi=r._relPos1Y,fi=r._relPos1Z,ui=l._relPos1X,yi=l._relPos1Y,gi=l._relPos1Z;Pt=pi-ci,St=xi-mi,Tt=fi-bi,Ct=a-ui,jt=o-yi,Rt=n-gi,qt=ui-ci,Et=yi-mi,Dt=gi-bi,Nt=a-pi,Ft=o-xi,Wt=n-fi,Jt=a-ci,Gt=o-mi,Ot=n-bi,Ut=ui-pi,Ht=yi-xi,Qt=gi-fi,Kt=St*Rt-Tt*jt,$t=Tt*Ct-Pt*Rt,ti=Pt*jt-St*Ct,ii=Et*Wt-Dt*Ft,si=Dt*Nt-qt*Wt,ai=qt*Ft-Et*Nt,oi=Gt*Qt-Ot*Ht,ni=Ot*Ut-Jt*Qt,ei=Jt*Ht-Gt*Ut;let vi,di,Xi,zi,Yi,Zi,Mi,Ii,Vi,wi,Li,ki,Ai,Bi,Pi,Si,Ti,Ci,ji,Ri,qi,Ei,Di,Ni,Fi,Wi,Ji,Gi=Kt*Kt+$t*$t+ti*ti,Oi=ii*ii+si*si+ai*ai,Ui=oi*oi+ni*ni+ei*ei,Hi=Gi>Oi?Gi>Ui?Gi:Ui:Oi>Ui?Oi:Ui,Qi=e._relPos1X,Ki=e._relPos1Y,$i=e._relPos1Z,ts=r._relPos1X,is=r._relPos1Y,ss=r._relPos1Z,as=_._relPos1X,os=_._relPos1Y,ns=_._relPos1Z;vi=ts-Qi,di=is-Ki,Xi=ss-$i,zi=a-as,Yi=o-os,Zi=n-ns,Mi=as-Qi,Ii=os-Ki,Vi=ns-$i,wi=a-ts,Li=o-is,ki=n-ss,Ai=a-Qi,Bi=o-Ki,Pi=n-$i,Si=as-ts,Ti=os-is,Ci=ns-ss,ji=di*Zi-Xi*Yi,Ri=Xi*zi-vi*Zi,qi=vi*Yi-di*zi,Ei=Ii*ki-Vi*Li,Di=Vi*wi-Mi*ki,Ni=Mi*Li-Ii*wi,Fi=Bi*Ci-Pi*Ti,Wi=Pi*Si-Ai*Ci,Ji=Ai*Ti-Bi*Si;let es=ji*ji+Ri*Ri+qi*qi,rs=Ei*Ei+Di*Di+Ni*Ni,_s=Fi*Fi+Wi*Wi+Ji*Ji,ls=es>rs?es>_s?es:_s:rs>_s?rs:_s,hs=Xt>zt?Xt>Yt?Xt:Yt:zt>Yt?zt:Yt,cs=0;return(hi>hs&&1!=c||0==c)&&(hs=hi,cs=1),Hi>hs&&2!=c&&(hs=Hi,cs=2),ls>hs&&3!=c&&(hs=ls,cs=3),cs}computeRelativePositions(t,i){let s=this._manifold._numPoints,a=0;for(;a<s;){let s,o,n,e,r,_,l=this._manifold._points[a++];s=t._rotation00*l._localPos1X+t._rotation01*l._localPos1Y+t._rotation02*l._localPos1Z,o=t._rotation10*l._localPos1X+t._rotation11*l._localPos1Y+t._rotation12*l._localPos1Z,n=t._rotation20*l._localPos1X+t._rotation21*l._localPos1Y+t._rotation22*l._localPos1Z,l._relPos1X=s,l._relPos1Y=o,l._relPos1Z=n,e=i._rotation00*l._localPos2X+i._rotation01*l._localPos2Y+i._rotation02*l._localPos2Z,r=i._rotation10*l._localPos2X+i._rotation11*l._localPos2Y+i._rotation12*l._localPos2Z,_=i._rotation20*l._localPos2X+i._rotation21*l._localPos2Y+i._rotation22*l._localPos2Z,l._relPos2X=e,l._relPos2Y=r,l._relPos2Z=_,l._warmStarted=!0}}findNearestContactPointIndex(t,i,s){let o=a.common.Setting.contactPersistenceThreshold*a.common.Setting.contactPersistenceThreshold,n=-1,e=0,r=this._manifold._numPoints;for(;e<r;){let a,r,_,l,h,c,m=e++,b=this._manifold._points[m],p=t.position1;a=p.x,r=p.y,_=p.z;let x,f,u,y,g,v,d=t.position2;l=d.x,h=d.y,c=d.z,a-=i._positionX,r-=i._positionY,_-=i._positionZ,l-=s._positionX,h-=s._positionY,c-=s._positionZ,x=b._relPos1X-a,f=b._relPos1Y-r,u=b._relPos1Z-_,y=b._relPos2X-l,g=b._relPos2Y-h,v=b._relPos2Z-c;let X=x*x+f*f+u*u,z=y*y+g*g+v*v,Y=X<z?X:z;Y<o&&(o=Y,n=m)}return n}totalUpdate(t,i,s){this.numOldPoints=this._manifold._numPoints;let a=0,o=this.numOldPoints;for(;a<o;){let t=a++,i=this.oldPoints[t],s=this._manifold._points[t];i._localPos1X=s._localPos1X,i._localPos1Y=s._localPos1Y,i._localPos1Z=s._localPos1Z,i._localPos2X=s._localPos2X,i._localPos2Y=s._localPos2Y,i._localPos2Z=s._localPos2Z,i._relPos1X=s._relPos1X,i._relPos1Y=s._relPos1Y,i._relPos1Z=s._relPos1Z,i._relPos2X=s._relPos2X,i._relPos2Y=s._relPos2Y,i._relPos2Z=s._relPos2Z,i._pos1X=s._pos1X,i._pos1Y=s._pos1Y,i._pos1Z=s._pos1Z,i._pos2X=s._pos2X,i._pos2Y=s._pos2Y,i._pos2Z=s._pos2Z,i._depth=s._depth,i._impulse.copyFrom(s._impulse),i._id=s._id,i._warmStarted=s._warmStarted,i._disabled=!1}let n=t.numPoints;this._manifold._numPoints=n;let e=0;for(;e<n;){let a=e++,o=this._manifold._points[a],n=t.points[a],r=n.position1;o._pos1X=r.x,o._pos1Y=r.y,o._pos1Z=r.z;let _,l,h,c,m,b,p=n.position2;o._pos2X=p.x,o._pos2Y=p.y,o._pos2Z=p.z,o._relPos1X=o._pos1X-i._positionX,o._relPos1Y=o._pos1Y-i._positionY,o._relPos1Z=o._pos1Z-i._positionZ,o._relPos2X=o._pos2X-s._positionX,o._relPos2Y=o._pos2Y-s._positionY,o._relPos2Z=o._pos2Z-s._positionZ,_=i._rotation00*o._relPos1X+i._rotation10*o._relPos1Y+i._rotation20*o._relPos1Z,l=i._rotation01*o._relPos1X+i._rotation11*o._relPos1Y+i._rotation21*o._relPos1Z,h=i._rotation02*o._relPos1X+i._rotation12*o._relPos1Y+i._rotation22*o._relPos1Z,o._localPos1X=_,o._localPos1Y=l,o._localPos1Z=h,c=s._rotation00*o._relPos2X+s._rotation10*o._relPos2Y+s._rotation20*o._relPos2Z,m=s._rotation01*o._relPos2X+s._rotation11*o._relPos2Y+s._rotation21*o._relPos2Z,b=s._rotation02*o._relPos2X+s._rotation12*o._relPos2Y+s._rotation22*o._relPos2Z,o._localPos2X=c,o._localPos2Y=m,o._localPos2Z=b,o._depth=n.depth;let x=o._impulse;x.impulseN=0,x.impulseT=0,x.impulseB=0,x.impulseP=0,x.impulseLX=0,x.impulseLY=0,x.impulseLZ=0,o._id=n.id,o._warmStarted=!1,o._disabled=!1;let f=0,u=this.numOldPoints;for(;f<u;){let t=this.oldPoints[f++];if(o._id==t._id){o._impulse.copyFrom(t._impulse),o._warmStarted=!0;break}}}}incrementalUpdate(t,i,s){this._manifold._updateDepthsAndPositions(i,s);let a=0,o=this._manifold._numPoints;for(;a<o;)this._manifold._points[a++]._warmStarted=!0;let n=t.points[0],e=this.findNearestContactPointIndex(n,i,s);if(-1==e)this.addManifoldPoint(n,i,s);else{let t=this._manifold._points[e],a=n.position1;t._pos1X=a.x,t._pos1Y=a.y,t._pos1Z=a.z;let o,r,_,l,h,c,m=n.position2;t._pos2X=m.x,t._pos2Y=m.y,t._pos2Z=m.z,t._relPos1X=t._pos1X-i._positionX,t._relPos1Y=t._pos1Y-i._positionY,t._relPos1Z=t._pos1Z-i._positionZ,t._relPos2X=t._pos2X-s._positionX,t._relPos2Y=t._pos2Y-s._positionY,t._relPos2Z=t._pos2Z-s._positionZ,o=i._rotation00*t._relPos1X+i._rotation10*t._relPos1Y+i._rotation20*t._relPos1Z,r=i._rotation01*t._relPos1X+i._rotation11*t._relPos1Y+i._rotation21*t._relPos1Z,_=i._rotation02*t._relPos1X+i._rotation12*t._relPos1Y+i._rotation22*t._relPos1Z,t._localPos1X=o,t._localPos1Y=r,t._localPos1Z=_,l=s._rotation00*t._relPos2X+s._rotation10*t._relPos2Y+s._rotation20*t._relPos2Z,h=s._rotation01*t._relPos2X+s._rotation11*t._relPos2Y+s._rotation21*t._relPos2Z,c=s._rotation02*t._relPos2X+s._rotation12*t._relPos2Y+s._rotation22*t._relPos2Z,t._localPos2X=l,t._localPos2Y=h,t._localPos2Z=c,t._depth=n.depth}this.removeOutdatedPoints()}},a.dynamics.constraint.info||(a.dynamics.constraint.info={}),a.dynamics.constraint.info.JacobianRow=class{constructor(){this.lin1X=0,this.lin1Y=0,this.lin1Z=0,this.lin2X=0,this.lin2Y=0,this.lin2Z=0,this.ang1X=0,this.ang1Y=0,this.ang1Z=0,this.ang2X=0,this.ang2Y=0,this.ang2Z=0,this.flag=0}updateSparsity(){this.flag=0,0==this.lin1X&&0==this.lin1Y&&0==this.lin1Z&&0==this.lin2X&&0==this.lin2Y&&0==this.lin2Z||(this.flag|=1),0==this.ang1X&&0==this.ang1Y&&0==this.ang1Z&&0==this.ang2X&&0==this.ang2Y&&0==this.ang2Z||(this.flag|=2)}},a.dynamics.constraint.info.contact||(a.dynamics.constraint.info.contact={}),a.dynamics.constraint.info.contact.ContactSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0,this.rows=new Array(a.common.Setting.maxManifoldPoints);let t=0,i=this.rows.length;for(;t<i;)this.rows[t++]=new a.dynamics.constraint.info.contact.ContactSolverInfoRow}},a.dynamics.constraint.info.contact.ContactSolverInfoRow=class{constructor(){this.jacobianN=new a.dynamics.constraint.info.JacobianRow,this.jacobianT=new a.dynamics.constraint.info.JacobianRow,this.jacobianB=new a.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.friction=0,this.impulse=null}},a.dynamics.constraint.info.joint||(a.dynamics.constraint.info.joint={}),a.dynamics.constraint.info.joint.JointSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0,this.rows=new Array(a.common.Setting.maxJacobianRows);let t=0,i=this.rows.length;for(;t<i;)this.rows[t++]=new a.dynamics.constraint.info.joint.JointSolverInfoRow}},a.dynamics.constraint.info.joint.JointSolverInfoRow=class{constructor(){this.jacobian=new a.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.minImpulse=0,this.maxImpulse=0,this.motorSpeed=0,this.motorMaxImpulse=0,this.impulse=null}},a.dynamics.constraint.joint||(a.dynamics.constraint.joint={}),a.dynamics.constraint.joint.BasisTracker=class{constructor(t){this.joint=t,this.xX=0,this.xY=0,this.xZ=0,this.yX=0,this.yY=0,this.yZ=0,this.zX=0,this.zY=0,this.zZ=0}},a.dynamics.constraint.joint.Joint=class{constructor(t,i){switch(this._link1=new a.dynamics.constraint.joint.JointLink(this),this._link2=new a.dynamics.constraint.joint.JointLink(this),this._positionCorrectionAlgorithm=a.common.Setting.defaultJointPositionCorrectionAlgorithm,this._type=i,this._world=null,this._b1=t.rigidBody1,this._b2=t.rigidBody2,this._allowCollision=t.allowCollision,this._breakForce=t.breakForce,this._breakTorque=t.breakTorque,t.solverType){case 0:this._solver=new a.dynamics.constraint.solver.pgs.PgsJointConstraintSolver(this);break;case 1:this._solver=new a.dynamics.constraint.solver.direct.DirectJointConstraintSolver(this)}let s=t.localAnchor1;this._localAnchor1X=s.x,this._localAnchor1Y=s.y,this._localAnchor1Z=s.z;let o=t.localAnchor2;this._localAnchor2X=o.x,this._localAnchor2Y=o.y,this._localAnchor2Z=o.z,this._relativeAnchor1X=0,this._relativeAnchor1Y=0,this._relativeAnchor1Z=0,this._relativeAnchor2X=0,this._relativeAnchor2Y=0,this._relativeAnchor2Z=0,this._anchor1X=0,this._anchor1Y=0,this._anchor1Z=0,this._anchor2X=0,this._anchor2Y=0,this._anchor2Z=0,this._localBasisX1X=0,this._localBasisX1Y=0,this._localBasisX1Z=0,this._localBasisY1X=0,this._localBasisY1Y=0,this._localBasisY1Z=0,this._localBasisZ1X=0,this._localBasisZ1Y=0,this._localBasisZ1Z=0,this._localBasisX2X=0,this._localBasisX2Y=0,this._localBasisX2Z=0,this._localBasisY2X=0,this._localBasisY2Y=0,this._localBasisY2Z=0,this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=0,this._impulses=new Array(a.common.Setting.maxJacobianRows);let n=0,e=a.common.Setting.maxJacobianRows;for(;n<e;)this._impulses[n++]=new a.dynamics.constraint.joint.JointImpulse}buildLocalBasesFromX(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{let t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}let t,i,s,a,o,n,e,r,_,l,h,c,m,b=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(b<-.999999999){let o,n,e,r,_=this._localBasisX1X,l=this._localBasisX1Y,h=this._localBasisX1Z,c=_*_,m=l*l,b=h*h;c<m?c<b?(r=1/Math.sqrt(m+b),o=0,n=h*r,e=-l*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),o=-h*r,n=0,e=_*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0),t=o,i=n,s=e,a=0}else{let o,n,e;o=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,n=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,e=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;let r=Math.sqrt(.5*(1+b));b=.5/r,o*=b,n*=b,e*=b,t=o,i=n,s=e,a=r}let p=2*t,x=2*i,f=2*s,u=t*p,y=i*x,g=s*f,v=t*x,d=i*f,X=t*f,z=a*p,Y=a*x,Z=a*f;o=1-y-g,n=v-Z,e=X+Y,r=v+Z,_=1-u-g,l=d-z,h=X-Y,c=d+z,m=1-u-y;let M,I,V,w,L,k,A,B,P,S,T=this._localBasisX1X,C=this._localBasisX1Y,j=this._localBasisX1Z,R=T*T,q=C*C,E=j*j;R<q?R<E?(M=1/Math.sqrt(q+E),this._localBasisY1X=0,this._localBasisY1Y=j*M,this._localBasisY1Z=-C*M):(M=1/Math.sqrt(R+q),this._localBasisY1X=C*M,this._localBasisY1Y=-T*M,this._localBasisY1Z=0):q<E?(M=1/Math.sqrt(E+R),this._localBasisY1X=-j*M,this._localBasisY1Y=0,this._localBasisY1Z=T*M):(M=1/Math.sqrt(R+q),this._localBasisY1X=C*M,this._localBasisY1Y=-T*M,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,I=o*this._localBasisX1X+n*this._localBasisX1Y+e*this._localBasisX1Z,V=r*this._localBasisX1X+_*this._localBasisX1Y+l*this._localBasisX1Z,w=h*this._localBasisX1X+c*this._localBasisX1Y+m*this._localBasisX1Z,this._localBasisX2X=I,this._localBasisX2Y=V,this._localBasisX2Z=w,L=o*this._localBasisY1X+n*this._localBasisY1Y+e*this._localBasisY1Z,k=r*this._localBasisY1X+_*this._localBasisY1Y+l*this._localBasisY1Z,A=h*this._localBasisY1X+c*this._localBasisY1Y+m*this._localBasisY1Z,this._localBasisY2X=L,this._localBasisY2Y=k,this._localBasisY2Z=A,B=o*this._localBasisZ1X+n*this._localBasisZ1Y+e*this._localBasisZ1Z,P=r*this._localBasisZ1X+_*this._localBasisZ1Y+l*this._localBasisZ1Z,S=h*this._localBasisZ1X+c*this._localBasisZ1Y+m*this._localBasisZ1Z,this._localBasisZ2X=B,this._localBasisZ2Y=P,this._localBasisZ2Z=S}buildLocalBasesFromXY(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{let t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){let t,i=this._localBasisX1X,s=this._localBasisX1Y,a=this._localBasisX1Z,o=i*i,n=s*s,e=a*a;o<n?o<e?(t=1/Math.sqrt(n+e),this._localBasisY1X=0,this._localBasisY1Y=a*t,this._localBasisY1Z=-s*t):(t=1/Math.sqrt(o+n),this._localBasisY1X=s*t,this._localBasisY1Y=-i*t,this._localBasisY1Z=0):n<e?(t=1/Math.sqrt(e+o),this._localBasisY1X=-a*t,this._localBasisY1Y=0,this._localBasisY1Z=i*t):(t=1/Math.sqrt(o+n),this._localBasisY1X=s*t,this._localBasisY1Y=-i*t,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{let t=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ1X*=t,this._localBasisZ1Y*=t,this._localBasisZ1Z*=t,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0){let t,i=this._localBasisX2X,s=this._localBasisX2Y,a=this._localBasisX2Z,o=i*i,n=s*s,e=a*a;o<n?o<e?(t=1/Math.sqrt(n+e),this._localBasisY2X=0,this._localBasisY2Y=a*t,this._localBasisY2Z=-s*t):(t=1/Math.sqrt(o+n),this._localBasisY2X=s*t,this._localBasisY2Y=-i*t,this._localBasisY2Z=0):n<e?(t=1/Math.sqrt(e+o),this._localBasisY2X=-a*t,this._localBasisY2Y=0,this._localBasisY2Z=i*t):(t=1/Math.sqrt(o+n),this._localBasisY2X=s*t,this._localBasisY2Y=-i*t,this._localBasisY2Z=0),this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X}else{let t=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ2X*=t,this._localBasisZ2Y*=t,this._localBasisZ2Z*=t,this._localBasisY2X=this._localBasisZ2Y*this._localBasisX2Z-this._localBasisZ2Z*this._localBasisX2Y,this._localBasisY2Y=this._localBasisZ2Z*this._localBasisX2X-this._localBasisZ2X*this._localBasisX2Z,this._localBasisY2Z=this._localBasisZ2X*this._localBasisX2Y-this._localBasisZ2Y*this._localBasisX2X}}buildLocalBasesFromX1Z2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0)this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=1;else{let t=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ2X*=t,this._localBasisZ2Y*=t,this._localBasisZ2Z*=t}let t,i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R=this._b1._transform,q=this._b2._transform;if(x=R._rotation00*this._localBasisX1X+R._rotation01*this._localBasisX1Y+R._rotation02*this._localBasisX1Z,f=R._rotation10*this._localBasisX1X+R._rotation11*this._localBasisX1Y+R._rotation12*this._localBasisX1Z,u=R._rotation20*this._localBasisX1X+R._rotation21*this._localBasisX1Y+R._rotation22*this._localBasisX1Z,t=x,i=f,s=u,y=q._rotation00*this._localBasisZ2X+q._rotation01*this._localBasisZ2Y+q._rotation02*this._localBasisZ2Z,g=q._rotation10*this._localBasisZ2X+q._rotation11*this._localBasisZ2Y+q._rotation12*this._localBasisZ2Z,v=q._rotation20*this._localBasisZ2X+q._rotation21*this._localBasisZ2Y+q._rotation22*this._localBasisZ2Z,m=y,b=g,p=v,e=b*s-p*i,r=p*t-m*s,_=m*i-b*t,e*e+r*r+_*_==0){let a,o=t,n=i,l=s,h=o*o,c=n*n,m=l*l;h<c?h<m?(a=1/Math.sqrt(c+m),e=0,r=l*a,_=-n*a):(a=1/Math.sqrt(h+c),e=n*a,r=-o*a,_=0):c<m?(a=1/Math.sqrt(m+h),e=-l*a,r=0,_=o*a):(a=1/Math.sqrt(h+c),e=n*a,r=-o*a,_=0)}a=i*_-s*r,o=s*e-t*_,n=t*r-i*e,l=r*p-_*b,h=_*m-e*p,c=e*b-r*m,d=R._rotation00*t+R._rotation10*i+R._rotation20*s,X=R._rotation01*t+R._rotation11*i+R._rotation21*s,z=R._rotation02*t+R._rotation12*i+R._rotation22*s,this._localBasisX1X=d,this._localBasisX1Y=X,this._localBasisX1Z=z,Y=R._rotation00*e+R._rotation10*r+R._rotation20*_,Z=R._rotation01*e+R._rotation11*r+R._rotation21*_,M=R._rotation02*e+R._rotation12*r+R._rotation22*_,this._localBasisY1X=Y,this._localBasisY1Y=Z,this._localBasisY1Z=M,I=R._rotation00*a+R._rotation10*o+R._rotation20*n,V=R._rotation01*a+R._rotation11*o+R._rotation21*n,w=R._rotation02*a+R._rotation12*o+R._rotation22*n,this._localBasisZ1X=I,this._localBasisZ1Y=V,this._localBasisZ1Z=w,L=q._rotation00*l+q._rotation10*h+q._rotation20*c,k=q._rotation01*l+q._rotation11*h+q._rotation21*c,A=q._rotation02*l+q._rotation12*h+q._rotation22*c,this._localBasisX2X=L,this._localBasisX2Y=k,this._localBasisX2Z=A,B=q._rotation00*e+q._rotation10*r+q._rotation20*_,P=q._rotation01*e+q._rotation11*r+q._rotation21*_,S=q._rotation02*e+q._rotation12*r+q._rotation22*_,this._localBasisY2X=B,this._localBasisY2Y=P,this._localBasisY2Z=S,T=q._rotation00*m+q._rotation10*b+q._rotation20*p,C=q._rotation01*m+q._rotation11*b+q._rotation21*p,j=q._rotation02*m+q._rotation12*b+q._rotation22*p,this._localBasisZ2X=T,this._localBasisZ2Y=C,this._localBasisZ2Z=j}buildLocalBasesFromXY1X2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){let t,i=this._localBasisX1X,s=this._localBasisX1Y,a=this._localBasisX1Z,o=i*i,n=s*s,e=a*a;o<n?o<e?(t=1/Math.sqrt(n+e),this._localBasisY1X=0,this._localBasisY1Y=a*t,this._localBasisY1Z=-s*t):(t=1/Math.sqrt(o+n),this._localBasisY1X=s*t,this._localBasisY1Y=-i*t,this._localBasisY1Z=0):n<e?(t=1/Math.sqrt(e+o),this._localBasisY1X=-a*t,this._localBasisY1Y=0,this._localBasisY1Z=i*t):(t=1/Math.sqrt(o+n),this._localBasisY1X=s*t,this._localBasisY1Y=-i*t,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{let t=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ1X*=t,this._localBasisZ1Y*=t,this._localBasisZ1Z*=t,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}let t,i,s,a,o,n,e,r,_,l,h,c,m,b=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(b<-.999999999){let o,n,e,r,_=this._localBasisX1X,l=this._localBasisX1Y,h=this._localBasisX1Z,c=_*_,m=l*l,b=h*h;c<m?c<b?(r=1/Math.sqrt(m+b),o=0,n=h*r,e=-l*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),o=-h*r,n=0,e=_*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0),t=o,i=n,s=e,a=0}else{let o,n,e;o=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,n=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,e=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;let r=Math.sqrt(.5*(1+b));b=.5/r,o*=b,n*=b,e*=b,t=o,i=n,s=e,a=r}let p,x,f,u,y,g,v,d,X,z=2*t,Y=2*i,Z=2*s,M=t*z,I=i*Y,V=s*Z,w=t*Y,L=i*Z,k=t*Z,A=a*z,B=a*Y,P=a*Z;o=1-I-V,n=w-P,e=k+B,r=w+P,_=1-M-V,l=L-A,h=k-B,c=L+A,m=1-M-I,p=o*this._localBasisX1X+n*this._localBasisX1Y+e*this._localBasisX1Z,x=r*this._localBasisX1X+_*this._localBasisX1Y+l*this._localBasisX1Z,f=h*this._localBasisX1X+c*this._localBasisX1Y+m*this._localBasisX1Z,this._localBasisX2X=p,this._localBasisX2Y=x,this._localBasisX2Z=f,u=o*this._localBasisY1X+n*this._localBasisY1Y+e*this._localBasisY1Z,y=r*this._localBasisY1X+_*this._localBasisY1Y+l*this._localBasisY1Z,g=h*this._localBasisY1X+c*this._localBasisY1Y+m*this._localBasisY1Z,this._localBasisY2X=u,this._localBasisY2Y=y,this._localBasisY2Z=g,v=o*this._localBasisZ1X+n*this._localBasisZ1Y+e*this._localBasisZ1Z,d=r*this._localBasisZ1X+_*this._localBasisZ1Y+l*this._localBasisZ1Z,X=h*this._localBasisZ1X+c*this._localBasisZ1Y+m*this._localBasisZ1Z,this._localBasisZ2X=v,this._localBasisZ2Y=d,this._localBasisZ2Z=X}setSolverInfoRowLinear(t,i,s,o,n,e,r){let _,l,h=a.common.Setting.linearSlop;if(r)_=0,l=1;else{if(n.frequency>0){h=0;let t=6.28318530717958*n.frequency,i=n.dampingRatio;i<a.common.Setting.minSpringDamperDampingRatio&&(i=a.common.Setting.minSpringDamperDampingRatio);let s=e.dt,o=2*i*t,r=t*t;n.useSymplecticEuler?(_=1/(s*o),l=r/o):(_=1/(s*(s*r+o)),l=r/(s*r+o))}else _=0,l=this.getErp(e,!1);s.motorForce>0?(t.motorSpeed=s.motorSpeed,t.motorMaxImpulse=s.motorForce*e.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}let c,m,b,p=s.lowerLimit,x=s.upperLimit;p>x?(c=0,m=0,b=0):p==x?(c=-1/0,m=Infinity,b=i-p):i<p?(c=-1/0,m=0,b=i-p+h,b>0&&(b=0)):i>x?(c=0,m=Infinity,b=i-x-h,b<0&&(b=0)):(c=0,m=0,b=0),t.minImpulse=c,t.maxImpulse=m,t.cfm=_*(0==o?0:1/o),t.rhs=b*l}setSolverInfoRowAngular(t,i,s,o,n,e,r){let _,l,h=a.common.Setting.angularSlop;if(r)_=0,l=1;else{if(n.frequency>0){h=0;let t=6.28318530717958*n.frequency,i=n.dampingRatio;i<a.common.Setting.minSpringDamperDampingRatio&&(i=a.common.Setting.minSpringDamperDampingRatio);let s=e.dt,o=2*i*t,r=t*t;n.useSymplecticEuler?(_=1/(s*o),l=r/o):(_=1/(s*(s*r+o)),l=r/(s*r+o))}else _=0,l=this.getErp(e,!1);s.motorTorque>0?(t.motorSpeed=s.motorSpeed,t.motorMaxImpulse=s.motorTorque*e.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}let c,m,b,p=s.lowerLimit,x=s.upperLimit,f=.5*(p+x);i=(((i-=f)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,i+=f,p>x?(c=0,m=0,b=0):p==x?(c=-1/0,m=Infinity,b=i-p):i<p?(c=-1/0,m=0,b=i-p+h,b>0&&(b=0)):i>x?(c=0,m=Infinity,b=i-x-h,b<0&&(b=0)):(c=0,m=0,b=0),t.minImpulse=c,t.maxImpulse=m,t.cfm=_*(0==o?0:1/o),t.rhs=b*l}getErp(t,i){return i?1:this._positionCorrectionAlgorithm==a.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*a.common.Setting.velocityBaumgarte:0}computeEffectiveInertiaMoment(t,i,s){let a,o,n,e,r,_,l,h,c,m,b,p;l=this._b1._invInertia00*t+this._b1._invInertia01*i+this._b1._invInertia02*s,h=this._b1._invInertia10*t+this._b1._invInertia11*i+this._b1._invInertia12*s,c=this._b1._invInertia20*t+this._b1._invInertia21*i+this._b1._invInertia22*s,a=l,o=h,n=c,m=this._b2._invInertia00*t+this._b2._invInertia01*i+this._b2._invInertia02*s,b=this._b2._invInertia10*t+this._b2._invInertia11*i+this._b2._invInertia12*s,p=this._b2._invInertia20*t+this._b2._invInertia21*i+this._b2._invInertia22*s,e=m,r=b,_=p;let x=a*t+o*i+n*s,f=e*t+r*i+_*s;if(x>0){let a=t*this._relativeAnchor1X+i*this._relativeAnchor1Y+s*this._relativeAnchor1Z,o=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z-a*a;o>0&&(x=this._b1._invMass>0?1/(1/x+this._b1._mass*o):0)}if(f>0){let a=t*this._relativeAnchor2X+i*this._relativeAnchor2Y+s*this._relativeAnchor2Z,o=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z-a*a;o>0&&(f=this._b2._invMass>0?1/(1/f+this._b2._mass*o):0)}return x+f==0?0:1/(x+f)}computeEffectiveInertiaMoment2(t,i,s,a,o,n){let e,r,_,l,h,c,m,b,p,x,f,u;m=this._b1._invInertia00*t+this._b1._invInertia01*i+this._b1._invInertia02*s,b=this._b1._invInertia10*t+this._b1._invInertia11*i+this._b1._invInertia12*s,p=this._b1._invInertia20*t+this._b1._invInertia21*i+this._b1._invInertia22*s,e=m,r=b,_=p,x=this._b2._invInertia00*a+this._b2._invInertia01*o+this._b2._invInertia02*n,f=this._b2._invInertia10*a+this._b2._invInertia11*o+this._b2._invInertia12*n,u=this._b2._invInertia20*a+this._b2._invInertia21*o+this._b2._invInertia22*n,l=x,h=f,c=u;let y=e*t+r*i+_*s,g=l*a+h*o+c*n;if(y>0){let a=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,o=t*this._relativeAnchor1X+i*this._relativeAnchor1Y+s*this._relativeAnchor1Z,n=a*a-o*o;n>0&&(y=this._b1._invMass>0?1/(1/y+this._b1._mass*n):0)}if(g>0){let t=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,i=a*this._relativeAnchor2X+o*this._relativeAnchor2Y+n*this._relativeAnchor2Z,s=t*t-i*i;s>0&&(g=this._b2._invMass>0?1/(1/g+this._b2._mass*s):0)}return y+g==0?0:1/(y+g)}_syncAnchors(){let t,i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y=this._b1._transform,Z=this._b2._transform;t=Y._rotation00*this._localAnchor1X+Y._rotation01*this._localAnchor1Y+Y._rotation02*this._localAnchor1Z,i=Y._rotation10*this._localAnchor1X+Y._rotation11*this._localAnchor1Y+Y._rotation12*this._localAnchor1Z,s=Y._rotation20*this._localAnchor1X+Y._rotation21*this._localAnchor1Y+Y._rotation22*this._localAnchor1Z,this._relativeAnchor1X=t,this._relativeAnchor1Y=i,this._relativeAnchor1Z=s,a=Z._rotation00*this._localAnchor2X+Z._rotation01*this._localAnchor2Y+Z._rotation02*this._localAnchor2Z,o=Z._rotation10*this._localAnchor2X+Z._rotation11*this._localAnchor2Y+Z._rotation12*this._localAnchor2Z,n=Z._rotation20*this._localAnchor2X+Z._rotation21*this._localAnchor2Y+Z._rotation22*this._localAnchor2Z,this._relativeAnchor2X=a,this._relativeAnchor2Y=o,this._relativeAnchor2Z=n,this._anchor1X=this._relativeAnchor1X+Y._positionX,this._anchor1Y=this._relativeAnchor1Y+Y._positionY,this._anchor1Z=this._relativeAnchor1Z+Y._positionZ,this._anchor2X=this._relativeAnchor2X+Z._positionX,this._anchor2Y=this._relativeAnchor2Y+Z._positionY,this._anchor2Z=this._relativeAnchor2Z+Z._positionZ,e=Y._rotation00*this._localBasisX1X+Y._rotation01*this._localBasisX1Y+Y._rotation02*this._localBasisX1Z,r=Y._rotation10*this._localBasisX1X+Y._rotation11*this._localBasisX1Y+Y._rotation12*this._localBasisX1Z,_=Y._rotation20*this._localBasisX1X+Y._rotation21*this._localBasisX1Y+Y._rotation22*this._localBasisX1Z,this._basisX1X=e,this._basisX1Y=r,this._basisX1Z=_,l=Y._rotation00*this._localBasisY1X+Y._rotation01*this._localBasisY1Y+Y._rotation02*this._localBasisY1Z,h=Y._rotation10*this._localBasisY1X+Y._rotation11*this._localBasisY1Y+Y._rotation12*this._localBasisY1Z,c=Y._rotation20*this._localBasisY1X+Y._rotation21*this._localBasisY1Y+Y._rotation22*this._localBasisY1Z,this._basisY1X=l,this._basisY1Y=h,this._basisY1Z=c,m=Y._rotation00*this._localBasisZ1X+Y._rotation01*this._localBasisZ1Y+Y._rotation02*this._localBasisZ1Z,b=Y._rotation10*this._localBasisZ1X+Y._rotation11*this._localBasisZ1Y+Y._rotation12*this._localBasisZ1Z,p=Y._rotation20*this._localBasisZ1X+Y._rotation21*this._localBasisZ1Y+Y._rotation22*this._localBasisZ1Z,this._basisZ1X=m,this._basisZ1Y=b,this._basisZ1Z=p,x=Z._rotation00*this._localBasisX2X+Z._rotation01*this._localBasisX2Y+Z._rotation02*this._localBasisX2Z,f=Z._rotation10*this._localBasisX2X+Z._rotation11*this._localBasisX2Y+Z._rotation12*this._localBasisX2Z,u=Z._rotation20*this._localBasisX2X+Z._rotation21*this._localBasisX2Y+Z._rotation22*this._localBasisX2Z,this._basisX2X=x,this._basisX2Y=f,this._basisX2Z=u,y=Z._rotation00*this._localBasisY2X+Z._rotation01*this._localBasisY2Y+Z._rotation02*this._localBasisY2Z,g=Z._rotation10*this._localBasisY2X+Z._rotation11*this._localBasisY2Y+Z._rotation12*this._localBasisY2Z,v=Z._rotation20*this._localBasisY2X+Z._rotation21*this._localBasisY2Y+Z._rotation22*this._localBasisY2Z,this._basisY2X=y,this._basisY2Y=g,this._basisY2Z=v,d=Z._rotation00*this._localBasisZ2X+Z._rotation01*this._localBasisZ2Y+Z._rotation02*this._localBasisZ2Z,X=Z._rotation10*this._localBasisZ2X+Z._rotation11*this._localBasisZ2Y+Z._rotation12*this._localBasisZ2Z,z=Z._rotation20*this._localBasisZ2X+Z._rotation21*this._localBasisZ2Y+Z._rotation22*this._localBasisZ2Z,this._basisZ2X=d,this._basisZ2Y=X,this._basisZ2Z=z}_getVelocitySolverInfo(t,i){i.b1=this._b1,i.b2=this._b2,i.numRows=0}_getPositionSolverInfo(t){t.b1=this._b1,t.b2=this._b2,t.numRows=0}_checkDestruction(){let t=this._appliedTorqueX*this._appliedTorqueX+this._appliedTorqueY*this._appliedTorqueY+this._appliedTorqueZ*this._appliedTorqueZ;(this._breakForce>0&&this._appliedForceX*this._appliedForceX+this._appliedForceY*this._appliedForceY+this._appliedForceZ*this._appliedForceZ>this._breakForce*this._breakForce||this._breakTorque>0&&t>this._breakTorque*this._breakTorque)&&this._world.removeJoint(this)}getRigidBody1(){return this._b1}getRigidBody2(){return this._b2}getType(){return this._type}getAnchor1(){let t=new a.common.Vec3;return t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z,t}getAnchor2(){let t=new a.common.Vec3;return t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z,t}getAnchor1To(t){t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z}getAnchor2To(t){t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z}getLocalAnchor1(){let t=new a.common.Vec3;return t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z,t}getLocalAnchor2(){let t=new a.common.Vec3;return t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z,t}getLocalAnchor1To(t){t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z}getLocalAnchor2To(t){t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z}getBasis1(){let t,i,s,o,n,e,r,_,l,h=new a.common.Mat3;return t=this._basisX1X,i=this._basisY1X,s=this._basisZ1X,o=this._basisX1Y,n=this._basisY1Y,e=this._basisZ1Y,r=this._basisX1Z,_=this._basisY1Z,l=this._basisZ1Z,h.e00=t,h.e01=i,h.e02=s,h.e10=o,h.e11=n,h.e12=e,h.e20=r,h.e21=_,h.e22=l,h}getBasis2(){let t,i,s,o,n,e,r,_,l,h=new a.common.Mat3;return t=this._basisX2X,i=this._basisY2X,s=this._basisZ2X,o=this._basisX2Y,n=this._basisY2Y,e=this._basisZ2Y,r=this._basisX2Z,_=this._basisY2Z,l=this._basisZ2Z,h.e00=t,h.e01=i,h.e02=s,h.e10=o,h.e11=n,h.e12=e,h.e20=r,h.e21=_,h.e22=l,h}getBasis1To(t){let i,s,a,o,n,e,r,_,l;i=this._basisX1X,s=this._basisY1X,a=this._basisZ1X,o=this._basisX1Y,n=this._basisY1Y,e=this._basisZ1Y,r=this._basisX1Z,_=this._basisY1Z,l=this._basisZ1Z,t.e00=i,t.e01=s,t.e02=a,t.e10=o,t.e11=n,t.e12=e,t.e20=r,t.e21=_,t.e22=l}getBasis2To(t){let i,s,a,o,n,e,r,_,l;i=this._basisX2X,s=this._basisY2X,a=this._basisZ2X,o=this._basisX2Y,n=this._basisY2Y,e=this._basisZ2Y,r=this._basisX2Z,_=this._basisY2Z,l=this._basisZ2Z,t.e00=i,t.e01=s,t.e02=a,t.e10=o,t.e11=n,t.e12=e,t.e20=r,t.e21=_,t.e22=l}getAllowCollision(){return this._allowCollision}setAllowCollision(t){this._allowCollision=t}getBreakForce(){return this._breakForce}setBreakForce(t){this._breakForce=t}getBreakTorque(){return this._breakTorque}setBreakTorque(t){this._breakTorque=t}getPositionCorrectionAlgorithm(){return this._positionCorrectionAlgorithm}setPositionCorrectionAlgorithm(t){switch(t){case 0:case 1:case 2:break;default:throw new Error("invalid position correction algorithm id: "+t)}this._positionCorrectionAlgorithm=t}getAppliedForce(){let t=new a.common.Vec3;return t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ,t}getAppliedForceTo(t){t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ}getAppliedTorque(){let t=new a.common.Vec3;return t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ,t}getAppliedTorqueTo(t){t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ}getPrev(){return this._prev}getNext(){return this._next}},a.dynamics.constraint.joint.CylindricalJoint=class extends a.dynamics.constraint.joint.Joint{constructor(t){super(t,2);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localAxis2;this._localBasisX2X=s.x,this._localBasisX2Y=s.y,this._localBasisX2Z=s.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this._basis=new a.dynamics.constraint.joint.BasisTracker(this),this._translSd=t.translationalSpringDamper.clone(),this._translLm=t.translationalLimitMotor.clone(),this._rotSd=t.rotationalSpringDamper.clone(),this._rotLm=t.rotationalLimitMotor.clone()}getInfo(t,i,s){let a,o=this.getErp(i,s),n=this.linearErrorY*o,e=this.linearErrorZ*o,r=this.angularErrorY*o,_=this.angularErrorZ*o,l=1/(this._b1._invMass+this._b2._invMass),h=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ);if(this._translSd.frequency<=0||!s){let o=this._impulses[0],n=t.rows[t.numRows++],e=n.jacobian;e.lin1X=0,e.lin1Y=0,e.lin1Z=0,e.lin2X=0,e.lin2Y=0,e.lin2Z=0,e.ang1X=0,e.ang1Y=0,e.ang1Z=0,e.ang2X=0,e.ang2Y=0,e.ang2Z=0,n.rhs=0,n.cfm=0,n.minImpulse=0,n.maxImpulse=0,n.motorSpeed=0,n.motorMaxImpulse=0,n.impulse=null,n.impulse=o,this.setSolverInfoRowLinear(n,this.translation,this._translLm,l,this._translSd,i,s),a=n.jacobian,a.lin1X=this._basis.xX,a.lin1Y=this._basis.xY,a.lin1Z=this._basis.xZ,a.lin2X=this._basis.xX,a.lin2Y=this._basis.xY,a.lin2Z=this._basis.xZ,a.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,a.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,a.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,a.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,a.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,a.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}let c=this._impulses[1],m=t.rows[t.numRows++],b=m.jacobian;b.lin1X=0,b.lin1Y=0,b.lin1Z=0,b.lin2X=0,b.lin2Y=0,b.lin2Z=0,b.ang1X=0,b.ang1Y=0,b.ang1Z=0,b.ang2X=0,b.ang2Y=0,b.ang2Z=0,m.rhs=0,m.cfm=0,m.minImpulse=0,m.maxImpulse=0,m.motorSpeed=0,m.motorMaxImpulse=0,m.impulse=null,m.impulse=c,m.rhs=n,m.cfm=0,m.minImpulse=-1/0,m.maxImpulse=Infinity,a=m.jacobian,a.lin1X=this._basis.yX,a.lin1Y=this._basis.yY,a.lin1Z=this._basis.yZ,a.lin2X=this._basis.yX,a.lin2Y=this._basis.yY,a.lin2Z=this._basis.yZ,a.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,a.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,a.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,a.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,a.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,a.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;let p=this._impulses[2],x=t.rows[t.numRows++],f=x.jacobian;if(f.lin1X=0,f.lin1Y=0,f.lin1Z=0,f.lin2X=0,f.lin2Y=0,f.lin2Z=0,f.ang1X=0,f.ang1Y=0,f.ang1Z=0,f.ang2X=0,f.ang2Y=0,f.ang2Z=0,x.rhs=0,x.cfm=0,x.minImpulse=0,x.maxImpulse=0,x.motorSpeed=0,x.motorMaxImpulse=0,x.impulse=null,x.impulse=p,x.rhs=e,x.cfm=0,x.minImpulse=-1/0,x.maxImpulse=Infinity,a=x.jacobian,a.lin1X=this._basis.zX,a.lin1Y=this._basis.zY,a.lin1Z=this._basis.zZ,a.lin2X=this._basis.zX,a.lin2Y=this._basis.zY,a.lin2Z=this._basis.zZ,a.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,a.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,a.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,a.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,a.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,a.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX,this._rotSd.frequency<=0||!s){let o=this._impulses[3],n=t.rows[t.numRows++],e=n.jacobian;e.lin1X=0,e.lin1Y=0,e.lin1Z=0,e.lin2X=0,e.lin2Y=0,e.lin2Z=0,e.ang1X=0,e.ang1Y=0,e.ang1Z=0,e.ang2X=0,e.ang2Y=0,e.ang2Z=0,n.rhs=0,n.cfm=0,n.minImpulse=0,n.maxImpulse=0,n.motorSpeed=0,n.motorMaxImpulse=0,n.impulse=null,n.impulse=o,this.setSolverInfoRowAngular(n,this.angle,this._rotLm,h,this._rotSd,i,s),a=n.jacobian,a.ang1X=this._basis.xX,a.ang1Y=this._basis.xY,a.ang1Z=this._basis.xZ,a.ang2X=this._basis.xX,a.ang2Y=this._basis.xY,a.ang2Z=this._basis.xZ}let u=this._impulses[4],y=t.rows[t.numRows++],g=y.jacobian;g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,y.rhs=0,y.cfm=0,y.minImpulse=0,y.maxImpulse=0,y.motorSpeed=0,y.motorMaxImpulse=0,y.impulse=null,y.impulse=u,y.rhs=r,y.cfm=0,y.minImpulse=-1/0,y.maxImpulse=Infinity,a=y.jacobian,a.ang1X=this._basis.yX,a.ang1Y=this._basis.yY,a.ang1Z=this._basis.yZ,a.ang2X=this._basis.yX,a.ang2Y=this._basis.yY,a.ang2Z=this._basis.yZ;let v=this._impulses[5],d=t.rows[t.numRows++],X=d.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,d.rhs=0,d.cfm=0,d.minImpulse=0,d.maxImpulse=0,d.motorSpeed=0,d.motorMaxImpulse=0,d.impulse=null,d.impulse=v,d.rhs=_,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=Infinity,a=d.jacobian,a.ang1X=this._basis.zX,a.ang1Y=this._basis.zY,a.ang1Z=this._basis.zZ,a.ang2X=this._basis.zX,a.ang2Y=this._basis.zY,a.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();let t,i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,q,E,D,N,F=this._basis,W=F.joint._b1._invMass,J=F.joint._b2._invMass,G=F.joint._basisX1X*F.joint._basisX2X+F.joint._basisX1Y*F.joint._basisX2Y+F.joint._basisX1Z*F.joint._basisX2Z;if(G<-.999999999){let o,n,e,r,_=F.joint._basisX1X,l=F.joint._basisX1Y,h=F.joint._basisX1Z,c=_*_,m=l*l,b=h*h;c<m?c<b?(r=1/Math.sqrt(m+b),o=0,n=h*r,e=-l*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),o=-h*r,n=0,e=_*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0),t=o,i=n,s=e,a=0}else{let o,n,e;o=F.joint._basisX1Y*F.joint._basisX2Z-F.joint._basisX1Z*F.joint._basisX2Y,n=F.joint._basisX1Z*F.joint._basisX2X-F.joint._basisX1X*F.joint._basisX2Z,e=F.joint._basisX1X*F.joint._basisX2Y-F.joint._basisX1Y*F.joint._basisX2X;let r=Math.sqrt(.5*(1+G));G=.5/r,o*=G,n*=G,e*=G,t=o,i=n,s=e,a=r}o=0,n=0,e=0,r=1,T=0,C=0,j=0,R=1,q=t,E=i,D=s,N=a;let O=T*q+C*E+j*D+R*N;if(O<0&&(O=-O,q=-q,E=-E,D=-D,N=-N),O>.999999){let t,i,s,a;t=q-T,i=E-C,s=D-j,a=N-R,q=T+t*(W/(W+J)),E=C+i*(W/(W+J)),D=j+s*(W/(W+J)),N=R+a*(W/(W+J));let o=q*q+E*E+D*D+N*N;o>1e-32&&(o=1/Math.sqrt(o)),_=q*o,l=E*o,h=D*o,c=N*o}else{let t=W/(W+J)*Math.acos(O);q+=T*-O,E+=C*-O,D+=j*-O,N+=R*-O;let i=q*q+E*E+D*D+N*N;i>1e-32&&(i=1/Math.sqrt(i)),q*=i,E*=i,D*=i,N*=i;let s=Math.sin(t),a=Math.cos(t);T*=a,C*=a,j*=a,R*=a,_=T+q*s,l=C+E*s,h=j+D*s,c=R+N*s}let U,H,Q,K=2*_,$=2*l,tt=2*h,it=_*K,st=l*$,at=h*tt,ot=_*$,nt=l*tt,et=_*tt,rt=c*K,_t=c*$,lt=c*tt;m=1-st-at,b=ot-lt,p=et+_t,x=ot+lt,f=1-it-at,u=nt-rt,y=et-_t,g=nt+rt,v=1-it-st,U=m*F.joint._basisX1X+b*F.joint._basisX1Y+p*F.joint._basisX1Z,H=x*F.joint._basisX1X+f*F.joint._basisX1Y+u*F.joint._basisX1Z,Q=y*F.joint._basisX1X+g*F.joint._basisX1Y+v*F.joint._basisX1Z,d=U,X=H,z=Q,L=F.xX,k=F.xY,A=F.xZ,B=F.yX,P=F.yY,S=F.yZ;let ht=L*d+k*X+A*z;if(ht<-.999999999){let t,i,s,a,o=L,n=k,e=A,r=o*o,m=n*n,b=e*e;r<m?r<b?(a=1/Math.sqrt(m+b),t=0,i=e*a,s=-n*a):(a=1/Math.sqrt(r+m),t=n*a,i=-o*a,s=0):m<b?(a=1/Math.sqrt(b+r),t=-e*a,i=0,s=o*a):(a=1/Math.sqrt(r+m),t=n*a,i=-o*a,s=0),_=t,l=i,h=s,c=0}else{let t,i,s;t=k*z-A*X,i=A*d-L*z,s=L*X-k*d;let a=Math.sqrt(.5*(1+ht));ht=.5/a,t*=ht,i*=ht,s*=ht,_=t,l=i,h=s,c=a}let ct,mt,bt,pt,xt,ft,ut=2*_,yt=2*l,gt=2*h,vt=_*ut,dt=l*yt,Xt=h*gt,zt=_*yt,Yt=l*gt,Zt=_*gt,Mt=c*ut,It=c*yt,Vt=c*gt;if(m=1-dt-Xt,b=zt-Vt,p=Zt+It,x=zt+Vt,f=1-vt-Xt,u=Yt-Mt,y=Zt-It,g=Yt+Mt,v=1-vt-dt,ct=m*B+b*P+p*S,mt=x*B+f*P+u*S,bt=y*B+g*P+v*S,Y=ct,Z=mt,M=bt,I=X*M-z*Z,V=z*Y-d*M,w=d*Z-X*Y,I*I+V*V+w*w>1e-6){let t=I*I+V*V+w*w;t>0&&(t=1/Math.sqrt(t)),I*=t,V*=t,w*=t}else{let t,i=d,s=X,a=z,o=i*i,n=s*s,e=a*a;o<n?o<e?(t=1/Math.sqrt(n+e),I=0,V=a*t,w=-s*t):(t=1/Math.sqrt(o+n),I=s*t,V=-i*t,w=0):n<e?(t=1/Math.sqrt(e+o),I=-a*t,V=0,w=i*t):(t=1/Math.sqrt(o+n),I=s*t,V=-i*t,w=0)}Y=V*z-w*X,Z=w*d-I*z,M=I*X-V*d,F.xX=d,F.xY=X,F.xZ=z,F.yX=Y,F.yY=Z,F.yZ=M,F.zX=I,F.zY=V,F.zZ=w,pt=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,xt=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,ft=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;let wt,Lt,kt,At,Bt,Pt,St=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,Tt=St<=-1?3.14159265358979:St>=1?0:Math.acos(St),Ct=pt*pt+xt*xt+ft*ft;Ct>0&&(Ct=1/Math.sqrt(Ct)),pt*=Ct,xt*=Ct,ft*=Ct,pt*=Tt,xt*=Tt,ft*=Tt,this.angularErrorY=pt*this._basis.yX+xt*this._basis.yY+ft*this._basis.yZ,this.angularErrorZ=pt*this._basis.zX+xt*this._basis.zY+ft*this._basis.zZ,wt=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,Lt=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,kt=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,St=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=St<=-1?3.14159265358979:St>=1?0:Math.acos(St),wt*this._basis.xX+Lt*this._basis.xY+kt*this._basis.xZ<0&&(this.angle=-this.angle),At=this._anchor2X-this._anchor1X,Bt=this._anchor2Y-this._anchor1Y,Pt=this._anchor2Z-this._anchor1Z,this.translation=At*this._basis.xX+Bt*this._basis.xY+Pt*this._basis.xZ,this.linearErrorY=At*this._basis.yX+Bt*this._basis.yY+Pt*this._basis.yZ,this.linearErrorZ=At*this._basis.zX+Bt*this._basis.zY+Pt*this._basis.zZ}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new a.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new a.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new a.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new a.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTranslationalSpringDamper(){return this._translSd}getRotationalSpringDamper(){return this._rotSd}getTranslationalLimitMotor(){return this._translLm}getRotationalLimitMotor(){return this._rotLm}getAngle(){return this.angle}getTranslation(){return this.translation}},a.dynamics.constraint.joint.JointConfig=class{constructor(){this.rigidBody1=null,this.rigidBody2=null,this.localAnchor1=new a.common.Vec3,this.localAnchor2=new a.common.Vec3,this.allowCollision=!1,this.solverType=a.common.Setting.defaultJointConstraintSolverType,this.positionCorrectionAlgorithm=a.common.Setting.defaultJointPositionCorrectionAlgorithm,this.breakForce=0,this.breakTorque=0}_init(t,i,s){this.rigidBody1=t,this.rigidBody2=i;let a,o,n,e,r,_,l=this.rigidBody1,h=this.localAnchor1;a=s.x,o=s.y,n=s.z,a-=l._transform._positionX,o-=l._transform._positionY,n-=l._transform._positionZ,e=l._transform._rotation00*a+l._transform._rotation10*o+l._transform._rotation20*n,r=l._transform._rotation01*a+l._transform._rotation11*o+l._transform._rotation21*n,_=l._transform._rotation02*a+l._transform._rotation12*o+l._transform._rotation22*n,a=e,o=r,n=_,h.x=a,h.y=o,h.z=n;let c,m,b,p,x,f,u=this.rigidBody2,y=this.localAnchor2;c=s.x,m=s.y,b=s.z,c-=u._transform._positionX,m-=u._transform._positionY,b-=u._transform._positionZ,p=u._transform._rotation00*c+u._transform._rotation10*m+u._transform._rotation20*b,x=u._transform._rotation01*c+u._transform._rotation11*m+u._transform._rotation21*b,f=u._transform._rotation02*c+u._transform._rotation12*m+u._transform._rotation22*b,c=p,m=x,b=f,y.x=c,y.y=m,y.z=b}},a.dynamics.constraint.joint.CylindricalJointConfig=class extends a.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new a.common.Vec3(1,0,0),this.localAxis2=new a.common.Vec3(1,0,0),this.translationalLimitMotor=new a.dynamics.constraint.joint.TranslationalLimitMotor,this.translationalSpringDamper=new a.dynamics.constraint.joint.SpringDamper,this.rotationalLimitMotor=new a.dynamics.constraint.joint.RotationalLimitMotor,this.rotationalSpringDamper=new a.dynamics.constraint.joint.SpringDamper}init(t,i,s,a){this._init(t,i,s);let o,n,e,r,_,l,h=this.localAxis1;o=a.x,n=a.y,e=a.z,r=t._transform._rotation00*o+t._transform._rotation10*n+t._transform._rotation20*e,_=t._transform._rotation01*o+t._transform._rotation11*n+t._transform._rotation21*e,l=t._transform._rotation02*o+t._transform._rotation12*n+t._transform._rotation22*e,o=r,n=_,e=l,h.x=o,h.y=n,h.z=e;let c,m,b,p,x,f,u=this.localAxis2;return c=a.x,m=a.y,b=a.z,p=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*b,x=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*b,f=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*b,c=p,m=x,b=f,u.x=c,u.y=m,u.z=b,this}},a.dynamics.constraint.joint.GenericJoint=class extends a.dynamics.constraint.joint.Joint{constructor(t){let i;super(t,a.dynamics.constraint.joint.JointType.GENERIC);let s,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d=t.localBasis1;if(d.e00*(d.e11*d.e22-d.e12*d.e21)-d.e01*(d.e10*d.e22-d.e12*d.e20)+d.e02*(d.e10*d.e21-d.e11*d.e20)<0)i=!0;else{let s=t.localBasis2;i=s.e00*(s.e11*s.e22-s.e12*s.e21)-s.e01*(s.e10*s.e22-s.e12*s.e20)+s.e02*(s.e10*s.e21-s.e11*s.e20)<0}i&&console.log("src/oimo/dynamics/constraint/joint/GenericJoint.hx:50:","[warning] joint basis must be right handed");let X=t.localBasis1;s=X.e00,o=X.e01,n=X.e02,e=X.e10,r=X.e11,_=X.e12,l=X.e20,h=X.e21,c=X.e22;let z=t.localBasis2;m=z.e00,b=z.e01,p=z.e02,x=z.e10,f=z.e11,u=z.e12,y=z.e20,g=z.e21,v=z.e22,this._localBasisX1X=s,this._localBasisX1Y=e,this._localBasisX1Z=l,this._localBasisY1X=o,this._localBasisY1Y=r,this._localBasisY1Z=h,this._localBasisZ1X=n,this._localBasisZ1Y=_,this._localBasisZ1Z=c,this._localBasisX2X=m,this._localBasisX2Y=x,this._localBasisX2Z=y,this._localBasisY2X=b,this._localBasisY2Y=f,this._localBasisY2Z=g,this._localBasisZ2X=p,this._localBasisZ2Y=u,this._localBasisZ2Z=v,this._angleX=0,this._angleY=0,this._angleZ=0,this.translationX=0,this.translationY=0,this.translationZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._translLms=new Array(3),this._translSds=new Array(3),this._rotLms=new Array(3),this._rotSds=new Array(3),this._translLms[0]=t.translationalLimitMotors[0].clone(),this._translLms[1]=t.translationalLimitMotors[1].clone(),this._translLms[2]=t.translationalLimitMotors[2].clone(),this._translSds[0]=t.translationalSpringDampers[0].clone(),this._translSds[1]=t.translationalSpringDampers[1].clone(),this._translSds[2]=t.translationalSpringDampers[2].clone(),this._rotLms[0]=t.rotationalLimitMotors[0].clone(),this._rotLms[1]=t.rotationalLimitMotors[1].clone(),this._rotLms[2]=t.rotationalLimitMotors[2].clone(),this._rotSds[0]=t.rotationalSpringDampers[0].clone(),this._rotSds[1]=t.rotationalSpringDampers[1].clone(),this._rotSds[2]=t.rotationalSpringDampers[2].clone()}getInfo(t,i,s){let a,o=1/(this._b1._invMass+this._b2._invMass),n=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),e=this.computeEffectiveInertiaMoment(this._axisYX,this._axisYY,this._axisYZ),r=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ);if(this._translSds[0].frequency<=0||!s){let n=this._impulses[0],e=t.rows[t.numRows++],r=e.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,e.rhs=0,e.cfm=0,e.minImpulse=0,e.maxImpulse=0,e.motorSpeed=0,e.motorMaxImpulse=0,e.impulse=null,e.impulse=n,this.setSolverInfoRowLinear(e,this.translationX,this._translLms[0],o,this._translSds[0],i,s),a=e.jacobian,a.lin1X=this._basisX1X,a.lin1Y=this._basisX1Y,a.lin1Z=this._basisX1Z,a.lin2X=this._basisX1X,a.lin2Y=this._basisX1Y,a.lin2Z=this._basisX1Z,a.ang1X=this._relativeAnchor1Y*this._basisX1Z-this._relativeAnchor1Z*this._basisX1Y,a.ang1Y=this._relativeAnchor1Z*this._basisX1X-this._relativeAnchor1X*this._basisX1Z,a.ang1Z=this._relativeAnchor1X*this._basisX1Y-this._relativeAnchor1Y*this._basisX1X,a.ang2X=this._relativeAnchor2Y*this._basisX1Z-this._relativeAnchor2Z*this._basisX1Y,a.ang2Y=this._relativeAnchor2Z*this._basisX1X-this._relativeAnchor2X*this._basisX1Z,a.ang2Z=this._relativeAnchor2X*this._basisX1Y-this._relativeAnchor2Y*this._basisX1X}if(this._translSds[1].frequency<=0||!s){let n=this._impulses[1],e=t.rows[t.numRows++],r=e.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,e.rhs=0,e.cfm=0,e.minImpulse=0,e.maxImpulse=0,e.motorSpeed=0,e.motorMaxImpulse=0,e.impulse=null,e.impulse=n,this.setSolverInfoRowLinear(e,this.translationY,this._translLms[1],o,this._translSds[1],i,s),a=e.jacobian,a.lin1X=this._basisY1X,a.lin1Y=this._basisY1Y,a.lin1Z=this._basisY1Z,a.lin2X=this._basisY1X,a.lin2Y=this._basisY1Y,a.lin2Z=this._basisY1Z,a.ang1X=this._relativeAnchor1Y*this._basisY1Z-this._relativeAnchor1Z*this._basisY1Y,a.ang1Y=this._relativeAnchor1Z*this._basisY1X-this._relativeAnchor1X*this._basisY1Z,a.ang1Z=this._relativeAnchor1X*this._basisY1Y-this._relativeAnchor1Y*this._basisY1X,a.ang2X=this._relativeAnchor2Y*this._basisY1Z-this._relativeAnchor2Z*this._basisY1Y,a.ang2Y=this._relativeAnchor2Z*this._basisY1X-this._relativeAnchor2X*this._basisY1Z,a.ang2Z=this._relativeAnchor2X*this._basisY1Y-this._relativeAnchor2Y*this._basisY1X}if(this._translSds[2].frequency<=0||!s){let n=this._impulses[2],e=t.rows[t.numRows++],r=e.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,e.rhs=0,e.cfm=0,e.minImpulse=0,e.maxImpulse=0,e.motorSpeed=0,e.motorMaxImpulse=0,e.impulse=null,e.impulse=n,this.setSolverInfoRowLinear(e,this.translationZ,this._translLms[2],o,this._translSds[2],i,s),a=e.jacobian,a.lin1X=this._basisZ1X,a.lin1Y=this._basisZ1Y,a.lin1Z=this._basisZ1Z,a.lin2X=this._basisZ1X,a.lin2Y=this._basisZ1Y,a.lin2Z=this._basisZ1Z,a.ang1X=this._relativeAnchor1Y*this._basisZ1Z-this._relativeAnchor1Z*this._basisZ1Y,a.ang1Y=this._relativeAnchor1Z*this._basisZ1X-this._relativeAnchor1X*this._basisZ1Z,a.ang1Z=this._relativeAnchor1X*this._basisZ1Y-this._relativeAnchor1Y*this._basisZ1X,a.ang2X=this._relativeAnchor2Y*this._basisZ1Z-this._relativeAnchor2Z*this._basisZ1Y,a.ang2Y=this._relativeAnchor2Z*this._basisZ1X-this._relativeAnchor2X*this._basisZ1Z,a.ang2Z=this._relativeAnchor2X*this._basisZ1Y-this._relativeAnchor2Y*this._basisZ1X}if(!this.xSingular&&(this._rotSds[0].frequency<=0||!s)){let o=this._impulses[3],e=t.rows[t.numRows++],r=e.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,e.rhs=0,e.cfm=0,e.minImpulse=0,e.maxImpulse=0,e.motorSpeed=0,e.motorMaxImpulse=0,e.impulse=null,e.impulse=o,this.setSolverInfoRowAngular(e,this._angleX,this._rotLms[0],n,this._rotSds[0],i,s),a=e.jacobian,a.ang1X=this._axisXX,a.ang1Y=this._axisXY,a.ang1Z=this._axisXZ,a.ang2X=this._axisXX,a.ang2Y=this._axisXY,a.ang2Z=this._axisXZ}if(!this.ySingular&&(this._rotSds[1].frequency<=0||!s)){let o=this._impulses[4],n=t.rows[t.numRows++],r=n.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,n.rhs=0,n.cfm=0,n.minImpulse=0,n.maxImpulse=0,n.motorSpeed=0,n.motorMaxImpulse=0,n.impulse=null,n.impulse=o,this.setSolverInfoRowAngular(n,this._angleY,this._rotLms[1],e,this._rotSds[1],i,s),a=n.jacobian,a.ang1X=this._axisYX,a.ang1Y=this._axisYY,a.ang1Z=this._axisYZ,a.ang2X=this._axisYX,a.ang2Y=this._axisYY,a.ang2Z=this._axisYZ}if(!this.zSingular&&(this._rotSds[2].frequency<=0||!s)){let o=this._impulses[5],n=t.rows[t.numRows++],e=n.jacobian;e.lin1X=0,e.lin1Y=0,e.lin1Z=0,e.lin2X=0,e.lin2Y=0,e.lin2Z=0,e.ang1X=0,e.ang1Y=0,e.ang1Z=0,e.ang2X=0,e.ang2Y=0,e.ang2Z=0,n.rhs=0,n.cfm=0,n.minImpulse=0,n.maxImpulse=0,n.motorSpeed=0,n.motorMaxImpulse=0,n.impulse=null,n.impulse=o,this.setSolverInfoRowAngular(n,this._angleZ,this._rotLms[2],r,this._rotSds[2],i,s),a=n.jacobian,a.ang1X=this._axisZX,a.ang1Y=this._axisZY,a.ang1Z=this._axisZZ,a.ang2X=this._axisZX,a.ang2Y=this._axisZY,a.ang2Z=this._axisZZ}}_syncAnchors(){let t,i,s,a,o,n,e,r,_;super._syncAnchors(),t=this._basisX1X,i=this._basisX1Y,s=this._basisX1Z,e=this._basisZ2X,r=this._basisZ2Y,_=this._basisZ2Z,a=r*s-_*i,o=_*t-e*s,n=e*i-r*t,this._axisXX=o*_-n*r,this._axisXY=n*e-a*_,this._axisXZ=a*r-o*e,this._axisYX=a,this._axisYY=o,this._axisYZ=n,this._axisZX=i*n-s*o,this._axisZY=s*a-t*n,this._axisZZ=t*o-i*a;let l=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;l>0&&(l=1/Math.sqrt(l)),this._axisXX*=l,this._axisXY*=l,this._axisXZ*=l;let h=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;h>0&&(h=1/Math.sqrt(h)),this._axisYX*=h,this._axisYY*=h,this._axisYZ*=h;let c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,q,E,D,N,F,W,J=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;J>0&&(J=1/Math.sqrt(J)),this._axisZX*=J,this._axisZY*=J,this._axisZZ*=J,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0,c=this._basisX1X,m=this._basisY1X,b=this._basisZ1X,p=this._basisX1Y,x=this._basisY1Y,f=this._basisZ1Y,u=this._basisX1Z,y=this._basisY1Z,g=this._basisZ1Z,v=this._basisX2X,d=this._basisY2X,X=this._basisZ2X,z=this._basisX2Y,Y=this._basisY2Y,Z=this._basisZ2Y,M=this._basisX2Z,I=this._basisY2Z,V=this._basisZ2Z,T=c*v+p*z+u*M,C=c*d+p*Y+u*I,j=c*X+p*Z+u*V,R=m*d+x*Y+y*I,q=m*X+x*Z+y*V,E=b*d+f*Y+g*I,D=b*X+f*Z+g*V,w=T,L=C,k=j,A=R,B=q,P=E,S=D;let G,O,U,H=k;if(H<=-1){let t=Math.atan2(P,A);N=.5*t,F=-1.570796326794895,W=.5*-t}else if(H>=1){let t=Math.atan2(P,A);N=.5*t,F=1.570796326794895,W=.5*t}else N=Math.atan2(-B,S),F=Math.asin(H),W=Math.atan2(-L,w);this._angleX=N,this._angleY=F,this._angleZ=W,G=this._anchor2X-this._anchor1X,O=this._anchor2Y-this._anchor1Y,U=this._anchor2Z-this._anchor1Z,this.translationX=G*this._basisX1X+O*this._basisX1Y+U*this._basisX1Z,this.translationY=G*this._basisY1X+O*this._basisY1Y+U*this._basisY1Z,this.translationZ=G*this._basisZ1X+O*this._basisZ1Y+U*this._basisZ1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxisX(){let t=new a.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxisY(){let t=new a.common.Vec3;return t.x=this._axisYX,t.y=this._axisYY,t.z=this._axisYZ,t}getAxisZ(){let t=new a.common.Vec3;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,t}getTranslationalSpringDampers(){return this._translSds.slice(0)}getRotationalSpringDampers(){return this._rotSds.slice(0)}getTranslationalLimitMotors(){return this._translLms.slice(0)}getRotationalLimitMotors(){return this._rotLms.slice(0)}getAngles(){return new a.common.Vec3(this._angleX,this._angleY,this._angleZ)}getTranslations(){return new a.common.Vec3(this.translationX,this.translationY,this.translationZ)}},a.dynamics.constraint.joint.GenericJointConfig=class extends a.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localBasis1=new a.common.Mat3,this.localBasis2=new a.common.Mat3;let t=[];t.push((new a.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),t.push((new a.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),t.push((new a.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),this.translationalLimitMotors=t;let i=[];i.push((new a.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),i.push((new a.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),i.push((new a.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),this.rotationalLimitMotors=i,this.translationalSpringDampers=[new a.dynamics.constraint.joint.SpringDamper,new a.dynamics.constraint.joint.SpringDamper,new a.dynamics.constraint.joint.SpringDamper],this.rotationalSpringDampers=[new a.dynamics.constraint.joint.SpringDamper,new a.dynamics.constraint.joint.SpringDamper,new a.dynamics.constraint.joint.SpringDamper]}init(t,i,s,a,o){this._init(t,i,s);let n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,q,E,D,N,F,W,J,G,O,U,H,Q,K,$,tt,it,st,at,ot,nt=t._transform,et=i._transform;n=a.e00,e=a.e01,r=a.e02,_=a.e10,l=a.e11,h=a.e12,c=a.e20,m=a.e21,b=a.e22,p=o.e00,x=o.e01,f=o.e02,u=o.e10,y=o.e11,g=o.e12,v=o.e20,d=o.e21,X=o.e22,E=nt._rotation00*n+nt._rotation10*_+nt._rotation20*c,D=nt._rotation00*e+nt._rotation10*l+nt._rotation20*m,N=nt._rotation00*r+nt._rotation10*h+nt._rotation20*b,F=nt._rotation01*n+nt._rotation11*_+nt._rotation21*c,W=nt._rotation01*e+nt._rotation11*l+nt._rotation21*m,J=nt._rotation01*r+nt._rotation11*h+nt._rotation21*b,G=nt._rotation02*n+nt._rotation12*_+nt._rotation22*c,O=nt._rotation02*e+nt._rotation12*l+nt._rotation22*m,U=nt._rotation02*r+nt._rotation12*h+nt._rotation22*b,z=E,Y=D,Z=N,M=F,I=W,V=J,w=G,L=O,k=U,H=et._rotation00*p+et._rotation10*u+et._rotation20*v,Q=et._rotation00*x+et._rotation10*y+et._rotation20*d,K=et._rotation00*f+et._rotation10*g+et._rotation20*X,$=et._rotation01*p+et._rotation11*u+et._rotation21*v,tt=et._rotation01*x+et._rotation11*y+et._rotation21*d,it=et._rotation01*f+et._rotation11*g+et._rotation21*X,st=et._rotation02*p+et._rotation12*u+et._rotation22*v,at=et._rotation02*x+et._rotation12*y+et._rotation22*d,ot=et._rotation02*f+et._rotation12*g+et._rotation22*X,A=H,B=Q,P=K,S=$,T=tt,C=it,j=st,R=at,q=ot;let rt=this.localBasis1;rt.e00=z,rt.e01=Y,rt.e02=Z,rt.e10=M,rt.e11=I,rt.e12=V,rt.e20=w,rt.e21=L,rt.e22=k;let _t=this.localBasis2;return _t.e00=A,_t.e01=B,_t.e02=P,_t.e10=S,_t.e11=T,_t.e12=C,_t.e20=j,_t.e21=R,_t.e22=q,this}},a.dynamics.constraint.joint.JointImpulse=class{constructor(){this.impulse=0,this.impulseM=0,this.impulseP=0}},a.dynamics.constraint.joint.JointLink=class{constructor(t){this._joint=t}getContact(){return this._joint}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}},a.dynamics.constraint.joint.JointMacro=class{},a.dynamics.constraint.joint.JointType=class{},a.dynamics.constraint.joint.PrismaticJoint=class extends a.dynamics.constraint.joint.Joint{constructor(t){super(t,a.dynamics.constraint.joint.JointType.PRISMATIC);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localAxis2;this._localBasisX2X=s.x,this._localBasisX2Y=s.y,this._localBasisX2Z=s.z,this.buildLocalBasesFromX(),this._basis=new a.dynamics.constraint.joint.BasisTracker(this),this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this.angularErrorX=0,this.angularErrorY=0,this.angularErrorZ=0,this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()}getInfo(t,i,s){let a,o=this.getErp(i,s),n=this.linearErrorY*o,e=this.linearErrorZ*o,r=this.angularErrorX*o,_=this.angularErrorY*o,l=this.angularErrorZ*o;if(this._sd.frequency<=0||!s){let o=this._impulses[0],n=t.rows[t.numRows++],e=n.jacobian;e.lin1X=0,e.lin1Y=0,e.lin1Z=0,e.lin2X=0,e.lin2Y=0,e.lin2Z=0,e.ang1X=0,e.ang1Y=0,e.ang1Z=0,e.ang2X=0,e.ang2Y=0,e.ang2Z=0,n.rhs=0,n.cfm=0,n.minImpulse=0,n.maxImpulse=0,n.motorSpeed=0,n.motorMaxImpulse=0,n.impulse=null,n.impulse=o,this.setSolverInfoRowLinear(n,this.translation,this._lm,1/(this._b1._invMass+this._b2._invMass),this._sd,i,s),a=n.jacobian,a.lin1X=this._basis.xX,a.lin1Y=this._basis.xY,a.lin1Z=this._basis.xZ,a.lin2X=this._basis.xX,a.lin2Y=this._basis.xY,a.lin2Z=this._basis.xZ,a.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,a.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,a.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,a.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,a.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,a.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}let h=this._impulses[1],c=t.rows[t.numRows++],m=c.jacobian;m.lin1X=0,m.lin1Y=0,m.lin1Z=0,m.lin2X=0,m.lin2Y=0,m.lin2Z=0,m.ang1X=0,m.ang1Y=0,m.ang1Z=0,m.ang2X=0,m.ang2Y=0,m.ang2Z=0,c.rhs=0,c.cfm=0,c.minImpulse=0,c.maxImpulse=0,c.motorSpeed=0,c.motorMaxImpulse=0,c.impulse=null,c.impulse=h,c.rhs=n,c.cfm=0,c.minImpulse=-1/0,c.maxImpulse=Infinity,a=c.jacobian,a.lin1X=this._basis.yX,a.lin1Y=this._basis.yY,a.lin1Z=this._basis.yZ,a.lin2X=this._basis.yX,a.lin2Y=this._basis.yY,a.lin2Z=this._basis.yZ,a.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,a.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,a.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,a.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,a.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,a.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;let b=this._impulses[2],p=t.rows[t.numRows++],x=p.jacobian;x.lin1X=0,x.lin1Y=0,x.lin1Z=0,x.lin2X=0,x.lin2Y=0,x.lin2Z=0,x.ang1X=0,x.ang1Y=0,x.ang1Z=0,x.ang2X=0,x.ang2Y=0,x.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=b,p.rhs=e,p.cfm=0,p.minImpulse=-1/0,p.maxImpulse=Infinity,a=p.jacobian,a.lin1X=this._basis.zX,a.lin1Y=this._basis.zY,a.lin1Z=this._basis.zZ,a.lin2X=this._basis.zX,a.lin2Y=this._basis.zY,a.lin2Z=this._basis.zZ,a.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,a.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,a.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,a.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,a.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,a.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX;let f=this._impulses[3],u=t.rows[t.numRows++],y=u.jacobian;y.lin1X=0,y.lin1Y=0,y.lin1Z=0,y.lin2X=0,y.lin2Y=0,y.lin2Z=0,y.ang1X=0,y.ang1Y=0,y.ang1Z=0,y.ang2X=0,y.ang2Y=0,y.ang2Z=0,u.rhs=0,u.cfm=0,u.minImpulse=0,u.maxImpulse=0,u.motorSpeed=0,u.motorMaxImpulse=0,u.impulse=null,u.impulse=f,u.rhs=r,u.cfm=0,u.minImpulse=-1/0,u.maxImpulse=Infinity,a=u.jacobian,a.ang1X=1,a.ang1Y=0,a.ang1Z=0,a.ang2X=1,a.ang2Y=0,a.ang2Z=0;let g=this._impulses[4],v=t.rows[t.numRows++],d=v.jacobian;d.lin1X=0,d.lin1Y=0,d.lin1Z=0,d.lin2X=0,d.lin2Y=0,d.lin2Z=0,d.ang1X=0,d.ang1Y=0,d.ang1Z=0,d.ang2X=0,d.ang2Y=0,d.ang2Z=0,v.rhs=0,v.cfm=0,v.minImpulse=0,v.maxImpulse=0,v.motorSpeed=0,v.motorMaxImpulse=0,v.impulse=null,v.impulse=g,v.rhs=_,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=Infinity,a=v.jacobian,a.ang1X=0,a.ang1Y=1,a.ang1Z=0,a.ang2X=0,a.ang2Y=1,a.ang2Z=0;let X=this._impulses[5],z=t.rows[t.numRows++],Y=z.jacobian;Y.lin1X=0,Y.lin1Y=0,Y.lin1Z=0,Y.lin2X=0,Y.lin2Y=0,Y.lin2Z=0,Y.ang1X=0,Y.ang1Y=0,Y.ang1Z=0,Y.ang2X=0,Y.ang2Y=0,Y.ang2Z=0,z.rhs=0,z.cfm=0,z.minImpulse=0,z.maxImpulse=0,z.motorSpeed=0,z.motorMaxImpulse=0,z.impulse=null,z.impulse=X,z.rhs=l,z.cfm=0,z.minImpulse=-1/0,z.maxImpulse=Infinity,a=z.jacobian,a.ang1X=0,a.ang1Y=0,a.ang1Z=1,a.ang2X=0,a.ang2Y=0,a.ang2Z=1}_syncAnchors(){super._syncAnchors();let t,i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,q,E,D,N,F=this._basis,W=F.joint._b1._invMass,J=F.joint._b2._invMass,G=F.joint._basisX1X*F.joint._basisX2X+F.joint._basisX1Y*F.joint._basisX2Y+F.joint._basisX1Z*F.joint._basisX2Z;if(G<-.999999999){let o,n,e,r,_=F.joint._basisX1X,l=F.joint._basisX1Y,h=F.joint._basisX1Z,c=_*_,m=l*l,b=h*h;c<m?c<b?(r=1/Math.sqrt(m+b),o=0,n=h*r,e=-l*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),o=-h*r,n=0,e=_*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0),t=o,i=n,s=e,a=0}else{let o,n,e;o=F.joint._basisX1Y*F.joint._basisX2Z-F.joint._basisX1Z*F.joint._basisX2Y,n=F.joint._basisX1Z*F.joint._basisX2X-F.joint._basisX1X*F.joint._basisX2Z,e=F.joint._basisX1X*F.joint._basisX2Y-F.joint._basisX1Y*F.joint._basisX2X;let r=Math.sqrt(.5*(1+G));G=.5/r,o*=G,n*=G,e*=G,t=o,i=n,s=e,a=r}o=0,n=0,e=0,r=1,T=0,C=0,j=0,R=1,q=t,E=i,D=s,N=a;let O=T*q+C*E+j*D+R*N;if(O<0&&(O=-O,q=-q,E=-E,D=-D,N=-N),O>.999999){let t,i,s,a;t=q-T,i=E-C,s=D-j,a=N-R,q=T+t*(W/(W+J)),E=C+i*(W/(W+J)),D=j+s*(W/(W+J)),N=R+a*(W/(W+J));let o=q*q+E*E+D*D+N*N;o>1e-32&&(o=1/Math.sqrt(o)),_=q*o,l=E*o,h=D*o,c=N*o}else{let t=W/(W+J)*Math.acos(O);q+=T*-O,E+=C*-O,D+=j*-O,N+=R*-O;let i=q*q+E*E+D*D+N*N;i>1e-32&&(i=1/Math.sqrt(i)),q*=i,E*=i,D*=i,N*=i;let s=Math.sin(t),a=Math.cos(t);T*=a,C*=a,j*=a,R*=a,_=T+q*s,l=C+E*s,h=j+D*s,c=R+N*s}let U,H,Q,K=2*_,$=2*l,tt=2*h,it=_*K,st=l*$,at=h*tt,ot=_*$,nt=l*tt,et=_*tt,rt=c*K,_t=c*$,lt=c*tt;m=1-st-at,b=ot-lt,p=et+_t,x=ot+lt,f=1-it-at,u=nt-rt,y=et-_t,g=nt+rt,v=1-it-st,U=m*F.joint._basisX1X+b*F.joint._basisX1Y+p*F.joint._basisX1Z,H=x*F.joint._basisX1X+f*F.joint._basisX1Y+u*F.joint._basisX1Z,Q=y*F.joint._basisX1X+g*F.joint._basisX1Y+v*F.joint._basisX1Z,d=U,X=H,z=Q,L=F.xX,k=F.xY,A=F.xZ,B=F.yX,P=F.yY,S=F.yZ;let ht=L*d+k*X+A*z;if(ht<-.999999999){let t,i,s,a,o=L,n=k,e=A,r=o*o,m=n*n,b=e*e;r<m?r<b?(a=1/Math.sqrt(m+b),t=0,i=e*a,s=-n*a):(a=1/Math.sqrt(r+m),t=n*a,i=-o*a,s=0):m<b?(a=1/Math.sqrt(b+r),t=-e*a,i=0,s=o*a):(a=1/Math.sqrt(r+m),t=n*a,i=-o*a,s=0),_=t,l=i,h=s,c=0}else{let t,i,s;t=k*z-A*X,i=A*d-L*z,s=L*X-k*d;let a=Math.sqrt(.5*(1+ht));ht=.5/a,t*=ht,i*=ht,s*=ht,_=t,l=i,h=s,c=a}let ct,mt,bt,pt,xt,ft,ut,yt,gt,vt,dt,Xt,zt,Yt,Zt,Mt,It,Vt,wt,Lt,kt,At,Bt,Pt,St,Tt,Ct,jt,Rt,qt,Et,Dt,Nt,Ft,Wt,Jt,Gt,Ot,Ut,Ht,Qt,Kt,$t,ti=2*_,ii=2*l,si=2*h,ai=_*ti,oi=l*ii,ni=h*si,ei=_*ii,ri=l*si,_i=_*si,li=c*ti,hi=c*ii,ci=c*si;if(m=1-oi-ni,b=ei-ci,p=_i+hi,x=ei+ci,f=1-ai-ni,u=ri-li,y=_i-hi,g=ri+li,v=1-ai-oi,ct=m*B+b*P+p*S,mt=x*B+f*P+u*S,bt=y*B+g*P+v*S,Y=ct,Z=mt,M=bt,I=X*M-z*Z,V=z*Y-d*M,w=d*Z-X*Y,I*I+V*V+w*w>1e-6){let t=I*I+V*V+w*w;t>0&&(t=1/Math.sqrt(t)),I*=t,V*=t,w*=t}else{let t,i=d,s=X,a=z,o=i*i,n=s*s,e=a*a;o<n?o<e?(t=1/Math.sqrt(n+e),I=0,V=a*t,w=-s*t):(t=1/Math.sqrt(o+n),I=s*t,V=-i*t,w=0):n<e?(t=1/Math.sqrt(e+o),I=-a*t,V=0,w=i*t):(t=1/Math.sqrt(o+n),I=s*t,V=-i*t,w=0)}Y=V*z-w*X,Z=w*d-I*z,M=I*X-V*d,F.xX=d,F.xY=X,F.xZ=z,F.yX=Y,F.yY=Z,F.yZ=M,F.zX=I,F.zY=V,F.zZ=w,pt=this._basisX1X,xt=this._basisY1X,ft=this._basisZ1X,ut=this._basisX1Y,yt=this._basisY1Y,gt=this._basisZ1Y,vt=this._basisX1Z,dt=this._basisY1Z,Xt=this._basisZ1Z,zt=this._basisX2X,Yt=this._basisY2X,Zt=this._basisZ2X,Mt=this._basisX2Y,It=this._basisY2Y,Vt=this._basisZ2Y,wt=this._basisX2Z,Lt=this._basisY2Z,kt=this._basisZ2Z,Et=zt*pt+Yt*xt+Zt*ft,Dt=zt*ut+Yt*yt+Zt*gt,Nt=zt*vt+Yt*dt+Zt*Xt,Ft=Mt*pt+It*xt+Vt*ft,Wt=Mt*ut+It*yt+Vt*gt,Jt=Mt*vt+It*dt+Vt*Xt,Gt=wt*pt+Lt*xt+kt*ft,Ot=wt*ut+Lt*yt+kt*gt,Ut=wt*vt+Lt*dt+kt*Xt,At=Et,Bt=Dt,Pt=Nt,St=Ft,Tt=Wt,Ct=Jt,jt=Gt,Rt=Ot,qt=Ut;let mi,bi=At,pi=Tt,xi=qt,fi=bi+pi+xi;fi>0?(mi=Math.sqrt(fi+1),$t=.5*mi,mi=.5/mi,Ht=(Rt-Ct)*mi,Qt=(Pt-jt)*mi,Kt=(St-Bt)*mi):bi>pi?bi>xi?(mi=Math.sqrt(bi-pi-xi+1),Ht=.5*mi,mi=.5/mi,Qt=(Bt+St)*mi,Kt=(Pt+jt)*mi,$t=(Rt-Ct)*mi):(mi=Math.sqrt(xi-bi-pi+1),Kt=.5*mi,mi=.5/mi,Ht=(Pt+jt)*mi,Qt=(Ct+Rt)*mi,$t=(St-Bt)*mi):pi>xi?(mi=Math.sqrt(pi-xi-bi+1),Qt=.5*mi,mi=.5/mi,Ht=(Bt+St)*mi,Kt=(Ct+Rt)*mi,$t=(Pt-jt)*mi):(mi=Math.sqrt(xi-bi-pi+1),Kt=.5*mi,mi=.5/mi,Ht=(Pt+jt)*mi,Qt=(Ct+Rt)*mi,$t=(St-Bt)*mi);let ui=$t,yi=2*(ui<=-1?3.14159265358979:ui>=1?0:Math.acos(ui));this.angularErrorX=Ht,this.angularErrorY=Qt,this.angularErrorZ=Kt;let gi,vi,di,Xi=this.angularErrorX*this.angularErrorX+this.angularErrorY*this.angularErrorY+this.angularErrorZ*this.angularErrorZ;Xi>0&&(Xi=1/Math.sqrt(Xi)),this.angularErrorX*=Xi,this.angularErrorY*=Xi,this.angularErrorZ*=Xi,this.angularErrorX*=yi,this.angularErrorY*=yi,this.angularErrorZ*=yi,gi=this._anchor2X-this._anchor1X,vi=this._anchor2Y-this._anchor1Y,di=this._anchor2Z-this._anchor1Z,this.translation=gi*this._basis.xX+vi*this._basis.xY+di*this._basis.xZ,this.linearErrorY=gi*this._basis.yX+vi*this._basis.yY+di*this._basis.yZ,this.linearErrorZ=gi*this._basis.zX+vi*this._basis.zY+di*this._basis.zZ}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new a.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new a.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new a.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new a.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getTranslation(){return this.translation}},a.dynamics.constraint.joint.PrismaticJointConfig=class extends a.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new a.common.Vec3(1,0,0),this.localAxis2=new a.common.Vec3(1,0,0),this.limitMotor=new a.dynamics.constraint.joint.TranslationalLimitMotor,this.springDamper=new a.dynamics.constraint.joint.SpringDamper}init(t,i,s,a){this._init(t,i,s);let o,n,e,r,_,l,h=this.localAxis1;o=a.x,n=a.y,e=a.z,r=t._transform._rotation00*o+t._transform._rotation10*n+t._transform._rotation20*e,_=t._transform._rotation01*o+t._transform._rotation11*n+t._transform._rotation21*e,l=t._transform._rotation02*o+t._transform._rotation12*n+t._transform._rotation22*e,o=r,n=_,e=l,h.x=o,h.y=n,h.z=e;let c,m,b,p,x,f,u=this.localAxis2;return c=a.x,m=a.y,b=a.z,p=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*b,x=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*b,f=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*b,c=p,m=x,b=f,u.x=c,u.y=m,u.z=b,this}},a.dynamics.constraint.joint.RagdollJoint=class extends a.dynamics.constraint.joint.Joint{constructor(t){super(t,a.dynamics.constraint.joint.JointType.RAGDOLL);let i=t.localTwistAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localSwingAxis1;this._localBasisY1X=s.x,this._localBasisY1Y=s.y,this._localBasisY1Z=s.z;let o=t.localTwistAxis2;this._localBasisX2X=o.x,this._localBasisX2Y=o.y,this._localBasisX2Z=o.z,this.buildLocalBasesFromXY1X2(),this._twistSd=t.twistSpringDamper.clone(),this._twistLm=t.twistLimitMotor.clone(),this._swingSd=t.swingSpringDamper.clone(),this._maxSwingAngle1=t.maxSwingAngle1,this._maxSwingAngle2=t.maxSwingAngle2,this._maxSwingAngle1<a.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle1=a.common.Setting.minRagdollMaxSwingAngle),this._maxSwingAngle2<a.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle2=a.common.Setting.minRagdollMaxSwingAngle),this.dummySwingLm=new a.dynamics.constraint.joint.RotationalLimitMotor,this.dummySwingLm.lowerLimit=-1,this.dummySwingLm.upperLimit=0,this._swingAngle=0,this._twistAngle=0,this.swingError=0,this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.twistAxisX=0,this.twistAxisY=0,this.twistAxisZ=0}getInfo(t,i,s){let a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y=this.getErp(i,s);a=this.linearErrorX*Y,o=this.linearErrorY*Y,n=this.linearErrorZ*Y,e=0,r=-this._relativeAnchor1Z,_=this._relativeAnchor1Y,l=this._relativeAnchor1Z,h=0,c=-this._relativeAnchor1X,m=-this._relativeAnchor1Y,b=this._relativeAnchor1X,p=0,x=0,f=-this._relativeAnchor2Z,u=this._relativeAnchor2Y,y=this._relativeAnchor2Z,g=0,v=-this._relativeAnchor2X,d=-this._relativeAnchor2Y,X=this._relativeAnchor2X,z=0,e=-e,r=-r,_=-_,l=-l,h=-h,c=-c,m=-m,b=-b,p=-p,x=-x,f=-f,u=-u,y=-y,g=-g,v=-v,d=-d,X=-X,z=-z;let Z=this.computeEffectiveInertiaMoment(this.swingAxisX,this.swingAxisY,this.swingAxisZ),M=this.computeEffectiveInertiaMoment(this._basisX2X,this._basisX2Y,this._basisX2Z),I=this._impulses[0],V=t.rows[t.numRows++],w=V.jacobian;w.lin1X=0,w.lin1Y=0,w.lin1Z=0,w.lin2X=0,w.lin2Y=0,w.lin2Z=0,w.ang1X=0,w.ang1Y=0,w.ang1Z=0,w.ang2X=0,w.ang2Y=0,w.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=I,V.rhs=a,V.cfm=0,V.minImpulse=-1/0,V.maxImpulse=Infinity;let L=V.jacobian;L.lin1X=1,L.lin1Y=0,L.lin1Z=0,L.lin2X=1,L.lin2Y=0,L.lin2Z=0,L.ang1X=e,L.ang1Y=r,L.ang1Z=_,L.ang2X=x,L.ang2Y=f,L.ang2Z=u;let k=this._impulses[1],A=t.rows[t.numRows++],B=A.jacobian;B.lin1X=0,B.lin1Y=0,B.lin1Z=0,B.lin2X=0,B.lin2Y=0,B.lin2Z=0,B.ang1X=0,B.ang1Y=0,B.ang1Z=0,B.ang2X=0,B.ang2Y=0,B.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=k,A.rhs=o,A.cfm=0,A.minImpulse=-1/0,A.maxImpulse=Infinity,L=A.jacobian,L.lin1X=0,L.lin1Y=1,L.lin1Z=0,L.lin2X=0,L.lin2Y=1,L.lin2Z=0,L.ang1X=l,L.ang1Y=h,L.ang1Z=c,L.ang2X=y,L.ang2Y=g,L.ang2Z=v;let P=this._impulses[2],S=t.rows[t.numRows++],T=S.jacobian;if(T.lin1X=0,T.lin1Y=0,T.lin1Z=0,T.lin2X=0,T.lin2Y=0,T.lin2Z=0,T.ang1X=0,T.ang1Y=0,T.ang1Z=0,T.ang2X=0,T.ang2Y=0,T.ang2Z=0,S.rhs=0,S.cfm=0,S.minImpulse=0,S.maxImpulse=0,S.motorSpeed=0,S.motorMaxImpulse=0,S.impulse=null,S.impulse=P,S.rhs=n,S.cfm=0,S.minImpulse=-1/0,S.maxImpulse=Infinity,L=S.jacobian,L.lin1X=0,L.lin1Y=0,L.lin1Z=1,L.lin2X=0,L.lin2Y=0,L.lin2Z=1,L.ang1X=m,L.ang1Y=b,L.ang1Z=p,L.ang2X=d,L.ang2Y=X,L.ang2Z=z,this.swingError>0&&(this._swingSd.frequency<=0||!s)){let a=this._impulses[3],o=t.rows[t.numRows++],n=o.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,o.rhs=0,o.cfm=0,o.minImpulse=0,o.maxImpulse=0,o.motorSpeed=0,o.motorMaxImpulse=0,o.impulse=null,o.impulse=a,this.setSolverInfoRowAngular(o,this.swingError,this.dummySwingLm,Z,this._swingSd,i,s),L=o.jacobian,L.ang1X=this.swingAxisX,L.ang1Y=this.swingAxisY,L.ang1Z=this.swingAxisZ,L.ang2X=this.swingAxisX,L.ang2Y=this.swingAxisY,L.ang2Z=this.swingAxisZ}if(this._twistSd.frequency<=0||!s){let a=this._impulses[4],o=t.rows[t.numRows++],n=o.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,o.rhs=0,o.cfm=0,o.minImpulse=0,o.maxImpulse=0,o.motorSpeed=0,o.motorMaxImpulse=0,o.impulse=null,o.impulse=a,this.setSolverInfoRowAngular(o,this._twistAngle,this._twistLm,M,this._twistSd,i,s),L=o.jacobian,L.ang1X=this.twistAxisX,L.ang1Y=this.twistAxisY,L.ang1Z=this.twistAxisZ,L.ang2X=this.twistAxisX,L.ang2Y=this.twistAxisY,L.ang2Z=this.twistAxisZ}}_syncAnchors(){let t,i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L;super._syncAnchors(),t=this._basisX1X,i=this._basisX1Y,s=this._basisX1Z,a=this._basisX2X,o=this._basisX2Y,n=this._basisX2Z,e=this._basisX1X,r=this._basisY1X,_=this._basisZ1X,l=this._basisX1Y,h=this._basisY1Y,c=this._basisZ1Y,m=this._basisX1Z,b=this._basisY1Z,p=this._basisZ1Z;let k=t*a+i*o+s*n;if(k<-.999999999){let a,o,n,e,r=t,_=i,l=s,h=r*r,c=_*_,m=l*l;h<c?h<m?(e=1/Math.sqrt(c+m),a=0,o=l*e,n=-_*e):(e=1/Math.sqrt(h+c),a=_*e,o=-r*e,n=0):c<m?(e=1/Math.sqrt(m+h),a=-l*e,o=0,n=r*e):(e=1/Math.sqrt(h+c),a=_*e,o=-r*e,n=0),x=a,f=o,u=n,y=0}else{let e,r,_;e=i*n-s*o,r=s*a-t*n,_=t*o-i*a;let l=Math.sqrt(.5*(1+k));k=.5/l,e*=k,r*=k,_*=k,x=e,f=r,u=_,y=l}let A,B,P,S,T,C,j=2*x,R=2*f,q=2*u,E=x*j,D=f*R,N=u*q,F=x*R,W=f*q,J=x*q,G=y*j,O=y*R,U=y*q;g=1-D-N,v=F-U,d=J+O,X=F+U,z=1-E-N,Y=W-G,Z=J-O,M=W+G,I=1-E-D,this._swingAngle=2*(y<=-1?3.14159265358979:y>=1?0:Math.acos(y)),V=x,w=f,L=u,S=g*this._basisY2X+X*this._basisY2Y+Z*this._basisY2Z,T=v*this._basisY2X+z*this._basisY2Y+M*this._basisY2Z,C=d*this._basisY2X+Y*this._basisY2Y+I*this._basisY2Z,A=S,B=T,P=C,this._twistAngle=Math.atan2(this._basisZ1X*A+this._basisZ1Y*B+this._basisZ1Z*P,this._basisY1X*A+this._basisY1Y*B+this._basisY1Z*P),this.twistAxisX=this._basisX1X+this._basisX2X,this.twistAxisY=this._basisX1Y+this._basisX2Y,this.twistAxisZ=this._basisX1Z+this._basisX2Z;let H=this.twistAxisX*this.twistAxisX+this.twistAxisY*this.twistAxisY+this.twistAxisZ*this.twistAxisZ;H>0&&(H=1/Math.sqrt(H)),this.twistAxisX*=H,this.twistAxisY*=H,this.twistAxisZ*=H;let Q,K,$,tt=Math.sqrt(V*V+w*w+L*L);tt>0&&(tt=1/tt),V*=tt*this._swingAngle,w*=tt*this._swingAngle,L*=tt*this._swingAngle,Q=e*V+l*w+m*L,K=r*V+h*w+b*L,$=_*V+c*w+p*L,V=Q,w=K,L=$;let it=w,st=L,at=this._maxSwingAngle1,ot=this._maxSwingAngle2,nt=1/(at*at),et=1/(ot*ot),rt=it*it*nt+st*st*et;if(0==rt)this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.swingError=0;else{let t=Math.sqrt(1/rt),i=it*t,s=st*t,a=i*nt,o=s*et;tt=1/Math.sqrt(a*a+o*o),a*=tt,o*=tt;let n=(it-i)*a+(st-s)*o;if(n>0){let t,i,s,x,f,u;this.swingError=n,this.swingAxisX=0,this.swingAxisY=a,this.swingAxisZ=o,t=e*this.swingAxisX+r*this.swingAxisY+_*this.swingAxisZ,i=l*this.swingAxisX+h*this.swingAxisY+c*this.swingAxisZ,s=m*this.swingAxisX+b*this.swingAxisY+p*this.swingAxisZ,this.swingAxisX=t,this.swingAxisY=i,this.swingAxisZ=s,x=g*this.swingAxisX+v*this.swingAxisY+d*this.swingAxisZ,f=X*this.swingAxisX+z*this.swingAxisY+Y*this.swingAxisZ,u=Z*this.swingAxisX+M*this.swingAxisY+I*this.swingAxisZ,this.swingAxisX=x,this.swingAxisY=f,this.swingAxisZ=u}else this.swingError=0}this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new a.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new a.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new a.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new a.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTwistSpringDamper(){return this._twistSd}getTwistLimitMotor(){return this._twistLm}getSwingSpringDamper(){return this._swingSd}getSwingAxis(){let t=new a.common.Vec3;return t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ,t}getSwingAxisTo(t){t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ}getSwingAngle(){return this._swingAngle}getTwistAngle(){return this._twistAngle}},a.dynamics.constraint.joint.RagdollJointConfig=class extends a.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localTwistAxis1=new a.common.Vec3(1,0,0),this.localTwistAxis2=new a.common.Vec3(1,0,0),this.localSwingAxis1=new a.common.Vec3(0,1,0),this.twistSpringDamper=new a.dynamics.constraint.joint.SpringDamper,this.swingSpringDamper=new a.dynamics.constraint.joint.SpringDamper,this.twistLimitMotor=new a.dynamics.constraint.joint.RotationalLimitMotor,this.maxSwingAngle1=3.14159265358979,this.maxSwingAngle2=3.14159265358979}init(t,i,s,a,o){this._init(t,i,s);let n,e,r,_,l,h,c=this.localTwistAxis1;n=a.x,e=a.y,r=a.z,_=t._transform._rotation00*n+t._transform._rotation10*e+t._transform._rotation20*r,l=t._transform._rotation01*n+t._transform._rotation11*e+t._transform._rotation21*r,h=t._transform._rotation02*n+t._transform._rotation12*e+t._transform._rotation22*r,n=_,e=l,r=h,c.x=n,c.y=e,c.z=r;let m,b,p,x,f,u,y=this.localTwistAxis2;m=a.x,b=a.y,p=a.z,x=i._transform._rotation00*m+i._transform._rotation10*b+i._transform._rotation20*p,f=i._transform._rotation01*m+i._transform._rotation11*b+i._transform._rotation21*p,u=i._transform._rotation02*m+i._transform._rotation12*b+i._transform._rotation22*p,m=x,b=f,p=u,y.x=m,y.y=b,y.z=p;let g,v,d,X,z,Y,Z=this.localSwingAxis1;return g=o.x,v=o.y,d=o.z,X=t._transform._rotation00*g+t._transform._rotation10*v+t._transform._rotation20*d,z=t._transform._rotation01*g+t._transform._rotation11*v+t._transform._rotation21*d,Y=t._transform._rotation02*g+t._transform._rotation12*v+t._transform._rotation22*d,g=X,v=z,d=Y,Z.x=g,Z.y=v,Z.z=d,this}},a.dynamics.constraint.joint.RevoluteJoint=class extends a.dynamics.constraint.joint.Joint{constructor(t){super(t,1);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localAxis2;this._localBasisX2X=s.x,this._localBasisX2Y=s.y,this._localBasisX2Z=s.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this._basis=new a.dynamics.constraint.joint.BasisTracker(this),this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()}getInfo(t,i,s){let a,o,n,e=this.getErp(i,s);a=this.linearErrorX*e,o=this.linearErrorY*e,n=this.linearErrorZ*e;let r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z=this.angularErrorY*e,M=this.angularErrorZ*e;r=0,_=-this._relativeAnchor1Z,l=this._relativeAnchor1Y,h=this._relativeAnchor1Z,c=0,m=-this._relativeAnchor1X,b=-this._relativeAnchor1Y,p=this._relativeAnchor1X,x=0,f=0,u=-this._relativeAnchor2Z,y=this._relativeAnchor2Y,g=this._relativeAnchor2Z,v=0,d=-this._relativeAnchor2X,X=-this._relativeAnchor2Y,z=this._relativeAnchor2X,Y=0,r=-r,_=-_,l=-l,h=-h,c=-c,m=-m,b=-b,p=-p,x=-x,f=-f,u=-u,y=-y,g=-g,v=-v,d=-d,X=-X,z=-z,Y=-Y;let I=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ),V=this._impulses[0],w=t.rows[t.numRows++],L=w.jacobian;L.lin1X=0,L.lin1Y=0,L.lin1Z=0,L.lin2X=0,L.lin2Y=0,L.lin2Z=0,L.ang1X=0,L.ang1Y=0,L.ang1Z=0,L.ang2X=0,L.ang2Y=0,L.ang2Z=0,w.rhs=0,w.cfm=0,w.minImpulse=0,w.maxImpulse=0,w.motorSpeed=0,w.motorMaxImpulse=0,w.impulse=null,w.impulse=V,w.rhs=a,w.cfm=0,w.minImpulse=-1/0,w.maxImpulse=Infinity;let k=w.jacobian;k.lin1X=1,k.lin1Y=0,k.lin1Z=0,k.lin2X=1,k.lin2Y=0,k.lin2Z=0,k.ang1X=r,k.ang1Y=_,k.ang1Z=l,k.ang2X=f,k.ang2Y=u,k.ang2Z=y;let A=this._impulses[1],B=t.rows[t.numRows++],P=B.jacobian;P.lin1X=0,P.lin1Y=0,P.lin1Z=0,P.lin2X=0,P.lin2Y=0,P.lin2Z=0,P.ang1X=0,P.ang1Y=0,P.ang1Z=0,P.ang2X=0,P.ang2Y=0,P.ang2Z=0,B.rhs=0,B.cfm=0,B.minImpulse=0,B.maxImpulse=0,B.motorSpeed=0,B.motorMaxImpulse=0,B.impulse=null,B.impulse=A,B.rhs=o,B.cfm=0,B.minImpulse=-1/0,B.maxImpulse=Infinity,k=B.jacobian,k.lin1X=0,k.lin1Y=1,k.lin1Z=0,k.lin2X=0,k.lin2Y=1,k.lin2Z=0,k.ang1X=h,k.ang1Y=c,k.ang1Z=m,k.ang2X=g,k.ang2Y=v,k.ang2Z=d;let S=this._impulses[2],T=t.rows[t.numRows++],C=T.jacobian;if(C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,T.rhs=0,T.cfm=0,T.minImpulse=0,T.maxImpulse=0,T.motorSpeed=0,T.motorMaxImpulse=0,T.impulse=null,T.impulse=S,T.rhs=n,T.cfm=0,T.minImpulse=-1/0,T.maxImpulse=Infinity,k=T.jacobian,k.lin1X=0,k.lin1Y=0,k.lin1Z=1,k.lin2X=0,k.lin2Y=0,k.lin2Z=1,k.ang1X=b,k.ang1Y=p,k.ang1Z=x,k.ang2X=X,k.ang2Y=z,k.ang2Z=Y,this._sd.frequency<=0||!s){let a=this._impulses[3],o=t.rows[t.numRows++],n=o.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,o.rhs=0,o.cfm=0,o.minImpulse=0,o.maxImpulse=0,o.motorSpeed=0,o.motorMaxImpulse=0,o.impulse=null,o.impulse=a,this.setSolverInfoRowAngular(o,this.angle,this._lm,I,this._sd,i,s),k=o.jacobian,k.ang1X=this._basis.xX,k.ang1Y=this._basis.xY,k.ang1Z=this._basis.xZ,k.ang2X=this._basis.xX,k.ang2Y=this._basis.xY,k.ang2Z=this._basis.xZ}let j=this._impulses[4],R=t.rows[t.numRows++],q=R.jacobian;q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,R.rhs=0,R.cfm=0,R.minImpulse=0,R.maxImpulse=0,R.motorSpeed=0,R.motorMaxImpulse=0,R.impulse=null,R.impulse=j,R.rhs=Z,R.cfm=0,R.minImpulse=-1/0,R.maxImpulse=Infinity,k=R.jacobian,k.ang1X=this._basis.yX,k.ang1Y=this._basis.yY,k.ang1Z=this._basis.yZ,k.ang2X=this._basis.yX,k.ang2Y=this._basis.yY,k.ang2Z=this._basis.yZ;let E=this._impulses[5],D=t.rows[t.numRows++],N=D.jacobian;N.lin1X=0,N.lin1Y=0,N.lin1Z=0,N.lin2X=0,N.lin2Y=0,N.lin2Z=0,N.ang1X=0,N.ang1Y=0,N.ang1Z=0,N.ang2X=0,N.ang2Y=0,N.ang2Z=0,D.rhs=0,D.cfm=0,D.minImpulse=0,D.maxImpulse=0,D.motorSpeed=0,D.motorMaxImpulse=0,D.impulse=null,D.impulse=E,D.rhs=M,D.cfm=0,D.minImpulse=-1/0,D.maxImpulse=Infinity,k=D.jacobian,k.ang1X=this._basis.zX,k.ang1Y=this._basis.zY,k.ang1Z=this._basis.zZ,k.ang2X=this._basis.zX,k.ang2Y=this._basis.zY,k.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();let t,i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,q,E,D,N,F=this._basis,W=F.joint._b1._invMass,J=F.joint._b2._invMass,G=F.joint._basisX1X*F.joint._basisX2X+F.joint._basisX1Y*F.joint._basisX2Y+F.joint._basisX1Z*F.joint._basisX2Z;if(G<-.999999999){let o,n,e,r,_=F.joint._basisX1X,l=F.joint._basisX1Y,h=F.joint._basisX1Z,c=_*_,m=l*l,b=h*h;c<m?c<b?(r=1/Math.sqrt(m+b),o=0,n=h*r,e=-l*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),o=-h*r,n=0,e=_*r):(r=1/Math.sqrt(c+m),o=l*r,n=-_*r,e=0),t=o,i=n,s=e,a=0}else{let o,n,e;o=F.joint._basisX1Y*F.joint._basisX2Z-F.joint._basisX1Z*F.joint._basisX2Y,n=F.joint._basisX1Z*F.joint._basisX2X-F.joint._basisX1X*F.joint._basisX2Z,e=F.joint._basisX1X*F.joint._basisX2Y-F.joint._basisX1Y*F.joint._basisX2X;let r=Math.sqrt(.5*(1+G));G=.5/r,o*=G,n*=G,e*=G,t=o,i=n,s=e,a=r}o=0,n=0,e=0,r=1,T=0,C=0,j=0,R=1,q=t,E=i,D=s,N=a;let O=T*q+C*E+j*D+R*N;if(O<0&&(O=-O,q=-q,E=-E,D=-D,N=-N),O>.999999){let t,i,s,a;t=q-T,i=E-C,s=D-j,a=N-R,q=T+t*(W/(W+J)),E=C+i*(W/(W+J)),D=j+s*(W/(W+J)),N=R+a*(W/(W+J));let o=q*q+E*E+D*D+N*N;o>1e-32&&(o=1/Math.sqrt(o)),_=q*o,l=E*o,h=D*o,c=N*o}else{let t=W/(W+J)*Math.acos(O);q+=T*-O,E+=C*-O,D+=j*-O,N+=R*-O;let i=q*q+E*E+D*D+N*N;i>1e-32&&(i=1/Math.sqrt(i)),q*=i,E*=i,D*=i,N*=i;let s=Math.sin(t),a=Math.cos(t);T*=a,C*=a,j*=a,R*=a,_=T+q*s,l=C+E*s,h=j+D*s,c=R+N*s}let U,H,Q,K=2*_,$=2*l,tt=2*h,it=_*K,st=l*$,at=h*tt,ot=_*$,nt=l*tt,et=_*tt,rt=c*K,_t=c*$,lt=c*tt;m=1-st-at,b=ot-lt,p=et+_t,x=ot+lt,f=1-it-at,u=nt-rt,y=et-_t,g=nt+rt,v=1-it-st,U=m*F.joint._basisX1X+b*F.joint._basisX1Y+p*F.joint._basisX1Z,H=x*F.joint._basisX1X+f*F.joint._basisX1Y+u*F.joint._basisX1Z,Q=y*F.joint._basisX1X+g*F.joint._basisX1Y+v*F.joint._basisX1Z,d=U,X=H,z=Q,L=F.xX,k=F.xY,A=F.xZ,B=F.yX,P=F.yY,S=F.yZ;let ht=L*d+k*X+A*z;if(ht<-.999999999){let t,i,s,a,o=L,n=k,e=A,r=o*o,m=n*n,b=e*e;r<m?r<b?(a=1/Math.sqrt(m+b),t=0,i=e*a,s=-n*a):(a=1/Math.sqrt(r+m),t=n*a,i=-o*a,s=0):m<b?(a=1/Math.sqrt(b+r),t=-e*a,i=0,s=o*a):(a=1/Math.sqrt(r+m),t=n*a,i=-o*a,s=0),_=t,l=i,h=s,c=0}else{let t,i,s;t=k*z-A*X,i=A*d-L*z,s=L*X-k*d;let a=Math.sqrt(.5*(1+ht));ht=.5/a,t*=ht,i*=ht,s*=ht,_=t,l=i,h=s,c=a}let ct,mt,bt,pt,xt,ft,ut=2*_,yt=2*l,gt=2*h,vt=_*ut,dt=l*yt,Xt=h*gt,zt=_*yt,Yt=l*gt,Zt=_*gt,Mt=c*ut,It=c*yt,Vt=c*gt;if(m=1-dt-Xt,b=zt-Vt,p=Zt+It,x=zt+Vt,f=1-vt-Xt,u=Yt-Mt,y=Zt-It,g=Yt+Mt,v=1-vt-dt,ct=m*B+b*P+p*S,mt=x*B+f*P+u*S,bt=y*B+g*P+v*S,Y=ct,Z=mt,M=bt,I=X*M-z*Z,V=z*Y-d*M,w=d*Z-X*Y,I*I+V*V+w*w>1e-6){let t=I*I+V*V+w*w;t>0&&(t=1/Math.sqrt(t)),I*=t,V*=t,w*=t}else{let t,i=d,s=X,a=z,o=i*i,n=s*s,e=a*a;o<n?o<e?(t=1/Math.sqrt(n+e),I=0,V=a*t,w=-s*t):(t=1/Math.sqrt(o+n),I=s*t,V=-i*t,w=0):n<e?(t=1/Math.sqrt(e+o),I=-a*t,V=0,w=i*t):(t=1/Math.sqrt(o+n),I=s*t,V=-i*t,w=0)}Y=V*z-w*X,Z=w*d-I*z,M=I*X-V*d,F.xX=d,F.xY=X,F.xZ=z,F.yX=Y,F.yY=Z,F.yZ=M,F.zX=I,F.zY=V,F.zZ=w,pt=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,xt=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,ft=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;let wt,Lt,kt,At=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,Bt=At<=-1?3.14159265358979:At>=1?0:Math.acos(At),Pt=pt*pt+xt*xt+ft*ft;Pt>0&&(Pt=1/Math.sqrt(Pt)),pt*=Pt,xt*=Pt,ft*=Pt,pt*=Bt,xt*=Bt,ft*=Bt,this.angularErrorY=pt*this._basis.yX+xt*this._basis.yY+ft*this._basis.yZ,this.angularErrorZ=pt*this._basis.zX+xt*this._basis.zY+ft*this._basis.zZ,wt=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,Lt=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,kt=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,At=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=At<=-1?3.14159265358979:At>=1?0:Math.acos(At),wt*this._basis.xX+Lt*this._basis.xY+kt*this._basis.xZ<0&&(this.angle=-this.angle),this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new a.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new a.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new a.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new a.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getAngle(){return this.angle}},a.dynamics.constraint.joint.RevoluteJointConfig=class extends a.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new a.common.Vec3(1,0,0),this.localAxis2=new a.common.Vec3(1,0,0),this.springDamper=new a.dynamics.constraint.joint.SpringDamper,this.limitMotor=new a.dynamics.constraint.joint.RotationalLimitMotor}init(t,i,s,a){this._init(t,i,s);let o,n,e,r,_,l,h=this.localAxis1;o=a.x,n=a.y,e=a.z,r=t._transform._rotation00*o+t._transform._rotation10*n+t._transform._rotation20*e,_=t._transform._rotation01*o+t._transform._rotation11*n+t._transform._rotation21*e,l=t._transform._rotation02*o+t._transform._rotation12*n+t._transform._rotation22*e,o=r,n=_,e=l,h.x=o,h.y=n,h.z=e;let c,m,b,p,x,f,u=this.localAxis2;return c=a.x,m=a.y,b=a.z,p=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*b,x=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*b,f=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*b,c=p,m=x,b=f,u.x=c,u.y=m,u.z=b,this}},a.dynamics.constraint.joint.RotationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorTorque=0}setLimits(t,i){return this.lowerLimit=t,this.upperLimit=i,this}setMotor(t,i){return this.motorSpeed=t,this.motorTorque=i,this}clone(){let t=new a.dynamics.constraint.joint.RotationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorTorque=this.motorTorque,t}},a.dynamics.constraint.joint.SphericalJoint=class extends a.dynamics.constraint.joint.Joint{constructor(t){super(t,0),this._sd=t.springDamper.clone()}getInfo(t,i,s){if(this._sd.frequency>0&&s)return;let o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w;if(o=this._anchor2X-this._anchor1X,n=this._anchor2Y-this._anchor1Y,e=this._anchor2Z-this._anchor1Z,this._sd.frequency>0){let t=6.28318530717958*this._sd.frequency,s=this._sd.dampingRatio;s<a.common.Setting.minSpringDamperDampingRatio&&(s=a.common.Setting.minSpringDamperDampingRatio);let o=i.dt,n=2*s*t,e=t*t;this._sd.useSymplecticEuler?(r=1/(o*n),_=e/n):(r=1/(o*(o*e+n)),_=e/(o*e+n)),r*=this._b1._invMass+this._b2._invMass}else r=0,_=this.getErp(i,s);l=o*_,h=n*_,c=e*_,m=0,b=-this._relativeAnchor1Z,p=this._relativeAnchor1Y,x=this._relativeAnchor1Z,f=0,u=-this._relativeAnchor1X,y=-this._relativeAnchor1Y,g=this._relativeAnchor1X,v=0,d=0,X=-this._relativeAnchor2Z,z=this._relativeAnchor2Y,Y=this._relativeAnchor2Z,Z=0,M=-this._relativeAnchor2X,I=-this._relativeAnchor2Y,V=this._relativeAnchor2X,w=0,m=-m,b=-b,p=-p,x=-x,f=-f,u=-u,y=-y,g=-g,v=-v,d=-d,X=-X,z=-z,Y=-Y,Z=-Z,M=-M,I=-I,V=-V,w=-w;let L=this._impulses[0],k=t.rows[t.numRows++],A=k.jacobian;A.lin1X=0,A.lin1Y=0,A.lin1Z=0,A.lin2X=0,A.lin2Y=0,A.lin2Z=0,A.ang1X=0,A.ang1Y=0,A.ang1Z=0,A.ang2X=0,A.ang2Y=0,A.ang2Z=0,k.rhs=0,k.cfm=0,k.minImpulse=0,k.maxImpulse=0,k.motorSpeed=0,k.motorMaxImpulse=0,k.impulse=null,k.impulse=L,k.rhs=l,k.cfm=r,k.minImpulse=-1/0,k.maxImpulse=Infinity;let B=k.jacobian;B.lin1X=1,B.lin1Y=0,B.lin1Z=0,B.lin2X=1,B.lin2Y=0,B.lin2Z=0,B.ang1X=m,B.ang1Y=b,B.ang1Z=p,B.ang2X=d,B.ang2Y=X,B.ang2Z=z;let P=this._impulses[1],S=t.rows[t.numRows++],T=S.jacobian;T.lin1X=0,T.lin1Y=0,T.lin1Z=0,T.lin2X=0,T.lin2Y=0,T.lin2Z=0,T.ang1X=0,T.ang1Y=0,T.ang1Z=0,T.ang2X=0,T.ang2Y=0,T.ang2Z=0,S.rhs=0,S.cfm=0,S.minImpulse=0,S.maxImpulse=0,S.motorSpeed=0,S.motorMaxImpulse=0,S.impulse=null,S.impulse=P,S.rhs=h,S.cfm=r,S.minImpulse=-1/0,S.maxImpulse=Infinity,B=S.jacobian,B.lin1X=0,B.lin1Y=1,B.lin1Z=0,B.lin2X=0,B.lin2Y=1,B.lin2Z=0,B.ang1X=x,B.ang1Y=f,B.ang1Z=u,B.ang2X=Y,B.ang2Y=Z,B.ang2Z=M;let C=this._impulses[2],j=t.rows[t.numRows++],R=j.jacobian;R.lin1X=0,R.lin1Y=0,R.lin1Z=0,R.lin2X=0,R.lin2Y=0,R.lin2Z=0,R.ang1X=0,R.ang1Y=0,R.ang1Z=0,R.ang2X=0,R.ang2Y=0,R.ang2Z=0,j.rhs=0,j.cfm=0,j.minImpulse=0,j.maxImpulse=0,j.motorSpeed=0,j.motorMaxImpulse=0,j.impulse=null,j.impulse=C,j.rhs=c,j.cfm=r,j.minImpulse=-1/0,j.maxImpulse=Infinity,B=j.jacobian,B.lin1X=0,B.lin1Y=0,B.lin1Z=1,B.lin2X=0,B.lin2Y=0,B.lin2Z=1,B.ang1X=y,B.ang1Y=g,B.ang1Z=v,B.ang2X=I,B.ang2Y=V,B.ang2Z=w}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getSpringDamper(){return this._sd}},a.dynamics.constraint.joint.SphericalJointConfig=class extends a.dynamics.constraint.joint.JointConfig{constructor(){super(),this.springDamper=new a.dynamics.constraint.joint.SpringDamper}init(t,i,s){return this._init(t,i,s),this}},a.dynamics.constraint.joint.SpringDamper=class{constructor(){this.frequency=0,this.dampingRatio=0,this.useSymplecticEuler=!1}setSpring(t,i){return this.frequency=t,this.dampingRatio=i,this}setSymplecticEuler(t){return this.useSymplecticEuler=t,this}clone(){let t=new a.dynamics.constraint.joint.SpringDamper;return t.frequency=this.frequency,t.dampingRatio=this.dampingRatio,t.useSymplecticEuler=this.useSymplecticEuler,t}},a.dynamics.constraint.joint.TranslationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorForce=0}setLimits(t,i){return this.lowerLimit=t,this.upperLimit=i,this}setMotor(t,i){return this.motorSpeed=t,this.motorForce=i,this}clone(){let t=new a.dynamics.constraint.joint.TranslationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorForce=this.motorForce,t}},a.dynamics.constraint.joint.UniversalJoint=class extends a.dynamics.constraint.joint.Joint{constructor(t){super(t,a.dynamics.constraint.joint.JointType.UNIVERSAL);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localAxis2;this._localBasisZ2X=s.x,this._localBasisZ2Y=s.y,this._localBasisZ2Z=s.z,this.buildLocalBasesFromX1Z2(),this._angleX=0,this._angleY=0,this._angleZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._sd1=t.springDamper1.clone(),this._sd2=t.springDamper2.clone(),this._lm1=t.limitMotor1.clone(),this._lm2=t.limitMotor2.clone()}getInfo(t,i,s){let a,o,n,e=this.getErp(i,s);a=this.linearErrorX*e,o=this.linearErrorY*e,n=this.linearErrorZ*e;let r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z=this._angleY*e;r=0,_=-this._relativeAnchor1Z,l=this._relativeAnchor1Y,h=this._relativeAnchor1Z,c=0,m=-this._relativeAnchor1X,b=-this._relativeAnchor1Y,p=this._relativeAnchor1X,x=0,f=0,u=-this._relativeAnchor2Z,y=this._relativeAnchor2Y,g=this._relativeAnchor2Z,v=0,d=-this._relativeAnchor2X,X=-this._relativeAnchor2Y,z=this._relativeAnchor2X,Y=0,r=-r,_=-_,l=-l,h=-h,c=-c,m=-m,b=-b,p=-p,x=-x,f=-f,u=-u,y=-y,g=-g,v=-v,d=-d,X=-X,z=-z,Y=-Y;let M=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),I=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ),V=this._impulses[0],w=t.rows[t.numRows++],L=w.jacobian;L.lin1X=0,L.lin1Y=0,L.lin1Z=0,L.lin2X=0,L.lin2Y=0,L.lin2Z=0,L.ang1X=0,L.ang1Y=0,L.ang1Z=0,L.ang2X=0,L.ang2Y=0,L.ang2Z=0,w.rhs=0,w.cfm=0,w.minImpulse=0,w.maxImpulse=0,w.motorSpeed=0,w.motorMaxImpulse=0,w.impulse=null,w.impulse=V,w.rhs=a,w.cfm=0,w.minImpulse=-1/0,w.maxImpulse=Infinity;let k=w.jacobian;k.lin1X=1,k.lin1Y=0,k.lin1Z=0,k.lin2X=1,k.lin2Y=0,k.lin2Z=0,k.ang1X=r,k.ang1Y=_,k.ang1Z=l,k.ang2X=f,k.ang2Y=u,k.ang2Z=y;let A=this._impulses[1],B=t.rows[t.numRows++],P=B.jacobian;P.lin1X=0,P.lin1Y=0,P.lin1Z=0,P.lin2X=0,P.lin2Y=0,P.lin2Z=0,P.ang1X=0,P.ang1Y=0,P.ang1Z=0,P.ang2X=0,P.ang2Y=0,P.ang2Z=0,B.rhs=0,B.cfm=0,B.minImpulse=0,B.maxImpulse=0,B.motorSpeed=0,B.motorMaxImpulse=0,B.impulse=null,B.impulse=A,B.rhs=o,B.cfm=0,B.minImpulse=-1/0,B.maxImpulse=Infinity,k=B.jacobian,k.lin1X=0,k.lin1Y=1,k.lin1Z=0,k.lin2X=0,k.lin2Y=1,k.lin2Z=0,k.ang1X=h,k.ang1Y=c,k.ang1Z=m,k.ang2X=g,k.ang2Y=v,k.ang2Z=d;let S=this._impulses[2],T=t.rows[t.numRows++],C=T.jacobian;if(C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,T.rhs=0,T.cfm=0,T.minImpulse=0,T.maxImpulse=0,T.motorSpeed=0,T.motorMaxImpulse=0,T.impulse=null,T.impulse=S,T.rhs=n,T.cfm=0,T.minImpulse=-1/0,T.maxImpulse=Infinity,k=T.jacobian,k.lin1X=0,k.lin1Y=0,k.lin1Z=1,k.lin2X=0,k.lin2Y=0,k.lin2Z=1,k.ang1X=b,k.ang1Y=p,k.ang1Z=x,k.ang2X=X,k.ang2Y=z,k.ang2Z=Y,!this.xSingular&&(this._sd1.frequency<=0||!s)){let a=this._impulses[3],o=t.rows[t.numRows++],n=o.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,o.rhs=0,o.cfm=0,o.minImpulse=0,o.maxImpulse=0,o.motorSpeed=0,o.motorMaxImpulse=0,o.impulse=null,o.impulse=a,this.setSolverInfoRowAngular(o,this._angleX,this._lm1,M,this._sd1,i,s),k=o.jacobian,k.ang1X=this._axisXX,k.ang1Y=this._axisXY,k.ang1Z=this._axisXZ,k.ang2X=this._axisXX,k.ang2Y=this._axisXY,k.ang2Z=this._axisXZ}if(!this.ySingular){let i=this._impulses[4],s=t.rows[t.numRows++],a=s.jacobian;a.lin1X=0,a.lin1Y=0,a.lin1Z=0,a.lin2X=0,a.lin2Y=0,a.lin2Z=0,a.ang1X=0,a.ang1Y=0,a.ang1Z=0,a.ang2X=0,a.ang2Y=0,a.ang2Z=0,s.rhs=0,s.cfm=0,s.minImpulse=0,s.maxImpulse=0,s.motorSpeed=0,s.motorMaxImpulse=0,s.impulse=null,s.impulse=i,s.rhs=Z,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=Infinity,k=s.jacobian,k.ang1X=this._axisYX,k.ang1Y=this._axisYY,k.ang1Z=this._axisYZ,k.ang2X=this._axisYX,k.ang2Y=this._axisYY,k.ang2Z=this._axisYZ}if(!this.zSingular&&(this._sd2.frequency<=0||!s)){let a=this._impulses[5],o=t.rows[t.numRows++],n=o.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,o.rhs=0,o.cfm=0,o.minImpulse=0,o.maxImpulse=0,o.motorSpeed=0,o.motorMaxImpulse=0,o.impulse=null,o.impulse=a,this.setSolverInfoRowAngular(o,this._angleZ,this._lm2,I,this._sd2,i,s),k=o.jacobian,k.ang1X=this._axisZX,k.ang1Y=this._axisZY,k.ang1Z=this._axisZZ,k.ang2X=this._axisZX,k.ang2Y=this._axisZY,k.ang2Z=this._axisZZ}}_syncAnchors(){let t,i,s,a,o,n,e,r,_;super._syncAnchors(),t=this._basisX1X,i=this._basisX1Y,s=this._basisX1Z,e=this._basisZ2X,r=this._basisZ2Y,_=this._basisZ2Z,a=r*s-_*i,o=_*t-e*s,n=e*i-r*t,this._axisXX=o*_-n*r,this._axisXY=n*e-a*_,this._axisXZ=a*r-o*e,this._axisYX=a,this._axisYY=o,this._axisYZ=n,this._axisZX=i*n-s*o,this._axisZY=s*a-t*n,this._axisZZ=t*o-i*a;let l=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;l>0&&(l=1/Math.sqrt(l)),this._axisXX*=l,this._axisXY*=l,this._axisXZ*=l;let h=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;h>0&&(h=1/Math.sqrt(h)),this._axisYX*=h,this._axisYY*=h,this._axisYZ*=h;let c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,q,E,D,N,F,W,J=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;J>0&&(J=1/Math.sqrt(J)),this._axisZX*=J,this._axisZY*=J,this._axisZZ*=J,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0,c=this._basisX1X,m=this._basisY1X,b=this._basisZ1X,p=this._basisX1Y,x=this._basisY1Y,f=this._basisZ1Y,u=this._basisX1Z,y=this._basisY1Z,g=this._basisZ1Z,v=this._basisX2X,d=this._basisY2X,X=this._basisZ2X,z=this._basisX2Y,Y=this._basisY2Y,Z=this._basisZ2Y,M=this._basisX2Z,I=this._basisY2Z,V=this._basisZ2Z,T=c*v+p*z+u*M,C=c*d+p*Y+u*I,j=c*X+p*Z+u*V,R=m*d+x*Y+y*I,q=m*X+x*Z+y*V,E=b*d+f*Y+g*I,D=b*X+f*Z+g*V,w=T,L=C,k=j,A=R,B=q,P=E,S=D;let G=k;if(G<=-1){let t=Math.atan2(P,A);N=.5*t,F=-1.570796326794895,W=.5*-t}else if(G>=1){let t=Math.atan2(P,A);N=.5*t,F=1.570796326794895,W=.5*t}else N=Math.atan2(-B,S),F=Math.asin(G),W=Math.atan2(-L,w);this._angleX=N,this._angleY=F,this._angleZ=W,this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new a.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new a.common.Vec3;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z}getLocalAxis1(){let t=new a.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new a.common.Vec3;return t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z}getSpringDamper1(){return this._sd1}getSpringDamper2(){return this._sd2}getLimitMotor1(){return this._lm1}getLimitMotor2(){return this._lm2}getAngle1(){return this._angleX}getAngle2(){return this._angleZ}},a.dynamics.constraint.joint.UniversalJointConfig=class extends a.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new a.common.Vec3(1,0,0),this.localAxis2=new a.common.Vec3(1,0,0),this.springDamper1=new a.dynamics.constraint.joint.SpringDamper,this.springDamper2=new a.dynamics.constraint.joint.SpringDamper,this.limitMotor1=new a.dynamics.constraint.joint.RotationalLimitMotor,this.limitMotor2=new a.dynamics.constraint.joint.RotationalLimitMotor}init(t,i,s,a,o){this._init(t,i,s);let n,e,r,_,l,h,c=this.localAxis1;n=a.x,e=a.y,r=a.z,_=t._transform._rotation00*n+t._transform._rotation10*e+t._transform._rotation20*r,l=t._transform._rotation01*n+t._transform._rotation11*e+t._transform._rotation21*r,h=t._transform._rotation02*n+t._transform._rotation12*e+t._transform._rotation22*r,n=_,e=l,r=h,c.x=n,c.y=e,c.z=r;let m,b,p,x,f,u,y=this.localAxis2;return m=o.x,b=o.y,p=o.z,x=i._transform._rotation00*m+i._transform._rotation10*b+i._transform._rotation20*p,f=i._transform._rotation01*m+i._transform._rotation11*b+i._transform._rotation21*p,u=i._transform._rotation02*m+i._transform._rotation12*b+i._transform._rotation22*p,m=x,b=f,p=u,y.x=m,y.y=b,y.z=p,this}},a.dynamics.constraint.solver||(a.dynamics.constraint.solver={}),a.dynamics.constraint.solver.ConstraintSolverType=class{},a.dynamics.constraint.solver.common||(a.dynamics.constraint.solver.common={}),a.dynamics.constraint.solver.common.ContactSolverMassDataRow=class{constructor(){this.invMLinN1X=0,this.invMLinN1Y=0,this.invMLinN1Z=0,this.invMLinN2X=0,this.invMLinN2Y=0,this.invMLinN2Z=0,this.invMAngN1X=0,this.invMAngN1Y=0,this.invMAngN1Z=0,this.invMAngN2X=0,this.invMAngN2Y=0,this.invMAngN2Z=0,this.invMLinT1X=0,this.invMLinT1Y=0,this.invMLinT1Z=0,this.invMLinT2X=0,this.invMLinT2Y=0,this.invMLinT2Z=0,this.invMAngT1X=0,this.invMAngT1Y=0,this.invMAngT1Z=0,this.invMAngT2X=0,this.invMAngT2Y=0,this.invMAngT2Z=0,this.invMLinB1X=0,this.invMLinB1Y=0,this.invMLinB1Z=0,this.invMLinB2X=0,this.invMLinB2Y=0,this.invMLinB2Z=0,this.invMAngB1X=0,this.invMAngB1Y=0,this.invMAngB1Z=0,this.invMAngB2X=0,this.invMAngB2Y=0,this.invMAngB2Z=0,this.massN=0,this.massTB00=0,this.massTB01=0,this.massTB10=0,this.massTB11=0}},a.dynamics.constraint.solver.common.JointSolverMassDataRow=class{constructor(){this.invMLin1X=0,this.invMLin1Y=0,this.invMLin1Z=0,this.invMLin2X=0,this.invMLin2Y=0,this.invMLin2Z=0,this.invMAng1X=0,this.invMAng1Y=0,this.invMAng1Z=0,this.invMAng2X=0,this.invMAng2Y=0,this.invMAng2Z=0,this.mass=0,this.massWithoutCfm=0}},a.dynamics.constraint.solver.direct||(a.dynamics.constraint.solver.direct={}),a.dynamics.constraint.solver.direct.Boundary=class{constructor(t){this.iBounded=new Array(t),this.iUnbounded=new Array(t),this.signs=new Array(t),this.b=new Array(t),this.numBounded=0,this.numUnbounded=0,this.matrixId=0}init(t){this.numBounded=t.numBounded;let i=0,s=this.numBounded;for(;i<s;){let s=i++;this.iBounded[s]=t.iBounded[s],this.signs[s]=t.signs[s]}this.numUnbounded=t.numUnbounded,this.matrixId=0;let a=0,o=this.numUnbounded;for(;a<o;){let i=a++,s=t.iUnbounded[i];this.iUnbounded[i]=s,this.matrixId|=1<<s}}computeImpulses(t,i,s,o,n,e,r){let _=0,l=this.numUnbounded;for(;_<l;){let i=this.iUnbounded[_++],a=t.rows[i];this.b[i]=a.rhs*e-s[i]-a.cfm*o[i]}let h=i._invMassWithoutCfm,c=0,m=this.numBounded;for(;c<m;){let i=c++,s=this.iBounded[i],a=this.signs[i],e=t.rows[s],r=(a<0?e.minImpulse:a>0?e.maxImpulse:0)-o[s];if(n[s]=r,0!=r){let t=0,i=this.numUnbounded;for(;t<i;){let i=this.iUnbounded[t++];this.b[i]-=h[s][i]*r}}}let b,p=this.iUnbounded,x=this.numUnbounded,f=0,u=0;for(;u<x;)f|=1<<p[u++];i._cacheComputed[f]||(i.computeSubmatrix(f,p,x),i._cacheComputed[f]=!0),b=i._cachedSubmatrices[f];let y=!0,g=0,v=this.numUnbounded;for(;g<v;){let i=g++,s=this.iUnbounded[i],e=t.rows[s],r=o[s],_=r,l=0,h=this.numUnbounded;for(;l<h;){let t=l++;_+=this.b[this.iUnbounded[t]]*b[i][t]}if(_<e.minImpulse-a.common.Setting.directMlcpSolverEps||_>e.maxImpulse+a.common.Setting.directMlcpSolverEps){y=!1;break}n[s]=_-r}if(r)return!0;if(!y)return!1;let d=0,X=this.numBounded;for(;d<X;){let i=d++,r=this.iBounded[i],_=t.rows[r],l=this.signs[i],c=0,m=o[r]+n[r],b=s[r],p=0,x=t.numRows;for(;p<x;){let t=p++;b+=h[r][t]*n[t]}if(c=_.rhs*e-b-_.cfm*m,l<0&&c>a.common.Setting.directMlcpSolverEps||l>0&&c<-a.common.Setting.directMlcpSolverEps){y=!1;break}}return y}},a.dynamics.constraint.solver.direct.BoundaryBuildInfo=class{constructor(t){this.size=t,this.numBounded=0,this.iBounded=new Array(t),this.signs=new Array(t),this.numUnbounded=0,this.iUnbounded=new Array(t)}},a.dynamics.constraint.solver.direct.BoundaryBuilder=class{constructor(t){this.maxRows=t,this.numBoundaries=0,this.boundaries=new Array(1<<t),this.bbInfo=new a.dynamics.constraint.solver.direct.BoundaryBuildInfo(t)}buildBoundariesRecursive(t,i){if(i==t.numRows)return null==this.boundaries[this.numBoundaries]&&(this.boundaries[this.numBoundaries]=new a.dynamics.constraint.solver.direct.Boundary(this.maxRows)),void this.boundaries[this.numBoundaries++].init(this.bbInfo);let s=t.rows[i],o=s.minImpulse>-1/0,n=s.maxImpulse<Infinity;if(0==s.minImpulse&&0==s.maxImpulse){let s=this.bbInfo;return s.iBounded[s.numBounded]=i,s.signs[s.numBounded]=0,s.numBounded++,this.buildBoundariesRecursive(t,i+1),void this.bbInfo.numBounded--}let e=this.bbInfo;if(e.iUnbounded[e.numUnbounded]=i,e.numUnbounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numUnbounded--,o){let s=this.bbInfo;s.iBounded[s.numBounded]=i,s.signs[s.numBounded]=-1,s.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}if(n){let s=this.bbInfo;s.iBounded[s.numBounded]=i,s.signs[s.numBounded]=1,s.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}}buildBoundaries(t){this.numBoundaries=0;let i=this.bbInfo;i.numBounded=0,i.numUnbounded=0,this.buildBoundariesRecursive(t,0)}},a.dynamics.constraint.solver.direct.BoundarySelector=class{constructor(t){this.n=t,this.indices=new Array(t),this.tmpIndices=new Array(t);let i=0;for(;i<t;){let t=i++;this.indices[t]=t}}getIndex(t){return this.indices[t]}select(t){let i=0;for(;this.indices[i]!=t;)++i;for(;i>0;){let t=this.indices[i];this.indices[i]=this.indices[i-1],this.indices[i-1]=t,--i}}setSize(t){let i=0,s=0,a=0,o=this.n;for(;a<o;){let o=this.indices[a++];o<t?(this.tmpIndices[i]=o,++i):(this.tmpIndices[t+s]=o,++s)}let n=this.indices;this.indices=this.tmpIndices,this.tmpIndices=n}},a.dynamics.constraint.solver.direct.DirectJointConstraintSolver=class extends a.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.joint=t,this.info=new a.dynamics.constraint.info.joint.JointSolverInfo;let i=a.common.Setting.maxJacobianRows;this.massMatrix=new a.dynamics.constraint.solver.direct.MassMatrix(i),this.boundaryBuilder=new a.dynamics.constraint.solver.direct.BoundaryBuilder(i),this.massData=new Array(i);let s=0,o=this.massData.length;for(;s<o;)this.massData[s++]=new a.dynamics.constraint.solver.common.JointSolverMassDataRow;let n=this.boundaryBuilder.boundaries.length;this.velBoundarySelector=new a.dynamics.constraint.solver.direct.BoundarySelector(n),this.posBoundarySelector=new a.dynamics.constraint.solver.direct.BoundarySelector(n),this.relVels=new Array(i),this.impulses=new Array(i),this.dImpulses=new Array(i),this.dTotalImpulses=new Array(i);let e=0;for(;e<i;){let t=e++;this.relVels[t]=0,this.impulses[t]=0,this.dImpulses[t]=0,this.dTotalImpulses[t]=0}}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let i=this.boundaryBuilder;i.numBoundaries=0;let s=i.bbInfo;s.numBounded=0,s.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);let a=this.velBoundarySelector,o=this.boundaryBuilder.numBoundaries,n=0,e=0,r=0,_=a.n;for(;r<_;){let t=a.indices[r++];t<o?(a.tmpIndices[n]=t,++n):(a.tmpIndices[o+e]=t,++e)}let l=a.indices;a.indices=a.tmpIndices,a.tmpIndices=l}warmStart(t){let i=this.joint._positionCorrectionAlgorithm==a.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?a.common.Setting.jointWarmStartingFactorForBaungarte:a.common.Setting.jointWarmStartingFactor;if(i*=t.dtRatio,i<=0){let t=0,i=this.info.numRows;for(;t<i;){let i=this.info.rows[t++].impulse;i.impulse=0,i.impulseM=0,i.impulseP=0}return}let s=0,o=this.info.numRows;for(;s<o;){let t=s++,a=this.info.rows[t],o=a.impulse,n=o.impulse*i;if(n<a.minImpulse?n=a.minImpulse:n>a.maxImpulse&&(n=a.maxImpulse),o.impulse=n,a.motorMaxImpulse>0){let t=o.impulseM*i,s=a.motorMaxImpulse;t<-s?t=-s:t>s&&(t=s),o.impulseM=t}else o.impulseM=0;this.dImpulses[t]=o.impulse+o.impulseM}let n,e,r,_,l,h,c,m,b,p,x,f,u=this.dImpulses,y=!1,g=!1;n=this._b1._velX,e=this._b1._velY,r=this._b1._velZ,_=this._b2._velX,l=this._b2._velY,h=this._b2._velZ,c=this._b1._angVelX,m=this._b1._angVelY,b=this._b1._angVelZ,p=this._b2._angVelX,x=this._b2._angVelY,f=this._b2._angVelZ;let v=0,d=this.info.numRows;for(;v<d;){let t=v++,i=this.info.rows[t].jacobian,s=this.massData[t],a=u[t];1&i.flag&&(n+=s.invMLin1X*a,e+=s.invMLin1Y*a,r+=s.invMLin1Z*a,_+=s.invMLin2X*-a,l+=s.invMLin2Y*-a,h+=s.invMLin2Z*-a,y=!0),2&i.flag&&(c+=s.invMAng1X*a,m+=s.invMAng1Y*a,b+=s.invMAng1Z*a,p+=s.invMAng2X*-a,x+=s.invMAng2Y*-a,f+=s.invMAng2Z*-a,g=!0)}y&&(this._b1._velX=n,this._b1._velY=e,this._b1._velZ=r,this._b2._velX=_,this._b2._velY=l,this._b2._velZ=h),g&&(this._b1._angVelX=c,this._b1._angVelY=m,this._b1._angVelZ=b,this._b2._angVelX=p,this._b2._angVelY=x,this._b2._angVelZ=f)}solveVelocity(){let t,i,s,a,o,n,e,r,_,l,h,c,m=this.info.numRows;t=this._b1._velX,i=this._b1._velY,s=this._b1._velZ,a=this._b2._velX,o=this._b2._velY,n=this._b2._velZ,e=this._b1._angVelX,r=this._b1._angVelY,_=this._b1._angVelZ,l=this._b2._angVelX,h=this._b2._angVelY,c=this._b2._angVelZ;let b=0;for(;b<m;){let m=b++,p=this.info.rows[m],x=p.jacobian,f=0;f+=t*x.lin1X+i*x.lin1Y+s*x.lin1Z,f-=a*x.lin2X+o*x.lin2Y+n*x.lin2Z,f+=e*x.ang1X+r*x.ang1Y+_*x.ang1Z,f-=l*x.ang2X+h*x.ang2Y+c*x.ang2Z,this.relVels[m]=f,this.impulses[m]=p.impulse.impulse,this.dTotalImpulses[m]=0}let p=this.massMatrix._invMassWithoutCfm,x=0;for(;x<m;){let t=x++,i=this.info.rows[t],s=i.impulse;if(i.motorMaxImpulse>0){let a=s.impulseM,o=a+this.massData[t].massWithoutCfm*(-i.motorSpeed-this.relVels[t]),n=i.motorMaxImpulse;o<-n?o=-n:o>n&&(o=n),s.impulseM=o;let e=o-a;this.dTotalImpulses[t]=e;let r=0;for(;r<m;){let i=r++;this.relVels[i]+=e*p[t][i]}}}let f=!1,u=0,y=this.boundaryBuilder.numBoundaries;for(;u<y;){let t=this.velBoundarySelector.indices[u++];if(this.boundaryBuilder.boundaries[t].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,1,!1)){let i=0;for(;i<m;){let t=i++,s=this.dImpulses[t];this.info.rows[t].impulse.impulse+=s,this.dTotalImpulses[t]+=s}let s,a,o,n,e,r,_,l,h,c,b,p,x=this.dTotalImpulses,u=!1,y=!1;s=this._b1._velX,a=this._b1._velY,o=this._b1._velZ,n=this._b2._velX,e=this._b2._velY,r=this._b2._velZ,_=this._b1._angVelX,l=this._b1._angVelY,h=this._b1._angVelZ,c=this._b2._angVelX,b=this._b2._angVelY,p=this._b2._angVelZ;let g=0,v=this.info.numRows;for(;g<v;){let t=g++,i=this.info.rows[t].jacobian,m=this.massData[t],f=x[t];1&i.flag&&(s+=m.invMLin1X*f,a+=m.invMLin1Y*f,o+=m.invMLin1Z*f,n+=m.invMLin2X*-f,e+=m.invMLin2Y*-f,r+=m.invMLin2Z*-f,u=!0),2&i.flag&&(_+=m.invMAng1X*f,l+=m.invMAng1Y*f,h+=m.invMAng1Z*f,c+=m.invMAng2X*-f,b+=m.invMAng2Y*-f,p+=m.invMAng2Z*-f,y=!0)}u&&(this._b1._velX=s,this._b1._velY=a,this._b1._velZ=o,this._b2._velX=n,this._b2._velY=e,this._b2._velZ=r),y&&(this._b1._angVelX=_,this._b1._angVelY=l,this._b1._angVelZ=h,this._b2._angVelX=c,this._b2._angVelY=b,this._b2._angVelZ=p);let d=this.velBoundarySelector,X=0;for(;d.indices[X]!=t;)++X;for(;X>0;){let t=d.indices[X];d.indices[X]=d.indices[X-1],d.indices[X-1]=t,--X}f=!0;break}}f||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:335:","could not find solution. (velocity)")}postSolveVelocity(t){let i,s,a,o,n,e;i=0,s=0,a=0,o=0,n=0,e=0;let r=0,_=this.info.numRows;for(;r<_;){let t=this.info.rows[r++],_=t.impulse,l=t.jacobian;1&l.flag?(i+=l.lin1X*_.impulse,s+=l.lin1Y*_.impulse,a+=l.lin1Z*_.impulse):2&l.flag&&(o+=l.ang1X*_.impulse,n+=l.ang1Y*_.impulse,e+=l.ang1Z*_.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=s*t.invDt,this.joint._appliedForceZ=a*t.invDt,this.joint._appliedTorqueX=o*t.invDt,this.joint._appliedTorqueY=n*t.invDt,this.joint._appliedTorqueZ=e*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let i=this.boundaryBuilder;i.numBoundaries=0;let s=i.bbInfo;s.numBounded=0,s.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);let a=this.posBoundarySelector,o=this.boundaryBuilder.numBoundaries,n=0,e=0,r=0,_=a.n;for(;r<_;){let t=a.indices[r++];t<o?(a.tmpIndices[n]=t,++n):(a.tmpIndices[o+e]=t,++e)}let l=a.indices;a.indices=a.tmpIndices,a.tmpIndices=l;let h=0,c=this.info.numRows;for(;h<c;)this.info.rows[h++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,i,s,o,n,e,r,_,l,h,c,m,b=this.info.numRows;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,s=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,n=this._b2._pseudoVelY,e=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,_=this._b1._angPseudoVelY,l=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,c=this._b2._angPseudoVelY,m=this._b2._angPseudoVelZ;let p=0;for(;p<b;){let a=p++,b=this.info.rows[a],x=b.jacobian,f=0;f+=t*x.lin1X+i*x.lin1Y+s*x.lin1Z,f-=o*x.lin2X+n*x.lin2Y+e*x.lin2Z,f+=r*x.ang1X+_*x.ang1Y+l*x.ang1Z,f-=h*x.ang2X+c*x.ang2Y+m*x.ang2Z,this.relVels[a]=f,this.impulses[a]=b.impulse.impulseP}let x=!1,f=0,u=this.boundaryBuilder.numBoundaries;for(;f<u;){let t=this.posBoundarySelector.indices[f++];if(this.boundaryBuilder.boundaries[t].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,a.common.Setting.positionSplitImpulseBaumgarte,!1)){let i=0;for(;i<b;){let t=i++;this.info.rows[t].impulse.impulseP+=this.dImpulses[t]}let s,a,o,n,e,r,_,l,h,c,m,p,f=this.dImpulses,u=!1,y=!1;s=this._b1._pseudoVelX,a=this._b1._pseudoVelY,o=this._b1._pseudoVelZ,n=this._b2._pseudoVelX,e=this._b2._pseudoVelY,r=this._b2._pseudoVelZ,_=this._b1._angPseudoVelX,l=this._b1._angPseudoVelY,h=this._b1._angPseudoVelZ,c=this._b2._angPseudoVelX,m=this._b2._angPseudoVelY,p=this._b2._angPseudoVelZ;let g=0,v=this.info.numRows;for(;g<v;){let t=g++,i=this.info.rows[t].jacobian,b=this.massData[t],x=f[t];1&i.flag&&(s+=b.invMLin1X*x,a+=b.invMLin1Y*x,o+=b.invMLin1Z*x,n+=b.invMLin2X*-x,e+=b.invMLin2Y*-x,r+=b.invMLin2Z*-x,u=!0),2&i.flag&&(_+=b.invMAng1X*x,l+=b.invMAng1Y*x,h+=b.invMAng1Z*x,c+=b.invMAng2X*-x,m+=b.invMAng2Y*-x,p+=b.invMAng2Z*-x,y=!0)}u&&(this._b1._pseudoVelX=s,this._b1._pseudoVelY=a,this._b1._pseudoVelZ=o,this._b2._pseudoVelX=n,this._b2._pseudoVelY=e,this._b2._pseudoVelZ=r),y&&(this._b1._angPseudoVelX=_,this._b1._angPseudoVelY=l,this._b1._angPseudoVelZ=h,this._b2._angPseudoVelX=c,this._b2._angPseudoVelY=m,this._b2._angPseudoVelZ=p);let d=this.posBoundarySelector,X=0;for(;d.indices[X]!=t;)++X;for(;X>0;){let t=d.indices[X];d.indices[X]=d.indices[X-1],d.indices[X-1]=t,--X}x=!0;break}}x||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:450:","could not find solution. (split impulse)")}solvePositionNgs(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let i=this.boundaryBuilder;i.numBoundaries=0;let s=i.bbInfo;s.numBounded=0,s.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);let o=this.posBoundarySelector,n=this.boundaryBuilder.numBoundaries,e=0,r=0,_=0,l=o.n;for(;_<l;){let t=o.indices[_++];t<n?(o.tmpIndices[e]=t,++e):(o.tmpIndices[n+r]=t,++r)}let h=o.indices;o.indices=o.tmpIndices,o.tmpIndices=h;let c=this.info.numRows,m=0;for(;m<c;){let t=m++,i=this.info.rows[t].impulse;this.relVels[t]=0,this.impulses[t]=i.impulseP}let b=!1,p=0,x=this.boundaryBuilder.numBoundaries;for(;p<x;){let t=this.posBoundarySelector.indices[p++];if(this.boundaryBuilder.boundaries[t].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,a.common.Setting.positionNgsBaumgarte,!1)){let i=0;for(;i<c;){let t=i++;this.info.rows[t].impulse.impulseP+=this.dImpulses[t]}let s,a,o,n,e,r,_,l,h,m,p,x,f=this.dImpulses,u=!1,y=!1;s=0,a=0,o=0,n=0,e=0,r=0,_=0,l=0,h=0,m=0,p=0,x=0;let g=0,v=this.info.numRows;for(;g<v;){let t=g++,i=this.info.rows[t].jacobian,c=this.massData[t],b=f[t];1&i.flag&&(s+=c.invMLin1X*b,a+=c.invMLin1Y*b,o+=c.invMLin1Z*b,n+=c.invMLin2X*-b,e+=c.invMLin2Y*-b,r+=c.invMLin2Z*-b,u=!0),2&i.flag&&(_+=c.invMAng1X*b,l+=c.invMAng1Y*b,h+=c.invMAng1Z*b,m+=c.invMAng2X*-b,p+=c.invMAng2Y*-b,x+=c.invMAng2Z*-b,y=!0)}if(u){let t=this._b1;t._transform._positionX+=s,t._transform._positionY+=a,t._transform._positionZ+=o;let i=this._b2;i._transform._positionX+=n,i._transform._positionY+=e,i._transform._positionZ+=r}if(y){let t,i,s,a,o,n,e,r,c,b,f,u,y,g=this._b1,v=Math.sqrt(_*_+l*l+h*h),d=.5*v;if(d<.5){let s=d*d;t=.5*(1-.16666666666666666*s+s*s*.008333333333333333),i=1-.5*s+s*s*.041666666666666664}else t=Math.sin(d)/v,i=Math.cos(d);s=_*t,a=l*t,o=h*t,n=s,e=a,r=o,c=i;let X,z=g._transform._rotation00,Y=g._transform._rotation11,Z=g._transform._rotation22,M=z+Y+Z;M>0?(X=Math.sqrt(M+1),y=.5*X,X=.5/X,b=(g._transform._rotation21-g._transform._rotation12)*X,f=(g._transform._rotation02-g._transform._rotation20)*X,u=(g._transform._rotation10-g._transform._rotation01)*X):z>Y?z>Z?(X=Math.sqrt(z-Y-Z+1),b=.5*X,X=.5/X,f=(g._transform._rotation01+g._transform._rotation10)*X,u=(g._transform._rotation02+g._transform._rotation20)*X,y=(g._transform._rotation21-g._transform._rotation12)*X):(X=Math.sqrt(Z-z-Y+1),u=.5*X,X=.5/X,b=(g._transform._rotation02+g._transform._rotation20)*X,f=(g._transform._rotation12+g._transform._rotation21)*X,y=(g._transform._rotation10-g._transform._rotation01)*X):Y>Z?(X=Math.sqrt(Y-Z-z+1),f=.5*X,X=.5/X,b=(g._transform._rotation01+g._transform._rotation10)*X,u=(g._transform._rotation12+g._transform._rotation21)*X,y=(g._transform._rotation02-g._transform._rotation20)*X):(X=Math.sqrt(Z-z-Y+1),u=.5*X,X=.5/X,b=(g._transform._rotation02+g._transform._rotation20)*X,f=(g._transform._rotation12+g._transform._rotation21)*X,y=(g._transform._rotation10-g._transform._rotation01)*X),b=c*b+n*y+e*u-r*f,f=c*f-n*u+e*y+r*b,u=c*u+n*f-e*b+r*y,y=c*y-n*b-e*f-r*u;let I=b*b+f*f+u*u+y*y;I>1e-32&&(I=1/Math.sqrt(I)),b*=I,f*=I,u*=I,y*=I;let V,w,L,k,A,B,P,S,T,C,j,R,q,E,D,N,F,W,J=2*b,G=2*f,O=2*u,U=b*J,H=f*G,Q=u*O,K=b*G,$=f*O,tt=b*O,it=y*J,st=y*G,at=y*O;g._transform._rotation00=1-H-Q,g._transform._rotation01=K-at,g._transform._rotation02=tt+st,g._transform._rotation10=K+at,g._transform._rotation11=1-U-Q,g._transform._rotation12=$-it,g._transform._rotation20=tt-st,g._transform._rotation21=$+it,g._transform._rotation22=1-U-H,V=g._transform._rotation00*g._invLocalInertia00+g._transform._rotation01*g._invLocalInertia10+g._transform._rotation02*g._invLocalInertia20,w=g._transform._rotation00*g._invLocalInertia01+g._transform._rotation01*g._invLocalInertia11+g._transform._rotation02*g._invLocalInertia21,L=g._transform._rotation00*g._invLocalInertia02+g._transform._rotation01*g._invLocalInertia12+g._transform._rotation02*g._invLocalInertia22,k=g._transform._rotation10*g._invLocalInertia00+g._transform._rotation11*g._invLocalInertia10+g._transform._rotation12*g._invLocalInertia20,A=g._transform._rotation10*g._invLocalInertia01+g._transform._rotation11*g._invLocalInertia11+g._transform._rotation12*g._invLocalInertia21,B=g._transform._rotation10*g._invLocalInertia02+g._transform._rotation11*g._invLocalInertia12+g._transform._rotation12*g._invLocalInertia22,P=g._transform._rotation20*g._invLocalInertia00+g._transform._rotation21*g._invLocalInertia10+g._transform._rotation22*g._invLocalInertia20,S=g._transform._rotation20*g._invLocalInertia01+g._transform._rotation21*g._invLocalInertia11+g._transform._rotation22*g._invLocalInertia21,T=g._transform._rotation20*g._invLocalInertia02+g._transform._rotation21*g._invLocalInertia12+g._transform._rotation22*g._invLocalInertia22,g._invInertia00=V,g._invInertia01=w,g._invInertia02=L,g._invInertia10=k,g._invInertia11=A,g._invInertia12=B,g._invInertia20=P,g._invInertia21=S,g._invInertia22=T,C=g._invInertia00*g._transform._rotation00+g._invInertia01*g._transform._rotation01+g._invInertia02*g._transform._rotation02,j=g._invInertia00*g._transform._rotation10+g._invInertia01*g._transform._rotation11+g._invInertia02*g._transform._rotation12,R=g._invInertia00*g._transform._rotation20+g._invInertia01*g._transform._rotation21+g._invInertia02*g._transform._rotation22,q=g._invInertia10*g._transform._rotation00+g._invInertia11*g._transform._rotation01+g._invInertia12*g._transform._rotation02,E=g._invInertia10*g._transform._rotation10+g._invInertia11*g._transform._rotation11+g._invInertia12*g._transform._rotation12,D=g._invInertia10*g._transform._rotation20+g._invInertia11*g._transform._rotation21+g._invInertia12*g._transform._rotation22,N=g._invInertia20*g._transform._rotation00+g._invInertia21*g._transform._rotation01+g._invInertia22*g._transform._rotation02,F=g._invInertia20*g._transform._rotation10+g._invInertia21*g._transform._rotation11+g._invInertia22*g._transform._rotation12,W=g._invInertia20*g._transform._rotation20+g._invInertia21*g._transform._rotation21+g._invInertia22*g._transform._rotation22,g._invInertia00=C,g._invInertia01=j,g._invInertia02=R,g._invInertia10=q,g._invInertia11=E,g._invInertia12=D,g._invInertia20=N,g._invInertia21=F,g._invInertia22=W,g._invInertia00*=g._rotFactor.x,g._invInertia01*=g._rotFactor.x,g._invInertia02*=g._rotFactor.x,g._invInertia10*=g._rotFactor.y,g._invInertia11*=g._rotFactor.y,g._invInertia12*=g._rotFactor.y,g._invInertia20*=g._rotFactor.z,g._invInertia21*=g._rotFactor.z,g._invInertia22*=g._rotFactor.z;let ot,nt,et,rt,_t,lt,ht,ct,mt,bt,pt,xt,ft,ut=this._b2,yt=Math.sqrt(m*m+p*p+x*x),gt=.5*yt;if(gt<.5){let t=gt*gt;ot=.5*(1-.16666666666666666*t+t*t*.008333333333333333),nt=1-.5*t+t*t*.041666666666666664}else ot=Math.sin(gt)/yt,nt=Math.cos(gt);et=m*ot,rt=p*ot,_t=x*ot,lt=et,ht=rt,ct=_t,mt=nt;let vt,dt=ut._transform._rotation00,Xt=ut._transform._rotation11,zt=ut._transform._rotation22,Yt=dt+Xt+zt;Yt>0?(vt=Math.sqrt(Yt+1),ft=.5*vt,vt=.5/vt,bt=(ut._transform._rotation21-ut._transform._rotation12)*vt,pt=(ut._transform._rotation02-ut._transform._rotation20)*vt,xt=(ut._transform._rotation10-ut._transform._rotation01)*vt):dt>Xt?dt>zt?(vt=Math.sqrt(dt-Xt-zt+1),bt=.5*vt,vt=.5/vt,pt=(ut._transform._rotation01+ut._transform._rotation10)*vt,xt=(ut._transform._rotation02+ut._transform._rotation20)*vt,ft=(ut._transform._rotation21-ut._transform._rotation12)*vt):(vt=Math.sqrt(zt-dt-Xt+1),xt=.5*vt,vt=.5/vt,bt=(ut._transform._rotation02+ut._transform._rotation20)*vt,pt=(ut._transform._rotation12+ut._transform._rotation21)*vt,ft=(ut._transform._rotation10-ut._transform._rotation01)*vt):Xt>zt?(vt=Math.sqrt(Xt-zt-dt+1),pt=.5*vt,vt=.5/vt,bt=(ut._transform._rotation01+ut._transform._rotation10)*vt,xt=(ut._transform._rotation12+ut._transform._rotation21)*vt,ft=(ut._transform._rotation02-ut._transform._rotation20)*vt):(vt=Math.sqrt(zt-dt-Xt+1),xt=.5*vt,vt=.5/vt,bt=(ut._transform._rotation02+ut._transform._rotation20)*vt,pt=(ut._transform._rotation12+ut._transform._rotation21)*vt,ft=(ut._transform._rotation10-ut._transform._rotation01)*vt),bt=mt*bt+lt*ft+ht*xt-ct*pt,pt=mt*pt-lt*xt+ht*ft+ct*bt,xt=mt*xt+lt*pt-ht*bt+ct*ft,ft=mt*ft-lt*bt-ht*pt-ct*xt;let Zt=bt*bt+pt*pt+xt*xt+ft*ft;Zt>1e-32&&(Zt=1/Math.sqrt(Zt)),bt*=Zt,pt*=Zt,xt*=Zt,ft*=Zt;let Mt,It,Vt,wt,Lt,kt,At,Bt,Pt,St,Tt,Ct,jt,Rt,qt,Et,Dt,Nt,Ft=2*bt,Wt=2*pt,Jt=2*xt,Gt=bt*Ft,Ot=pt*Wt,Ut=xt*Jt,Ht=bt*Wt,Qt=pt*Jt,Kt=bt*Jt,$t=ft*Ft,ti=ft*Wt,ii=ft*Jt;ut._transform._rotation00=1-Ot-Ut,ut._transform._rotation01=Ht-ii,ut._transform._rotation02=Kt+ti,ut._transform._rotation10=Ht+ii,ut._transform._rotation11=1-Gt-Ut,ut._transform._rotation12=Qt-$t,ut._transform._rotation20=Kt-ti,ut._transform._rotation21=Qt+$t,ut._transform._rotation22=1-Gt-Ot,Mt=ut._transform._rotation00*ut._invLocalInertia00+ut._transform._rotation01*ut._invLocalInertia10+ut._transform._rotation02*ut._invLocalInertia20,It=ut._transform._rotation00*ut._invLocalInertia01+ut._transform._rotation01*ut._invLocalInertia11+ut._transform._rotation02*ut._invLocalInertia21,Vt=ut._transform._rotation00*ut._invLocalInertia02+ut._transform._rotation01*ut._invLocalInertia12+ut._transform._rotation02*ut._invLocalInertia22,wt=ut._transform._rotation10*ut._invLocalInertia00+ut._transform._rotation11*ut._invLocalInertia10+ut._transform._rotation12*ut._invLocalInertia20,Lt=ut._transform._rotation10*ut._invLocalInertia01+ut._transform._rotation11*ut._invLocalInertia11+ut._transform._rotation12*ut._invLocalInertia21,kt=ut._transform._rotation10*ut._invLocalInertia02+ut._transform._rotation11*ut._invLocalInertia12+ut._transform._rotation12*ut._invLocalInertia22,At=ut._transform._rotation20*ut._invLocalInertia00+ut._transform._rotation21*ut._invLocalInertia10+ut._transform._rotation22*ut._invLocalInertia20,Bt=ut._transform._rotation20*ut._invLocalInertia01+ut._transform._rotation21*ut._invLocalInertia11+ut._transform._rotation22*ut._invLocalInertia21,Pt=ut._transform._rotation20*ut._invLocalInertia02+ut._transform._rotation21*ut._invLocalInertia12+ut._transform._rotation22*ut._invLocalInertia22,ut._invInertia00=Mt,ut._invInertia01=It,ut._invInertia02=Vt,ut._invInertia10=wt,ut._invInertia11=Lt,ut._invInertia12=kt,ut._invInertia20=At,ut._invInertia21=Bt,ut._invInertia22=Pt,St=ut._invInertia00*ut._transform._rotation00+ut._invInertia01*ut._transform._rotation01+ut._invInertia02*ut._transform._rotation02,Tt=ut._invInertia00*ut._transform._rotation10+ut._invInertia01*ut._transform._rotation11+ut._invInertia02*ut._transform._rotation12,Ct=ut._invInertia00*ut._transform._rotation20+ut._invInertia01*ut._transform._rotation21+ut._invInertia02*ut._transform._rotation22,jt=ut._invInertia10*ut._transform._rotation00+ut._invInertia11*ut._transform._rotation01+ut._invInertia12*ut._transform._rotation02,Rt=ut._invInertia10*ut._transform._rotation10+ut._invInertia11*ut._transform._rotation11+ut._invInertia12*ut._transform._rotation12,qt=ut._invInertia10*ut._transform._rotation20+ut._invInertia11*ut._transform._rotation21+ut._invInertia12*ut._transform._rotation22,Et=ut._invInertia20*ut._transform._rotation00+ut._invInertia21*ut._transform._rotation01+ut._invInertia22*ut._transform._rotation02,Dt=ut._invInertia20*ut._transform._rotation10+ut._invInertia21*ut._transform._rotation11+ut._invInertia22*ut._transform._rotation12,Nt=ut._invInertia20*ut._transform._rotation20+ut._invInertia21*ut._transform._rotation21+ut._invInertia22*ut._transform._rotation22,ut._invInertia00=St,ut._invInertia01=Tt,ut._invInertia02=Ct,ut._invInertia10=jt,ut._invInertia11=Rt,ut._invInertia12=qt,ut._invInertia20=Et,ut._invInertia21=Dt,ut._invInertia22=Nt,ut._invInertia00*=ut._rotFactor.x,ut._invInertia01*=ut._rotFactor.x,ut._invInertia02*=ut._rotFactor.x,ut._invInertia10*=ut._rotFactor.y,ut._invInertia11*=ut._rotFactor.y,ut._invInertia12*=ut._rotFactor.y,ut._invInertia20*=ut._rotFactor.z,ut._invInertia21*=ut._rotFactor.z,ut._invInertia22*=ut._rotFactor.z}let d=this.posBoundarySelector,X=0;for(;d.indices[X]!=t;)++X;for(;X>0;){let t=d.indices[X];d.indices[X]=d.indices[X-1],d.indices[X-1]=t,--X}b=!0;break}}b||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:502:","could not find solution. (NGS)")}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}},a.dynamics.constraint.solver.direct.MassMatrix=class{constructor(t){this._size=t,this.tmpMatrix=new Array(this._size),this._invMass=new Array(this._size),this._invMassWithoutCfm=new Array(this._size);let i=0,s=this._size;for(;i<s;){let t=i++;this.tmpMatrix[t]=new Array(this._size),this._invMass[t]=new Array(this._size),this._invMassWithoutCfm[t]=new Array(this._size);let s=0,a=this._size;for(;s<a;){let i=s++;this.tmpMatrix[t][i]=0,this._invMass[t][i]=0,this._invMassWithoutCfm[t][i]=0}}this._maxSubmatrixId=1<<this._size,this._cacheComputed=new Array(this._maxSubmatrixId),this._cachedSubmatrices=new Array(this._maxSubmatrixId);let a=0,o=this._maxSubmatrixId;for(;a<o;){let t=a++,i=t;i=(85&t)+(t>>1&85),i=(51&i)+(i>>2&51),i=(15&i)+(i>>4&15);let s=i,o=new Array(s),n=0;for(;n<s;){let t=n++;o[t]=new Array(s);let i=0;for(;i<s;)o[t][i++]=0}this._cacheComputed[t]=!1,this._cachedSubmatrices[t]=o}}computeSubmatrix(t,i,s){let a=0;for(;a<s;){let t=a++,o=i[t],n=0;for(;n<s;){let s=n++;this.tmpMatrix[t][s]=this._invMass[o][i[s]]}}let o,n,e,r,_,l=this.tmpMatrix,h=this._cachedSubmatrices[t];switch(s){case 4:o=l[0],n=h[0],_=1/o[0],n[0]=_,o[1]*=_,o[2]*=_,o[3]*=_,e=l[1],r=h[1],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e=l[2],r=h[2],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e=l[3],r=h[3],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],o=l[1],n=h[1],_=1/o[1],n[1]=_,n[0]*=_,o[2]*=_,o[3]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e=l[2],r=h[2],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e=l[3],r=h[3],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],o=l[2],n=h[2],_=1/o[2],n[2]=_,n[0]*=_,n[1]*=_,o[3]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[2],e[3]-=o[3]*e[2],e=l[1],r=h[1],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],e[3]-=o[3]*e[2],e=l[3],r=h[3],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],r[2]=-_*e[2],e[3]-=o[3]*e[2],o=l[3],n=h[3],_=1/o[3],n[3]=_,n[0]*=_,n[1]*=_,n[2]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[3],e=l[1],r=h[1],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],e=l[2],r=h[2],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],r[2]-=n[2]*e[3],n=h[1],h[0][1]=n[0],n=h[2],h[0][2]=n[0],h[1][2]=n[1],n=h[3],h[0][3]=n[0],h[1][3]=n[1],h[2][3]=n[2];break;case 5:o=l[0],n=h[0],_=1/o[0],n[0]=_,o[1]*=_,o[2]*=_,o[3]*=_,o[4]*=_,e=l[1],r=h[1],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e=l[2],r=h[2],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e=l[3],r=h[3],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e=l[4],r=h[4],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],o=l[1],n=h[1],_=1/o[1],n[1]=_,n[0]*=_,o[2]*=_,o[3]*=_,o[4]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e=l[2],r=h[2],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e=l[3],r=h[3],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e=l[4],r=h[4],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],o=l[2],n=h[2],_=1/o[2],n[2]=_,n[0]*=_,n[1]*=_,o[3]*=_,o[4]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e=l[1],r=h[1],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e=l[3],r=h[3],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],r[2]=-_*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e=l[4],r=h[4],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],r[2]=-_*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],o=l[3],n=h[3],_=1/o[3],n[3]=_,n[0]*=_,n[1]*=_,n[2]*=_,o[4]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[3],e[4]-=o[4]*e[3],e=l[1],r=h[1],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],e[4]-=o[4]*e[3],e=l[2],r=h[2],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],r[2]-=n[2]*e[3],e[4]-=o[4]*e[3],e=l[4],r=h[4],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],r[2]-=n[2]*e[3],r[3]=-_*e[3],e[4]-=o[4]*e[3],o=l[4],n=h[4],_=1/o[4],n[4]=_,n[0]*=_,n[1]*=_,n[2]*=_,n[3]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[4],e=l[1],r=h[1],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],e=l[2],r=h[2],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],r[2]-=n[2]*e[4],e=l[3],r=h[3],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],r[2]-=n[2]*e[4],r[3]-=n[3]*e[4],n=h[1],h[0][1]=n[0],n=h[2],h[0][2]=n[0],h[1][2]=n[1],n=h[3],h[0][3]=n[0],h[1][3]=n[1],h[2][3]=n[2],n=h[4],h[0][4]=n[0],h[1][4]=n[1],h[2][4]=n[2],h[3][4]=n[3];break;case 6:o=l[0],n=h[0],_=1/o[0],n[0]=_,o[1]*=_,o[2]*=_,o[3]*=_,o[4]*=_,o[5]*=_,e=l[1],r=h[1],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e[5]-=o[5]*e[0],e=l[2],r=h[2],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e[5]-=o[5]*e[0],e=l[3],r=h[3],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e[5]-=o[5]*e[0],e=l[4],r=h[4],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e[5]-=o[5]*e[0],e=l[5],r=h[5],r[0]=-_*e[0],e[1]-=o[1]*e[0],e[2]-=o[2]*e[0],e[3]-=o[3]*e[0],e[4]-=o[4]*e[0],e[5]-=o[5]*e[0],o=l[1],n=h[1],_=1/o[1],n[1]=_,n[0]*=_,o[2]*=_,o[3]*=_,o[4]*=_,o[5]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e[5]-=o[5]*e[1],e=l[2],r=h[2],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e[5]-=o[5]*e[1],e=l[3],r=h[3],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e[5]-=o[5]*e[1],e=l[4],r=h[4],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e[5]-=o[5]*e[1],e=l[5],r=h[5],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=o[2]*e[1],e[3]-=o[3]*e[1],e[4]-=o[4]*e[1],e[5]-=o[5]*e[1],o=l[2],n=h[2],_=1/o[2],n[2]=_,n[0]*=_,n[1]*=_,o[3]*=_,o[4]*=_,o[5]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e[5]-=o[5]*e[2],e=l[1],r=h[1],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e[5]-=o[5]*e[2],e=l[3],r=h[3],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],r[2]=-_*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e[5]-=o[5]*e[2],e=l[4],r=h[4],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],r[2]=-_*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e[5]-=o[5]*e[2],e=l[5],r=h[5],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],r[2]=-_*e[2],e[3]-=o[3]*e[2],e[4]-=o[4]*e[2],e[5]-=o[5]*e[2],o=l[3],n=h[3],_=1/o[3],n[3]=_,n[0]*=_,n[1]*=_,n[2]*=_,o[4]*=_,o[5]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[3],e[4]-=o[4]*e[3],e[5]-=o[5]*e[3],e=l[1],r=h[1],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],e[4]-=o[4]*e[3],e[5]-=o[5]*e[3],e=l[2],r=h[2],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],r[2]-=n[2]*e[3],e[4]-=o[4]*e[3],e[5]-=o[5]*e[3],e=l[4],r=h[4],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],r[2]-=n[2]*e[3],r[3]=-_*e[3],e[4]-=o[4]*e[3],e[5]-=o[5]*e[3],e=l[5],r=h[5],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],r[2]-=n[2]*e[3],r[3]=-_*e[3],e[4]-=o[4]*e[3],e[5]-=o[5]*e[3],o=l[4],n=h[4],_=1/o[4],n[4]=_,n[0]*=_,n[1]*=_,n[2]*=_,n[3]*=_,o[5]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[4],e[5]-=o[5]*e[4],e=l[1],r=h[1],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],e[5]-=o[5]*e[4],e=l[2],r=h[2],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],r[2]-=n[2]*e[4],e[5]-=o[5]*e[4],e=l[3],r=h[3],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],r[2]-=n[2]*e[4],r[3]-=n[3]*e[4],e[5]-=o[5]*e[4],e=l[5],r=h[5],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],r[2]-=n[2]*e[4],r[3]-=n[3]*e[4],r[4]=-_*e[4],e[5]-=o[5]*e[4],o=l[5],n=h[5],_=1/o[5],n[5]=_,n[0]*=_,n[1]*=_,n[2]*=_,n[3]*=_,n[4]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[5],e=l[1],r=h[1],r[0]-=n[0]*e[5],r[1]-=n[1]*e[5],e=l[2],r=h[2],r[0]-=n[0]*e[5],r[1]-=n[1]*e[5],r[2]-=n[2]*e[5],e=l[3],r=h[3],r[0]-=n[0]*e[5],r[1]-=n[1]*e[5],r[2]-=n[2]*e[5],r[3]-=n[3]*e[5],e=l[4],r=h[4],r[0]-=n[0]*e[5],r[1]-=n[1]*e[5],r[2]-=n[2]*e[5],r[3]-=n[3]*e[5],r[4]-=n[4]*e[5],n=h[1],h[0][1]=n[0],n=h[2],h[0][2]=n[0],h[1][2]=n[1],n=h[3],h[0][3]=n[0],h[1][3]=n[1],h[2][3]=n[2],n=h[4],h[0][4]=n[0],h[1][4]=n[1],h[2][4]=n[2],h[3][4]=n[3],n=h[5],h[0][5]=n[0],h[1][5]=n[1],h[2][5]=n[2],h[3][5]=n[3],h[4][5]=n[4];break;default:let t=0;for(;t<s;){let i=t++;o=l[i],n=h[i];let a=1/o[i];n[i]=a;let _=0;for(;_<i;)n[_++]*=a;let c=i+1;for(;c<s;)o[c++]*=a;let m=0;for(;m<i;){let t=m++;e=l[t],r=h[t];let a=0,_=t+1;for(;a<_;){let t=a++;r[t]-=n[t]*e[i]}let c=i+1;for(;c<s;){let t=c++;e[t]-=o[t]*e[i]}}let b=i+1;for(;b<s;){let t=b++;e=l[t],r=h[t];let _=0;for(;_<i;){let t=_++;r[t]-=n[t]*e[i]}r[i]=-a*e[i];let c=i+1;for(;c<s;){let t=c++;e[t]-=o[t]*e[i]}}}let i=1;for(;i<s;){let t=i++;n=h[t];let s=0;for(;s<t;){let i=s++;h[i][t]=n[i]}}}}computeInvMass(t,i){let s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v=this._invMass,d=this._invMassWithoutCfm,X=t.numRows,z=t.b1,Y=t.b2,Z=z._invMass,M=Y._invMass;s=z._invInertia00,a=z._invInertia01,o=z._invInertia02,n=z._invInertia10,e=z._invInertia11,r=z._invInertia12,_=z._invInertia20,l=z._invInertia21,h=z._invInertia22,c=Y._invInertia00,m=Y._invInertia01,b=Y._invInertia02,p=Y._invInertia10,x=Y._invInertia11,f=Y._invInertia12,u=Y._invInertia20,y=Y._invInertia21,g=Y._invInertia22;let I=0;for(;I<X;){let v=I++,d=t.rows[v].jacobian,X=i[v];if(d.updateSparsity(),1&d.flag?(X.invMLin1X=d.lin1X*Z,X.invMLin1Y=d.lin1Y*Z,X.invMLin1Z=d.lin1Z*Z,X.invMLin2X=d.lin2X*M,X.invMLin2Y=d.lin2Y*M,X.invMLin2Z=d.lin2Z*M):(X.invMLin1X=0,X.invMLin1Y=0,X.invMLin1Z=0,X.invMLin2X=0,X.invMLin2Y=0,X.invMLin2Z=0),2&d.flag){let t,i,v,z,Y,Z;t=s*d.ang1X+a*d.ang1Y+o*d.ang1Z,i=n*d.ang1X+e*d.ang1Y+r*d.ang1Z,v=_*d.ang1X+l*d.ang1Y+h*d.ang1Z,X.invMAng1X=t,X.invMAng1Y=i,X.invMAng1Z=v,z=c*d.ang2X+m*d.ang2Y+b*d.ang2Z,Y=p*d.ang2X+x*d.ang2Y+f*d.ang2Z,Z=u*d.ang2X+y*d.ang2Y+g*d.ang2Z,X.invMAng2X=z,X.invMAng2Y=Y,X.invMAng2Z=Z}else X.invMAng1X=0,X.invMAng1Y=0,X.invMAng1Z=0,X.invMAng2X=0,X.invMAng2Y=0,X.invMAng2Z=0}let V=0;for(;V<X;){let s=V++,a=t.rows[s].jacobian,o=s;for(;o<X;){let n=o++,e=i[n],r=a.lin1X*e.invMLin1X+a.lin1Y*e.invMLin1Y+a.lin1Z*e.invMLin1Z+(a.ang1X*e.invMAng1X+a.ang1Y*e.invMAng1Y+a.ang1Z*e.invMAng1Z)+(a.lin2X*e.invMLin2X+a.lin2Y*e.invMLin2Y+a.lin2Z*e.invMLin2Z)+(a.ang2X*e.invMAng2X+a.ang2Y*e.invMAng2Y+a.ang2Z*e.invMAng2Z);s==n?(v[s][n]=r+t.rows[s].cfm,d[s][n]=r,e.mass=r+t.rows[s].cfm,e.massWithoutCfm=r,0!=e.mass&&(e.mass=1/e.mass),0!=e.massWithoutCfm&&(e.massWithoutCfm=1/e.massWithoutCfm)):(v[s][n]=r,v[n][s]=r,d[s][n]=r,d[n][s]=r)}}let w=0,L=this._maxSubmatrixId;for(;w<L;)this._cacheComputed[w++]=!1}},a.dynamics.constraint.solver.pgs||(a.dynamics.constraint.solver.pgs={}),a.dynamics.constraint.solver.pgs.PgsContactConstraintSolver=class extends a.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.constraint=t,this.info=new a.dynamics.constraint.info.contact.ContactSolverInfo,this.massData=new Array(a.common.Setting.maxManifoldPoints);let i=0,s=this.massData.length;for(;i<s;)this.massData[i++]=new a.dynamics.constraint.solver.common.ContactSolverMassDataRow}preSolveVelocity(t){this.constraint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g=this._b1._invMass,v=this._b2._invMass;i=this._b1._invInertia00,s=this._b1._invInertia01,a=this._b1._invInertia02,o=this._b1._invInertia10,n=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,l=this._b1._invInertia22,h=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,p=this._b2._invInertia11,x=this._b2._invInertia12,f=this._b2._invInertia20,u=this._b2._invInertia21,y=this._b2._invInertia22;let d=0,X=this.info.numRows;for(;d<X;){let t,X,z,Y,Z,M,I=d++,V=this.info.rows[I],w=this.massData[I],L=V.jacobianN;w.invMLinN1X=L.lin1X*g,w.invMLinN1Y=L.lin1Y*g,w.invMLinN1Z=L.lin1Z*g,w.invMLinN2X=L.lin2X*v,w.invMLinN2Y=L.lin2Y*v,w.invMLinN2Z=L.lin2Z*v,t=i*L.ang1X+s*L.ang1Y+a*L.ang1Z,X=o*L.ang1X+n*L.ang1Y+e*L.ang1Z,z=r*L.ang1X+_*L.ang1Y+l*L.ang1Z,w.invMAngN1X=t,w.invMAngN1Y=X,w.invMAngN1Z=z,Y=h*L.ang2X+c*L.ang2Y+m*L.ang2Z,Z=b*L.ang2X+p*L.ang2Y+x*L.ang2Z,M=f*L.ang2X+u*L.ang2Y+y*L.ang2Z,w.invMAngN2X=Y,w.invMAngN2Y=Z,w.invMAngN2Z=M,w.massN=g+v+(w.invMAngN1X*L.ang1X+w.invMAngN1Y*L.ang1Y+w.invMAngN1Z*L.ang1Z)+(w.invMAngN2X*L.ang2X+w.invMAngN2Y*L.ang2Y+w.invMAngN2Z*L.ang2Z),0!=w.massN&&(w.massN=1/w.massN);let k,A,B,P,S,T,C,j,R,q,E,D,N=V.jacobianT,F=V.jacobianB;w.invMLinT1X=N.lin1X*g,w.invMLinT1Y=N.lin1Y*g,w.invMLinT1Z=N.lin1Z*g,w.invMLinT2X=N.lin2X*v,w.invMLinT2Y=N.lin2Y*v,w.invMLinT2Z=N.lin2Z*v,w.invMLinB1X=F.lin1X*g,w.invMLinB1Y=F.lin1Y*g,w.invMLinB1Z=F.lin1Z*g,w.invMLinB2X=F.lin2X*v,w.invMLinB2Y=F.lin2Y*v,w.invMLinB2Z=F.lin2Z*v,k=i*N.ang1X+s*N.ang1Y+a*N.ang1Z,A=o*N.ang1X+n*N.ang1Y+e*N.ang1Z,B=r*N.ang1X+_*N.ang1Y+l*N.ang1Z,w.invMAngT1X=k,w.invMAngT1Y=A,w.invMAngT1Z=B,P=h*N.ang2X+c*N.ang2Y+m*N.ang2Z,S=b*N.ang2X+p*N.ang2Y+x*N.ang2Z,T=f*N.ang2X+u*N.ang2Y+y*N.ang2Z,w.invMAngT2X=P,w.invMAngT2Y=S,w.invMAngT2Z=T,C=i*F.ang1X+s*F.ang1Y+a*F.ang1Z,j=o*F.ang1X+n*F.ang1Y+e*F.ang1Z,R=r*F.ang1X+_*F.ang1Y+l*F.ang1Z,w.invMAngB1X=C,w.invMAngB1Y=j,w.invMAngB1Z=R,q=h*F.ang2X+c*F.ang2Y+m*F.ang2Z,E=b*F.ang2X+p*F.ang2Y+x*F.ang2Z,D=f*F.ang2X+u*F.ang2Y+y*F.ang2Z,w.invMAngB2X=q,w.invMAngB2Y=E,w.invMAngB2Z=D;let W=g+v+(w.invMAngT1X*N.ang1X+w.invMAngT1Y*N.ang1Y+w.invMAngT1Z*N.ang1Z)+(w.invMAngT2X*N.ang2X+w.invMAngT2Y*N.ang2Y+w.invMAngT2Z*N.ang2Z),J=w.invMAngT1X*F.ang1X+w.invMAngT1Y*F.ang1Y+w.invMAngT1Z*F.ang1Z+(w.invMAngT2X*F.ang2X+w.invMAngT2Y*F.ang2Y+w.invMAngT2Z*F.ang2Z),G=g+v+(w.invMAngB1X*F.ang1X+w.invMAngB1Y*F.ang1Y+w.invMAngB1Z*F.ang1Z)+(w.invMAngB2X*F.ang2X+w.invMAngB2Y*F.ang2Y+w.invMAngB2Z*F.ang2Z),O=W*G-J*J;0!=O&&(O=1/O),w.massTB00=G*O,w.massTB01=-J*O,w.massTB10=-J*O,w.massTB11=W*O}}warmStart(t){let i,s,a,o,n,e,r,_,l,h,c,m;i=this._b1._velX,s=this._b1._velY,a=this._b1._velZ,o=this._b2._velX,n=this._b2._velY,e=this._b2._velZ,r=this._b1._angVelX,_=this._b1._angVelY,l=this._b1._angVelZ,h=this._b2._angVelX,c=this._b2._angVelY,m=this._b2._angVelZ;let b=0,p=this.info.numRows;for(;b<p;){let p=b++,x=this.info.rows[p],f=x.impulse,u=this.massData[p],y=x.jacobianT,g=x.jacobianB,v=f.impulseN,d=f.impulseLX*y.lin1X+f.impulseLY*y.lin1Y+f.impulseLZ*y.lin1Z,X=f.impulseLX*g.lin1X+f.impulseLY*g.lin1Y+f.impulseLZ*g.lin1Z;f.impulseT=d,f.impulseB=X,f.impulseN*=t.dtRatio,f.impulseT*=t.dtRatio,f.impulseB*=t.dtRatio,i+=u.invMLinN1X*v,s+=u.invMLinN1Y*v,a+=u.invMLinN1Z*v,i+=u.invMLinT1X*d,s+=u.invMLinT1Y*d,a+=u.invMLinT1Z*d,i+=u.invMLinB1X*X,s+=u.invMLinB1Y*X,a+=u.invMLinB1Z*X,o+=u.invMLinN2X*-v,n+=u.invMLinN2Y*-v,e+=u.invMLinN2Z*-v,o+=u.invMLinT2X*-d,n+=u.invMLinT2Y*-d,e+=u.invMLinT2Z*-d,o+=u.invMLinB2X*-X,n+=u.invMLinB2Y*-X,e+=u.invMLinB2Z*-X,r+=u.invMAngN1X*v,_+=u.invMAngN1Y*v,l+=u.invMAngN1Z*v,r+=u.invMAngT1X*d,_+=u.invMAngT1Y*d,l+=u.invMAngT1Z*d,r+=u.invMAngB1X*X,_+=u.invMAngB1Y*X,l+=u.invMAngB1Z*X,h+=u.invMAngN2X*-v,c+=u.invMAngN2Y*-v,m+=u.invMAngN2Z*-v,h+=u.invMAngT2X*-d,c+=u.invMAngT2Y*-d,m+=u.invMAngT2Z*-d,h+=u.invMAngB2X*-X,c+=u.invMAngB2Y*-X,m+=u.invMAngB2Z*-X}this._b1._velX=i,this._b1._velY=s,this._b1._velZ=a,this._b2._velX=o,this._b2._velY=n,this._b2._velZ=e,this._b1._angVelX=r,this._b1._angVelY=_,this._b1._angVelZ=l,this._b2._angVelX=h,this._b2._angVelY=c,this._b2._angVelZ=m}solveVelocity(){let t,i,s,a,o,n,e,r,_,l,h,c;t=this._b1._velX,i=this._b1._velY,s=this._b1._velZ,a=this._b2._velX,o=this._b2._velY,n=this._b2._velZ,e=this._b1._angVelX,r=this._b1._angVelY,_=this._b1._angVelZ,l=this._b2._angVelX,h=this._b2._angVelY,c=this._b2._angVelZ;let m=0,b=this.info.numRows;for(;m<b;){let b=m++,p=this.info.rows[b],x=this.massData[b],f=p.impulse,u=0,y=p.jacobianT;u+=t*y.lin1X+i*y.lin1Y+s*y.lin1Z,u-=a*y.lin2X+o*y.lin2Y+n*y.lin2Z,u+=e*y.ang1X+r*y.ang1Y+_*y.ang1Z,u-=l*y.ang2X+h*y.ang2Y+c*y.ang2Z;let g=0;y=p.jacobianB,g+=t*y.lin1X+i*y.lin1Y+s*y.lin1Z,g-=a*y.lin2X+o*y.lin2Y+n*y.lin2Z,g+=e*y.ang1X+r*y.ang1Y+_*y.ang1Z,g-=l*y.ang2X+h*y.ang2Y+c*y.ang2Z;let v=-(u*x.massTB00+g*x.massTB01),d=-(u*x.massTB10+g*x.massTB11),X=f.impulseT,z=f.impulseB;f.impulseT+=v,f.impulseB+=d;let Y=p.friction*f.impulseN;if(0==Y)f.impulseT=0,f.impulseB=0;else{let t=f.impulseT*f.impulseT+f.impulseB*f.impulseB;if(t>Y*Y){let i=Y/Math.sqrt(t);f.impulseT*=i,f.impulseB*=i}}v=f.impulseT-X,d=f.impulseB-z,t+=x.invMLinT1X*v,i+=x.invMLinT1Y*v,s+=x.invMLinT1Z*v,t+=x.invMLinB1X*d,i+=x.invMLinB1Y*d,s+=x.invMLinB1Z*d,a+=x.invMLinT2X*-v,o+=x.invMLinT2Y*-v,n+=x.invMLinT2Z*-v,a+=x.invMLinB2X*-d,o+=x.invMLinB2Y*-d,n+=x.invMLinB2Z*-d,e+=x.invMAngT1X*v,r+=x.invMAngT1Y*v,_+=x.invMAngT1Z*v,e+=x.invMAngB1X*d,r+=x.invMAngB1Y*d,_+=x.invMAngB1Z*d,l+=x.invMAngT2X*-v,h+=x.invMAngT2Y*-v,c+=x.invMAngT2Z*-v,l+=x.invMAngB2X*-d,h+=x.invMAngB2Y*-d,c+=x.invMAngB2Z*-d}let p=0,x=this.info.numRows;for(;p<x;){let m=p++,b=this.info.rows[m],x=this.massData[m],f=b.impulse,u=0,y=b.jacobianN;u+=t*y.lin1X+i*y.lin1Y+s*y.lin1Z,u-=a*y.lin2X+o*y.lin2Y+n*y.lin2Z,u+=e*y.ang1X+r*y.ang1Y+_*y.ang1Z,u-=l*y.ang2X+h*y.ang2Y+c*y.ang2Z;let g=(b.rhs-u)*x.massN,v=f.impulseN;f.impulseN+=g,f.impulseN<0&&(f.impulseN=0),g=f.impulseN-v,t+=x.invMLinN1X*g,i+=x.invMLinN1Y*g,s+=x.invMLinN1Z*g,a+=x.invMLinN2X*-g,o+=x.invMLinN2Y*-g,n+=x.invMLinN2Z*-g,e+=x.invMAngN1X*g,r+=x.invMAngN1Y*g,_+=x.invMAngN1Z*g,l+=x.invMAngN2X*-g,h+=x.invMAngN2Y*-g,c+=x.invMAngN2Z*-g}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=s,this._b2._velX=a,this._b2._velY=o,this._b2._velZ=n,this._b1._angVelX=e,this._b1._angVelY=r,this._b1._angVelZ=_,this._b2._angVelX=l,this._b2._angVelY=h,this._b2._angVelZ=c}preSolvePosition(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g=this._b1._invMass,v=this._b2._invMass;i=this._b1._invInertia00,s=this._b1._invInertia01,a=this._b1._invInertia02,o=this._b1._invInertia10,n=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,l=this._b1._invInertia22,h=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,p=this._b2._invInertia11,x=this._b2._invInertia12,f=this._b2._invInertia20,u=this._b2._invInertia21,y=this._b2._invInertia22;let d=0,X=this.info.numRows;for(;d<X;){let t,X,z,Y,Z,M,I=d++,V=this.massData[I],w=this.info.rows[I].jacobianN;V.invMLinN1X=w.lin1X*g,V.invMLinN1Y=w.lin1Y*g,V.invMLinN1Z=w.lin1Z*g,V.invMLinN2X=w.lin2X*v,V.invMLinN2Y=w.lin2Y*v,V.invMLinN2Z=w.lin2Z*v,t=i*w.ang1X+s*w.ang1Y+a*w.ang1Z,X=o*w.ang1X+n*w.ang1Y+e*w.ang1Z,z=r*w.ang1X+_*w.ang1Y+l*w.ang1Z,V.invMAngN1X=t,V.invMAngN1Y=X,V.invMAngN1Z=z,Y=h*w.ang2X+c*w.ang2Y+m*w.ang2Z,Z=b*w.ang2X+p*w.ang2Y+x*w.ang2Z,M=f*w.ang2X+u*w.ang2Y+y*w.ang2Z,V.invMAngN2X=Y,V.invMAngN2Y=Z,V.invMAngN2Z=M,V.massN=g+v+(V.invMAngN1X*w.ang1X+V.invMAngN1Y*w.ang1Y+V.invMAngN1Z*w.ang1Z)+(V.invMAngN2X*w.ang2X+V.invMAngN2Y*w.ang2Y+V.invMAngN2Z*w.ang2Z),0!=V.massN&&(V.massN=1/V.massN)}let z=0,Y=this.info.numRows;for(;z<Y;)this.info.rows[z++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,i,s,o,n,e,r,_,l,h,c,m;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,s=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,n=this._b2._pseudoVelY,e=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,_=this._b1._angPseudoVelY,l=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,c=this._b2._angPseudoVelY,m=this._b2._angPseudoVelZ;let b=0,p=this.info.numRows;for(;b<p;){let p=b++,x=this.info.rows[p],f=this.massData[p],u=x.impulse,y=x.jacobianN,g=0;g+=t*y.lin1X+i*y.lin1Y+s*y.lin1Z,g-=o*y.lin2X+n*y.lin2Y+e*y.lin2Z,g+=r*y.ang1X+_*y.ang1Y+l*y.ang1Z,g-=h*y.ang2X+c*y.ang2Y+m*y.ang2Z;let v=(x.rhs-g)*f.massN*a.common.Setting.positionSplitImpulseBaumgarte,d=u.impulseP;u.impulseP+=v,u.impulseP<0&&(u.impulseP=0),v=u.impulseP-d,t+=f.invMLinN1X*v,i+=f.invMLinN1Y*v,s+=f.invMLinN1Z*v,o+=f.invMLinN2X*-v,n+=f.invMLinN2Y*-v,e+=f.invMLinN2Z*-v,r+=f.invMAngN1X*v,_+=f.invMAngN1Y*v,l+=f.invMAngN1Z*v,h+=f.invMAngN2X*-v,c+=f.invMAngN2Y*-v,m+=f.invMAngN2Z*-v}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=s,this._b2._pseudoVelX=o,this._b2._pseudoVelY=n,this._b2._pseudoVelZ=e,this._b1._angPseudoVelX=r,this._b1._angPseudoVelY=_,this._b1._angPseudoVelZ=l,this._b2._angPseudoVelX=h,this._b2._angPseudoVelY=c,this._b2._angPseudoVelZ=m}solvePositionNgs(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);let i,s,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v=this._b1._invMass,d=this._b2._invMass;i=this._b1._invInertia00,s=this._b1._invInertia01,o=this._b1._invInertia02,n=this._b1._invInertia10,e=this._b1._invInertia11,r=this._b1._invInertia12,_=this._b1._invInertia20,l=this._b1._invInertia21,h=this._b1._invInertia22,c=this._b2._invInertia00,m=this._b2._invInertia01,b=this._b2._invInertia02,p=this._b2._invInertia10,x=this._b2._invInertia11,f=this._b2._invInertia12,u=this._b2._invInertia20,y=this._b2._invInertia21,g=this._b2._invInertia22;let X,z,Y,Z,M,I,V,w,L,k,A,B,P=0,S=this.info.numRows;for(;P<S;){let t,a,X,z,Y,Z,M=P++,I=this.massData[M],V=this.info.rows[M].jacobianN;I.invMLinN1X=V.lin1X*v,I.invMLinN1Y=V.lin1Y*v,I.invMLinN1Z=V.lin1Z*v,I.invMLinN2X=V.lin2X*d,I.invMLinN2Y=V.lin2Y*d,I.invMLinN2Z=V.lin2Z*d,t=i*V.ang1X+s*V.ang1Y+o*V.ang1Z,a=n*V.ang1X+e*V.ang1Y+r*V.ang1Z,X=_*V.ang1X+l*V.ang1Y+h*V.ang1Z,I.invMAngN1X=t,I.invMAngN1Y=a,I.invMAngN1Z=X,z=c*V.ang2X+m*V.ang2Y+b*V.ang2Z,Y=p*V.ang2X+x*V.ang2Y+f*V.ang2Z,Z=u*V.ang2X+y*V.ang2Y+g*V.ang2Z,I.invMAngN2X=z,I.invMAngN2Y=Y,I.invMAngN2Z=Z,I.massN=v+d+(I.invMAngN1X*V.ang1X+I.invMAngN1Y*V.ang1Y+I.invMAngN1Z*V.ang1Z)+(I.invMAngN2X*V.ang2X+I.invMAngN2Y*V.ang2Y+I.invMAngN2Z*V.ang2Z),0!=I.massN&&(I.massN=1/I.massN)}X=0,z=0,Y=0,Z=0,M=0,I=0,V=0,w=0,L=0,k=0,A=0,B=0;let T=0,C=this.info.numRows;for(;T<C;){let t=T++,i=this.info.rows[t],s=this.massData[t],o=i.impulse,n=i.jacobianN,e=0;e+=X*n.lin1X+z*n.lin1Y+Y*n.lin1Z,e-=Z*n.lin2X+M*n.lin2Y+I*n.lin2Z,e+=V*n.ang1X+w*n.ang1Y+L*n.ang1Z,e-=k*n.ang2X+A*n.ang2Y+B*n.ang2Z;let r=(i.rhs-e)*s.massN*a.common.Setting.positionNgsBaumgarte,_=o.impulseP;o.impulseP+=r,o.impulseP<0&&(o.impulseP=0),r=o.impulseP-_,X+=s.invMLinN1X*r,z+=s.invMLinN1Y*r,Y+=s.invMLinN1Z*r,Z+=s.invMLinN2X*-r,M+=s.invMLinN2Y*-r,I+=s.invMLinN2Z*-r,V+=s.invMAngN1X*r,w+=s.invMAngN1Y*r,L+=s.invMAngN1Z*r,k+=s.invMAngN2X*-r,A+=s.invMAngN2Y*-r,B+=s.invMAngN2Z*-r}let j=this._b1;j._transform._positionX+=X,j._transform._positionY+=z,j._transform._positionZ+=Y;let R=this._b2;R._transform._positionX+=Z,R._transform._positionY+=M,R._transform._positionZ+=I;let q,E,D,N,F,W,J,G,O,U,H,Q,K,$=this._b1,tt=Math.sqrt(V*V+w*w+L*L),it=.5*tt;if(it<.5){let t=it*it;q=.5*(1-.16666666666666666*t+t*t*.008333333333333333),E=1-.5*t+t*t*.041666666666666664}else q=Math.sin(it)/tt,E=Math.cos(it);D=V*q,N=w*q,F=L*q,W=D,J=N,G=F,O=E;let st,at=$._transform._rotation00,ot=$._transform._rotation11,nt=$._transform._rotation22,et=at+ot+nt;et>0?(st=Math.sqrt(et+1),K=.5*st,st=.5/st,U=($._transform._rotation21-$._transform._rotation12)*st,H=($._transform._rotation02-$._transform._rotation20)*st,Q=($._transform._rotation10-$._transform._rotation01)*st):at>ot?at>nt?(st=Math.sqrt(at-ot-nt+1),U=.5*st,st=.5/st,H=($._transform._rotation01+$._transform._rotation10)*st,Q=($._transform._rotation02+$._transform._rotation20)*st,K=($._transform._rotation21-$._transform._rotation12)*st):(st=Math.sqrt(nt-at-ot+1),Q=.5*st,st=.5/st,U=($._transform._rotation02+$._transform._rotation20)*st,H=($._transform._rotation12+$._transform._rotation21)*st,K=($._transform._rotation10-$._transform._rotation01)*st):ot>nt?(st=Math.sqrt(ot-nt-at+1),H=.5*st,st=.5/st,U=($._transform._rotation01+$._transform._rotation10)*st,Q=($._transform._rotation12+$._transform._rotation21)*st,K=($._transform._rotation02-$._transform._rotation20)*st):(st=Math.sqrt(nt-at-ot+1),Q=.5*st,st=.5/st,U=($._transform._rotation02+$._transform._rotation20)*st,H=($._transform._rotation12+$._transform._rotation21)*st,K=($._transform._rotation10-$._transform._rotation01)*st),U=O*U+W*K+J*Q-G*H,H=O*H-W*Q+J*K+G*U,Q=O*Q+W*H-J*U+G*K,K=O*K-W*U-J*H-G*Q;let rt=U*U+H*H+Q*Q+K*K;rt>1e-32&&(rt=1/Math.sqrt(rt)),U*=rt,H*=rt,Q*=rt,K*=rt;let _t,lt,ht,ct,mt,bt,pt,xt,ft,ut,yt,gt,vt,dt,Xt,zt,Yt,Zt,Mt=2*U,It=2*H,Vt=2*Q,wt=U*Mt,Lt=H*It,kt=Q*Vt,At=U*It,Bt=H*Vt,Pt=U*Vt,St=K*Mt,Tt=K*It,Ct=K*Vt;$._transform._rotation00=1-Lt-kt,$._transform._rotation01=At-Ct,$._transform._rotation02=Pt+Tt,$._transform._rotation10=At+Ct,$._transform._rotation11=1-wt-kt,$._transform._rotation12=Bt-St,$._transform._rotation20=Pt-Tt,$._transform._rotation21=Bt+St,$._transform._rotation22=1-wt-Lt,_t=$._transform._rotation00*$._invLocalInertia00+$._transform._rotation01*$._invLocalInertia10+$._transform._rotation02*$._invLocalInertia20,lt=$._transform._rotation00*$._invLocalInertia01+$._transform._rotation01*$._invLocalInertia11+$._transform._rotation02*$._invLocalInertia21,ht=$._transform._rotation00*$._invLocalInertia02+$._transform._rotation01*$._invLocalInertia12+$._transform._rotation02*$._invLocalInertia22,ct=$._transform._rotation10*$._invLocalInertia00+$._transform._rotation11*$._invLocalInertia10+$._transform._rotation12*$._invLocalInertia20,mt=$._transform._rotation10*$._invLocalInertia01+$._transform._rotation11*$._invLocalInertia11+$._transform._rotation12*$._invLocalInertia21,bt=$._transform._rotation10*$._invLocalInertia02+$._transform._rotation11*$._invLocalInertia12+$._transform._rotation12*$._invLocalInertia22,pt=$._transform._rotation20*$._invLocalInertia00+$._transform._rotation21*$._invLocalInertia10+$._transform._rotation22*$._invLocalInertia20,xt=$._transform._rotation20*$._invLocalInertia01+$._transform._rotation21*$._invLocalInertia11+$._transform._rotation22*$._invLocalInertia21,ft=$._transform._rotation20*$._invLocalInertia02+$._transform._rotation21*$._invLocalInertia12+$._transform._rotation22*$._invLocalInertia22,$._invInertia00=_t,$._invInertia01=lt,$._invInertia02=ht,$._invInertia10=ct,$._invInertia11=mt,$._invInertia12=bt,$._invInertia20=pt,$._invInertia21=xt,$._invInertia22=ft,ut=$._invInertia00*$._transform._rotation00+$._invInertia01*$._transform._rotation01+$._invInertia02*$._transform._rotation02,yt=$._invInertia00*$._transform._rotation10+$._invInertia01*$._transform._rotation11+$._invInertia02*$._transform._rotation12,gt=$._invInertia00*$._transform._rotation20+$._invInertia01*$._transform._rotation21+$._invInertia02*$._transform._rotation22,vt=$._invInertia10*$._transform._rotation00+$._invInertia11*$._transform._rotation01+$._invInertia12*$._transform._rotation02,dt=$._invInertia10*$._transform._rotation10+$._invInertia11*$._transform._rotation11+$._invInertia12*$._transform._rotation12,Xt=$._invInertia10*$._transform._rotation20+$._invInertia11*$._transform._rotation21+$._invInertia12*$._transform._rotation22,zt=$._invInertia20*$._transform._rotation00+$._invInertia21*$._transform._rotation01+$._invInertia22*$._transform._rotation02,Yt=$._invInertia20*$._transform._rotation10+$._invInertia21*$._transform._rotation11+$._invInertia22*$._transform._rotation12,Zt=$._invInertia20*$._transform._rotation20+$._invInertia21*$._transform._rotation21+$._invInertia22*$._transform._rotation22,$._invInertia00=ut,$._invInertia01=yt,$._invInertia02=gt,$._invInertia10=vt,$._invInertia11=dt,$._invInertia12=Xt,$._invInertia20=zt,$._invInertia21=Yt,$._invInertia22=Zt,$._invInertia00*=$._rotFactor.x,$._invInertia01*=$._rotFactor.x,$._invInertia02*=$._rotFactor.x,$._invInertia10*=$._rotFactor.y,$._invInertia11*=$._rotFactor.y,$._invInertia12*=$._rotFactor.y,$._invInertia20*=$._rotFactor.z,$._invInertia21*=$._rotFactor.z,$._invInertia22*=$._rotFactor.z;let jt,Rt,qt,Et,Dt,Nt,Ft,Wt,Jt,Gt,Ot,Ut,Ht,Qt=this._b2,Kt=Math.sqrt(k*k+A*A+B*B),$t=.5*Kt;if($t<.5){let t=$t*$t;jt=.5*(1-.16666666666666666*t+t*t*.008333333333333333),Rt=1-.5*t+t*t*.041666666666666664}else jt=Math.sin($t)/Kt,Rt=Math.cos($t);qt=k*jt,Et=A*jt,Dt=B*jt,Nt=qt,Ft=Et,Wt=Dt,Jt=Rt;let ti,ii=Qt._transform._rotation00,si=Qt._transform._rotation11,ai=Qt._transform._rotation22,oi=ii+si+ai;oi>0?(ti=Math.sqrt(oi+1),Ht=.5*ti,ti=.5/ti,Gt=(Qt._transform._rotation21-Qt._transform._rotation12)*ti,Ot=(Qt._transform._rotation02-Qt._transform._rotation20)*ti,Ut=(Qt._transform._rotation10-Qt._transform._rotation01)*ti):ii>si?ii>ai?(ti=Math.sqrt(ii-si-ai+1),Gt=.5*ti,ti=.5/ti,Ot=(Qt._transform._rotation01+Qt._transform._rotation10)*ti,Ut=(Qt._transform._rotation02+Qt._transform._rotation20)*ti,Ht=(Qt._transform._rotation21-Qt._transform._rotation12)*ti):(ti=Math.sqrt(ai-ii-si+1),Ut=.5*ti,ti=.5/ti,Gt=(Qt._transform._rotation02+Qt._transform._rotation20)*ti,Ot=(Qt._transform._rotation12+Qt._transform._rotation21)*ti,Ht=(Qt._transform._rotation10-Qt._transform._rotation01)*ti):si>ai?(ti=Math.sqrt(si-ai-ii+1),Ot=.5*ti,ti=.5/ti,Gt=(Qt._transform._rotation01+Qt._transform._rotation10)*ti,Ut=(Qt._transform._rotation12+Qt._transform._rotation21)*ti,Ht=(Qt._transform._rotation02-Qt._transform._rotation20)*ti):(ti=Math.sqrt(ai-ii-si+1),Ut=.5*ti,ti=.5/ti,Gt=(Qt._transform._rotation02+Qt._transform._rotation20)*ti,Ot=(Qt._transform._rotation12+Qt._transform._rotation21)*ti,Ht=(Qt._transform._rotation10-Qt._transform._rotation01)*ti),Gt=Jt*Gt+Nt*Ht+Ft*Ut-Wt*Ot,Ot=Jt*Ot-Nt*Ut+Ft*Ht+Wt*Gt,Ut=Jt*Ut+Nt*Ot-Ft*Gt+Wt*Ht,Ht=Jt*Ht-Nt*Gt-Ft*Ot-Wt*Ut;let ni=Gt*Gt+Ot*Ot+Ut*Ut+Ht*Ht;ni>1e-32&&(ni=1/Math.sqrt(ni)),Gt*=ni,Ot*=ni,Ut*=ni,Ht*=ni;let ei,ri,_i,li,hi,ci,mi,bi,pi,xi,fi,ui,yi,gi,vi,di,Xi,zi,Yi=2*Gt,Zi=2*Ot,Mi=2*Ut,Ii=Gt*Yi,Vi=Ot*Zi,wi=Ut*Mi,Li=Gt*Zi,ki=Ot*Mi,Ai=Gt*Mi,Bi=Ht*Yi,Pi=Ht*Zi,Si=Ht*Mi;Qt._transform._rotation00=1-Vi-wi,Qt._transform._rotation01=Li-Si,Qt._transform._rotation02=Ai+Pi,Qt._transform._rotation10=Li+Si,Qt._transform._rotation11=1-Ii-wi,Qt._transform._rotation12=ki-Bi,Qt._transform._rotation20=Ai-Pi,Qt._transform._rotation21=ki+Bi,Qt._transform._rotation22=1-Ii-Vi,ei=Qt._transform._rotation00*Qt._invLocalInertia00+Qt._transform._rotation01*Qt._invLocalInertia10+Qt._transform._rotation02*Qt._invLocalInertia20,ri=Qt._transform._rotation00*Qt._invLocalInertia01+Qt._transform._rotation01*Qt._invLocalInertia11+Qt._transform._rotation02*Qt._invLocalInertia21,_i=Qt._transform._rotation00*Qt._invLocalInertia02+Qt._transform._rotation01*Qt._invLocalInertia12+Qt._transform._rotation02*Qt._invLocalInertia22,li=Qt._transform._rotation10*Qt._invLocalInertia00+Qt._transform._rotation11*Qt._invLocalInertia10+Qt._transform._rotation12*Qt._invLocalInertia20,hi=Qt._transform._rotation10*Qt._invLocalInertia01+Qt._transform._rotation11*Qt._invLocalInertia11+Qt._transform._rotation12*Qt._invLocalInertia21,ci=Qt._transform._rotation10*Qt._invLocalInertia02+Qt._transform._rotation11*Qt._invLocalInertia12+Qt._transform._rotation12*Qt._invLocalInertia22,mi=Qt._transform._rotation20*Qt._invLocalInertia00+Qt._transform._rotation21*Qt._invLocalInertia10+Qt._transform._rotation22*Qt._invLocalInertia20,bi=Qt._transform._rotation20*Qt._invLocalInertia01+Qt._transform._rotation21*Qt._invLocalInertia11+Qt._transform._rotation22*Qt._invLocalInertia21,pi=Qt._transform._rotation20*Qt._invLocalInertia02+Qt._transform._rotation21*Qt._invLocalInertia12+Qt._transform._rotation22*Qt._invLocalInertia22,Qt._invInertia00=ei,Qt._invInertia01=ri,Qt._invInertia02=_i,Qt._invInertia10=li,Qt._invInertia11=hi,Qt._invInertia12=ci,Qt._invInertia20=mi,Qt._invInertia21=bi,Qt._invInertia22=pi,xi=Qt._invInertia00*Qt._transform._rotation00+Qt._invInertia01*Qt._transform._rotation01+Qt._invInertia02*Qt._transform._rotation02,fi=Qt._invInertia00*Qt._transform._rotation10+Qt._invInertia01*Qt._transform._rotation11+Qt._invInertia02*Qt._transform._rotation12,ui=Qt._invInertia00*Qt._transform._rotation20+Qt._invInertia01*Qt._transform._rotation21+Qt._invInertia02*Qt._transform._rotation22,yi=Qt._invInertia10*Qt._transform._rotation00+Qt._invInertia11*Qt._transform._rotation01+Qt._invInertia12*Qt._transform._rotation02,gi=Qt._invInertia10*Qt._transform._rotation10+Qt._invInertia11*Qt._transform._rotation11+Qt._invInertia12*Qt._transform._rotation12,vi=Qt._invInertia10*Qt._transform._rotation20+Qt._invInertia11*Qt._transform._rotation21+Qt._invInertia12*Qt._transform._rotation22,di=Qt._invInertia20*Qt._transform._rotation00+Qt._invInertia21*Qt._transform._rotation01+Qt._invInertia22*Qt._transform._rotation02,Xi=Qt._invInertia20*Qt._transform._rotation10+Qt._invInertia21*Qt._transform._rotation11+Qt._invInertia22*Qt._transform._rotation12,zi=Qt._invInertia20*Qt._transform._rotation20+Qt._invInertia21*Qt._transform._rotation21+Qt._invInertia22*Qt._transform._rotation22,Qt._invInertia00=xi,Qt._invInertia01=fi,Qt._invInertia02=ui,Qt._invInertia10=yi,Qt._invInertia11=gi,Qt._invInertia12=vi,Qt._invInertia20=di,Qt._invInertia21=Xi,Qt._invInertia22=zi,Qt._invInertia00*=Qt._rotFactor.x,Qt._invInertia01*=Qt._rotFactor.x,Qt._invInertia02*=Qt._rotFactor.x,Qt._invInertia10*=Qt._rotFactor.y,Qt._invInertia11*=Qt._rotFactor.y,Qt._invInertia12*=Qt._rotFactor.y,Qt._invInertia20*=Qt._rotFactor.z,Qt._invInertia21*=Qt._rotFactor.z,Qt._invInertia22*=Qt._rotFactor.z}postSolve(){let t,i,s,a,o,n,e,r,_;t=0,i=0,s=0,a=0,o=0,n=0,e=0,r=0,_=0;let l=0,h=this.info.numRows;for(;l<h;){let h,c,m,b=this.info.rows[l++],p=b.impulse,x=b.jacobianN,f=b.jacobianT,u=b.jacobianB,y=p.impulseN,g=p.impulseT,v=p.impulseB;h=0,c=0,m=0,h+=f.lin1X*g,c+=f.lin1Y*g,m+=f.lin1Z*g,h+=u.lin1X*v,c+=u.lin1Y*v,m+=u.lin1Z*v,p.impulseLX=h,p.impulseLY=c,p.impulseLZ=m,t+=x.lin1X*y,i+=x.lin1Y*y,s+=x.lin1Z*y,a+=x.ang1X*y,o+=x.ang1Y*y,n+=x.ang1Z*y,e+=x.ang2X*y,r+=x.ang2Y*y,_+=x.ang2Z*y,t+=f.lin1X*g,i+=f.lin1Y*g,s+=f.lin1Z*g,a+=f.ang1X*g,o+=f.ang1Y*g,n+=f.ang1Z*g,e+=f.ang2X*g,r+=f.ang2Y*g,_+=f.ang2Z*g,t+=u.lin1X*v,i+=u.lin1Y*v,s+=u.lin1Z*v,a+=u.ang1X*v,o+=u.ang1Y*v,n+=u.ang1Z*v,e+=u.ang2X*v,r+=u.ang2Y*v,_+=u.ang2Z*v}this._b1._linearContactImpulseX+=t,this._b1._linearContactImpulseY+=i,this._b1._linearContactImpulseZ+=s,this._b1._angularContactImpulseX+=a,this._b1._angularContactImpulseY+=o,this._b1._angularContactImpulseZ+=n,this._b2._linearContactImpulseX-=t,this._b2._linearContactImpulseY-=i,this._b2._linearContactImpulseZ-=s,this._b2._angularContactImpulseX-=e,this._b2._angularContactImpulseY-=r,this._b2._angularContactImpulseZ-=_,this.constraint._syncManifold()}},a.dynamics.constraint.solver.pgs.PgsJointConstraintSolver=class extends a.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.joint=t,this.info=new a.dynamics.constraint.info.joint.JointSolverInfo,this.massData=new Array(a.common.Setting.maxJacobianRows);let i=0,s=this.massData.length;for(;i<s;)this.massData[i++]=new a.dynamics.constraint.solver.common.JointSolverMassDataRow}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g=this._b1._invMass,v=this._b2._invMass;i=this._b1._invInertia00,s=this._b1._invInertia01,a=this._b1._invInertia02,o=this._b1._invInertia10,n=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,l=this._b1._invInertia22,h=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,p=this._b2._invInertia11,x=this._b2._invInertia12,f=this._b2._invInertia20,u=this._b2._invInertia21,y=this._b2._invInertia22;let d=0,X=this.info.numRows;for(;d<X;){let t=d++,X=this.info.rows[t],z=this.massData[t],Y=X.jacobian;if(Y.updateSparsity(),1&Y.flag?(z.invMLin1X=Y.lin1X*g,z.invMLin1Y=Y.lin1Y*g,z.invMLin1Z=Y.lin1Z*g,z.invMLin2X=Y.lin2X*v,z.invMLin2Y=Y.lin2Y*v,z.invMLin2Z=Y.lin2Z*v):(z.invMLin1X=0,z.invMLin1Y=0,z.invMLin1Z=0,z.invMLin2X=0,z.invMLin2Y=0,z.invMLin2Z=0),2&Y.flag){let t,g,v,d,X,Z;t=i*Y.ang1X+s*Y.ang1Y+a*Y.ang1Z,g=o*Y.ang1X+n*Y.ang1Y+e*Y.ang1Z,v=r*Y.ang1X+_*Y.ang1Y+l*Y.ang1Z,z.invMAng1X=t,z.invMAng1Y=g,z.invMAng1Z=v,d=h*Y.ang2X+c*Y.ang2Y+m*Y.ang2Z,X=b*Y.ang2X+p*Y.ang2Y+x*Y.ang2Z,Z=f*Y.ang2X+u*Y.ang2Y+y*Y.ang2Z,z.invMAng2X=d,z.invMAng2Y=X,z.invMAng2Z=Z}else z.invMAng1X=0,z.invMAng1Y=0,z.invMAng1Z=0,z.invMAng2X=0,z.invMAng2Y=0,z.invMAng2Z=0;z.massWithoutCfm=z.invMLin1X*Y.lin1X+z.invMLin1Y*Y.lin1Y+z.invMLin1Z*Y.lin1Z+(z.invMLin2X*Y.lin2X+z.invMLin2Y*Y.lin2Y+z.invMLin2Z*Y.lin2Z)+(z.invMAng1X*Y.ang1X+z.invMAng1Y*Y.ang1Y+z.invMAng1Z*Y.ang1Z)+(z.invMAng2X*Y.ang2X+z.invMAng2Y*Y.ang2Y+z.invMAng2Z*Y.ang2Z),z.mass=z.massWithoutCfm+X.cfm,0!=z.massWithoutCfm&&(z.massWithoutCfm=1/z.massWithoutCfm),0!=z.mass&&(z.mass=1/z.mass)}}warmStart(t){let i,s,o,n,e,r,_,l,h,c,m,b,p=this.joint._positionCorrectionAlgorithm==a.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?a.common.Setting.jointWarmStartingFactorForBaungarte:a.common.Setting.jointWarmStartingFactor;if(p*=t.dtRatio,p<=0){let t=0,i=this.info.numRows;for(;t<i;){let i=this.info.rows[t++].impulse;i.impulse=0,i.impulseM=0,i.impulseP=0}return}i=this._b1._velX,s=this._b1._velY,o=this._b1._velZ,n=this._b2._velX,e=this._b2._velY,r=this._b2._velZ,_=this._b1._angVelX,l=this._b1._angVelY,h=this._b1._angVelZ,c=this._b2._angVelX,m=this._b2._angVelY,b=this._b2._angVelZ;let x=0,f=this.info.numRows;for(;x<f;){let t=x++,a=this.massData[t],f=this.info.rows[t].impulse;f.impulse*=p,f.impulseM*=p;let u=f.impulse+f.impulseM;i+=a.invMLin1X*u,s+=a.invMLin1Y*u,o+=a.invMLin1Z*u,n+=a.invMLin2X*-u,e+=a.invMLin2Y*-u,r+=a.invMLin2Z*-u,_+=a.invMAng1X*u,l+=a.invMAng1Y*u,h+=a.invMAng1Z*u,c+=a.invMAng2X*-u,m+=a.invMAng2Y*-u,b+=a.invMAng2Z*-u}this._b1._velX=i,this._b1._velY=s,this._b1._velZ=o,this._b2._velX=n,this._b2._velY=e,this._b2._velZ=r,this._b1._angVelX=_,this._b1._angVelY=l,this._b1._angVelZ=h,this._b2._angVelX=c,this._b2._angVelY=m,this._b2._angVelZ=b}solveVelocity(){let t,i,s,a,o,n,e,r,_,l,h,c;t=this._b1._velX,i=this._b1._velY,s=this._b1._velZ,a=this._b2._velX,o=this._b2._velY,n=this._b2._velZ,e=this._b1._angVelX,r=this._b1._angVelY,_=this._b1._angVelZ,l=this._b2._angVelX,h=this._b2._angVelY,c=this._b2._angVelZ;let m=0,b=this.info.numRows;for(;m<b;){let b=m++,p=this.info.rows[b],x=this.massData[b],f=p.impulse,u=p.jacobian;if(0==p.motorMaxImpulse)continue;let y=0;y+=t*u.lin1X+i*u.lin1Y+s*u.lin1Z,y-=a*u.lin2X+o*u.lin2Y+n*u.lin2Z,y+=e*u.ang1X+r*u.ang1Y+_*u.ang1Z,y-=l*u.ang2X+h*u.ang2Y+c*u.ang2Z;let g=(-p.motorSpeed-y)*x.massWithoutCfm,v=f.impulseM;f.impulseM+=g,f.impulseM<-p.motorMaxImpulse?f.impulseM=-p.motorMaxImpulse:f.impulseM>p.motorMaxImpulse&&(f.impulseM=p.motorMaxImpulse),g=f.impulseM-v,1&u.flag&&(t+=x.invMLin1X*g,i+=x.invMLin1Y*g,s+=x.invMLin1Z*g,a+=x.invMLin2X*-g,o+=x.invMLin2Y*-g,n+=x.invMLin2Z*-g),2&u.flag&&(e+=x.invMAng1X*g,r+=x.invMAng1Y*g,_+=x.invMAng1Z*g,l+=x.invMAng2X*-g,h+=x.invMAng2Y*-g,c+=x.invMAng2Z*-g)}let p=0,x=this.info.numRows;for(;p<x;){let m=p++,b=this.info.rows[m],x=this.massData[m],f=b.impulse,u=b.jacobian,y=0;y+=t*u.lin1X+i*u.lin1Y+s*u.lin1Z,y-=a*u.lin2X+o*u.lin2Y+n*u.lin2Z,y+=e*u.ang1X+r*u.ang1Y+_*u.ang1Z,y-=l*u.ang2X+h*u.ang2Y+c*u.ang2Z;let g=(b.rhs-y-f.impulse*b.cfm)*x.mass,v=f.impulse;f.impulse+=g,f.impulse<b.minImpulse?f.impulse=b.minImpulse:f.impulse>b.maxImpulse&&(f.impulse=b.maxImpulse),g=f.impulse-v,1&u.flag&&(t+=x.invMLin1X*g,i+=x.invMLin1Y*g,s+=x.invMLin1Z*g,a+=x.invMLin2X*-g,o+=x.invMLin2Y*-g,n+=x.invMLin2Z*-g),2&u.flag&&(e+=x.invMAng1X*g,r+=x.invMAng1Y*g,_+=x.invMAng1Z*g,l+=x.invMAng2X*-g,h+=x.invMAng2Y*-g,c+=x.invMAng2Z*-g)}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=s,this._b2._velX=a,this._b2._velY=o,this._b2._velZ=n,this._b1._angVelX=e,this._b1._angVelY=r,this._b1._angVelZ=_,this._b2._angVelX=l,this._b2._angVelY=h,this._b2._angVelZ=c}postSolveVelocity(t){let i,s,a,o,n,e;i=0,s=0,a=0,o=0,n=0,e=0;let r=0,_=this.info.numRows;for(;r<_;){let t=this.info.rows[r++],_=t.impulse,l=t.jacobian;1&l.flag?(i+=l.lin1X*_.impulse,s+=l.lin1Y*_.impulse,a+=l.lin1Z*_.impulse):2&l.flag&&(o+=l.ang1X*_.impulse,n+=l.ang1Y*_.impulse,e+=l.ang1Z*_.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=s*t.invDt,this.joint._appliedForceZ=a*t.invDt,this.joint._appliedTorqueX=o*t.invDt,this.joint._appliedTorqueY=n*t.invDt,this.joint._appliedTorqueZ=e*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g=this._b1._invMass,v=this._b2._invMass;i=this._b1._invInertia00,s=this._b1._invInertia01,a=this._b1._invInertia02,o=this._b1._invInertia10,n=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,l=this._b1._invInertia22,h=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,p=this._b2._invInertia11,x=this._b2._invInertia12,f=this._b2._invInertia20,u=this._b2._invInertia21,y=this._b2._invInertia22;let d=0,X=this.info.numRows;for(;d<X;){let t,X,z,Y,Z,M,I=d++,V=this.massData[I],w=this.info.rows[I].jacobian;V.invMLin1X=w.lin1X*g,V.invMLin1Y=w.lin1Y*g,V.invMLin1Z=w.lin1Z*g,V.invMLin2X=w.lin2X*v,V.invMLin2Y=w.lin2Y*v,V.invMLin2Z=w.lin2Z*v,t=i*w.ang1X+s*w.ang1Y+a*w.ang1Z,X=o*w.ang1X+n*w.ang1Y+e*w.ang1Z,z=r*w.ang1X+_*w.ang1Y+l*w.ang1Z,V.invMAng1X=t,V.invMAng1Y=X,V.invMAng1Z=z,Y=h*w.ang2X+c*w.ang2Y+m*w.ang2Z,Z=b*w.ang2X+p*w.ang2Y+x*w.ang2Z,M=f*w.ang2X+u*w.ang2Y+y*w.ang2Z,V.invMAng2X=Y,V.invMAng2Y=Z,V.invMAng2Z=M,V.mass=V.invMLin1X*w.lin1X+V.invMLin1Y*w.lin1Y+V.invMLin1Z*w.lin1Z+(V.invMLin2X*w.lin2X+V.invMLin2Y*w.lin2Y+V.invMLin2Z*w.lin2Z)+(V.invMAng1X*w.ang1X+V.invMAng1Y*w.ang1Y+V.invMAng1Z*w.ang1Z)+(V.invMAng2X*w.ang2X+V.invMAng2Y*w.ang2Y+V.invMAng2Z*w.ang2Z),0!=V.mass&&(V.mass=1/V.mass)}let z=0,Y=this.info.numRows;for(;z<Y;)this.info.rows[z++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,i,s,o,n,e,r,_,l,h,c,m;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,s=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,n=this._b2._pseudoVelY,e=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,_=this._b1._angPseudoVelY,l=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,c=this._b2._angPseudoVelY,m=this._b2._angPseudoVelZ;let b=0,p=this.info.numRows;for(;b<p;){let p=b++,x=this.info.rows[p],f=this.massData[p],u=x.impulse,y=x.jacobian,g=0;g+=t*y.lin1X+i*y.lin1Y+s*y.lin1Z,g-=o*y.lin2X+n*y.lin2Y+e*y.lin2Z,g+=r*y.ang1X+_*y.ang1Y+l*y.ang1Z,g-=h*y.ang2X+c*y.ang2Y+m*y.ang2Z;let v=(x.rhs*a.common.Setting.positionSplitImpulseBaumgarte-g)*f.mass,d=u.impulseP;u.impulseP+=v,u.impulseP<x.minImpulse?u.impulseP=x.minImpulse:u.impulseP>x.maxImpulse&&(u.impulseP=x.maxImpulse),v=u.impulseP-d,t+=f.invMLin1X*v,i+=f.invMLin1Y*v,s+=f.invMLin1Z*v,o+=f.invMLin2X*-v,n+=f.invMLin2Y*-v,e+=f.invMLin2Z*-v,r+=f.invMAng1X*v,_+=f.invMAng1Y*v,l+=f.invMAng1Z*v,h+=f.invMAng2X*-v,c+=f.invMAng2Y*-v,m+=f.invMAng2Z*-v}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=s,this._b2._pseudoVelX=o,this._b2._pseudoVelY=n,this._b2._pseudoVelZ=e,this._b1._angPseudoVelX=r,this._b1._angPseudoVelY=_,this._b1._angPseudoVelZ=l,this._b2._angPseudoVelX=h,this._b2._angPseudoVelY=c,this._b2._angPseudoVelZ=m}solvePositionNgs(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i,s,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v=this._b1._invMass,d=this._b2._invMass;i=this._b1._invInertia00,s=this._b1._invInertia01,o=this._b1._invInertia02,n=this._b1._invInertia10,e=this._b1._invInertia11,r=this._b1._invInertia12,_=this._b1._invInertia20,l=this._b1._invInertia21,h=this._b1._invInertia22,c=this._b2._invInertia00,m=this._b2._invInertia01,b=this._b2._invInertia02,p=this._b2._invInertia10,x=this._b2._invInertia11,f=this._b2._invInertia12,u=this._b2._invInertia20,y=this._b2._invInertia21,g=this._b2._invInertia22;let X,z,Y,Z,M,I,V,w,L,k,A,B,P=0,S=this.info.numRows;for(;P<S;){let t,a,X,z,Y,Z,M=P++,I=this.massData[M],V=this.info.rows[M].jacobian;I.invMLin1X=V.lin1X*v,I.invMLin1Y=V.lin1Y*v,I.invMLin1Z=V.lin1Z*v,I.invMLin2X=V.lin2X*d,I.invMLin2Y=V.lin2Y*d,I.invMLin2Z=V.lin2Z*d,t=i*V.ang1X+s*V.ang1Y+o*V.ang1Z,a=n*V.ang1X+e*V.ang1Y+r*V.ang1Z,X=_*V.ang1X+l*V.ang1Y+h*V.ang1Z,I.invMAng1X=t,I.invMAng1Y=a,I.invMAng1Z=X,z=c*V.ang2X+m*V.ang2Y+b*V.ang2Z,Y=p*V.ang2X+x*V.ang2Y+f*V.ang2Z,Z=u*V.ang2X+y*V.ang2Y+g*V.ang2Z,I.invMAng2X=z,I.invMAng2Y=Y,I.invMAng2Z=Z,I.mass=I.invMLin1X*V.lin1X+I.invMLin1Y*V.lin1Y+I.invMLin1Z*V.lin1Z+(I.invMLin2X*V.lin2X+I.invMLin2Y*V.lin2Y+I.invMLin2Z*V.lin2Z)+(I.invMAng1X*V.ang1X+I.invMAng1Y*V.ang1Y+I.invMAng1Z*V.ang1Z)+(I.invMAng2X*V.ang2X+I.invMAng2Y*V.ang2Y+I.invMAng2Z*V.ang2Z),0!=I.mass&&(I.mass=1/I.mass)}X=0,z=0,Y=0,Z=0,M=0,I=0,V=0,w=0,L=0,k=0,A=0,B=0;let T=0,C=this.info.numRows;for(;T<C;){let t=T++,i=this.info.rows[t],s=this.massData[t],o=i.impulse,n=i.jacobian,e=0;e+=X*n.lin1X+z*n.lin1Y+Y*n.lin1Z,e-=Z*n.lin2X+M*n.lin2Y+I*n.lin2Z,e+=V*n.ang1X+w*n.ang1Y+L*n.ang1Z,e-=k*n.ang2X+A*n.ang2Y+B*n.ang2Z;let r=(i.rhs*a.common.Setting.positionNgsBaumgarte-e)*s.mass,_=o.impulseP;o.impulseP+=r,o.impulseP<i.minImpulse?o.impulseP=i.minImpulse:o.impulseP>i.maxImpulse&&(o.impulseP=i.maxImpulse),r=o.impulseP-_,X+=s.invMLin1X*r,z+=s.invMLin1Y*r,Y+=s.invMLin1Z*r,Z+=s.invMLin2X*-r,M+=s.invMLin2Y*-r,I+=s.invMLin2Z*-r,V+=s.invMAng1X*r,w+=s.invMAng1Y*r,L+=s.invMAng1Z*r,k+=s.invMAng2X*-r,A+=s.invMAng2Y*-r,B+=s.invMAng2Z*-r}let j=this._b1;j._transform._positionX+=X,j._transform._positionY+=z,j._transform._positionZ+=Y;let R=this._b2;R._transform._positionX+=Z,R._transform._positionY+=M,R._transform._positionZ+=I;let q,E,D,N,F,W,J,G,O,U,H,Q,K,$=this._b1,tt=Math.sqrt(V*V+w*w+L*L),it=.5*tt;if(it<.5){let t=it*it;q=.5*(1-.16666666666666666*t+t*t*.008333333333333333),E=1-.5*t+t*t*.041666666666666664}else q=Math.sin(it)/tt,E=Math.cos(it);D=V*q,N=w*q,F=L*q,W=D,J=N,G=F,O=E;let st,at=$._transform._rotation00,ot=$._transform._rotation11,nt=$._transform._rotation22,et=at+ot+nt;et>0?(st=Math.sqrt(et+1),K=.5*st,st=.5/st,U=($._transform._rotation21-$._transform._rotation12)*st,H=($._transform._rotation02-$._transform._rotation20)*st,Q=($._transform._rotation10-$._transform._rotation01)*st):at>ot?at>nt?(st=Math.sqrt(at-ot-nt+1),U=.5*st,st=.5/st,H=($._transform._rotation01+$._transform._rotation10)*st,Q=($._transform._rotation02+$._transform._rotation20)*st,K=($._transform._rotation21-$._transform._rotation12)*st):(st=Math.sqrt(nt-at-ot+1),Q=.5*st,st=.5/st,U=($._transform._rotation02+$._transform._rotation20)*st,H=($._transform._rotation12+$._transform._rotation21)*st,K=($._transform._rotation10-$._transform._rotation01)*st):ot>nt?(st=Math.sqrt(ot-nt-at+1),H=.5*st,st=.5/st,U=($._transform._rotation01+$._transform._rotation10)*st,Q=($._transform._rotation12+$._transform._rotation21)*st,K=($._transform._rotation02-$._transform._rotation20)*st):(st=Math.sqrt(nt-at-ot+1),Q=.5*st,st=.5/st,U=($._transform._rotation02+$._transform._rotation20)*st,H=($._transform._rotation12+$._transform._rotation21)*st,K=($._transform._rotation10-$._transform._rotation01)*st),U=O*U+W*K+J*Q-G*H,H=O*H-W*Q+J*K+G*U,Q=O*Q+W*H-J*U+G*K,K=O*K-W*U-J*H-G*Q;let rt=U*U+H*H+Q*Q+K*K;rt>1e-32&&(rt=1/Math.sqrt(rt)),U*=rt,H*=rt,Q*=rt,K*=rt;let _t,lt,ht,ct,mt,bt,pt,xt,ft,ut,yt,gt,vt,dt,Xt,zt,Yt,Zt,Mt=2*U,It=2*H,Vt=2*Q,wt=U*Mt,Lt=H*It,kt=Q*Vt,At=U*It,Bt=H*Vt,Pt=U*Vt,St=K*Mt,Tt=K*It,Ct=K*Vt;$._transform._rotation00=1-Lt-kt,$._transform._rotation01=At-Ct,$._transform._rotation02=Pt+Tt,$._transform._rotation10=At+Ct,$._transform._rotation11=1-wt-kt,$._transform._rotation12=Bt-St,$._transform._rotation20=Pt-Tt,$._transform._rotation21=Bt+St,$._transform._rotation22=1-wt-Lt,_t=$._transform._rotation00*$._invLocalInertia00+$._transform._rotation01*$._invLocalInertia10+$._transform._rotation02*$._invLocalInertia20,lt=$._transform._rotation00*$._invLocalInertia01+$._transform._rotation01*$._invLocalInertia11+$._transform._rotation02*$._invLocalInertia21,ht=$._transform._rotation00*$._invLocalInertia02+$._transform._rotation01*$._invLocalInertia12+$._transform._rotation02*$._invLocalInertia22,ct=$._transform._rotation10*$._invLocalInertia00+$._transform._rotation11*$._invLocalInertia10+$._transform._rotation12*$._invLocalInertia20,mt=$._transform._rotation10*$._invLocalInertia01+$._transform._rotation11*$._invLocalInertia11+$._transform._rotation12*$._invLocalInertia21,bt=$._transform._rotation10*$._invLocalInertia02+$._transform._rotation11*$._invLocalInertia12+$._transform._rotation12*$._invLocalInertia22,pt=$._transform._rotation20*$._invLocalInertia00+$._transform._rotation21*$._invLocalInertia10+$._transform._rotation22*$._invLocalInertia20,xt=$._transform._rotation20*$._invLocalInertia01+$._transform._rotation21*$._invLocalInertia11+$._transform._rotation22*$._invLocalInertia21,ft=$._transform._rotation20*$._invLocalInertia02+$._transform._rotation21*$._invLocalInertia12+$._transform._rotation22*$._invLocalInertia22,$._invInertia00=_t,$._invInertia01=lt,$._invInertia02=ht,$._invInertia10=ct,$._invInertia11=mt,$._invInertia12=bt,$._invInertia20=pt,$._invInertia21=xt,$._invInertia22=ft,ut=$._invInertia00*$._transform._rotation00+$._invInertia01*$._transform._rotation01+$._invInertia02*$._transform._rotation02,yt=$._invInertia00*$._transform._rotation10+$._invInertia01*$._transform._rotation11+$._invInertia02*$._transform._rotation12,gt=$._invInertia00*$._transform._rotation20+$._invInertia01*$._transform._rotation21+$._invInertia02*$._transform._rotation22,vt=$._invInertia10*$._transform._rotation00+$._invInertia11*$._transform._rotation01+$._invInertia12*$._transform._rotation02,dt=$._invInertia10*$._transform._rotation10+$._invInertia11*$._transform._rotation11+$._invInertia12*$._transform._rotation12,Xt=$._invInertia10*$._transform._rotation20+$._invInertia11*$._transform._rotation21+$._invInertia12*$._transform._rotation22,zt=$._invInertia20*$._transform._rotation00+$._invInertia21*$._transform._rotation01+$._invInertia22*$._transform._rotation02,Yt=$._invInertia20*$._transform._rotation10+$._invInertia21*$._transform._rotation11+$._invInertia22*$._transform._rotation12,Zt=$._invInertia20*$._transform._rotation20+$._invInertia21*$._transform._rotation21+$._invInertia22*$._transform._rotation22,$._invInertia00=ut,$._invInertia01=yt,$._invInertia02=gt,$._invInertia10=vt,$._invInertia11=dt,$._invInertia12=Xt,$._invInertia20=zt,$._invInertia21=Yt,$._invInertia22=Zt,$._invInertia00*=$._rotFactor.x,$._invInertia01*=$._rotFactor.x,$._invInertia02*=$._rotFactor.x,$._invInertia10*=$._rotFactor.y,$._invInertia11*=$._rotFactor.y,$._invInertia12*=$._rotFactor.y,$._invInertia20*=$._rotFactor.z,$._invInertia21*=$._rotFactor.z,$._invInertia22*=$._rotFactor.z;let jt,Rt,qt,Et,Dt,Nt,Ft,Wt,Jt,Gt,Ot,Ut,Ht,Qt=this._b2,Kt=Math.sqrt(k*k+A*A+B*B),$t=.5*Kt;if($t<.5){let t=$t*$t;jt=.5*(1-.16666666666666666*t+t*t*.008333333333333333),Rt=1-.5*t+t*t*.041666666666666664}else jt=Math.sin($t)/Kt,Rt=Math.cos($t);qt=k*jt,Et=A*jt,Dt=B*jt,Nt=qt,Ft=Et,Wt=Dt,Jt=Rt;let ti,ii=Qt._transform._rotation00,si=Qt._transform._rotation11,ai=Qt._transform._rotation22,oi=ii+si+ai;oi>0?(ti=Math.sqrt(oi+1),Ht=.5*ti,ti=.5/ti,Gt=(Qt._transform._rotation21-Qt._transform._rotation12)*ti,Ot=(Qt._transform._rotation02-Qt._transform._rotation20)*ti,Ut=(Qt._transform._rotation10-Qt._transform._rotation01)*ti):ii>si?ii>ai?(ti=Math.sqrt(ii-si-ai+1),Gt=.5*ti,ti=.5/ti,Ot=(Qt._transform._rotation01+Qt._transform._rotation10)*ti,Ut=(Qt._transform._rotation02+Qt._transform._rotation20)*ti,Ht=(Qt._transform._rotation21-Qt._transform._rotation12)*ti):(ti=Math.sqrt(ai-ii-si+1),Ut=.5*ti,ti=.5/ti,Gt=(Qt._transform._rotation02+Qt._transform._rotation20)*ti,Ot=(Qt._transform._rotation12+Qt._transform._rotation21)*ti,Ht=(Qt._transform._rotation10-Qt._transform._rotation01)*ti):si>ai?(ti=Math.sqrt(si-ai-ii+1),Ot=.5*ti,ti=.5/ti,Gt=(Qt._transform._rotation01+Qt._transform._rotation10)*ti,Ut=(Qt._transform._rotation12+Qt._transform._rotation21)*ti,Ht=(Qt._transform._rotation02-Qt._transform._rotation20)*ti):(ti=Math.sqrt(ai-ii-si+1),Ut=.5*ti,ti=.5/ti,Gt=(Qt._transform._rotation02+Qt._transform._rotation20)*ti,Ot=(Qt._transform._rotation12+Qt._transform._rotation21)*ti,Ht=(Qt._transform._rotation10-Qt._transform._rotation01)*ti),Gt=Jt*Gt+Nt*Ht+Ft*Ut-Wt*Ot,Ot=Jt*Ot-Nt*Ut+Ft*Ht+Wt*Gt,Ut=Jt*Ut+Nt*Ot-Ft*Gt+Wt*Ht,Ht=Jt*Ht-Nt*Gt-Ft*Ot-Wt*Ut;let ni=Gt*Gt+Ot*Ot+Ut*Ut+Ht*Ht;ni>1e-32&&(ni=1/Math.sqrt(ni)),Gt*=ni,Ot*=ni,Ut*=ni,Ht*=ni;let ei,ri,_i,li,hi,ci,mi,bi,pi,xi,fi,ui,yi,gi,vi,di,Xi,zi,Yi=2*Gt,Zi=2*Ot,Mi=2*Ut,Ii=Gt*Yi,Vi=Ot*Zi,wi=Ut*Mi,Li=Gt*Zi,ki=Ot*Mi,Ai=Gt*Mi,Bi=Ht*Yi,Pi=Ht*Zi,Si=Ht*Mi;Qt._transform._rotation00=1-Vi-wi,Qt._transform._rotation01=Li-Si,Qt._transform._rotation02=Ai+Pi,Qt._transform._rotation10=Li+Si,Qt._transform._rotation11=1-Ii-wi,Qt._transform._rotation12=ki-Bi,Qt._transform._rotation20=Ai-Pi,Qt._transform._rotation21=ki+Bi,Qt._transform._rotation22=1-Ii-Vi,ei=Qt._transform._rotation00*Qt._invLocalInertia00+Qt._transform._rotation01*Qt._invLocalInertia10+Qt._transform._rotation02*Qt._invLocalInertia20,ri=Qt._transform._rotation00*Qt._invLocalInertia01+Qt._transform._rotation01*Qt._invLocalInertia11+Qt._transform._rotation02*Qt._invLocalInertia21,_i=Qt._transform._rotation00*Qt._invLocalInertia02+Qt._transform._rotation01*Qt._invLocalInertia12+Qt._transform._rotation02*Qt._invLocalInertia22,li=Qt._transform._rotation10*Qt._invLocalInertia00+Qt._transform._rotation11*Qt._invLocalInertia10+Qt._transform._rotation12*Qt._invLocalInertia20,hi=Qt._transform._rotation10*Qt._invLocalInertia01+Qt._transform._rotation11*Qt._invLocalInertia11+Qt._transform._rotation12*Qt._invLocalInertia21,ci=Qt._transform._rotation10*Qt._invLocalInertia02+Qt._transform._rotation11*Qt._invLocalInertia12+Qt._transform._rotation12*Qt._invLocalInertia22,mi=Qt._transform._rotation20*Qt._invLocalInertia00+Qt._transform._rotation21*Qt._invLocalInertia10+Qt._transform._rotation22*Qt._invLocalInertia20,bi=Qt._transform._rotation20*Qt._invLocalInertia01+Qt._transform._rotation21*Qt._invLocalInertia11+Qt._transform._rotation22*Qt._invLocalInertia21,pi=Qt._transform._rotation20*Qt._invLocalInertia02+Qt._transform._rotation21*Qt._invLocalInertia12+Qt._transform._rotation22*Qt._invLocalInertia22,Qt._invInertia00=ei,Qt._invInertia01=ri,Qt._invInertia02=_i,Qt._invInertia10=li,Qt._invInertia11=hi,Qt._invInertia12=ci,Qt._invInertia20=mi,Qt._invInertia21=bi,Qt._invInertia22=pi,xi=Qt._invInertia00*Qt._transform._rotation00+Qt._invInertia01*Qt._transform._rotation01+Qt._invInertia02*Qt._transform._rotation02,fi=Qt._invInertia00*Qt._transform._rotation10+Qt._invInertia01*Qt._transform._rotation11+Qt._invInertia02*Qt._transform._rotation12,ui=Qt._invInertia00*Qt._transform._rotation20+Qt._invInertia01*Qt._transform._rotation21+Qt._invInertia02*Qt._transform._rotation22,yi=Qt._invInertia10*Qt._transform._rotation00+Qt._invInertia11*Qt._transform._rotation01+Qt._invInertia12*Qt._transform._rotation02,gi=Qt._invInertia10*Qt._transform._rotation10+Qt._invInertia11*Qt._transform._rotation11+Qt._invInertia12*Qt._transform._rotation12,vi=Qt._invInertia10*Qt._transform._rotation20+Qt._invInertia11*Qt._transform._rotation21+Qt._invInertia12*Qt._transform._rotation22,di=Qt._invInertia20*Qt._transform._rotation00+Qt._invInertia21*Qt._transform._rotation01+Qt._invInertia22*Qt._transform._rotation02,Xi=Qt._invInertia20*Qt._transform._rotation10+Qt._invInertia21*Qt._transform._rotation11+Qt._invInertia22*Qt._transform._rotation12,zi=Qt._invInertia20*Qt._transform._rotation20+Qt._invInertia21*Qt._transform._rotation21+Qt._invInertia22*Qt._transform._rotation22,Qt._invInertia00=xi,Qt._invInertia01=fi,Qt._invInertia02=ui,Qt._invInertia10=yi,Qt._invInertia11=gi,Qt._invInertia12=vi,Qt._invInertia20=di,Qt._invInertia21=Xi,Qt._invInertia22=zi,Qt._invInertia00*=Qt._rotFactor.x,Qt._invInertia01*=Qt._rotFactor.x,Qt._invInertia02*=Qt._rotFactor.x,Qt._invInertia10*=Qt._rotFactor.y,Qt._invInertia11*=Qt._rotFactor.y,Qt._invInertia12*=Qt._rotFactor.y,Qt._invInertia20*=Qt._rotFactor.z,Qt._invInertia21*=Qt._rotFactor.z,Qt._invInertia22*=Qt._rotFactor.z}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}},a.dynamics.rigidbody||(a.dynamics.rigidbody={}),a.dynamics.rigidbody.MassData=class{constructor(){this.mass=0,this.localInertia=new a.common.Mat3}},a.dynamics.rigidbody.RigidBody=class{constructor(t){this._next=null,this._prev=null,this._shapeList=null,this._shapeListLast=null,this._numShapes=0,this._contactLinkList=null,this._contactLinkListLast=null,this._numContactLinks=0,this._jointLinkList=null,this._jointLinkListLast=null,this._numJointLinks=0;let i=t.linearVelocity;this._velX=i.x,this._velY=i.y,this._velZ=i.z;let s=t.angularVelocity;this._angVelX=s.x,this._angVelY=s.y,this._angVelZ=s.z,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._ptransform=new a.common.Transform,this._transform=new a.common.Transform;let o=t.position;this._ptransform._positionX=o.x,this._ptransform._positionY=o.y,this._ptransform._positionZ=o.z;let n=t.rotation;this._ptransform._rotation00=n.e00,this._ptransform._rotation01=n.e01,this._ptransform._rotation02=n.e02,this._ptransform._rotation10=n.e10,this._ptransform._rotation11=n.e11,this._ptransform._rotation12=n.e12,this._ptransform._rotation20=n.e20,this._ptransform._rotation21=n.e21,this._ptransform._rotation22=n.e22;let e=this._transform,r=this._ptransform;e._positionX=r._positionX,e._positionY=r._positionY,e._positionZ=r._positionZ,e._rotation00=r._rotation00,e._rotation01=r._rotation01,e._rotation02=r._rotation02,e._rotation10=r._rotation10,e._rotation11=r._rotation11,e._rotation12=r._rotation12,e._rotation20=r._rotation20,e._rotation21=r._rotation21,e._rotation22=r._rotation22,this._type=t.type,this._sleepTime=0,this._sleeping=!1,this._autoSleep=t.autoSleep,this._mass=0,this._invMass=0,this._localInertia00=0,this._localInertia01=0,this._localInertia02=0,this._localInertia10=0,this._localInertia11=0,this._localInertia12=0,this._localInertia20=0,this._localInertia21=0,this._localInertia22=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._invInertia00=0,this._invInertia01=0,this._invInertia02=0,this._invInertia10=0,this._invInertia11=0,this._invInertia12=0,this._invInertia20=0,this._invInertia21=0,this._invInertia22=0,this._linearDamping=t.linearDamping,this._angularDamping=t.angularDamping,this._forceX=0,this._forceY=0,this._forceZ=0,this._torqueX=0,this._torqueY=0,this._torqueZ=0,this._linearContactImpulseX=0,this._linearContactImpulseY=0,this._linearContactImpulseZ=0,this._angularContactImpulseX=0,this._angularContactImpulseY=0,this._angularContactImpulseZ=0,this._rotFactor=new a.common.Vec3(1,1,1),this._addedToIsland=!1,this._gravityScale=1,this._world=null}_integrate(t){switch(this._type){case 1:this._velX=0,this._velY=0,this._velZ=0,this._angVelX=0,this._angVelY=0,this._angVelZ=0,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:let i,s,o,n,e,r;i=this._velX*t,s=this._velY*t,o=this._velZ*t,n=this._angVelX*t,e=this._angVelY*t,r=this._angVelZ*t;let _=i*i+s*s+o*o,l=n*n+e*e+r*r;if(0==_&&0==l)return;if(_>a.common.Setting.maxTranslationPerStep*a.common.Setting.maxTranslationPerStep){let t=a.common.Setting.maxTranslationPerStep/Math.sqrt(_);this._velX*=t,this._velY*=t,this._velZ*=t,i*=t,s*=t,o*=t}if(l>a.common.Setting.maxRotationPerStep*a.common.Setting.maxRotationPerStep){let t=a.common.Setting.maxRotationPerStep/Math.sqrt(l);this._angVelX*=t,this._angVelY*=t,this._angVelZ*=t,n*=t,e*=t,r*=t}this._transform._positionX+=i,this._transform._positionY+=s,this._transform._positionZ+=o;let h,c,m,b,p,x,f,u,y,g,v,d,X,z=Math.sqrt(n*n+e*e+r*r),Y=.5*z;if(Y<.5){let t=Y*Y;h=.5*(1-.16666666666666666*t+t*t*.008333333333333333),c=1-.5*t+t*t*.041666666666666664}else h=Math.sin(Y)/z,c=Math.cos(Y);m=n*h,b=e*h,p=r*h,x=m,f=b,u=p,y=c;let Z,M=this._transform._rotation00,I=this._transform._rotation11,V=this._transform._rotation22,w=M+I+V;w>0?(Z=Math.sqrt(w+1),X=.5*Z,Z=.5/Z,g=(this._transform._rotation21-this._transform._rotation12)*Z,v=(this._transform._rotation02-this._transform._rotation20)*Z,d=(this._transform._rotation10-this._transform._rotation01)*Z):M>I?M>V?(Z=Math.sqrt(M-I-V+1),g=.5*Z,Z=.5/Z,v=(this._transform._rotation01+this._transform._rotation10)*Z,d=(this._transform._rotation02+this._transform._rotation20)*Z,X=(this._transform._rotation21-this._transform._rotation12)*Z):(Z=Math.sqrt(V-M-I+1),d=.5*Z,Z=.5/Z,g=(this._transform._rotation02+this._transform._rotation20)*Z,v=(this._transform._rotation12+this._transform._rotation21)*Z,X=(this._transform._rotation10-this._transform._rotation01)*Z):I>V?(Z=Math.sqrt(I-V-M+1),v=.5*Z,Z=.5/Z,g=(this._transform._rotation01+this._transform._rotation10)*Z,d=(this._transform._rotation12+this._transform._rotation21)*Z,X=(this._transform._rotation02-this._transform._rotation20)*Z):(Z=Math.sqrt(V-M-I+1),d=.5*Z,Z=.5/Z,g=(this._transform._rotation02+this._transform._rotation20)*Z,v=(this._transform._rotation12+this._transform._rotation21)*Z,X=(this._transform._rotation10-this._transform._rotation01)*Z),g=y*g+x*X+f*d-u*v,v=y*v-x*d+f*X+u*g,d=y*d+x*v-f*g+u*X,X=y*X-x*g-f*v-u*d;let L=g*g+v*v+d*d+X*X;L>1e-32&&(L=1/Math.sqrt(L)),g*=L,v*=L,d*=L,X*=L;let k,A,B,P,S,T,C,j,R,q,E,D,N,F,W,J,G,O,U=2*g,H=2*v,Q=2*d,K=g*U,$=v*H,tt=d*Q,it=g*H,st=v*Q,at=g*Q,ot=X*U,nt=X*H,et=X*Q;this._transform._rotation00=1-$-tt,this._transform._rotation01=it-et,this._transform._rotation02=at+nt,this._transform._rotation10=it+et,this._transform._rotation11=1-K-tt,this._transform._rotation12=st-ot,this._transform._rotation20=at-nt,this._transform._rotation21=st+ot,this._transform._rotation22=1-K-$,k=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,A=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,B=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,P=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,S=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,T=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,C=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,j=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,R=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=k,this._invInertia01=A,this._invInertia02=B,this._invInertia10=P,this._invInertia11=S,this._invInertia12=T,this._invInertia20=C,this._invInertia21=j,this._invInertia22=R,q=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,E=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,D=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,N=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,F=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,W=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,J=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,G=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,O=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=q,this._invInertia01=E,this._invInertia02=D,this._invInertia10=N,this._invInertia11=F,this._invInertia12=W,this._invInertia20=J,this._invInertia21=G,this._invInertia22=O,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z}}_integratePseudoVelocity(){if(this._pseudoVelX*this._pseudoVelX+this._pseudoVelY*this._pseudoVelY+this._pseudoVelZ*this._pseudoVelZ!=0||this._angPseudoVelX*this._angPseudoVelX+this._angPseudoVelY*this._angPseudoVelY+this._angPseudoVelZ*this._angPseudoVelZ!=0)switch(this._type){case 1:this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:let t,i,s,a,o,n;t=this._pseudoVelX,i=this._pseudoVelY,s=this._pseudoVelZ,a=this._angPseudoVelX,o=this._angPseudoVelY,n=this._angPseudoVelZ,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._transform._positionX+=t,this._transform._positionY+=i,this._transform._positionZ+=s;let e,r,_,l,h,c,m,b,p,x,f,u,y,g=Math.sqrt(a*a+o*o+n*n),v=.5*g;if(v<.5){let t=v*v;e=.5*(1-.16666666666666666*t+t*t*.008333333333333333),r=1-.5*t+t*t*.041666666666666664}else e=Math.sin(v)/g,r=Math.cos(v);_=a*e,l=o*e,h=n*e,c=_,m=l,b=h,p=r;let d,X=this._transform._rotation00,z=this._transform._rotation11,Y=this._transform._rotation22,Z=X+z+Y;Z>0?(d=Math.sqrt(Z+1),y=.5*d,d=.5/d,x=(this._transform._rotation21-this._transform._rotation12)*d,f=(this._transform._rotation02-this._transform._rotation20)*d,u=(this._transform._rotation10-this._transform._rotation01)*d):X>z?X>Y?(d=Math.sqrt(X-z-Y+1),x=.5*d,d=.5/d,f=(this._transform._rotation01+this._transform._rotation10)*d,u=(this._transform._rotation02+this._transform._rotation20)*d,y=(this._transform._rotation21-this._transform._rotation12)*d):(d=Math.sqrt(Y-X-z+1),u=.5*d,d=.5/d,x=(this._transform._rotation02+this._transform._rotation20)*d,f=(this._transform._rotation12+this._transform._rotation21)*d,y=(this._transform._rotation10-this._transform._rotation01)*d):z>Y?(d=Math.sqrt(z-Y-X+1),f=.5*d,d=.5/d,x=(this._transform._rotation01+this._transform._rotation10)*d,u=(this._transform._rotation12+this._transform._rotation21)*d,y=(this._transform._rotation02-this._transform._rotation20)*d):(d=Math.sqrt(Y-X-z+1),u=.5*d,d=.5/d,x=(this._transform._rotation02+this._transform._rotation20)*d,f=(this._transform._rotation12+this._transform._rotation21)*d,y=(this._transform._rotation10-this._transform._rotation01)*d),x=p*x+c*y+m*u-b*f,f=p*f-c*u+m*y+b*x,u=p*u+c*f-m*x+b*y,y=p*y-c*x-m*f-b*u;let M=x*x+f*f+u*u+y*y;M>1e-32&&(M=1/Math.sqrt(M)),x*=M,f*=M,u*=M,y*=M;let I,V,w,L,k,A,B,P,S,T,C,j,R,q,E,D,N,F,W=2*x,J=2*f,G=2*u,O=x*W,U=f*J,H=u*G,Q=x*J,K=f*G,$=x*G,tt=y*W,it=y*J,st=y*G;this._transform._rotation00=1-U-H,this._transform._rotation01=Q-st,this._transform._rotation02=$+it,this._transform._rotation10=Q+st,this._transform._rotation11=1-O-H,this._transform._rotation12=K-tt,this._transform._rotation20=$-it,this._transform._rotation21=K+tt,this._transform._rotation22=1-O-U,I=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,V=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,w=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,L=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,k=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,A=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,B=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,P=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,S=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=I,this._invInertia01=V,this._invInertia02=w,this._invInertia10=L,this._invInertia11=k,this._invInertia12=A,this._invInertia20=B,this._invInertia21=P,this._invInertia22=S,T=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,C=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,j=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,R=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,q=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,E=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,D=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,N=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,F=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=T,this._invInertia01=C,this._invInertia02=j,this._invInertia10=R,this._invInertia11=q,this._invInertia12=E,this._invInertia20=D,this._invInertia21=N,this._invInertia22=F,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z}}updateMass(){let t,i,s,a,o,n,e,r,_;t=0,i=0,s=0,a=0,o=0,n=0,e=0,r=0,_=0;let l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I=0,V=this._shapeList;for(;null!=V;){let l=V._next,h=V._geom;h._updateMass();let c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,w,L,k,A,B,P,S,T,C,j,R,q,E,D,N,F,W,J,G,O,U=V._density*h._volume;v=V._localTransform._rotation00*h._inertiaCoeff00+V._localTransform._rotation01*h._inertiaCoeff10+V._localTransform._rotation02*h._inertiaCoeff20,d=V._localTransform._rotation00*h._inertiaCoeff01+V._localTransform._rotation01*h._inertiaCoeff11+V._localTransform._rotation02*h._inertiaCoeff21,X=V._localTransform._rotation00*h._inertiaCoeff02+V._localTransform._rotation01*h._inertiaCoeff12+V._localTransform._rotation02*h._inertiaCoeff22,z=V._localTransform._rotation10*h._inertiaCoeff00+V._localTransform._rotation11*h._inertiaCoeff10+V._localTransform._rotation12*h._inertiaCoeff20,Y=V._localTransform._rotation10*h._inertiaCoeff01+V._localTransform._rotation11*h._inertiaCoeff11+V._localTransform._rotation12*h._inertiaCoeff21,Z=V._localTransform._rotation10*h._inertiaCoeff02+V._localTransform._rotation11*h._inertiaCoeff12+V._localTransform._rotation12*h._inertiaCoeff22,M=V._localTransform._rotation20*h._inertiaCoeff00+V._localTransform._rotation21*h._inertiaCoeff10+V._localTransform._rotation22*h._inertiaCoeff20,w=V._localTransform._rotation20*h._inertiaCoeff01+V._localTransform._rotation21*h._inertiaCoeff11+V._localTransform._rotation22*h._inertiaCoeff21,L=V._localTransform._rotation20*h._inertiaCoeff02+V._localTransform._rotation21*h._inertiaCoeff12+V._localTransform._rotation22*h._inertiaCoeff22,c=v,m=d,b=X,p=z,x=Y,f=Z,u=M,y=w,g=L,k=c*V._localTransform._rotation00+m*V._localTransform._rotation01+b*V._localTransform._rotation02,A=c*V._localTransform._rotation10+m*V._localTransform._rotation11+b*V._localTransform._rotation12,B=c*V._localTransform._rotation20+m*V._localTransform._rotation21+b*V._localTransform._rotation22,P=p*V._localTransform._rotation00+x*V._localTransform._rotation01+f*V._localTransform._rotation02,S=p*V._localTransform._rotation10+x*V._localTransform._rotation11+f*V._localTransform._rotation12,T=p*V._localTransform._rotation20+x*V._localTransform._rotation21+f*V._localTransform._rotation22,C=u*V._localTransform._rotation00+y*V._localTransform._rotation01+g*V._localTransform._rotation02,j=u*V._localTransform._rotation10+y*V._localTransform._rotation11+g*V._localTransform._rotation12,R=u*V._localTransform._rotation20+y*V._localTransform._rotation21+g*V._localTransform._rotation22,c=k,m=A,b=B,p=P,x=S,f=T,u=C,y=j,g=R,c*=U,m*=U,b*=U,p*=U,x*=U,f*=U,u*=U,y*=U,g*=U;let H=V._localTransform._positionX*V._localTransform._positionX,Q=V._localTransform._positionY*V._localTransform._positionY,K=V._localTransform._positionZ*V._localTransform._positionZ,$=-V._localTransform._positionX*V._localTransform._positionY,tt=-V._localTransform._positionY*V._localTransform._positionZ,it=-V._localTransform._positionZ*V._localTransform._positionX;q=Q+K,E=$,D=it,N=$,F=H+K,W=tt,J=it,G=tt,O=H+Q,c+=q*U,m+=E*U,b+=D*U,p+=N*U,x+=F*U,f+=W*U,u+=J*U,y+=G*U,g+=O*U,I+=U,t+=c,i+=m,s+=b,a+=p,o+=x,n+=f,e+=u,r+=y,_+=g,V=l}if(this._mass=I,this._localInertia00=t,this._localInertia01=i,this._localInertia02=s,this._localInertia10=a,this._localInertia11=o,this._localInertia12=n,this._localInertia20=e,this._localInertia21=r,this._localInertia22=_,this._mass>0&&this._localInertia00*(this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21)-this._localInertia01*(this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20)+this._localInertia02*(this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20)>0&&0==this._type){this._invMass=1/this._mass;let t=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,i=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,s=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,a=this._localInertia00*t-this._localInertia01*i+this._localInertia02*s;(a<-1e-32||a>1e-32)&&(a=1/a),this._invLocalInertia00=t*a,this._invLocalInertia01=-(this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21)*a,this._invLocalInertia02=(this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11)*a,this._invLocalInertia10=-i*a,this._invLocalInertia11=(this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20)*a,this._invLocalInertia12=-(this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10)*a,this._invLocalInertia20=s*a,this._invLocalInertia21=-(this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20)*a,this._invLocalInertia22=(this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10)*a,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);l=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,h=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,c=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,m=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,b=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,p=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,x=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,f=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,u=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=l,this._invInertia01=h,this._invInertia02=c,this._invInertia10=m,this._invInertia11=b,this._invInertia12=p,this._invInertia20=x,this._invInertia21=f,this._invInertia22=u,y=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,g=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,v=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,d=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,X=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,z=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,Y=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,Z=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,M=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=y,this._invInertia01=g,this._invInertia02=v,this._invInertia10=d,this._invInertia11=X,this._invInertia12=z,this._invInertia20=Y,this._invInertia21=Z,this._invInertia22=M,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getPosition(){let t=new a.common.Vec3;return t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ,t}getPositionTo(t){t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ}setPosition(t){this._transform._positionX=t.x,this._transform._positionY=t.y,this._transform._positionZ=t.z;let i=this._ptransform,s=this._transform;i._positionX=s._positionX,i._positionY=s._positionY,i._positionZ=s._positionZ,i._rotation00=s._rotation00,i._rotation01=s._rotation01,i._rotation02=s._rotation02,i._rotation10=s._rotation10,i._rotation11=s._rotation11,i._rotation12=s._rotation12,i._rotation20=s._rotation20,i._rotation21=s._rotation21,i._rotation22=s._rotation22;let a=this._shapeList;for(;null!=a;){let t,i,s,o,n,e,r,_,l,h,c,m,b=a._next,p=this._ptransform,x=this._transform,f=a._ptransform,u=a._localTransform;t=p._rotation00*u._rotation00+p._rotation01*u._rotation10+p._rotation02*u._rotation20,i=p._rotation00*u._rotation01+p._rotation01*u._rotation11+p._rotation02*u._rotation21,s=p._rotation00*u._rotation02+p._rotation01*u._rotation12+p._rotation02*u._rotation22,o=p._rotation10*u._rotation00+p._rotation11*u._rotation10+p._rotation12*u._rotation20,n=p._rotation10*u._rotation01+p._rotation11*u._rotation11+p._rotation12*u._rotation21,e=p._rotation10*u._rotation02+p._rotation11*u._rotation12+p._rotation12*u._rotation22,r=p._rotation20*u._rotation00+p._rotation21*u._rotation10+p._rotation22*u._rotation20,_=p._rotation20*u._rotation01+p._rotation21*u._rotation11+p._rotation22*u._rotation21,l=p._rotation20*u._rotation02+p._rotation21*u._rotation12+p._rotation22*u._rotation22,f._rotation00=t,f._rotation01=i,f._rotation02=s,f._rotation10=o,f._rotation11=n,f._rotation12=e,f._rotation20=r,f._rotation21=_,f._rotation22=l,h=p._rotation00*u._positionX+p._rotation01*u._positionY+p._rotation02*u._positionZ,c=p._rotation10*u._positionX+p._rotation11*u._positionY+p._rotation12*u._positionZ,m=p._rotation20*u._positionX+p._rotation21*u._positionY+p._rotation22*u._positionZ,f._positionX=h,f._positionY=c,f._positionZ=m,f._positionX+=p._positionX,f._positionY+=p._positionY,f._positionZ+=p._positionZ;let y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T=a._transform,C=a._localTransform;if(y=x._rotation00*C._rotation00+x._rotation01*C._rotation10+x._rotation02*C._rotation20,g=x._rotation00*C._rotation01+x._rotation01*C._rotation11+x._rotation02*C._rotation21,v=x._rotation00*C._rotation02+x._rotation01*C._rotation12+x._rotation02*C._rotation22,d=x._rotation10*C._rotation00+x._rotation11*C._rotation10+x._rotation12*C._rotation20,X=x._rotation10*C._rotation01+x._rotation11*C._rotation11+x._rotation12*C._rotation21,z=x._rotation10*C._rotation02+x._rotation11*C._rotation12+x._rotation12*C._rotation22,Y=x._rotation20*C._rotation00+x._rotation21*C._rotation10+x._rotation22*C._rotation20,Z=x._rotation20*C._rotation01+x._rotation21*C._rotation11+x._rotation22*C._rotation21,M=x._rotation20*C._rotation02+x._rotation21*C._rotation12+x._rotation22*C._rotation22,T._rotation00=y,T._rotation01=g,T._rotation02=v,T._rotation10=d,T._rotation11=X,T._rotation12=z,T._rotation20=Y,T._rotation21=Z,T._rotation22=M,I=x._rotation00*C._positionX+x._rotation01*C._positionY+x._rotation02*C._positionZ,V=x._rotation10*C._positionX+x._rotation11*C._positionY+x._rotation12*C._positionZ,w=x._rotation20*C._positionX+x._rotation21*C._positionY+x._rotation22*C._positionZ,T._positionX=I,T._positionY=V,T._positionZ=w,T._positionX+=x._positionX,T._positionY+=x._positionY,T._positionZ+=x._positionZ,a._geom._computeAabb(a._aabb,a._ptransform),L=a._aabb._minX,k=a._aabb._minY,A=a._aabb._minZ,B=a._aabb._maxX,P=a._aabb._maxY,S=a._aabb._maxZ,a._geom._computeAabb(a._aabb,a._transform),a._aabb._minX=L<a._aabb._minX?L:a._aabb._minX,a._aabb._minY=k<a._aabb._minY?k:a._aabb._minY,a._aabb._minZ=A<a._aabb._minZ?A:a._aabb._minZ,a._aabb._maxX=B>a._aabb._maxX?B:a._aabb._maxX,a._aabb._maxY=P>a._aabb._maxY?P:a._aabb._maxY,a._aabb._maxZ=S>a._aabb._maxZ?S:a._aabb._maxZ,null!=a._proxy){let t,i,s;t=a._transform._positionX-a._ptransform._positionX,i=a._transform._positionY-a._ptransform._positionY,s=a._transform._positionZ-a._ptransform._positionZ;let o=a.displacement;o.x=t,o.y=i,o.z=s,a._rigidBody._world._broadPhase.moveProxy(a._proxy,a._aabb,a.displacement)}a=b}this._sleeping=!1,this._sleepTime=0}translate(t){let i,s,a;i=t.x,s=t.y,a=t.z,this._transform._positionX+=i,this._transform._positionY+=s,this._transform._positionZ+=a;let o=this._ptransform,n=this._transform;o._positionX=n._positionX,o._positionY=n._positionY,o._positionZ=n._positionZ,o._rotation00=n._rotation00,o._rotation01=n._rotation01,o._rotation02=n._rotation02,o._rotation10=n._rotation10,o._rotation11=n._rotation11,o._rotation12=n._rotation12,o._rotation20=n._rotation20,o._rotation21=n._rotation21,o._rotation22=n._rotation22;let e=this._shapeList;for(;null!=e;){let t,i,s,a,o,n,r,_,l,h,c,m,b=e._next,p=this._ptransform,x=this._transform,f=e._ptransform,u=e._localTransform;t=p._rotation00*u._rotation00+p._rotation01*u._rotation10+p._rotation02*u._rotation20,i=p._rotation00*u._rotation01+p._rotation01*u._rotation11+p._rotation02*u._rotation21,s=p._rotation00*u._rotation02+p._rotation01*u._rotation12+p._rotation02*u._rotation22,a=p._rotation10*u._rotation00+p._rotation11*u._rotation10+p._rotation12*u._rotation20,o=p._rotation10*u._rotation01+p._rotation11*u._rotation11+p._rotation12*u._rotation21,n=p._rotation10*u._rotation02+p._rotation11*u._rotation12+p._rotation12*u._rotation22,r=p._rotation20*u._rotation00+p._rotation21*u._rotation10+p._rotation22*u._rotation20,_=p._rotation20*u._rotation01+p._rotation21*u._rotation11+p._rotation22*u._rotation21,l=p._rotation20*u._rotation02+p._rotation21*u._rotation12+p._rotation22*u._rotation22,f._rotation00=t,f._rotation01=i,f._rotation02=s,f._rotation10=a,f._rotation11=o,f._rotation12=n,f._rotation20=r,f._rotation21=_,f._rotation22=l,h=p._rotation00*u._positionX+p._rotation01*u._positionY+p._rotation02*u._positionZ,c=p._rotation10*u._positionX+p._rotation11*u._positionY+p._rotation12*u._positionZ,m=p._rotation20*u._positionX+p._rotation21*u._positionY+p._rotation22*u._positionZ,f._positionX=h,f._positionY=c,f._positionZ=m,f._positionX+=p._positionX,f._positionY+=p._positionY,f._positionZ+=p._positionZ;let y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T=e._transform,C=e._localTransform;if(y=x._rotation00*C._rotation00+x._rotation01*C._rotation10+x._rotation02*C._rotation20,g=x._rotation00*C._rotation01+x._rotation01*C._rotation11+x._rotation02*C._rotation21,v=x._rotation00*C._rotation02+x._rotation01*C._rotation12+x._rotation02*C._rotation22,d=x._rotation10*C._rotation00+x._rotation11*C._rotation10+x._rotation12*C._rotation20,X=x._rotation10*C._rotation01+x._rotation11*C._rotation11+x._rotation12*C._rotation21,z=x._rotation10*C._rotation02+x._rotation11*C._rotation12+x._rotation12*C._rotation22,Y=x._rotation20*C._rotation00+x._rotation21*C._rotation10+x._rotation22*C._rotation20,Z=x._rotation20*C._rotation01+x._rotation21*C._rotation11+x._rotation22*C._rotation21,M=x._rotation20*C._rotation02+x._rotation21*C._rotation12+x._rotation22*C._rotation22,T._rotation00=y,T._rotation01=g,T._rotation02=v,T._rotation10=d,T._rotation11=X,T._rotation12=z,T._rotation20=Y,T._rotation21=Z,T._rotation22=M,I=x._rotation00*C._positionX+x._rotation01*C._positionY+x._rotation02*C._positionZ,V=x._rotation10*C._positionX+x._rotation11*C._positionY+x._rotation12*C._positionZ,w=x._rotation20*C._positionX+x._rotation21*C._positionY+x._rotation22*C._positionZ,T._positionX=I,T._positionY=V,T._positionZ=w,T._positionX+=x._positionX,T._positionY+=x._positionY,T._positionZ+=x._positionZ,e._geom._computeAabb(e._aabb,e._ptransform),L=e._aabb._minX,k=e._aabb._minY,A=e._aabb._minZ,B=e._aabb._maxX,P=e._aabb._maxY,S=e._aabb._maxZ,e._geom._computeAabb(e._aabb,e._transform),e._aabb._minX=L<e._aabb._minX?L:e._aabb._minX,e._aabb._minY=k<e._aabb._minY?k:e._aabb._minY,e._aabb._minZ=A<e._aabb._minZ?A:e._aabb._minZ,e._aabb._maxX=B>e._aabb._maxX?B:e._aabb._maxX,e._aabb._maxY=P>e._aabb._maxY?P:e._aabb._maxY,e._aabb._maxZ=S>e._aabb._maxZ?S:e._aabb._maxZ,null!=e._proxy){let t,i,s;t=e._transform._positionX-e._ptransform._positionX,i=e._transform._positionY-e._ptransform._positionY,s=e._transform._positionZ-e._ptransform._positionZ;let a=e.displacement;a.x=t,a.y=i,a.z=s,e._rigidBody._world._broadPhase.moveProxy(e._proxy,e._aabb,e.displacement)}e=b}this._sleeping=!1,this._sleepTime=0}getRotation(){let t=new a.common.Mat3;return t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22,t}getRotationTo(t){t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22}setRotation(t){let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y;this._transform._rotation00=t.e00,this._transform._rotation01=t.e01,this._transform._rotation02=t.e02,this._transform._rotation10=t.e10,this._transform._rotation11=t.e11,this._transform._rotation12=t.e12,this._transform._rotation20=t.e20,this._transform._rotation21=t.e21,this._transform._rotation22=t.e22,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,s=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,a=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=s,this._invInertia02=a,this._invInertia10=o,this._invInertia11=n,this._invInertia12=e,this._invInertia20=r,this._invInertia21=_,this._invInertia22=l,h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,b=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,p=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,f=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,u=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=c,this._invInertia02=m,this._invInertia10=b,this._invInertia11=p,this._invInertia12=x,this._invInertia20=f,this._invInertia21=u,this._invInertia22=y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let g=this._ptransform,v=this._transform;g._positionX=v._positionX,g._positionY=v._positionY,g._positionZ=v._positionZ,g._rotation00=v._rotation00,g._rotation01=v._rotation01,g._rotation02=v._rotation02,g._rotation10=v._rotation10,g._rotation11=v._rotation11,g._rotation12=v._rotation12,g._rotation20=v._rotation20,g._rotation21=v._rotation21,g._rotation22=v._rotation22;let d=this._shapeList;for(;null!=d;){let t,i,s,a,o,n,e,r,_,l,h,c,m=d._next,b=this._ptransform,p=this._transform,x=d._ptransform,f=d._localTransform;t=b._rotation00*f._rotation00+b._rotation01*f._rotation10+b._rotation02*f._rotation20,i=b._rotation00*f._rotation01+b._rotation01*f._rotation11+b._rotation02*f._rotation21,s=b._rotation00*f._rotation02+b._rotation01*f._rotation12+b._rotation02*f._rotation22,a=b._rotation10*f._rotation00+b._rotation11*f._rotation10+b._rotation12*f._rotation20,o=b._rotation10*f._rotation01+b._rotation11*f._rotation11+b._rotation12*f._rotation21,n=b._rotation10*f._rotation02+b._rotation11*f._rotation12+b._rotation12*f._rotation22,e=b._rotation20*f._rotation00+b._rotation21*f._rotation10+b._rotation22*f._rotation20,r=b._rotation20*f._rotation01+b._rotation21*f._rotation11+b._rotation22*f._rotation21,_=b._rotation20*f._rotation02+b._rotation21*f._rotation12+b._rotation22*f._rotation22,x._rotation00=t,x._rotation01=i,x._rotation02=s,x._rotation10=a,x._rotation11=o,x._rotation12=n,x._rotation20=e,x._rotation21=r,x._rotation22=_,l=b._rotation00*f._positionX+b._rotation01*f._positionY+b._rotation02*f._positionZ,h=b._rotation10*f._positionX+b._rotation11*f._positionY+b._rotation12*f._positionZ,c=b._rotation20*f._positionX+b._rotation21*f._positionY+b._rotation22*f._positionZ,x._positionX=l,x._positionY=h,x._positionZ=c,x._positionX+=b._positionX,x._positionY+=b._positionY,x._positionZ+=b._positionZ;let u,y,g,v,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T=d._transform,C=d._localTransform;if(u=p._rotation00*C._rotation00+p._rotation01*C._rotation10+p._rotation02*C._rotation20,y=p._rotation00*C._rotation01+p._rotation01*C._rotation11+p._rotation02*C._rotation21,g=p._rotation00*C._rotation02+p._rotation01*C._rotation12+p._rotation02*C._rotation22,v=p._rotation10*C._rotation00+p._rotation11*C._rotation10+p._rotation12*C._rotation20,X=p._rotation10*C._rotation01+p._rotation11*C._rotation11+p._rotation12*C._rotation21,z=p._rotation10*C._rotation02+p._rotation11*C._rotation12+p._rotation12*C._rotation22,Y=p._rotation20*C._rotation00+p._rotation21*C._rotation10+p._rotation22*C._rotation20,Z=p._rotation20*C._rotation01+p._rotation21*C._rotation11+p._rotation22*C._rotation21,M=p._rotation20*C._rotation02+p._rotation21*C._rotation12+p._rotation22*C._rotation22,T._rotation00=u,T._rotation01=y,T._rotation02=g,T._rotation10=v,T._rotation11=X,T._rotation12=z,T._rotation20=Y,T._rotation21=Z,T._rotation22=M,I=p._rotation00*C._positionX+p._rotation01*C._positionY+p._rotation02*C._positionZ,V=p._rotation10*C._positionX+p._rotation11*C._positionY+p._rotation12*C._positionZ,w=p._rotation20*C._positionX+p._rotation21*C._positionY+p._rotation22*C._positionZ,T._positionX=I,T._positionY=V,T._positionZ=w,T._positionX+=p._positionX,T._positionY+=p._positionY,T._positionZ+=p._positionZ,d._geom._computeAabb(d._aabb,d._ptransform),L=d._aabb._minX,k=d._aabb._minY,A=d._aabb._minZ,B=d._aabb._maxX,P=d._aabb._maxY,S=d._aabb._maxZ,d._geom._computeAabb(d._aabb,d._transform),d._aabb._minX=L<d._aabb._minX?L:d._aabb._minX,d._aabb._minY=k<d._aabb._minY?k:d._aabb._minY,d._aabb._minZ=A<d._aabb._minZ?A:d._aabb._minZ,d._aabb._maxX=B>d._aabb._maxX?B:d._aabb._maxX,d._aabb._maxY=P>d._aabb._maxY?P:d._aabb._maxY,d._aabb._maxZ=S>d._aabb._maxZ?S:d._aabb._maxZ,null!=d._proxy){let t,i,s;t=d._transform._positionX-d._ptransform._positionX,i=d._transform._positionY-d._ptransform._positionY,s=d._transform._positionZ-d._ptransform._positionZ;let a=d.displacement;a.x=t,a.y=i,a.z=s,d._rigidBody._world._broadPhase.moveProxy(d._proxy,d._aabb,d.displacement)}d=m}this._sleeping=!1,this._sleepTime=0}setRotationXyz(t){let i,s,a;i=t.x,s=t.y,a=t.z;let o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X=Math.sin(i),z=Math.sin(s),Y=Math.sin(a),Z=Math.cos(i),M=Math.cos(s),I=Math.cos(a);this._transform._rotation00=M*I,this._transform._rotation01=-M*Y,this._transform._rotation02=z,this._transform._rotation10=Z*Y+I*X*z,this._transform._rotation11=Z*I-X*z*Y,this._transform._rotation12=-M*X,this._transform._rotation20=X*Y-Z*I*z,this._transform._rotation21=I*X+Z*z*Y,this._transform._rotation22=Z*M,o=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,n=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,e=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,r=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,_=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,l=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,h=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,c=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,m=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=o,this._invInertia01=n,this._invInertia02=e,this._invInertia10=r,this._invInertia11=_,this._invInertia12=l,this._invInertia20=h,this._invInertia21=c,this._invInertia22=m,b=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,p=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,x=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,f=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,u=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,y=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,g=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,v=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,d=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=b,this._invInertia01=p,this._invInertia02=x,this._invInertia10=f,this._invInertia11=u,this._invInertia12=y,this._invInertia20=g,this._invInertia21=v,this._invInertia22=d,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let V=this._ptransform,w=this._transform;V._positionX=w._positionX,V._positionY=w._positionY,V._positionZ=w._positionZ,V._rotation00=w._rotation00,V._rotation01=w._rotation01,V._rotation02=w._rotation02,V._rotation10=w._rotation10,V._rotation11=w._rotation11,V._rotation12=w._rotation12,V._rotation20=w._rotation20,V._rotation21=w._rotation21,V._rotation22=w._rotation22;let L=this._shapeList;for(;null!=L;){let t,i,s,a,o,n,e,r,_,l,h,c,m=L._next,b=this._ptransform,p=this._transform,x=L._ptransform,f=L._localTransform;t=b._rotation00*f._rotation00+b._rotation01*f._rotation10+b._rotation02*f._rotation20,i=b._rotation00*f._rotation01+b._rotation01*f._rotation11+b._rotation02*f._rotation21,s=b._rotation00*f._rotation02+b._rotation01*f._rotation12+b._rotation02*f._rotation22,a=b._rotation10*f._rotation00+b._rotation11*f._rotation10+b._rotation12*f._rotation20,o=b._rotation10*f._rotation01+b._rotation11*f._rotation11+b._rotation12*f._rotation21,n=b._rotation10*f._rotation02+b._rotation11*f._rotation12+b._rotation12*f._rotation22,e=b._rotation20*f._rotation00+b._rotation21*f._rotation10+b._rotation22*f._rotation20,r=b._rotation20*f._rotation01+b._rotation21*f._rotation11+b._rotation22*f._rotation21,_=b._rotation20*f._rotation02+b._rotation21*f._rotation12+b._rotation22*f._rotation22,x._rotation00=t,x._rotation01=i,x._rotation02=s,x._rotation10=a,x._rotation11=o,x._rotation12=n,x._rotation20=e,x._rotation21=r,x._rotation22=_,l=b._rotation00*f._positionX+b._rotation01*f._positionY+b._rotation02*f._positionZ,h=b._rotation10*f._positionX+b._rotation11*f._positionY+b._rotation12*f._positionZ,c=b._rotation20*f._positionX+b._rotation21*f._positionY+b._rotation22*f._positionZ,x._positionX=l,x._positionY=h,x._positionZ=c,x._positionX+=b._positionX,x._positionY+=b._positionY,x._positionZ+=b._positionZ;let u,y,g,v,d,X,z,Y,Z,M,I,V,w,k,A,B,P,S,T=L._transform,C=L._localTransform;if(u=p._rotation00*C._rotation00+p._rotation01*C._rotation10+p._rotation02*C._rotation20,y=p._rotation00*C._rotation01+p._rotation01*C._rotation11+p._rotation02*C._rotation21,g=p._rotation00*C._rotation02+p._rotation01*C._rotation12+p._rotation02*C._rotation22,v=p._rotation10*C._rotation00+p._rotation11*C._rotation10+p._rotation12*C._rotation20,d=p._rotation10*C._rotation01+p._rotation11*C._rotation11+p._rotation12*C._rotation21,X=p._rotation10*C._rotation02+p._rotation11*C._rotation12+p._rotation12*C._rotation22,z=p._rotation20*C._rotation00+p._rotation21*C._rotation10+p._rotation22*C._rotation20,Y=p._rotation20*C._rotation01+p._rotation21*C._rotation11+p._rotation22*C._rotation21,Z=p._rotation20*C._rotation02+p._rotation21*C._rotation12+p._rotation22*C._rotation22,T._rotation00=u,T._rotation01=y,T._rotation02=g,T._rotation10=v,T._rotation11=d,T._rotation12=X,T._rotation20=z,T._rotation21=Y,T._rotation22=Z,M=p._rotation00*C._positionX+p._rotation01*C._positionY+p._rotation02*C._positionZ,I=p._rotation10*C._positionX+p._rotation11*C._positionY+p._rotation12*C._positionZ,V=p._rotation20*C._positionX+p._rotation21*C._positionY+p._rotation22*C._positionZ,T._positionX=M,T._positionY=I,T._positionZ=V,T._positionX+=p._positionX,T._positionY+=p._positionY,T._positionZ+=p._positionZ,L._geom._computeAabb(L._aabb,L._ptransform),w=L._aabb._minX,k=L._aabb._minY,A=L._aabb._minZ,B=L._aabb._maxX,P=L._aabb._maxY,S=L._aabb._maxZ,L._geom._computeAabb(L._aabb,L._transform),L._aabb._minX=w<L._aabb._minX?w:L._aabb._minX,L._aabb._minY=k<L._aabb._minY?k:L._aabb._minY,L._aabb._minZ=A<L._aabb._minZ?A:L._aabb._minZ,L._aabb._maxX=B>L._aabb._maxX?B:L._aabb._maxX,L._aabb._maxY=P>L._aabb._maxY?P:L._aabb._maxY,L._aabb._maxZ=S>L._aabb._maxZ?S:L._aabb._maxZ,null!=L._proxy){let t,i,s;t=L._transform._positionX-L._ptransform._positionX,i=L._transform._positionY-L._ptransform._positionY,s=L._transform._positionZ-L._ptransform._positionZ;let a=L.displacement;a.x=t,a.y=i,a.z=s,L._rigidBody._world._broadPhase.moveProxy(L._proxy,L._aabb,L.displacement)}L=m}this._sleeping=!1,this._sleepTime=0}rotate(t){let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T;i=t.e00,s=t.e01,a=t.e02,o=t.e10,n=t.e11,e=t.e12,r=t.e20,_=t.e21,l=t.e22,h=i*this._transform._rotation00+s*this._transform._rotation10+a*this._transform._rotation20,c=i*this._transform._rotation01+s*this._transform._rotation11+a*this._transform._rotation21,m=i*this._transform._rotation02+s*this._transform._rotation12+a*this._transform._rotation22,b=o*this._transform._rotation00+n*this._transform._rotation10+e*this._transform._rotation20,p=o*this._transform._rotation01+n*this._transform._rotation11+e*this._transform._rotation21,x=o*this._transform._rotation02+n*this._transform._rotation12+e*this._transform._rotation22,f=r*this._transform._rotation00+_*this._transform._rotation10+l*this._transform._rotation20,u=r*this._transform._rotation01+_*this._transform._rotation11+l*this._transform._rotation21,y=r*this._transform._rotation02+_*this._transform._rotation12+l*this._transform._rotation22,this._transform._rotation00=h,this._transform._rotation01=c,this._transform._rotation02=m,this._transform._rotation10=b,this._transform._rotation11=p,this._transform._rotation12=x,this._transform._rotation20=f,this._transform._rotation21=u,this._transform._rotation22=y,g=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,v=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,d=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,X=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,z=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,Y=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,Z=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,M=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,I=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=g,this._invInertia01=v,this._invInertia02=d,this._invInertia10=X,this._invInertia11=z,this._invInertia12=Y,this._invInertia20=Z,this._invInertia21=M,this._invInertia22=I,V=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,w=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,L=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,k=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,A=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,B=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,P=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,S=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,T=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=V,this._invInertia01=w,this._invInertia02=L,this._invInertia10=k,this._invInertia11=A,this._invInertia12=B,this._invInertia20=P,this._invInertia21=S,this._invInertia22=T,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let C=this._ptransform,j=this._transform;C._positionX=j._positionX,C._positionY=j._positionY,C._positionZ=j._positionZ,C._rotation00=j._rotation00,C._rotation01=j._rotation01,C._rotation02=j._rotation02,C._rotation10=j._rotation10,C._rotation11=j._rotation11,C._rotation12=j._rotation12,C._rotation20=j._rotation20,C._rotation21=j._rotation21,C._rotation22=j._rotation22;let R=this._shapeList;for(;null!=R;){let t,i,s,a,o,n,e,r,_,l,h,c,m=R._next,b=this._ptransform,p=this._transform,x=R._ptransform,f=R._localTransform;t=b._rotation00*f._rotation00+b._rotation01*f._rotation10+b._rotation02*f._rotation20,i=b._rotation00*f._rotation01+b._rotation01*f._rotation11+b._rotation02*f._rotation21,s=b._rotation00*f._rotation02+b._rotation01*f._rotation12+b._rotation02*f._rotation22,a=b._rotation10*f._rotation00+b._rotation11*f._rotation10+b._rotation12*f._rotation20,o=b._rotation10*f._rotation01+b._rotation11*f._rotation11+b._rotation12*f._rotation21,n=b._rotation10*f._rotation02+b._rotation11*f._rotation12+b._rotation12*f._rotation22,e=b._rotation20*f._rotation00+b._rotation21*f._rotation10+b._rotation22*f._rotation20,r=b._rotation20*f._rotation01+b._rotation21*f._rotation11+b._rotation22*f._rotation21,_=b._rotation20*f._rotation02+b._rotation21*f._rotation12+b._rotation22*f._rotation22,x._rotation00=t,x._rotation01=i,x._rotation02=s,x._rotation10=a,x._rotation11=o,x._rotation12=n,x._rotation20=e,x._rotation21=r,x._rotation22=_,l=b._rotation00*f._positionX+b._rotation01*f._positionY+b._rotation02*f._positionZ,h=b._rotation10*f._positionX+b._rotation11*f._positionY+b._rotation12*f._positionZ,c=b._rotation20*f._positionX+b._rotation21*f._positionY+b._rotation22*f._positionZ,x._positionX=l,x._positionY=h,x._positionZ=c,x._positionX+=b._positionX,x._positionY+=b._positionY,x._positionZ+=b._positionZ;let u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S=R._transform,T=R._localTransform;if(u=p._rotation00*T._rotation00+p._rotation01*T._rotation10+p._rotation02*T._rotation20,y=p._rotation00*T._rotation01+p._rotation01*T._rotation11+p._rotation02*T._rotation21,g=p._rotation00*T._rotation02+p._rotation01*T._rotation12+p._rotation02*T._rotation22,v=p._rotation10*T._rotation00+p._rotation11*T._rotation10+p._rotation12*T._rotation20,d=p._rotation10*T._rotation01+p._rotation11*T._rotation11+p._rotation12*T._rotation21,X=p._rotation10*T._rotation02+p._rotation11*T._rotation12+p._rotation12*T._rotation22,z=p._rotation20*T._rotation00+p._rotation21*T._rotation10+p._rotation22*T._rotation20,Y=p._rotation20*T._rotation01+p._rotation21*T._rotation11+p._rotation22*T._rotation21,Z=p._rotation20*T._rotation02+p._rotation21*T._rotation12+p._rotation22*T._rotation22,S._rotation00=u,S._rotation01=y,S._rotation02=g,S._rotation10=v,S._rotation11=d,S._rotation12=X,S._rotation20=z,S._rotation21=Y,S._rotation22=Z,M=p._rotation00*T._positionX+p._rotation01*T._positionY+p._rotation02*T._positionZ,I=p._rotation10*T._positionX+p._rotation11*T._positionY+p._rotation12*T._positionZ,V=p._rotation20*T._positionX+p._rotation21*T._positionY+p._rotation22*T._positionZ,S._positionX=M,S._positionY=I,S._positionZ=V,S._positionX+=p._positionX,S._positionY+=p._positionY,S._positionZ+=p._positionZ,R._geom._computeAabb(R._aabb,R._ptransform),w=R._aabb._minX,L=R._aabb._minY,k=R._aabb._minZ,A=R._aabb._maxX,B=R._aabb._maxY,P=R._aabb._maxZ,R._geom._computeAabb(R._aabb,R._transform),R._aabb._minX=w<R._aabb._minX?w:R._aabb._minX,R._aabb._minY=L<R._aabb._minY?L:R._aabb._minY,R._aabb._minZ=k<R._aabb._minZ?k:R._aabb._minZ,R._aabb._maxX=A>R._aabb._maxX?A:R._aabb._maxX,R._aabb._maxY=B>R._aabb._maxY?B:R._aabb._maxY,R._aabb._maxZ=P>R._aabb._maxZ?P:R._aabb._maxZ,null!=R._proxy){let t,i,s;t=R._transform._positionX-R._ptransform._positionX,i=R._transform._positionY-R._ptransform._positionY,s=R._transform._positionZ-R._ptransform._positionZ;let a=R.displacement;a.x=t,a.y=i,a.z=s,R._rigidBody._world._broadPhase.moveProxy(R._proxy,R._aabb,R.displacement)}R=m}this._sleeping=!1,this._sleepTime=0}rotateXyz(t){let i,s,a,o,n,e,r,_,l,h,c,m;i=t.x,s=t.y,a=t.z;let b,p,x,f,u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T,C,j,R,q=Math.sin(i),E=Math.sin(s),D=Math.sin(a),N=Math.cos(i),F=Math.cos(s),W=Math.cos(a);o=F*W,n=-F*D,e=E,r=N*D+W*q*E,_=N*W-q*E*D,l=-F*q,h=q*D-N*W*E,c=W*q+N*E*D,m=N*F,b=o*this._transform._rotation00+n*this._transform._rotation10+e*this._transform._rotation20,p=o*this._transform._rotation01+n*this._transform._rotation11+e*this._transform._rotation21,x=o*this._transform._rotation02+n*this._transform._rotation12+e*this._transform._rotation22,f=r*this._transform._rotation00+_*this._transform._rotation10+l*this._transform._rotation20,u=r*this._transform._rotation01+_*this._transform._rotation11+l*this._transform._rotation21,y=r*this._transform._rotation02+_*this._transform._rotation12+l*this._transform._rotation22,g=h*this._transform._rotation00+c*this._transform._rotation10+m*this._transform._rotation20,v=h*this._transform._rotation01+c*this._transform._rotation11+m*this._transform._rotation21,d=h*this._transform._rotation02+c*this._transform._rotation12+m*this._transform._rotation22,this._transform._rotation00=b,this._transform._rotation01=p,this._transform._rotation02=x,this._transform._rotation10=f,this._transform._rotation11=u,this._transform._rotation12=y,this._transform._rotation20=g,this._transform._rotation21=v,this._transform._rotation22=d,X=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,z=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,Y=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,Z=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,M=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,I=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,V=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,w=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,L=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=X,this._invInertia01=z,this._invInertia02=Y,this._invInertia10=Z,this._invInertia11=M,this._invInertia12=I,this._invInertia20=V,this._invInertia21=w,this._invInertia22=L,k=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,A=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,B=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,P=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,S=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,T=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,C=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,j=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,R=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=k,this._invInertia01=A,this._invInertia02=B,this._invInertia10=P,this._invInertia11=S,this._invInertia12=T,this._invInertia20=C,this._invInertia21=j,this._invInertia22=R,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let J=this._ptransform,G=this._transform;J._positionX=G._positionX,J._positionY=G._positionY,J._positionZ=G._positionZ,J._rotation00=G._rotation00,J._rotation01=G._rotation01,J._rotation02=G._rotation02,J._rotation10=G._rotation10,J._rotation11=G._rotation11,J._rotation12=G._rotation12,J._rotation20=G._rotation20,J._rotation21=G._rotation21,J._rotation22=G._rotation22;let O=this._shapeList;for(;null!=O;){let t,i,s,a,o,n,e,r,_,l,h,c,m=O._next,b=this._ptransform,p=this._transform,x=O._ptransform,f=O._localTransform;t=b._rotation00*f._rotation00+b._rotation01*f._rotation10+b._rotation02*f._rotation20,i=b._rotation00*f._rotation01+b._rotation01*f._rotation11+b._rotation02*f._rotation21,s=b._rotation00*f._rotation02+b._rotation01*f._rotation12+b._rotation02*f._rotation22,a=b._rotation10*f._rotation00+b._rotation11*f._rotation10+b._rotation12*f._rotation20,o=b._rotation10*f._rotation01+b._rotation11*f._rotation11+b._rotation12*f._rotation21,n=b._rotation10*f._rotation02+b._rotation11*f._rotation12+b._rotation12*f._rotation22,e=b._rotation20*f._rotation00+b._rotation21*f._rotation10+b._rotation22*f._rotation20,r=b._rotation20*f._rotation01+b._rotation21*f._rotation11+b._rotation22*f._rotation21,_=b._rotation20*f._rotation02+b._rotation21*f._rotation12+b._rotation22*f._rotation22,x._rotation00=t,x._rotation01=i,x._rotation02=s,x._rotation10=a,x._rotation11=o,x._rotation12=n,x._rotation20=e,x._rotation21=r,x._rotation22=_,l=b._rotation00*f._positionX+b._rotation01*f._positionY+b._rotation02*f._positionZ,h=b._rotation10*f._positionX+b._rotation11*f._positionY+b._rotation12*f._positionZ,c=b._rotation20*f._positionX+b._rotation21*f._positionY+b._rotation22*f._positionZ,x._positionX=l,x._positionY=h,x._positionZ=c,x._positionX+=b._positionX,x._positionY+=b._positionY,x._positionZ+=b._positionZ;let u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S=O._transform,T=O._localTransform;if(u=p._rotation00*T._rotation00+p._rotation01*T._rotation10+p._rotation02*T._rotation20,y=p._rotation00*T._rotation01+p._rotation01*T._rotation11+p._rotation02*T._rotation21,g=p._rotation00*T._rotation02+p._rotation01*T._rotation12+p._rotation02*T._rotation22,v=p._rotation10*T._rotation00+p._rotation11*T._rotation10+p._rotation12*T._rotation20,d=p._rotation10*T._rotation01+p._rotation11*T._rotation11+p._rotation12*T._rotation21,X=p._rotation10*T._rotation02+p._rotation11*T._rotation12+p._rotation12*T._rotation22,z=p._rotation20*T._rotation00+p._rotation21*T._rotation10+p._rotation22*T._rotation20,Y=p._rotation20*T._rotation01+p._rotation21*T._rotation11+p._rotation22*T._rotation21,Z=p._rotation20*T._rotation02+p._rotation21*T._rotation12+p._rotation22*T._rotation22,S._rotation00=u,S._rotation01=y,S._rotation02=g,S._rotation10=v,S._rotation11=d,S._rotation12=X,S._rotation20=z,S._rotation21=Y,S._rotation22=Z,M=p._rotation00*T._positionX+p._rotation01*T._positionY+p._rotation02*T._positionZ,I=p._rotation10*T._positionX+p._rotation11*T._positionY+p._rotation12*T._positionZ,V=p._rotation20*T._positionX+p._rotation21*T._positionY+p._rotation22*T._positionZ,S._positionX=M,S._positionY=I,S._positionZ=V,S._positionX+=p._positionX,S._positionY+=p._positionY,S._positionZ+=p._positionZ,O._geom._computeAabb(O._aabb,O._ptransform),w=O._aabb._minX,L=O._aabb._minY,k=O._aabb._minZ,A=O._aabb._maxX,B=O._aabb._maxY,P=O._aabb._maxZ,O._geom._computeAabb(O._aabb,O._transform),O._aabb._minX=w<O._aabb._minX?w:O._aabb._minX,O._aabb._minY=L<O._aabb._minY?L:O._aabb._minY,O._aabb._minZ=k<O._aabb._minZ?k:O._aabb._minZ,O._aabb._maxX=A>O._aabb._maxX?A:O._aabb._maxX,O._aabb._maxY=B>O._aabb._maxY?B:O._aabb._maxY,O._aabb._maxZ=P>O._aabb._maxZ?P:O._aabb._maxZ,null!=O._proxy){let t,i,s;t=O._transform._positionX-O._ptransform._positionX,i=O._transform._positionY-O._ptransform._positionY,s=O._transform._positionZ-O._ptransform._positionZ;let a=O.displacement;a.x=t,a.y=i,a.z=s,O._rigidBody._world._broadPhase.moveProxy(O._proxy,O._aabb,O.displacement)}O=m}this._sleeping=!1,this._sleepTime=0}getOrientation(){let t,i,s,o,n,e=new a.common.Quat,r=this._transform._rotation00,_=this._transform._rotation11,l=this._transform._rotation22,h=r+_+l;return h>0?(n=Math.sqrt(h+1),o=.5*n,n=.5/n,t=(this._transform._rotation21-this._transform._rotation12)*n,i=(this._transform._rotation02-this._transform._rotation20)*n,s=(this._transform._rotation10-this._transform._rotation01)*n):r>_?r>l?(n=Math.sqrt(r-_-l+1),t=.5*n,n=.5/n,i=(this._transform._rotation01+this._transform._rotation10)*n,s=(this._transform._rotation02+this._transform._rotation20)*n,o=(this._transform._rotation21-this._transform._rotation12)*n):(n=Math.sqrt(l-r-_+1),s=.5*n,n=.5/n,t=(this._transform._rotation02+this._transform._rotation20)*n,i=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation10-this._transform._rotation01)*n):_>l?(n=Math.sqrt(_-l-r+1),i=.5*n,n=.5/n,t=(this._transform._rotation01+this._transform._rotation10)*n,s=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation02-this._transform._rotation20)*n):(n=Math.sqrt(l-r-_+1),s=.5*n,n=.5/n,t=(this._transform._rotation02+this._transform._rotation20)*n,i=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation10-this._transform._rotation01)*n),e.x=t,e.y=i,e.z=s,e.w=o,e}getOrientationTo(t){let i,s,a,o,n,e=this._transform._rotation00,r=this._transform._rotation11,_=this._transform._rotation22,l=e+r+_;l>0?(n=Math.sqrt(l+1),o=.5*n,n=.5/n,i=(this._transform._rotation21-this._transform._rotation12)*n,s=(this._transform._rotation02-this._transform._rotation20)*n,a=(this._transform._rotation10-this._transform._rotation01)*n):e>r?e>_?(n=Math.sqrt(e-r-_+1),i=.5*n,n=.5/n,s=(this._transform._rotation01+this._transform._rotation10)*n,a=(this._transform._rotation02+this._transform._rotation20)*n,o=(this._transform._rotation21-this._transform._rotation12)*n):(n=Math.sqrt(_-e-r+1),a=.5*n,n=.5/n,i=(this._transform._rotation02+this._transform._rotation20)*n,s=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation10-this._transform._rotation01)*n):r>_?(n=Math.sqrt(r-_-e+1),s=.5*n,n=.5/n,i=(this._transform._rotation01+this._transform._rotation10)*n,a=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation02-this._transform._rotation20)*n):(n=Math.sqrt(_-e-r+1),a=.5*n,n=.5/n,i=(this._transform._rotation02+this._transform._rotation20)*n,s=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation10-this._transform._rotation01)*n),t.x=i,t.y=s,t.z=a,t.w=o}setOrientation(t){let i,s,a,o;i=t.x,s=t.y,a=t.z,o=t.w;let n,e,r,_,l,h,c,m,b,p,x,f,u,y,g,v,d,X,z=2*i,Y=2*s,Z=2*a,M=i*z,I=s*Y,V=a*Z,w=i*Y,L=s*Z,k=i*Z,A=o*z,B=o*Y,P=o*Z;this._transform._rotation00=1-I-V,this._transform._rotation01=w-P,this._transform._rotation02=k+B,this._transform._rotation10=w+P,this._transform._rotation11=1-M-V,this._transform._rotation12=L-A,this._transform._rotation20=k-B,this._transform._rotation21=L+A,this._transform._rotation22=1-M-I,n=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,e=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,r=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,_=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,l=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,h=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,c=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,m=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,b=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=n,this._invInertia01=e,this._invInertia02=r,this._invInertia10=_,this._invInertia11=l,this._invInertia12=h,this._invInertia20=c,this._invInertia21=m,this._invInertia22=b,p=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,x=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,f=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,u=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,y=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,g=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,v=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,d=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,X=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=p,this._invInertia01=x,this._invInertia02=f,this._invInertia10=u,this._invInertia11=y,this._invInertia12=g,this._invInertia20=v,this._invInertia21=d,this._invInertia22=X,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let S=this._ptransform,T=this._transform;S._positionX=T._positionX,S._positionY=T._positionY,S._positionZ=T._positionZ,S._rotation00=T._rotation00,S._rotation01=T._rotation01,S._rotation02=T._rotation02,S._rotation10=T._rotation10,S._rotation11=T._rotation11,S._rotation12=T._rotation12,S._rotation20=T._rotation20,S._rotation21=T._rotation21,S._rotation22=T._rotation22;let C=this._shapeList;for(;null!=C;){let t,i,s,a,o,n,e,r,_,l,h,c,m=C._next,b=this._ptransform,p=this._transform,x=C._ptransform,f=C._localTransform;t=b._rotation00*f._rotation00+b._rotation01*f._rotation10+b._rotation02*f._rotation20,i=b._rotation00*f._rotation01+b._rotation01*f._rotation11+b._rotation02*f._rotation21,s=b._rotation00*f._rotation02+b._rotation01*f._rotation12+b._rotation02*f._rotation22,a=b._rotation10*f._rotation00+b._rotation11*f._rotation10+b._rotation12*f._rotation20,o=b._rotation10*f._rotation01+b._rotation11*f._rotation11+b._rotation12*f._rotation21,n=b._rotation10*f._rotation02+b._rotation11*f._rotation12+b._rotation12*f._rotation22,e=b._rotation20*f._rotation00+b._rotation21*f._rotation10+b._rotation22*f._rotation20,r=b._rotation20*f._rotation01+b._rotation21*f._rotation11+b._rotation22*f._rotation21,_=b._rotation20*f._rotation02+b._rotation21*f._rotation12+b._rotation22*f._rotation22,x._rotation00=t,x._rotation01=i,x._rotation02=s,x._rotation10=a,x._rotation11=o,x._rotation12=n,x._rotation20=e,x._rotation21=r,x._rotation22=_,l=b._rotation00*f._positionX+b._rotation01*f._positionY+b._rotation02*f._positionZ,h=b._rotation10*f._positionX+b._rotation11*f._positionY+b._rotation12*f._positionZ,c=b._rotation20*f._positionX+b._rotation21*f._positionY+b._rotation22*f._positionZ,x._positionX=l,x._positionY=h,x._positionZ=c,x._positionX+=b._positionX,x._positionY+=b._positionY,x._positionZ+=b._positionZ;let u,y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S=C._transform,T=C._localTransform;if(u=p._rotation00*T._rotation00+p._rotation01*T._rotation10+p._rotation02*T._rotation20,y=p._rotation00*T._rotation01+p._rotation01*T._rotation11+p._rotation02*T._rotation21,g=p._rotation00*T._rotation02+p._rotation01*T._rotation12+p._rotation02*T._rotation22,v=p._rotation10*T._rotation00+p._rotation11*T._rotation10+p._rotation12*T._rotation20,d=p._rotation10*T._rotation01+p._rotation11*T._rotation11+p._rotation12*T._rotation21,X=p._rotation10*T._rotation02+p._rotation11*T._rotation12+p._rotation12*T._rotation22,z=p._rotation20*T._rotation00+p._rotation21*T._rotation10+p._rotation22*T._rotation20,Y=p._rotation20*T._rotation01+p._rotation21*T._rotation11+p._rotation22*T._rotation21,Z=p._rotation20*T._rotation02+p._rotation21*T._rotation12+p._rotation22*T._rotation22,S._rotation00=u,S._rotation01=y,S._rotation02=g,S._rotation10=v,S._rotation11=d,S._rotation12=X,S._rotation20=z,S._rotation21=Y,S._rotation22=Z,M=p._rotation00*T._positionX+p._rotation01*T._positionY+p._rotation02*T._positionZ,I=p._rotation10*T._positionX+p._rotation11*T._positionY+p._rotation12*T._positionZ,V=p._rotation20*T._positionX+p._rotation21*T._positionY+p._rotation22*T._positionZ,S._positionX=M,S._positionY=I,S._positionZ=V,S._positionX+=p._positionX,S._positionY+=p._positionY,S._positionZ+=p._positionZ,C._geom._computeAabb(C._aabb,C._ptransform),w=C._aabb._minX,L=C._aabb._minY,k=C._aabb._minZ,A=C._aabb._maxX,B=C._aabb._maxY,P=C._aabb._maxZ,C._geom._computeAabb(C._aabb,C._transform),C._aabb._minX=w<C._aabb._minX?w:C._aabb._minX,C._aabb._minY=L<C._aabb._minY?L:C._aabb._minY,C._aabb._minZ=k<C._aabb._minZ?k:C._aabb._minZ,C._aabb._maxX=A>C._aabb._maxX?A:C._aabb._maxX,C._aabb._maxY=B>C._aabb._maxY?B:C._aabb._maxY,C._aabb._maxZ=P>C._aabb._maxZ?P:C._aabb._maxZ,null!=C._proxy){let t,i,s;t=C._transform._positionX-C._ptransform._positionX,i=C._transform._positionY-C._ptransform._positionY,s=C._transform._positionZ-C._ptransform._positionZ;let a=C.displacement;a.x=t,a.y=i,a.z=s,C._rigidBody._world._broadPhase.moveProxy(C._proxy,C._aabb,C.displacement)}C=m}this._sleeping=!1,this._sleepTime=0}getTransform(){let t=this._transform,i=new a.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getTransformTo(t){let i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}setTransform(t){let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y;this._transform._positionX=t._positionX,this._transform._positionY=t._positionY,this._transform._positionZ=t._positionZ,this._transform._rotation00=t._rotation00,this._transform._rotation01=t._rotation01,this._transform._rotation02=t._rotation02,this._transform._rotation10=t._rotation10,this._transform._rotation11=t._rotation11,this._transform._rotation12=t._rotation12,this._transform._rotation20=t._rotation20,this._transform._rotation21=t._rotation21,this._transform._rotation22=t._rotation22,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,s=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,a=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=s,this._invInertia02=a,this._invInertia10=o,this._invInertia11=n,this._invInertia12=e,this._invInertia20=r,this._invInertia21=_,this._invInertia22=l,h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,b=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,p=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,f=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,u=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=c,this._invInertia02=m,this._invInertia10=b,this._invInertia11=p,this._invInertia12=x,this._invInertia20=f,this._invInertia21=u,this._invInertia22=y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let g=this._ptransform,v=this._transform;g._positionX=v._positionX,g._positionY=v._positionY,g._positionZ=v._positionZ,g._rotation00=v._rotation00,g._rotation01=v._rotation01,g._rotation02=v._rotation02,g._rotation10=v._rotation10,g._rotation11=v._rotation11,g._rotation12=v._rotation12,g._rotation20=v._rotation20,g._rotation21=v._rotation21,g._rotation22=v._rotation22;let d=this._shapeList;for(;null!=d;){let t,i,s,a,o,n,e,r,_,l,h,c,m=d._next,b=this._ptransform,p=this._transform,x=d._ptransform,f=d._localTransform;t=b._rotation00*f._rotation00+b._rotation01*f._rotation10+b._rotation02*f._rotation20,i=b._rotation00*f._rotation01+b._rotation01*f._rotation11+b._rotation02*f._rotation21,s=b._rotation00*f._rotation02+b._rotation01*f._rotation12+b._rotation02*f._rotation22,a=b._rotation10*f._rotation00+b._rotation11*f._rotation10+b._rotation12*f._rotation20,o=b._rotation10*f._rotation01+b._rotation11*f._rotation11+b._rotation12*f._rotation21,n=b._rotation10*f._rotation02+b._rotation11*f._rotation12+b._rotation12*f._rotation22,e=b._rotation20*f._rotation00+b._rotation21*f._rotation10+b._rotation22*f._rotation20,r=b._rotation20*f._rotation01+b._rotation21*f._rotation11+b._rotation22*f._rotation21,_=b._rotation20*f._rotation02+b._rotation21*f._rotation12+b._rotation22*f._rotation22,x._rotation00=t,x._rotation01=i,x._rotation02=s,x._rotation10=a,x._rotation11=o,x._rotation12=n,x._rotation20=e,x._rotation21=r,x._rotation22=_,l=b._rotation00*f._positionX+b._rotation01*f._positionY+b._rotation02*f._positionZ,h=b._rotation10*f._positionX+b._rotation11*f._positionY+b._rotation12*f._positionZ,c=b._rotation20*f._positionX+b._rotation21*f._positionY+b._rotation22*f._positionZ,x._positionX=l,x._positionY=h,x._positionZ=c,x._positionX+=b._positionX,x._positionY+=b._positionY,x._positionZ+=b._positionZ;let u,y,g,v,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T=d._transform,C=d._localTransform;if(u=p._rotation00*C._rotation00+p._rotation01*C._rotation10+p._rotation02*C._rotation20,y=p._rotation00*C._rotation01+p._rotation01*C._rotation11+p._rotation02*C._rotation21,g=p._rotation00*C._rotation02+p._rotation01*C._rotation12+p._rotation02*C._rotation22,v=p._rotation10*C._rotation00+p._rotation11*C._rotation10+p._rotation12*C._rotation20,X=p._rotation10*C._rotation01+p._rotation11*C._rotation11+p._rotation12*C._rotation21,z=p._rotation10*C._rotation02+p._rotation11*C._rotation12+p._rotation12*C._rotation22,Y=p._rotation20*C._rotation00+p._rotation21*C._rotation10+p._rotation22*C._rotation20,Z=p._rotation20*C._rotation01+p._rotation21*C._rotation11+p._rotation22*C._rotation21,M=p._rotation20*C._rotation02+p._rotation21*C._rotation12+p._rotation22*C._rotation22,T._rotation00=u,T._rotation01=y,T._rotation02=g,T._rotation10=v,T._rotation11=X,T._rotation12=z,T._rotation20=Y,T._rotation21=Z,T._rotation22=M,I=p._rotation00*C._positionX+p._rotation01*C._positionY+p._rotation02*C._positionZ,V=p._rotation10*C._positionX+p._rotation11*C._positionY+p._rotation12*C._positionZ,w=p._rotation20*C._positionX+p._rotation21*C._positionY+p._rotation22*C._positionZ,T._positionX=I,T._positionY=V,T._positionZ=w,T._positionX+=p._positionX,T._positionY+=p._positionY,T._positionZ+=p._positionZ,d._geom._computeAabb(d._aabb,d._ptransform),L=d._aabb._minX,k=d._aabb._minY,A=d._aabb._minZ,B=d._aabb._maxX,P=d._aabb._maxY,S=d._aabb._maxZ,d._geom._computeAabb(d._aabb,d._transform),d._aabb._minX=L<d._aabb._minX?L:d._aabb._minX,d._aabb._minY=k<d._aabb._minY?k:d._aabb._minY,d._aabb._minZ=A<d._aabb._minZ?A:d._aabb._minZ,d._aabb._maxX=B>d._aabb._maxX?B:d._aabb._maxX,d._aabb._maxY=P>d._aabb._maxY?P:d._aabb._maxY,d._aabb._maxZ=S>d._aabb._maxZ?S:d._aabb._maxZ,null!=d._proxy){let t,i,s;t=d._transform._positionX-d._ptransform._positionX,i=d._transform._positionY-d._ptransform._positionY,s=d._transform._positionZ-d._ptransform._positionZ;let a=d.displacement;a.x=t,a.y=i,a.z=s,d._rigidBody._world._broadPhase.moveProxy(d._proxy,d._aabb,d.displacement)}d=m}this._sleeping=!1,this._sleepTime=0}getMass(){return this._mass}getLocalInertia(){let t=new a.common.Mat3;return t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22,t}getLocalInertiaTo(t){t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22}getMassData(){let t=new a.dynamics.rigidbody.MassData;t.mass=this._mass;let i=t.localInertia;return i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22,t}getMassDataTo(t){t.mass=this._mass;let i=t.localInertia;i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22}setMassData(t){this._mass=t.mass;let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g=t.localInertia;if(this._localInertia00=g.e00,this._localInertia01=g.e01,this._localInertia02=g.e02,this._localInertia10=g.e10,this._localInertia11=g.e11,this._localInertia12=g.e12,this._localInertia20=g.e20,this._localInertia21=g.e21,this._localInertia22=g.e22,this._mass>0&&this._localInertia00*(this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21)-this._localInertia01*(this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20)+this._localInertia02*(this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20)>0&&0==this._type){this._invMass=1/this._mass;let t=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,i=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,s=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,a=this._localInertia00*t-this._localInertia01*i+this._localInertia02*s;(a<-1e-32||a>1e-32)&&(a=1/a),this._invLocalInertia00=t*a,this._invLocalInertia01=-(this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21)*a,this._invLocalInertia02=(this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11)*a,this._invLocalInertia10=-i*a,this._invLocalInertia11=(this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20)*a,this._invLocalInertia12=-(this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10)*a,this._invLocalInertia20=s*a,this._invLocalInertia21=-(this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20)*a,this._invLocalInertia22=(this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10)*a,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,s=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,a=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=s,this._invInertia02=a,this._invInertia10=o,this._invInertia11=n,this._invInertia12=e,this._invInertia20=r,this._invInertia21=_,this._invInertia22=l,h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,b=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,p=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,f=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,u=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=c,this._invInertia02=m,this._invInertia10=b,this._invInertia11=p,this._invInertia12=x,this._invInertia20=f,this._invInertia21=u,this._invInertia22=y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getRotationFactor(){let t=this._rotFactor;return new a.common.Vec3(t.x,t.y,t.z)}setRotationFactor(t){let i,s,a,o,n,e,r,_,l,h,c,m,b,p,x,f,u,y,g=this._rotFactor;g.x=t.x,g.y=t.y,g.z=t.z,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,s=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,a=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=s,this._invInertia02=a,this._invInertia10=o,this._invInertia11=n,this._invInertia12=e,this._invInertia20=r,this._invInertia21=_,this._invInertia22=l,h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,b=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,p=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,f=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,u=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=c,this._invInertia02=m,this._invInertia10=b,this._invInertia11=p,this._invInertia12=x,this._invInertia20=f,this._invInertia21=u,this._invInertia22=y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getLinearVelocity(){let t=new a.common.Vec3;return t.x=this._velX,t.y=this._velY,t.z=this._velZ,t}getLinearVelocityTo(t){t.x=this._velX,t.y=this._velY,t.z=this._velZ}setLinearVelocity(t){1==this._type?(this._velX=0,this._velY=0,this._velZ=0):(this._velX=t.x,this._velY=t.y,this._velZ=t.z),this._sleeping=!1,this._sleepTime=0}getAngularVelocity(){let t=new a.common.Vec3;return t.x=this._angVelX,t.y=this._angVelY,t.z=this._angVelZ,t}getAngularVelocityTo(t){t.x=this._velX,t.y=this._velY,t.z=this._velZ}setAngularVelocity(t){1==this._type?(this._angVelX=0,this._angVelY=0,this._angVelZ=0):(this._angVelX=t.x,this._angVelY=t.y,this._angVelZ=t.z),this._sleeping=!1,this._sleepTime=0}addLinearVelocity(t){if(1!=this._type){let i,s,a;i=t.x,s=t.y,a=t.z,this._velX+=i,this._velY+=s,this._velZ+=a}this._sleeping=!1,this._sleepTime=0}addAngularVelocity(t){if(1!=this._type){let i,s,a;i=t.x,s=t.y,a=t.z,this._angVelX+=i,this._angVelY+=s,this._angVelZ+=a}this._sleeping=!1,this._sleepTime=0}applyImpulse(t,i){let s,a,o,n,e,r,_,l,h,c,m,b;s=t.x,a=t.y,o=t.z,this._velX+=s*this._invMass,this._velY+=a*this._invMass,this._velZ+=o*this._invMass,_=i.x,l=i.y,h=i.z,_-=this._transform._positionX,l-=this._transform._positionY,h-=this._transform._positionZ,n=l*o-h*a,e=h*s-_*o,r=_*a-l*s,c=this._invInertia00*n+this._invInertia01*e+this._invInertia02*r,m=this._invInertia10*n+this._invInertia11*e+this._invInertia12*r,b=this._invInertia20*n+this._invInertia21*e+this._invInertia22*r,n=c,e=m,r=b,this._angVelX+=n,this._angVelY+=e,this._angVelZ+=r,this._sleeping=!1,this._sleepTime=0}applyLinearImpulse(t){let i,s,a;i=t.x,s=t.y,a=t.z,this._velX+=i*this._invMass,this._velY+=s*this._invMass,this._velZ+=a*this._invMass,this._sleeping=!1,this._sleepTime=0}applyAngularImpulse(t){let i,s,a,o,n,e;i=t.x,s=t.y,a=t.z,o=this._invInertia00*i+this._invInertia01*s+this._invInertia02*a,n=this._invInertia10*i+this._invInertia11*s+this._invInertia12*a,e=this._invInertia20*i+this._invInertia21*s+this._invInertia22*a,i=o,s=n,a=e,this._angVelX+=i,this._angVelY+=s,this._angVelZ+=a,this._sleeping=!1,this._sleepTime=0}applyForce(t,i){let s,a,o,n,e,r,_,l,h;s=t.x,a=t.y,o=t.z,this._forceX+=s,this._forceY+=a,this._forceZ+=o,_=i.x,l=i.y,h=i.z,_-=this._transform._positionX,l-=this._transform._positionY,h-=this._transform._positionZ,n=l*o-h*a,e=h*s-_*o,r=_*a-l*s,this._torqueX+=n,this._torqueY+=e,this._torqueZ+=r,this._sleeping=!1,this._sleepTime=0}applyForceToCenter(t){let i,s,a;i=t.x,s=t.y,a=t.z,this._forceX+=i,this._forceY+=s,this._forceZ+=a,this._sleeping=!1,this._sleepTime=0}applyTorque(t){let i,s,a;i=t.x,s=t.y,a=t.z,this._torqueX+=i,this._torqueY+=s,this._torqueZ+=a,this._sleeping=!1,this._sleepTime=0}getLinearContactImpulse(){let t=new a.common.Vec3;return t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ,t}getLinearContactImpulseTo(t){t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ}getAngularContactImpulse(){let t=new a.common.Vec3;return t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ,t}getAngularContactImpulseTo(t){t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ}getGravityScale(){return this._gravityScale}setGravityScale(t){this._gravityScale=t,this._sleeping=!1,this._sleepTime=0}getLocalPoint(t){let i,s,o,n,e,r;i=t.x,s=t.y,o=t.z,i-=this._transform._positionX,s-=this._transform._positionY,o-=this._transform._positionZ,n=this._transform._rotation00*i+this._transform._rotation10*s+this._transform._rotation20*o,e=this._transform._rotation01*i+this._transform._rotation11*s+this._transform._rotation21*o,r=this._transform._rotation02*i+this._transform._rotation12*s+this._transform._rotation22*o,i=n,s=e,o=r;let _=new a.common.Vec3;return _.x=i,_.y=s,_.z=o,_}getLocalPointTo(t,i){let s,a,o,n,e,r;s=t.x,a=t.y,o=t.z,s-=this._transform._positionX,a-=this._transform._positionY,o-=this._transform._positionZ,n=this._transform._rotation00*s+this._transform._rotation10*a+this._transform._rotation20*o,e=this._transform._rotation01*s+this._transform._rotation11*a+this._transform._rotation21*o,r=this._transform._rotation02*s+this._transform._rotation12*a+this._transform._rotation22*o,s=n,a=e,o=r,i.x=s,i.y=a,i.z=o}getLocalVector(t){let i,s,o,n,e,r;i=t.x,s=t.y,o=t.z,n=this._transform._rotation00*i+this._transform._rotation10*s+this._transform._rotation20*o,e=this._transform._rotation01*i+this._transform._rotation11*s+this._transform._rotation21*o,r=this._transform._rotation02*i+this._transform._rotation12*s+this._transform._rotation22*o,i=n,s=e,o=r;let _=new a.common.Vec3;return _.x=i,_.y=s,_.z=o,_}getLocalVectorTo(t,i){let s,a,o,n,e,r;s=t.x,a=t.y,o=t.z,n=this._transform._rotation00*s+this._transform._rotation10*a+this._transform._rotation20*o,e=this._transform._rotation01*s+this._transform._rotation11*a+this._transform._rotation21*o,r=this._transform._rotation02*s+this._transform._rotation12*a+this._transform._rotation22*o,s=n,a=e,o=r,i.x=s,i.y=a,i.z=o}getWorldPoint(t){let i,s,o,n,e,r;i=t.x,s=t.y,o=t.z,n=this._transform._rotation00*i+this._transform._rotation01*s+this._transform._rotation02*o,e=this._transform._rotation10*i+this._transform._rotation11*s+this._transform._rotation12*o,r=this._transform._rotation20*i+this._transform._rotation21*s+this._transform._rotation22*o,i=n,s=e,o=r,i+=this._transform._positionX,s+=this._transform._positionY,o+=this._transform._positionZ;let _=new a.common.Vec3;return _.x=i,_.y=s,_.z=o,_}getWorldPointTo(t,i){let s,a,o,n,e,r;s=t.x,a=t.y,o=t.z,n=this._transform._rotation00*s+this._transform._rotation01*a+this._transform._rotation02*o,e=this._transform._rotation10*s+this._transform._rotation11*a+this._transform._rotation12*o,r=this._transform._rotation20*s+this._transform._rotation21*a+this._transform._rotation22*o,s=n,a=e,o=r,s+=this._transform._positionX,a+=this._transform._positionY,o+=this._transform._positionZ,i.x=s,i.y=a,i.z=o}getWorldVector(t){let i,s,o,n,e,r;i=t.x,s=t.y,o=t.z,n=this._transform._rotation00*i+this._transform._rotation01*s+this._transform._rotation02*o,e=this._transform._rotation10*i+this._transform._rotation11*s+this._transform._rotation12*o,r=this._transform._rotation20*i+this._transform._rotation21*s+this._transform._rotation22*o,i=n,s=e,o=r;let _=new a.common.Vec3;return _.x=i,_.y=s,_.z=o,_}getWorldVectorTo(t,i){let s,a,o,n,e,r;s=t.x,a=t.y,o=t.z,n=this._transform._rotation00*s+this._transform._rotation01*a+this._transform._rotation02*o,e=this._transform._rotation10*s+this._transform._rotation11*a+this._transform._rotation12*o,r=this._transform._rotation20*s+this._transform._rotation21*a+this._transform._rotation22*o,s=n,a=e,o=r,i.x=s,i.y=a,i.z=o}getNumShapes(){return this._numShapes}getShapeList(){return this._shapeList}getNumContactLinks(){return this._numContactLinks}getContactLinkList(){return this._contactLinkList}getNumJointLinks(){return this._numJointLinks}getJointLinkList(){return this._jointLinkList}addShape(t){if(null==this._shapeList?(this._shapeList=t,this._shapeListLast=t):(this._shapeListLast._next=t,t._prev=this._shapeListLast,this._shapeListLast=t),this._numShapes++,t._rigidBody=this,null!=this._world){let i=this._world;t._proxy=i._broadPhase.createProxy(t,t._aabb),t._id=i._shapeIdCount++,i._numShapes++}this.updateMass();let i=this._shapeList;for(;null!=i;){let t,s,a,o,n,e,r,_,l,h,c,m,b=i._next,p=this._ptransform,x=this._transform,f=i._ptransform,u=i._localTransform;t=p._rotation00*u._rotation00+p._rotation01*u._rotation10+p._rotation02*u._rotation20,s=p._rotation00*u._rotation01+p._rotation01*u._rotation11+p._rotation02*u._rotation21,a=p._rotation00*u._rotation02+p._rotation01*u._rotation12+p._rotation02*u._rotation22,o=p._rotation10*u._rotation00+p._rotation11*u._rotation10+p._rotation12*u._rotation20,n=p._rotation10*u._rotation01+p._rotation11*u._rotation11+p._rotation12*u._rotation21,e=p._rotation10*u._rotation02+p._rotation11*u._rotation12+p._rotation12*u._rotation22,r=p._rotation20*u._rotation00+p._rotation21*u._rotation10+p._rotation22*u._rotation20,_=p._rotation20*u._rotation01+p._rotation21*u._rotation11+p._rotation22*u._rotation21,l=p._rotation20*u._rotation02+p._rotation21*u._rotation12+p._rotation22*u._rotation22,f._rotation00=t,f._rotation01=s,f._rotation02=a,f._rotation10=o,f._rotation11=n,f._rotation12=e,f._rotation20=r,f._rotation21=_,f._rotation22=l,h=p._rotation00*u._positionX+p._rotation01*u._positionY+p._rotation02*u._positionZ,c=p._rotation10*u._positionX+p._rotation11*u._positionY+p._rotation12*u._positionZ,m=p._rotation20*u._positionX+p._rotation21*u._positionY+p._rotation22*u._positionZ,f._positionX=h,f._positionY=c,f._positionZ=m,f._positionX+=p._positionX,f._positionY+=p._positionY,f._positionZ+=p._positionZ;let y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T=i._transform,C=i._localTransform;if(y=x._rotation00*C._rotation00+x._rotation01*C._rotation10+x._rotation02*C._rotation20,g=x._rotation00*C._rotation01+x._rotation01*C._rotation11+x._rotation02*C._rotation21,v=x._rotation00*C._rotation02+x._rotation01*C._rotation12+x._rotation02*C._rotation22,d=x._rotation10*C._rotation00+x._rotation11*C._rotation10+x._rotation12*C._rotation20,X=x._rotation10*C._rotation01+x._rotation11*C._rotation11+x._rotation12*C._rotation21,z=x._rotation10*C._rotation02+x._rotation11*C._rotation12+x._rotation12*C._rotation22,Y=x._rotation20*C._rotation00+x._rotation21*C._rotation10+x._rotation22*C._rotation20,Z=x._rotation20*C._rotation01+x._rotation21*C._rotation11+x._rotation22*C._rotation21,M=x._rotation20*C._rotation02+x._rotation21*C._rotation12+x._rotation22*C._rotation22,T._rotation00=y,T._rotation01=g,T._rotation02=v,T._rotation10=d,T._rotation11=X,T._rotation12=z,T._rotation20=Y,T._rotation21=Z,T._rotation22=M,I=x._rotation00*C._positionX+x._rotation01*C._positionY+x._rotation02*C._positionZ,V=x._rotation10*C._positionX+x._rotation11*C._positionY+x._rotation12*C._positionZ,w=x._rotation20*C._positionX+x._rotation21*C._positionY+x._rotation22*C._positionZ,T._positionX=I,T._positionY=V,T._positionZ=w,T._positionX+=x._positionX,T._positionY+=x._positionY,T._positionZ+=x._positionZ,i._geom._computeAabb(i._aabb,i._ptransform),L=i._aabb._minX,k=i._aabb._minY,A=i._aabb._minZ,B=i._aabb._maxX,P=i._aabb._maxY,S=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=L<i._aabb._minX?L:i._aabb._minX,i._aabb._minY=k<i._aabb._minY?k:i._aabb._minY,i._aabb._minZ=A<i._aabb._minZ?A:i._aabb._minZ,i._aabb._maxX=B>i._aabb._maxX?B:i._aabb._maxX,i._aabb._maxY=P>i._aabb._maxY?P:i._aabb._maxY,i._aabb._maxZ=S>i._aabb._maxZ?S:i._aabb._maxZ,null!=i._proxy){let t,s,a;t=i._transform._positionX-i._ptransform._positionX,s=i._transform._positionY-i._ptransform._positionY,a=i._transform._positionZ-i._ptransform._positionZ;let o=i.displacement;o.x=t,o.y=s,o.z=a,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=b}}removeShape(t){if(null!=this._world){let i=this._world;i._broadPhase.destroyProxy(t._proxy),t._proxy=null,t._id=-1;let s=t._rigidBody._contactLinkList;for(;null!=s;){let a=s._next,o=s._contact;if(o._s1==t||o._s2==t){let t=s._other;t._sleeping=!1,t._sleepTime=0;let a=i._contactManager,n=o._prev,e=o._next;if(null!=n&&(n._next=e),null!=e&&(e._prev=n),o==a._contactList&&(a._contactList=a._contactList._next),o==a._contactListLast&&(a._contactListLast=a._contactListLast._prev),o._next=null,o._prev=null,o._touching){let t=o._s1._contactCallback,i=o._s2._contactCallback;t==i&&(i=null),null!=t&&t.endContact(o),null!=i&&i.endContact(o)}let r=o._link1._prev,_=o._link1._next;null!=r&&(r._next=_),null!=_&&(_._prev=r),o._link1==o._b1._contactLinkList&&(o._b1._contactLinkList=o._b1._contactLinkList._next),o._link1==o._b1._contactLinkListLast&&(o._b1._contactLinkListLast=o._b1._contactLinkListLast._prev),o._link1._next=null,o._link1._prev=null;let l=o._link2._prev,h=o._link2._next;null!=l&&(l._next=h),null!=h&&(h._prev=l),o._link2==o._b2._contactLinkList&&(o._b2._contactLinkList=o._b2._contactLinkList._next),o._link2==o._b2._contactLinkListLast&&(o._b2._contactLinkListLast=o._b2._contactLinkListLast._prev),o._link2._next=null,o._link2._prev=null,o._b1._numContactLinks--,o._b2._numContactLinks--,o._link1._other=null,o._link2._other=null,o._link1._contact=null,o._link2._contact=null,o._s1=null,o._s2=null,o._b1=null,o._b2=null,o._touching=!1,o._cachedDetectorData._clear(),o._manifold._clear(),o._detector=null;let c=o._contactConstraint;c._s1=null,c._s2=null,c._b1=null,c._b2=null,c._tf1=null,c._tf2=null,o._next=a._contactPool,a._contactPool=o,a._numContacts--}s=a}i._numShapes--}let i=t._prev,s=t._next;null!=i&&(i._next=s),null!=s&&(s._prev=i),t==this._shapeList&&(this._shapeList=this._shapeList._next),t==this._shapeListLast&&(this._shapeListLast=this._shapeListLast._prev),t._next=null,t._prev=null,this._numShapes--,t._rigidBody=null,this.updateMass();let a=this._shapeList;for(;null!=a;){let t,i,s,o,n,e,r,_,l,h,c,m,b=a._next,p=this._ptransform,x=this._transform,f=a._ptransform,u=a._localTransform;t=p._rotation00*u._rotation00+p._rotation01*u._rotation10+p._rotation02*u._rotation20,i=p._rotation00*u._rotation01+p._rotation01*u._rotation11+p._rotation02*u._rotation21,s=p._rotation00*u._rotation02+p._rotation01*u._rotation12+p._rotation02*u._rotation22,o=p._rotation10*u._rotation00+p._rotation11*u._rotation10+p._rotation12*u._rotation20,n=p._rotation10*u._rotation01+p._rotation11*u._rotation11+p._rotation12*u._rotation21,e=p._rotation10*u._rotation02+p._rotation11*u._rotation12+p._rotation12*u._rotation22,r=p._rotation20*u._rotation00+p._rotation21*u._rotation10+p._rotation22*u._rotation20,_=p._rotation20*u._rotation01+p._rotation21*u._rotation11+p._rotation22*u._rotation21,l=p._rotation20*u._rotation02+p._rotation21*u._rotation12+p._rotation22*u._rotation22,f._rotation00=t,f._rotation01=i,f._rotation02=s,f._rotation10=o,f._rotation11=n,f._rotation12=e,f._rotation20=r,f._rotation21=_,f._rotation22=l,h=p._rotation00*u._positionX+p._rotation01*u._positionY+p._rotation02*u._positionZ,c=p._rotation10*u._positionX+p._rotation11*u._positionY+p._rotation12*u._positionZ,m=p._rotation20*u._positionX+p._rotation21*u._positionY+p._rotation22*u._positionZ,f._positionX=h,f._positionY=c,f._positionZ=m,f._positionX+=p._positionX,f._positionY+=p._positionY,f._positionZ+=p._positionZ;let y,g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T=a._transform,C=a._localTransform;if(y=x._rotation00*C._rotation00+x._rotation01*C._rotation10+x._rotation02*C._rotation20,g=x._rotation00*C._rotation01+x._rotation01*C._rotation11+x._rotation02*C._rotation21,v=x._rotation00*C._rotation02+x._rotation01*C._rotation12+x._rotation02*C._rotation22,d=x._rotation10*C._rotation00+x._rotation11*C._rotation10+x._rotation12*C._rotation20,X=x._rotation10*C._rotation01+x._rotation11*C._rotation11+x._rotation12*C._rotation21,z=x._rotation10*C._rotation02+x._rotation11*C._rotation12+x._rotation12*C._rotation22,Y=x._rotation20*C._rotation00+x._rotation21*C._rotation10+x._rotation22*C._rotation20,Z=x._rotation20*C._rotation01+x._rotation21*C._rotation11+x._rotation22*C._rotation21,M=x._rotation20*C._rotation02+x._rotation21*C._rotation12+x._rotation22*C._rotation22,T._rotation00=y,T._rotation01=g,T._rotation02=v,T._rotation10=d,T._rotation11=X,T._rotation12=z,T._rotation20=Y,T._rotation21=Z,T._rotation22=M,I=x._rotation00*C._positionX+x._rotation01*C._positionY+x._rotation02*C._positionZ,V=x._rotation10*C._positionX+x._rotation11*C._positionY+x._rotation12*C._positionZ,w=x._rotation20*C._positionX+x._rotation21*C._positionY+x._rotation22*C._positionZ,T._positionX=I,T._positionY=V,T._positionZ=w,T._positionX+=x._positionX,T._positionY+=x._positionY,T._positionZ+=x._positionZ,a._geom._computeAabb(a._aabb,a._ptransform),L=a._aabb._minX,k=a._aabb._minY,A=a._aabb._minZ,B=a._aabb._maxX,P=a._aabb._maxY,S=a._aabb._maxZ,a._geom._computeAabb(a._aabb,a._transform),a._aabb._minX=L<a._aabb._minX?L:a._aabb._minX,a._aabb._minY=k<a._aabb._minY?k:a._aabb._minY,a._aabb._minZ=A<a._aabb._minZ?A:a._aabb._minZ,a._aabb._maxX=B>a._aabb._maxX?B:a._aabb._maxX,a._aabb._maxY=P>a._aabb._maxY?P:a._aabb._maxY,a._aabb._maxZ=S>a._aabb._maxZ?S:a._aabb._maxZ,null!=a._proxy){let t,i,s;t=a._transform._positionX-a._ptransform._positionX,i=a._transform._positionY-a._ptransform._positionY,s=a._transform._positionZ-a._ptransform._positionZ;let o=a.displacement;o.x=t,o.y=i,o.z=s,a._rigidBody._world._broadPhase.moveProxy(a._proxy,a._aabb,a.displacement)}a=b}}getType(){return this._type}setType(t){this._type=t,this.updateMass()}wakeUp(){this._sleeping=!1,this._sleepTime=0}sleep(){this._sleeping=!0,this._sleepTime=0}isSleeping(){return this._sleeping}getSleepTime(){return this._sleepTime}setAutoSleep(t){this._autoSleep=t,this._sleeping=!1,this._sleepTime=0}getLinearDamping(){return this._linearDamping}setLinearDamping(t){this._linearDamping=t}getAngularDamping(){return this._angularDamping}setAngularDamping(t){this._angularDamping=t}getPrev(){return this._prev}getNext(){return this._next}},a.dynamics.rigidbody.RigidBodyConfig=class{constructor(){this.position=new a.common.Vec3,this.rotation=new a.common.Mat3,this.linearVelocity=new a.common.Vec3,this.angularVelocity=new a.common.Vec3,this.type=0,this.autoSleep=!0,this.linearDamping=0,this.angularDamping=0}},a.dynamics.rigidbody.RigidBodyType=class{},a.dynamics.rigidbody.Shape=class{constructor(t){this._id=-1,this._localTransform=new a.common.Transform,this._ptransform=new a.common.Transform,this._transform=new a.common.Transform;let i=t.position;this._localTransform._positionX=i.x,this._localTransform._positionY=i.y,this._localTransform._positionZ=i.z;let s=t.rotation;this._localTransform._rotation00=s.e00,this._localTransform._rotation01=s.e01,this._localTransform._rotation02=s.e02,this._localTransform._rotation10=s.e10,this._localTransform._rotation11=s.e11,this._localTransform._rotation12=s.e12,this._localTransform._rotation20=s.e20,this._localTransform._rotation21=s.e21,this._localTransform._rotation22=s.e22;let o=this._ptransform,n=this._localTransform;o._positionX=n._positionX,o._positionY=n._positionY,o._positionZ=n._positionZ,o._rotation00=n._rotation00,o._rotation01=n._rotation01,o._rotation02=n._rotation02,o._rotation10=n._rotation10,o._rotation11=n._rotation11,o._rotation12=n._rotation12,o._rotation20=n._rotation20,o._rotation21=n._rotation21,o._rotation22=n._rotation22;let e=this._transform,r=this._localTransform;e._positionX=r._positionX,e._positionY=r._positionY,e._positionZ=r._positionZ,e._rotation00=r._rotation00,e._rotation01=r._rotation01,e._rotation02=r._rotation02,e._rotation10=r._rotation10,e._rotation11=r._rotation11,e._rotation12=r._rotation12,e._rotation20=r._rotation20,e._rotation21=r._rotation21,e._rotation22=r._rotation22,this._restitution=t.restitution,this._friction=t.friction,this._density=t.density,this._geom=t.geometry,this._collisionGroup=t.collisionGroup,this._collisionMask=t.collisionMask,this._contactCallback=t.contactCallback,this._aabb=new a.collision.geometry.Aabb,this._proxy=null,this.displacement=new a.common.Vec3}getFriction(){return this._friction}setFriction(t){this._friction=t}getRestitution(){return this._restitution}setRestitution(t){this._restitution=t}getLocalTransform(){let t=this._localTransform,i=new a.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getLocalTransformTo(t){let i=this._localTransform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}getTransform(){let t=this._transform,i=new a.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getTransformTo(t){let i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}setLocalTransform(t){let i=this._localTransform;if(i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,null!=this._rigidBody){let t=this._rigidBody;t.updateMass();let i=t._shapeList;for(;null!=i;){let s,a,o,n,e,r,_,l,h,c,m,b,p=i._next,x=t._ptransform,f=t._transform,u=i._ptransform,y=i._localTransform;s=x._rotation00*y._rotation00+x._rotation01*y._rotation10+x._rotation02*y._rotation20,a=x._rotation00*y._rotation01+x._rotation01*y._rotation11+x._rotation02*y._rotation21,o=x._rotation00*y._rotation02+x._rotation01*y._rotation12+x._rotation02*y._rotation22,n=x._rotation10*y._rotation00+x._rotation11*y._rotation10+x._rotation12*y._rotation20,e=x._rotation10*y._rotation01+x._rotation11*y._rotation11+x._rotation12*y._rotation21,r=x._rotation10*y._rotation02+x._rotation11*y._rotation12+x._rotation12*y._rotation22,_=x._rotation20*y._rotation00+x._rotation21*y._rotation10+x._rotation22*y._rotation20,l=x._rotation20*y._rotation01+x._rotation21*y._rotation11+x._rotation22*y._rotation21,h=x._rotation20*y._rotation02+x._rotation21*y._rotation12+x._rotation22*y._rotation22,u._rotation00=s,u._rotation01=a,u._rotation02=o,u._rotation10=n,u._rotation11=e,u._rotation12=r,u._rotation20=_,u._rotation21=l,u._rotation22=h,c=x._rotation00*y._positionX+x._rotation01*y._positionY+x._rotation02*y._positionZ,m=x._rotation10*y._positionX+x._rotation11*y._positionY+x._rotation12*y._positionZ,b=x._rotation20*y._positionX+x._rotation21*y._positionY+x._rotation22*y._positionZ,u._positionX=c,u._positionY=m,u._positionZ=b,u._positionX+=x._positionX,u._positionY+=x._positionY,u._positionZ+=x._positionZ;let g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T,C=i._transform,j=i._localTransform;if(g=f._rotation00*j._rotation00+f._rotation01*j._rotation10+f._rotation02*j._rotation20,v=f._rotation00*j._rotation01+f._rotation01*j._rotation11+f._rotation02*j._rotation21,d=f._rotation00*j._rotation02+f._rotation01*j._rotation12+f._rotation02*j._rotation22,X=f._rotation10*j._rotation00+f._rotation11*j._rotation10+f._rotation12*j._rotation20,z=f._rotation10*j._rotation01+f._rotation11*j._rotation11+f._rotation12*j._rotation21,Y=f._rotation10*j._rotation02+f._rotation11*j._rotation12+f._rotation12*j._rotation22,Z=f._rotation20*j._rotation00+f._rotation21*j._rotation10+f._rotation22*j._rotation20,M=f._rotation20*j._rotation01+f._rotation21*j._rotation11+f._rotation22*j._rotation21,I=f._rotation20*j._rotation02+f._rotation21*j._rotation12+f._rotation22*j._rotation22,C._rotation00=g,C._rotation01=v,C._rotation02=d,C._rotation10=X,C._rotation11=z,C._rotation12=Y,C._rotation20=Z,C._rotation21=M,C._rotation22=I,V=f._rotation00*j._positionX+f._rotation01*j._positionY+f._rotation02*j._positionZ,w=f._rotation10*j._positionX+f._rotation11*j._positionY+f._rotation12*j._positionZ,L=f._rotation20*j._positionX+f._rotation21*j._positionY+f._rotation22*j._positionZ,C._positionX=V,C._positionY=w,C._positionZ=L,C._positionX+=f._positionX,C._positionY+=f._positionY,C._positionZ+=f._positionZ,i._geom._computeAabb(i._aabb,i._ptransform),k=i._aabb._minX,A=i._aabb._minY,B=i._aabb._minZ,P=i._aabb._maxX,S=i._aabb._maxY,T=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=k<i._aabb._minX?k:i._aabb._minX,i._aabb._minY=A<i._aabb._minY?A:i._aabb._minY,i._aabb._minZ=B<i._aabb._minZ?B:i._aabb._minZ,i._aabb._maxX=P>i._aabb._maxX?P:i._aabb._maxX,i._aabb._maxY=S>i._aabb._maxY?S:i._aabb._maxY,i._aabb._maxZ=T>i._aabb._maxZ?T:i._aabb._maxZ,null!=i._proxy){let t,s,a;t=i._transform._positionX-i._ptransform._positionX,s=i._transform._positionY-i._ptransform._positionY,a=i._transform._positionZ-i._ptransform._positionZ;let o=i.displacement;o.x=t,o.y=s,o.z=a,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=p}}}getDensity(){return this._density}setDensity(t){if(this._density=t,null!=this._rigidBody){let t=this._rigidBody;t.updateMass();let i=t._shapeList;for(;null!=i;){let s,a,o,n,e,r,_,l,h,c,m,b,p=i._next,x=t._ptransform,f=t._transform,u=i._ptransform,y=i._localTransform;s=x._rotation00*y._rotation00+x._rotation01*y._rotation10+x._rotation02*y._rotation20,a=x._rotation00*y._rotation01+x._rotation01*y._rotation11+x._rotation02*y._rotation21,o=x._rotation00*y._rotation02+x._rotation01*y._rotation12+x._rotation02*y._rotation22,n=x._rotation10*y._rotation00+x._rotation11*y._rotation10+x._rotation12*y._rotation20,e=x._rotation10*y._rotation01+x._rotation11*y._rotation11+x._rotation12*y._rotation21,r=x._rotation10*y._rotation02+x._rotation11*y._rotation12+x._rotation12*y._rotation22,_=x._rotation20*y._rotation00+x._rotation21*y._rotation10+x._rotation22*y._rotation20,l=x._rotation20*y._rotation01+x._rotation21*y._rotation11+x._rotation22*y._rotation21,h=x._rotation20*y._rotation02+x._rotation21*y._rotation12+x._rotation22*y._rotation22,u._rotation00=s,u._rotation01=a,u._rotation02=o,u._rotation10=n,u._rotation11=e,u._rotation12=r,u._rotation20=_,u._rotation21=l,u._rotation22=h,c=x._rotation00*y._positionX+x._rotation01*y._positionY+x._rotation02*y._positionZ,m=x._rotation10*y._positionX+x._rotation11*y._positionY+x._rotation12*y._positionZ,b=x._rotation20*y._positionX+x._rotation21*y._positionY+x._rotation22*y._positionZ,u._positionX=c,u._positionY=m,u._positionZ=b,u._positionX+=x._positionX,u._positionY+=x._positionY,u._positionZ+=x._positionZ;let g,v,d,X,z,Y,Z,M,I,V,w,L,k,A,B,P,S,T,C=i._transform,j=i._localTransform;if(g=f._rotation00*j._rotation00+f._rotation01*j._rotation10+f._rotation02*j._rotation20,v=f._rotation00*j._rotation01+f._rotation01*j._rotation11+f._rotation02*j._rotation21,d=f._rotation00*j._rotation02+f._rotation01*j._rotation12+f._rotation02*j._rotation22,X=f._rotation10*j._rotation00+f._rotation11*j._rotation10+f._rotation12*j._rotation20,z=f._rotation10*j._rotation01+f._rotation11*j._rotation11+f._rotation12*j._rotation21,Y=f._rotation10*j._rotation02+f._rotation11*j._rotation12+f._rotation12*j._rotation22,Z=f._rotation20*j._rotation00+f._rotation21*j._rotation10+f._rotation22*j._rotation20,M=f._rotation20*j._rotation01+f._rotation21*j._rotation11+f._rotation22*j._rotation21,I=f._rotation20*j._rotation02+f._rotation21*j._rotation12+f._rotation22*j._rotation22,C._rotation00=g,C._rotation01=v,C._rotation02=d,C._rotation10=X,C._rotation11=z,C._rotation12=Y,C._rotation20=Z,C._rotation21=M,C._rotation22=I,V=f._rotation00*j._positionX+f._rotation01*j._positionY+f._rotation02*j._positionZ,w=f._rotation10*j._positionX+f._rotation11*j._positionY+f._rotation12*j._positionZ,L=f._rotation20*j._positionX+f._rotation21*j._positionY+f._rotation22*j._positionZ,C._positionX=V,C._positionY=w,C._positionZ=L,C._positionX+=f._positionX,C._positionY+=f._positionY,C._positionZ+=f._positionZ,i._geom._computeAabb(i._aabb,i._ptransform),k=i._aabb._minX,A=i._aabb._minY,B=i._aabb._minZ,P=i._aabb._maxX,S=i._aabb._maxY,T=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=k<i._aabb._minX?k:i._aabb._minX,i._aabb._minY=A<i._aabb._minY?A:i._aabb._minY,i._aabb._minZ=B<i._aabb._minZ?B:i._aabb._minZ,i._aabb._maxX=P>i._aabb._maxX?P:i._aabb._maxX,i._aabb._maxY=S>i._aabb._maxY?S:i._aabb._maxY,i._aabb._maxZ=T>i._aabb._maxZ?T:i._aabb._maxZ,null!=i._proxy){let t,s,a;t=i._transform._positionX-i._ptransform._positionX,s=i._transform._positionY-i._ptransform._positionY,a=i._transform._positionZ-i._ptransform._positionZ;let o=i.displacement;o.x=t,o.y=s,o.z=a,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=p}}}getAabb(){return this._aabb.clone()}getAabbTo(t){t.copyFrom(this._aabb)}getGeometry(){return this._geom}getRigidBody(){return this._rigidBody}getCollisionGroup(){return this._collisionGroup}setCollisionGroup(t){this._collisionGroup=t}getCollisionMask(){return this._collisionMask}setCollisionMask(t){this._collisionMask=t}getContactCallback(){return this._contactCallback}setContactCallback(t){this._contactCallback=t}getPrev(){return this._prev}getNext(){return this._next}},a.dynamics.rigidbody.ShapeConfig=class{constructor(){this.position=new a.common.Vec3,this.rotation=new a.common.Mat3,this.friction=a.common.Setting.defaultFriction,this.restitution=a.common.Setting.defaultRestitution,this.density=a.common.Setting.defaultDensity,this.collisionGroup=a.common.Setting.defaultCollisionGroup,this.collisionMask=a.common.Setting.defaultCollisionMask,this.geometry=null,this.contactCallback=null}},a.m||(a.m={}),a.m.M=class{},"undefined"!=typeof performance&&"function"==typeof performance.now&&(s.now=performance.now.bind(performance)),a.collision.broadphase.BroadPhaseType._BRUTE_FORCE=1,a.collision.broadphase.BroadPhaseType._BVH=2,a.collision.broadphase.BroadPhaseType.BRUTE_FORCE=1,a.collision.broadphase.BroadPhaseType.BVH=2,a.collision.broadphase.bvh.BvhInsertionStrategy.SIMPLE=0,a.collision.broadphase.bvh.BvhInsertionStrategy.MINIMIZE_SURFACE_AREA=1,a.collision.geometry.GeometryType._SPHERE=0,a.collision.geometry.GeometryType._BOX=1,a.collision.geometry.GeometryType._CYLINDER=2,a.collision.geometry.GeometryType._CONE=3,a.collision.geometry.GeometryType._CAPSULE=4,a.collision.geometry.GeometryType._CONVEX_HULL=5,a.collision.geometry.GeometryType._CONVEX_MIN=0,a.collision.geometry.GeometryType._CONVEX_MAX=5,a.collision.geometry.GeometryType.SPHERE=0,a.collision.geometry.GeometryType.BOX=1,a.collision.geometry.GeometryType.CYLINDER=2,a.collision.geometry.GeometryType.CONE=3,a.collision.geometry.GeometryType.CAPSULE=4,a.collision.geometry.GeometryType.CONVEX_HULL=5,a.collision.narrowphase.detector.BoxBoxDetector.EDGE_BIAS_MULT=1,a.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.OK=0,a.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.INVALID_TRIANGLE=1,a.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_PAIR_INDEX=2,a.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_TRIANGLE=3,a.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.EDGE_LOOP_BROKEN=4,a.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_OUTER_TRIANGLE=5,a.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.TRIANGLE_INVISIBLE=6,a.collision.narrowphase.detector.gjkepa.EpaTriangle.count=0,a.common.Vec3.numCreations=0,a.common.Setting.defaultFriction=.2,a.common.Setting.defaultRestitution=.2,a.common.Setting.defaultDensity=1,a.common.Setting.defaultCollisionGroup=1,a.common.Setting.defaultCollisionMask=1,a.common.Setting.maxTranslationPerStep=20,a.common.Setting.maxRotationPerStep=3.14159265358979,a.common.Setting.bvhProxyPadding=.1,a.common.Setting.bvhIncrementalCollisionThreshold=.45,a.common.Setting.defaultGJKMargin=.05,a.common.Setting.enableGJKCaching=!0,a.common.Setting.maxEPAVertices=128,a.common.Setting.maxEPAPolyhedronFaces=128,a.common.Setting.contactEnableBounceThreshold=.5,a.common.Setting.velocityBaumgarte=.2,a.common.Setting.positionSplitImpulseBaumgarte=.4,a.common.Setting.positionNgsBaumgarte=1,a.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05,a.common.Setting.defaultContactPositionCorrectionAlgorithm=0,a.common.Setting.alternativeContactPositionCorrectionAlgorithm=1,a.common.Setting.contactPersistenceThreshold=.05,a.common.Setting.maxManifoldPoints=4,a.common.Setting.defaultJointConstraintSolverType=0,a.common.Setting.defaultJointPositionCorrectionAlgorithm=0,a.common.Setting.jointWarmStartingFactorForBaungarte=.8,a.common.Setting.jointWarmStartingFactor=.95,a.common.Setting.minSpringDamperDampingRatio=1e-6,a.common.Setting.minRagdollMaxSwingAngle=1e-6,a.common.Setting.maxJacobianRows=6,a.common.Setting.directMlcpSolverEps=1e-9,a.common.Setting.islandInitialRigidBodyArraySize=128,a.common.Setting.islandInitialConstraintArraySize=128,a.common.Setting.sleepingVelocityThreshold=.2,a.common.Setting.sleepingAngularVelocityThreshold=.5,a.common.Setting.sleepingTimeThreshold=1,a.common.Setting.disableSleeping=!1,a.common.Setting.linearSlop=.005,a.common.Setting.angularSlop=.017453292519943278,a.collision.narrowphase.detector.gjkepa.GjkEpa.instance=new a.collision.narrowphase.detector.gjkepa.GjkEpa,a.collision.narrowphase.detector.gjkepa.GjkEpaResultState._SUCCEEDED=0,a.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_FAILED_TO_MAKE_TETRAHEDRON=1,a.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_DID_NOT_CONVERGE=2,a.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_INIT=257,a.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_ADD_VERTEX=258,a.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_DID_NOT_CONVERGE=259,a.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED=0,a.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_FAILED_TO_MAKE_TETRAHEDRON=1,a.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_DID_NOT_CONVERGE=2,a.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT=257,a.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX=258,a.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE=259,a.common.Mat3.numCreations=0,a.common.Mat4.numCreations=0,a.common.MathUtil.POSITIVE_INFINITY=Infinity,a.common.MathUtil.NEGATIVE_INFINITY=-1/0,a.common.MathUtil.PI=3.14159265358979,a.common.MathUtil.TWO_PI=6.28318530717958,a.common.MathUtil.HALF_PI=1.570796326794895,a.common.MathUtil.TO_RADIANS=.017453292519943278,a.common.MathUtil.TO_DEGREES=57.29577951308238,a.common.Quat.numCreations=0,a.dynamics.common.DebugDraw.SPHERE_PHI_DIVISION=8,a.dynamics.common.DebugDraw.SPHERE_THETA_DIVISION=4,a.dynamics.common.DebugDraw.CIRCLE_THETA_DIVISION=8,a.dynamics.common.Performance.broadPhaseCollisionTime=0,a.dynamics.common.Performance.narrowPhaseCollisionTime=0,a.dynamics.common.Performance.dynamicsTime=0,a.dynamics.common.Performance.totalTime=0,a.dynamics.constraint.PositionCorrectionAlgorithm._BAUMGARTE=0,a.dynamics.constraint.PositionCorrectionAlgorithm._SPLIT_IMPULSE=1,a.dynamics.constraint.PositionCorrectionAlgorithm._NGS=2,a.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE=0,a.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE=1,a.dynamics.constraint.PositionCorrectionAlgorithm.NGS=2,a.dynamics.constraint.info.JacobianRow.BIT_LINEAR_SET=1,a.dynamics.constraint.info.JacobianRow.BIT_ANGULAR_SET=2,a.dynamics.constraint.joint.JointType._SPHERICAL=0,a.dynamics.constraint.joint.JointType._REVOLUTE=1,a.dynamics.constraint.joint.JointType._CYLINDRICAL=2,a.dynamics.constraint.joint.JointType._PRISMATIC=3,a.dynamics.constraint.joint.JointType._UNIVERSAL=4,a.dynamics.constraint.joint.JointType._RAGDOLL=5,a.dynamics.constraint.joint.JointType._GENERIC=6,a.dynamics.constraint.joint.JointType.SPHERICAL=0,a.dynamics.constraint.joint.JointType.REVOLUTE=1,a.dynamics.constraint.joint.JointType.CYLINDRICAL=2,a.dynamics.constraint.joint.JointType.PRISMATIC=3,a.dynamics.constraint.joint.JointType.UNIVERSAL=4,a.dynamics.constraint.joint.JointType.RAGDOLL=5,a.dynamics.constraint.joint.JointType.GENERIC=6,a.dynamics.constraint.solver.ConstraintSolverType._ITERATIVE=0,a.dynamics.constraint.solver.ConstraintSolverType._DIRECT=1,a.dynamics.constraint.solver.ConstraintSolverType.ITERATIVE=0,a.dynamics.constraint.solver.ConstraintSolverType.DIRECT=1,a.dynamics.rigidbody.RigidBodyType._DYNAMIC=0,a.dynamics.rigidbody.RigidBodyType._STATIC=1,a.dynamics.rigidbody.RigidBodyType._KINEMATIC=2,a.dynamics.rigidbody.RigidBodyType.DYNAMIC=0,a.dynamics.rigidbody.RigidBodyType.STATIC=1,a.dynamics.rigidbody.RigidBodyType.KINEMATIC=2;const o=new Map,n={Ar:null,ArPos:{},deltaTime:0,invDelta:0,world:null,delta:0,ms:0,tmpStep:0,gravity:null,key:[],reflow:{ray:[],stat:{fps:0,delta:0,ms:0},velocity:{}}};class e{static clear(){o.clear()}static byName(t){return o.has(t)?o.get(t):null}static add(t){if("ray"!==t.type&&"contact"!==t.type)if("joint"===t.type)n.world.addJoint(t);else n.world.addRigidBody(t);o.set(t.name,t)}static remove(t){if("ray"!==t.type&&"contact"!==t.type)if("joint"===t.type)n.world.removeJoint(t);else n.world.removeRigidBody(t);o.delete(t.name)}static stats(){}}const r=a.common.Vec3,_=a.common.Quat,l=a.common.Mat3;a.common.Mat4;const h=a.common.Transform,c=a.dynamics.World,m=a.dynamics.rigidbody.RigidBodyConfig,b=a.dynamics.rigidbody.ShapeConfig,p=a.dynamics.rigidbody.RigidBody,x=a.dynamics.rigidbody.Shape,f=a.dynamics.callback.RayCastClosest;a.dynamics.callback.ContactCallback,a.collision.geometry.Aabb;const u=a.collision.geometry.BoxGeometry,y=a.collision.geometry.SphereGeometry,g=a.collision.geometry.CylinderGeometry,v=a.collision.geometry.CapsuleGeometry,d=a.collision.geometry.ConeGeometry;a.collision.geometry.RayCastHit,a.collision.geometry.ConvexGeometry;const X=a.collision.geometry.ConvexHullGeometry,z={RagdollJoint:a.dynamics.constraint.joint.RagdollJoint,UniversalJoint:a.dynamics.constraint.joint.UniversalJoint,GenericJoint:a.dynamics.constraint.joint.GenericJoint,PrismaticJoint:a.dynamics.constraint.joint.PrismaticJoint,RevoluteJoint:a.dynamics.constraint.joint.RevoluteJoint,CylindricalJoint:a.dynamics.constraint.joint.CylindricalJoint,SphericalJoint:a.dynamics.constraint.joint.SphericalJoint,RagdollJointConfig:a.dynamics.constraint.joint.RagdollJointConfig,UniversalJointConfig:a.dynamics.constraint.joint.UniversalJointConfig,GenericJointConfig:a.dynamics.constraint.joint.GenericJointConfig,PrismaticJointConfig:a.dynamics.constraint.joint.PrismaticJointConfig,RevoluteJointConfig:a.dynamics.constraint.joint.RevoluteJointConfig,CylindricalJointConfig:a.dynamics.constraint.joint.CylindricalJointConfig,SphericalJointConfig:a.dynamics.constraint.joint.SphericalJointConfig,RotationalLimitMotor:a.dynamics.constraint.joint.RotationalLimitMotor,TranslationalLimitMotor:a.dynamics.constraint.joint.TranslationalLimitMotor,SpringDamper:a.dynamics.constraint.joint.SpringDamper};h.prototype.fromArray=function(t,i,s,a){a=(a=s||0)||0,t&&this._position.fromArray(t,s),i&&this._rotation.fromQuat({x:i[a],y:i[a+1],z:i[a+2],w:i[a+3]})},r.prototype.toArray=function(t,i){let s=void 0!==t;if(s||(t=[]),t[i=i||0]=this.x,t[i+1]=this.y,t[i+2]=this.z,!s)return t},r.prototype.fromArray=function(t,i){return i=i||0,this.x=t[i],this.y=t[i+1],this.z=t[i+2],this},r.prototype.set=function(t,i,s){return this.x=t,this.y=i,this.z=s,this},r.prototype.applyQuaternion=function(t){const i=this.x,s=this.y,a=this.z,o=t.x,n=t.y,e=t.z,r=t.w,_=r*i+n*a-e*s,l=r*s+e*i-o*a,h=r*a+o*s-n*i,c=-o*i-n*s-e*a;return this.x=_*r+c*-o+l*-e-h*-n,this.y=l*r+c*-n+h*-o-_*-e,this.z=h*r+c*-e+_*-n-l*-o,this},_.prototype.toArray=function(t,i){let s=void 0!==t;if(s||(t=[]),t[i=i||0]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,!s)return t},_.prototype.fromArray=function(t,i){return i=i||0,this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this},_.prototype.set=function(t,i,s,a){return this.x=t,this.y=i,this.z=s,this.w=a,this};const Y=4e3,Z=1e3,M=4e3,I=100,V=100,w={bodyFull:14,body:8,joint:16,contact:1,ray:11,character:16,vehicle:72,solver:128};class L{constructor(){this.id=0,this.list=[],this.type="item",this.Utils=null}reset(){let t=this.list.length;for(;t--;)this.dispose(this.list[t]);this.list=[],this.id=0}byName(t){return this.Utils.byName(t)}setName(t={}){let i=void 0!==t.name?t.name:this.type+this.id++;return t.id=this.remove(i,!0),t.name=i,i}addToWorld(t,i=-1){this.Utils.add(t),-1!==i?this.list[i]=t:this.list.push(t)}remove(t,i){let s=this.byName(t);return s?this.clear(s,i):-1}clear(t,i){let s=this.list.indexOf(t);return-1===s||i?this.list[s]=null:this.list.splice(s,1),this.dispose(t),s}dispose(t){null!==t&&this.Utils.remove(t)}add(t={}){}set(t={}){}step(t,i){}}const k=Math.PI,A=k/180,B=180/k,P=Number.EPSILON,S=.5*k,T={luminousPowers:{"110000 lm (1000W)":11e4,"3500 lm (300W)":3500,"1700 lm (100W)":1700,"800 lm (60W)":800,"400 lm (40W)":400,"180 lm (25W)":180,"20 lm (4W)":20,Off:0},luminousIrradiances:{"0.0001 lx (Moonless Night)":1e-4,"0.002 lx (Night Airglow)":.002,"0.5 lx (Full Moon)":.5,"3.4 lx (City Twilight)":3.4,"50 lx (Living Room)":50,"100 lx (Very Overcast)":100,"350 lx (Office Room)":350,"400 lx (Sunrise/Sunset)":400,"1000 lx (Overcast)":1e3,"18000 lx (Daylight)":18e3,"50000 lx (Direct Sun)":5e4},exposure:t=>Math.pow(t,5),candelaToLumens:t=>4*t*Math.PI,lumensToCandela:t=>t/(4*Math.PI),todeg:B,torad:A,toFixed:(t,i=3)=>1*t.toFixed(i),toRound:(t,i=3)=>Math.trunc(t),clamp:(t,i=0,s=1)=>t=(t=t<i?i:t)>s?s:t,clampA:(t,i,s)=>Math.max(i,Math.min(s,t)),lerp:(t,i,s)=>(1-s)*t+s*i,damp:(t,i,s,a)=>T.lerp(t,i,1-Math.exp(-s*a)),nearAngle:(t,i,s=!1)=>i+Math.atan2(Math.sin(t-i),Math.cos(t-i))*(s?B:1),unwrapDeg:t=>t-360*Math.floor((t+180)/360),unwrapRad:t=>Math.atan2(Math.sin(t),Math.cos(t)),nearEquals:(t,i,s)=>Math.abs(t-i)<=s,autoSize:(t=[1,1,1],i="box")=>{1===t.length&&(t[1]=t[0]);let s=t[0],a=t[1];return"sphere"===i&&(t=[s,s,s]),"cylinder"!==i&&"wheel"!==i&&"capsule"!==i||(t=[s,a,s]),"cone"!==i&&"pyramid"!==i||(t=[s,a,s]),2===t.length&&(t[2]=t[0]),t},shuffle:t=>t.map((t=>({value:t,sort:Math.random()}))).sort(((t,i)=>t.sort-i.sort)).map((({value:t})=>t)),randomSign:()=>Math.random()<.5?-1:1,randSpread:t=>t*(.5-Math.random()),rand:(t=0,i=1)=>t+Math.random()*(i-t),randInt:(t,i)=>t+Math.floor(Math.random()*(i-t+1)),randIntUnic:(t,i,s)=>{for(var a=[];a.length<s;){var o=T.randInt(t,i);-1===a.indexOf(o)&&a.push(o)}return a},fromTransform:(t,i,s,a=[0,0,0,1],o=!1)=>{let n=T.composeMatrixArray(t,i),e=T.composeMatrixArray(s,a);return o&&(n=T.invertMatrixArray(n)),n=T.multiplyMatrixArray(n,e),[n[12],n[13],n[14]]},fromTransformToQ:(t,i,s=!1)=>{let a=T.composeMatrixArray(t,i),o=T.decomposeFullMatrixArray(a).q;return s&&(o=T.quatInvert(o)),o},composeMatrixArray:(t,i,s=[1,1,1])=>{const a=i[0],o=i[1],n=i[2],e=i[3],r=a+a,_=o+o,l=n+n,h=a*r,c=a*_,m=a*l,b=o*_,p=o*l,x=n*l,f=e*r,u=e*_,y=e*l,g=s[0],v=s[1],d=s[2];return[(1-(b+x))*g,(c+y)*g,(m-u)*g,0,(c-y)*v,(1-(h+x))*v,(p+f)*v,0,(m+u)*d,(p-f)*d,(1-(h+b))*d,0,t[0],t[1],t[2],1]},multiplyMatrixArray:(t,i)=>{const s=t,a=i,o=[],n=s[0],e=s[4],r=s[8],_=s[12],l=s[1],h=s[5],c=s[9],m=s[13],b=s[2],p=s[6],x=s[10],f=s[14],u=s[3],y=s[7],g=s[11],v=s[15],d=a[0],X=a[4],z=a[8],Y=a[12],Z=a[1],M=a[5],I=a[9],V=a[13],w=a[2],L=a[6],k=a[10],A=a[14],B=a[3],P=a[7],S=a[11],T=a[15];return o[0]=n*d+e*Z+r*w+_*B,o[4]=n*X+e*M+r*L+_*P,o[8]=n*z+e*I+r*k+_*S,o[12]=n*Y+e*V+r*A+_*T,o[1]=l*d+h*Z+c*w+m*B,o[5]=l*X+h*M+c*L+m*P,o[9]=l*z+h*I+c*k+m*S,o[13]=l*Y+h*V+c*A+m*T,o[2]=b*d+p*Z+x*w+f*B,o[6]=b*X+p*M+x*L+f*P,o[10]=b*z+p*I+x*k+f*S,o[14]=b*Y+p*V+x*A+f*T,o[3]=u*d+y*Z+g*w+v*B,o[7]=u*X+y*M+g*L+v*P,o[11]=u*z+y*I+g*k+v*S,o[15]=u*Y+y*V+g*A+v*T,o},invertMatrixArray:t=>{const i=t,s=i[0],a=i[1],o=i[2],n=i[3],e=i[4],r=i[5],_=i[6],l=i[7],h=i[8],c=i[9],m=i[10],b=i[11],p=i[12],x=i[13],f=i[14],u=i[15],y=c*f*l-x*m*l+x*_*b-r*f*b-c*_*u+r*m*u,g=p*m*l-h*f*l-p*_*b+e*f*b+h*_*u-e*m*u,v=h*x*l-p*c*l+p*r*b-e*x*b-h*r*u+e*c*u,d=p*c*_-h*x*_-p*r*m+e*x*m+h*r*f-e*c*f,X=s*y+a*g+o*v+n*d;if(0===X)return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];const z=1/X;return i[0]=y*z,i[1]=(x*m*n-c*f*n-x*o*b+a*f*b+c*o*u-a*m*u)*z,i[2]=(r*f*n-x*_*n+x*o*l-a*f*l-r*o*u+a*_*u)*z,i[3]=(c*_*n-r*m*n-c*o*l+a*m*l+r*o*b-a*_*b)*z,i[4]=g*z,i[5]=(h*f*n-p*m*n+p*o*b-s*f*b-h*o*u+s*m*u)*z,i[6]=(p*_*n-e*f*n-p*o*l+s*f*l+e*o*u-s*_*u)*z,i[7]=(e*m*n-h*_*n+h*o*l-s*m*l-e*o*b+s*_*b)*z,i[8]=v*z,i[9]=(p*c*n-h*x*n-p*a*b+s*x*b+h*a*u-s*c*u)*z,i[10]=(e*x*n-p*r*n+p*a*l-s*x*l-e*a*u+s*r*u)*z,i[11]=(h*r*n-e*c*n-h*a*l+s*c*l+e*a*b-s*r*b)*z,i[12]=d*z,i[13]=(h*x*o-p*c*o+p*a*m-s*x*m-h*a*f+s*c*f)*z,i[14]=(p*r*o-e*x*o-p*a*_+s*x*_+e*a*f-s*r*f)*z,i[15]=(e*c*o-h*r*o+h*a*_-s*c*_-e*a*m+s*r*m)*z,i},matrixArrayDeterminant:t=>{const i=t,s=i[0],a=i[4],o=i[8],n=i[12],e=i[1],r=i[5],_=i[9],l=i[13],h=i[2],c=i[6],m=i[10],b=i[14];return i[3]*(+n*_*c-o*l*c-n*r*m+a*l*m+o*r*b-a*_*b)+i[7]*(+s*_*b-s*l*m+n*e*m-o*e*b+o*l*h-n*_*h)+i[11]*(+s*l*c-s*r*b-n*e*c+a*e*b+n*r*h-a*l*h)+i[15]*(-o*r*h-s*_*c+s*r*m+o*e*c-a*e*m+a*_*h)},decomposeMatrixArray:t=>[t[12],t[13],t[14]],decomposeFullMatrixArray:t=>{const i=t;let s=T.lengthArray([i[0],i[1],i[2]]);const a=T.lengthArray([i[4],i[5],i[6]]),o=T.lengthArray([i[8],i[9],i[10]]);T.matrixArrayDeterminant(t)<0&&(s=-s);let n=[...t];const e=1/s,r=1/a,_=1/o;n[0]*=e,n[1]*=e,n[2]*=e,n[4]*=r,n[5]*=r,n[6]*=r,n[8]*=_,n[9]*=_,n[10]*=_;let l=T.quatFromRotationMatrix(n);return{p:[t[12],t[13],t[14]],q:l,s:[s,a,o]}},applyTransformArray:(t,i,s,a=[1,1,1])=>{const o=T.composeMatrixArray(i,s,a),n=t[0],e=t[1],r=t[2],_=1/(o[3]*n+o[7]*e+o[11]*r+o[15]);return[(o[0]*n+o[4]*e+o[8]*r+o[12])*_,(o[1]*n+o[5]*e+o[9]*r+o[13])*_,(o[2]*n+o[6]*e+o[10]*r+o[14])*_]},slerpQuatArray:(t,i,s)=>{if(0===s)return t;if(1===s)return i;let a=[...t];const o=t[0],n=t[1],e=t[2],r=t[3],_=i[0],l=i[1],h=i[2],c=i[3];let m=r*c+o*_+n*l+e*h;if(m<0?(a=[-_,-l,-h,-c],m=-m):a=[...i],m>=1)return t;const b=1-m*m;if(b<=P){const t=1-s;return a[3]=t*r+s*a[3],a[0]=t*o+s*a[0],a[1]=t*n+s*a[1],a[2]=t*e+s*a[2],T.quatNomalize(a)}const p=Math.sqrt(b),x=Math.atan2(p,m),f=Math.sin((1-s)*x)/p,u=Math.sin(s*x)/p;return a[3]=r*f+a[3]*u,a[0]=o*f+a[0]*u,a[1]=n*f+a[1]*u,a[2]=e*f+a[2]*u,a},toLocalQuatArray:(t=[0,0,0],i)=>{let s=T.quatFromEuler(t),a=T.quatInvert(i.quaternion.toArray());return T.quatMultiply(a,s)},quatFromRotationMatrix:t=>{let i=[0,0,0,1];const s=t,a=s[0],o=s[4],n=s[8],e=s[1],r=s[5],_=s[9],l=s[2],h=s[6],c=s[10],m=a+r+c;if(m>0){const t=.5/Math.sqrt(m+1);i[3]=.25/t,i[0]=(h-_)*t,i[1]=(n-l)*t,i[2]=(e-o)*t}else if(a>r&&a>c){const t=2*Math.sqrt(1+a-r-c);i[3]=(h-_)/t,i[0]=.25*t,i[1]=(o+e)/t,i[2]=(n+l)/t}else if(r>c){const t=2*Math.sqrt(1+r-a-c);i[3]=(n-l)/t,i[0]=(o+e)/t,i[1]=.25*t,i[2]=(_+h)/t}else{const t=2*Math.sqrt(1+c-a-r);i[3]=(e-o)/t,i[0]=(n+l)/t,i[1]=(_+h)/t,i[2]=.25*t}return i},quatFromEuler:(t=[0,0,0],i=!0)=>{const s=Math.cos,a=Math.sin,o=i?A:1,n=t[0]*o*.5,e=t[1]*o*.5,r=t[2]*o*.5,_=s(n),l=s(e),h=s(r),c=a(n),m=a(e),b=a(r);return[c*l*h+_*m*b,_*m*h-c*l*b,_*l*b+c*m*h,_*l*h-c*m*b]},quatFromAxis:(t=[0,0,0],i,s=!0)=>{const a=.5*i*(s?A:1),o=Math.sin(a);return[t[0]*o,t[1]*o,t[2]*o,Math.cos(a)]},quatNomalize:t=>{let i=T.lengthArray(t);return 0===i?[0,0,0,1]:(i=1/i,T.scaleArray(t,i,4))},quatInvert:t=>[-t[0],-t[1],-t[2],t[3]],quatMultiply:(t,i)=>{const s=t[0],a=t[1],o=t[2],n=t[3],e=i[0],r=i[1],_=i[2],l=i[3];return[s*l+n*e+a*_-o*r,a*l+n*r+o*e-s*_,o*l+n*_+s*r-a*e,n*l-s*e-a*r-o*_]},quatToAxis:t=>{let i=2*Math.acos(t[3]);const s=Math.sqrt(1-t[3]*t[3]);return s<1e-4?[1,0,0]:[t[0]/s,t[1]/s,t[2]/s,i]},eulerFromMatrix:t=>{const i=t[0],s=t[4],a=t[8];t[1];const o=t[5],n=t[9];t[2];const e=t[6],r=t[10];let _=[0,0,0];return _[1]=Math.asin(T.clamp(a,-1,1)),Math.abs(a)<.9999999?(_[0]=Math.atan2(-n,r),_[2]=Math.atan2(-s,i)):(_[0]=Math.atan2(e,o),_[2]=0),_},angleTo:(t,i)=>2*Math.acos(Math.abs(T.clamp(T.dotArray(t,i),-1,1))),getSize:t=>.001*t.byteLength+"kb",perpendicularArray:t=>{const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);let s=Math.acos(t[1]/i);const a=Math.atan2(t[2],t[0]);s>S?s-=S:s+=S;return[i*Math.sin(s)*Math.cos(a),i*Math.cos(s),i*Math.sin(s)*Math.sin(a)]},crossArray:(t,i)=>{const s=t[0],a=t[1],o=t[2],n=i[0],e=i[1],r=i[2];return[a*r-o*e,o*n-s*r,s*e-a*n]},applyQuaternion:(t,i)=>{const s=t[0],a=t[1],o=t[2],n=i[0],e=i[1],r=i[2],_=i[3],l=2*(e*o-r*a),h=2*(r*s-n*o),c=2*(n*a-e*s);return[s+_*l+e*c-r*h,a+_*h+r*l-n*c,o+_*c+n*h-e*l]},nullArray:(t,i,s)=>{let a=0;for(;s--;)a+=t[i+s];return a},equalArray:(t,i)=>{let s=t.length;for(;s--;)if(t[s]!==i[s])return!1;return!0},lerpArray:(t,i,s)=>{if(0===s)return t;if(1===s)return i;let a=t.length,o=[];for(;a--;)o[a]=t[a],o[a]+=(i[a]-o[a])*s;return o},zeroArray:(t,i=0,s)=>{for(s=s??t.length;s--;)t[i+s]=0;return t},lengthArray:t=>{let i=t.length,s=0;for(;i--;)s+=t[i]*t[i];return Math.sqrt(s)},dotArray:(t,i)=>{let s=t.length,a=0;for(;s--;)a+=t[s]*i[s];return a},addArray:(t,i,s)=>{s=s??t.length;let a=[];for(;s--;)a[s]=t[s]+i[s];return a},subArray:(t,i,s)=>{s=s??t.length;let a=[];for(;s--;)a[s]=t[s]-i[s];return a},mulArray:(t,i,s)=>{if(i instanceof Array){let a=[];for(s=s??t.length;s--;)a[s]=t[s]*i[s];return a}return t.map((t=>t*i))},divArray:(t,i,s)=>T.mulArray(t,1/i,s),scaleArray:(t,i,s)=>T.mulArray(t,i,s),fillArray:(t,i,s=0,a)=>{for(a=a??t.length;a--;)i[s+a]=t[a]},copyArray:(t,i)=>{},cloneArray:t=>[...t],distanceArray:(t,i=[0,0,0])=>T.lengthArray(T.subArray(t,i)),normalizeArray:t=>T.divArray(t,T.lengthArray(t)||1),normalArray:(t,i=[0,0,0])=>T.normalizeArray(T.subArray(i,t)),getVolume:(t,i,s=null)=>{let a=1,o=i;switch(t){case"sphere":a=4*Math.PI*o[0]*o[0]*o[0]/3;break;case"cone":a=Math.PI*o[0]*(.5*o[1])*2;break;case"box":a=.5*o[0]*8*(.5*o[1])*(.5*o[2]);break;case"cylinder":a=Math.PI*o[0]*o[0]*(.5*o[1])*2;break;case"capsule":a=4*Math.PI*o[0]*o[0]*o[0]/3+Math.PI*o[0]*o[0]*(.5*o[1])*2;break;case"convex":case"mesh":a=T.getConvexVolume(s)}return a},getConvexVolume:t=>{let i,s=t.length/3,a=[0,0,0],o=[0,0,0];for(;s--;)i=3*s,t[i]<a[0]?a[0]=t[i]:t[i]>o[0]&&(o[0]=t[i]),t[i+1]<a[1]?a[1]=t[i+1]:t[i+1]>o[1]&&(o[1]=t[i+1]),t[i+2]<a[2]?a[2]=t[i+2]:t[i+2]>o[2]&&(o[2]=t[i+2]);let n=[o[0]-a[0],o[1]-a[1],o[2]-a[2]];return.5*n[0]*8*(.5*n[1])*(.5*n[2])},massFromDensity:(t,i)=>t*i,densityFromMass:(t,i)=>t/i,toNonIndexed:t=>t.index?t.clone().toNonIndexed():t,getIndex:(t,i)=>!t.index||i?null:t.index.array||null,getVertex:(t,i)=>{let s=t.attributes.position.array;return i&&t.index&&(s=(t=t.clone().toNonIndexed()).attributes.position.array),s},getNormal:t=>t.attributes.normal.array,getFaces:t=>{let i=[];if(t.index){let s=t.getIndex();for(let t=0;t<s.count;t+=3)i.push([s.getX(t),s.getX(t+1),s.getX(t+2)])}else{let s=t.getAttribute("position").count;for(let t=0;t<s;t+=3)i.push([t,t+1,t+2])}return i},reduce:t=>{},barycentric:(t,i)=>{},solve:(t,i)=>{}},C=T;class j extends L{constructor(){super(),this.Utils=e,this.type="ray",this.callback=new f,this.begin=new r,this.end=new r,this.p=new r,this.q=new _}step(){const t=n.Ar,i=n.ArPos[this.type];n.reflow.ray=[];let s,a,o,e,r=this.list.length,_=this.callback;for(;r--;)a=i+r*w.ray,s=this.list[r],o=s.getPoint(this.p,this.q),this.begin.fromArray(o[0]),this.end.fromArray(o[1]),t[a]=0,_.clear(),n.world.rayCast(this.begin,this.end,_),_.hit&&(t[a]=1,e=_.position.toArray(),t[a+1]=C.distanceArray(o[0],e),t[a+2]=o[0][0],t[a+3]=o[0][1],t[a+4]=o[0][2],t[a+5]=e[0],t[a+6]=e[1],t[a+7]=e[2],_.normal.toArray(t,a+8),_.shape&&(n.reflow.ray[r]=_.shape.getRigidBody().name))}add(t={}){this.setName(t);let i=new R(t);this.addToWorld(i,t.id)}set(t={},i=null){null===i&&(i=this.byName(t.name)),null!==i&&(t.begin&&(i.begin=t.begin),t.end&&(i.end=t.end))}}class R{constructor(t={}){this.type="ray",this.name=t.name,this.parent=t.parent||"",this.begin=t.begin||[0,0,0],this.end=t.end||[0,0,1]}getPoint(t,i){if(this.parent){const s=e.byName(this.parent);if(s){s.getPositionTo(t),s.getOrientationTo(i);const a=t.toArray(),o=i.toArray();return[C.applyTransformArray(this.begin,a,o),C.applyTransformArray(this.end,a,o)]}}return[this.begin,this.end]}}class q extends L{constructor(){super(),this.Utils=e,this.type="body",this.itype="body",this.num=w[this.type],this.full=!1,this.p=new r,this.v=new r,this.v2=new r,this.v3=new r,this.vv=new r,this.r=new r,this.q=new _,this.sc=new b}setFull(t){this.num=w[t?"bodyFull":"body"],this.full=t}step(){const t=n.Ar,i=n.ArPos[this.itype];let s,a,o=this.list.length;for(;o--;)s=this.list[o],a=i+o*this.num,t[a]=s.isSleeping()?0:1,s.getPositionTo(this.p),s.getOrientationTo(this.q),this.p.toArray(t,a+1),this.q.toArray(t,a+4),this.full?(s.getLinearVelocityTo(this.vv),s.getAngularVelocityTo(this.r),this.vv.toArray(t,a+8),this.r.toArray(t,a+11),1===t[a]&&(t[a]=9.8*this.vv.length())):s.getVelocity&&(s.getLinearVelocityTo(this.vv),s.getAngularVelocityTo(this.r),n.reflow.velocity[s.name]=[...this.vv.toArray(),...this.r.toArray()])}shape(t={}){let i,s=this.sc;void 0!==t.friction&&(s.friction=t.friction),void 0!==t.restitution&&(s.restitution=t.restitution),s.collisionMask=-1,void 0!==t.mask&&(s.collisionMask=t.mask),s.collisionGroup="body"===this.type?1:2,void 0!==t.group&&(s.collisionGroup=t.group);let a,o,n,e,r=t.type||"box",_=t.size||[1,1,1];switch(r){case"plane":1===_[0]&&(_=[300,0,300]),_[1]||(_[1]=1),i=new u(this.v.set(.5*_[0],.5*_[1],.5*_[2])),t.localPos?t.localPos[1]-=.5*_[1]:t.localPos=[0,.5*-_[1],0];break;case"box":i=new u(this.v.set(.5*_[0],.5*_[1],.5*_[2]));break;case"sphere":i=new y(_[0]);break;case"particle":i=new y(t.pSize||.05);break;case"cone":i=new d(_[0],.5*_[1]);break;case"cylinder":i=new g(_[0],.5*_[1]);break;case"capsule":i=new v(_[0],.5*_[1]);break;case"convex":for(o=Math.floor(t.v.length/3),e=0,a=[];o--;)n=3*e,a.push(this.v.fromArray(t.v,n).clone()),e++;i=new X(a),i._gjkMargin=t.margin||1e-4,i._useGjkRayCast=!0}return s.geometry=i,s.position.fromArray(t.localPos||[0,0,0]),s.rotation.fromQuat(this.q.fromArray(t.localQuat||[0,0,0,1])),s.density=t.density||0,new x(s)}autoMesh(t){t.type="compound",t.shapes=[];let i=t.square||!1;i=t.isTerrain||!1;let s,a,o,n=t.v,e=t.index||null;if(null!==e){let i,r,_;o=e.length/3;for(let l=0;l<o;l++)s=3*l,i=e[s],r=e[s+1],_=e[s+2],a=[n[i],n[i+1],n[i+2],n[r],n[r+1],n[r+2],n[_],n[_+1],n[_+2]],t.shapes.push({type:"convex",v:a,nogeo:!0})}else if(i){o=n.length/18;for(let i=0;i<o;i++)s=18*i,a=[n[s],n[s+1],n[s+2],n[s+3],n[s+4],n[s+5],n[s+6],n[s+7],n[s+8],n[s+9],n[s+10],n[s+11],n[s+12],n[s+13],n[s+14],n[s+15],n[s+16],n[s+17]],t.shapes.push({type:"convex",v:a,nogeo:!0})}else{o=n.length/9;for(let i=0;i<o;i++)s=9*i,a=[n[s],n[s+1],n[s+2],n[s+3],n[s+4],n[s+5],n[s+6],n[s+7],n[s+8]],t.shapes.push({type:"convex",v:a,nogeo:!0})}}add(t={}){let i=this.setName(t),s=new m,a=t.pos||[0,0,0],o=t.quat||[0,0,0,1];s.position.fromArray(a),s.rotation.fromQuat(this.q.fromArray(o)),s.autoSleep=void 0===t.autoSleep||t.autoSleep,s.type="body"===this.type?t.kinematic?2:0:1;let n=new p(s);switch("mesh"===t.type&&this.autoMesh(t),t.type){case"null":break;case"compound":let i;for(var e=0;e<t.shapes.length;e++)i=t.shapes[e],void 0!==t.density&&(i.density=t.density),void 0!==t.friction&&(i.friction=t.friction),void 0!==t.restitution&&(i.restitution=t.restitution),void 0!==t.mask&&(i.collisionMask=t.mask),void 0!==t.group&&(i.collisionGroup=t.group),void 0!==t.margin&&(i.margin=t.margin),i.pos&&(i.localPos=i.pos),i.quat&&(i.localQuat=i.quat),n.addShape(this.shape(i));break;default:t.shapeType&&(t.type=t.shapeType),n.addShape(this.shape(t))}n.name=i,n.type=this.type,n.breakable=t.breakable||!1,n.isKinematic=t.kinematic||!1,t.kinematic&&(n.pos=t.pos||[0,0,0],n.quat=t.quat||[0,0,0,1]),n.setType("body"===this.type?t.kinematic?2:0:1),delete t.kinematic,delete t.pos,delete t.quat,this.addToWorld(n,t.id),n.setLinearVelocity(this.v.set(0,0,0)),n.setAngularVelocity(this.v.set(0,0,0)),this.set(t,n)}set(t={},i=null){if(null===i&&(i=this.byName(t.name)),null!==i){if(void 0!==t.getVelocity&&(i.getVelocity=t.getVelocity),void 0!==t.kinematic&&(i.setType(t.kinematic?2:0),i.isKinematic=!!t.kinematic),t.noGravity&&i.setGravityScale(0),t.pos||t.quat){if(t.pos){if(i.isKinematic){let s=C.subArray(t.pos,i.pos);s=C.mulArray(s,n.invDelta),i.setLinearVelocity(this.v.fromArray(s)),i.pos=t.pos}i.setPosition(this.v.fromArray(t.pos))}if(t.quat){if(i.isKinematic){let s=C.quatMultiply(t.quat,C.quatInvert(i.quat)),a=C.composeMatrixArray([0,0,0],s,[1,1,1]),o=C.eulerFromMatrix(a);o=C.mulArray(o,n.invDelta),i.setAngularVelocity(this.v.fromArray(o)),i.quat=t.quat}i.setOrientation(this.q.fromArray(t.quat))}}t.sleep&&i.sleep(),(t.activate||t.wake)&&i.wakeUp(),void 0!==t.neverSleep&&(i.setAutoSleep(!t.neverSleep),t.neverSleep&&i.wakeUp()),"body"===i.type&&(t.worldForce&&i.applyForce(this.v.fromArray(t.worldForce),this.v.fromArray(t.worldForce,3)),t.force&&(t.forcePosition&&i.applyForce(this.v.fromArray(t.forcePosition),this.v.fromArray(t.force)),i.applyForceToCenter(this.v.fromArray(t.force))),t.torque&&i.applyTorque(this.v.fromArray(t.torque)),t.impulse&&(t.impulseCenter?(this.v2.fromArray(t.impulseCenter),i.applyImpulse(this.v3.fromArray(t.impulse),this.v2)):i.applyLinearImpulse(this.v.fromArray(t.impulse))),t.angularImpulse&&i.applyAngularImpulse(this.v.fromArray(t.angularImpulse)),t.gravityScale&&i.setGravityScale(t.gravityScale),void 0!==t.gravity&&i.setGravityScale(t.gravity?1:0),t.linearVelocity&&i.setLinearVelocity(this.v.fromArray(t.linearVelocity)),t.angularVelocity&&i.setAngularVelocity(this.v.fromArray(t.angularVelocity)),t.addLinearVelocity&&i.addLinearVelocity(this.v.fromArray(t.linearVelocity)),t.addAngularVelocity&&i.addAngularVelocity(this.v.fromArray(t.angularVelocity))),t.angularFactor&&i.setRotationFactor(this.v.fromArray(t.angularFactor)),t.damping&&(i.setLinearDamping(t.damping[0]),i.setAngularDamping(t.damping[1])),t.reset&&(i.setLinearVelocity(this.v.set(0,0,0)),i.setAngularVelocity(this.v.set(0,0,0))),t.massInfo&&this.getMassInfo(i)}}setShapes(t={},i=null){let s,a=i.getShapeList(),o=i.getNumShapes();for(;o--;)s=a[o],void 0!==t.density&&s.setDensity(t.density),void 0!==t.friction&&s.setFriction(t.friction),void 0!==t.restitution&&s.setRestitution(t.restitution),void 0!==t.mask&&s.setCollisionMask(t.mask),void 0!==t.group&&s.setCollisionGroup(t.group)}getMassInfo(t=null){if("string"==typeof t&&(t=this.byName(t)),null===t)return;if("body"!==this.type)return;const i={mass:t.getMass(),invMass:t._invMass,inertia:t.getLocalInertia().toArray(),invInertia:[t._invInertia00,t._invInertia01,t._invInertia02,t._invInertia10,t._invInertia11,t._invInertia12,t._invInertia20,t._invInertia21,t._invInertia22]};console.log(i)}}class E extends L{constructor(){super(),this.Utils=e,this.type="joint",this.v=new r,this.q=new _,this.m=new l,this.fullList=["x","y","z","rx","ry","rz"]}step(){const t=n.Ar,i=n.ArPos[this.type];let s,a,o=this.list.length;const e=this.v,r=this.q,_=this.m;for(;o--;)s=this.list[o],a=i+o*w.joint,s.visible&&(s.getAnchor1To(e),e.toArray(t,a),s.getBasis1To(_),r.fromMat3(_),r.toArray(t,a+3),s.getAnchor2To(e),e.toArray(t,a+7),s.getBasis2To(_),r.fromMat3(_),r.toArray(t,a+10))}add(t={}){const i=this.v;let s=this.setName(t),a=this.byName(t.b1),o=this.byName(t.b2),n=t.mode||"revolute";"fixe"===n&&(n="generic",t.lm=[0,0]),"d6"===n&&(n="generic"),"hinge"===n&&(n="revolute"),"slider"===n&&(n="cylindrical");let e=n.charAt(0).toUpperCase()+n.slice(1);"Distance"===e&&(e="Cylindrical");const r=new z[e+"JointConfig"];if(a&&(r.rigidBody1=a),o&&(r.rigidBody2=o),t.pos1&&r.localAnchor1.fromArray(t.pos1||[0,0,0]),t.pos2&&r.localAnchor2.fromArray(t.pos2||[0,0,0]),r.localAxis1&&t.axis1&&r.localAxis1.fromArray(t.axis1),r.localAxis2&&t.axis2&&r.localAxis2.fromArray(t.axis2),r.localBasis1&&t.quat1&&r.localBasis1.fromQuat(this.q.fromArray(t.quat1)),r.localBasis2&&t.quat2&&r.localBasis2.fromQuat(this.q.fromArray(t.quat2)),"ragdoll"===n)t.worldTwistAxis&&(i.fromArray(t.worldTwistAxis),a.getLocalVectorTo(i,r.localTwistAxis1),o.getLocalVectorTo(i,r.localTwistAxis2)),t.worldSwingAxis&&(i.fromArray(t.worldSwingAxis),a.getLocalVectorTo(i,r.localSwingAxis1)),t.axis1&&r.localTwistAxis1.fromArray(t.axis1||[1,0,0]),t.axis2&&r.localTwistAxis2.fromArray(t.axis2||[1,0,0]),t.axis3&&r.localSwingAxis1.fromArray(t.axis3||[0,1,0]);const _=new z[e+"Joint"](r);_.name=s,_.type=this.type,_.mode=n,_.visible=!1,this.set(t,_),this.addToWorld(_)}set(t={},i=null){let s,a,o,n;if(null===i&&(i=this.byName(t.name)),null!==i)switch(void 0!==t.visible&&(i.visible=t.visible),void 0!==t.collision&&i.setAllowCollision(t.collision),void 0!==t.breakForce&&i.setBreakForce(t.breakForce),void 0!==t.breakTorque&&i.setBreakTorque(t.breakTorque),i.mode){case"ragdoll":t.twistSd&&this.spring(i.getTwistSpringDamper(),t.twistSd),t.swingSd&&this.spring(i.getSwingSpringDamper(),t.swingSd),t.twistLm&&this.limit(i.getTwistLimitMotor(),t.twistLm),t.twistMotor&&this.motor(i.getTwistLimitMotor(),t.twistMotor),i._maxSwingAngle1=(void 0!==t.maxSwing1?t.maxSwing1:180)*A,i._maxSwingAngle2=(void 0!==t.maxSwing2?t.maxSwing2:180)*A;break;case"prismatic":case"revolute":t.spring&&(t.sd=t.spring),t.limit&&(t.lm=t.limit),t.sd&&this.spring(i.getSpringDamper(),t.sd),t.lm&&this.limit(i.getLimitMotor(),t.lm,"prismatic"===i.mode),t.motor&&this.motor(i.getLimitMotor(),t.motor,"prismatic"===i.mode);break;case"cylindrical":case"distance":t.sdr&&this.spring(i.getRotationalSpringDamper(),t.sdr),t.lmr&&this.limit(i.getRotationalLimitMotor(),t.lmr),t.sd&&this.spring(i.getTranslationalSpringDamper(),t.sd),t.lm&&this.limit(i.getTranslationalLimitMotor(),t.lm,!0),t.rmotor&&this.motor(i.getRotationalLimitMotor(),t.rmotor),t.tmotor&&this.motor(i.getTranslationalLimitMotor(),t.tmotor,!0);break;case"universal":t.sd1&&this.spring(i.getSpringDamper1(),t.sd1),t.sd2&&this.spring(i.getSpringDamper2(),t.sd2),t.lm1&&this.limit(i.getLimitMotor1(),t.lm1),t.lm2&&this.limit(i.getLimitMotor2(),t.lm2),t.motor1&&this.motor(i.getLimitMotor1(),t.motor1),t.motor2&&this.motor(i.getLimitMotor2(),t.motor2);break;case"generic":if(t.motor)for(n=i.getRotationalLimitMotors(),o=i.getTranslationalLimitMotors(),!t.motor[0]instanceof Array&&(t.motor=this.fillAll(t.motor)),s=t.motor.length;s--;)a=t.motor[s],"rx"===a[0]&&this.motor(n[0],[a[1],a[2]]),"ry"===a[0]&&this.motor(n[1],[a[1],a[2]]),"rz"===a[0]&&this.motor(n[2],[a[1],a[2]]),"x"===a[0]&&this.motor(o[0],[a[1],a[2]],!0),"y"===a[0]&&this.motor(o[1],[a[1],a[2]],!0),"z"===a[0]&&this.motor(o[2],[a[1],a[2]],!0);if(t.lm)for(n=i.getRotationalLimitMotors(),o=i.getTranslationalLimitMotors(),!t.lm[0]instanceof Array&&(t.lm=this.fillAll(t.lm)),s=t.lm.length;s--;)a=t.lm[s],"rx"===a[0]&&this.limit(n[0],[a[1],a[2]]),"ry"===a[0]&&this.limit(n[1],[a[1],a[2]]),"rz"===a[0]&&this.limit(n[2],[a[1],a[2]]),"x"===a[0]&&this.limit(o[0],[a[1],a[2]],!0),"y"===a[0]&&this.limit(o[1],[a[1],a[2]],!0),"z"===a[0]&&this.limit(o[2],[a[1],a[2]],!0);if(t.sd)for(!t.sd[0]instanceof Array&&(t.sd=this.fillAll(t.sd)),s=t.sd.length;s--;)a=t.sd[s],"rx"===a[0]&&this.spring(i._rotSds[0],[a[1],a[2]]),"ry"===a[0]&&this.spring(i._rotSds[1],[a[1],a[2]]),"rz"===a[0]&&this.spring(i._rotSds[2],[a[1],a[2]]),"x"===a[0]&&this.spring(i._translSds[0],[a[1],a[2]],!0),"y"===a[0]&&this.spring(i._translSds[1],[a[1],a[2]],!0),"z"===a[0]&&this.spring(i._translSds[2],[a[1],a[2]],!0);break;case"spherical":t.sd&&this.spring(i.getSpringDamper(),t.sd)}}fillAll(t){let s=[];for(i=this.fullList.length;i--;)s.push([this.fullList[i],...t]);return s}spring(t,i=[0,0]){t.setSpring(i[0],i[1]),void 0!==i[2]&&t.setSymplecticEuler(!!i[2])}motor(t,i=[0,0],s=!1){let a=s?1:A;t.setMotor(i[0]*a,i[1])}limit(t,i=[0,0],s=!1){let a=s?1:A;t.setLimits(i[0]*a,i[1]*a)}}class D extends L{constructor(){super(),this.Utils=e,this.type="contact"}step(){const t=n.Ar,i=n.ArPos[this.type];let s,a,o,e,r=this.list.length;for(;r--;){if(s=this.list[r],a=i+r*w.contact,o=0,e=s.b1.getContactLinkList(),null!==s.b2&&null!==e){let t=e.getContact();for(;null!==t;){if(s.b2.name===t._b2.name&&s.b1.name===t._b1.name||s.b2.name===t._b1.name&&s.b1.name===t._b2.name){o=1;break}t=t.getNext()}}t[a]=o}}add(t={}){if(this.setName(t),t.b1=this.byName(t.b1),t.b2=this.byName(t.b2),null===t.b1)return;let i=new N(t);this.addToWorld(i,t.id)}}class N{constructor(t={}){this.type="contact",this.name=t.name,this.b1=t.b1||null,this.b2=t.b2||null,this.ignore=t.ignore||[],this.result={hit:!1,point:[0,0,0],normal:[0,0,0],distance:0}}update(){}}self.onmessage=function(t){ct.message(t)};const F={},W="undefined"==typeof performance?Date:performance,J={tmp:0,n:0};let G=0,O=0,U=1/60,H=16.67,Q=10,K=2,$=!0,tt=!1,it=!1,st=!1,at=!1,ot=null,nt=!0,et=!1,rt=null,_t=null,lt={},ht="";class ct{static test(){}static message(t){let i=t.data;i.Ar&&(n.Ar=i.Ar),i.flow&&(lt=i.flow),i.m&&ct[i.m](i.o)}static post(t,i){at?self.postMessage(t,i):ot({data:t})}static init(t={}){at=!0,st=t.isBuffer||!1,void 0!==t.fps&&(U=1/t.fps),void 0!==t.substep&&(Q=t.substep),t.message&&(ot=t.message,at=!1,st=!1),ct.initItems(),ct.post({m:"ready",o:{}})}static set(t={}){n.ArPos=t.ArPos||function(t,i=!1){const s={};let a={body:Y*(i?w.bodyFull:w.body),joint:Z*w.joint,ray:I*w.ray,contact:M*w.contact,character:V*w.character},o=0;for(let t in a)s[t]=o,o+=a[t];return s.total=o,s}(0,t.full),F.body.setFull(t.full),it=t.outsideStep||!1,tt=t.isTimeout||!1,U=1/(t.fps||60),H=1e3*U,Q=t.substep||1,K=t.broadphase||2,$=void 0===t.fixe||t.fixe,n.gravity=(new r).fromArray(t.gravity||[0,-9.81,0]),null===n.world&&ct.start()}static setGravity(t){n.gravity.fromArray(t.gravity),n.world&&n.world._gravity.fromArray(t.gravity)}static start(){null===n.world&&(n.Ar=new Float32Array(n.ArPos.total),ct.initWorld()),nt=!1,et=!1,O=0,n.tmpStep=0,it||(tt?(_t&&clearTimeout(_t),_t=setTimeout(ct.step,0)):rt=setInterval(ct.step,H))}static initWorld(){n.world=new c(K,n.gravity),n.world.setNumVelocityIterations(10),n.world.setNumPositionIterations(5)}static controle(t){t!==ht&&(this.enable(ht,!1),ht=t,this.enable(ht,!0))}static enable(t,i){if(""===t)return;let s=this.byName(t);null===s?ht="":s.enable=i}static dispatch(){n.key=lt.key,lt.remove&&this.removes(lt.remove),lt.add&&this.adds(lt.add),lt.tmp&&this.changes(lt.tmp),this.controle(lt.current),lt={}}static poststep(){if(!nt&&(n.tmpStep=1,this.dispatch(),!it&&tt)){_t&&clearTimeout(_t);let t=H-(W.now()-O);t<0&&(t=0),_t=setTimeout(ct.step,t)}}static step(t){if(et&&ct.endReset(),nt||n.tmpStep>=2)return;n.tmpStep=2,G=t||W.now(),n.ms=G-O,n.delta=n.ms/1e3,O=G,n.deltaTime=$?U/Q:n.delta/Q,n.invDelta=1/($?U:n.delta);let i=Q;for(;i--;)n.world.step(n.deltaTime);ct.stepItems(),G-1e3>J.tmp&&(J.tmp=G,n.reflow.stat.fps=J.n,J.n=0),J.n++,n.reflow.stat.ms=n.ms,n.reflow.stat.delta=n.delta,st?ct.post({m:"step",reflow:n.reflow,Ar:n.Ar},[n.Ar.buffer]):ct.post({m:"step",reflow:n.reflow,Ar:n.Ar})}static byName(t){return e.byName(t)}static reset(){et=!0}static endReset(){ct.stop(),ct.resetItems(),n.world=null,ht="",e.clear(),ct.post({m:"resetCallback",o:{}})}static stop(){nt=!0,it||(_t&&clearTimeout(_t),rt&&clearInterval(rt),rt=null,_t=null)}static pause(t){let i=t.value;i!==nt&&(i?this.stop():this.start())}static initItems(){F.ray=new j,F.body=new q,F.joint=new E,F.solid=new mt,F.contact=new D,F.character=new bt}static resetItems(){Object.values(F).forEach((t=>t.reset()))}static stepItems(){Object.values(F).forEach((t=>t.step()))}static adds(t){let i=t.length,s=0;for(;i--;)this.add(t[s++])}static removes(t){let i=t.length,s=0;for(;i--;)this.remove(t[s++])}static changes(t){let i=t.length,s=0;for(;i--;)this.change(t[s++])}static add(t={}){let i=function(t){switch(t.type){case"plane":case"box":case"sphere":case"highSphere":case"customSphere":case"cylinder":case"stair":case"particle":case"cone":case"capsule":case"mesh":case"convex":case"compound":case"null":return t.mass||t.density||t.kinematic?"body":"solid";case"fixe":case"generic":case"universal":case"dof":case"d6":case"hinge":case"revolute":case"prismatic":case"cylindrical":case"slider":case"spherical":case"ragdoll":case"distance":return"joint";default:return t.type}}(t);F[i].add(t)}static remove(t={}){let i=this.byName(t.name);i&&F[t.type?t.type:i.type].clear(i)}static change(t={}){let i=this.byName(t.name);i&&F[i.type].set(t,i)}}class mt extends q{constructor(){super(),this.type="solid",this.num=0}step(){}}class bt extends q{constructor(){super(),this.itype="character",this.num=w.character,this.full=!0}}t.engine=ct}));
