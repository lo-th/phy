/**
 * @license
 * Copyright 2010-2025 Phy.js Authors
 * SPDX-License-Identifier: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three"),require("three/addons/utils/BufferGeometryUtils.js"),require("three/addons/loaders/SVGLoader.js"),require("three/addons/utils/SkeletonUtils.js"),require("three/addons/loaders/GLTFLoader.js"),require("three/addons/loaders/FBXLoader.js"),require("three/addons/loaders/OBJLoader.js"),require("three/addons/loaders/STLLoader.js"),require("three/addons/loaders/HDRLoader.js"),require("three/addons/loaders/EXRLoader.js"),require("three/addons/loaders/UltraHDRLoader.js"),require("three/addons/loaders/KTX2Loader.js"),require("three/addons/utils/SortUtils.js")):"function"==typeof define&&define.amd?define(["exports","three","three/addons/utils/BufferGeometryUtils.js","three/addons/loaders/SVGLoader.js","three/addons/utils/SkeletonUtils.js","three/addons/loaders/GLTFLoader.js","three/addons/loaders/FBXLoader.js","three/addons/loaders/OBJLoader.js","three/addons/loaders/STLLoader.js","three/addons/loaders/HDRLoader.js","three/addons/loaders/EXRLoader.js","three/addons/loaders/UltraHDRLoader.js","three/addons/loaders/KTX2Loader.js","three/addons/utils/SortUtils.js"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).PHY={},e.THREE,e.BufferGeometryUtils_js,e.SVGLoader_js,e.SkeletonUtils,e.GLTFLoader_js,e.FBXLoader_js,e.OBJLoader_js,e.STLLoader_js,e.HDRLoader_js,e.EXRLoader_js,e.UltraHDRLoader_js,e.KTX2Loader_js,e.SortUtils_js)}(this,(function(e,t,a,i,s,r,n,c,h,l,b,d,u,f){"use strict";var p="undefined"!=typeof document?document.currentScript:null;function g(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var i=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,i.get?i:{enumerable:!0,get:function(){return e[a]}})}})),t.default=e,Object.freeze(t)}var y=g(s);const x=Math.PI,w=x/180,v=180/x,k=Number.EPSILON,j=.5*x,M={luminousPowers:{"110000 lm (1000W)":11e4,"3500 lm (300W)":3500,"1700 lm (100W)":1700,"800 lm (60W)":800,"400 lm (40W)":400,"180 lm (25W)":180,"20 lm (4W)":20,Off:0},luminousIrradiances:{"0.0001 lx (Moonless Night)":1e-4,"0.002 lx (Night Airglow)":.002,"0.5 lx (Full Moon)":.5,"3.4 lx (City Twilight)":3.4,"50 lx (Living Room)":50,"100 lx (Very Overcast)":100,"350 lx (Office Room)":350,"400 lx (Sunrise/Sunset)":400,"1000 lx (Overcast)":1e3,"18000 lx (Daylight)":18e3,"50000 lx (Direct Sun)":5e4},exposure:e=>Math.pow(e,5),candelaToLumens:e=>4*e*Math.PI,lumensToCandela:e=>e/(4*Math.PI),average:e=>e?.reduce(((e,t)=>e+t),0)/e.length,atan2:(e,t)=>Math.fround(Math.atan2(e,t)),pow:(e,t)=>Math.fround(Math.pow(e,t)),sin:e=>Math.fround(Math.sin(e)),cos:e=>Math.fround(Math.cos(e)),sqrt:e=>Math.fround(Math.sqrt(e)),exp:e=>Math.fround(Math.exp(e)),todeg:v,torad:w,toFixed:(e,t=3)=>1*e.toFixed(t),toRound:(e,t=3)=>Math.trunc(e),clamp:(e,t=0,a=1)=>e=(e=e<t?t:e)>a?a:e,clampA:(e,t,a)=>Math.max(t,Math.min(a,e)),smoothstep:(e,t,a)=>e*(a=-2*(a=M.clamp(a))*a*a+3*a*a)+t*(1-a),remap:(e,t,a,i,s)=>i+(e-t)*(s-i)/(a-t),lerp:(e,t,a)=>(1-a)*e+a*t,damp:(e,t,a,i)=>M.lerp(e,t,1-Math.exp(-a*i)),nearAngle:(e,t,a=!1)=>t+Math.atan2(Math.sin(e-t),Math.cos(e-t))*(a?v:1),unwrapDeg:e=>e-360*Math.floor((e+180)/360),unwrapRad:e=>Math.atan2(Math.sin(e),Math.cos(e)),nearEquals:(e,t,a=1e-4)=>Math.abs(e-t)<=a,autoSize:(e=[1,1,1],t="box")=>{1===e.length&&(e[1]=e[0]);let a=e[0],i=e[1];return"sphere"===t&&(e=[a,a,a]),"cylinder"!==t&&"wheel"!==t&&"capsule"!==t||(e=[a,i,a]),"cone"!==t&&"pyramid"!==t||(e=[a,i,a]),2===e.length&&(e[2]=e[0]),e},shuffle:e=>{let t=e.map((e=>({value:e,sort:Math.random()}))).sort(((e,t)=>e.sort-t.sort)).map((({value:e})=>e));return t},randomSign:()=>Math.random()<.5?-1:1,randSpread:e=>e*(.5-Math.random()),rand:(e=0,t=1)=>e+Math.random()*(t-e),randInt:(e,t)=>e+Math.floor(Math.random()*(t-e+1)),randIntUnic:(e,t,a)=>{for(var i=[];i.length<a;){var s=M.randInt(e,t);-1===i.indexOf(s)&&i.push(s)}return i},fromTransform:(e,t,a,i=[0,0,0,1],s=!1)=>{let r=M.composeMatrixArray(e,t),n=M.composeMatrixArray(a,i);return s&&(r=M.invertMatrixArray(r)),r=M.multiplyMatrixArray(r,n),[r[12],r[13],r[14]]},fromTransformToQ:(e,t,a=!1)=>{let i=M.composeMatrixArray(e,t),s=M.decomposeFullMatrixArray(i).q;return a&&(s=M.quatInvert(s)),s},lerpTransform:(e,t,a)=>{let i=e[0],s=e[1],r=t[0],n=t[1];return r=M.lerpArray(i,r,a),n=M.slerpQuatArray(s,n,a),[r,n]},composeMatrixArray:(e,t,a=[1,1,1])=>{const i=t[0],s=t[1],r=t[2],n=t[3],o=i+i,c=s+s,h=r+r,l=i*o,b=i*c,d=i*h,u=s*c,f=s*h,m=r*h,p=n*o,g=n*c,y=n*h,x=a[0],w=a[1],v=a[2];return[(1-(u+m))*x,(b+y)*x,(d-g)*x,0,(b-y)*w,(1-(l+m))*w,(f+p)*w,0,(d+g)*v,(f-p)*v,(1-(l+u))*v,0,e[0],e[1],e[2],1]},multiplyMatrixArray:(e,t)=>{const a=e,i=t,s=[],r=a[0],n=a[4],o=a[8],c=a[12],h=a[1],l=a[5],b=a[9],d=a[13],u=a[2],f=a[6],m=a[10],p=a[14],g=a[3],y=a[7],x=a[11],w=a[15],v=i[0],k=i[4],j=i[8],M=i[12],A=i[1],S=i[5],E=i[9],F=i[13],z=i[2],R=i[6],P=i[10],T=i[14],I=i[3],B=i[7],C=i[11],D=i[15];return s[0]=r*v+n*A+o*z+c*I,s[4]=r*k+n*S+o*R+c*B,s[8]=r*j+n*E+o*P+c*C,s[12]=r*M+n*F+o*T+c*D,s[1]=h*v+l*A+b*z+d*I,s[5]=h*k+l*S+b*R+d*B,s[9]=h*j+l*E+b*P+d*C,s[13]=h*M+l*F+b*T+d*D,s[2]=u*v+f*A+m*z+p*I,s[6]=u*k+f*S+m*R+p*B,s[10]=u*j+f*E+m*P+p*C,s[14]=u*M+f*F+m*T+p*D,s[3]=g*v+y*A+x*z+w*I,s[7]=g*k+y*S+x*R+w*B,s[11]=g*j+y*E+x*P+w*C,s[15]=g*M+y*F+x*T+w*D,s},invertMatrixArray:e=>{const t=e,a=t[0],i=t[1],s=t[2],r=t[3],n=t[4],o=t[5],c=t[6],h=t[7],l=t[8],b=t[9],d=t[10],u=t[11],f=t[12],m=t[13],p=t[14],g=t[15],y=b*p*h-m*d*h+m*c*u-o*p*u-b*c*g+o*d*g,x=f*d*h-l*p*h-f*c*u+n*p*u+l*c*g-n*d*g,w=l*m*h-f*b*h+f*o*u-n*m*u-l*o*g+n*b*g,v=f*b*c-l*m*c-f*o*d+n*m*d+l*o*p-n*b*p,k=a*y+i*x+s*w+r*v;if(0===k)return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];const j=1/k;return t[0]=y*j,t[1]=(m*d*r-b*p*r-m*s*u+i*p*u+b*s*g-i*d*g)*j,t[2]=(o*p*r-m*c*r+m*s*h-i*p*h-o*s*g+i*c*g)*j,t[3]=(b*c*r-o*d*r-b*s*h+i*d*h+o*s*u-i*c*u)*j,t[4]=x*j,t[5]=(l*p*r-f*d*r+f*s*u-a*p*u-l*s*g+a*d*g)*j,t[6]=(f*c*r-n*p*r-f*s*h+a*p*h+n*s*g-a*c*g)*j,t[7]=(n*d*r-l*c*r+l*s*h-a*d*h-n*s*u+a*c*u)*j,t[8]=w*j,t[9]=(f*b*r-l*m*r-f*i*u+a*m*u+l*i*g-a*b*g)*j,t[10]=(n*m*r-f*o*r+f*i*h-a*m*h-n*i*g+a*o*g)*j,t[11]=(l*o*r-n*b*r-l*i*h+a*b*h+n*i*u-a*o*u)*j,t[12]=v*j,t[13]=(l*m*s-f*b*s+f*i*d-a*m*d-l*i*p+a*b*p)*j,t[14]=(f*o*s-n*m*s-f*i*c+a*m*c+n*i*p-a*o*p)*j,t[15]=(n*b*s-l*o*s+l*i*c-a*b*c-n*i*d+a*o*d)*j,t},matrixArrayDeterminant:e=>{const t=e,a=t[0],i=t[4],s=t[8],r=t[12],n=t[1],o=t[5],c=t[9],h=t[13],l=t[2],b=t[6],d=t[10],u=t[14];return t[3]*(+r*c*b-s*h*b-r*o*d+i*h*d+s*o*u-i*c*u)+t[7]*(+a*c*u-a*h*d+r*n*d-s*n*u+s*h*l-r*c*l)+t[11]*(+a*h*b-a*o*u-r*n*b+i*n*u+r*o*l-i*h*l)+t[15]*(-s*o*l-a*c*b+a*o*d+s*n*b-i*n*d+i*c*l)},decomposeMatrixArray:e=>[e[12],e[13],e[14]],decomposeFullMatrixArray:e=>{const t=e;let a=M.lengthArray([t[0],t[1],t[2]]);const i=M.lengthArray([t[4],t[5],t[6]]),s=M.lengthArray([t[8],t[9],t[10]]);M.matrixArrayDeterminant(e)<0&&(a=-a);let r=[...e];const n=1/a,o=1/i,c=1/s;r[0]*=n,r[1]*=n,r[2]*=n,r[4]*=o,r[5]*=o,r[6]*=o,r[8]*=c,r[9]*=c,r[10]*=c;let h=M.quatFromRotationMatrix(r);return{p:[e[12],e[13],e[14]],q:h,s:[a,i,s]}},applyTransformArray:(e,t,a,i=[1,1,1])=>{const s=M.composeMatrixArray(t,a,i),r=e[0],n=e[1],o=e[2],c=1/(s[3]*r+s[7]*n+s[11]*o+s[15]);return[(s[0]*r+s[4]*n+s[8]*o+s[12])*c,(s[1]*r+s[5]*n+s[9]*o+s[13])*c,(s[2]*r+s[6]*n+s[10]*o+s[14])*c]},slerpQuatArray:(e,t,a)=>{if(0===a)return e;if(1===a)return t;let i=[...e];const s=e[0],r=e[1],n=e[2],o=e[3],c=t[0],h=t[1],l=t[2],b=t[3];let d=o*b+s*c+r*h+n*l;if(d<0?(i=[-c,-h,-l,-b],d=-d):i=[...t],d>=1)return e;const u=1-d*d;if(u<=k){const e=1-a;return i[3]=e*o+a*i[3],i[0]=e*s+a*i[0],i[1]=e*r+a*i[1],i[2]=e*n+a*i[2],M.quatNomalize(i)}const f=Math.sqrt(u),m=Math.atan2(f,d),p=Math.sin((1-a)*m)/f,g=Math.sin(a*m)/f;return i[3]=o*p+i[3]*g,i[0]=s*p+i[0]*g,i[1]=r*p+i[1]*g,i[2]=n*p+i[2]*g,i},toLocalQuatArray:(e=[0,0,0],t)=>{let a=M.quatFromEuler(e),i=M.quatInvert(t.quaternion.toArray());return M.quatMultiply(i,a)},quatFromRotationMatrix:e=>{let t=[0,0,0,1];const a=e,i=a[0],s=a[4],r=a[8],n=a[1],o=a[5],c=a[9],h=a[2],l=a[6],b=a[10],d=i+o+b;if(d>0){const e=.5/Math.sqrt(d+1);t[3]=.25/e,t[0]=(l-c)*e,t[1]=(r-h)*e,t[2]=(n-s)*e}else if(i>o&&i>b){const e=2*Math.sqrt(1+i-o-b);t[3]=(l-c)/e,t[0]=.25*e,t[1]=(s+n)/e,t[2]=(r+h)/e}else if(o>b){const e=2*Math.sqrt(1+o-i-b);t[3]=(r-h)/e,t[0]=(s+n)/e,t[1]=.25*e,t[2]=(c+l)/e}else{const e=2*Math.sqrt(1+b-i-o);t[3]=(n-s)/e,t[0]=(r+h)/e,t[1]=(c+l)/e,t[2]=.25*e}return t},quatFromEuler:(e=[0,0,0],t=!0)=>{const a=Math.cos,i=Math.sin,s=t?w:1,r=e[0]*s*.5,n=e[1]*s*.5,o=e[2]*s*.5,c=a(r),h=a(n),l=a(o),b=i(r),d=i(n),u=i(o);return[b*h*l+c*d*u,c*d*l-b*h*u,c*h*u+b*d*l,c*h*l-b*d*u]},quatFromAxis:(e=[0,0,0],t,a=!0)=>{const i=.5*t*(a?w:1),s=Math.sin(i);return[e[0]*s,e[1]*s,e[2]*s,Math.cos(i)]},quatNomalize:e=>{let t=M.lengthArray(e);return 0===t?[0,0,0,1]:(t=1/t,M.scaleArray(e,t,4))},quatInvert:e=>[-e[0],-e[1],-e[2],e[3]],quatMultiply:(e,t)=>{const a=e[0],i=e[1],s=e[2],r=e[3],n=t[0],o=t[1],c=t[2],h=t[3];return[a*h+r*n+i*c-s*o,i*h+r*o+s*n-a*c,s*h+r*c+a*o-i*n,r*h-a*n-i*o-s*c]},quatToAxis:e=>{let t=2*Math.acos(e[3]);const a=Math.sqrt(1-e[3]*e[3]);return a<1e-4?[1,0,0]:[e[0]/a,e[1]/a,e[2]/a,t]},eulerFromMatrix:e=>{const t=e[0],a=e[4],i=e[8];e[1];const s=e[5],r=e[9];e[2];const n=e[6],o=e[10];let c=[0,0,0];return c[1]=Math.asin(M.clamp(i,-1,1)),Math.abs(i)<.9999999?(c[0]=Math.atan2(-r,o),c[2]=Math.atan2(-a,t)):(c[0]=Math.atan2(n,s),c[2]=0),c},angleTo:(e,t)=>2*Math.acos(Math.abs(M.clamp(M.dotArray(e,t),-1,1))),fixedArray:(e,t)=>{let a=e.length,i=[];for(;a--;)i[a]=M.toFixed(e[a],t);return i},getSize:e=>.001*e.byteLength+"kb",perpendicularArray:e=>{const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);let a=Math.acos(e[1]/t);const i=Math.atan2(e[2],e[0]);a>j?a-=j:a+=j;return[t*Math.sin(a)*Math.cos(i),t*Math.cos(a),t*Math.sin(a)*Math.sin(i)]},crossArray:(e,t)=>{const a=e[0],i=e[1],s=e[2],r=t[0],n=t[1],o=t[2];return[i*o-s*n,s*r-a*o,a*n-i*r]},applyQuaternion:(e,t)=>{const a=e[0],i=e[1],s=e[2],r=t[0],n=t[1],o=t[2],c=t[3],h=2*(n*s-o*i),l=2*(o*a-r*s),b=2*(r*i-n*a);return[a+c*h+n*b-o*l,i+c*l+o*h-r*b,s+c*b+r*l-n*h]},nullArray:(e,t,a)=>{let i=0;for(;a--;)i+=e[t+a];return i},equalArray:(e,t)=>{let a=e.length;for(;a--;)if(e[a]!==t[a])return!1;return!0},lerpArray:(e,t,a)=>{if(0===a)return e;if(1===a)return t;let i=e.length,s=[];for(;i--;)s[i]=e[i],s[i]+=(t[i]-s[i])*a;return s},zeroArray:(e,t=0,a)=>{for(a=a??e.length;a--;)e[t+a]=0;return e},lengthArray:e=>{let t=e.length,a=0;for(;t--;)a+=e[t]*e[t];return Math.sqrt(a)},dotArray:(e,t)=>{let a=e.length,i=0;for(;a--;)i+=e[a]*t[a];return i},addArray:(e,t,a)=>{a=a??e.length;let i=[];for(;a--;)i[a]=e[a]+t[a];return i},subArray:(e,t,a)=>{a=a??e.length;let i=[];for(;a--;)i[a]=e[a]-t[a];return i},mulArray:(e,t,a)=>{if(t instanceof Array){let i=[];for(a=a??e.length;a--;)i[a]=e[a]*t[a];return i}return e.map((e=>e*t))},worldscale:(e,t)=>e.map((e=>e*t)),divArray:(e,t,a)=>M.mulArray(e,1/t,a),scaleArray:(e,t,a)=>M.mulArray(e,t,a),fillArray:(e,t,a=0,i)=>{for(i=i??e.length;i--;)t[a+i]=e[i]},copyArray:(e,t)=>{},cloneArray:e=>[...e],distanceArray:(e,t=[0,0,0])=>M.lengthArray(M.subArray(e,t)),normalizeArray:e=>M.divArray(e,M.lengthArray(e)||1),normalArray:(e,t=[0,0,0])=>M.normalizeArray(M.subArray(t,e)),getCenter:(e,t)=>(e.computeBoundingBox(),e.boundingBox.getCenter(t)),getVolume:(e,t,a=null)=>{let i=1,s=t;switch(e){case"sphere":i=4*Math.PI*s[0]*s[0]*s[0]/3;break;case"cone":i=Math.PI*s[0]*(.5*s[1])*2;break;case"box":i=.5*s[0]*8*(.5*s[1])*(.5*s[2]);break;case"cylinder":i=Math.PI*s[0]*s[0]*(.5*s[1])*2;break;case"capsule":i=4*Math.PI*s[0]*s[0]*s[0]/3+Math.PI*s[0]*s[0]*(.5*s[1])*2;break;case"convex":case"mesh":i=M.getConvexVolume(a)}return i},getConvexVolume:e=>{let t,a=e.length/3,i=[0,0,0],s=[0,0,0];for(;a--;)t=3*a,e[t]<i[0]?i[0]=e[t]:e[t]>s[0]&&(s[0]=e[t]),e[t+1]<i[1]?i[1]=e[t+1]:e[t+1]>s[1]&&(s[1]=e[t+1]),e[t+2]<i[2]?i[2]=e[t+2]:e[t+2]>s[2]&&(s[2]=e[t+2]);let r=[s[0]-i[0],s[1]-i[1],s[2]-i[2]];return.5*r[0]*8*(.5*r[1])*(.5*r[2])},massFromDensity:(e,t)=>e*t,densityFromMass:(e,t)=>e/t,toNonIndexed:e=>e.index?e.clone().toNonIndexed():e,getIndex:(e,t)=>!e.index||t?null:e.index.array||null,getSameVertex:e=>{const t=e.getAttribute("position"),a=t.array,i=[],s=[],r={};new THREE.Vector3;let n,o=0;M.getHash(e);let c,h,l=!1,b=0;for(let e=0;e<t.count;e++){o=3*e,c={x:a[o],y:a[o+1],z:a[o+2],id:e},l=!1,n=i.length;for(let t=0;t<n;t++)h=i[t],c.x===h.x&&c.y===h.y&&c.z===h.z&&(l=!0,r[e]=h.id);l||(c.id=b++,i.push(c),s.push([c.x,c.y,c.z]))}return[s,r]},getVertex:(e,t)=>{let a=e.attributes.position.array;return t&&e.index&&(a=(e=e.clone().toNonIndexed()).attributes.position.array),a},getNormal:e=>e.attributes.normal.array,getFaces:e=>{let t=[];if(e.index){let a=e.getIndex();for(let e=0;e<a.count;e+=3)t.push([a.getX(e),a.getX(e+1),a.getX(e+2)])}else{let a=e.getAttribute("position").count;for(let e=0;e<a;e+=3)t.push([e,e+1,e+2])}return t},getConnectedFaces:e=>{const t=[];let a,i,s,r,n,o,c,h=e.length,l=h;for(;l--;)for(i=e[l],a=h;a--;)a!==l&&(s=e[a],r=i.filter((e=>s.includes(e))),r.length>1&&(c=[],n=[...i],o=n.indexOf(r[0]),n.splice(o,1),o=n.indexOf(r[1]),n.splice(o,1),c.push(n[0]),n=[...s],o=n.indexOf(r[0]),n.splice(o,1),o=n.indexOf(r[1]),n.splice(o,1),c.push(n[0]),t.push(c)));return t},reduce:e=>{},barycentric:(e,t)=>{},solve:(e,t)=>{},getHash:(e,t=1e-4)=>{t=Math.max(t,Number.EPSILON);const a={},i={},s=e.getAttribute("position"),r=s.count,n=s.array,o=.5*t,c=Math.log10(1/t),h=Math.pow(10,c),l=o*h;let b;for(let e=0;e<r;e++){b=3*e;let t=`${~~(n[b]*h+l)},${~~(n[b+1]*h+l)},${~~(n[b+2]*h+l)}`;a[t]?a[t].push(e):a[t]=[e]}let d=0;for(let e in a)i[d++]=a[e];return i}},A=M,S=["PHYSX","HAVOK"],E=4e3,F=1e3,z=4e3,R=100,P=100,T=50,I=20,B={bodyFull:14,body:8,joint:16,contact:1,ray:11,character:16,vehicle:72,solver:128},C=function(e,t=!1){const a={};let i={body:E*(t?B.bodyFull:B.body),joint:F*B.joint,ray:R*B.ray,contact:z*B.contact,character:P*B.character};"PHYSX"!==e&&"AMMO"!==e||(i.vehicle=T*B.vehicle),"PHYSX"===e&&(i.solver=I*B.solver),"HAVOK"!==e&&"RAPIER"!==e&&"JOLT"!==e||(B.joint=0);let s=0;for(let e in i)a[e]=s,s+=i[e];return a.total=s,a};class D extends t.LineSegments{constructor(e,a=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,4,4,5,5,0,6,7,7,8,8,9,9,10,10,11,11,6,12,13,13,14,14,15,15,16,16,17,17,12,18,19,20,21,22,23]),s=[.5,0,0,.25,.433,0,-.25,.433,0,-.5,0,0,-.25,-.433,0,.25,-.433,0,.5,0,0,.25,0,.433,-.25,0,.433,-.5,0,0,-.25,0,-.433,.25,0,-.433,0,.5,0,0,.25,.433,0,-.25,.433,0,-.5,0,0,-.25,-.433,0,.25,-.433,0,0,0,.6,0,0,0,0,0,0,.6,0,0,0,0,0,0,.6],r=new t.BufferGeometry;r.setIndex(new t.BufferAttribute(i,1)),r.setAttribute("position",new t.Float32BufferAttribute(s,3)),r.setAttribute("color",new t.Float32BufferAttribute([0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,0,1,0,0,1],3)),super(r,new t.LineBasicMaterial({color:a,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.box=e,this.type="CircleHelper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class L extends t.BufferGeometry{constructor(e=1,a=16,i=16,s=16,r=1){super(),this.type="SphereBox",this.name="SphereBox_"+e+"_"+a+"_"+i+"_"+s+"_"+r,e=e||1,a=Math.floor(a),i=Math.floor(i),s=Math.floor(s);let n,o,c,h=new t.BoxGeometry(1,1,1,a,i,s),l=new t.Vector3,b=new t.Vector3,d=h.attributes.position.count,u=h.attributes.position.array,f=h.attributes.normal.array,m=h.attributes.uv.array,p=h.attributes.uv.count,g=p/6,y=1/3,x=0,w=0;for(let e=0;e<p;e++){switch(c=Math.floor(e/g),c){case 0:x=0,w=.5;break;case 5:x=y,w=.5;break;case 1:x=2*y,w=.5;break;case 4:x=0,w=1;break;case 3:x=y,w=1;break;case 2:x=2*y,w=1}o=2*e,m[o]*=y,m[o]+=x,m[o+1]*=-.5,m[o+1]+=w,m[o]>1&&(m[o]=1),m[o]<0&&(m[o]=0),m[o+1]>1&&(m[o+1]=1),m[o+1]<0&&(m[o+1]=0)}for(let t=0;t<d;t++)n=3*t,l.set(u[n],u[n+1],u[n+2]),b.copy(l).normalize(),l.lerp(b,r).multiplyScalar(e),u[n]=l.x,u[n+1]=l.y,u[n+2]=l.z,l.normalize(),f[n]=l.x,f[n+1]=l.y,f[n+2]=l.z;h.computeTangents(),this.copy(h)}}class O extends t.BufferGeometry{constructor(e=1,i=1,s=12,r=1){super(),this.type="CapsuleGeometry";let n=Math.PI,o=e/(2*e+i),c=1-2*o;s=Math.floor(s),r=Math.floor(r);let h=Math.floor(.5*s),l=2*Math.PI,b=.5*Math.PI,d=new t.CylinderGeometry(e,e,i,s,r,!0);_(d,0,o,1,c);let u=new t.SphereGeometry(e,s,h,0,l,0,b);_(u,0,1-o,1,o);let f=new t.SphereGeometry(e,s,h,0,l,b,b);_(f,0,0,1,o);let m=(new t.Matrix4).makeRotationY(.5*-n),p=(new t.Matrix4).makeTranslation(0,.5*i,0),g=(new t.Matrix4).makeTranslation(0,.5*-i,0);d.applyMatrix4(m),u.applyMatrix4(p),f.applyMatrix4(g);let y=a.mergeVertices(a.mergeGeometries([d,u,f]));this.copy(y)}}class q extends t.BufferGeometry{constructor(e=1,a=.4,i=8,s=6,r=2*Math.PI,n=0,o=Math.PI){super(),this.type="TorusGeometryFix",this.parameters={radius:e,tube:a,radialSegments:i,tubularSegments:s,arc:r},i=Math.floor(i),s=Math.floor(s);const c=[],h=[],l=[],b=[],d=new t.Vector3,u=new t.Vector3,f=new t.Vector3;let m,p;for(m=0;m<=i;m++)for(p=0;p<=s;p++){const t=p/s*r,c=m/i*o+n;u.x=(e+a*Math.cos(c))*Math.cos(t),u.y=(e+a*Math.cos(c))*Math.sin(t),u.z=a*Math.sin(c),h.push(u.x,u.y,u.z),d.x=e*Math.cos(t),d.y=e*Math.sin(t),f.subVectors(u,d).normalize(),l.push(f.x,f.y,f.z),b.push(p/s),b.push(m/i)}for(m=1;m<=i;m++)for(p=1;p<=s;p++){const e=(s+1)*m+p-1,t=(s+1)*(m-1)+p-1,a=(s+1)*(m-1)+p,i=(s+1)*m+p;c.push(e,t,i),c.push(t,a,i)}this.setIndex(c),this.setAttribute("position",new t.Float32BufferAttribute(h,3)),this.setAttribute("normal",new t.Float32BufferAttribute(l,3)),this.setAttribute("uv",new t.Float32BufferAttribute(b,2))}}class V extends t.BufferGeometry{constructor(e=1,i=1,s=1,r=.01,n=12,o=1,c=2){super(),this.type="ChamferCyl",n=Math.floor(n),o=Math.floor(o),c=Math.floor(c);let h=new t.Matrix4,l=new t.Matrix4,b=Math.PI,d=.5*b,u=2*b,f=r/s,m=1-2*f,p=new t.CylinderGeometry(e,i,s-2*r,n,o,!0,0);h.makeRotationY(d),p.applyMatrix4(h),_(p,0,f,1,m);let g=new q(e-r,r,c,n,u,0,d),y=new t.CircleGeometry(e-r,n);l.makeTranslation(0,0,r),y.applyMatrix4(l),_(g,0,1-f,1,f);let x=a.mergeGeometries([g,y]);h.makeTranslation(0,0,.5*s-r),l.makeRotationX(-d),x.applyMatrix4(l.multiply(h)),g=new q(i-r,r,c,n,u,0,d),y=new t.CircleGeometry(i-r,n),l.makeTranslation(0,0,r),y.applyMatrix4(l),_(g,0,1-f,1,f,!0);let w=a.mergeGeometries([g,y]);h.makeTranslation(0,0,.5*s-r),l.makeRotationX(d),w.applyMatrix4(l.multiply(h));let v=a.mergeVertices(a.mergeGeometries([x,p,w]));this.copy(v)}}let G=class extends t.BufferGeometry{constructor(e=1,i=1,s=1,r=.01,n=1,o=1,c=1,h=2){super(),this.type="ChamferBox",n=Math.floor(n),o=Math.floor(o),c=Math.floor(c),h=Math.floor(h);let l=Math.PI,b=.5*l,d=2*r,u=.5*e,f=.5*i,m=.5*s,p=new t.Matrix4,g=new t.Matrix4,y=new t.Matrix4,x=r/e,w=1-2*x,v=r/i,k=1-2*x,j=r/s,M=1-2*j,A=new t.PlaneGeometry(e-d,i-d,n,o),S=new t.CylinderGeometry(r,r,e-d,h,n,!0,0,b),E=new t.CylinderGeometry(r,r,i-d,h,o,!0,0,b),F=new H(r,h,h,0,b,0,-b),z=new H(r,h,h,0,b,0,-b);_(A,-x,v,w,k),_(S,0,x,v,w),g.makeTranslation(0,f-r,0),p.makeRotationX(b),F.applyMatrix4(g.multiply(p)),g.makeTranslation(0,-f+r,0),p.makeRotationX(b),y.makeRotationY(-b),z.applyMatrix4(g.multiply(p).multiply(y));let R=a.mergeGeometries([E,F,z]),P=R.clone();g.makeTranslation(u-r,0,-r),R.applyMatrix4(g),g.makeTranslation(-u+r,0,-r),p.makeRotationZ(l),P.applyMatrix4(g.multiply(p));let T=S.clone();p.makeRotationZ(b),g.makeTranslation(0,f-r,-r),S.applyMatrix4(g.multiply(p)),g.makeTranslation(0,-f+r,-r),p.makeRotationZ(-b),T.applyMatrix4(g.multiply(p));let I=a.mergeGeometries([S,T,A,R,P]),B=I.clone();g.makeTranslation(0,0,m),I.applyMatrix4(g),g.makeTranslation(0,0,-m),p.makeRotationY(l),B.applyMatrix4(g.multiply(p)),A=new t.PlaneGeometry(s-d,i-d,c,o),S=new t.CylinderGeometry(r,r,s-d,h,c,!0,0,b),T=S.clone(),_(A,-j,v,M,k),g.makeTranslation(0,-(f-r),-r,0),p.makeRotationZ(-b),S.applyMatrix4(g.multiply(p)),g.makeTranslation(0,f-r,-r,0),p.makeRotationZ(b),T.applyMatrix4(g.multiply(p));let C=a.mergeGeometries([S,T,A]),D=C.clone();g.makeTranslation(-u,0,0),p.makeRotationY(-b),C.applyMatrix4(g.multiply(p)),g.makeTranslation(u,0,0),p.makeRotationY(b),D.applyMatrix4(g.multiply(p)),A=new t.PlaneGeometry(e-d,s-d,n,c),_(A,-x,j,w,M);let L=A.clone();g.makeTranslation(0,f,0),p.makeRotationX(-b),A.applyMatrix4(g.multiply(p)),g.makeTranslation(0,-f,0),p.makeRotationX(b),L.applyMatrix4(g.multiply(p));let O=a.mergeVertices(a.mergeGeometries([I,B,C,D,A,L]));N(O,"box"),this.copy(O)}},H=class extends t.BufferGeometry{constructor(e=1,a=8,i=6,s=0,r=2*Math.PI,n=0,o=Math.PI){super(),this.type="SphereGeometryFix",this.parameters={radius:e,widthSegments:a,heightSegments:i,phiStart:s,phiLength:r,thetaStart:n,thetaLength:o},a=Math.floor(a),i=Math.floor(i);const c=Math.min(n+o,Math.PI);let h=0;const l=[],b=new t.Vector3,d=new t.Vector3,u=[],f=[],m=[],p=[];for(let t=0;t<=i;t++){const u=[],g=t/i;let y=0;0==t&&0==n?y=.5/a:t==i&&c==Math.PI&&(y=-.5/a);for(let t=0;t<=a;t++){const i=t/a;b.x=-e*Math.cos(s+i*r)*Math.sin(n+g*o),b.y=e*Math.cos(n+g*o),b.z=e*Math.sin(s+i*r)*Math.sin(n+g*o),f.push(b.x,b.y,b.z),d.copy(b).normalize(),m.push(d.x,d.y,d.z),p.push(i+y,1-g),u.push(h++)}l.push(u)}for(let e=0;e<i;e++)for(let t=0;t<a;t++){const a=l[e][t+1],s=l[e][t],r=l[e+1][t],o=l[e+1][t+1];(0!==e||n>0)&&u.push(a,s,o),(e!==i-1||c<Math.PI)&&u.push(s,r,o)}this.setIndex(u),this.setAttribute("position",new t.Float32BufferAttribute(f,3)),this.setAttribute("normal",new t.Float32BufferAttribute(m,3)),this.setAttribute("uv",new t.Float32BufferAttribute(p,2))}};function _(e,t=0,a=0,i=1,s=1,r){let n=e.attributes.uv,o=n.array,c=n.count,h=0;for(;c--;)h=2*c,o[h]=o[h]*i-t,o[h+1]=o[h+1]*s+a,r&&(o[h]=1-o[h],o[h+1]=1-o[h+1])}function N(e,a="sphere",i,s=[0,0,0],r=[0,0,0,1],n){if(void 0===n&&(n=new t.Matrix4),n.compose({x:s[0],y:s[1],z:s[2]},{_x:r[0],_y:r[1],_z:r[2],_w:r[3]},{x:1,y:1,z:1}),void 0===i){e.boundingBox||e.computeBoundingBox();let t=e.boundingBox;i=Math.max(t.max.x-t.min.x,t.max.y-t.min.y,t.max.z-t.min.z)}let o=new t.Box3(new t.Vector3(-i/2,-i/2,-i/2),new t.Vector3(i/2,i/2,i/2)),c=[];c.length=2*e.attributes.position.count,void 0===e.attributes.uv&&e.setAttribute("uv",new t.Float32BufferAttribute(c,2));let h,l,b,d,u,f=function(e,a,i){e.applyMatrix4(n),a.applyMatrix4(n),i.applyMatrix4(n);let s=1/(2*Math.PI),r=1/Math.PI;return e.normalize(),a.normalize(),i.normalize(),{uv0:new t.Vector2(.5-Math.atan(e.z,-e.x)*s,.5-Math.asin(e.y)*r),uv1:new t.Vector2(.5-Math.atan(a.z,-a.x)*s,.5-Math.asin(a.y)*r),uv2:new t.Vector2(.5-Math.atan(i.z,-i.x)*s,.5-Math.asin(i.y)*r)}},m=function(e,a,s){e.applyMatrix4(n),a.applyMatrix4(n),s.applyMatrix4(n);let r=new t.Vector3;r.crossVectors(a.clone().sub(e),a.clone().sub(s)).normalize(),r.x<0||r.y<0||r.z,r.x=Math.abs(r.x),r.y=Math.abs(r.y),r.z=Math.abs(r.z);let c=new t.Vector2,h=new t.Vector2,l=new t.Vector2,b=1/i;return r.y>r.x&&r.y>r.z?(c.set(e.x-o.min.x,o.max.z-e.z).multiplyScalar(b),h.set(a.x-o.min.x,o.max.z-a.z).multiplyScalar(b),l.set(s.x-o.min.x,o.max.z-s.z).multiplyScalar(b)):r.x>r.y&&r.x>r.z?(c.set(e.z-o.min.z,e.y-o.min.y).multiplyScalar(b),h.set(a.z-o.min.z,a.y-o.min.y).multiplyScalar(b),l.set(s.z-o.min.z,s.y-o.min.y).multiplyScalar(b)):r.z>r.y&&r.z>r.x&&(c.set(e.x-o.min.x,e.y-o.min.y).multiplyScalar(b),h.set(a.x-o.min.x,a.y-o.min.y).multiplyScalar(b),l.set(s.x-o.min.x,s.y-o.min.y).multiplyScalar(b)),{uv0:c,uv1:h,uv2:l}},p=new t.Vector3,g=new t.Vector3,y=new t.Vector3;new t.Vector3,new t.Vector3,new t.Vector3;const x=e.getAttribute("position");if(e.getAttribute("normal"),e.index)for(h=0;h<e.index.count;h+=3)l=e.index.getX(h+0),b=e.index.getX(h+1),d=e.index.getX(h+2),p.fromBufferAttribute(x,l),g.fromBufferAttribute(x,b),y.fromBufferAttribute(x,d),u="sphere"===a?f(p,g,y):m(p,g,y),c[2*l]=u.uv0.x,c[2*l+1]=u.uv0.y,c[2*b]=u.uv1.x,c[2*b+1]=u.uv1.y,c[2*d]=u.uv2.x,c[2*d+1]=u.uv2.y;else for(h=0;h<x.count;h+=3){p.fromBufferAttribute(x,h+0),g.fromBufferAttribute(x,h+1),y.fromBufferAttribute(x,h+2),u="sphere"===a?f(p,g,y):m(p,g,y);let e=h,t=h+1,i=h+2;c[2*e]=u.uv0.x,c[2*e+1]=u.uv0.y,c[2*t]=u.uv1.x,c[2*t+1]=u.uv1.y,c[2*i]=u.uv2.x,c[2*i+1]=u.uv2.y}e.attributes.uv.array=new Float32Array(c),e.attributes.uv.needsUpdate=!0}let U=class{constructor(){this.geoN=0,this.geo={}}unic(e){this.geo["geo"+this.geoN++]=e}set(e){this.geo[e.name]=e}get(e,a={}){if(!this.geo[e]){let a;switch(e){case"plane":a=new t.PlaneGeometry(1,1),a.rotateX(.5*-Math.PI);break;case"box":a=new t.BoxGeometry(1,1,1);break;case"sphere":a=new t.SphereGeometry(1,16,12);break;case"highSphere":a=new L(1);break;case"cylinder":a=new t.CylinderGeometry(1,1,1,16);break;case"cone":a=new t.CylinderGeometry(.001,1,1,16);break;case"particle":a=new t.SphereGeometry(1,6,4);break;case"joint":a=(new D).geometry;break;default:return null}this.geo[e]=a}return this.geo[e]}dispose(){for(let e in this.geo)this.geo[e].isBufferGeometry?this.geo[e].dispose():console.log(this.geo[e]);this.geo={},this.geoN=0}};class K{constructor(e,a="rgb(69,69,69)",i="rgb(39,39,39)"){const s=document.createElement("canvas");s.width=s.height=128;const r=s.getContext("2d");if(r.fillStyle=a,r.fillRect(0,0,128,128),e){let t,s,n,o,c=[[0,0],[32,32],[64,64],[96,96],[96,-32]],h=[[0,64],[32,96],[64,128],[96,160],[-32,32]],l=e?"rgb(128,128,255)":a,b=e?"rgb(160,100,255)":i,d=e?"rgba(100,160,255, 0.5)":"rgba(0,0,0, 0.1)";for(r.strokeStyle=d,r.lineWidth=1,t=0;t<5;t++){o=r.createLinearGradient(0,h[t][0],0,h[t][1]),o.addColorStop(0,b),o.addColorStop(1,l),r.beginPath(),r.fillStyle=o,r.rect(c[t][0],c[t][1],32,64),r.fill();for(let e=0;e<8;e++)n=2*(Math.random()-.5),r.beginPath(),r.moveTo(c[t][0]+n+2+4*e,c[t][1]),r.lineTo(c[t][0]+n+2+4*e,c[t][1]+64),r.stroke()}for(c=[[32,0],[64,32],[96,64],[-32,64],[0,96]],h=[[32,96],[64,128],[96,160],[-32,32],[0,64]],t=0;t<5;t++)for(o=r.createLinearGradient(h[t][0],0,h[t][1],0),o.addColorStop(0,l),o.addColorStop(1,b),r.beginPath(),r.fillStyle=o,r.rect(c[t][0],c[t][1],64,32),r.fill(),s=0;s<8;s++)n=2*(Math.random()-.5),r.beginPath(),r.moveTo(c[t][0],c[t][1]+n+2+4*s),r.lineTo(c[t][0]+64,c[t][1]+n+2+4*s),r.stroke()}else r.beginPath(),r.fillStyle=i,r.rect(0,0,32,64),r.rect(32,32,32,64),r.rect(64,64,32,64),r.rect(96,96,32,64),r.rect(96,-32,32,64),r.fill();const n=new t.CanvasTexture(s);return n.wrapS=n.wrapT=t.RepeatWrapping,n.repeat.x=n.repeat.y=60,e||(n.colorSpace=t.SRGBColorSpace),n}}class J extends t.MeshPhysicalMaterial{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:"",SUBSURFACE:"",USE_UV:""},this.extra={},this.addParametre("sssMap",null),this.addParametre("sssColor",new t.Color(0,0,0)),this.addParametre("sssAmbient",.5),this.addParametre("sssDistortion",.6),this.addParametre("sssAttenuation",.1),this.addParametre("sssPower",1),this.addParametre("sssScale",6),this.setValues(e);let a=this;a.onBeforeCompile=function(e){for(let t in a.extra)e.uniforms[t]={value:a.extra[t]};e.fragmentShader=e.fragmentShader.replace("#include <common>",W.common),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",a.replaceAll(X,"RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );",W.light)),a.userData.shader=e}}addParametre(e,t){this.extra[e]=t,Object.defineProperty(this,e,{get:()=>this.extra[e],set:t=>{this.extra[e]=t,this.userData.shader&&(this.userData.shader.uniforms[e].value=this.extra[e])}})}replaceAll(e,t,a){return e.split(t).join(a)}}const W={common:"\n\t#include <common>\n\tuniform sampler2D sssMap;\n\tuniform float sssPower;\n\tuniform float sssScale;\n\tuniform float sssDistortion;\n\tuniform float sssAmbient;\n\tuniform float sssAttenuation;\n\tuniform vec3 sssColor;\n\n\tvoid RE_Direct_Scattering(const in IncidentLight directLight, const in vec2 uv, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, inout ReflectedLight reflectedLight) {\n\t\tvec3 thickness = sssColor * texture2D(sssMap, uv).r;\n\t\tvec3 scatteringHalf = normalize(directLight.direction + (geometryNormal * sssDistortion));\n\t\tfloat scatteringDot = pow(saturate(dot(geometryViewDir, -scatteringHalf)), sssPower) * sssScale;\n\t\tvec3 scatteringIllu = (scatteringDot + sssAmbient) * thickness;\n\t\treflectedLight.directDiffuse += scatteringIllu * sssAttenuation * directLight.color;\n\t}\n\t",light:"\n\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t#if defined( SUBSURFACE ) && defined( USE_UV )\n\t\tRE_Direct_Scattering(directLight, vUv, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, reflectedLight);\n\t#endif\n\t"},X="\n\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n\n#ifdef USE_CLEARCOAT\n\n\tgeometryClearcoatNormal = clearcoatNormal;\n\n#endif\n\n#ifdef USE_IRIDESCENCE\n\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\n\tif ( material.iridescenceThickness == 0.0 ) {\n\n\t\tmaterial.iridescence = 0.0;\n\n\t} else {\n\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\n\t}\n\n\tif ( material.iridescence > 0.0 ) {\n\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\n\t\t// Iridescence F0 approximation\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\n\t}\n\n#endif\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\n\t\t// spot lights are ordered [shadows with maps, shadows without maps, maps without shadows, none]\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 iblIrradiance = vec3( 0.0 );\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\t#if defined( USE_LIGHT_PROBES )\n\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\n\t#endif\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n\n#endif\n",Q={metalness:.1,roughness:.9},Y={grey:new t.Color(.18,.18,.18),black:new t.Color(.039,.039,.039),body:new t.Color(13289155),sleep:new t.Color("hsl(33, 15%, 54%)"),solid:new t.Color(7105128),base:new t.Color(13224135),brick:new t.Color(.262,.095,.061),sand:new t.Color(.44,.386,.231),gold:new t.Color(.944,.776,.373),gold2:new t.Color(.998,.981,.751),titanium:new t.Color(.633,.578,.503),titaniumSpec:new t.Color(.728,.68,.55),chrome:new t.Color(.653,.65,.615),chromeSpec:new t.Color(.675,.72,.711),copper:new t.Color(.988,.688,.448),carPaint:new t.Color(.1037792,.59212029,.85064936),clay:new t.Color("hsl(12, 30%, 40%)"),clayWhite:new t.Color(11119017),concrete:new t.Color(.51,.51,.51),Raw_Fire:new t.Color("hsl(40, 18%, 54%)"),Raw_Buff:new t.Color("hsl(33, 15%, 54%)"),Raw_Terracotta:new t.Color("hsl(12, 30%, 40%)"),Raw_Porcelain:new t.Color("hsl(45, 15%, 90%)")},Z={No:t.NoBlending,Normal:t.NormalBlending,Additive:t.AdditiveBlending,Subtractive:t.SubtractiveBlending,Multiply:t.MultiplyBlending,Eadd:t.AddEquation,Esub:t.SubtractEquation,Erev:t.ReverseSubtractEquation,Emin:t.MinEquation,Emaw:t.MaxEquation,Fzero:t.ZeroFactor,Fone:t.OneFactor,Fcolor:t.SrcColorFactor,Fcolorm:t.OneMinusSrcColorFactor,Falpha:t.SrcAlphaFactor,Falpham:t.OneMinusSrcAlphaFactor,Fdstalpha:t.DstAlphaFactor,Fdstalpham:t.OneMinusDstAlphaFactor,Fdstcolor:t.DstColorFactor,Fdstcolorm:t.OneMinusDstColorFactor,Falphasaturate:t.SrcAlphaSaturateFactor,Front:t.FrontSide,Back:t.BackSide,Double:t.DoubleSide};let $=class{constructor(){this.renderMode={value:0},this.depthPacking={value:0},this.extendMat=!1,this.isRealism=!1,this.realismOption={},this.envMapIntensity=1,this.mat={},this.TmpMat=[]}changeRenderMode(e){this.renderMode.value=e}initExtandShader(){}useRealLight(e){}setColor(e){}set(e,t,a=null){a||(a=e.onBeforeCompile),this.mat[e.name]=e}extendShader(e,t=null){}addToTmp(e){this.TmpMat.push(e)}create(e){let a,i=null;if(e.isMaterial)a=e;else{let s=void 0!==e.type?e.type:"Standard";switch(e.type&&delete e.type,i=e.beforeCompile||null,e.beforeCompile&&delete e.beforeCompile,(e.thickness||e.sheen||e.clearcoat||e.transmission||e.specularColor)&&(s="Physical"),e.normalScale&&(e.normalScale.isVector2||(e.normalScale=(new t.Vector2).fromArray(e.normalScale))),e.side&&(e.side=this.findValue(e.side)),e.shadowSide&&(e.shadowSide=this.findValue(e.shadowSide)),e.blending&&(e.blending=this.findValue(e.blending)),e.blendEquation&&(e.blendEquation=this.findValue(e.blendEquation)),e.blendEquationAlpha&&(e.blendEquationAlpha=this.findValue(e.blendEquationAlpha)),e.blendSrc&&(e.blendSrc=this.findValue(e.blendSrc)),e.blendDst&&(e.blendDst=this.findValue(e.blendDst)),e.blendDstAlpha&&(e.blendDstAlpha=this.findValue(e.blendDstAlpha)),e.blendSrcAlpha&&(e.blendSrcAlpha=this.findValue(e.blendSrcAlpha)),e.clearcoatNormalScale&&(e.clearcoatNormalScale.isVector2||(e.clearcoatNormalScale=(new t.Vector2).fromArray(e.clearcoatNormalScale))),s=s.toLowerCase(),s){case"physical":a=new t.MeshPhysicalMaterial(e);break;case"phong":a=new t.MeshPhongMaterial(e);break;case"lambert":a=new t.MeshLambertMaterial(e);break;case"basic":a=new t.MeshBasicMaterial(e);break;case"line":a=new t.LineBasicMaterial(e);break;case"toon":a=new t.MeshToonMaterial(e);break;case"shadow":a=new t.ShadowMaterial(e);break;case"sss":a=new J(e);break;default:a=new t.MeshStandardMaterial(e)}}return this.mat[a.name]?null:(this.set(a,!1,i),a)}findValue(e){return"string"===e?Z[e.charAt(0).toUpperCase()+e.slice(1)]:e}addToMat(e){if(this.isRealism)for(let t in e)e[t].onBeforeCompile=function(a){EnhanceLighting(a,this.realismOption),e[t].userData.isRealism=!0,e[t].userData.shader=a};this.mat={...this.mat,...e}}changeType(){}directIntensity(e){for(let e in this.mat);}getList(){let e={...this.mat};const t=["line","debug","hide","svg"];let a=t.length;for(;a--;)delete e[t[a]];return e}get(e){if(!this.mat[e])switch(e){case"grey":this.create({name:"grey",color:Y.grey,metalness:0,roughness:.5});break;case"black":this.create({name:"black",color:Y.black,metalness:0,roughness:.5});break;case"body":this.create({name:"body",color:Y.body,...Q});break;case"sleep":this.create({name:"sleep",color:Y.sleep,...Q});break;case"solid":this.create({name:"solid",color:Y.solid,...Q});break;case"base":this.create({name:"base",color:Y.base,...Q});break;case"clay":this.create({name:"clay",color:Y.clay,metalness:.1,roughness:.7});break;case"clayWhite":this.create({name:"clayWhite",color:Y.clayWhite,metalness:.1,roughness:.7});break;case"concrete":this.create({name:"concrete",color:Y.concrete,metalness:0,roughness:.9});break;case"brick":this.create({name:"brick",color:Y.brick,metalness:0,roughness:.6});break;case"sand":this.create({name:"sand",color:Y.sand,metalness:0,roughness:.9});break;case"chrome":this.create({name:"chrome",color:Y.chrome,specularColor:Y.chromeSpec,metalness:1,roughness:.075});break;case"silver":this.create({name:"silver",color:11184810,metalness:.8,roughness:.22});break;case"gold":this.create({name:"gold",color:Y.gold,specularColor:Y.gold2,metalness:1,roughness:.02});break;case"copper":this.create({name:"copper",color:Y.copper,metalness:1,roughness:.05});break;case"titanium":this.create({name:"titanium",color:Y.titanium,metalness:1,roughness:0,specularColor:Y.titaniumSpec});break;case"carPaint":this.create({name:"carPaint",color:Y.carPaint,metalness:0,anisotropy:new t.Vector2(.5,.5),roughness:.4,clearcoat:1,clearcoatRoughness:0});break;case"carbon":this.create({name:"carbon",map:new K,normalMap:new K(!0),clearcoat:1,clearcoatRoughness:.1,roughness:.5});break;case"cloth":this.create({name:"cloth",color:8391119,roughness:.5,sheenColor:13335807,sheen:1,sheenRoughness:.2});break;case"skinny":this.create({name:"skinny",color:14724201,...Q});break;case"glass":this.create({name:"glass",color:16777215,transparent:!0,roughness:.02,metalness:0,side:t.DoubleSide,alphaToCoverage:!0,premultipliedAlpha:!0,transmission:1,clearcoat:1,thickness:.01});break;case"glassX":this.create({name:"glassX",color:16777215,alphaToCoverage:!0,transparent:!0,opacity:1,roughness:0,metalness:0,side:t.DoubleSide,transmission:1,clearcoat:1,clearcoatRoughness:0,thickness:.05,ior:1.52,shadowSide:1,reflectivity:.5,iridescence:0,specularIntensity:1,specularColor:16777215});break;case"plexi":this.create({name:"plexi",blending:t.AdditiveBlending,color:65793,transparent:!0,opacity:.7,reflectivity:.3,metalness:.6,roughness:.1,clearcoat:.2,clearcoatRoughness:.02,side:t.DoubleSide,alphaToCoverage:!0,premultipliedAlpha:!0});break;case"plexi2":this.create({name:"plexi2",blending:t.AdditiveBlending,color:65793,transparent:!1,opacity:.7,reflectivity:.3,metalness:.6,roughness:.1,clearcoat:.2,clearcoatRoughness:.02,side:t.DoubleSide,alphaToCoverage:!1,premultipliedAlpha:!0});break;case"glass2":this.create({name:"glass2",color:15658734,transparent:!0,roughness:0,alphaToCoverage:!0,opacity:.3});break;case"glass3":this.create({name:"glass3",color:0,transparent:!0,roughness:0,alphaToCoverage:!0,opacity:.4});break;case"glass_red":this.create({name:"glass_red",color:16711680,transparent:!0,roughness:0,alphaToCoverage:!0,opacity:.8});break;case"car":this.create({name:"car",color:3158064,metalness:1,roughness:.5,clearcoat:1,clearcoatRoughness:.03,sheen:.5});break;case"carGlass":this.create({name:"carGlass",color:16777215,metalness:0,roughness:0,transmission:1,ior:1.52});break;case"outline":this.create({name:"outline",color:16777215,type:"Basic",side:t.BackSide,toneMapped:!1,wireframe:!0,transparent:!0,opacity:.25});break;case"debug":this.create({name:"debug",type:"Basic",color:15953986,wireframe:!0,toneMapped:!1,transparent:!0,opacity:.5});break;case"shadow":this.create({name:"shadow",type:"shadow",color:0,opacity:.5});break;case"bones":this.create({name:"bones",color:16639958,wireframe:!0});break;case"bones2":this.create({name:"bones2",type:"basic",color:14664872,transparent:!0,opacity:.5,depthTest:!0,depthWrite:!1,alphaToCoverage:!0});break;case"button":this.create({name:"button",color:16728139,...Q});break;case"line":this.create({name:"line",type:"line",vertexColors:!0,toneMapped:!1});break;case"liner":this.create({name:"liner",type:"line",vertexColors:!0,toneMapped:!1,depthTest:!0,depthWrite:!0,alphaToCoverage:!0});break;case"hide":this.create({name:"hide",type:"basic",visible:!1});break;case"particle":this.create({name:"particle",type:"basic",toneMapped:!1,color:16776960,transparent:!0,opacity:.2});break;case"svg":this.create({name:"svg",type:"basic",toneMapped:!1,vertexColors:!0,transparent:!1,side:t.DoubleSide})}return this.mat[e]}dispose(){this.isRealism=!1;for(let e in this.mat)this.mat[e].dispose(),delete this.mat[e];let e=this.TmpMat.length;for(;e--;)this.TmpMat[e].dispose();this.TmpMat=[]}upShader(){let e=this.realismOption;for(let t in this.mat){const a=this.mat[t],i=a.userData.shader;for(let t in e)i&&void 0!==i.uniforms[t]&&(i.uniforms[t].value=e[t]),a[t]&&(a[t]=e[t])}}};class ee{constructor(e=-1){this.perf=window.performance,this.time={now:0,delta:0,then:0,interval:0,tmp:0,n:0,dt:0},this.fps=0,this.delta=0,this.elapsedTime=0,this.unlimited=!1,this.setFramerate(e),this.force=!1}up(e){let t=this.time;return this.unlimited&&(this.force=!0),t.now=void 0!==e?e:this.now(),t.delta=t.now-t.then,this.force&&(t.delta=t.interval,this.force=!1),!!(t.delta>=t.interval||this.unlimited)&&(t.then=this.unlimited?t.now:t.now-t.delta%t.interval,this.delta=.001*t.interval,this.elapsedTime+=this.delta,!0)}setFramerate(e){this.elapsedTime=0,this.framerate=e,this.unlimited=this.framerate<0,this.time.interval=1e3/e,60===e&&(this.time.interval=16.67)}static now(){return this.perf?this.perf.now():Date.now()}static format_time(e){return e>1e3?e/1e3+" sec":e+" ms"}}class te{constructor(){this.key=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.key2=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.gamepad=new ae(this.key),this.useGamepad=!1,this.sameAxis=!0,document.addEventListener("keydown",function(e){this.keyDown(e)}.bind(this),!1),document.addEventListener("keyup",function(e){this.keyUp(e)}.bind(this),!1)}setKey(e,t){this.key[e]=t}update(){return this.gamepad.update(),this.gamepad.ready&&(this.useGamepad||(this.useGamepad=!0),this.gamepad.getValue(0)),this.sameAxis&&(this.key[2]=this.key[0],this.key[3]=this.key[1]),this.key}keyDown(e){var t=this.key,a=this.key2;if(e=e||window.event,this.sameAxis)switch(e.which){case 65:case 81:case 37:t[0]=-1,a[0]=1;break;case 68:case 39:t[0]=1,a[1]=1;break;case 87:case 90:case 38:t[1]=-1;break;case 83:case 40:t[1]=1;break;case 32:t[4]=1;break;case 17:case 67:t[5]=1;break;case 69:t[6]=1;break;case 16:t[7]=1}else switch(e.which){case 65:case 81:t[0]=-1,a[0]=1;break;case 68:t[0]=1,a[1]=1;break;case 87:case 90:t[1]=-1;break;case 83:t[1]=1;break;case 37:t[2]=-1,a[0]=1;break;case 39:t[2]=1,a[1]=1;break;case 38:t[3]=-1;break;case 40:t[3]=1;break;case 32:t[4]=1;break;case 17:case 67:t[5]=1;break;case 69:t[6]=1;break;case 16:t[7]=1}this.gamepad.reset()}keyUp(e){var t=this.key,a=this.key2;if(e=e||window.event,this.sameAxis)switch(e.which){case 65:case 81:case 37:t[0]=t[0]<0?0:t[0],a[0]=0;break;case 68:case 39:t[0]=t[0]>0?0:t[0],a[1]=0;break;case 87:case 90:case 38:t[1]=t[1]<0?0:t[1];break;case 83:case 40:t[1]=t[1]>0?0:t[1];break;case 32:t[4]=0;break;case 17:case 67:t[5]=0;break;case 69:t[6]=0;break;case 16:t[7]=0}else switch(e.which){case 65:case 81:t[0]=t[0]<0?0:t[0],a[0]=0;break;case 68:t[0]=t[0]>0?0:t[0],a[1]=0;break;case 87:case 90:t[1]=t[1]<0?0:t[1];break;case 83:t[1]=t[1]>0?0:t[1];break;case 37:t[2]=t[2]<0?0:t[2],a[0]=0;break;case 39:t[2]=t[2]>0?0:t[2],a[1]=0;break;case 38:t[3]=t[3]<0?0:t[3];break;case 40:t[3]=t[3]>0?0:t[3];break;case 32:t[4]=0;break;case 17:case 67:t[5]=0;break;case 69:t[6]=0;break;case 16:t[7]=0}}}class ae{constructor(e){this.values=[],this.ready=0,this.key=e}update(){var e,t,a,i,s,r,n=this.fix,o=navigator.getGamepads();for(e=0;e<o.length;e++)if(r=o[e])if(a=r.axes.length,i=r.buttons.length){for(this.values[e]||(this.values[e]=[]),t=0;t<a;t++)s=n(r.axes[t],.08),0==this.ready&&0!==s&&(this.ready=1),this.values[e][t]=s;for(t=0;t<i;t++)s=n(r.buttons[t].value),0==this.ready&&0!==s&&(this.ready=1),this.values[e][a+t]=s}else this.values[e]&&(this.values[e]=null)}getValue(e){for(var t,a=19;a--;)t=this.values[e][a],0==this.ready&&0!==t&&(this.ready=1),this.key[a]=t}reset(){this.ready=0}fix(e,t){let a=Number(e.toString().substring(0,5));return t&&a<t&&a>-t&&(a=0),a}}class ie{constructor(){this.id=0,this.list=[],this.type="item",this.Utils=null}reset(){let e=this.list.length;for(;e--;)this.dispose(this.list[e]);this.list=[],this.id=0}byName(e){return this.Utils.byName(e)}setName(e={}){let t=void 0!==e.name?e.name:this.type+this.id++;return e.id=this.remove(t,!0),e.name=t,t}addToWorld(e,t=-1){this.Utils.add(e),-1!==t?this.list[t]=e:this.list.push(e)}remove(e,t){let a=this.byName(e);return a?this.clear(a,t):-1}clear(e,t){let a=this.list.indexOf(e);return-1===a||t?this.list[a]=null:this.list.splice(a,1),this.dispose(e),a}dispose(e){null!==e&&this.Utils.remove(e)}add(e={}){}set(e={}){}step(e,t){}}class se extends ie{constructor(e){super(),this.motor=e,this.Utils=this.motor.utils,this.type="ray",this.iType="ray"}step(e,t){let a,i,s=this.list.length;for(;s--;)a=this.list[s],i=t+s*B.ray,a.update(e,i,this.motor.reflow.ray[s]||null)}add(e={}){this.setName(e);let t=new re(e,this.motor);return t.visible=void 0===e.visible||e.visible,this.addToWorld(t,e.id),e.parent&&"string"!=typeof e.parent&&(e.parent=e.parent.name),e.callback&&delete e.callback,this.motor.post({m:"add",o:e}),t}set(e={},t=null){null===t&&(t=this.byName(e.name)),null!==t&&t.setRay(e)}}class re extends t.Line{constructor(e={},a){super(new t.BufferGeometry,a.getMat("line")),this.motor=a,this.Utils=this.motor.utils,this.isRay=!0,this.data={hit:!1,body:"",point:[0,0,0],normal:[0,0,0],distance:0,angle:0,parent:null},this.type="ray",this.name=e.name,this.parentMesh=null,e.parent&&(this.parentMesh="string"==typeof e.parent?this.Utils.byName(e.parent):e.parent,this.data.parent=this.parentMesh),this.callback=e.callback||null,this.c0=[.1,.1,.3],this.c1=[.1,.4,.6],this.c2=[1,.1,.1],this.c3=[.1,1,.1],this.begin=new t.Vector3,this.end=new t.Vector3(0,1,0),this.tmp=new t.Vector3,this.vnormal=new t.Vector3,this.vv1=new t.Vector3,this.vv2=new t.Vector3,this.fullDistance=0,this.setRay(e);this.geometry.setAttribute("position",new t.Float32BufferAttribute([0,0,0,0,0,0,0,0,0],3)),this.geometry.setAttribute("color",new t.Float32BufferAttribute([0,0,0,0,0,0,0,0,0],3)),this.vertices=this.geometry.attributes.position,this.colors=this.geometry.attributes.color,this.local=[0,0,0,0,0,0,0,0,0],this.noRotation=e.noRotation||!1,this.fakeMatrix=new t.Matrix4,this.matrixAutoUpdate=!1,this.frustumCulled=!1}setRay(e){e.begin&&this.begin.fromArray(e.begin),e.end&&this.end.fromArray(e.end),this.fullDistance=this.begin.distanceTo(this.end)}update(e,t=0,a=null){if(this.data.hit=0!==e[t],this.data.body=a||"",this.data.distance=e[t+1],this.data.hit)this.local[0]=e[t+2],this.local[1]=e[t+3],this.local[2]=e[t+4],this.tmp.fromArray(e,t+5),this.vnormal.fromArray(e,t+8),this.data.point=this.tmp.toArray(),this.data.normal=this.vnormal.toArray(),this.tmp.toArray(this.local,3),this.vv1.fromArray(this.local).sub(this.tmp).normalize(),this.tmp.addScaledVector(this.vnormal,this.fullDistance-this.data.distance),this.tmp.toArray(this.local,6),this.data.angle=Math.floor(A.angleTo(this.vv1.toArray(),this.data.normal)*v);else if(this.parentMesh){let e;e=this.noRotation?this.fakeMatrix.setPosition(this.parentMesh.position.x,this.parentMesh.position.y,this.parentMesh.position.z):this.parentMesh.matrixWorld,this.tmp.copy(this.begin).applyMatrix4(e).toArray(this.local,0),this.tmp.copy(this.end).applyMatrix4(e),this.tmp.toArray(this.local,3),this.tmp.toArray(this.local,6)}else this.begin.toArray(this.local,0),this.end.toArray(this.local,3),this.end.toArray(this.local,6);this.updateGeometry(),this.updateMatrix(),this.callback&&this.callback(this.data)}dispose(){this.callback=null,this.parentMesh=null,this.data={},this.geometry.dispose()}raycast(){}updateGeometry(){if(!this.visible)return;let e=this.vertices.array,t=this.colors.array,a=this.local,i=this.data.hit,s=i?this.c2:this.c1,r=i?this.c3:this.c1;t[3]=s[0],t[4]=s[1],t[5]=s[2],t[6]=r[0],t[7]=r[1],t[8]=r[2],e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[8]=a[8],this.vertices.needsUpdate=!0,this.colors.needsUpdate=!0}}class ne extends t.InstancedMesh{constructor(e,a,i=0){super(e,a,i),this.matrixAutoUpdate=!1,this.tmpMatrix=new t.Matrix4,this.tmpQuat=new t.Quaternion,this.instanceUv=null,this.instanceColor=null,this.needSphereUp=!1,this.isRay=!0,this.overMaterial=null,this.currentOver=-1,this.isOver=!1,this.outline=null,this.tmpElement=[]}clearOutLine(){this.overMaterial&&this.outline&&(this.parent.remove(this.outline),this.outline=null,this.currentOver=-1)}addOutLine(e){this.overMaterial&&(this.outline||(this.outline=new t.Mesh(this.geometry,this.overMaterial)),this.outline.matrixAutoUpdate=!1,this.tmpMatrix.fromArray(this.instanceMatrix.array,16*e.idx),this.outline.matrix.copy(this.tmpMatrix),this.outline.matrixWorldNeedsUpdate=!0,this.parent.add(this.outline),this.currentOver=e.idx)}over(e){e&&!this.instance.isOver&&(this.instance.isOver=!0,this.instance.addOutLine(this)),!e&&this.instance.isOver&&(this.instance.isOver=!1,this.instance.clearOutLine())}setColorAt(e,a){null===this.instanceColor&&(this.instanceColor=new t.InstancedBufferAttribute(new Float32Array(3*this.instanceMatrix.count),3)),a.isColor&&(a=a.toArray());let i=3*e;this.instanceColor.array[i]=a[0],this.instanceColor.array[i+1]=a[1],this.instanceColor.array[i+2]=a[2]}add(e,a=[0,0,0],i=[0,0,0,1],s=[1,1,1],r=null,n=null){3===i.length&&(i=this.tmpQuat.setFromEuler({_x:i[0],_y:i[1],_z:i[2],_order:"XYZ"},!1).toArray()),r&&(r.isColor&&(r=r.toArray()),null===this.instanceColor&&(this.instanceColor=new t.InstancedBufferAttribute(new Float32Array(3*this.instanceMatrix.count),3))),this.expand(a,i,s,r,n),this.tmpElement.push(e)}slice(e,t,a){let i=new Float32Array(a-t);for(let s=0;s<t+a;++s)i[s]=e[t+s];return i}remove(e){if(!this.count)return;this.tmpElement.splice(e,1);let a=[...this.instanceMatrix.array];a.splice(16*e,16),this.instanceMatrix=new t.InstancedBufferAttribute(new Float32Array(a),16),null!==this.instanceColor&&(a=[...this.instanceColor.array],a.splice(3*e,3),this.instanceColor=new t.InstancedBufferAttribute(new Float32Array(a),3)),null!==this.instanceUv&&(a=[...this.instanceUv.array],a.splice(2*e,2),this.instanceUv=new t.InstancedBufferAttribute(new Float32Array(a),2)),this.count--,this.reDistribute()}reDistribute(){let e=this.count;for(;e--;)this.tmpElement[e].idx=e}getIDName(e){return this.tmpElement[e].name}getBodyList(){let e=[],t=this.count;for(;t--;)e.push(this.tmpElement[t].name);return e}expand(e,a,i,s=[1,1,1],r){let n=null!==this.instanceMatrix?this.instanceMatrix.array:[];this.tmpMatrix.compose({x:e[0],y:e[1],z:e[2]},{_x:a[0],_y:a[1],_z:a[2],_w:a[3]},{x:i[0],y:i[1],z:i[2]}),this.instanceMatrix=new t.InstancedBufferAttribute(new Float32Array([...n,...this.tmpMatrix.toArray()]),16),null!==this.instanceColor&&(n=this.instanceColor.array,this.instanceColor=new t.InstancedBufferAttribute(new Float32Array([...n,...s]),3)),this.count++}setTransformAt(e,t,a,i){this.tmpMatrix.compose({x:t[0],y:t[1],z:t[2]},{_x:a[0],_y:a[1],_z:a[2],_w:a[3]},{x:i[0],y:i[1],z:i[2]}),this.tmpMatrix.toArray(this.instanceMatrix.array,16*e),this.needSphereUp=!0,this.outline&&this.currentOver===e&&(this.outline.matrix.copy(this.tmpMatrix),this.outline.matrixWorldNeedsUpdate=!0)}dispose(){this.clearOutLine(),this.parent.remove(this),this.geometry.dispose(),this.instanceColor=null,this.count=0,this.tmpElement=[],this.dispatchEvent({type:"dispose"})}setRaycast(e){void 0!==e&&(this.isRay=e)}raycast(e,t){this.isRay&&(this.instanceMatrix.needsUpdate=!0,super.raycast(e,t))}update(){this.instanceMatrix&&(this.instanceMatrix.needsUpdate=!0),this.instanceColor&&(this.instanceColor.needsUpdate=!0),this.needSphereUp&&this.computeBoundingSphere(),this.needSphereUp=!1,this.updateMatrix()}}class oe{constructor(e=0,t=0,a=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=a,this._w=i}set(e,t,a,i){return this._x=e,this._y=t,this._z=a,this._w=i,this}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}}class ce extends t.Object3D{constructor(e,a,i,s,r=[0,1,0],n=[0,.5,0],o=!1){if(super(),!e)return;if(!a)return;const c=new t.BufferGeometry;let h=.5*a-e,l=12,b=.2*e,d=[];const u=[e,h,0,e,-h,0,-e,h,0,-e,-h,0,0,h,e-b,0,h,e+b];d.push(...r,...n,...r,...n,...n,...n),o&&(u.push(0,h,e,0,-h,e,0,h,-e,0,-h,-e),d.push(...r,...n,...r,...n));for(let t=0,a=1;t<l;t++,a++){const i=t/l*Math.PI*2,s=a/l*Math.PI*2;u.push(e*Math.cos(i),h,e*Math.sin(i),e*Math.cos(s),h,e*Math.sin(s),e*Math.cos(i),-h,e*Math.sin(i),e*Math.cos(s),-h,e*Math.sin(s)),d.push(...r,...r,...n,...n)}for(let t=0,a=1;t<l;t++,a++){const i=t/l*Math.PI*2,s=a/l*Math.PI*2;let c=a<=6?1:-1;u.push(e*Math.cos(i),h*c+e*Math.sin(i),0,e*Math.cos(s),h*c+e*Math.sin(s),0),1===c?d.push(...r,...r):d.push(...n,...n),o&&(u.push(0,h*c+e*Math.sin(i),e*Math.cos(i),0,h*c+e*Math.sin(s),e*Math.cos(s)),1===c?d.push(...r,...r):d.push(...n,...n))}if(c.setAttribute("position",new t.Float32BufferAttribute(u,3)),c.setAttribute("color",new t.Float32BufferAttribute(d,3)),c.computeBoundingSphere(),this.colors=c.attributes.color.array,this.colorsbase=[...this.colors],this.geometry=c,this.cone=new t.LineSegments(c,s),this.cone.raycast=function(){return!1},this.cone.updateMorphTargets=()=>{},this.cone.name="cone",this.add(this.cone),this.isOver=!1,this.matrixAutoUpdate=!1,this.type="CapsuleHelper",!i)return;const f=new t.BufferGeometry,m=[.5*b,-h,e-b,.5*b,-h,e+b,.5*-b,-h,e-b,.5*-b,-h,e+b,.5*b,-h,e-b,.5*-b,-h,e-b,.5*-b,-h,e+b,-b,-h,e+b,.5*b,-h,e+b,b,-h,e+b,-b,-h,e+b,0,-h,e+2*b,b,-h,e+b,0,-h,e+2*b];d=[];let p=m.length/3;for(;p--;)d.push(1,0,0);f.setAttribute("position",new t.Float32BufferAttribute(m,3)),f.setAttribute("color",new t.Float32BufferAttribute(d,3)),this.direction=new t.LineSegments(f,s),this.direction.raycast=function(){return!1},this.add(this.direction)}over(e){e?this.isOver||(this.isOver=!0,this.changeColor(this.isOver)):this.isOver&&(this.isOver=!1,this.changeColor(this.isOver))}changeColor(e){let t=this.colors.length;for(;t--;)this.colors[t]=e?1:this.colorsbase[t];this.geometry&&(this.geometry.attributes.color.needsUpdate=!0)}setDirection(e){this.direction&&(this.direction.rotation.y=e)}dispose(){this.geometry.dispose(),this.cone.geometry.dispose(),this.direction&&this.direction.geometry.dispose()}raycast(){return!1}update(){}}const he=new t.Vector3,le=new t.Line3,be=new t.Plane,de=new t.Vector3,ue=new t.Triangle;class fe{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new ye,this.unassigned=new ye,this.vertices=[]}setFromPoints(e){if(e.length>=4){this.makeEmpty();for(let t=0,a=e.length;t<a;t++)this.vertices.push(new ge(e[t]));this._compute()}return this}setFromObject(e){const a=[];return e.updateMatrixWorld(!0),e.traverse((function(e){const i=e.geometry;if(void 0!==i){const s=i.attributes.position;if(void 0!==s)for(let i=0,r=s.count;i<r;i++){const r=new t.Vector3;r.fromBufferAttribute(s,i).applyMatrix4(e.matrixWorld),a.push(r)}}})),this.setFromPoints(a)}containsPoint(e){const t=this.faces;for(let a=0,i=t.length;a<i;a++){if(t[a].distanceToPoint(e)>this.tolerance)return!1}return!0}intersectRay(e,t){const a=this.faces;let i=-1/0,s=1/0;for(let t=0,r=a.length;t<r;t++){const r=a[t],n=r.distanceToPoint(e.origin),o=r.normal.dot(e.direction);if(n>0&&o>=0)return null;const c=0!==o?-n/o:0;if(!(c<=0)&&(o>0?s=Math.min(c,s):i=Math.max(c,i),i>s))return null}return i!==-1/0?e.at(i,t):e.at(s,t),t}intersectsRay(e){return null!==this.intersectRay(e,he)}makeEmpty(){return this.faces=[],this.vertices=[],this}_addVertexToFace(e,t){return e.face=t,null===t.outside?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}_removeVertexFromFace(e,t){return e===t.outside&&(null!==e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}_removeAllVerticesFromFace(e){if(null!==e.outside){const t=e.outside;let a=e.outside;for(;null!==a.next&&a.next.face===e;)a=a.next;return this.assigned.removeSubList(t,a),t.prev=a.next=null,e.outside=null,t}}_deleteFaceVertices(e,t){const a=this._removeAllVerticesFromFace(e);if(void 0!==a)if(void 0===t)this.unassigned.appendChain(a);else{let e=a;do{const a=e.next;t.distanceToPoint(e.point)>this.tolerance?this._addVertexToFace(e,t):this.unassigned.append(e),e=a}while(null!==e)}return this}_resolveUnassignedPoints(e){if(!1===this.unassigned.isEmpty()){let t=this.unassigned.first();do{const a=t.next;let i=this.tolerance,s=null;for(let a=0;a<e.length;a++){const r=e[a];if(0===r.mark){const e=r.distanceToPoint(t.point);if(e>i&&(i=e,s=r),i>1e3*this.tolerance)break}}null!==s&&this._addVertexToFace(t,s),t=a}while(null!==t)}return this}_computeExtremes(){const e=new t.Vector3,a=new t.Vector3,i=[],s=[];for(let e=0;e<3;e++)i[e]=s[e]=this.vertices[0];e.copy(this.vertices[0].point),a.copy(this.vertices[0].point);for(let t=0,r=this.vertices.length;t<r;t++){const r=this.vertices[t],n=r.point;for(let t=0;t<3;t++)n.getComponent(t)<e.getComponent(t)&&(e.setComponent(t,n.getComponent(t)),i[t]=r);for(let e=0;e<3;e++)n.getComponent(e)>a.getComponent(e)&&(a.setComponent(e,n.getComponent(e)),s[e]=r)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(a.x))+Math.max(Math.abs(e.y),Math.abs(a.y))+Math.max(Math.abs(e.z),Math.abs(a.z))),{min:i,max:s}}_computeInitialHull(){const e=this.vertices,t=this._computeExtremes(),a=t.min,i=t.max;let s=0,r=0;for(let e=0;e<3;e++){const t=i[e].point.getComponent(e)-a[e].point.getComponent(e);t>s&&(s=t,r=e)}const n=a[r],o=i[r];let c,h;s=0,le.set(n.point,o.point);for(let t=0,a=this.vertices.length;t<a;t++){const a=e[t];if(a!==n&&a!==o){le.closestPointToPoint(a.point,!0,de);const e=de.distanceToSquared(a.point);e>s&&(s=e,c=a)}}s=-1,be.setFromCoplanarPoints(n.point,o.point,c.point);for(let t=0,a=this.vertices.length;t<a;t++){const a=e[t];if(a!==n&&a!==o&&a!==c){const e=Math.abs(be.distanceToPoint(a.point));e>s&&(s=e,h=a)}}const l=[];if(be.distanceToPoint(h.point)<0){l.push(me.create(n,o,c),me.create(h,o,n),me.create(h,c,o),me.create(h,n,c));for(let e=0;e<3;e++){const t=(e+1)%3;l[e+1].getEdge(2).setTwin(l[0].getEdge(t)),l[e+1].getEdge(1).setTwin(l[t+1].getEdge(0))}}else{l.push(me.create(n,c,o),me.create(h,n,o),me.create(h,o,c),me.create(h,c,n));for(let e=0;e<3;e++){const t=(e+1)%3;l[e+1].getEdge(2).setTwin(l[0].getEdge((3-e)%3)),l[e+1].getEdge(0).setTwin(l[t+1].getEdge(1))}}for(let e=0;e<4;e++)this.faces.push(l[e]);for(let t=0,a=e.length;t<a;t++){const a=e[t];if(a!==n&&a!==o&&a!==c&&a!==h){s=this.tolerance;let e=null;for(let t=0;t<4;t++){const i=this.faces[t].distanceToPoint(a.point);i>s&&(s=i,e=this.faces[t])}null!==e&&this._addVertexToFace(a,e)}}return this}_reindexFaces(){const e=[];for(let t=0;t<this.faces.length;t++){const a=this.faces[t];0===a.mark&&e.push(a)}return this.faces=e,this}_nextVertexToAdd(){if(!1===this.assigned.isEmpty()){let e,t=0;const a=this.assigned.first().face;let i=a.outside;do{const s=a.distanceToPoint(i.point);s>t&&(t=s,e=i),i=i.next}while(null!==i&&i.face===a);return e}}_computeHorizon(e,t,a,i){let s;this._deleteFaceVertices(a),a.mark=1,s=null===t?t=a.getEdge(0):t.next;do{const t=s.twin,a=t.face;0===a.mark&&(a.distanceToPoint(e)>this.tolerance?this._computeHorizon(e,t,a,i):i.push(s)),s=s.next}while(s!==t);return this}_addAdjoiningFace(e,t){const a=me.create(e,t.tail(),t.head());return this.faces.push(a),a.getEdge(-1).setTwin(t.twin),a.getEdge(0)}_addNewFaces(e,t){this.newFaces=[];let a=null,i=null;for(let s=0;s<t.length;s++){const r=t[s],n=this._addAdjoiningFace(e,r);null===a?a=n:n.next.setTwin(i),this.newFaces.push(n.face),i=n}return a.next.setTwin(i),this}_addVertexToHull(e){const t=[];return this.unassigned.clear(),this._removeVertexFromFace(e,e.face),this._computeHorizon(e.point,null,e.face,t),this._addNewFaces(e,t),this._resolveUnassignedPoints(this.newFaces),this}_cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}_compute(){let e;for(this._computeInitialHull();void 0!==(e=this._nextVertexToAdd());)this._addVertexToHull(e);return this._reindexFaces(),this._cleanup(),this}}class me{constructor(){this.normal=new t.Vector3,this.midpoint=new t.Vector3,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}static create(e,t,a){const i=new me,s=new pe(e,i),r=new pe(t,i),n=new pe(a,i);return s.next=n.prev=r,r.next=s.prev=n,n.next=r.prev=s,i.edge=s,i.compute()}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t}compute(){const e=this.edge.tail(),t=this.edge.head(),a=this.edge.next.head();return ue.set(e.point,t.point,a.point),ue.getNormal(this.normal),ue.getMidpoint(this.midpoint),this.area=ue.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}}class pe{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const e=this.head(),t=this.tail();return null!==t?t.point.distanceTo(e.point):-1}lengthSquared(){const e=this.head(),t=this.tail();return null!==t?t.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}}class ge{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}}class ye{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,null===t.prev?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,null===t.next?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;null!==e.next;)e=e.next;return this.tail=e,this}remove(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return null===e.prev?this.head=t.next:e.prev.next=t.next,null===t.next?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return null===this.head}}class xe extends t.BufferGeometry{constructor(e=[]){super();const a=[],i=[],s=(new fe).setFromPoints(e).faces;for(let e=0;e<s.length;e++){const t=s[e];let r=t.edge;do{const e=r.head().point;a.push(e.x,e.y,e.z),i.push(t.normal.x,t.normal.y,t.normal.z),r=r.next}while(r!==t.edge)}this.setAttribute("position",new t.Float32BufferAttribute(a,3)),this.setAttribute("normal",new t.Float32BufferAttribute(i,3))}}let we=null,ve=null;const ke=new t.Vector3(0,1,0),je=new t.Vector3(1,0,0),Me=new t.Vector3(0,0,1);class Ae extends ie{constructor(e){super(),this.motor=e,this.engine=this.motor.engine,this.Utils=this.motor.utils,we=this.motor.geo,ve=this.motor.mat,this.type="body",this.num=B[this.type],this.full=!1,this.needMatrix="RAPIER"===this.engine||"HAVOK"===this.engine}setFull(e){this.num=B[e?"bodyFull":"body"],this.full=e}step(e,t){const a=this.list;let i,s,r,n=a.length;for(;n--;)if(i=a[n],null!==i)if(s=t+n*this.num,i.actif){if(i.sleep=!(e[s]>0),i.defMat&&(i.isInstance?i.instance.setColorAt(i.idx,i.sleep?Y.sleep:Y.body):(i.sleep||"sleep"!==i.material.name||(i.material=ve.get("body")),i.sleep&&"body"===i.material.name&&(i.material=ve.get("sleep")))),!i.sleep||i.isKinematic)if(i.position.fromArray(e,s+1),i.quaternion.fromArray(e,s+4),1!==this.motor.ws&&i.position.multiplyScalar(this.motor.uws),this.full?(i.velocity.fromArray(e,s+8),i.angular.fromArray(e,s+11)):i.getVelocity&&(r=this.motor.reflow.velocity[i.name],r&&(i.velocity.fromArray(r,0),i.angular.fromArray(r,3))),i.isInstance){if(i.speedMat){let t=.01*e[s];i.instance.setColorAt(i.idx,[t,t,t])}i.instance.setTransformAt(i.idx,i.position.toArray(),i.quaternion.toArray(),i.noScale?[1,1,1]:i.size),this.needMatrix&&i.matrixWorld.compose(i.position,i.quaternion,{x:1,y:1,z:1})}else i.auto||i.updateMatrix()}else i.actif=!0}geometry(e={},a=null,i=null){let s,r,n,o=e.size,c="",h=e.type,l=!1,b=!1,d=e.seg||16;const u="OIMO"===this.engine||"JOLT"===this.engine||"AMMO"===this.engine||"CANNON"===this.engine;if(e.instance&&"compound"===h&&(h=e.shapes[0].type,o=e.shapes[0].size,e.translate=e.shapes[0].pos),"mesh"!==h&&"convex"!==h||(e.shape?e.shape.isMesh&&(e.shape=e.shape.geometry):e.mesh&&!e.v&&(e.shape=e.mesh.geometry)),e.radius&&("box"===h&&(h="ChamferBox"),"cylinder"===h&&(h="ChamferCyl")),e.geometry&&("convex"===h?e.shape=e.geometry:h="direct"),"PHYSX"===this.engine&&"cylinder"===e.type){let a=new t.CylinderGeometry(e.size[0],e.size[0],e.size[1],d,1);e.isWheel&&a.rotateZ(-j),e.v=A.getVertex(a),e.type="convex"}if(("PHYSX"===this.engine||"HAVOK"===this.engine||"JOLT"===this.engine)&&"cone"===e.type){let a=new t.CylinderGeometry(0,e.size[0],e.size[1],d,1);e.v=A.getVertex(a),e.type="convex"}switch("stair"===e.type&&(e.type="box",h="box"),h){case"direct":s=e.geometry.clone(),e.size&&s.scale(e.size[0],e.size[1],e.size[2]),b=!0,l=!0;break;case"convex":if(e.v){if(e.nogeo)s=new t.BufferGeometry;else{let a=[];for(r=Math.floor(e.v.length/3);r--;)n=3*r,a.push(new t.Vector3(e.v[n],e.v[n+1],e.v[n+2]));s=new xe(a)}b=!0,l=!0}if(e.shape){s=e.shape.clone(),e.size&&s.scale(e.size[0],e.size[0],e.size[0]),e.shapeScale&&s.scale(e.shapeScale[0],e.shapeScale[1],e.shapeScale[2]);let t=u?A.toNonIndexed(s):null;e.v=A.getVertex(t||s,u),e.index=A.getIndex(t||s,u),this.engine,b=!0,l=!0}s.boundingBox||s.computeBoundingBox();let a=s.boundingBox;e.boxSize=[-a.min.x+a.max.x,-a.min.y+a.max.y,-a.min.z+a.max.z];break;case"mesh":if(s=e.shape.clone(),e.size&&s.scale(e.size[0],e.size[0],e.size[0]),e.v=A.getVertex(s,u),e.index=A.getIndex(s,u),"PHYSX"===this.engine){let a=new t.Vector3;A.getCenter(s,a),e.massCenter||(e.massCenter=a.toArray())}b=!0,l=!0;break;case"customSphere":c="customSphere_"+o[0],s=we.get(c),s?c="":(s=new t.SphereGeometry(o[0],e.seg1||32,e.seg2||16),s.name=c),l=!0,e.type="sphere";break;case"capsule":c="capsule_"+o[0]+"_"+o[1]+"_"+d,s=we.get(c),s?c="":(s=new O(o[0],o[1],d),s.name=c),l=!0;break;case"ChamferBox":c="ChamferBox_"+o[0]+"_"+o[1]+"_"+o[2]+"_"+e.radius,s=we.get(c),s?c="":(s=new G(o[0],o[1],o[2],e.radius),s.name=c),l=!0;break;case"ChamferCyl":c="ChamferCyl_"+o[0]+"_"+o[1]+"_"+o[2]+"_"+e.radius+"_"+d,s=we.get(c),s?c="":(s=new V(o[0],o[0],o[1],e.radius,d),s.name=c),l=!0;break;default:e.breakable?(s=we.get(h).clone(),s.scale(o[0],o[1],o[2]),b=!0,l=!0):s=we.get(h),"highSphere"===h&&(e.type="sphere")}if(e.translate&&s.translate(e.translate[0],e.translate[1],e.translate[2]),e.shape&&delete e.shape,e.geometry&&delete e.geometry,(void 0===s.attributes.uv||e.autoUV)&&N(s,"box",5,e.pos,e.quat),""!==c&&we.set(s),e.isWheel&&(s=s.clone(),s.rotateZ(-j),b=!0),b&&we.unic(s),null===a&&null===i)return s.noScale=l,s;e.meshRemplace&&e.debug&&(i=ve.get("debug"));let f=new t.Mesh(s,i);if(e.button&&(f.isButton=!0),e.helper){let t=e.hcolor||[.3,.1,0],a=e.hcolor2||[.8,.2,0],i=new ce(o[0],o[1]+2*o[0],!1,ve.get("liner"),t,a,!0);f.add(i),f.userData.helper=i}e.localRot&&(e.localQuat=A.quatFromEuler(e.localRot)),e.localPos&&f.position.fromArray(e.localPos),e.localQuat&&f.quaternion.fromArray(e.localQuat),l||f.scale.fromArray(e.size),void 0!==e.ray&&(e.ray||(f.raycast=()=>{})),e.meshRemplace&&!e.debug||(a.add(f),f.userData.helper&&(a.over=e=>{f.userData.helper.over(e)}))}add(e={}){e.worldScale&&delete(e=this.scaler(e,e.worldScale)).worldScale;let a,i,s,r=0;if(e.instance||(s=this.setName(e)),e.type=void 0===e.type?"box":e.type,"plane"!==e.type||e.visible||(e.visible=!1),"stair"===e.type){let a=new t.Vector3(0,0,e.size[2]),i=new t.Vector3(0,.5*e.size[1],.5*e.size[2]),s=a.angleTo(i),r=a.distanceTo(i);e.rot=[s*v,0,0],e.size[1]*=e.div||.2,e.size[2]=2*r;let n=new t.Vector3(0,.5*-e.size[1],0);n.applyAxisAngle({x:1,y:0,z:0},s),e.pos[1]+=n.y,e.pos[2]+=n.z}if(e.massCenter&&-1===S.indexOf(this.engine))if("compound"!==e.type)e.shapes=[{type:e.type,pos:e.massCenter,size:e.size}],e.seg&&(e.shapes[0].seg=e.seg),e.radius&&(e.shapes[0].radius=e.radius),delete e.size,e.type="compound";else for(a=0;a<e.shapes.length;a++)i=e.shapes[a],i.pos?i.pos=A.addArray(i.pos,e.massCenter):i.pos=e.massCenter;void 0!==e.collision&&!1===e.collision&&("PHYSX"===this.engine&&(e.flags=0),"OIMO"===this.engine&&(e.mask=0)),e.pos=void 0===e.pos?[0,0,0]:e.pos,e.quat=void 0===e.quat?[0,0,0,1]:e.quat,void 0!==e.rot&&(e.quat=A.quatFromEuler(e.rot)),void 0!==e.meshRot&&(e.meshQuat=A.quatFromEuler(e.meshRot)),e.size=A.autoSize(e.size,e.type),e.meshScale&&(e.meshScale=A.autoSize(e.meshScale));let n,o=!1;!1===e.visible&&(e.material="hide"),void 0!==e.material?n=e.material.constructor===String?ve.get(e.material):e.material:(o=!0,n=ve.get(this.type),e.instance&&"solid"!==this.type&&(n=ve.get("base"))),e.unicMat&&(n=n.clone(),ve.addToTmp(n));let c=e.instance?{}:new t.Object3D;if(e.mesh&&!e.instance){"terrain"===e.mesh.type&&(e.noClone=!0);let t=e.noClone?e.mesh:e.mesh.clone();if(t.position.fromArray(e.meshPos||[0,0,0]),e.meshQuat&&t.quaternion.fromArray(e.meshQuat),e.meshSize&&t.scale.set(1,1,1).multiplyScalar(e.meshSize),e.meshScale&&t.scale.fromArray(e.meshScale),!o&&(t.material=n,t.children&&!e.nofullmat))for(let e in t.children)t.children[e].material=n;this.motor.tmpMesh.push(t),e.meshRemplace=!0,c.add(t)}switch(e.type){case"null":break;case"compound":for(a=0;a<e.shapes.length;a++)i=e.shapes[a],i.type=void 0===i.type?"box":i.type,i.size=A.autoSize(i.size,i.type),i.pos&&(i.localPos=i.pos),void 0!==i.rot&&(i.quat=A.quatFromEuler(i.rot)),i.quat&&(i.localQuat=i.quat),i.debug=e.debug,i.meshRemplace=e.meshRemplace||!1,e.instance?"convex"===i.type&&(i.v=A.getVertex(i.shape,!1)):this.geometry(i,c,n),r+=A.getVolume(i.type,i.size,i.v);break;default:e.instance?"convex"===e.type&&(e.v=A.getVertex(e.shape,!1)):this.geometry(e,c,n),r=A.getVolume(e.type,e.size,e.v)}if(c.type=this.type,c.size=e.size,c.shapetype=e.type,c.isKinematic=e.kinematic||!1,c.link=0,c.meshSize=e.meshSize?e.meshSize:1,c.velocity=new t.Vector3,c.angular=new t.Vector3,c.sleep=e.sleep||!1,c.defMat=!1,e.button&&(c.isButton=!0),c.isRay=void 0===e.ray||e.ray,c.material&&o&&(c.defMat="body"===c.material.name),e.instance){c.isInstance=!0,c.instance=this.getInstance(e,n),c.instance.isRay=c.isRay,c.over=c.instance.over,c.isRay=!1,c.isOver=!1,c.speedMat=e.speedMat||!1,c.defMat="base"===c.instance.material.name,c.idx=c.instance.count,c.name=e.name?e.name:c.instance.name+c.idx,e.name=c.name,c.noScale=c.instance.noScale,e.sizeByInstance&&(c.noScale=!1);let a=e.color;c.defMat&&(a=e.sleep?Y.sleep:Y.body),c.instance.add(c,e.pos,e.quat,c.noScale?[1,1,1]:c.size,a),c.position=(new t.Vector3).fromArray(e.pos),c.quaternion=(new oe).fromArray(e.quat),this.needMatrix&&(c.matrixWorld=new t.Matrix4),c.instance.v&&(e.v=c.instance.v),c.instance.index&&(e.index=c.instance.index),e.type=c.instance.type,c.actif=!1}else c.name=s,c.isRay||c.traverse((function(e){e.isObject3D&&(e.raycast=()=>{})})),e.renderOrder&&(c.renderOrder=e.renderOrder),void 0===e.visible&&(e.visible=!0),void 0===e.shadow&&(e.shadow=e.visible),c.dispose=function(){this.clearOutLine&&this.clearOutLine(),this.traverse((function(e){e.isMesh&&e.unic&&e.geometry.dispose()})),this.children=[]}.bind(c),c.visible=void 0===e.visible||e.visible,Object.defineProperty(c,"material",{get(){return this.children[0]?this.children[0].material:null},set(e){this.traverse((function(t){t.isMesh&&"outline"!==t.name&&(t.material=e)}))}}),Object.defineProperty(c,"castShadow",{get(){return!!this.children[0]&&this.children[0].castShadow},set(e){this.traverse((function(t){t.isMesh&&(t.castShadow=e)}))}}),Object.defineProperty(c,"receiveShadow",{get(){return!!this.children[0]&&this.children[0].receiveShadow},set(e){this.traverse((function(t){t.isMesh&&(t.receiveShadow=e)}))}}),c.receiveShadow=e.shadow,c.castShadow=e.shadow,this.motor.mouseActive&&(c.overMaterial=ve.get("outline"),c.isOver=!1,c.addOutLine=function(){this.children[0].isMesh&&(this.outline=(new t.Mesh).copy(this.children[0]),this.outline.name="outline",this.outline.material=this.overMaterial,this.outline.matrixAutoUpdate=!1,this.outline.receiveShadow=!1,this.outline.castShadow=!1,this.outline.raycast=()=>!1,this.add(this.outline))}.bind(c),c.clearOutLine=function(){this.outline&&(this.remove(this.outline),this.outline=null)}.bind(c),c.over=function(e){e&&!this.isOver&&this.addOutLine(),!e&&this.isOver&&this.clearOutLine(),this.isOver=e}.bind(c),c.select=function(e){}.bind(c)),this.set(e,c);if(e.breakable){let a=c,i=a.children[0];a.remove(i),c=i,c.position.copy(a.position),c.quaternion.copy(a.quaternion),c.name=s,c.type=this.type,c.breakable=!0,c.breakOption=void 0!==e.breakOption?e.breakOption:[250,1,2,1],c.ignore=e.ignore||[],c.size=e.size,c.shapetype=e.type,c.isKinematic=e.kinematic||!1,c.link=0,c.meshSize=e.meshSize?e.meshSize:1,c.velocity=new t.Vector3,c.angular=new t.Vector3,c.sleep=e.sleep||!1,c.defMat=!1,c.auto=e.auto||!1,c.auto?c.matrixAutoUpdate=!0:(c.matrixAutoUpdate=!1,c.updateMatrix())}if(c.mass=e.mass||0,c.density=e.density||0,c.density&&!c.mass?c.mass=A.massFromDensity(c.density,r):c.mass&&!c.density&&(c.density=A.densityFromMass(c.mass,r),"RAPIER"!==this.engine&&"OIMO"!==this.engine&&"PHYSX"!==this.engine||(e.density=c.density)),e.massInfo&&console.log("%c"+c.name+" %cdensity:"+c.density+" mass:"+c.mass,"font-size:16px","font-size:12px"),e.getVelocity&&(c.getVelocity=!0),this.addToWorld(c,e.id),e.onlyMakeMesh)return c;if(e.phySize&&(e.size=e.phySize),e.phyPos&&(e.pos=e.phyPos),e.rot&&delete e.rot,e.mesh&&delete e.mesh,e.meshRot&&delete e.meshRot,e.instance&&delete e.instance,e.material&&delete e.material,e.parent&&delete e.parent,e.solver&&"PHYSX"===this.engine){e.mass=c.mass;this.byName(e.solver).addBone(e.name)}if(e.sleep&&this.set(e,c),this.motor.post({m:"add",o:e}),e.breakable){this.motor.getBreaker().add(c)}return c}dispatchEvent(e,t,a){this.byName(e).dispatchEvent({type:t,data:a})}set(e={},t=null){null===t&&(t=this.byName(e.name)),null!==t&&(void 0!==e.getVelocity&&(t.getVelocity=e.getVelocity),t.isInstance?(e.pos&&t.position.fromArray(e.pos),e.quat&&t.quaternion.fromArray(e.quat),(e.pos||e.quat)&&t.instance.setTransformAt(t.idx,t.position.toArray(),t.quaternion.toArray(),t.noScale?[1,1,1]:t.size)):(e.pos&&t.position.fromArray(e.pos),e.quat&&t.quaternion.fromArray(e.quat),t.auto=e.auto||!1,t.auto?t.matrixAutoUpdate=!0:(t.matrixAutoUpdate=!1,t.updateMatrix())))}getTransform(e){if("string"==typeof e&&(e=this.byName(o.name)),null===e)return;e.updateWorldMatrix(!0,!1);const t=e.matrixWorld.elements;return{position:e.position.clone(),up:ke.clone().set(t[4],t[5],t[6]).normalize(),right:je.clone().set(t[0],t[1],t[2]).normalize(),forward:Me.clone().set(t[8],t[9],t[10]).normalize()}}clearInstance(e){let t=this.motor.instanceMesh[e],a=t.getBodyList();this.motor.remove(a),t.dispose(),delete this.motor.instanceMesh[e]}getInstance(e,t){if(this.motor.instanceMesh[e.instance])return this.motor.instanceMesh[e.instance];(e={...e}).sizeByInstance&&(e.size=[1,1,1]);let a=this.geometry(e);e.mesh&&(!e.material&&e.mesh.material&&(t=e.mesh.material),a=e.mesh.isObject3D?e.mesh.geometry.clone():e.mesh.clone(),e.meshSize&&a.scale(e.meshSize,e.meshSize,e.meshSize),e.meshScale&&a.scale(e.meshScale[0],e.meshScale[1],e.meshScale[2]),a.noScale=!0);let i=new ne(a,t,0);return i.type=e.type,i.noScale=a.noScale,"convex"===i.type&&(i.v=e.v),e.index&&(i.index=e.index),i.receiveShadow=void 0===e.shadow||e.shadow,i.castShadow=void 0===e.shadow||e.shadow,this.motor.mouseActive&&(i.overMaterial=ve.get("outline")),i.name=e.instance,this.motor.scene.add(i),this.motor.instanceMesh[e.instance]=i,i}scaler(e,t){if(e.size&&(e.size=math.worldscale(e.size,t)),e.pos&&(e.pos=math.worldscale(e.pos,t)),"convex"===e.type&&(e.shapeScale=[t,t,t]),e.shapes){let a,i=e.shapes.length;for(;i--;)a=e.shapes[i],a.size&&(a.size=math.scaleArray(a.size,t)),a.pos&&(a.pos=math.scaleArray(a.pos,t)),"convex"===a.type&&(a.shapeScale=[t,t,t])}return e.mesh&&(e.meshScale=[t,t,t]),e}}class Se extends t.Mesh{constructor(e,a={},s=null){if(super(),this.model=e,this.material=s,this.outMaterial=!!s,this.XML=new XMLSerializer,this.color=new t.Color,this.opacity=1,this.svgLoader=new i.SVGLoader,this.base="http://www.w3.org/2000/svg",this.svg=document.createElementNS(this.base,"svg"),this.layerUp=1e-4,this.fill=!0,this.stroke=!0,this.size=a.size||1,this.scaler=1/this.size,!this.model)return;let r={radius:5,min:90,max:90,strokeSize:.25,...a};switch(this.model){case"angle":this.fill=void 0===r.fill||r.fill,this.stroke=void 0===r.stroke||r.stroke;let e=Math.abs(r.min);this.add("path",{d:this.circle(0,0,r.radius,180,180+r.max,!0),stroke:"none",fill:"#FF0000","fill-opacity":.1}),this.add("path",{d:this.circle(0,0,r.radius,180,180+r.max,!1,!1,.3),stroke:"#FF0000","stroke-opacity":1,"stroke-width":r.strokeSize,fill:"none","stroke-linecap":"round"}),this.add("path",{d:this.circle(0,0,r.radius,180-e,180,!0),stroke:"none",fill:"#0050FF","fill-opacity":.1}),this.add("path",{d:this.circle(0,0,r.radius,180-e,180,!1,!1,.3,!0),stroke:"#0050FF","stroke-opacity":1,"stroke-width":r.strokeSize,fill:"none","stroke-linecap":"round"});break;case"liner":let t=.5*r.radius,a=r.max*this.scaler,i=r.min*this.scaler;this.fill=void 0===r.fill||r.fill,this.stroke=void 0===r.stroke||r.stroke,this.add("path",{d:this.segment({x:-t,y:0},{x:t,y:0}),stroke:"#FFFFFF","stroke-opacity":1,"stroke-width":r.strokeSize,fill:"none","stroke-linecap":"butt"}),this.add("path",{d:this.segment({x:-t,y:a},{x:t,y:a}),stroke:"#FF0000","stroke-opacity":1,"stroke-width":r.strokeSize,fill:"none","stroke-linecap":"butt"}),this.add("path",{d:this.segment({x:-t,y:i},{x:t,y:i}),stroke:"#0050FF","stroke-opacity":1,"stroke-width":r.strokeSize,fill:"none","stroke-linecap":"butt"}),this.add("path",{d:this.segment({x:0,y:0},{x:0,y:a}),stroke:"#FF0000","stroke-opacity":1,"stroke-width":r.strokeSize,fill:"none","stroke-linecap":"butt"}),this.add("path",{d:this.segment({x:0,y:0},{x:0,y:i}),stroke:"#0050FF","stroke-opacity":1,"stroke-width":r.strokeSize,fill:"none","stroke-linecap":"butt"});break;case"needle":this.fill=void 0===r.fill||r.fill,this.stroke=void 0===r.stroke||r.stroke,this.add("path",{d:this.circle(0,0,.7,0,360,!1,!0,0),stroke:"#FFFFFF","stroke-opacity":1,"stroke-width":r.strokeSize,fill:"none","stroke-linecap":"butt"}),this.add("path",{d:this.segment({x:0,y:0},{x:0,y:4.4}),stroke:"#FFFFFF","stroke-opacity":1,"stroke-width":r.strokeSize,fill:"none","stroke-linecap":"round"});break;case"middle":let s=.5*r.radius;this.fill=void 0===r.fill||r.fill,this.stroke=void 0===r.stroke||r.stroke,this.add("path",{d:this.circle(0,0,.7,0,360,!1,!0,0),stroke:"#FFFFFF","stroke-opacity":1,"stroke-width":r.strokeSize,fill:"none","stroke-linecap":"butt"}),this.add("path",{d:this.segment({x:0,y:-s},{x:0,y:s}),stroke:"#FFFFFF","stroke-opacity":1,"stroke-width":r.strokeSize,fill:"none","stroke-linecap":"butt"}),this.add("path",{d:this.segment({x:-s,y:0},{x:s,y:0}),stroke:"#FFFFFF","stroke-opacity":1,"stroke-width":r.strokeSize,fill:"none","stroke-linecap":"butt"})}this.toMesh()}raycast(){return!1}update(e={}){let t={};if("angle"===this.model){t={radius:5,min:-90,max:90,...e};let a=Math.abs(t.min);this.change("d",this.circle(0,0,t.radius,180,180+t.max,!0),0),this.change("d",this.circle(0,0,t.radius,180,180+t.max,!1,!1,.3),1),this.change("d",this.circle(0,0,t.radius,180-a,180,!0),2),this.change("d",this.circle(0,0,t.radius,180-a,180,!1,!1,.3,!0),3)}void 0!==e.wireframe&&(this.material.wireframe=e.wireframe),this.fill=void 0===t.fill||t.fill,this.stroke=void 0===t.stroke||t.stroke,this.toMesh()}set(e={},t){for(let a in e)t?t.setAttributeNS(null,a,e[a]):this.svg.setAttributeNS(null,a,e[a])}add(e,t={}){let a=document.createElementNS(this.base,e);this.set(t,a),this.svg.appendChild(a)}change(e,t,a){this.svg.childNodes[a].setAttributeNS(null,e,t)}getString(){return this.XML.serializeToString(this.svg)}polarToCartesian(e,t,a,i){var s=(i-90)*Math.PI/180;return{x:e+a*Math.cos(s),y:t+a*Math.sin(s)}}circle(e,t,a,i=0,s=360,r=!1,n=!1,o=0,c=!1){0===i&&360===s&&(i=1e-4,n=!0);let h=this.polarToCartesian(e,t,a,s),l=this.polarToCartesian(e,t,a,i),b=s-i<=180?"0":"1",d=["M",h.x,h.y,"A",a,a,0,b,0,l.x,l.y];if(r&&d.push("L",e,t,"L",h.x,h.y),n&&d.push("Z"),0!==o){let r=this.polarToCartesian(e,t,a-o,c?i:s),n=this.polarToCartesian(e,t,a+o,c?i:s);d.push("M",r.x,r.y,"L",n.x,n.y)}return d.join(" ")}segment(e,t){return["M",e.x,e.y,"L",t.x,t.y].join(" ")}geomColor(e,a,i=1){let s=e.attributes.position.count,r=[];for(;s--;)r.push(a.r,a.g,a.b,i);e.setAttribute("color",new t.Float32BufferAttribute(r,4))}toGeometry(){if(!this.fill&&!this.stroke)return null;let e=[],a=0,s=1,r=this.svgLoader.parse(this.getString());for(const n of r.paths){const r=n.userData.style.fill;if(this.fill&&void 0!==r&&"none"!==r){this.color.setStyle(r),s=n.userData.style.fillOpacity,s<this.opacity&&(this.opacity=s);const o=i.SVGLoader.createShapes(n);for(const i of o){const r=new t.ShapeGeometry(i);if(r){this.geomColor(r,this.color,s);let i=(new t.BufferGeometry).copy(r).toNonIndexed();i.translate(0,0,-a*this.layerUp),e.push(i),a++}}}const o=n.userData.style.stroke;if(this.stroke&&void 0!==o&&"none"!==o){this.color.setStyle(o),s=n.userData.style.strokeOpacity,s<this.opacity&&(this.opacity=s);for(const t of n.subPaths){const r=i.SVGLoader.pointsToStroke(t.getPoints(),n.userData.style,6);r&&(this.geomColor(r,this.color,s),r.translate(0,0,-a*this.layerUp),e.push(r),a++)}}}return e}toMesh(){let e=this.size;this.geometry&&this.geometry.dispose();let i=this.toGeometry();i?(this.geometry=a.mergeGeometries(i),this.geometry.scale(e,-e,e),this.geometry.rotateY(Math.PI),this.geometry.rotateZ(.5*-Math.PI),this.geometry.rotateY(.5*Math.PI),this.geometry.computeBoundingSphere()):this.geometry=new t.BufferGeometry,null===this.material&&(this.material=new t.MeshBasicMaterial({vertexColors:!0,transparent:1!==this.opacity,side:t.DoubleSide}),this.material.defines={USE_COLOR_ALPHA:""})}dispose(){this.material&&!this.outMaterial&&this.material.dispose(),this.geometry&&this.geometry.dispose()}}class Ee extends t.Object3D{constructor(e={},a){super(),this.motor=a,this.isJoint=!0,this.type="joint",this.mode=e.mode||"hinge",this.visible=void 0!==e.visible&&e.visible,this.mtx=new t.Matrix4,this.size=e.helperSize||.1,this.matrixAutoUpdate=!1;let i,s,r=this.motor.mat.get("line");switch(this.mode){case"prismatic":i=this.motor.mat.get("svg"),s={min:-180,max:180,fill:!1,stroke:!0,wireframe:!1,size:.5*this.size},e.lm&&(s.min=e.lm[0],s.max=e.lm[1]),this.m1=new Se("liner",s,i),this.m2=new Se("middle",s,i),this.m1.geometry.rotateY(90*A.torad),this.add(this.m1),this.add(this.m2);break;case"hinge":case"cylindrical":i=this.motor.mat.get("svg"),s={min:-180,max:180,fill:!1,stroke:!0,wireframe:!1,size:.5*this.size},e.lm&&(s.min=e.lm[0],s.max=e.lm[1]),e.lmr&&(s.min=e.lmr[0],s.max=e.lmr[1]),this.m1=new Se("angle",s,i),this.m2=new Se("needle",s,i),this.add(this.m1),this.add(this.m2);break;default:const a=this.motor.geo.get("joint");let n=a.clone();n.scale(this.size,this.size,this.size),this.m1=new t.LineSegments(n,r),this.add(this.m1),n=a.clone(),n.scale(.8*this.size,.8*this.size,.8*this.size),this.m2=new t.LineSegments(n,r),this.add(this.m2)}this.m1.matrixAutoUpdate=!1,this.m2.matrixAutoUpdate=!1,this.body1=null,this.body2=null,this.mat1=new t.Matrix4,this.mat2=new t.Matrix4,this.end=new t.Vector3;let n=new t.Quaternion;e.quat1&&this.mat1.makeRotationFromQuaternion(n.fromArray(e.quat1)),e.quat2&&this.mat2.makeRotationFromQuaternion(n.fromArray(e.quat2)),this.mat1.setPosition(e.pos1[0],e.pos1[1],e.pos1[2]),this.mat2.setPosition(e.pos2[0],e.pos2[1],e.pos2[2]);const o=new t.BufferGeometry;o.setAttribute("position",new t.Float32BufferAttribute([0,0,0,0,0,0],3)),o.setAttribute("color",new t.Float32BufferAttribute([1,0,0,1,0,0],3)),o.computeBoundingSphere(),this.m3=new t.LineSegments(o,r),this.add(this.m3),this.m3.matrixAutoUpdate=!1,this.pp=this.m3.geometry.attributes.position}update(){this.visible&&(this.body1?this.matrix.copy(this.body1.matrixWorld).multiply(this.mat1):this.matrix.copy(this.mat1),this.body2?this.m2.matrix.copy(this.body2.matrixWorld).multiply(this.mat2):this.m2.matrix.copy(this.mat2),this.m2.matrix.premultiply(this.matrix.clone().invert()),this.end.setFromMatrixPosition(this.m2.matrix),this.pp.setXYZ(1,this.end.x,this.end.y,this.end.z),this.pp.needsUpdate=!0,"cylindrical"===this.mode&&(this.m1.position.copy(this.end),this.m1.updateMatrix()))}updateFromPhy(e,t=0){this.visible&&(this.position.fromArray(e,t),this.quaternion.fromArray(e,t+3),this.updateMatrix(),this.m2.position.fromArray(e,t+7),this.m2.quaternion.fromArray(e,t+10),this.m2.matrix.compose(this.m2.position,this.m2.quaternion,{x:1,y:1,z:1}),this.mtx.copy(this.matrix).invert().multiply(this.m2.matrix),this.mtx.decompose(this.m2.position,this.m2.quaternion,{x:1,y:1,z:1}),this.m2.updateMatrix(),this.pp.setXYZ(1,this.m2.position.x,this.m2.position.y,this.m2.position.z),this.pp.needsUpdate=!0,"cylindrical"===this.mode&&(this.m1.position.copy(this.m2.position),this.m1.updateMatrix()))}dispose(){this.body1&&this.body1.link--,this.body2&&this.body2.link--,this.m1.geometry.dispose(),this.m2.geometry.dispose(),this.m3.geometry.dispose(),this.children=[]}}class Fe extends ie{constructor(e){super(),this.motor=e,this.engine=this.motor.engine,this.Utils=this.motor.utils,this.type="joint",this.v1=new t.Vector3,this.v2=new t.Vector3}step(e,t){let a,i,s=this.list.length;for(;s--;)a=this.list[s],i=t+s*B.joint,16===B.joint?a.updateFromPhy(e,i):a.update()}add(e={}){let a,i=this.setName(e),s=null,r=null,n=!1;if(e.axis1||(e.axis1=[1,0,0]),e.axis2||(e.axis2=[1,0,0]),e.pos1||(e.pos1=[0,0,0]),e.pos2||(e.pos2=[0,0,0]),e.limit?e.lm=e.limit:e.lm&&(e.limit=e.lm),"universal"!==e.mode&&"dof"!==e.mode&&"d6"!==e.mode||(e.mode="generic"),"revolute"===e.mode&&(e.mode="hinge"),"slider"===e.mode&&(e.mode="cylindrical"),e.b1&&(a="string"==typeof e.b1,s=a?this.Utils.byName(e.b1):e.b1,a||(e.b1=e.b1.name),s&&s.link++),e.b2&&(a="string"==typeof e.b2,r=a?this.Utils.byName(e.b2):e.b2,a||(e.b2=e.b2.name),r&&r.link++),e.worldPos&&(e.worldAnchor=e.worldPos),e.worldAnchor&&(e.pos1=s?this.Utils.toLocal(this.v1.fromArray(e.worldAnchor),s).toArray():e.worldAnchor,e.pos2=r?this.Utils.toLocal(this.v2.fromArray(e.worldAnchor),r).toArray():e.worldAnchor,delete e.worldAnchor),e.worldAxis&&(e.axis1=s?this.Utils.toLocal(this.v1.fromArray(e.worldAxis),s,!0).toArray():e.worldAxis,e.axis2=r?this.Utils.toLocal(this.v2.fromArray(e.worldAxis),r,!0).toArray():e.worldAxis,n=!0,delete e.worldAxis),e.worldQuat&&(e.quat1=this.Utils.quatLocal(e.worldQuat,s),e.quat2=this.Utils.quatLocal(e.worldQuat,r),"OIMO"!==this.engine&&"HAVOK"!==this.engine&&"JOLT"!==this.engine||(e.axis1=this.Utils.axisLocal(A.quatToAxis(e.worldQuat),s),e.axis2=this.Utils.axisLocal(A.quatToAxis(e.worldQuat),r)),delete e.worldQuat),void 0!==e.rot1&&(e.quat1=A.quatFromEuler(e.rot1),delete e.rot1),void 0!==e.rot2&&(e.quat2=A.quatFromEuler(e.rot2),delete e.rot2),e.quat1||(e.quat1=(new t.Quaternion).setFromUnitVectors(new t.Vector3(1,0,0),(new t.Vector3).fromArray(e.axis1).normalize()).toArray()),e.quat2||(e.quat2=(new t.Quaternion).setFromUnitVectors(new t.Vector3(1,0,0),(new t.Vector3).fromArray(e.axis2).normalize()).toArray()),"AMMO"===this.engine&&n&&"hinge"===e.mode){let a=new t.Euler(0,-90*w,0),i=(new t.Quaternion).setFromEuler(a).toArray();e.quatX=i}e.drivePosition&&void 0!==e.drivePosition.rot&&(e.drivePosition.quat=A.quatFromEuler(e.drivePosition.rot),delete e.drivePosition.rot);let o=new Ee(e,this.motor);return o.name=i,o.body1=s,o.body2=r,void 0===e.visible&&(e.visible=this.motor.jointVisible||!1),this.set(e,o),this.addToWorld(o,e.id),this.motor.post({m:"add",o:e}),o}set(e={},t=null){null===t&&(t=this.byName(e.name)),null!==t&&void 0!==e.visible&&(t.visible=e.visible)}}class ze extends ie{constructor(e){super(),this.motor=e,this.Utils=this.motor.utils,this.type="contact"}step(e,t){let a,i,s=this.list.length;for(;s--;)a=this.list[s],i=t+s*B.contact,a.update(e,i)}add(e={}){this.setName(e);let t=new Re(e);return e.callback&&delete e.callback,this.addToWorld(t,e.id),this.motor.post({m:"add",o:e}),t}}class Re{constructor(e={}){this.type="contact",this.name=e.name,this.callback=e.callback||function(){},this.b1=e.b1||null,this.b2=e.b2||null,this.ignore=e.ignore||[],this.always=void 0===e.always||e.always,this.data={hit:!1,point:[0,0,0],normal:[0,0,0]}}detectBody(){}update(e,t=0){this.data.hit=e[t]>0,this.simple||(this.data.point=[e[t+1],e[t+2],e[t+3]],this.data.normal=[e[t+4],e[t+5],e[t+6]]),(this.data.hit||this.always)&&this.callback(this.data)}}let Pe=null;class Te extends ie{constructor(e){super(),this.motor=e,this.engine=this.motor.engine,this.Utils=this.motor.utils,this.motor.geo,Pe=this.motor.mat,this.type="vehicle",this.num=B[this.type]}step(e,t){let a,i,s=this.list.length;for(;s--;)i=this.list[s],a=t+s*this.num,i.step(e,a)}add(e={}){this.setName(e);const t=new Ie(e,this.motor);return this.addToWorld(t,e.id),this.motor.post({m:"add",o:t.o}),t}set(e={},t=null){null===t&&(t=this.byName(e.name))}}class Ie extends t.Object3D{constructor(e,a){super(),this.motor=a,this.Utils=this.motor.utils,this.velocity=new t.Vector3,this.angular=new t.Vector3,e.extra&&(this.extra=e.extra,delete e.extra),this.type="vehicle",this.name=e.name||"car",this.isRay=e.ray||!1,this.actif=!1,this.steering=0,this.suspension=[],this.rolling=[],this.init(e)}drive(){}raycast(){}init(e){this.mass=e.mass||2e3,this.model=null,this.size=e.size||[1.7,1,5],this.massCenter=e.massCenter||[0,.55,1.594],this.chassisPos=e.chassisPos||[0,.83,0],this.maxSteering=e.maxSteering||24,this.incSteering=e.incSteering||2,this.s_travel=e.s_travel||.4,this.s_ratio=1/(.5*this.s_travel),this.decaly="PHYSX"===this.engine?.5*this.s_travel:0,this.numWheel=e.numWheel||4,this.radius=e.radius||.35,this.radiusBack=e.radiusBack||this.radius,this.deep=e.deep||.3,this.deepBack=e.deepBack||this.deep;let t=this.numWheel<4?1:2;if(e.wPos||(e.wPos=[.8,.1,1.4]),e.wPos){this.wPos=e.wPos;var a,i,s,r,n,o,c=e.wPos,h=[],l=1,b=0;c.length,c.length;for(let e=0;e<this.numWheel;e++)l=e%2==0?-1:1,i=Math.floor(.5*e),b=e>=t,0===(s=c[1])&&(s=b?this.radiusBack:this.radius),(r=c[0])instanceof Array&&(r=c[0][i]),n=b?-c[2]:c[2],c[2]instanceof Array&&(n=c[2][i]),a=[r*l,s,n],h.push(a);this.wheelsPosition=h,delete e.wPos}e.wheelsPosition&&(this.wheelsPosition=e.wheelsPosition);const d=e.meshScale||1,u=[];e.chassisShape?u.push({type:"convex",shape:e.chassisShape,size:[d],pos:this.chassisPos,filter:[1,-1,0,0],isExclusive:!0,ray:this.isRay}):u.push({type:"box",size:this.size,pos:this.chassisPos});for(let a=0;a<this.numWheel;a++)a<t?u.push({type:"cylinder",size:[this.radius,this.deep],isWheel:!0,radius:e.rad||.05,shadow:!1,ray:!1}):u.push({type:"cylinder",size:[this.radiusBack,this.deepBack],isWheel:!0,radius:e.rad||.05,shadow:!1,ray:!1});var f=Pe.get(e.debug?"debug":void 0===e.chassisMesh?"body":"hide");let m,p;for(let e=0;e<u.length;e++)m=u[e],m.pos&&(m.localPos=m.pos),m.size=A.autoSize(m.size,m.type),this.motor.getGeometryRef(m,this,f);if(e.chassisMesh&&(p=e.noClone?e.chassisMesh:e.chassisMesh.clone(),p.position.set(0,0,0),this.Utils.noRay(p),p.scale.set(d,d,d),this.children[0].add(p),this.model=p,delete e.chassisMesh),e.wheelMesh){for(let a=1;a<this.numWheel+1;a++)b=a>=t+1,p=e.wheelMeshBack&&b?e.wheelMeshBack.clone():e.wheelMesh.clone(),this.Utils.noRay(p),p.position.set(0,0,0),2==a||4==a?p.scale.set(-d,d,d):p.scale.set(d,d,d),this.children[a].add(p);delete e.wheelMesh}if(e.suspensionMesh){this.suspensionMesh=[];for(let t=1;t<this.numWheel+1;t++)p=e.suspensionMesh.clone(),this.Utils.noRay(p),p.position.set(0,0,0),p.position.fromArray(this.wheelsPosition[t-1]),p.position.x=0,2==t||4==t?p.scale.set(d,d,d):p.scale.set(-d,d,d),this.children[0].add(p),this.suspensionMesh.push(p);delete e.suspensionMesh}if(e.brakeMesh){this.brake=[];for(let t=1;t<this.numWheel+1;t++)b=t>2,p=e.brakeMeshBack&&b?e.brakeMeshBack.clone():e.brakeMesh.clone(),this.Utils.noRay(p),p.position.set(0,0,0),p.position.fromArray(this.wheelsPosition[t-1]),o=e.brakeMeshBack||b?d:-d,2==t||4==t?p.scale.set(-d,d,o):p.scale.set(d,d,o),this.children[0].add(p),this.brake.push(p);delete e.brakeMesh}e.mass=this.mass,e.size=e.chassisShape?u[0].boxSize:this.size,e.numWheel=this.numWheel,e.wheelsPosition=this.wheelsPosition,e.radius=this.radius,e.radiusBack=this.radiusBack,e.deep=this.deep,e.deepBack=this.deepBack,e.chassisShape=u[0],e.maxSteering=this.maxSteering,e.incSteering=this.incSteering,e.s_travel=this.s_travel,e.massCenter=this.massCenter,e.chassisPos=this.chassisPos,this.o=e}set(e){e.name=this.name,this.motor.change(e)}respawn(e){(e=e||{}).respawn=!0,e.name=this.name,e.keepRotation&&(e.quat=this.quaternion.toArray()),this.motor.change(e)}move(){}dispose(){}step(e,t){if(!this.actif){if(0===e[t+0]+e[t+1]+e[t+2]+e[t+3]+e[t+4]+e[t+5]+e[t+6]+e[t+7])return;this.actif=!0}this.position.fromArray(e,t+1),this.quaternion.fromArray(e,t+4),this.updateMatrix();let a,i=this.numWheel+1,s=0,r=0,n=[],o=0;for(let c=0;c<i;c++)o=8*c+t,0===c&&(e[o],this.circum),1===c&&(s=e[o]),2===c&&(r=e[o]),a=this.children[c],a&&c>0&&(n[c-1]=this.wheelsPosition[c-1][1]-this.decaly-e[o+2],a.position.fromArray(e,o+1),a.quaternion.fromArray(e,o+4),this.rolling[c-1]=a.rotation.x,this.brake&&(this.brake[c-1].position.copy(a.position),1!=c&&2!=c||(this.brake[c-1].rotation.y=e[o])));for(o=4;o--;)this.suspension[o]=A.clamp(n[o]*this.s_ratio,-1,1),this.suspensionMesh&&(this.suspension[o]>0?(this.Utils.morph(this.suspensionMesh[o].children[0],"low",this.suspension[o]),this.Utils.morph(this.suspensionMesh[o].children[0],"top",0)):(this.Utils.morph(this.suspensionMesh[o].children[0],"low",0),this.Utils.morph(this.suspensionMesh[o].children[0],"top",-this.suspension[o])));this.steering=Math.round(.5*(s+r)*v)/this.maxSteering}}const Be=new t.Matrix4,Ce=new t.Vector3,De=new t.Quaternion,Le=new t.Vector3,Oe=new t.Matrix4,qe=new t.Matrix4,Ve=["hip","abdomen","chest","neck","head","rCollar","lCollar","lShldr","rShldr","lThigh","rThigh","rBreast","lBreast"];class Ge extends t.Object3D{constructor(e,t,a,i,s=null,r={}){super(),this.motor=e,this.prefix=t||"yoo_",this.mode="follow",this.withFinger=!1,this.nodes=[],this.bones=i,this.model=a,this.scaler=this.model.scale.x,this.posRef={},this.quatRef={},this.useSolver=!1,"PHYSX"!==this.motor.engine&&(this.useSolver=!1),this.nameList=[],this.jointList=[],this.breast=!1,this.ready=!1,this.matrixAutoUpdate=!1,this.mass=s,this.friction=.5,this.restitution=0,this.option=r,this.useDrive=void 0===r.useDrive||r.useDrive,this.showJoint=void 0!==r.showJoint&&r.showJoint,this.init()}setMass(e){if(e===this.mass)return;this.mass=e;const t=[];let a=this.nodes.length,i=this.mass/a;for(;a--;)t.push({name:this.nodes[a].name,mass:i});this.motor.change(t)}setMode(e){if(e===this.mode)return;this.mode=e;const t=[];let a,i="follow"===this.mode,s=this.nodes.length;for(;s--;)a=this.nodes[s],t.push({name:a.name,kinematic:i}),a.kinematic=i,a.bone.isPhysics=!i;this.motor.change(t)}freeBone(e){e.kinematic&&(e.cc++,20===e.cc&&(e.cc=0,e.kinematic=!1,e.bone.isPhysics=!0,this.motor.change({name:e.name,kinematic:!1})))}isVisible(e){let t=this.nameList.length;for(;t--;)this.motor.byName(this.nameList[t]).visible=e}init(){this.useSolver&&(this.solver=this.motor.add({type:"solver",name:this.prefix+"_solver",iteration:32,fix:!0,needData:!0})),this.useAggregate="PHYSX"===this.motor.engine;const e=[];let a=(new t.Matrix4).makeScale(this.scaler,this.scaler,this.scaler),i=new t.Vector3,s=new t.Vector3,r=new t.Quaternion,n=new t.Euler,o=new t.Matrix4,c=new t.Matrix4,h=new t.Matrix4;Oe.copy(this.model.matrixWorld).invert();let l=new t.Vector3,b=new t.Vector3,d=[1,1,1,1,1,1,1];this.option.sizer&&(d=this.option.sizer);let u,f,m,p,g,y,x,v,k,j,M,S,E,F=this.bones.length,z=0;for(this.mass&&(z=this.mass/F),u=0;u<F;u++)if(k=null,p=this.bones[u],f=p.name,g=p.parent,g){m=g.name,qe.multiplyMatrices(Oe,p.matrixWorld),l.setFromMatrixPosition(qe),qe.multiplyMatrices(Oe,g.matrixWorld),b.setFromMatrixPosition(qe),x=l.distanceTo(b),M=[0,0,.5*x],y=[x,1,1],v=null,j=!0,E=!1,"hip"===m&&"abdomen"===f&&(k="capsule",y=[x*d[0],.08],M=[0,0,-x*d[0]],v=[0,0,90]),"abdomen"===m&&"chest"===f&&(k="capsule",y=[.7*x*d[1],.08],M=[0,0,.5*-x-.06],v=[90,0,0]),"chest"===m&&"neck"===f&&(k="capsule",y=[.4*x*d[2],.04],M=[0,0,.5*-x-.02],v=[0,0,90]),"neck"===m&&"head"===f&&(k="capsule",y=[.06*d[3],x],M=[0,0,.5*-x],v=[90,0,0]),"head"===m&&"End_head"===f&&(k="capsule",y=[.1*d[4],x-.17],M=[0,.02,.5*-x+.02],v=[90,0,0]),"chest"===m&&"rBreast"===f&&"HAVOK"!==this.motor.engine&&(m="rBreast",g=p,k="sphere",y=[.065],M=[.065,0,0],this.breast=!0,E=!0),"chest"===m&&"lBreast"===f&&"HAVOK"!==this.motor.engine&&(m="lBreast",g=p,k="sphere",y=[.065],M=[.065,0,0],this.breast=!0,E=!0);let t=.04*d[5],u=x-t;if("lCollar"===m&&"lShldr"===f&&(k="capsule",y=[t,.3*x],M=[.6*x,0,0],v=[0,0,90]),"lShldr"===m&&"lForeArm"===f&&(k="capsule",y=[t,u],M=[.5*u,0,0],v=[0,0,90]),"lForeArm"===m&&"lHand"===f&&(k="capsule",y=[t,u],M=[.5*u,0,0],v=[0,0,90]),"lHand"===m&&"lMid1"===f&&(k="box",y=[2*x,.09,.05],M=[x,0,0]),"rCollar"===m&&"rShldr"===f&&(k="capsule",y=[t,.3*x],M=[.6*-x,0,0],v=[0,0,90]),"rShldr"===m&&"rForeArm"===f&&(k="capsule",y=[t,u],M=[.5*-u,0,0],v=[0,0,90]),"rForeArm"===m&&"rHand"===f&&(k="capsule",y=[t,u],M=[.5*-u,0,0],v=[0,0,90]),"rHand"===m&&"rMid1"===f&&(k="box",y=[2*x,.09,.05],M=[-x,0,0]),t=.06*d[6],u=x-t,"lThigh"===m&&(k="capsule",y=[t,x],v=[90,0,0],M=[0,0,.5*u]),"lShin"===m&&(k="capsule",y=[t,x],v=[90,0,0],M=[0,0,.5*u]),"lFoot"===m&&(k="capsule",y=[.05,x],M=[0,.5*x-.025,.04]),"rThigh"===m&&(k="capsule",y=[t,x],v=[90,0,0],M=[0,0,.5*u]),"rShin"===m&&(k="capsule",y=[t,x],v=[90,0,0],M=[0,0,.5*u]),"rFoot"===m&&(k="capsule",y=[.05,x],M=[0,.5*x-.025,.04]),t=.04,u=x-t,"rEar_0"===m&&(k="capsule",y=[t,x],v=[0,0,90],M=[.5*u,0,0],Ve.push("rEar_0")),"rEar_1"===m&&(k="capsule",y=[t,x],v=[0,0,90],M=[.5*u,0,0],Ve.push("rEar_1")),"rEar_2"===m&&(k="capsule",y=[t,x],v=[0,0,90],M=[.5*u,0,0],Ve.push("rEar_2")),"rEar_3"===m&&(k="capsule",y=[t,x],v=[0,0,90],M=[.5*u,0,0]),"lEar_0"===m&&(k="capsule",y=[t,x],v=[0,0,90],M=[.5*u,0,0],Ve.push("lEar_0")),"lEar_1"===m&&(k="capsule",y=[t,x],v=[0,0,90],M=[.5*u,0,0],Ve.push("lEar_1")),"lEar_2"===m&&(k="capsule",y=[t,x],v=[0,0,90],M=[.5*u,0,0],Ve.push("lEar_2")),"lEar_3"===m&&(k="capsule",y=[t,x],v=[0,0,90],M=[.5*u,0,0]),this.withFinger&&("lHand"===m&&"lMid1"===f&&(k="box",y=[x,.09,.05],M=[.5*x,0,0]),"rHand"===m&&"rMid1"===f&&(k="box",y=[x,.09,.05],M=[.5*-x,0,0]),"rThumb1"===m&&"rThumb2"===f&&(k="capsule",y=[.02,x],v=[0,0,90]),"rThumb2"===m&&"rThumb3"===f&&(k="capsule",y=[.02,x],v=[0,0,90]),"rHand"===m&&"rMid1"===f&&(k="capsule",y=[.02,x],v=[0,0,90],M=[.6*-x,0,0]),"rMid1"===m&&"rMid2"===f&&(k="capsule",y=[.02,x],v=[0,0,90],M=[.6*-x,0,0]),"rMid2"===m&&"rMid3"===f&&(k="capsule",y=[.02,x],v=[0,0,90],M=[.6*-x,0,0])),null!==k){S=this.prefix+"_bone_"+m,c.makeTranslation(M[0],M[1],M[2]),v&&(h.makeRotationFromEuler(n.set(v[0]*w,v[1]*w,v[2]*w)),c.multiply(h)),g.updateWorldMatrix(!0,!1),qe.multiplyMatrices(Oe,g.matrixWorld),o.copy(qe),o.decompose(i,r,s),this.posRef[S]=i.toArray(),"lForeArm"!==m&&"rForeArm"!==m||(De.setFromAxisAngle({x:0,y:1,z:0},-90*w),r.multiply(De)),this.quatRef[S]=r.toArray(),o.multiplyMatrices(qe,c),o.decompose(i,r,s),this.nameList.push(S);let t={name:S,friction:this.friction,restitution:this.restitution,type:k,size:A.scaleArray(y,this.scaler,3),pos:i.toArray(),quat:r.toArray(),kinematic:j,material:"hide",shadow:!1,neverSleep:!0,helper:!0,hcolor:[0,.5,1],hcolor2:[0,.2,1],penetrationVelocity:3,stabilization:.1,damping:[.25,.5],...this.option};if(this.useAggregate)-1!==Ve.indexOf(m)&&(t.aggregate=this.prefix+"__Group",t.aggregateMax=21),t.mask=3;else{let e=3;"lForeArm"!==m&&"rForeArm"!==m&&"lShin"!==m&&"rShin"!==m||(e=35),"rEar_1"!==m&&"rEar_2"!==m&&"rEar_3"!==m&&"lEar_1"!==m&&"lEar_2"!==m&&"lEar_3"!==m||(e=35),"rEar_0"!==m&&"rEar_0"!==m||(e=0),t.group=32,t.mask=e}null!==this.mass?t.mass=z:t.density=1,e.push(t);let l=c.clone().invert().premultiply(a);this.nodes.push({name:S,kinematic:j,motion:E,bone:g,decal:c.clone(),decalinv:l,quat:r.toArray(),pos:i.toArray(),cc:0})}}this.motor.add(e),this.addLink(),this.dispatchEvent({type:"start",message:"go !"}),this.ready=!0}existe(e){return-1!==this.nameList.indexOf(e)}addLink(){let e=[.05,1,0];"PHYSX"===this.motor.engine&&(e=[50,10,0,.5]);let t=2,a=.1,i=1e7,s=!1,r=this.prefix+"_bone_",n=[],o={type:"joint",mode:"d6",lm:[["ry",-180,180,...e],["rz",-180,180,...e]],collision:!1,helperSize:.05,visible:this.showJoint};this.useDrive&&(o.drives=[["rx",t,a,i,s],["ry",t,a,i,s],["rz",t,a,i,s]]);let c=[-.001,.001,100,.2,.5];n.push({...o,b1:r+"hip",b2:r+"abdomen",worldPos:this.posRef[r+"abdomen"],worldQuat:this.quatRef[r+"hip"],lm:[["rx",-20,20,...e],["ry",-20,20,...e],["rz",-20,20,...e]]}),n.push({...o,b1:r+"abdomen",b2:r+"chest",worldPos:this.posRef[r+"chest"],worldQuat:this.quatRef[r+"chest"],lm:[["rx",-20,20,...e],["ry",-20,20,...e],["rz",-20,20,...e]]}),n.push({...o,b1:r+"chest",b2:r+"neck",worldPos:this.posRef[r+"neck"],worldQuat:this.quatRef[r+"neck"],lm:[["rx",0,30,...e],["ry",-1,1,...e],["rz",-30,30,...e]]}),n.push({...o,b1:r+"neck",b2:r+"head",worldPos:this.posRef[r+"head"],worldQuat:this.quatRef[r+"head"],lm:[["rx",0,30,...e],["ry",-1,1,...e],["rz",-30,30,...e]]}),n.push({...o,b1:r+"chest",b2:r+"rCollar",worldPos:this.posRef[r+"rCollar"],worldQuat:this.quatRef[r+"rCollar"],mode:"fixe"}),n.push({...o,b1:r+"chest",b2:r+"lCollar",worldPos:this.posRef[r+"lCollar"],worldQuat:this.quatRef[r+"lCollar"],mode:"fixe"}),n.push({...o,b1:r+"rCollar",b2:r+"rShldr",worldPos:this.posRef[r+"rShldr"],worldQuat:this.quatRef[r+"rShldr"]}),n.push({...o,b1:r+"lCollar",b2:r+"lShldr",worldPos:this.posRef[r+"lShldr"],worldQuat:this.quatRef[r+"lShldr"]}),this.existe(r+"rForeArm")&&n.push({...o,b1:r+"rShldr",b2:r+"rForeArm",worldPos:this.posRef[r+"rForeArm"],worldQuat:this.quatRef[r+"rForeArm"],lm:[["rx",0,160,...e]]}),this.existe(r+"lForeArm")&&n.push({...o,b1:r+"lShldr",b2:r+"lForeArm",worldPos:this.posRef[r+"lForeArm"],worldQuat:this.quatRef[r+"lForeArm"],lm:[["rx",0,160,...e]]}),this.existe(r+"rHand")&&n.push({...o,b1:r+"rForeArm",b2:r+"rHand",worldPos:this.posRef[r+"rHand"],worldQuat:this.quatRef[r+"rHand"],lm:[["rx",0,160,...e],["ry",-10,10,...e]]}),this.existe(r+"lHand")&&n.push({...o,b1:r+"lForeArm",b2:r+"lHand",worldPos:this.posRef[r+"lHand"],worldQuat:this.quatRef[r+"lHand"],lm:[["rx",0,160,...e],["ry",-10,10,...e]]}),n.push({...o,b1:r+"hip",b2:r+"rThigh",worldPos:this.posRef[r+"rThigh"],worldQuat:this.quatRef[r+"rThigh"]}),n.push({...o,b1:r+"hip",b2:r+"lThigh",worldPos:this.posRef[r+"lThigh"],worldQuat:this.quatRef[r+"lThigh"]}),this.existe(r+"rShin")&&n.push({...o,b1:r+"rThigh",b2:r+"rShin",worldPos:this.posRef[r+"rShin"],lm:[["rx",0,160,...e]],worldQuat:this.quatRef[r+"rShin"]}),this.existe(r+"lShin")&&n.push({...o,b1:r+"lThigh",b2:r+"lShin",worldPos:this.posRef[r+"lShin"],lm:[["rx",0,160,...e]],worldQuat:this.quatRef[r+"lShin"]}),this.existe(r+"rFoot")&&n.push({...o,b1:r+"rShin",b2:r+"rFoot",worldPos:this.posRef[r+"rFoot"],lm:[["rx",-10,30,...e],["rz",-10,10,...e]],worldQuat:this.quatRef[r+"rFoot"]}),this.existe(r+"lFoot")&&n.push({...o,b1:r+"lShin",b2:r+"lFoot",worldPos:this.posRef[r+"lFoot"],lm:[["rx",-10,30,...e],["rz",-10,10,...e]],worldQuat:this.quatRef[r+"lFoot"]}),this.breast&&(this.existe(r+"rBreast")&&n.push({...o,b1:r+"chest",b2:r+"rBreast",worldPos:this.posRef[r+"rBreast"],worldQuat:this.quatRef[r+"rBreast"],lm:[["x",...c],["y",...c],["z",...c]]}),this.existe(r+"lBreast")&&n.push({...o,b1:r+"chest",b2:r+"lBreast",worldPos:this.posRef[r+"lBreast"],worldQuat:this.quatRef[r+"lBreast"],lm:[["x",...c],["y",...c],["z",...c]]})),this.existe(r+"lEar_0")&&n.push({...o,b1:r+"head",b2:r+"lEar_0",worldPos:this.posRef[r+"lEar_0"],worldQuat:this.quatRef[r+"lEar_0"],lm:[["rx",-10,30,...e],["rz",-10,10,...e]]}),this.existe(r+"lEar_1")&&n.push({...o,b1:r+"lEar_0",b2:r+"lEar_1",worldPos:this.posRef[r+"lEar_1"],worldQuat:this.quatRef[r+"lEar_1"],lm:[["rx",-10,30,...e],["rz",-10,10,...e]]}),this.existe(r+"lEar_2")&&n.push({...o,b1:r+"lEar_1",b2:r+"lEar_2",worldPos:this.posRef[r+"lEar_2"],worldQuat:this.quatRef[r+"lEar_2"],lm:[["rx",-10,30,...e],["rz",-10,10,...e]]}),this.existe(r+"lEar_3")&&n.push({...o,b1:r+"lEar_2",b2:r+"lEar_3",worldPos:this.posRef[r+"lEar_3"],worldQuat:this.quatRef[r+"lEar_3"],lm:[["rx",-10,30,...e],["rz",-10,10,...e]]}),this.existe(r+"rEar_0")&&n.push({...o,b1:r+"head",b2:r+"rEar_0",worldPos:this.posRef[r+"rEar_0"],worldQuat:this.quatRef[r+"rEar_0"],lm:[["rx",-10,30,...e],["rz",-10,10,...e]]}),this.existe(r+"rEar_1")&&n.push({...o,b1:r+"rEar_0",b2:r+"rEar_1",worldPos:this.posRef[r+"rEar_1"],worldQuat:this.quatRef[r+"rEar_1"],lm:[["rx",-10,30,...e],["rz",-10,10,...e]]}),this.existe(r+"rEar_2")&&n.push({...o,b1:r+"rEar_1",b2:r+"rEar_2",worldPos:this.posRef[r+"rEar_2"],worldQuat:this.quatRef[r+"rEar_2"],lm:[["rx",-10,30,...e],["rz",-10,10,...e]]}),this.existe(r+"rEar_3")&&n.push({...o,b1:r+"rEar_2",b2:r+"rEar_3",worldPos:this.posRef[r+"rEar_3"],worldQuat:this.quatRef[r+"rEar_3"],lm:[["rx",-10,30,...e],["rz",-10,10,...e]]});let h=0;for(let e in n)n[e].name=this.prefix+"_joint_"+h,this.jointList.push(n[e].name),h++;this.motor.add(n)}updateMatrixWorld(e){if(!this.ready)return;let t=[];const a=this.nodes;let i,s,r,n=a.length,o=0;for(;n--;)i=a[o],s=i.bone,o++,i.kinematic?(Be.multiplyMatrices(s.matrixWorld,i.decal),Be.decompose(Ce,De,Le),i.pos=Ce.toArray(),i.quat=De.toArray(),t.push({name:i.name,pos:i.pos,quat:i.quat}),i.motion&&this.freeBone(i)):(r=this.motor.byName(i.name),r&&(Be.copy(r.matrixWorld).multiply(i.decalinv),s.phyMtx.copy(Be),s.isPhysics=!0));0!==t.length&&this.motor.change(t,!0)}dispose(){this.motor.remove(this.jointList),this.motor.remove(this.nameList),this.nodes=[],this.posRef={},this.quatRef={},this.parent.remove(this),this.nameList=[],this.jointList=[]}}var He=function(){var e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};var a,i=WebAssembly.validate(e)?r("b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q:6dkr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;G9Mqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk:183lYud97dur978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnalTmbcuhoaiRbbgrc;WeGc:Ge9hmbarcsGgwce0mbc9:hoalcufadcd4cbawEgDadfgrcKcaawEgqaraq0Egk6mbaicefhxavaialfgmar9Rgoad;8qbbcj;abad9Uc;WFbGcjdadca0EhPdndndnadTmbaoadfhscbhzinaeaz9nmdamax9RaD6miabazad2fhHaxaDfhOaPaeaz9RazaPfae6EgAcsfgocl4cifcd4hCavcj;cbfaoc9WGgXcetfhQavcj;cbfaXci2fhLavcj;cbfaXfhKcbhYaoc;ab6h8AincbhodnawTmbaxaYcd4fRbbhokaocFeGhEcbh3avcj;cbfh5indndndndnaEa3cet4ciGgoc9:fPdebdkamaO9RaX6mwavcj;cbfa3aX2faOaX;8qbbaOaAfhOxdkavcj;cbfa3aX2fcbaX;8kbxekamaO9RaC6moaoclVcbawEhraOaCfhocbhidna8Ambamao9Rc;Gb6mbcbhlina5alfhidndndndndndnaOalco4fRbbgqciGarfPDbedibledibkaipxbbbbbbbbbbbbbbbbpklbxlkaiaopbblaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLg8Ecdp:mea8EpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9og8Fpxiiiiiiiiiiiiiiiip8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngacitc:q1jjbfpbibaac:q:yjjbfRbbgapsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Nghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spklbaaaoclffahc:q:yjjbfRbbfhoxikaiaopbbwaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9og8Fpxssssssssssssssssp8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngacitc:q1jjbfpbibaac:q:yjjbfRbbgapsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Nghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spklbaaaocwffahc:q:yjjbfRbbfhoxdkaiaopbbbpklbaoczfhoxekaiaopbbdaoRbbgacitc:q1jjbfpbibaac:q:yjjbfRbbgapsaoRbeghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPpklbaaaocdffahc:q:yjjbfRbbfhokdndndndndndnaqcd4ciGarfPDbedibledibkaiczfpxbbbbbbbbbbbbbbbbpklbxlkaiczfaopbblaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLg8Ecdp:mea8EpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9og8Fpxiiiiiiiiiiiiiiiip8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngacitc:q1jjbfpbibaac:q:yjjbfRbbgapsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Nghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spklbaaaoclffahc:q:yjjbfRbbfhoxikaiczfaopbbwaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9og8Fpxssssssssssssssssp8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngacitc:q1jjbfpbibaac:q:yjjbfRbbgapsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Nghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spklbaaaocwffahc:q:yjjbfRbbfhoxdkaiczfaopbbbpklbaoczfhoxekaiczfaopbbdaoRbbgacitc:q1jjbfpbibaac:q:yjjbfRbbgapsaoRbeghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPpklbaaaocdffahc:q:yjjbfRbbfhokdndndndndndnaqcl4ciGarfPDbedibledibkaicafpxbbbbbbbbbbbbbbbbpklbxlkaicafaopbblaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLg8Ecdp:mea8EpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9og8Fpxiiiiiiiiiiiiiiiip8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngacitc:q1jjbfpbibaac:q:yjjbfRbbgapsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Nghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spklbaaaoclffahc:q:yjjbfRbbfhoxikaicafaopbbwaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9og8Fpxssssssssssssssssp8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngacitc:q1jjbfpbibaac:q:yjjbfRbbgapsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Nghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spklbaaaocwffahc:q:yjjbfRbbfhoxdkaicafaopbbbpklbaoczfhoxekaicafaopbbdaoRbbgacitc:q1jjbfpbibaac:q:yjjbfRbbgapsaoRbeghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPpklbaaaocdffahc:q:yjjbfRbbfhokdndndndndndnaqco4arfPDbedibledibkaic8Wfpxbbbbbbbbbbbbbbbbpklbxlkaic8Wfaopbblaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLg8Ecdp:mea8EpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9og8Fpxiiiiiiiiiiiiiiiip8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngicitc:q1jjbfpbibaic:q:yjjbfRbbgipsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Ngqcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spklbaiaoclffaqc:q:yjjbfRbbfhoxikaic8Wfaopbbwaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9og8Fpxssssssssssssssssp8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngicitc:q1jjbfpbibaic:q:yjjbfRbbgipsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Ngqcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spklbaiaocwffaqc:q:yjjbfRbbfhoxdkaic8Wfaopbbbpklbaoczfhoxekaic8WfaopbbdaoRbbgicitc:q1jjbfpbibaic:q:yjjbfRbbgipsaoRbegqcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPpklbaiaocdffaqc:q:yjjbfRbbfhokalc;abfhialcjefaX0meaihlamao9Rc;Fb0mbkkdnaiaX9pmbaici4hlinamao9RcK6mwa5aifhqdndndndndndnaOaico4fRbbalcoG4ciGarfPDbedibledibkaqpxbbbbbbbbbbbbbbbbpkbbxlkaqaopbblaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLg8Ecdp:mea8EpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9og8Fpxiiiiiiiiiiiiiiiip8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngacitc:q1jjbfpbibaac:q:yjjbfRbbgapsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Nghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spkbbaaaoclffahc:q:yjjbfRbbfhoxikaqaopbbwaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9og8Fpxssssssssssssssssp8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngacitc:q1jjbfpbibaac:q:yjjbfRbbgapsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Nghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spkbbaaaocwffahc:q:yjjbfRbbfhoxdkaqaopbbbpkbbaoczfhoxekaqaopbbdaoRbbgacitc:q1jjbfpbibaac:q:yjjbfRbbgapsaoRbeghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPpkbbaaaocdffahc:q:yjjbfRbbfhokalcdfhlaiczfgiaX6mbkkaohOaoTmoka5aXfh5a3cefg3cl9hmbkdndndndnawTmbasaYcd4fRbbglciGPlbedwbkaXTmdavcjdfaYfhlavaYfpbdbhgcbhoinalavcj;cbfaofpblbg8JaKaofpblbg8KpmbzeHdOiAlCvXoQrLg8LaQaofpblbg8MaLaofpblbg8NpmbzeHdOiAlCvXoQrLgypmbezHdiOAlvCXorQLg8Ecep9Ta8Epxeeeeeeeeeeeeeeeeg8Fp9op9Hp9rg8Eagp9Uggp9Abbbaladfglaga8Ea8Epmlvorlvorlvorlvorp9Uggp9Abbbaladfglaga8Ea8EpmwDqkwDqkwDqkwDqkp9Uggp9Abbbaladfglaga8Ea8EpmxmPsxmPsxmPsxmPsp9Uggp9Abbbaladfglaga8LaypmwDKYqk8AExm35Ps8E8Fg8Ecep9Ta8Ea8Fp9op9Hp9rg8Ep9Uggp9Abbbaladfglaga8Ea8Epmlvorlvorlvorlvorp9Uggp9Abbbaladfglaga8Ea8EpmwDqkwDqkwDqkwDqkp9Uggp9Abbbaladfglaga8Ea8EpmxmPsxmPsxmPsxmPsp9Uggp9Abbbaladfglaga8Ja8KpmwKDYq8AkEx3m5P8Es8Fg8Ja8Ma8NpmwKDYq8AkEx3m5P8Es8Fg8KpmbezHdiOAlvCXorQLg8Ecep9Ta8Ea8Fp9op9Hp9rg8Ep9Uggp9Abbbaladfglaga8Ea8Epmlvorlvorlvorlvorp9Uggp9Abbbaladfglaga8Ea8EpmwDqkwDqkwDqkwDqkp9Uggp9Abbbaladfglaga8Ea8EpmxmPsxmPsxmPsxmPsp9Uggp9Abbbaladfglaga8Ja8KpmwDKYqk8AExm35Ps8E8Fg8Ecep9Ta8Ea8Fp9op9Hp9rg8Ep9Ug8Fp9Abbbaladfgla8Fa8Ea8Epmlvorlvorlvorlvorp9Ug8Fp9Abbbaladfgla8Fa8Ea8EpmwDqkwDqkwDqkwDqkp9Ug8Fp9Abbbaladfgla8Fa8Ea8EpmxmPsxmPsxmPsxmPsp9Uggp9AbbbaladfhlaoczfgoaX6mbxikkaXTmeavcjdfaYfhlavaYfpbdbhgcbhoinalavcj;cbfaofpblbg8JaKaofpblbg8KpmbzeHdOiAlCvXoQrLg8LaQaofpblbg8MaLaofpblbg8NpmbzeHdOiAlCvXoQrLgypmbezHdiOAlvCXorQLg8Ecep:nea8Epxebebebebebebebebg8Fp9op:bep9rg8Eagp:oeggp9Abbbaladfglaga8Ea8Epmlvorlvorlvorlvorp:oeggp9Abbbaladfglaga8Ea8EpmwDqkwDqkwDqkwDqkp:oeggp9Abbbaladfglaga8Ea8EpmxmPsxmPsxmPsxmPsp:oeggp9Abbbaladfglaga8LaypmwDKYqk8AExm35Ps8E8Fg8Ecep:nea8Ea8Fp9op:bep9rg8Ep:oeggp9Abbbaladfglaga8Ea8Epmlvorlvorlvorlvorp:oeggp9Abbbaladfglaga8Ea8EpmwDqkwDqkwDqkwDqkp:oeggp9Abbbaladfglaga8Ea8EpmxmPsxmPsxmPsxmPsp:oeggp9Abbbaladfglaga8Ja8KpmwKDYq8AkEx3m5P8Es8Fg8Ja8Ma8NpmwKDYq8AkEx3m5P8Es8Fg8KpmbezHdiOAlvCXorQLg8Ecep:nea8Ea8Fp9op:bep9rg8Ep:oeggp9Abbbaladfglaga8Ea8Epmlvorlvorlvorlvorp:oeggp9Abbbaladfglaga8Ea8EpmwDqkwDqkwDqkwDqkp:oeggp9Abbbaladfglaga8Ea8EpmxmPsxmPsxmPsxmPsp:oeggp9Abbbaladfglaga8Ja8KpmwDKYqk8AExm35Ps8E8Fg8Ecep:nea8Ea8Fp9op:bep9rg8Ep:oeg8Fp9Abbbaladfgla8Fa8Ea8Epmlvorlvorlvorlvorp:oeg8Fp9Abbbaladfgla8Fa8Ea8EpmwDqkwDqkwDqkwDqkp:oeg8Fp9Abbbaladfgla8Fa8Ea8EpmxmPsxmPsxmPsxmPsp:oeggp9AbbbaladfhlaoczfgoaX6mbxdkkaXTmbcbhocbalcl4gl9Rc8FGhiavcjdfaYfhravaYfpbdbh8Finaravcj;cbfaofpblbggaKaofpblbg8JpmbzeHdOiAlCvXoQrLg8KaQaofpblbg8LaLaofpblbg8MpmbzeHdOiAlCvXoQrLg8NpmbezHdiOAlvCXorQLg8Eaip:Rea8Ealp:Sep9qg8Ea8Fp9rg8Fp9Abbbaradfgra8Fa8Ea8Epmlvorlvorlvorlvorp9rg8Fp9Abbbaradfgra8Fa8Ea8EpmwDqkwDqkwDqkwDqkp9rg8Fp9Abbbaradfgra8Fa8Ea8EpmxmPsxmPsxmPsxmPsp9rg8Fp9Abbbaradfgra8Fa8Ka8NpmwDKYqk8AExm35Ps8E8Fg8Eaip:Rea8Ealp:Sep9qg8Ep9rg8Fp9Abbbaradfgra8Fa8Ea8Epmlvorlvorlvorlvorp9rg8Fp9Abbbaradfgra8Fa8Ea8EpmwDqkwDqkwDqkwDqkp9rg8Fp9Abbbaradfgra8Fa8Ea8EpmxmPsxmPsxmPsxmPsp9rg8Fp9Abbbaradfgra8Faga8JpmwKDYq8AkEx3m5P8Es8Fgga8La8MpmwKDYq8AkEx3m5P8Es8Fg8JpmbezHdiOAlvCXorQLg8Eaip:Rea8Ealp:Sep9qg8Ep9rg8Fp9Abbbaradfgra8Fa8Ea8Epmlvorlvorlvorlvorp9rg8Fp9Abbbaradfgra8Fa8Ea8EpmwDqkwDqkwDqkwDqkp9rg8Fp9Abbbaradfgra8Fa8Ea8EpmxmPsxmPsxmPsxmPsp9rg8Fp9Abbbaradfgra8Faga8JpmwDKYqk8AExm35Ps8E8Fg8Eaip:Rea8Ealp:Sep9qg8Ep9rg8Fp9Abbbaradfgra8Fa8Ea8Epmlvorlvorlvorlvorp9rg8Fp9Abbbaradfgra8Fa8Ea8EpmwDqkwDqkwDqkwDqkp9rg8Fp9Abbbaradfgra8Fa8Ea8EpmxmPsxmPsxmPsxmPsp9rg8Fp9AbbbaradfhraoczfgoaX6mbkkaYclfgYad6mbkaHavcjdfaAad2;8qbbavavcjdfaAcufad2fad;8qbbaAazfhzc9:hoaOhxaOmbxlkkaeTmbaDalfhrcbhocuhlinaralaD9RglfaD6mdaPaeao9RaoaPfae6Eaofgoae6mbkaial9Rhxkcbc99amax9RakSEhoxekc9:hokavcj;kbf8Kjjjjbaokwbz:bjjjbk:TseHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhldnaeTmbcmcsaDceSEhkcbhxcbhmcbhrcbhicbhoindnalaq9nmbc9:hoxikdndnawRbbgDc;Ve0mbavc;abfaoaDcu7gPcl4fcsGcitfgsydlhzasydbhHdndnaDcsGgsak9pmbavaiaPfcsGcdtfydbaxasEhDaxasTgOfhxxekdndnascsSmbcehOasc987asamffcefhDxekalcefhDal8SbbgscFeGhPdndnascu9mmbaDhlxekalcvfhlaPcFbGhPcrhsdninaD8SbbgOcFbGastaPVhPaOcu9kmeaDcefhDascrfgsc8J9hmbxdkkaDcefhlkcehOaPce4cbaPceG9R7amfhDkaDhmkavc;abfaocitfgsaDBdbasazBdlavaicdtfaDBdbavc;abfaocefcsGcitfgsaHBdbasaDBdlaocdfhoaOaifhidnadcd9hmbabarcetfgsaH87ebasclfaD87ebascdfaz87ebxdkabarcdtfgsaHBdbascwfaDBdbasclfazBdbxekdnaDcpe0mbaxcefgOavaiaqaDcsGfRbbgscl49RcsGcdtfydbascz6gPEhDavaias9RcsGcdtfydbaOaPfgzascsGgOEhsaOThOdndnadcd9hmbabarcetfgHax87ebaHclfas87ebaHcdfaD87ebxekabarcdtfgHaxBdbaHcwfasBdbaHclfaDBdbkavaicdtfaxBdbavc;abfaocitfgHaDBdbaHaxBdlavaicefgicsGcdtfaDBdbavc;abfaocefcsGcitfgHasBdbaHaDBdlavaiaPfgicsGcdtfasBdbavc;abfaocdfcsGcitfgDaxBdbaDasBdlaocifhoaiaOfhiazaOfhxxekaxcbalRbbgHEgAaDc;:eSgDfhzaHcsGhCaHcl4hXdndnaHcs0mbazcefhOxekazhOavaiaX9RcsGcdtfydbhzkdndnaCmbaOcefhxxekaOhxavaiaH9RcsGcdtfydbhOkdndnaDTmbalcefhDxekalcdfhDal8SbegPcFeGhsdnaPcu9kmbalcofhAascFbGhscrhldninaD8SbbgPcFbGaltasVhsaPcu9kmeaDcefhDalcrfglc8J9hmbkaAhDxekaDcefhDkasce4cbasceG9R7amfgmhAkdndnaXcsSmbaDhsxekaDcefhsaD8SbbglcFeGhPdnalcu9kmbaDcvfhzaPcFbGhPcrhldninas8SbbgDcFbGaltaPVhPaDcu9kmeascefhsalcrfglc8J9hmbkazhsxekascefhskaPce4cbaPceG9R7amfgmhzkdndnaCcsSmbashlxekascefhlas8SbbgDcFeGhPdnaDcu9kmbascvfhOaPcFbGhPcrhDdninal8SbbgscFbGaDtaPVhPascu9kmealcefhlaDcrfgDc8J9hmbkaOhlxekalcefhlkaPce4cbaPceG9R7amfgmhOkdndnadcd9hmbabarcetfgDaA87ebaDclfaO87ebaDcdfaz87ebxekabarcdtfgDaABdbaDcwfaOBdbaDclfazBdbkavc;abfaocitfgDazBdbaDaABdlavaicdtfaABdbavc;abfaocefcsGcitfgDaOBdbaDazBdlavaicefgicsGcdtfazBdbavc;abfaocdfcsGcitfgDaABdbaDaOBdlavaiaHcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhiaocifhokawcefhwaocsGhoaicsGhiarcifgrae6mbkkcbc99alaqSEhokavc;aef8Kjjjjbaok:clevu8Jjjjjbcz9Rhvdnaecvfal9nmbc9:skdnaiRbbc;:eGc;qeSmbcuskav9cb83iwaicefhoaialfc98fhrdnaeTmbdnadcdSmbcbhwindnaoar6mbc9:skaocefhlao8SbbgicFeGhddndnaicu9mmbalhoxekaocvfhoadcFbGhdcrhidninal8SbbgDcFbGaitadVhdaDcu9kmealcefhlaicrfgic8J9hmbxdkkalcefhokabawcdtfadc8Etc8F91adcd47avcwfadceGcdtVglydbfgiBdbalaiBdbawcefgwae9hmbxdkkcbhwindnaoar6mbc9:skaocefhlao8SbbgicFeGhddndnaicu9mmbalhoxekaocvfhoadcFbGhdcrhidninal8SbbgDcFbGaitadVhdaDcu9kmealcefhlaicrfgic8J9hmbxdkkalcefhokabawcetfadc8Etc8F91adcd47avcwfadceGcdtVglydbfgi87ebalaiBdbawcefgwae9hmbkkcbc99aoarSEk:SPliuo97eue978Jjjjjbca9Rhiaec98Ghldndnadcl9hmbdnalTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalaeSmeaipxbbbbbbbbbbbbbbbbgqpklbaiabalcdtfgdaeciGglcdtgv;8qbbdnalTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDaqp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkadaiav;8qbbskdnalTmbcbhvabhdinadczfgxaxpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmbediwDqkzHOAKY8AEgwczp:Reczp:Sep;6egraDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;7eawczp:Sep;6egwp;Gearp;Gep;Kep;Legopxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegrpxb;:FSb;:FSb;:FSb;:FSararp;Meaoaop;Meawaqawamp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFFbbFFbbFFbbFFbbp9oaoawp;Meaqp;Keczp:Rep9qgoarawp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogrpmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oaoarpmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgval6mbkkalaeSmbaiczfpxbbbbbbbbbbbbbbbbgopklbaiaopklbaiabalcitfgdaeciGglcitgv;8qbbdnalTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmbediwDqkzHOAKY8AEgwczp:Reczp:Sep;6egraDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;7eawczp:Sep;6egwp;Gearp;Gep;Kep;Legopxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegrpxb;:FSb;:FSb;:FSb;:FSararp;Meaoaop;Meawaqawamp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFFbbFFbbFFbbFFbbp9oaoawp;Meaqp;Keczp:Rep9qgoarawp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogrpmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oaoarpmbezHdiOAlvCXorQLp9qpklbkadaiav;8qbbkk:oDllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaDakp;Mearp;Keamp9oaqakp;Mearp;Keczp:Rep9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalaeSmbaiczfpxbbbbbbbbbbbbbbbbgkpklbaiakpklbaiabalcitfgoaeciGgvcitgw;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaDakp;Mearp;Keamp9oaqakp;Mearp;Keczp:Rep9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkaoaiaw;8qbbkk;uddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbheabhdinadadpbbbgocwp:Recwp:Sep;6eaocep:SepxbbjFbbjFbbjFbbjFp9opxbbjZbbjZbbjZbbjZp:Uep;Mepkbbadczfhdaeclfgeav6mbkkdnavalSmbaic8WfpxbbbbbbbbbbbbbbbbgopklbaicafaopklbaiczfaopklbaiaopklbaiabavcdtfgdalciGgecdtgv;8qbbdnaeTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjFbbjFbbjFbbjFp9opxbbjZbbjZbbjZbbjZp:Uep;Mepklbkadaiav;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz:Dbb"):r("b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:W:Odkr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:S86qdbk;jYi5ud9:du8Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnalTmbcuhoaiRbbgrc;WeGc:Ge9hmbarcsGgwce0mbc9:hoalcufadcd4cbawEgDadfgrcKcaawEgqaraq0Egk6mbaicefhxcj;abad9Uc;WFbGcjdadca0EhmaialfgPar9Rgoadfhsavaoadz1jjjbgzceVhHcbhOdndninaeaO9nmeaPax9RaD6mdamaeaO9RaOamfgoae6EgAcsfglc9WGhCabaOad2fhXaAcethQaxaDfhiaOaeaoaeao6E9RhLalcl4cifcd4hKazcj;cbfaAfhYcbh8AazcjdfhEaHh3incbhodnawTmbaxa8Acd4fRbbhokaocFeGh5cbh8Eazcj;cbfhqinaih8Fdndndndna5a8Ecet4ciGgoc9:fPdebdkaPa8F9RaA6mrazcj;cbfa8EaA2fa8FaAz1jjjb8Aa8FaAfhixdkazcj;cbfa8EaA2fcbaAz:jjjjb8Aa8FhixekaPa8F9RaK6mva8FaKfhidnaCTmbaPai9RcK6mbaocdtc:q1jjbfcj1jjbawEhaczhrcbhlinargoc9Wfghaqfhrdndndndndndnaaa8Fahco4fRbbalcoG4ciGcdtfydbPDbedvivvvlvkar9cb83bbarcwf9cb83bbxlkarcbaiRbdai8Xbb9c:c:qj:bw9:9c:q;c1:I1e:d9c:b:c:e1z9:gg9cjjjjjz:dg8J9qE86bbaqaofgrcGfag9c8F1:NghcKtc8F91aicdfa8J9c8N1:Nfg8KRbbG86bbarcVfcba8KahcjeGcr4fghRbbag9cjjjjjl:dg8J9qE86bbarc7fcbaha8J9c8L1:NfghRbbag9cjjjjjd:dg8J9qE86bbarctfcbaha8J9c8K1:NfghRbbag9cjjjjje:dg8J9qE86bbarc91fcbaha8J9c8J1:NfghRbbag9cjjjj;ab:dg8J9qE86bbarc4fcbaha8J9cg1:NfghRbbag9cjjjja:dg8J9qE86bbarc93fcbaha8J9ch1:NfghRbbag9cjjjjz:dgg9qE86bbarc94fcbahag9ca1:NfghRbbai8Xbe9c:c:qj:bw9:9c:q;c1:I1e:d9c:b:c:e1z9:gg9cjjjjjz:dg8J9qE86bbarc95fag9c8F1:NgicKtc8F91aha8J9c8N1:NfghRbbG86bbarc96fcbahaicjeGcr4fgiRbbag9cjjjjjl:dg8J9qE86bbarc97fcbaia8J9c8L1:NfgiRbbag9cjjjjjd:dg8J9qE86bbarc98fcbaia8J9c8K1:NfgiRbbag9cjjjjje:dg8J9qE86bbarc99fcbaia8J9c8J1:NfgiRbbag9cjjjj;ab:dg8J9qE86bbarc9:fcbaia8J9cg1:NfgiRbbag9cjjjja:dg8J9qE86bbarcufcbaia8J9ch1:NfgiRbbag9cjjjjz:dgg9qE86bbaiag9ca1:NfhixikaraiRblaiRbbghco4g8Ka8KciSg8KE86bbaqaofgrcGfaiclfa8Kfg8KRbbahcl4ciGg8La8LciSg8LE86bbarcVfa8Ka8Lfg8KRbbahcd4ciGg8La8LciSg8LE86bbarc7fa8Ka8Lfg8KRbbahciGghahciSghE86bbarctfa8Kahfg8KRbbaiRbeghco4g8La8LciSg8LE86bbarc91fa8Ka8Lfg8KRbbahcl4ciGg8La8LciSg8LE86bbarc4fa8Ka8Lfg8KRbbahcd4ciGg8La8LciSg8LE86bbarc93fa8Ka8Lfg8KRbbahciGghahciSghE86bbarc94fa8Kahfg8KRbbaiRbdghco4g8La8LciSg8LE86bbarc95fa8Ka8Lfg8KRbbahcl4ciGg8La8LciSg8LE86bbarc96fa8Ka8Lfg8KRbbahcd4ciGg8La8LciSg8LE86bbarc97fa8Ka8Lfg8KRbbahciGghahciSghE86bbarc98fa8KahfghRbbaiRbigico4g8Ka8KciSg8KE86bbarc99faha8KfghRbbaicl4ciGg8Ka8KciSg8KE86bbarc9:faha8KfghRbbaicd4ciGg8Ka8KciSg8KE86bbarcufaha8KfgrRbbaiciGgiaiciSgiE86bbaraifhixdkaraiRbwaiRbbghcl4g8Ka8KcsSg8KE86bbaqaofgrcGfaicwfa8Kfg8KRbbahcsGghahcsSghE86bbarcVfa8KahfghRbbaiRbeg8Kcl4g8La8LcsSg8LE86bbarc7faha8LfghRbba8KcsGg8Ka8KcsSg8KE86bbarctfaha8KfghRbbaiRbdg8Kcl4g8La8LcsSg8LE86bbarc91faha8LfghRbba8KcsGg8Ka8KcsSg8KE86bbarc4faha8KfghRbbaiRbig8Kcl4g8La8LcsSg8LE86bbarc93faha8LfghRbba8KcsGg8Ka8KcsSg8KE86bbarc94faha8KfghRbbaiRblg8Kcl4g8La8LcsSg8LE86bbarc95faha8LfghRbba8KcsGg8Ka8KcsSg8KE86bbarc96faha8KfghRbbaiRbvg8Kcl4g8La8LcsSg8LE86bbarc97faha8LfghRbba8KcsGg8Ka8KcsSg8KE86bbarc98faha8KfghRbbaiRbog8Kcl4g8La8LcsSg8LE86bbarc99faha8LfghRbba8KcsGg8Ka8KcsSg8KE86bbarc9:faha8KfghRbbaiRbrgicl4g8Ka8KcsSg8KE86bbarcufaha8KfgrRbbaicsGgiaicsSgiE86bbaraifhixekarai8Pbb83bbarcwfaicwf8Pbb83bbaiczfhikdnaoaC9pmbalcdfhlaoczfhraPai9RcL0mekkaoaC6moaimexokaCmva8FTmvkaqaAfhqa8Ecefg8Ecl9hmbkdndndndnawTmbasa8Acd4fRbbgociGPlbedrbkaATmdaza8Afh8Fazcj;cbfhhcbh8EaEhaina8FRbbhraahocbhlinaoahalfRbbgqce4cbaqceG9R7arfgr86bbaoadfhoaAalcefgl9hmbkaacefhaa8Fcefh8FahaAfhha8Ecefg8Ecl9hmbxikkaATmeaza8Afhaazcj;cbfhhcbhoceh8EaYh8FinaEaofhlaa8Vbbhrcbhoinala8FaofRbbcwtahaofRbbgqVc;:FiGce4cbaqceG9R7arfgr87bbaladfhlaLaocefgofmbka8FaQfh8FcdhoaacdfhaahaQfhha8EceGhlcbh8EalmbxdkkaATmbcbaocl49Rh8Eaza8AfRbbhqcwhoa3hlinalRbbaotaqVhqalcefhlaocwfgoca9hmbkcbhhaEh8FaYhainazcj;cbfahfRbbhrcwhoaahlinalRbbaotarVhralaAfhlaocwfgoca9hmbkara8E93aq7hqcbhoa8Fhlinalaqao486bbalcefhlaocwfgoca9hmbka8Fadfh8FaacefhaahcefghaA9hmbkkaEclfhEa3clfh3a8Aclfg8Aad6mbkaXazcjdfaAad2z1jjjb8AazazcjdfaAcufad2fadz1jjjb8AaAaOfhOaihxaimbkc9:hoxdkcbc99aPax9RakSEhoxekc9:hokavcj;kbf8Kjjjjbaok:XseHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhldnaeTmbcmcsaDceSEhkcbhxcbhmcbhrcbhicbhoindnalaq9nmbc9:hoxikdndnawRbbgDc;Ve0mbavc;abfaoaDcu7gPcl4fcsGcitfgsydlhzasydbhHdndnaDcsGgsak9pmbavaiaPfcsGcdtfydbaxasEhDaxasTgOfhxxekdndnascsSmbcehOasc987asamffcefhDxekalcefhDal8SbbgscFeGhPdndnascu9mmbaDhlxekalcvfhlaPcFbGhPcrhsdninaD8SbbgOcFbGastaPVhPaOcu9kmeaDcefhDascrfgsc8J9hmbxdkkaDcefhlkcehOaPce4cbaPceG9R7amfhDkaDhmkavc;abfaocitfgsaDBdbasazBdlavaicdtfaDBdbavc;abfaocefcsGcitfgsaHBdbasaDBdlaocdfhoaOaifhidnadcd9hmbabarcetfgsaH87ebasclfaD87ebascdfaz87ebxdkabarcdtfgsaHBdbascwfaDBdbasclfazBdbxekdnaDcpe0mbaxcefgOavaiaqaDcsGfRbbgscl49RcsGcdtfydbascz6gPEhDavaias9RcsGcdtfydbaOaPfgzascsGgOEhsaOThOdndnadcd9hmbabarcetfgHax87ebaHclfas87ebaHcdfaD87ebxekabarcdtfgHaxBdbaHcwfasBdbaHclfaDBdbkavaicdtfaxBdbavc;abfaocitfgHaDBdbaHaxBdlavaicefgicsGcdtfaDBdbavc;abfaocefcsGcitfgHasBdbaHaDBdlavaiaPfgicsGcdtfasBdbavc;abfaocdfcsGcitfgDaxBdbaDasBdlaocifhoaiaOfhiazaOfhxxekaxcbalRbbgHEgAaDc;:eSgDfhzaHcsGhCaHcl4hXdndnaHcs0mbazcefhOxekazhOavaiaX9RcsGcdtfydbhzkdndnaCmbaOcefhxxekaOhxavaiaH9RcsGcdtfydbhOkdndnaDTmbalcefhDxekalcdfhDal8SbegPcFeGhsdnaPcu9kmbalcofhAascFbGhscrhldninaD8SbbgPcFbGaltasVhsaPcu9kmeaDcefhDalcrfglc8J9hmbkaAhDxekaDcefhDkasce4cbasceG9R7amfgmhAkdndnaXcsSmbaDhsxekaDcefhsaD8SbbglcFeGhPdnalcu9kmbaDcvfhzaPcFbGhPcrhldninas8SbbgDcFbGaltaPVhPaDcu9kmeascefhsalcrfglc8J9hmbkazhsxekascefhskaPce4cbaPceG9R7amfgmhzkdndnaCcsSmbashlxekascefhlas8SbbgDcFeGhPdnaDcu9kmbascvfhOaPcFbGhPcrhDdninal8SbbgscFbGaDtaPVhPascu9kmealcefhlaDcrfgDc8J9hmbkaOhlxekalcefhlkaPce4cbaPceG9R7amfgmhOkdndnadcd9hmbabarcetfgDaA87ebaDclfaO87ebaDcdfaz87ebxekabarcdtfgDaABdbaDcwfaOBdbaDclfazBdbkavc;abfaocitfgDazBdbaDaABdlavaicdtfaABdbavc;abfaocefcsGcitfgDaOBdbaDazBdlavaicefgicsGcdtfazBdbavc;abfaocdfcsGcitfgDaABdbaDaOBdlavaiaHcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhiaocifhokawcefhwaocsGhoaicsGhiarcifgrae6mbkkcbc99alaqSEhokavc;aef8Kjjjjbaok:clevu8Jjjjjbcz9Rhvdnaecvfal9nmbc9:skdnaiRbbc;:eGc;qeSmbcuskav9cb83iwaicefhoaialfc98fhrdnaeTmbdnadcdSmbcbhwindnaoar6mbc9:skaocefhlao8SbbgicFeGhddndnaicu9mmbalhoxekaocvfhoadcFbGhdcrhidninal8SbbgDcFbGaitadVhdaDcu9kmealcefhlaicrfgic8J9hmbxdkkalcefhokabawcdtfadc8Etc8F91adcd47avcwfadceGcdtVglydbfgiBdbalaiBdbawcefgwae9hmbxdkkcbhwindnaoar6mbc9:skaocefhlao8SbbgicFeGhddndnaicu9mmbalhoxekaocvfhoadcFbGhdcrhidninal8SbbgDcFbGaitadVhdaDcu9kmealcefhlaicrfgic8J9hmbxdkkalcefhokabawcetfadc8Etc8F91adcd47avcwfadceGcdtVglydbfgi87ebalaiBdbawcefgwae9hmbkkcbc99aoarSEk:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;oiliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabaiavcefciGfcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:OhDxekcjjjj94hDkabaiavciGfgkcd7cetfaD87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:OhDxekcjjjj94hDkabaiavcufciGfcetfaD87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohvxekcjjjj94hvkabakcetfav87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2gdTmbinababydbgecwtcw91:Yaece91cjjj98Gcjjj;8if::NUdbabclfhbadcufgdmbkkk9teiucbcbyd:K1jjbgeabcifc98GfgbBd:K1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;teeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiaeydlBdlaiaeydwBdwaiaeydxBdxaeczfheaiczfhiadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk:3eedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdxaialBdwaialBdlaialBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkk81dbcjwk8Kbbbbdbbblbbbwbbbbbbbebbbdbbblbbbwbbbbc:Kwkl8WNbb"),s=WebAssembly.instantiate(i,{}).then((function(e){(a=e.instance).exports.__wasm_call_ctors()}));function r(e){for(var a=new Uint8Array(e.length),i=0;i<e.length;++i){var s=e.charCodeAt(i);a[i]=s>96?s-97:s>64?s-39:s+4}var r=0;for(i=0;i<e.length;++i)a[r++]=a[i]<60?t[a[i]]:64*(a[i]-60)+a[++i];return a.buffer.slice(0,r)}function n(e,t,a,i,s,r,n){var o=e.exports.sbrk,c=i+3&-4,h=o(c*s),l=o(r.length),b=new Uint8Array(e.exports.memory.buffer);b.set(r,l);var d=t(h,i,s,l,r.length);if(0==d&&n&&n(h,c,s),a.set(b.subarray(h,h+i*s)),o(h-o(0)),0!=d)throw new Error("Malformed buffer data: "+d)}var o={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},c={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},h=[],l=0;function b(e){var t={object:new Worker(e),pending:0,requests:{}};return t.object.onmessage=function(e){var a=e.data;t.pending-=a.count,t.requests[a.id][a.action](a.value),delete t.requests[a.id]},t}function d(e){var t=e.data;if(!t.id)return self.close();self.ready.then((function(e){try{var a=new Uint8Array(t.count*t.size);n(e,e.exports[t.mode],a,t.count,t.size,t.source,e.exports[t.filter]),self.postMessage({id:t.id,count:t.count,action:"resolve",value:a},[a.buffer])}catch(e){self.postMessage({id:t.id,count:t.count,action:"reject",value:e})}}))}return{ready:s,supported:!0,useWorkers:function(e){!function(e){for(var t="self.ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(i)+"]), {}).then(function(result) { result.instance.exports.__wasm_call_ctors(); return result.instance; });self.onmessage = "+d.name+";"+n.toString()+d.toString(),a=new Blob([t],{type:"text/javascript"}),s=URL.createObjectURL(a),r=h.length;r<e;++r)h[r]=b(s);for(r=e;r<h.length;++r)h[r].object.postMessage({});h.length=e,URL.revokeObjectURL(s)}(e)},decodeVertexBuffer:function(e,t,i,s,r){n(a,a.exports.meshopt_decodeVertexBuffer,e,t,i,s,a.exports[o[r]])},decodeIndexBuffer:function(e,t,i,s){n(a,a.exports.meshopt_decodeIndexBuffer,e,t,i,s)},decodeIndexSequence:function(e,t,i,s){n(a,a.exports.meshopt_decodeIndexSequence,e,t,i,s)},decodeGltfBuffer:function(e,t,i,s,r,h){n(a,a.exports[c[r]],e,t,i,s,a.exports[o[h]])},decodeGltfBufferAsync:function(e,t,i,r,b){return h.length>0?function(e,t,a,i,s){for(var r=h[0],n=1;n<h.length;++n)h[n].pending<r.pending&&(r=h[n]);return new Promise((function(n,o){var c=new Uint8Array(a),h=++l;r.pending+=e,r.requests[h]={resolve:n,reject:o},r.object.postMessage({id:h,count:e,size:t,source:c,mode:i,filter:s},[c.buffer])}))}(e,t,i,c[r],o[b]):s.then((function(){var s=new Uint8Array(e*t);return n(a,a.exports[c[r]],s,e,t,i,a.exports[o[b]]),s}))}}}();const _e=new WeakMap;class Ne extends t.Loader{constructor(e){super(e),this.useLocal=!1,this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setUseLocal(e){return this.useLocal=e,this}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,a,i,s){const r=new t.FileLoader(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),console.log(this.withCredentials,this.requestHeader,this.path),r.load(e,(e=>{this.parse(e,a,s)}),i,s)}parse(e,a,i){this.decodeDracoFile(e,a,null,null,t.SRGBColorSpace).catch(i)}decodeDracoFile(e,a,i,s,r=t.LinearSRGBColorSpace){const n={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:r};return this.decodeGeometry(e,n).then(a)}decodeGeometry(e,t){const a=JSON.stringify(t);if(_e.has(e)){const t=_e.get(e);if(t.key===a)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const s=this.workerNextTaskID++,r=e.byteLength,n=this._getWorker(s,r).then((a=>(i=a,new Promise(((a,r)=>{i._callbacks[s]={resolve:a,reject:r},i.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return n.catch((()=>!0)).then((()=>{i&&s&&this._releaseTask(i,s)})),_e.set(e,{key:a,promise:n}),n}_createGeometry(e){const a=new t.BufferGeometry;e.index&&a.setIndex(new t.BufferAttribute(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const s=e.attributes[i],r=s.name,n=s.array,o=s.itemSize,c=new t.BufferAttribute(n,o);"color"===r&&(this._assignVertexColorSpace(c,s.vertexColorSpace),c.normalized=n instanceof Float32Array==!1),a.setAttribute(r,c)}return a}_assignVertexColorSpace(e,a){if(a!==t.SRGBColorSpace)return;const i=new t.Color;for(let t=0,a=e.count;t<a;t++)i.fromBufferAttribute(e,t).convertSRGBToLinear(),e.setXYZ(t,i.r,i.g,i.b)}_loadLibrary(e,a){const i=new t.FileLoader(this.manager);return i.setPath(this.decoderPath),i.setResponseType(a),i.setWithCredentials(this.withCredentials),new Promise(((t,a)=>{i.load(e,t,void 0,a)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=[];return"object"!=typeof WebAssembly||"js"===this.decoderConfig.type?this.useLocal?(this.decoderPath="",e.push(this._loadLibrary(new URL("../build/draco/draco_decoder.js","undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:p&&"SCRIPT"===p.tagName.toUpperCase()&&p.src||new URL("Phy.min.js",document.baseURI).href),"text"))):e.push(this._loadLibrary("draco_decoder.js","text")):this.useLocal?(this.decoderPath="",e.push(this._loadLibrary(new URL("../build/draco/draco_wasm_wrapper.js","undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:p&&"SCRIPT"===p.tagName.toUpperCase()&&p.src||new URL("Phy.min.js",document.baseURI).href),"text"))):e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),this.decoderPending=Promise.all(e).then((e=>{const t=e[0],a=Ue.toString(),i=["/* draco decoder */",t,"","/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const a=t.data;switch(a.type){case"decode":e._callbacks[a.id].resolve(a);break;case"error":e._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const a=this.workerPool[this.workerPool.length-1];return a._taskCosts[e]=t,a._taskLoad+=t,a}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function Ue(){let e,t;function a(e,t,a,i,s,r){const n=r.num_components(),o=a.num_points()*n,c=o*s.BYTES_PER_ELEMENT,h=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,s),l=e._malloc(c);t.GetAttributeDataArrayForAllPoints(a,r,h,c,l);const b=new s(e.HEAPF32.buffer,l,o).slice();return e._free(l),{name:i,array:b,itemSize:n}}onmessage=function(i){const s=i.data;switch(s.type){case"init":e=s.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const i=s.buffer,r=s.taskConfig;t.then((e=>{const t=e.draco,n=new t.Decoder;try{const e=function(e,t,i,s){const r=s.attributeIDs,n=s.attributeTypes;let o,c;const h=t.GetEncodedGeometryType(i);if(h===e.TRIANGULAR_MESH)o=new e.Mesh,c=t.DecodeArrayToMesh(i,i.byteLength,o);else{if(h!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,c=t.DecodeArrayToPointCloud(i,i.byteLength,o)}if(!c.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+c.error_msg());const l={index:null,attributes:[]};for(const i in r){const c=self[n[i]];let h,b;if(s.useUniqueIDs)b=r[i],h=t.GetAttributeByUniqueId(o,b);else{if(b=t.GetAttributeId(o,e[r[i]]),-1===b)continue;h=t.GetAttribute(o,b)}const d=a(e,t,o,i,c,h);"color"===i&&(d.vertexColorSpace=s.vertexColorSpace),l.attributes.push(d)}h===e.TRIANGULAR_MESH&&(l.index=function(e,t,a){const i=a.num_faces(),s=3*i,r=4*s,n=e._malloc(r);t.GetTrianglesUInt32Array(a,r,n);const o=new Uint32Array(e.HEAPF32.buffer,n,s).slice();return e._free(n),{array:o,itemSize:1}}(e,t,o));return e.destroy(o),l}(t,n,new Int8Array(i),r),o=e.attributes.map((e=>e.array.buffer));e.index&&o.push(e.index.array.buffer),self.postMessage({type:"decode",id:s.id,geometry:e},o)}catch(e){console.error(e),self.postMessage({type:"error",id:s.id,error:e.message})}finally{t.destroy(n)}}))}}}let Ke=0;class Je extends u.KTX2Loader{constructor(e){super(e),this.useLocal=!1}setUseLocal(e){return this.useLocal=e,this}_loadLibrary(e,a){const i=new t.FileLoader(this.manager);return i.setPath(this.transcoderPath),i.setResponseType(a),i.setWithCredentials(this.withCredentials),new Promise(((t,a)=>{i.load(e,t,void 0,a)}))}init(){if(!this.transcoderPending){let e,t;this.useLocal?(this.transcoderPath="",e=this._loadLibrary(new URL("../build/basis/basis_transcoder.js","undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:p&&"SCRIPT"===p.tagName.toUpperCase()&&p.src||new URL("Phy.min.js",document.baseURI).href),"text"),t=this._loadLibrary(new URL("../build/basis/basis_transcoder.wasm","undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:p&&"SCRIPT"===p.tagName.toUpperCase()&&p.src||new URL("Phy.min.js",document.baseURI).href),"arraybuffer")):(e=this._loadLibrary("basis_transcoder.js","text"),t=this._loadLibrary("basis_transcoder.wasm","arraybuffer")),this.transcoderPending=Promise.all([e,t]).then((([e,t])=>{const a=Je.BasisWorker.toString(),i=["/* constants */","let _EngineFormat = "+JSON.stringify(Je.EngineFormat),"let _EngineType = "+JSON.stringify(Je.EngineType),"let _TranscoderFormat = "+JSON.stringify(Je.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Je.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i])),this.transcoderBinary=t,this.workerPool.setWorkerCreator((()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e}))})),Ke>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Ke++}return this.transcoderPending}}var We=function(){var e,t=0x10000000000000000,a=4294967295,i=2147483647;function s(e){var t=[];return t[e-1]=void 0,t}function r(e,t){return o(e[0]+t[0],e[1]+t[1])}function n(e,t){var a,i;return e[0]==t[0]&&e[1]==t[1]?0:(a=0>e[1],i=0>t[1],a&&!i?-1:!a&&i?1:function(e,t){return o(e[0]-t[0],e[1]-t[1])}(e,t)[1]<0?-1:1)}function o(e,i){var s,r;for(e%=t,i=(i%=t)-(s=i%D)+(r=Math.floor(e/D)*D),e=e-r+s;0>e;)e+=D,i-=D;for(;e>a;)e-=D,i+=D;for(i%=t;i>0x7fffffff00000000;)i-=t;for(;-0x10000000000000000>i;)i+=t;return[e,i]}function c(e){return e>=0?[e,0]:[e+D,-4294967296]}function h(e){return e[0]>=2147483648?~~Math.max(Math.min(e[0]-D,i),-2147483648):~~Math.max(Math.min(e[0],i),-2147483648)}function l(e){return e.cb>=e.O?-1:255&e.ab[e.cb++]}function b(e){var t=e.ab;return t.length=e.O,t}function d(e,t,i){var s,r,n,o,h="",b=[];for(r=0;5>r;++r){if(-1==(n=l(t)))throw Error("truncated input");b[r]=n<<24>>24}if(!function(e,t){var a,i,s,r,n,o,c;if(5>t.length)return 0;for(c=255&t[0],s=c%9,r=(o=~~(c/9))%5,n=~~(o/5),a=0,i=0;4>i;++i)a+=(255&t[1+i])<<8*i;return a>99999999||!function(e,t,a,i){if(t>8||a>4||i>4)return 0;M(e.k,a,t);var s=1<<i;return w(e.C,s),w(e.o,s),e.P=s-1,1}(e,s,r,n)?0:function(e,t){return 0>t?0:(e.z!=t&&(e.z=t,e.m=Math.max(e.z,1),f(e.b,Math.max(e.m,4096))),1)}(e,a)}(s=x({}),b))throw Error("corrupted input");for(r=0;64>r;r+=8){if(-1==(n=l(t)))throw Error("truncated input");1==(n=n.toString(16)).length&&(n="0"+n),h=n+""+h}/^0+$|^f+$/i.test(h)?e.N=L:(o=parseInt(h,16),e.N=o>a?L:c(o)),e.Q=function(e,t,a,i){return e.a.K=t,g(e.b),e.b.V=a,function(e){e.b.w=0,e.b.D=0,R(e.q),R(e.n),R(e.E),R(e.s),R(e.u),R(e.r),R(e.J),function(e){var t,a;for(a=1<<e.g+e.y,t=0;a>t;++t)R(e.F[t].v)}(e.k);for(var t=0;4>t;++t)R(e.j[t].B);j(e.C),j(e.o),R(e.t.B),function(e){e.p=0,e.i=-1;for(var t=0;5>t;++t)e.p=e.p<<8|l(e.K)}(e.a)}(e),e.f=0,e.l=0,e.T=0,e.R=0,e._=0,e.U=i,e.d=O,e.I=0,function(e,t){return e.h=t,e.bb=null,e.X=1,e}({},e)}(s,t,i,e.N)}function u(e,t){return e.S=function(e){return e.ab=s(32),e.O=0,e}({}),d(e,function(e,t){return e.ab=t,e.cb=0,e.O=t.length,e}({},t),e.S),e}function f(e,t){(null==e.x||e.c!=t)&&(e.x=s(t)),e.c=t,e.D=0,e.w=0}function m(e){var t=e.D-e.w;t&&(function(e,t,a,i){(function(e,t,a,i,s){for(var r=0;s>r;++r)a[i+r]=e[t+r]})(t,a,e.ab,e.O,i),e.O+=i}(e.V,e.x,e.w,t),e.D>=e.c&&(e.D=0),e.w=e.D)}function p(e,t){var a=e.D-t-1;return 0>a&&(a+=e.c),e.x[a]}function g(e){m(e),e.V=null}function y(e){if(!e.X)throw Error("bad state");if(e.bb)throw Error("No encoding");return function(e){var t=function(e){var t,a,i,s,o,l;if(l=h(e.d)&e.P,F(e.a,e.q,(e.f<<4)+l)){if(F(e.a,e.E,e.f))i=0,F(e.a,e.s,e.f)?(F(e.a,e.u,e.f)?(F(e.a,e.r,e.f)?(a=e._,e._=e.R):a=e.R,e.R=e.T):a=e.T,e.T=e.l,e.l=a):F(e.a,e.n,(e.f<<4)+l)||(e.f=7>e.f?9:11,i=1),i||(i=v(e.o,e.a,l)+2,e.f=7>e.f?8:11);else if(e._=e.R,e.R=e.T,e.T=e.l,i=2+v(e.C,e.a,l),e.f=7>e.f?7:10,o=E(e.j[function(e){return 4>(e-=2)?e:3}(i)],e.a),o>=4){if(s=(o>>1)-1,e.l=(2|1&o)<<s,14>o)e.l+=function(e,t,a,i){var s,r,n=1,o=0;for(r=0;i>r;++r)s=F(a,e,t+n),n<<=1,n+=s,o|=s<<r;return o}(e.J,e.l-o-1,e.a,s);else if(e.l+=z(e.a,s-4)<<4,e.l+=function(e,t){var a,i,s=1,r=0;for(i=0;e.A>i;++i)a=F(t,e.B,s),s<<=1,s+=a,r|=a<<i;return r}(e.t,e.a),0>e.l)return-1==e.l?1:-1}else e.l=o;if(n(c(e.l),e.d)>=0||e.l>=e.m)return-1;(function(e,t,a){var i=e.D-t-1;for(0>i&&(i+=e.c);0!=a;--a)i>=e.c&&(i=0),e.x[e.D++]=e.x[i++],e.D>=e.c&&m(e)})(e.b,e.l,i),e.d=r(e.d,c(i)),e.I=p(e.b,0)}else t=function(e,t,a){return e.F[((t&e.Y)<<e.g)+((255&a)>>>8-e.g)]}(e.k,h(e.d),e.I),e.I=7>e.f?function(e,t){var a=1;do{a=a<<1|F(t,e.v,a)}while(256>a);return a<<24>>24}(t,e.a):function(e,t,a){var i,s,r=1;do{if(s=a>>7&1,a<<=1,i=F(t,e.v,(1+s<<8)+r),r=r<<1|i,s!=i){for(;256>r;)r=r<<1|F(t,e.v,r);break}}while(256>r);return r<<24>>24}(t,e.a,p(e.b,e.l)),function(e,t){e.x[e.D++]=t,e.D>=e.c&&m(e)}(e.b,e.I),e.f=function(e){return 4>e?0:10>e?e-3:e-6}(e.f),e.d=r(e.d,q);return 0}(e.h);if(-1==t)throw Error("corrupted input");e.$=L,e.Z=e.h.d,(t||n(e.h.U,O)>=0&&n(e.h.d,e.h.U)>=0)&&(m(e.h.b),g(e.h.b),e.h.a.K=null,e.X=0)}(e),e.X}function x(e){e.b={},e.a={},e.q=s(192),e.E=s(12),e.s=s(12),e.u=s(12),e.r=s(12),e.n=s(192),e.j=s(4),e.J=s(114),e.t=S({},4),e.C=k({}),e.o=k({}),e.k={};for(var t=0;4>t;++t)e.j[t]=S({},6);return e}function w(e,t){for(;t>e.e;++e.e)e.G[e.e]=S({},3),e.H[e.e]=S({},3)}function v(e,t,a){return F(t,e.M,0)?8+(F(t,e.M,1)?8+E(e.L,t):E(e.H[a],t)):E(e.G[a],t)}function k(e){return e.M=s(2),e.G=s(16),e.H=s(16),e.L=S({},8),e.e=0,e}function j(e){R(e.M);for(var t=0;e.e>t;++t)R(e.G[t].B),R(e.H[t].B);R(e.L.B)}function M(e,t,a){var i,r;if(null==e.F||e.g!=a||e.y!=t)for(e.y=t,e.Y=(1<<t)-1,e.g=a,r=1<<e.g+e.y,e.F=s(r),i=0;r>i;++i)e.F[i]=A({})}function A(e){return e.v=s(768),e}function S(e,t){return e.A=t,e.B=s(1<<t),e}function E(e,t){var a,i=1;for(a=e.A;0!=a;--a)i=(i<<1)+F(t,e.B,i);return i-(1<<e.A)}function F(e,t,a){var i,s=t[a];return(-2147483648^(i=(e.i>>>11)*s))>(-2147483648^e.p)?(e.i=i,t[a]=s+(2048-s>>>5)<<16>>16,-16777216&e.i||(e.p=e.p<<8|l(e.K),e.i<<=8),0):(e.i-=i,e.p-=i,t[a]=s-(s>>>5)<<16>>16,-16777216&e.i||(e.p=e.p<<8|l(e.K),e.i<<=8),1)}function z(e,t){var a,i,s=0;for(a=t;0!=a;--a)e.i>>>=1,i=e.p-e.i>>>31,e.p-=e.i&i-1,s=s<<1|1-i,-16777216&e.i||(e.p=e.p<<8|l(e.K),e.i<<=8);return s}function R(e){for(var t=e.length-1;t>=0;--t)e[t]=1024}function P(e){for(var t,a,i,s=0,r=0,n=e.length,o=[],c=[];n>s;++s,++r){if(128&(t=255&e[s]))if(192==(224&t)){if(s+1>=n)return e;if(128!=(192&(a=255&e[++s])))return e;c[r]=(31&t)<<6|63&a}else{if(224!=(240&t))return e;if(s+2>=n)return e;if(128!=(192&(a=255&e[++s])))return e;if(128!=(192&(i=255&e[++s])))return e;c[r]=(15&t)<<12|(63&a)<<6|63&i}else{if(!t)return e;c[r]=t}16383==r&&(o.push(String.fromCharCode.apply(String,c)),r=-1)}return r>0&&(c.length=r,o.push(String.fromCharCode.apply(String,c))),o.join("")}function T(e){return e[1]+e[0]}var I=2,B=3,C="function"==typeof setImmediate?setImmediate:setTimeout,D=4294967296,L=[a,-4294967296],O=[0,0],q=[1,0];return{decompress:function(t,a,i){var s,r,n,o,c={},h=void 0===a&&void 0===i;if("function"!=typeof a&&(r=a,a=i=0),i=i||function(t){return void 0!==r?function(t,a){e({action:B,cbn:a,result:t})}(n?t:-1,r):void 0},a=a||function(t,a){return void 0!==r?e({action:I,cbn:r,result:t,error:a}):void 0},h){for(c.d=u({},t);y(c.d.Q););return P(b(c.d.S))}try{c.d=u({},t),o=T(c.d.N),n=o>-1,i(0)}catch(e){return a(null,e)}C((function e(){try{for(var t,r=0,h=(new Date).getTime();y(c.d.Q);)if(++r%1e3==0&&(new Date).getTime()-h>200)return n&&(s=T(c.d.Q.h.d)/o,i(s)),C(e,0),0;i(1),t=P(b(c.d.S)),C(a.bind(null,t),0)}catch(e){a(null,e)}}),0)}}}();const Xe={decompress:(e,t)=>{We.decompress(new Uint8Array(e),t)}},Qe={getMesh:(e,t)=>{let a={};if(t){const t={},a={};let i;e.traverse((e=>{if(e.isGroup){let i=Qe.groupToMesh(e);i&&(i.applyMatrix4(e.matrix),t[e.name]=e,a[e.name]=i)}}));for(let e in t)i=t[e].parent,i.remove(t[e]),i.add(a[e])}return e.traverse((e=>{e.isMesh&&(a[e.name]=e)})),a},getGroup:(e,t,a)=>{const i={};return e.traverse((e=>{e.isGroup&&(i[e.name]=t?Qe.groupToMesh(e):e)})),i},getMaterial:e=>{const t={};let a,i=[];return e.traverse((e=>{e.isMesh&&(a=e.material,-1===i.indexOf(a.name)&&(i.push(a.name),t[a.name]=a))})),t},groupToMesh:e=>{if(e.children[0].name!==e.name+"_1")return!1;if(!e.children[0].isMesh)return!1;let i=[],s=[],r=e.children.length;for(;r--;)s[r]=e.children[r].material,i[r]=e.children[r].geometry,i[r].group=r;let n=new t.Mesh(new a.mergeGeometries(i,!0),s);return n.name=e.name,n},symetric:e=>{e.isMesh&&(e=e.geometry);let t=e.attributes.uv.array,a=.5*t.length;for(;a--;)t[2*a]<0&&(t[2*a]*=-1);e.attributes.uv.needsUpdate=!0},uv2:e=>{e.isMesh&&(e=e.geometry),e.setAttribute("uv2",e.attributes.uv)},autoMorph:(e,a,i=!0,s=!1)=>{let r,n,o,c,h,l,b,d,u,f,m,p={},g=[];e.traverse((e=>{e.isMesh&&-1!==e.name.search("__M__")&&(p[e.name]=e.geometry,g.push(e))}));for(let e in p)if(r=e.substring(0,e.indexOf("__")),n=e.substring(e.lastIndexOf("__")+2),o=a[r],o)if(h=o.geometry,l=p[e],h.morphTargetsRelative=s,h.attributes.position.count===l.attributes.position.count){if(h.morphAttributes.position||(h.morphAttributes.position=[],i&&(h.morphAttributes.normal=[]),o.morphTargetInfluences=[],o.morphTargetDictionary={}),c=h.morphAttributes.position.length,s){for(b=l.attributes.position.array.length,f=[];b--;)f[b]=l.attributes.position.array[b]-h.attributes.position.array[b];d=new t.Float32BufferAttribute(f,3)}else d=new t.Float32BufferAttribute(l.attributes.position.array,3);h.morphAttributes.position.push(d),i&&(u=new t.Float32BufferAttribute(l.attributes.normal.array,3),h.morphAttributes.normal.push(u)),o.morphTargetInfluences.push(0),o.morphTargetDictionary[n]=c}else console.warn("Morph "+n+" target is no good on "+o.name);for(p={},b=g.length;b--;)m=g[b],m.parent&&m.parent.remove(m),m.material&&m.material.dispose(),m.geometry&&m.geometry.dispose()}},Ye={manager:new t.LoadingManager,renderer:null,msg:"",inLoad:!1,clip:[],data:new Map,tmp:[],lzma:null,dracoLoader:null,dracoPath:"./build/draco/",basisPath:"./build/basis/",useLocal:!1,formatGltf:{draco:!0,ktx2:!1,meshop:!1},setSupport:e=>{for(let t in e)Ye.formatGltf[t]&&(Ye.formatGltf[t]=e[t])},maxAnisotropy:1,onLoad:()=>{},onEnd:()=>{},log:e=>{},materialRoot:e=>{console.log(e)},setLoadEvent:(e,t)=>{Ye.onLoad=e,Ye.onEnd=t},prefix:e=>{let t="";switch(e){case"S":case"sound":case"mp3":case"wav":case"ogg":t="S_";break;case"I":case"image":case"jpg":case"png":t="I_";break;case"E":case"hdr":case"env":case"T":case"texture":t="T_";break;case"J":case"json":t="J_";break;case"JS":case"js":t="JS_";break;case"H":case"bin":case"hex":t="H_";break;case"O":case"object3d":t="O_";break;case"M":case"material":t="M_"}return t},dispose:()=>{Ye.data.forEach((function(e,t){(e.isMaterial||e.isTexture)&&(e.dispose(),Ye.data.delete(t)),e.isObject3D&&(e.traverse((function(e){e.isMesh&&(e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose&&e.material.dispose())})),Ye.data.delete(t))}))},createElementNS:e=>document.createElementNS("http://www.w3.org/1999/xhtml",e),exist:(e,t="")=>!!Ye.get(e,t),delete:(e,t="")=>Ye.data.delete(Ye.prefix(t)+e),get:(e,t="")=>Ye.data.get(Ye.prefix(t)+e),set:(e,t,a="",i)=>{t?(t.isMaterial&&(a="material",t.name=e,Ye.materialRoot(t,i)),t.isTexture&&(a="texture"),t.isObject3D&&(a="object3d"),Ye.get(e,a)||Ye.data.set(Ye.prefix(a)+e,t)):console.log("Loading error on "+e)},getScript:e=>Ye.data.get(Ye.prefix("js")+e),getMaterials:e=>("string"==typeof e&&(e=Ye.get(e,"O")),Qe.getMaterial(e)),getGLB:(e,t)=>("string"==typeof e&&(e=Ye.get(e,"O")),e?(t&&Qe.getMesh(e,t),e):console.error("Not find Model ?")),getMesh:(e,t)=>("string"==typeof e&&(e=Ye.get(e,"O")),e?Qe.getMesh(e,t):console.error("Not find Model ?")),getGroup:(e,t,a)=>("string"==typeof e&&(e=Ye.get(e,"O")),Qe.getGroup(e,t,a)),applyMorph(e,t=null,a=!0,i=!0){let s;s=e.isObject3D?e:Ye.get(e,"O"),t||(t=Ye.getMesh(e)),s&&t&&Qe.autoMorph(s,t,a,i)},uv2(e){Qe.uv2(e)},symetric(e){Qe.symetric(e)},objectSpaceNormal(e){e.material.normalMapType=t.ObjectSpaceNormalMap},add:(e,t,a)=>{Ye.set(e,t,a),Ye.next()},getMaterial:e=>Ye.data.get("M_"+e),texture:(e={})=>{Ye.loaderMap||(Ye.loaderMap=new t.TextureLoader);let a=e.name||"",i=e.format||"";if(e.url&&(-1!==e.url.lastIndexOf(".")?(a=e.url.substring(e.url.lastIndexOf("/")+1,e.url.lastIndexOf(".")),i=e.url.substring(e.url.lastIndexOf(".")+1).toLowerCase()):a=e.url.substring(e.url.lastIndexOf("/")+1)),-1===a.search("_c")&&-1===a.search("_l")&&-1===a.search("_u")&&-1===a.search("_d")||(e.srgb=!0),Ye.exist(a,"texture"))return Ye.get(a,"texture");if(Ye.exist(a,"image"))return Ye.getTexture(a,e);if("ktx2"===i){const i=new t.CompressedTexture;return Ye.data.set("T_"+a,i),Ye.loaderKTX2().load(e.url,(function(t){Ye.setTextureOption(t,e),i.copy(t),t.dispose(),e.callback&&e.callback()})),i}return Ye.loaderMap.load(e.url,(function(t){return Ye.setTextureOption(t,e),Ye.data.set("T_"+a,t),e.callback&&e.callback(),t}))},getTexture:(e,a={})=>{e=(a.quality?a.quality+"k_":"")+e;let i=Ye.get(e,"texture");if(!i){let s=Ye.get(e,"image");if(!s)return null;i=new t.Texture(s),-1===e.search("_c")&&-1===e.search("_d")&&-1===e.search("_l")&&-1===e.search("_u")||(a.srgb=!0),Ye.setTextureOption(i,a),Ye.data.set("T_"+e,i)}return i},setTextureOption:(e,a={})=>{e.colorSpace=a.encoding||a.srgb?t.SRGBColorSpace:t.NoColorSpace,e.flipY=(void 0!==a.flipY||void 0!==a.flip)&&a.flipY,a.anisotropy&&(e.anisotropy="max"===a.anisotropy?Ye.maxAnisotropy:a.anisotropy),void 0!==a.generateMipmaps&&(e.generateMipmaps=a.generateMipmaps),a.repeat&&(e.repeat.fromArray(a.repeat),e.wrapS=e.wrapT=t.RepeatWrapping),a.center&&e.center.fromArray(a.center),a.offset&&e.offset.fromArray(a.offset),a.filter&&"near"===a.filter&&(e.minFilter=t.NearestFilter,e.magFilter=t.NearestFilter),a.channel&&(e.channel=a.channel),e.needsUpdate=!0},loadAsync:(e,t="",a="")=>new Promise(((i,s)=>{Ye.waiting=!0,Ye.load(e,(()=>{Ye.waiting=!1}),t,a)})),load:(e,t,a="",i="",s=0)=>{Ye.msg=i;let r=[],n=t||function(){},o=("undefined"==typeof performance?Date:performance).now();"string"==typeof e||e instanceof String?r.push(e):r=r.concat(e),Ye.tmp.push({urls:r,path:a,callback:n,start:o,quality:s}),Ye.inLoad||Ye.loadOne()},loadOne:()=>{Ye.inLoad=!0,Ye.onLoad();let e=Ye.tmp[0].path+Ye.tmp[0].urls[0],t=e.substring(e.lastIndexOf("/")+1,e.lastIndexOf(".")),a=e.substring(e.lastIndexOf(".")+1).toLowerCase();"jpg"!==a&&"png"!==a||(t=(Ye.tmp[0].quality?Ye.tmp[0].quality+"k_":"")+t),Ye.exist(t,a)?Ye.next():Ye.loading(e,t,a)},next:()=>{Ye.tmp[0].urls.shift(),0===Ye.tmp[0].urls.length?(Math.floor(("undefined"==typeof performance?Date:performance).now()-Ye.tmp[0].start),Ye.tmp[0].callback(),Ye.tmp.shift(),Ye.tmp.length>0?Ye.loadOne():(Ye.inLoad=!1,Ye.clearDRACO(),Ye.clearKTX2(),Ye.onEnd())):Ye.loadOne()},loading:(e,t,a)=>{switch(Ye.log(Ye.msg),a){case"glb":case"gltf":Ye.load_GLTF(e,t);break;case"fbx":case"FBX":Ye.load_FBX(e,t);break;case"obj":Ye.load_OBJ(e,t);break;case"stl":Ye.load_STL(e,t);break;case"ktx2":Ye.load_KTX2(e,t);break;case"hdr":Ye.load_RGBE(e,t);break;case"exr":Ye.load_EXR(e,t);break;default:Ye.extand(e,t,a)}},extand:(e,t,a)=>{Ye.XHTTP||(Ye.XHTTP=new XMLHttpRequest);const i=Ye.XHTTP;switch(i.open("GET",e,!0),"json"===a&&i.overrideMimeType("application/json"),a){case"bin":case"hex":case"wasm":case"mp3":case"wav":case"ogg":i.responseType="arraybuffer";break;case"jpg":case"png":i.responseType="blob";break;case"bvh":case"glsl":case"js":case"json":i.responseType="text"}i.onreadystatechange=function(){4===i.readyState&&(i.status>=300?console.log("Error, status code = "+i.status):Ye.direct(i.response,t,a))},"onprogress"in i&&(i.onprogress=function(e){}),i.send(null)},direct:(e,t,a)=>{switch(a){case"jpg":case"png":let i=Ye.createElementNS("img");i.onload=function(e){window.URL.revokeObjectURL(i.src),Ye.add(t,i,"image")},i.src=window.URL.createObjectURL(e);break;case"mp3":case"wav":case"ogg":AudioContext.getContext().decodeAudioData(e.slice(0),(function(e){Ye.add(t,e,"sound")}),(function(e){console.error("decodeAudioData error",e)}));break;case"hex":case"bin":Xe.decompress(e,(e=>{Ye.add(t,e,a)}));break;case"wasm":Ye.add(t,new Uint8Array(e),a);break;case"json":Ye.add(t,JSON.parse(e),a);break;default:Ye.add(t,e,a)}},clearKTX2:()=>{Ye.KTX2&&(Ye.KTX2.dispose(),Ye.KTX2=null)},clearDRACO:()=>{Ye.dracoLoader&&(Ye.dracoLoader.dispose(),Ye.dracoLoader=null),Ye.GLTF&&(Ye.GLTF=null)},loaderFILE:()=>(Ye.FILE||(Ye.FILE=new t.FileLoader(Ye.manager)),Ye.FILE),loaderDRACO:()=>{if(Ye.dracoLoader)return Ye.dracoLoader;if(!Ye.dracoLoaderType)if(navigator.userAgentData)Ye.dracoLoaderType="wasm";else{let e=navigator.userAgent.toLowerCase();Ye.dracoLoaderType=-1!==e.indexOf("safari")&&-1===e.indexOf("chrome")?"js":"wasm"}return Ye.dracoLoader=(new Ne).setDecoderConfig({type:Ye.dracoLoaderType}).setDecoderPath(Ye.dracoPath).setUseLocal(Ye.useLocal),Ye.dracoLoader},loaderKTX2:()=>(Ye.KTX2||(Ye.KTX2=new Je(Ye.manager).setTranscoderPath(Ye.basisPath).detectSupport(Ye.renderer).setUseLocal(Ye.useLocal)),Ye.KTX2),loaderGLTF:()=>(Ye.GLTF||(Ye.GLTF=new r.GLTFLoader(Ye.manager).setCrossOrigin("anonymous"),Ye.formatGltf.draco&&Ye.GLTF.setDRACOLoader(Ye.loaderDRACO()),Ye.formatGltf.ktx2&&Ye.GLTF.setKTX2Loader(Ye.loaderKTX2()),Ye.formatGltf.meshop&&Ye.GLTF.setMeshoptDecoder(He)),Ye.GLTF),loaderFBX:()=>(Ye.FBX||(Ye.FBX=new n.FBXLoader(Ye.manager)),Ye.FBX),loaderSTL:()=>(Ye.STL||(Ye.STL=new h.STLLoader(Ye.manager)),Ye.STL),loaderOBJ:()=>(Ye.OBJ||(Ye.OBJ=new c.OBJLoader(Ye.manager)),Ye.OBJ),loaderRGBE:()=>(Ye.RGBE||(Ye.RGBE=new l.HDRLoader(Ye.manager)),Ye.RGBE),loaderEXR:()=>(Ye.EXR||(Ye.EXR=new b.EXRLoader(Ye.manager)),Ye.EXR),loaderUltra:()=>(Ye.ULTRA||(Ye.ULTRA=new d.UltraHDRLoader(Ye.manager).setDataType(THREE.HalfFloatType)),Ye.ULTRA),load_GLTF:(e,a)=>{Ye.loaderGLTF().load(e,(function(e){const i=e.scene;if(e.animations){const a=e.animations,s=new t.AnimationMixer(e.scene);i.mixer=s,i.actions={};for(let e=0;e<a.length;e++){let t=a[e];i.actions[t.name]=s.clipAction(t)}i.play=e=>{i.actions[e]&&(i.actions[e].paused=!1,i.actions[e].time=0,i.actions[e].play())},i.pause=(e,t=!0)=>{i.actions[e]&&(i.actions[e].paused=t)}}Ye.add(a,i)}))},load_FBX:(e,t)=>{Ye.loaderFBX().load(e,(function(e){Ye.add(t,e)}))},load_OBJ:(e,t)=>{Ye.loaderOBJ().load(e,(function(e){Ye.add(t,e)}))},load_STL:(e,a)=>{Ye.loaderSTL().load(e,(function(e){let i=new t.Mesh(e);Ye.add(a,i)}))},load_KTX2:(e,t,a)=>{Ye.loaderKTX2().load(e,(function(e){return Ye.add(t,e),e}))},load_RGBE:(e,a)=>{Ye.loaderRGBE().load(e,(function(e){e.mapping=t.EquirectangularReflectionMapping,Ye.add(a,e)}))},load_EXR:(e,t,a)=>{Ye.loaderEXR().load(e,(function(e){return a&&a(e),e}))},direct_EXR:(e,t)=>{Ye.loaderEXR().parse(url,(function(e){return Ye.add(t,e),e}))}};class Ze{constructor(e,a){this.target=a||e,this.baseGeometry=e.geometry,this.geometry=this.target.geometry,this.V=[new t.Vector3,new t.Vector3,new t.Vector3],this.X=[new t.Vector4,new t.Vector4,new t.Matrix4],this.M=[new t.Vector3,new t.Vector3,new t.Vector3],this.isMorph=!!this.target.morphTargetInfluences,this.isSkin=!!this.target.isSkinnedMesh,this.init()}init(){this.geometry.attributes.position.count===this.baseGeometry.attributes.position.count?(this.length=this.baseGeometry.attributes.position.count,this.indexLength=this.baseGeometry.index.count/3,this.originEdges=new Array(this.length).fill(0),this.targetEdges=new Array(this.length).fill(0),(this.isSkin||this.isMorph)&&(this.back=new Array(3*this.length).fill(0)),this.num=new Array(this.length).fill(0),this.getEdge(this.baseGeometry,this.originEdges),this.addColor(),setTimeout(this.start.bind(this),100)):console.log("object not have same number of vertices !!")}start(){this.ready=!0,this.update()}addColor(){const e=this.geometry;let a=e.attributes.position.array.length;e.setAttribute("color",new t.Float32BufferAttribute(new Array(a).fill(0),3))}resetEdge(e){let t=e.length;for(;t--;)e[t]=0}getEdge(e,t,a=!1,i=!1){let s=e.attributes.position.array;const r=e.index.array;let n,o,c,h,l,b,d,u=this.V[0],f=this.V[1],m=this.V[2],p=0;for(i&&(s=this.getMorph()),a&&(s=this.getSkinned(s)),(a||i)&&this.resetEdge(t),n=this.indexLength;n--;)o=r[p],c=r[p+1],h=r[p+2],u.fromArray(s,3*o),f.fromArray(s,3*c),m.fromArray(s,3*h),l=u.distanceTo(f),b=u.distanceTo(m),d=f.distanceTo(m),t[o]+=.5*(l+b),t[c]+=.5*(l+d),t[h]+=.5*(b+d),p+=3}isZero(e){return 0===e.x&&0===e.y&&0===e.z}getMorph(){const e=this.target.morphTargetInfluences,t=this.geometry.morphAttributes.position,a=e.length,i=this.geometry.attributes.position.array;let s,r,n,o,c=this.geometry.attributes.position.count,h=this.M[0],l=this.M[1],b=this.M[2],d=this.geometry.morphTargetsRelative;for(r=c;r--;){for(s=3*r,l.fromArray(i,s),h.set(0,0,0),n=a;n--;)0!=e[n]&&(o=t[n].data?t[n].data.array:t[n].array,d?h.addScaledVector(b.fromArray(o,s),e[n]):h.addScaledVector(b.fromArray(o,s).sub(l),e[n]));l.add(h),l.toArray(this.back,s)}return this.back}getSkinned(e){const t=this.target.skeleton;t.boneMatrices;const a=this.geometry,i=a.attributes.skinIndex.array,s=a.attributes.skinWeight.array,r=this.target.bindMatrix,n=this.target.bindMatrixInverse;let o,c,h,l,b,d=this.V[0],u=this.V[1],f=this.V[2],m=this.X[0],p=this.X[1],g=this.X[2];for(o=a.attributes.position.count;o--;){for(b=3*o,m.fromArray(i,4*o),p.fromArray(s,4*o),d.fromArray(e,b).applyMatrix4(r),u.set(0,0,0),c=4;c--;)l=p.getComponent(c),l>0&&(h=m.getComponent(c),g.multiplyMatrices(t.bones[h].matrixWorld,t.boneInverses[h]),u.addScaledVector(f.copy(d).applyMatrix4(g),l));u.applyMatrix4(n),u.toArray(this.back,b)}return this.back}update(){if(!this.ready)return;this.getEdge(this.geometry,this.targetEdges,this.isSkin,this.isMorph);const e=this.geometry.attributes.color.array;let t,a,i,s=this.length;for(;s--;)t=this.originEdges[s],a=(t-this.targetEdges[s])/t+.5,i=3*s,e[i]=a>.5?2*(a-.5):0,e[i+1]=0,e[i+2]=a<.5?1-2*a:0;this.geometry.attributes.color.needsUpdate=!0}}class $e extends t.Object3D{constructor(e,a){super(),this.isReady=!1,this.skeleton=a,this.bones=this.skeleton.bones,this.root=e,this.box=new t.BoxGeometry,this.mtxr=new t.Matrix4,this.mtx0=new t.Matrix4,this.mtx1=new t.Matrix4,this.mtx=new t.Matrix4,this.mtx2=new t.Matrix4,this.p=new t.Vector3,this.s=new t.Vector3,this.q=new t.Quaternion,this.e=new t.Euler,this.mat=new t.MeshBasicMaterial({color:13421696,wireframe:!0,toneMapped:!1}),this.init(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){if(!this.isReady)return;let t,a,i=this.children,s=i.length;for(this.mtxr.copy(this.root.matrixWorld).invert();s--;)t=i[s],a=t.userData.bone,this.mtx0.multiplyMatrices(this.mtxr,a.matrixWorld),this.mtx.multiplyMatrices(this.mtx0,t.userData.decal),this.mtx.decompose(this.p,this.q,this.s),t.position.copy(this.p),t.quaternion.copy(this.q),t.updateMatrix();super.updateMatrixWorld(e)}init(){this.mtxr.copy(this.root.matrixWorld).invert();const e=this.bones;let a,i,s,r,n,o,c,h,l,b,d,u=new t.Vector3,f=new t.Vector3,m=e.length;for(a=0;a<m;a++)h=null,r=e[a],i=r.name,n=r.parent,n&&(s=n.name,u.setFromMatrixPosition(n.matrixWorld),f.setFromMatrixPosition(r.matrixWorld),c=u.distanceTo(f),l=[0,0,.5*c],o=[c,1,1],b=[0,0,0],d="_C","head"===s&&"End_head"===i&&(h="box",o=[.16,.2,c],l=[0,.025,.5*-c]),"chest"===s&&"neck"===i&&(h="box",o=[.3,.28,c],l=[0,0,.5*-c]),"abdomen"===s&&(h="box",o=[.28,.24,c+.14],b[2]=0,l=[0,0,.5*-c],l[2]+=.07),"rThigh"===s&&(h="box",o=[.15,.15,c]),"lThigh"===s&&(h="box",o=[.15,.15,c]),"rShin"===s&&(h="box",o=[.12,.12,c+.1],l[2]+=.05),"lShin"===s&&(h="box",o=[.12,.12,c+.1],l[2]+=.05),"rShldr"===s&&(h="box",o=[c+.06,.12,.12],l[0]=.03-l[2],l[2]=0),"lShldr"===s&&(h="box",o=[c+.06,.12,.12],l[0]=l[2]-.03,l[2]=0),"rForeArm"===s&&(h="box",o=[c+.1,.1,.1],l[0]=-l[2]-.05,l[2]=0),"lForeArm"===s&&(h="box",o=[c+.1,.1,.1],l[0]=l[2]+.05,l[2]=0),null!==h&&this.addMesh(n,h,o,l,b,"_C"));this.isReady=!0}addMesh(e,a,i,s,r,n){this.mtx.makeTranslation(s[0],s[1],s[2]);var o=new t.Mesh(this.box,this.mat);o.scale.fromArray(i),o.userData.decal=this.mtx.clone(),o.userData.bone=e,o.userData.size=i,this.add(o)}dispose(){this.children=[],this.box.dispose(),this.mat.dispose(),this.isReady=!1}}const et={mixRatio:0,threshold:.1,normal:.25,hair:7675906,bow:1049602,sheen:1,sheenRoughness:.6,metalness:.6,roughness:.4,vertexColors:!1,alphaTest:.1,h_metal:0,h_rough:.5,clearcoat:1,wireframe:!1,transparent:!1,opacity:1},tt={refSize:1.81,isBreath:!1,isEyeMove:!1,haveHair:!0,haveBlink:!0,haveMorph:!0,morphNormal:!1,morphRelative:!1,haveLOD:!0,levelHigh:["body","Head","crane","eyelash","eyebrow","tear","eye_l","eye_r","eye_l_s","eye_r_s"],levelHair:["hair","hair_man"],levelLow:["body_low"],skeletonRef:"body",fullMorph:["MUSCLE","LOW","BIG","MONSTER"],textureQuality:2,textureRef:"avatar_c",texturePath:"assets/textures/avatar_",textures:["avatar_c.jpg","avatar_n.jpg","avatar_t.jpg","mouth_c.jpg","mouth_a.jpg","mouth_n.jpg","eye_c.jpg","eye_n.jpg","hair.jpg","hair_a.jpg","eyelash_c.jpg","eyelash_a.jpg","eyelash_n.jpg","hair_man.jpg","hair_man_a.jpg","avatar_ao.jpg"],modelPath:"assets/models/avatar/",forceModel:null,setting:et,materialRef:"skin",materials:{skin:{type:"Sss",map:"avatar_c",normalMap:"avatar_n",reflectivity:.2,roughness:.54,metalness:.14,normalScale:new t.Vector2(et.normal,-et.normal),sheenColor:6291456,sheen:et.sheen,sheenRoughness:et.sheenRoughness,wireframe:et.wireframe,aoMap:"avatar_ao",aoMapIntensity:1,vertexColors:!1,sssMap:"avatar_t",sssColor:new t.Color(15606563),sssAmbient:.5,sssDistortion:.6,sssAttenuation:.1,sssScale:6},mouth:{type:"Standard",map:"mouth_c",roughness:.02,metalness:0,vertexColors:!1,alphaMap:"mouth_a",alphaTest:.5,normalMap:"mouth_n",normalScale:new t.Vector2(.5,-.5)},sub_eye:{type:"Physical",roughness:0,metalness:1,ior:1.376,opacity:.1,clearcoat:1,transparent:!0},eye:{type:"Physical",map:"eye_c",roughness:.7,metalness:.15,normalMap:"eye_n",normalScale:new t.Vector2(2,-2),clearcoat:.25},hair:{type:"Standard",color:et.hair,aoMap:"hair",metalnessMap:"hair",roughness:.6,metalness:1,alphaMap:"hair_a",side:t.DoubleSide,shadowSide:t.DoubleSide,emissive:et.hair,emissiveIntensity:.5,transparent:!0,blending:t.CustomBlending,blendDst:t.ZeroFactor,blendDstAlpha:t.SrcAlphaFactor,alphaToCoverage:!0},hair_man:{type:"Standard",color:et.hair,aoMap:"hair_man",metalnessMap:"hair_man",roughness:.6,metalness:1,alphaMap:"hair_man_a",side:t.DoubleSide,transparent:!0,blending:t.CustomBlending,blendDst:t.ZeroFactor,blendDstAlpha:t.SrcAlphaFactor,forceSinglePass:!0,alphaToCoverage:!0},eyelash:{type:"Standard",color:et.hair,map:"eyelash_c",alphaMap:"eyelash_a",transparent:!0,opacity:1,side:t.DoubleSide,alphaToCoverage:!0,polygonOffset:!0,polygonOffsetFactor:-4},tear:{type:"Standard",map:"eyelash_c",roughness:0,metalness:1,alphaMap:"eyelash_a",transparent:!0,alphaToCoverage:!0,opacity:1},low:{type:"Basic"}},changeMaterial:(e={},t=!1)=>{if(!Ye.getMaterial(tt.materialRef))return;const a=tt.setting,i=tt.materials;let s,r=!1;for(let t in e)void 0!==a[t]&&a[t]!==e[t]&&(a[t]=e[t],r=!0);if(r)for(let a in i){s=Ye.getMaterial(a);for(let r in e)void 0!==s[r]&&(t&&i[a][r]?s[r]=i[a][r]:s[r]=e[r])}},applyMaterial:(e,t)=>{const a=!0,i=Ye.getMaterial("skin");//!Human.haveLOD;
e.traverse((e=>{if(e.isMesh)switch(e.name){case"body":case"Head":e.material=i,e.receiveShadow=!0,e.castShadow=!0,e.visible=a;break;case"body_low":e.material=i,e.receiveShadow=!0,e.castShadow=!0,e.visible=!1;break;case"crane":e.material=i,e.receiveShadow=!0,e.castShadow=!1,e.visible=!tt.haveHair;break;case"mouth":e.material=Ye.getMaterial("mouth")||i,e.receiveShadow=!0,e.castShadow=!1,e.visible=a,e.geometry.computeVertexNormals();break;case"eyelash":case"eyebrow":e.material=Ye.getMaterial("eyelash")||i,e.receiveShadow=!1,e.castShadow=!1,e.visible=a;break;case"tear":e.material=Ye.getMaterial("tear")||i,e.receiveShadow=!1,e.castShadow=!1,e.visible=a;break;case"eye_l":case"eye_r":e.material=Ye.getMaterial("eye")||i,e.receiveShadow=!1,e.castShadow=!1;break;case"eye_l_s":case"eye_r_s":e.material=Ye.getMaterial("sub_eye")||i,e.receiveShadow=!1,e.castShadow=!1,e.visible=a;break;case"hair":e.material=Ye.getMaterial("hair")||i,e.receiveShadow=!1,e.castShadow=!0,e.visible=!!tt.haveHair&&a;break;case"hair_man":e.material=Ye.getMaterial("hair_man")||i,e.receiveShadow=!1,e.castShadow=!1,e.visible=!!tt.haveHair&&a}}))},adjustment:()=>[{name:"neck",values:[-5,0,0]},{name:"chest",values:[5,0,0]},{name:"lCollar",values:[0,0,-10]},{name:"rCollar",values:[0,0,10]},{name:"lShldr",values:[-20,2,5]},{name:"rShldr",values:[-20,-2,-5]},{name:"lForeArm",values:[0,0,10]},{name:"rForeArm",values:[0,0,-10]},{name:"lHand",values:[0,15,10]},{name:"rHand",values:[0,-15,-10]},{name:"lThumb2",values:[0,25,10]},{name:"rThumb2",values:[0,-25,-10]}]},at={wireframe:!1,normal:.25,hair:2433041},it={isBreath:!1,isEyeMove:!1,haveMorph:!0,skeletonRef:"body_low",fullMorph:["MUSCLE","LOW","BIG","MONSTER"],textureRef:"avatar_c_0k",texturePath:"assets/textures/avatar/",textures:["avatar_c_0k.jpg","avatar_n_0k.jpg","avatar_ao_0k.jpg","hair_man_a_0k.jpg","Hair_01_c.png","Hair_01_n.png"],modelPath:"assets/models/avatar/",forceModel:null,setting:at,materialRef:"skin_low",materials:{skin_low:{type:"Standard",map:"avatar_c_0k",aoMap:"avatar_ao_0k",normalMap:"avatar_n_0k",normalScale:new t.Vector2(at.normal,-at.normal),envMapIntensity:.3,roughness:.22,metalness:0,vertexColors:!1},hair_low:{type:"Standard",color:at.hair,alphaMap:"hair_man_a_0k",transparent:!0},hair_low_2:{type:"Standard",color:at.hair,map:"Hair_01_c",normalMap:"Hair_01_n"}},changeMaterial:(e={},t=!1)=>{if(!Ye.getMaterial(it.materialRef))return;const a=Lee.materials;let i;for(let s in a){i=Ye.getMaterial(s);for(let r in e)void 0!==i[r]&&(t&&a[s][r]?i[r]=a[s][r]:i[r]=e[r])}},applyMaterial:(e,t)=>{const a=Ye.getMaterial(it.materialRef);e.traverse((e=>{if(e.isMesh)switch(e.name){case"body_low":e.material=a,e.receiveShadow=!0,e.castShadow=!0;break;case"hair_low":e.material=Ye.getMaterial("hair_low")||a,e.receiveShadow=!1,e.castShadow=!1;break;case"hair_low_2":e.material=Ye.getMaterial("hair_low_2")||a,e.receiveShadow=!1,e.castShadow=!1}}))},adjustment:()=>[{name:"neck",values:[-5,0,0]},{name:"chest",values:[5,0,0]},{name:"lCollar",values:[0,0,-10]},{name:"rCollar",values:[0,0,10]},{name:"lShldr",values:[-20,2,0]},{name:"rShldr",values:[-20,-2,0]}]},st={metalness:.33,roughness:.11,clearcoat:0,wireframe:!1},rt={decalY:.02,isBreath:!1,isEyeMove:!1,haveMorph:!1,skeletonRef:"eva_SKIN",fullMorph:[],haveQuality:!1,skinRef:"eva_00",texturePath:"assets/textures/eva/",textures:["eva00_c.jpg","eva01_c.jpg","eva02_c.jpg","eva_l.jpg","eva_ao.jpg"],modelPath:"assets/models/",forceModel:"eva",setting:st,materialRef:"eva00",materials:{eva00:{type:"Physical",map:"eva00_c",emissiveMap:"eva_l",emissive:16777215,roughness:st.roughness,metalness:st.metalness,wireframe:st.wireframe,clearcoat:st.clearcoat,aoMap:"eva_ao"},eva01:{type:"Physical",map:"eva01_c",emissiveMap:"eva_l",emissive:16777215,roughness:st.roughness,metalness:st.metalness,wireframe:st.wireframe,clearcoat:st.clearcoat,aoMap:"eva_ao"},eva02:{type:"Physical",map:"eva02_c",emissiveMap:"eva_l",emissive:16777215,roughness:st.roughness,metalness:st.metalness,wireframe:st.wireframe,clearcoat:st.clearcoat,aoMap:"eva_ao"}},changeMaterial:(e,t=!1)=>{if(!Ye.getMaterial(rt.materialRef))return;const a=rt.materials;let i;for(let s in a){i=Ye.getMaterial(s);for(let r in e)void 0!==i[r]&&(t&&a[s][r]?i[r]=a[s][r]:i[r]=e[r]);i.needsUpdate=!0}},applyMaterial:(e,t)=>{const a=Ye.getMaterial(t);e.traverse((e=>{if(e.isMesh)switch(e.material=a,e.receiveShadow=!0,e.castShadow=!0,e.name){case"eva_2_head":case"eva_2_mach":e.visible="eva02"===t;break;case"eva_L_COLLAR":case"eva_R_COLLAR":e.visible="eva00"!==t;break;case"eva_HEAD":case"eva_MACHOIR":e.visible="eva01"===t;break;case"eva_0_R_COLLAR":case"eva_0_L_COLLAR":case"eva_0_head":case"eva_0_head2":e.visible="eva00"===t;break;case"eva_0_CHEST2":e.visible="eva01"!==t}}))}},nt={metalness:.2,roughness:.8,wireframe:!1},ot={decalY:-.06,isBreath:!1,isEyeMove:!1,haveMorph:!1,skeletonRef:"leeSkin",fullMorph:[],haveQuality:!1,texturePath:"assets/textures/",textures:["lee_c.jpg","lee_ao.jpg"],modelPath:"assets/models/",forceModel:"lee",setting:nt,materialRef:"lee_material",materials:{lee_material:{type:"Physical",map:"lee_c",roughness:.3,metalness:.08,wireframe:nt.wireframe,sheen:2.2,sheenColorMap:"lee_c",sheenColor:16777215,sheenRoughness:.4,envMapIntensity:1}},changeMaterial:(e,t=!1)=>{if(!Ye.getMaterial(ot.materialRef))return;const a=ot.materials;let i;for(let s in a){i=Ye.getMaterial(s);for(let r in e)void 0!==i[r]&&(t&&a[s][r]?i[r]=a[s][r]:i[r]=e[r])}},applyMaterial:(e,t)=>{const a=Ye.getMaterial("lee_material");e.traverse((e=>{e.isMesh&&(e.material=a,e.receiveShadow=!0,e.castShadow=!0)}))},adjustment:()=>[{name:"lHand",values:[-60,0,0]},{name:"rHand",values:[-60,0,0]}]},ct={metalness:.2,roughness:.8,wireframe:!1},ht={decalY:-.06,isBreath:!1,isEyeMove:!1,haveMorph:!1,skeletonRef:"barbados",multyMaterial:!0,fullMorph:[],haveQuality:!1,texturePath:"assets/textures/",textures:[],modelPath:"assets/models/",forceModel:"barbados",setting:ct,materialRef:"bb",materials:{bb:{type:"Physical",roughness:.3,metalness:.08,wireframe:ct.wireframe,sheen:2.2,sheenColor:16777215,sheenRoughness:.4,envMapIntensity:1}},changeMaterial:(e,t=!1)=>{},applyMaterial:(e,t)=>{},adjustment:()=>[]},lt=1/30,bt=Math.PI/180,dt=180/Math.PI,ut=new t.Vector3,ft={tmp:[],model:[],avatar:null,callback:()=>{},add:(e,t)=>{ft.tmp=[...e],ft.callback=t,ft.tmp.length&&ft.loadOne()},loadOne:()=>{let e=ft.tmp[0];ft.avatar=new mt({type:e,callback:ft.next,morph:!0,isPreload:!0})},next:e=>{ft.avatar.dispose(),ft.tmp.shift(),0===ft.tmp.length?ft.callback():ft.loadOne()}};class mt extends t.Group{constructor(e={}){switch(super(),this.isPreload=e.isPreload||!1,this.fixWeight=void 0===e.fixWeight||e.fixWeight,this.rootPath=e.path||"./",this.lzmaPath=this.rootPath+"src/libs/lzma_worker.js",this.callback=e.callback||function(){},this.matrixAutoUpdate=!1,this.isPause=!0,this.randomMorph=e.randomMorph||!1,this.randomSize=e.randomSize||!1,this.actionPose=null,this.model=e.type||"man",this.startAnimation=e.anim||"idle",this.bodyMorph=[0,0],this.faceMorph=[0,0],this.ref=null,this.model){case"barbados":this.ref=ht;break;case"lee":this.ref=ot;break;case"man":case"woman":this.ref=tt;break;case"man_low":case"woman_low":this.ref=it;break;case"eva00":case"eva01":case"eva02":this.ref=rt}this.compact=void 0===e.compact||e.compact,this.haveMorph=void 0!==e.morph&&e.morph,this.fullMaterial=void 0===e.material||e.material,this.size=e.size||1,this.realSize=0,this.baseSize=0,this.fullMorph=this.ref.fullMorph||[],this.randomMorph&&this.fullMorph.length&&(this.haveMorph=!0),this.textureQuality=this.ref.textureQuality||0,this.skeleton=null,this.mixer=null,this.mesh={},this.bones={},this.done=!1,this.isClone=!1,this.isBreath=this.ref.isBreath||!1,this.isEyeMove=this.ref.isEyeMove||!1,this.haveBlink=this.ref.haveBlink||!1,this.haveLOD=this.ref.haveLOD||!1,e.noLOD&&(this.ref.haveLOD=!1,this.haveLOD=!1),this.lod=-1,this.decalY=this.ref.decalY||0,this.tensionTest=!1,this.tensionActive=!1,this.fixToe=!1,this.clipsToesFix=[],this.n=Math.round(1e3*Math.random()),this.actions=new Map,this.current=null,this.old=null,this.breath=0,this.breathSide=-1,this.q=(new t.Quaternion).setFromAxisAngle({x:0,y:1,z:0},.5*Math.PI),this.headBoneLook=new t.Vector3,this.eyeTarget=new t.Group,this.eyeTarget.position.set(0,1,0),this.tmpMtx=new t.Matrix4,this.tmpQ=new t.Quaternion,this.setting={},this.root=Ye.get(this.ref.forceModel?this.ref.forceModel:this.model,"O"),this.root?(this.isClone=!0,this.tensionTest=!1,this.root=y.clone(this.root),this.init()):this.fullMaterial?this.load():this.loadModels()}rand(e=0,t=1){return e+Math.random()*(t-e)}load(){if(this.ref.textures&&this.ref.textures.length)if(this.skin=Ye.getTexture(this.ref.textureRef,{quality:this.textureQuality}),this.skin)this.loadModels();else{const e=this.rootPath+this.ref.texturePath+(this.textureQuality?this.textureQuality+"k/":"");Ye.load(this.ref.textures,this.loadModels.bind(this),e,"loading images...",this.textureQuality)}else this.loadModels()}loadModels(){const e=this.ref.forceModel?this.ref.forceModel:this.model,t=[e+".glb"],a=this.rootPath+this.ref.modelPath;this.ref.haveMorph&&this.haveMorph&&t.push(e+"_morph.glb"),Ye.load(t,this.init.bind(this),a,"loading models...")}update(e){this.done&&this.mixer&&(this.mixer.update(e),this.haveBlink&&this.eyeBlink(),this.isClone||(this.look(10*e),this.breathing(),this.autoToes()),this.tensionActive&&(this.tension1.update(),this.tension2.update()),this.actionPose&&this.actionPose.setEffectiveWeight(this.getAction("idle")._effectiveWeight),window.gui&&window.gui.updateTimeBarre&&this.current&&window.gui.updateTimeBarre(Math.round(30*this.current.time),this.current.frameMax))}eyeBlink(){const e=this.n++;let t=0;e<=10&&(t=.1*e),e>10&&e<=20&&(t=1-.1*(e-10)),this.n>500&&(this.n=0),this.setMorph("EyeBlink",t)}look(e){if(!this.isEyeMove)return;if(this.isPause)return;const t=window.mouse||{x:0,y:0};e>1&&(e=1),this.headBoneLook.lerp({x:-20*t.y*bt,y:0,z:-20*t.x*bt},e),this.eyeTarget.position.lerp({x:.5*t.x,y:1,z:.25*-t.y},e);let a=this.headBoneLook;this.tmpQ.setFromEuler({_x:a.x,_y:a.y,_z:a.z,_order:"XYZ"},!1),this.bones.head.quaternion.multiply(this.tmpQ);let i=this.bones.ER,s=this.bones.EL,r={x:0,y:0,z:1};this.tmpMtx.lookAt(s.position,this.eyeTarget.position.clone().add({x:.03,y:0,z:-.074}),r),s.quaternion.setFromRotationMatrix(this.tmpMtx).multiply(this.q),this.tmpMtx.lookAt(i.position,this.eyeTarget.position.clone().add({x:-.03,y:0,z:-.074}),r),i.quaternion.setFromRotationMatrix(this.tmpMtx).multiply(this.q)}breathing(){if(!this.bones)return;if(!this.isBreath)return;if(!this.skeleton.setScalling)return;let e=.01*this.breath;this.breathSide>0?(this.skeleton.setScalling(this.bones.chest,this.lerp(1,1.02,e),this.lerp(1,1.04,e),1),this.skeleton.setScalling(this.bones.abdomen,1,this.lerp(1,.92,e),1)):(this.skeleton.setScalling(this.bones.chest,this.lerp(1.02,1,e),this.lerp(1.04,1,e),1),this.skeleton.setScalling(this.bones.abdomen,1,this.lerp(.92,1,e),1)),this.breath++,100===this.breath&&(this.breath=0,this.breathSide=this.breathSide>0?-1:1)}setPosition(e,t,a){this.position.set(e,t,a),this.updateMatrix()}setRotation(e,t,a,i){let s=this.lerp(this.rotation.y,t,i);this.rotation.set(e,s,a),this.updateMatrix()}lerp(e,t,a){return(1-a)*e+a*t}onReady(){}initMaterial(){if(Ye.getMaterial(this.ref.materialRef))return;if(!this.fullMaterial)return void Ye.set(this.ref.materialRef,new t.MeshStandardMaterial);let e,a,i;for(const s in this.ref.materials){i={...this.ref.materials[s]},a=i.type,delete i.type;for(const e in i)"envMapIntensity"!==e&&"normalMapType"!==e&&"aoMapIntensity"!==e&&"aoMapIntensity"!==e&&("map"!==e&&-1===e.search("Map")||(i[e]=Ye.getTexture(i[e],{quality:this.textureQuality})));"Basic"===a?e=new t.MeshBasicMaterial(i):"Standard"===a?e=new t.MeshStandardMaterial(i):"Physical"===a?e=new t.MeshPhysicalMaterial(i):"Sss"===a&&(e=new J(i)),e.name=s,Ye.set(s,e)}this.setting=this.ref.setting}setMaterial(e,t){let a=Ye.getMaterial(this.ref.materialRef);if(a)for(let t in e)void 0!==a[t]&&(a[t]=e[t])}setMaterialNormal(e){let t=Ye.getMaterial("skin");t&&(e<0&&(e=0),t.normalScale.set(e,-e))}getMaterial(e){return Ye.getMaterial(e)}init(){if(this.initMaterial(),!this.isClone){let e=this.ref.forceModel?this.ref.forceModel:this.model;this.ref.multyMaterial&&Ye.getMesh(e,!0),this.root=Ye.get(e,"O"),this.ref.applyMaterial(this.root,this.model)}this.ref.forceModel&&this.isClone&&this.ref.applyMaterial(this.root,this.model),this.realSize=0,this.root.traverse(function(e){e.raycast=function(){},e.isMesh&&(e.name===this.ref.skeletonRef&&(e.matrixAutoUpdate=!1,this.skeleton=e.skeleton,this.skeleton.resetScalling&&this.skeleton.resetScalling(),this.realSize=e.geometry.boundingBox.max.y),"Head"===e.name&&(this.realSize=e.geometry.boundingBox.max.y),this.mesh[e.name]=e),e.isBone&&(this.bones[e.name]=e)}.bind(this)),this.realSizeRatio=1/this.realSize,this.baseSize=this.realSize,this.ref.isEyeMove&&this.bones.neck.add(this.eyeTarget);for(let e in this.mesh)this.mesh[e].isSkinnedMesh&&e!==this.ref.skeletonRef&&(this.mesh[e].skeleton=this.skeleton);if(this.isClone||(this.haveMorph&&Ye.applyMorph(this.model+"_morph",this.mesh,this.ref.morphNormal,this.ref.morphRelative),Ye.set(this.model,this.root,"O")),1!==this.size&&this.root.scale.set(1,1,1).multiplyScalar(this.size),this.mixer=new t.AnimationMixer(this),0===Ye.clip.length)this.compact?this.loadCompactAnimation(this.rootPath+"assets/animation/animations.bin"):this.loadAnimationJson(this.rootPath+"assets/animation/animations.json",this.start.bind(this));else{let e=Ye.clip.length;for(;e--;)this.addAction(Ye.clip[e]);this.start()}}setRealSize(e){this.realSize=e;let t=.5+this.baseSize/this.realSize*.5;this.setSize(this.realSize*this.realSizeRatio),this.setHeadSize(t)}setSize(e){this.size=e,this.root.scale.set(1,1,1).multiplyScalar(this.size)}setHeadSize(e){this.bones.head.scale.set(1,1,1).multiplyScalar(e)}addTensionMap(){this.tension1=new Ze(this.mesh.body),this.tension2=new Ze(this.mesh.Head)}setBounding(e){for(let t in this.mesh)this.mesh[t].isMesh&&(this.mesh[t].geometry.boundingSphere.radius=e)}setLevel(e){this.haveLOD&&this.lod!==e&&(this.lod=e,this.hideAll(),0===this.lod?this.setVisible(this.ref.levelLow,!0):(this.setVisible(this.ref.levelHigh,!0),this.ref.haveHair&&this.setVisible(this.ref.levelHair,!0)))}hideAll(){for(let e in this.mesh)this.mesh[e].visible=!1}setVisible(e,t){"string"==typeof e&&(e=[e]);let a,i=e.length;for(;i--;)a=e[i],this.mesh[a]&&(this.mesh[a].visible=t)}setMorph(e,t){t=t<0?0:t,this.haveMorph&&(this.morpher("eyelash",e,t),this.morpher("eyebrow",e,t),this.morpher("tear",e,t),this.morpher("mouth",e,t),this.morpher("body",e,t),this.morpher("Head",e,t),this.morpher("body_low",e,t))}morpher(e,t,a){this.mesh[e]&&this.mesh[e].morphTargetInfluences&&void 0!==this.mesh[e].morphTargetDictionary[t]&&(this.mesh[e].morphTargetInfluences[this.mesh[e].morphTargetDictionary[t]]=a)}lerp(e,t,a){return(1-a)*e+a*t}clone(e){return new this.constructor({type:e.type},this)}dispose(){this.exoskel&&this.addExo(),this.helper&&this.addHelper(),this.stop(),this.mixer.uncacheRoot(this),this.remove(this.root),this.skeleton.dispose(),this.parent&&this.parent.remove(this),this.isClone}start(){this.isPreload?this.callback():this.done||(this.done=!0,this.onReady(),this.play(this.startAnimation),this.ref.adjustment&&this.makePoseTrack("adjustment",this.ref.adjustment(),!0),this.randomMorph&&this.setBodyMorph([this.rand(-1,1),this.rand(-1,1)]),this.randomSize&&this.setRealSize(this.rand(1,2)),setTimeout(function(){this.add(this.root),this.callback()}.bind(this),100))}setBodyMorph(e){if(!this.haveMorph)return;e&&(this.bodyMorph=e);let t=Number(this.bodyMorph[0]),a=Number(this.bodyMorph[1]);this.setMorph("MUSCLE",a<0?-a:0),this.setMorph("LOW",a>=0?a:0),this.setMorph("BIG",t<0?-t:0),this.setMorph("MONSTER",t>=0?t:0);let i=.5*(t+1),s=1-.5*(a+1);this.setMaterialNormal(.5*(s+i))}setFaceMorph(e){if(!this.haveMorph)return;e&&(this.faceMorph=e);let t=Number(this.faceMorph[0]),a=Number(this.faceMorph[1]);this.setMorph("Shock",a<0?-a:0),this.setMorph("Frown",a>=0?a:0),this.setMorph("SmileOpen",t<0?-t:0),this.setMorph("Angry",t>=0?t:0)}addHelper(){this.helper?(this.helper.dispose(),this.remove(this.helper),this.helper=null):(this.helper=new t.SkeletonHelper(this.root),this.helper.raycast=function(){},this.helper.matrix=this.root.matrix,this.add(this.helper))}addExo(){return this.exoskel?(this.exoskel.dispose(),this.remove(this.exoskel),this.exoskel=null):(this.exoskel=new $e(this.root,this.skeleton),this.exoskel.matrix=this.root.matrix,this.add(this.exoskel)),this.exoskel}attachToBone(e,t){e.matrix=t.matrixWorld,e.matrixAutoUpdate=!1}loadAnimationJson(e,t){const a=new XMLHttpRequest;a.open("GET",e,!0),a.onreadystatechange=function(){if(4===a.readyState&&(200===a.status||0===a.status)){let e=JSON.parse(a.responseText);this.urls=[];for(let t in e)"main"===t?this.urls.push(...e[t]):this.urls.push(...e[t].map((e=>t+"/"+e)));this.endCallback=t||function(){},this.loadOne()}}.bind(this),a.send()}loadOne(){let e=this.urls[0];this.loadAnimationFbx(this.rootPath+"assets/animation/fbx/"+e+".fbx",this.next.bind(this))}next(){this.urls.shift(),0===this.urls.length?this.endCallback():this.loadOne()}loadCompactAnimation(e="./assets/models/animations.bin"){var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer";const i={animations:[]},s=this;a.onload=function(){Xe.decompress(a.response,(e=>{const a=JSON.parse(e);for(let e in a)i.animations.push(t.AnimationClip.parse(a[e]));s.applydAnimation(i),s.start()}))},a.send()}loadAnimationGlb(e,t){let a=e.substring(e.lastIndexOf("/")+1,e.lastIndexOf("."));Ye.loaderGLTF().load(e,function(e){this.applydAnimation(e,a),t&&t()}.bind(this),null,t)}directGlb(e,t){Ye.loaderGLTF().parse(e,"",function(e){this.stop(),this.applydAnimation(e,t)}.bind(this))}loadAnimationFbx(e,t){let a=e.substring(e.lastIndexOf("/")+1,e.lastIndexOf("."));Ye.loaderFBX().load(e,function(e){this.convertFbx(a,e.animations[0]),t&&t()}.bind(this),null,t)}directFbx(e,t){try{let a=Ye.loaderFBX().parse(e,"");this.convertFbx(t,a.animations[0],!0)}catch(e){console.error("bug",e)}}applydAnimation(e,t){let a=e.animations.length,i=!1;for(1===a&&(t&&(e.animations[0].name=t),i=!0);a--;)this.addClip(e.animations[a]),this.addAction(e.animations[a],i)}addClip(e,a=!1){a&&t.AnimationUtils.makeClipAdditive(e);let i=Ye.clip.length,s=-1;for(;i--;)Ye.clip[i].name===e.name&&(s=i);-1!==s&&Ye.clip.slice(s,1),Ye.clip.push(e)}addAction(e,t){const a=this.mixer.clipAction(e);a.frameMax=Math.round(30*e.duration),a.play(),a.enabled=!0,-1!==e.name.search("idle")&&(a.enabled=!0),"Jumping Up"===e.name&&(a.loop=LoopPingPong),this.actions.set(e.name,a),window.gui&&window.gui.getAnimation&&window.gui.getAnimation()}getAnimation(e=!1,t=!1){let a=[],i=0;if(t){let t=Ye.clip.length;for(;t--;)a[i]=e?Ye.clip[i].toJSON():Ye.clip[i],i++}else this.actions.forEach((function(t,s){a[i]=e?t._clip.toJSON():t._clip,i++}));return a}exportAnimationLzma(e){this.lzma||(this.lzma=new Xe(this.lzmaPath));const t=this.getAnimation(!0);this.lzma.compress(JSON.stringify(t),2,(function(t){if(e)e({name:"animations",data:new Uint8Array(t),type:"bin"});else{let e=document.createElement("a");e.style.display="none",document.body.appendChild(e),e.href=URL.createObjectURL(new Blob([new Uint8Array(t)],{type:"application/octet-stream"})),e.download="animations.bin",e.click()}}))}armAngle(){}autoToes(){if(!this.fixToe)return;let e=this.getRot("rFoot"),t=this.getRot("lFoot"),a=this.getWorldPos("hip"),i=this.getWorldPos("rToes"),s=this.getWorldPos("lToes");e[0]>0&&i.z-a.z<0?this.setRot("rToes",1.5*-e[0],0,0):0!==e[0]&&this.setRot("rToes",0,0,0),t[0]>0&&s.z-a.z<0?this.setRot("lToes",1.5*-t[0],0,0):0!==t[0]&&this.setRot("lToes",0,0,0)}resetToes(){this.fixToe&&(this.fixToe=!1,this.setRot("rToes",0,0,0),this.setRot("lToes",0,0,0))}convertFbx(e,a,i){const s=Math.PI/180;let r=new t.Vector3,n=new t.Quaternion,o=(new t.Quaternion).setFromAxisAngle({x:1,y:0,z:0},90*s);const c=a.tracks,h=[];let l,b,d,u,f=c.length,m=0;for(;f--;){if(d=c[m],u=d.name.substring(0,d.name.lastIndexOf(".")),"hip.position"===d.name){let e=[];for(l=d.values.length/3;l--;)b=3*l,r.set(d.values[b],d.values[b+1],0).multiplyScalar(.01),r.toArray(e,b);h.push(new t.VectorKeyframeTrack(d.name,d.times,e))}else{let e=[];for(l=d.values.length/4;l--;)b=4*l,"hip"===u?n.set(d.values[b],d.values[b+1],d.values[b+2],d.values[b+3]).multiply(o):n.set(d.values[b],d.values[b+2],-d.values[b+1],d.values[b+3]),n.toArray(e,b);h.push(new t.QuaternionKeyframeTrack(d.name,d.times,e))}m++}let p=new t.AnimationClip(e,-1,h);p.duration=a.duration,this.stop(),this.addClip(p),this.addAction(p,i)}makePoseTrack(e,a,i=!1){const s=Math.PI/180;let r=new t.Quaternion;const n=a,o=[];let c,h,l,b,d=n.length,u=0;for(;d--;){b=n[d],b.name;let e=[],a=[];for(u=0,c=3;c--;)h=0,l=4*u,a.push(.03333333507180214*u),r.setFromEuler({_x:b.values[0]*s,_y:b.values[1]*s,_z:b.values[2]*s,_order:"XYZ"}),r.toArray(e,l),u++;o.push(new t.QuaternionKeyframeTrack(b.name+".quaternion",a,e))}let f=i?t.AdditiveAnimationBlendMode:t.NormalAnimationBlendMode,m=new t.AnimationClip(e,-1,o,f);m.duration=.10000000521540642;const p=this.mixer.clipAction(m);p.enabled=!0,p.setEffectiveTimeScale(1),p.setEffectiveWeight(1),p.play(),this.actionPose=p}prepareCrossFade(e,t,a){this.isPause=!1,this.unPause(),"idle"!==t._clip.name?this.executeCrossFade(e,t,a):this.synchronizeCrossFade(e,t,a)}synchronizeCrossFade(e,t,a){this.mixer.addEventListener("loop",(function s(r){r.action===e&&(i.mixer.removeEventListener("loop",s),i.executeCrossFade(e,t,a))}));const i=this}executeCrossFade(e,t,a,i=!0){this.setWeight(t,1),t.time=0,e.crossFadeTo(t,a,!0)}pause(){this.actions.forEach((function(e){e.paused=!0})),this.isPause=!0}unPause(){this.actions.forEach((function(e){e.paused=!1})),this.isPause=!1}playAll(){this.actions.forEach((function(e){e.play()}))}setTimescale(e){this.actions.forEach((function(t){t.setEffectiveTimeScale(e)}))}syncro(e){let t=this.getAction(e);if(!t)return;let a=t.time;this.actions.forEach((function(e){e.time=a}))}setWeight(e,t){e.enabled=!0,t<0&&(t=0),t>1&&(t=1),e.setEffectiveWeight(t)}getAnimInfo(e){let t=this.getAction(e);if(t)return{name:e,time:t.time,frame:Math.round(30*t.time),frameMax:t.frameMax,timeScale:t.timeScale}}getAction(e){return this.actions.get(e)}play(e,t=.5){let a=this.getAction(e);if(!a)return!1;if(this.current){if(this.current!==a){this.old=this.current,this.current=a;let i="idle"===this.current.getClip().name;i="idle"===this.old.getClip().name,-1!==this.clipsToesFix.indexOf(e)?this.fixToe=!0:this.resetToes();let s=this.old.getEffectiveWeight(),r=this.current.getEffectiveWeight(),n=this.current.time;if(!i){let e=this.current.getClip().duration/this.old.getClip().duration;n=this.old.time*e}this.current.reset(),this.current.time=n,this.fixWeight?(this.current.weight=1,this.current.stopFading(),this.old.stopFading(),this.old._scheduleFading(t,s,0),this.current._scheduleFading(t,r,1)):this.executeCrossFade(this.old,this.current,t)}}else this.stop(),this.current=a,a.setEffectiveWeight(1);return this.isPause=!1,!0}playFrame(e,t,a=1){let i=this.getAction(e);i&&(i.time=t*lt,i.setEffectiveWeight(a),i.play(),i.paused=!0,this.isPause=!0)}playOne(e,t=1){this.current&&(this.current.time=e*lt,this.current.setEffectiveWeight(t),this.current.play(),this.current.paused=!0,this.isPause=!0)}stop(){this.actions.forEach((function(e){e.setEffectiveWeight(0)}))}setRot(e,t,a,i){let s=this.bones[e];s&&(s.rotation.set(t*bt,a*bt,i*bt,"XYZ"),s.updateMatrix())}setRot2(e,a,i,s){let r=this.bones[e];if(!r)return;let n=(new t.Quaternion).setFromEuler({_x:a*dt,_y:i*dt,_z:s*dt,_order:"XYZ"}).invert();r.quaternion.premultiply(n),r.updateMatrix()}getRot(e){let t=this.bones[e];if(!t)return;let a=t.rotation.toArray();return[Math.round(a[0]*dt),Math.round(a[1]*dt),Math.round(a[2]*dt)]}getWorldPos(e){let t=this.bones[e];if(t)return ut.set(0,0,0),t.localToWorld(ut),{x:ut.x,y:ut.y,z:ut.z}}bodyMask(e={arm:!0,leg:!0,foot:!0,chest:!0}){let a=.25;this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=256);const i=this.canvas.getContext("2d");i.fillStyle="#FFFFFF",i.fillRect(0,0,256,256),i.fillStyle="black",e.arm&&i.fillRect(196,112,59,46.5),e.leg&&i.fillRect(128,183.5,71.75,72.5),e.foot&&i.fillRect(817*a,205.5,51.5,50),e.chest&&(i.fillRect(120,144,75,40),i.fillRect(553*a,116.5,57,27.5),i.fillRect(533*a,531*a,5,45*a));let s=new Image;s.src=this.canvas.toDataURL(),this.mask&&this.mask.dispose(),this.mask=new t.Texture(s),this.mask.flipY=!1,this.mask.needsUpdate=!0;const r=Ye.getMaterial("skin");r.alphaTest=.9,r.alphaMap=this.mask}zeroColor(e){e.isMesh&&(e=e.geometry);let a=e.attributes.position.array.length;e.setAttribute("color",new t.Float32BufferAttribute(new Array(a).fill(0),3))}}class pt extends t.Object3D{constructor(e={},a){super(),this.motor=a,this.utils=this.motor.utils,this.isCharacter=!0,this.isPlayer=!1,this.enable=!1,this.useImpulse=e.useImpulse||!1,this.useFloating=e.floating||!1,this.waitRotation=!1;let i=.3,s=e.radius||.3,r=e.height||1.8;this.realHeight=r,this.useFloating&&(r-=i),this.option={debug:!1,capsuleHalfHeight:.5*r,capsuleRadius:s,floatHeight:i,characterInitDir:0,camInitDis:-5,camMaxDis:-7,camMinDis:-.7,maxVelLimit:5,turnVelMultiplier:.2,turnSpeed:15,sprintMult:2,jumpVel:4,jumpForceToGroundMult:5,slopJumpMult:.25,sprintJumpMult:1.2,airDragMultiplier:.2,dragDampingC:.15,accDeltaTime:8,rejectVelMult:4,moveImpulsePointY:.5,camFollowMult:11,fallingGravityScale:2.5,fallingMaxVel:-20,wakeUpDelay:200,rayOriginOffest:{x:0,y:.5*-r,z:0},rayHitForgiveness:.1,rayLength:s+2,rayDir:{x:0,y:-1,z:0},floatingDis:s+i+.08,springK:2,dampingC:.2,showSlopeRayOrigin:!1,slopeMaxAngle:1,slopeRayOriginOffest:s-.03,slopeRayLength:s+3,slopeRayDir:{x:0,y:-1,z:0},slopeUpExtraForce:.1,slopeDownExtraForce:.2,autoBalance:!0,autoBalanceSpringK:1.2,autoBalanceDampingC:.04,autoBalanceSpringOnY:.7,autoBalanceDampingOnY:.05,animated:!1,mode:null},this.v={movingObjectVelocityInCharacterDir:new t.Vector3,movingObjectVelocity:new t.Vector3,standingForcePoint:new t.Vector3,pivotPosition:new t.Vector3,modelQuat:new t.Quaternion,moveImpulse:new t.Vector3,impulseCenter:new t.Vector3,movingDirection:new t.Vector3,moveAccNeeded:new t.Vector3,jumpVelocityVec:new t.Vector3,jumpDirection:new t.Vector3,currentVel:new t.Vector3,currentPos:new t.Vector3,dragForce:new t.Vector3,dragAngForce:new t.Vector3,wantToMoveVel:new t.Vector3,rejectVel:new t.Vector3,floatingForce:null,springDirVec:new t.Vector3,rayOrigin:new t.Vector3,characterMassForce:new t.Vector3,slopeAngle:null,actualSlopeNormal:new t.Vector3,actualSlopeAngle:null,actualSlopeNormalVec:new t.Vector3,floorNormal:new t.Vector3(0,1,0),slopeRayOriginRef:new t.Vector3,slopeRayorigin:new t.Vector3,canJump:!1,isFalling:!1,isOnMovingObject:!1},this.fixWeight=void 0===e.fixWeight||e.fixWeight,this.type="character",this.name=e.name||"hero",e.name=this.name,this.isRay=!1,this.ray=null,this.model=null,this.static=!1,this.moving=!1,this.running=!1,this.wantJump=!1,this.radius=s,this.height=r,this.mass=e.mass||.84,delete e.radius,this.fall=!1,this.floor=!0,this.distance=0,this.rayAngle=0,this.rayStart=-.5*this.height+this.radius,this.rayEnd=this.rayStart-1.2,this.maxRayDistance=this.height,this.contact=!1,this.velocity=new t.Vector3,this.angular=new t.Vector3,this.tmpV1=new t.Vector3,this.tmpV2=new t.Vector3,this.ease=new t.Vector3,this.tmpAcc=0,this.rs=0,this.ts=0,this.diagonal=1/Math.sqrt(2),this.jump=!1,this.crouch=!1,this.toggle=!0,this.oy=0,this.vy=0,this.timeScale=1.25,this.angle=(e.angle||0)*w,this.speed={idle:1,fight:1,walk:7.8,crouch:7,run:12},this.valheimStyle=!0,this.globalRay=e.ray||!1,this.callback=e.callback||function(){},e.callback&&delete e.callback,this.initPhysic(e)}setHeight(e){this.model&&this.model.setRealSize(e)}reSizePhysics(e){if(e===this.realHeight)return;this.realHeight=e,this.height=this.realHeight-(this.useFloating?this.option.floatHeight:0);let t=this.position.toArray();t[1]+=.5*this.height+(this.useFloating?this.option.floatHeight:0);let a=[this.radius,this.height-2*this.radius];this.phyData.pos=t,this.phyData.size=a,this.motor.post({m:"add",o:this.phyData})}initPhysic(e){e.size||(e.size=[this.radius,this.height-2*this.radius]),e.pos||(e.pos=[0,0,0]),e.pos[1]+=.5*this.height,this.useFloating&&(e.pos[1]+=this.option.floatHeight),this.globalRay&&this.motor.getGeometryRef({...e,type:"capsule",ray:!0},this,this.motor.mat.get("hide")),this.phyData={name:this.name,size:e.size,pos:e.pos,type:"character",shapeType:e.shapeType||"capsule",density:1,mass:this.mass,friction:void 0!==e.friction?e.friction:.5,angularFactor:[0,0,0],group:16,regular:!0,massInfo:e.massInfo},"HAVOK"===this.motor.engine&&(this.phyData.inertia=[0,0,0]),e.mask&&(this.phyData.mask=e.mask),this.motor.getCharacterRef().addToWorld(this,e.id),this.motor.post({m:"add",o:this.phyData}),this.useFloating&&(this.ray=this.motor.add({type:"ray",name:this.name+"_ray",begin:[0,this.rayStart,0],end:[0,this.rayEnd,0],callback:this.selfRay.bind(this),visible:!1,parent:this.name})),e.gender?this.addModel(e):this.showHelper(!0),this.enable=!0}extraRemove(){this.ray&&this.motor.remove(this.name+"_ray")}selfRay(e){e.hit?(this.distance=e.distance,this.rayAngle=e.angle):(this.distance=this.option.rayLength,this.rayAngle=0)}hit(e){this.contact=e}showHelper(e){e?this.helper||(this.helper=new ce(this.radius,this.height,!0,this.motor.mat.get("line"),[1,.6,0],[.6,.2,0]),this.helper.setDirection(this.angle),this.add(this.helper)):this.helper&&(this.remove(this.helper),this.helper.dispose(),this.helper=null),this.ray&&(this.ray.visible=e)}addSkeleton(){this.skeletonBody||this.model&&(this.skeletonBody=new Ge(this.motor,this.name,this.model.root,this.model.skeleton.bones),this.motor.scene.add(this.skeletonBody),this.skeletonBody.isVisible(!1))}debugMode(e=!1){this.skeletonBody&&this.skeletonBody.isVisible(e),this.model&&this.skeletonBody&&this.model.setMaterial({transparent:e,opacity:e?.8:1},!e),this.showHelper(e)}setMode(e){this.skeletonBody&&this.skeletonBody.setMode(e)}addModel(e){this.model=new mt({type:e.gender,anim:void 0!==e.anim?e.anim:"idle",compact:!0,material:!e.noMat,morph:e.morph||!1,randomMorph:e.randomMorph||!1,randomSize:e.randomSize||!1,callback:this.callback,fixWeight:this.fixWeight,noLOD:e.noLOD||!1}),this.add(this.model);let t=-.5*this.height;this.useFloating&&(t-=this.option.floatHeight),this.model.setPosition(0,this.model.decalY+t,0),this.model.rotation.y=this.angle,this.model.updateMatrix()}raycast(){}step(e,t){this.position.fromArray(e,t+1),this.quaternion.fromArray(e,t+4),this.velocity.fromArray(e,t+8),this.angular.fromArray(e,t+11),this.fall=this.position.y<this.oy,this.floor=A.nearEquals(this.position.y,this.oy,.1),this.oy=this.position.y,this.model&&(this.model.update(this.motor.delta),this.getDistanceToCamera()),this.useFloating&&!this.isPlayer&&(this.stopMoving(),this.getFloating(),this.motor.change({name:this.name,impulse:this.v.moveImpulse.toArray(),impulseCenter:this.v.impulseCenter.toArray()})),this.updateMatrix()}getDistanceToCamera(){if(!this.model)return;if(!this.model.haveLOD)return;const e=this.motor.getCamera();this.tmpV1.copy(this.motor.getCurrentCharacterPosition()),this.tmpV2.copy(this.position);let t=this.tmpV1.distanceTo(this.tmpV2)/e.zoom>3?0:1;this.model.setLevel(t)}set(e){e.morph&&this.model&&this.model.setMorph(e.morph,e.value)}dispose(){this.callback=null,this.skeletonBody&&this.skeletonBody.dispose(),this.model&&this.model.dispose(),this.helper&&this.showHelper()}onFrame(e,t){this.v,this.option}autoBalance(){const e=this.v,t=this.option,a=this.rotation;e.dragAngForce.set(-t.autoBalanceSpringK*a.x-this.angular.x*t.autoBalanceDampingC,-t.autoBalanceSpringK*a.y-this.angular.y*t.autoBalanceDampingOnY,-t.autoBalanceSpringK*a.z-this.angular.z*t.autoBalanceDampingC)}moveCharacter(e,t=0){const a=this.v,i=this.option,s=this.motor.getKey();this.motor.getAzimut(),a.currentPos.copy(this.position),a.slopeAngle=0,a.actualSlopeAngle<i.slopeMaxAngle&&Math.abs(a.slopeAngle)>.2&&Math.abs(a.slopeAngle)<i.slopeMaxAngle?a.movingDirection.set(0,Math.sin(a.slopeAngle),Math.cos(a.slopeAngle)):a.actualSlopeAngle>=i.slopeMaxAngle?a.movingDirection.set(0,Math.sin(a.slopeAngle)>0?0:Math.sin(a.slopeAngle),Math.sin(a.slopeAngle)>0?.1:1):a.movingDirection.set(0,0,1),a.movingDirection.applyAxisAngle({x:0,y:1,z:0},t),a.movingObjectVelocityInCharacterDir.copy(a.movingObjectVelocity).projectOnVector(a.movingDirection).multiply(a.movingDirection);const r=a.movingObjectVelocity.angleTo(a.movingDirection),n=a.currentVel.dot(a.movingDirection);a.wantToMoveVel.set(a.movingDirection.x*n,0,a.movingDirection.z*n),a.rejectVel.copy(a.currentVel).sub(a.wantToMoveVel),a.moveAccNeeded.set((a.movingDirection.x*(i.maxVelLimit*(this.running?i.sprintMult:1)+a.movingObjectVelocityInCharacterDir.x)-(a.currentVel.x-a.movingObjectVelocity.x*Math.sin(r)+a.rejectVel.x*(a.isOnMovingObject?0:i.rejectVelMult)))/i.accDeltaTime,0,(a.movingDirection.z*(i.maxVelLimit*(this.running?i.sprintMult:1)+a.movingObjectVelocityInCharacterDir.z)-(a.currentVel.z-a.movingObjectVelocity.z*Math.sin(r)+a.rejectVel.z*(a.isOnMovingObject?0:i.rejectVelMult)))/i.accDeltaTime);const o=a.moveAccNeeded.multiplyScalar(this.mass);let c=!0;this.waitRotation&&(c=Math.sin(t).toFixed(3)==Math.sin(this.rotation.y).toFixed(3)),c?a.moveImpulse.set(o.x*(a.canJump?1:i.airDragMultiplier),null===a.slopeAngle||0==a.slopeAngle?0:a.movingDirection.y*(a.movingDirection.y>0?i.slopeUpExtraForce:i.slopeDownExtraForce)*(this.running?i.sprintMult:1),o.z*(a.canJump?1:i.airDragMultiplier)):a.moveImpulse.set(o.x*i.turnVelMultiplier*(a.canJump?1:i.airDragMultiplier),null===a.slopeAngle||0==a.slopeAngle?0:a.movingDirection.y*i.turnVelMultiplier*(a.movingDirection.y>0?i.slopeUpExtraForce:i.slopeDownExtraForce)*(this.running?i.sprintMult:1),o.z*i.turnVelMultiplier*(a.canJump?1:i.airDragMultiplier)),a.impulseCenter.set(a.currentPos.x,a.currentPos.y+i.moveImpulsePointY,a.currentPos.z),a.currentVel.copy(this.velocity),s[4]&&a.canJump&&(a.jumpVelocityVec.set(a.currentVel.x,this.running?i.sprintJumpMult*i.jumpVel:i.jumpVel,a.currentVel.z),a.moveImpulse.y=a.jumpVelocityVec.y)}getFloating(){const e=this.v,t=this.option,a=t.springK*(t.floatingDis-this.distance)-this.velocity.y*t.dampingC;e.moveImpulse.y=a*this.mass}stopMoving(){this.v,this.option,this.v.moveImpulse.set(0,0,0),this.tmpV1.copy(this.velocity),this.tmpV1.x*=.9,this.tmpV1.z*=.9,this.tmpV1.x+this.tmpV1.z!==0&&this.motor.change({name:this.name,linearVelocity:this.tmpV1.toArray(),wake:!1})}move(){this.v;const e=this.motor.getKey(),t=this.motor.getAzimut(),a=this.motor.delta;let i=0!==e[7]?"run":"walk";0===e[0]&&0===e[1]&&(i="idle");let s=0!==e[0]&&0!==e[1]?this.diagonal:1;e[5]&&this.toggle&&(this.crouch=!this.crouch,this.toggle=!1),0===e[5]&&(this.toggle=!0),"walk"!==i&&"run"!==i||!this.crouch||(i="crouch"),1===e[6]&&(i="fight"),!this.jump&&e[4]&&(this.vy=22,this.jump=!0),this.jump&&(this.vy-=1,this.vy<=0&&(this.vy=0,this.floor&&(this.jump=!1)));let r="idle";switch(i){case"idle":r=this.crouch?"Crouch Idle":"idle";break;case"walk":r="Jog Forward";break;case"run":r="Standard Run";break;case"crouch":r="Crouch Walk";break;case"fight":r="Attack"}this.moving=0!==e[0]||0!==e[1],this.running=0!==e[7],this.wantJump=0!==e[4];let n=A.unwrapRad(Math.atan2(e[0],e[1])+t);if(this.useImpulse)this.moving?this.moveCharacter(a,n):this.stopMoving(),this.useFloating&&this.getFloating(),this.motor.change({name:this.name,impulse:this.v.moveImpulse.toArray(),impulseCenter:this.v.impulseCenter.toArray()});else{this.tmpAcc+=4*a;const r=1;let n=this.speed[i]*r;this.moving&&(this.rs=e[0]*n,this.ts=e[1]*n),0===e[0]&&0===e[1]&&(this.tmpAcc=0),this.tmpAcc>1&&(this.tmpAcc=1),this.ease.set(this.rs,0,this.ts).multiplyScalar(this.tmpAcc*s),this.ease.length(),this.static&&(this.ease.x=this.ease.z=0);let o=this.vy-9.81;this.ease.y=o,this.tmpV1.copy(this.ease).applyAxisAngle({x:0,y:1,z:0},t),this.tmpV2.set(0,0,0),this.motor.change({name:this.name,linearVelocity:this.tmpV1.toArray()})}if(this.helper&&(this.helper.updateMatrix(),this.helper.cone.rotation.y=t,"idle"!==i&&this.helper.setDirection(n)),this.model&&(this.jump?this.model.play("Jump",.5):this.model.play(r,.75),"idle"!==i)){let e=A.unwrapRad(this.model.rotation.y),a=A.nearAngle(n,e),s=Math.abs(Math.floor((e-a)*math.todeg)/180);this.model.rotation.y="fight"===i?t+Math.PI:A.lerp(e,a,.2-.1*s),this.model.updateMatrix()}}}class gt extends ie{constructor(e){super(),this.motor=e,this.Utils=this.motor.utils,this.type="character",this.num=B[this.type]}step(e,t){let a,i,s=this.list.length;for(;s--;)i=this.list[s],a=t+s*this.num,i&&i.step(e,a)}add(e={}){this.setName(e);return new pt(e,this.motor)}set(e={},t=null){null===t&&(t=this.byName(e.name)),null!==t&&t.set(e)}}const yt={torad:Math.PI/180,todeg:180/Math.PI,Pi:Math.PI,TwoPI:2*Math.PI,PI90:.5*Math.PI,PI45:.25*Math.PI,PI270:.5*Math.PI*3,inv255:.003921569,golden:1.618033,epsilon:Math.pow(2,-52),randomSign:()=>Math.random()<.5?-1:1,randSpread:e=>e*(.5-Math.random()),rand:(e=0,t=1)=>e+Math.random()*(t-e),randInt:(e,t)=>e+Math.floor(Math.random()*(t-e+1)),toFixed:(e,t=3)=>1*e.toFixed(t),int:e=>Math.floor(e),lerp:(e,t,a)=>(1-a)*e+a*t,clamp:(e,t,a)=>Math.max(t,Math.min(a,e)),nearEquals:(e,t,a)=>Math.abs(e-t)<=a,lerpAr:(e,t,a,i)=>{let s=e.length;for(;s--;)e[s]=yt.lerp(t[s],a[s],i)},unwrapDeg:e=>e-360*Math.floor((e+180)/360),unwrapRad:e=>Math.atan2(Math.sin(e),Math.cos(e)),scaleArray:(e,t)=>{for(var a=e.length;a--;)e[a]*=t;return e},addArray:(e,t)=>{for(var a=[],i=e.length;i--;)a[i]=e[i]+t[i];return a},angleDistance:(e,t)=>{var a=(e-t+180)%360-180;return a<-180?a+360:a},tmpE:new t.Euler,tmpM:new t.Matrix4,tmpM2:new t.Matrix4,tmpV:new t.Vector3,tmpQ:new t.Quaternion,fromTransformToQ:(e,t,a)=>(a=a||!1,yt.tmpM.compose(yt.tmpV.fromArray(e),yt.tmpQ.fromArray(t),{x:1,y:1,z:1}),yt.tmpM.decompose(yt.tmpV,yt.tmpQ,{x:1,y:1,z:1}),a&&yt.tmpQ.invert(),yt.tmpQ.toArray()),fromTransform:(e,t,a,i,s)=>(s=s||!1,i=i||[0,0,0,1],yt.tmpM.compose(yt.tmpV.fromArray(e),yt.tmpQ.fromArray(t),{x:1,y:1,z:1}),yt.tmpM2.compose(yt.tmpV.fromArray(a),yt.tmpQ.fromArray(i),{x:1,y:1,z:1}),s?(yt.tmpM.invert(),yt.tmpM.multiply(yt.tmpM2)):yt.tmpM.multiply(yt.tmpM2),yt.tmpM.decompose(yt.tmpV,yt.tmpQ,{x:1,y:1,z:1}),yt.tmpV.toArray()),arCopy:(e,t)=>{},axisToQuatArray:(e,t)=>(t=t||!1,yt.tmpQ.setFromAxisAngle(yt.tmpV.fromArray(e,1),t?e[0]*yt.torad:e[0]).normalize().toArray()),toQuatArray:e=>yt.tmpQ.setFromEuler(yt.tmpE.fromArray(yt.vectorad(e))).toArray(),vectorad:e=>{let t=3,a=[];for(;t--;)a[t]=e[t]*yt.torad;return a[3]=e[3],a},rgbToHex:e=>"0x"+("000000"+(255*e[0]<<16^255*e[1]<<8^255*e[2]).toString(16)).slice(-6),hexToRgb:e=>[((e=Math.floor(e))>>16&255)/255,(e>>8&255)/255,(255&e)/255],htmlToHex:e=>e.toUpperCase().replace("#","0x"),hexToHtml:e=>"#"+("000000"+(e=void 0===e?0:e).toString(16)).substr(-6),rgbToHtml:e=>"#"+("000000"+(255*e[0]<<16^255*e[1]<<8^255*e[2]).toString(16)).slice(-6),perlin:null,resetPerlin:()=>{null!==yt.perlin&&(yt.perlin=null)},noise:(e,t)=>{null===yt.perlin&&(yt.perlin=new xt);let a,i,s=(t=t||{}).level||[1,.2,.05],r=t.frequency||[.016,.05,.2],n=0,o=0;for(a=0;a<s.length;a++)i=r[a],n+=s[a]*(.5+.5*yt.perlin.noise3d(e.x*i,e.y*i,e.z*i)),o+=s[a];return n/=o,n}};class xt{constructor(e){null==e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(e,t,a){return e[0]*t+e[1]*a}dot3(e,t,a,i){return e[0]*t+e[1]*a+e[2]*i}dot4(e,t,a,i,s){return e[0]*t+e[1]*a+e[2]*i+e[3]*s}noise(e,t){var a,i,s=(e+t)*(.5*(Math.sqrt(3)-1)),r=Math.floor(e+s),n=Math.floor(t+s),o=(3-Math.sqrt(3))/6,c=(r+n)*o,h=e-(r-c),l=t-(n-c);h>l?(a=1,i=0):(a=0,i=1);var b=h-a+o,d=l-i+o,u=h-1+2*o,f=l-1+2*o,m=255&r,p=255&n,g=this.perm[m+this.perm[p]]%12,y=this.perm[m+a+this.perm[p+i]]%12,x=this.perm[m+1+this.perm[p+1]]%12,w=.5-h*h-l*l,v=.5-b*b-d*d,k=.5-u*u-f*f;return 70*((w<0?0:(w*=w)*w*this.dot(this.grad3[g],h,l))+(v<0?0:(v*=v)*v*this.dot(this.grad3[y],b,d))+(k<0?0:(k*=k)*k*this.dot(this.grad3[x],u,f)))}noise3d(e,t,a){var i,s,r,n,o,c,h=(e+t+a)*(1/3),l=Math.floor(e+h),b=Math.floor(t+h),d=Math.floor(a+h),u=1/6,f=(l+b+d)*u,m=e-(l-f),p=t-(b-f),g=a-(d-f);m>=p?p>=g?(i=1,s=0,r=0,n=1,o=1,c=0):m>=g?(i=1,s=0,r=0,n=1,o=0,c=1):(i=0,s=0,r=1,n=1,o=0,c=1):p<g?(i=0,s=0,r=1,n=0,o=1,c=1):m<g?(i=0,s=1,r=0,n=0,o=1,c=1):(i=0,s=1,r=0,n=1,o=1,c=0);var y=m-i+u,x=p-s+u,w=g-r+u,v=m-n+2*u,k=p-o+2*u,j=g-c+2*u,M=m-1+.5,A=p-1+.5,S=g-1+.5,E=255&l,F=255&b,z=255&d,R=this.perm[E+this.perm[F+this.perm[z]]]%12,P=this.perm[E+i+this.perm[F+s+this.perm[z+r]]]%12,T=this.perm[E+n+this.perm[F+o+this.perm[z+c]]]%12,I=this.perm[E+1+this.perm[F+1+this.perm[z+1]]]%12,B=.6-m*m-p*p-g*g,C=.6-y*y-x*x-w*w,D=.6-v*v-k*k-j*j,L=.6-M*M-A*A-S*S;return 32*((B<0?0:(B*=B)*B*this.dot3(this.grad3[R],m,p,g))+(C<0?0:(C*=C)*C*this.dot3(this.grad3[P],y,x,w))+(D<0?0:(D*=D)*D*this.dot3(this.grad3[T],v,k,j))+(L<0?0:(L*=L)*L*this.dot3(this.grad3[I],M,A,S)))}noise4d(e,t,a,i){var s,r,n,o,c,h,l,b,d,u,f,m,p=this.grad4,g=this.simplex,y=this.perm,x=(Math.sqrt(5)-1)/4,w=(5-Math.sqrt(5))/20,v=(e+t+a+i)*x,k=Math.floor(e+v),j=Math.floor(t+v),M=Math.floor(a+v),A=Math.floor(i+v),S=(k+j+M+A)*w,E=e-(k-S),F=t-(j-S),z=a-(M-S),R=i-(A-S),P=(E>F?32:0)+(E>z?16:0)+(F>z?8:0)+(E>R?4:0)+(F>R?2:0)+(z>R?1:0),T=E-(s=g[P][0]>=3?1:0)+w,I=F-(r=g[P][1]>=3?1:0)+w,B=z-(n=g[P][2]>=3?1:0)+w,C=R-(o=g[P][3]>=3?1:0)+w,D=E-(c=g[P][0]>=2?1:0)+2*w,L=F-(h=g[P][1]>=2?1:0)+2*w,O=z-(l=g[P][2]>=2?1:0)+2*w,q=R-(b=g[P][3]>=2?1:0)+2*w,V=E-(d=g[P][0]>=1?1:0)+3*w,G=F-(u=g[P][1]>=1?1:0)+3*w,H=z-(f=g[P][2]>=1?1:0)+3*w,_=R-(m=g[P][3]>=1?1:0)+3*w,N=E-1+4*w,U=F-1+4*w,K=z-1+4*w,J=R-1+4*w,W=255&k,X=255&j,Q=255&M,Y=255&A,Z=y[W+y[X+y[Q+y[Y]]]]%32,$=y[W+s+y[X+r+y[Q+n+y[Y+o]]]]%32,ee=y[W+c+y[X+h+y[Q+l+y[Y+b]]]]%32,te=y[W+d+y[X+u+y[Q+f+y[Y+m]]]]%32,ae=y[W+1+y[X+1+y[Q+1+y[Y+1]]]]%32,ie=.6-E*E-F*F-z*z-R*R,se=.6-T*T-I*I-B*B-C*C,re=.6-D*D-L*L-O*O-q*q,ne=.6-V*V-G*G-H*H-_*_,oe=.6-N*N-U*U-K*K-J*J;return 27*((ie<0?0:(ie*=ie)*ie*this.dot4(p[Z],E,F,z,R))+(se<0?0:(se*=se)*se*this.dot4(p[$],T,I,B,C))+(re<0?0:(re*=re)*re*this.dot4(p[ee],D,L,O,q))+(ne<0?0:(ne*=ne)*ne*this.dot4(p[te],V,G,H,_))+(oe<0?0:(oe*=oe)*oe*this.dot4(p[ae],N,U,K,J)))}}class wt extends t.Mesh{constructor(e={}){super(),this.ready=!1,this.needUpdate=!1,this.type="terrain",this.name=e.name,this.folder=e.folder||"./assets/textures/terrain/",this.mapN=0,this.mapMax=7,this.ttype=e.terrainType||"terrain",this.callback=e.callback||function(){},this.physicsUpdate=()=>{},this.uvx=[e.uv||18,e.uv||18],this.sample=null==e.sample?[128,128]:e.sample,this.size=void 0===e.size?[100,30,100]:e.size;let a=this.sample[0]-1,i=this.sample[1]-1;this.rx=a/this.size[0],this.rz=i/this.size[2],this.zone=e.zone||1;let s=[this.size[0]/a,this.size[2]/i];this.sampleZ=[e.sample[0]*this.zone,e.sample[1]*this.zone],this.sizeZ=[(this.sampleZ[0]-1)*s[0],e.size[1],(this.sampleZ[1]-1)*s[1]],this.lng=this.sample[0]*this.sample[1],this.lngZ=this.sampleZ[0]*this.sampleZ[1],this.getZid(),this.data={level:e.level||[1,.2,.05],frequency:e.frequency||[.016,.05,.2],expo:e.expo||1},this.isWater=e.water||!1,this.isIsland=e.island||!1,this.isBorder=!1,this.wantBorder=e.border||!1,this.isBottom=!1,this.wantBottom=e.bottom||!1,this.wantBorder=e.border||!1,this.colorBase=this.isWater?{r:0,g:.7,b:1}:{r:.25,g:.25,b:.25},this.maxspeed=e.maxSpeed||.1,this.acc=null==e.acc?.01:e.acc,this.dec=null==e.dec?.01:e.dec,this.deep=null==e.deep?0:e.deep,this.ease=new t.Vector2,this.complexity=null==e.complexity?30:e.complexity,this.complexity2=null==e.complexity2?null:e.complexity2,this.local=new t.Vector3,e.local&&this.local.fromArray(e.local),this.pp=new t.Vector3,this.ratioZ=1/this.sampleZ[0],this.ratio=1/this.sample[0],this.ruvx=1/(this.size[0]/this.uvx[0]),this.ruvy=-1/(this.size[2]/this.uvx[1]),this.is64=e.is64||!1,this.isTurn=e.turn||!1,this.heightData=new Float32Array(this.lngZ),this.height=[],this.isAbsolute=e.isAbsolute||!1,this.isTurned=e.isTurned||!1,this.isReverse=e.isReverse||!1,this.changeId=this.isReverse||this.isTurned,this.changeId&&this.getReverseID(),this.colors=new Float32Array(3*this.lng),this.geometry=new t.PlaneGeometry(this.size[0],this.size[2],this.sample[0]-1,this.sample[1]-1),this.geometry.rotateX(-yt.PI90),this.geometry.setAttribute("color",new t.BufferAttribute(this.colors,3)),this.vertices=this.geometry.attributes.position.array;var r=new t.Quaternion(.5,.5,.1,.2);e.maplevels&&r.fromArray(e.maplevels);var n,o=vt,c=e.maps||["sand","grass3","rock"],h={};this.isWater&&(c=["water"]);for(let t in c)n=c[t],h[n+"_c"]=Ye.texture({url:this.folder+n+"_c.jpg",flip:!1,repeat:this.uvx,encoding:e.encoding||!0,callback:this.mapcallback.bind(this)}),h[n+"_n"]=Ye.texture({url:this.folder+n+"_n.jpg",flip:!1,repeat:this.uvx,callback:this.mapcallback.bind(this)});h.noise=Ye.texture({url:this.folder+"noise.png",flip:!1,repeat:[1,1],encoding:!1,callback:this.mapcallback.bind(this)}),this.txt=h,this.material=new t.MeshPhysicalMaterial({name:"terrain",vertexColors:!0,color:16777215,map:h[c[0]+"_c"],normalMap:h[c[0]+"_n"]}),void 0!==e.envmap&&(this.material.envMap=e.envmap),this.isWater?(this.material.transparent=!0,this.material.opacity=e.opacity||.4,this.material.side=t.DoubleSide,this.material.alphaMap=h[c[0]+"_c"],this.material.map=null,this.material.metalness=.9,this.material.roughness=.1):(this.material.reflectivity=0,this.material.metalness=e.metalness||0,this.material.roughness=e.roughness||.3);var l=e.nScale||.5;if(this.material.normalScale.set(l,-l),this.isWater)this.material.onBeforeCompile=function(e){var t=e.fragmentShader;t=t.replace("#include <alphamap_fragment>",o.alphamap),e.fragmentShader=t};else{let e=this;this.material.onBeforeCompile=function(t){let a=t.uniforms;a.clevels={value:r},a.map1={value:h[c[1]+"_c"]},a.map2={value:h[c[2]+"_c"]},a.randomUv={value:1},a.normalMap1={value:h[c[1]+"_n"]},a.normalMap2={value:h[c[2]+"_n"]},a.noiseMap={value:h.noise},a.useNoiseMap={value:1},t.uniforms=a;let i=t.fragmentShader;i=i.replace("#include <clipping_planes_pars_fragment>","#include <clipping_planes_pars_fragment>"+kt+o.fragmentAdd),i=i.replace("#include <map_fragment>",o.map),i=i.replace("#include <normal_fragment_maps>",o.normal),i=i.replace("#include <color_fragment>",""),t.fragmentShader=i,e.material.userData.shader=t},Object.defineProperty(this.material,"randomUv",{get(){return!!this.userData.shader.uniforms.randomUv.value},set(e){this.userData.shader.uniforms.randomUv.value=e?1:0}}),Object.defineProperty(this.material,"map1",{get(){return this.userData.shader.uniforms.map1.value},set(e){this.userData.shader.uniforms.map1.value=e}}),Object.defineProperty(this.material,"map2",{get(){return this.userData.shader.uniforms.map2.value},set(e){this.userData.shader.uniforms.map2.value=e}}),Object.defineProperty(this.material,"normalMap1",{get(){return this.userData.shader.uniforms.normalMap1.value},set(e){this.userData.shader.uniforms.normalMap1.value=e}}),Object.defineProperty(this.material,"normalMap2",{get(){return this.userData.shader.uniforms.normalMap2.value},set(e){this.userData.shader.uniforms.normalMap2.value=e}})}e.debug&&this.debugZone(e),this.wantBorder&&this.addBorder(e),this.wantBottom&&this.addBottom(e),e.pos&&this.position.fromArray(e.pos),e.quat=void 0===e.quat?[0,0,0,1]:e.quat,void 0!==e.rot&&(e.quat=yt.toQuatArray(e.rot),delete e.rot),this.quaternion.fromArray(e.quat),e.decal&&(this.position.y+=e.decal),this.castShadow=!0,this.receiveShadow=!0,Ye.set("terrain"+this.name,this.material,"material",!0),this.update()}getZid(){this.zid={};let e=.5*(this.sample[0]-this.sampleZ[0]),t=.5*(this.sample[1]-this.sampleZ[1]),a=this.sample[0]*t+e,i=0;for(let t=0;t<this.lngZ;t++)i=Math.floor(t/this.sampleZ[0]),this.zid[a+t+i*(2*e)]=t}debugZone(e){this.geometryZ=new t.PlaneGeometry(this.sizeZ[0],this.sizeZ[2],this.sampleZ[0]-1,this.sampleZ[1]-1),this.geometryZ.rotateX(-yt.PI90),this.verticesZ=this.geometryZ.attributes.position.array;const a=new t.Mesh(this.geometryZ,new t.MeshBasicMaterial({color:0,wireframe:!0,transparent:!0,opacity:.1}));this.add(a)}mapcallback(){this.mapN++,this.mapN==this.mapMax&&this.callback()}addBottom(e){var a=new t.PlaneGeometry(this.size[0],this.size[2],1,1);a.rotateX(yt.PI90),this.bottomMesh=new t.Mesh(a,this.borderMaterial),this.add(this.bottomMesh),this.isBottom=!0}addBorder(e){this.borderMaterial=new t.MeshStandardMaterial({vertexColors:!0,metalness:this.isWater?.8:.4,roughness:this.isWater?.2:.6,normalScale:this.isWater?[.25,.25]:[2,2],transparent:!!this.isWater,opacity:this.isWater?e.opacity||.8:1,envMap:e.envmap||null});var i=new t.PlaneGeometry(this.size[0],2,this.sample[0]-1,1),s=new t.PlaneGeometry(this.size[0],2,this.sample[0]-1,1),r=new t.PlaneGeometry(this.size[2],2,this.sample[1]-1,1),n=new t.PlaneGeometry(this.size[2],2,this.sample[1]-1,1);i.translate(0,1,.5*this.size[2]),s.rotateY(-yt.Pi),s.translate(0,1,.5*-this.size[2]),r.rotateY(-yt.PI90),r.translate(.5*-this.size[0],1,0),n.rotateY(yt.PI90),n.translate(.5*this.size[0],1,0),this.borderGeometry=a.mergeVertices(a.mergeGeometries([i,s,r,n])),this.borderVertices=this.borderGeometry.attributes.position.array,this.lng2=this.borderVertices.length/3,this.list=new Array(this.lng2),this.borderColors=new Float32Array(3*this.lng),this.borderGeometry.setAttribute("color",new t.BufferAttribute(this.borderColors,3)),this.borderMesh=new t.Mesh(this.borderGeometry,this.borderMaterial);for(var o,c,h=this.lng2;h--;)o=3*h,c=this.borderVertices[o+1]>0?this.findPoint(this.borderVertices[o],this.borderVertices[o+2]):-1,this.list[h]=c;this.add(this.borderMesh),this.borderMesh.castShadow=!0,this.borderMesh.receiveShadow=!0,this.isBorder=!0}dispose(){this.isBottom&&(this.remove(this.bottomMesh),this.bottomMesh.geometry.dispose()),this.isBorder&&(this.remove(this.borderMesh),this.borderMesh.geometry.dispose(),this.borderMesh.material.dispose()),this.geometry.dispose(),this.material.dispose();for(let e in this.txt)this.txt[e].dispose()}easing(e,t,a){if(0!==e[0]||0!==e[1]){var i=t||0;e[7]?this.maxspeed=1.5:this.maxspeed=.25,this.ease.y+=e[1]*this.acc,this.ease.x+=e[0]*this.acc,this.ease.x=this.ease.x>this.maxspeed?this.maxspeed:this.ease.x,this.ease.x=this.ease.x<-this.maxspeed?-this.maxspeed:this.ease.x,this.ease.y=this.ease.y>this.maxspeed?this.maxspeed:this.ease.y,this.ease.y=this.ease.y<-this.maxspeed?-this.maxspeed:this.ease.y,e[1]||(this.ease.y>this.dec?this.ease.y-=this.dec:this.ease.y<-this.dec?this.ease.y+=this.dec:this.ease.y=0),e[0]||(this.ease.x>this.dec?this.ease.x-=this.dec:this.ease.x<-this.dec?this.ease.x+=this.dec:this.ease.x=0),(this.ease.x||this.ease.y)&&(this.local.z+=Math.sin(i)*this.ease.x+Math.cos(i)*this.ease.y,this.local.x+=Math.cos(i)*this.ease.x-Math.sin(i)*this.ease.y,this.update(a))}}getTri(){return this.geometry}getHeight(e,t){return e*=this.rx,t*=this.rz,e+=.5*this.sample[0],t+=.5*this.sample[1],e=Math.floor(e),t=Math.floor(t),(this.isTurn?this.height[this.findId2(e,t)]:this.height[this.findId(e,t)])*this.size[1]+this.position.y}findIdZ(e,t){return e+t*this.sampleZ[1]}findId(e,t){return e+t*this.sample[1]}findId2(e,t){return t+-e*this.sample[0]||1}findPoint(e,t){for(var a,i=this.lng;i--;)if(a=3*i,this.vertices[a]===e&&this.vertices[a+2]===t)return i;return-1}getReverseID(){this.invId=[];let e,t,a=this.lngZ;const i=this.sampleZ[1]-1;for(this.sampleZ[0];a--;)e=a%this.sampleZ[0],t=Math.floor(a*this.ratioZ),this.isReverse&&(t=i-t),this.invId[a]=this.isTurned?this.lngZ-1-this.findIdZ(t,e):this.findIdZ(e,t)}set(e){e.ease&&this.easing(e.key,e.azimut),e.decal&&this.decal(e.decal,!0)}decal(e,t){this.local.x+=e[0],this.local.y+=e[1],this.local.z+=e[2],this.update(t)}updateUv(){if(this.isWater)this.material.normalMap.offset.x+=.002,this.material.normalMap.offset.y+=.001;else{let e={x:this.local.x*this.ruvx,y:this.local.z*this.ruvy};this.material.map&&this.material.map.offset.copy(e),this.material.normalMap&&this.material.normalMap.offset.copy(e)}}distance(e,t){const a=e.x-t.x,i=e.y-t.y;return Math.sqrt(a*a+i*i)}clamp(e,t=0,a=1){return e=(e=e<t?t:e)>a?a:e}update(e){let t,a,i,s,r,n,o,c,h,l,b,d=this.pp,u=[1,1,1],f=this.lng;for(;f--;){if(t=3*f,a=f%this.sample[0],i=Math.floor(f*this.ratio),d.set(a+this.local.x*this.rx,this.local.y,i+this.local.z*this.rz),s=yt.noise(d,this.data),this.isIsland){let e=1-this.distance({x:a,y:i},{x:.5*(this.sample[0]-1),y:.5*(this.sample[1]-1)})/(.5*(this.sample[0]-1));e*=4,e=this.clamp(e),s*=e}s=Math.pow(s,this.data.expo),s=this.clamp(s),"road"===this.ttype&&(c===i?s=1===a||2===a||29===a||30===a?h+.1:h:(c=i,h=s)),this.height[f]=s,l=s*this.size[1]+this.deep,this.vertices[t+1]=l,n=this.isAbsolute?s:s*this.size[1],void 0!==this.zid[f]&&(o=this.zid[f],r=this.changeId?this.invId[o]:o,this.heightData[r]=n,this.verticesZ&&(this.verticesZ[3*o+1]=l)),u=this.isWater?[s*this.colorBase.r,s*this.colorBase.g,s*this.colorBase.b]:[s,0,0],b=u[0],this.colors[t]=b,this.colors[t+1]=b,this.colors[t+2]=b}if(this.isBorder){let e,a=this.lng2;for(;a--;)t=3*a,-1!==this.list[a]?(e=this.height[this.list[a]],this.borderVertices[t+1]=e*this.size[1]+this.deep,b=yt.clamp(e+.25,.25,1),this.borderColors[t]=b,this.borderColors[t+1]=b,this.borderColors[t+2]=b):(this.borderColors[t]=this.colorBase.r,this.borderColors[t+1]=this.colorBase.g,this.borderColors[t+2]=this.colorBase.b)}e?this.needUpdate=!0:this.updateGeometry(),this.ready&&this.physicsUpdate(this.name,this.heightData),this.ready=!0}step(e){this.needUpdate&&(this.updateGeometry(),this.needUpdate=!1)}updateGeometry(){this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0,this.geometry.computeVertexNormals(),this.updateUv(),this.geometryZ&&(this.geometryZ.attributes.position.needsUpdate=!0),this.isBorder&&(this.borderGeometry.attributes.position.needsUpdate=!0,this.borderGeometry.attributes.color.needsUpdate=!0)}}const vt={fragmentAdd:"\n        uniform vec4 clevels;\n        uniform float randomUv;\n\n        uniform sampler2D noise;\n\n        uniform sampler2D normalMap1;\n        uniform sampler2D normalMap2;\n\n        uniform sampler2D roughnessMap1;\n        uniform sampler2D roughnessMap2;\n\n        uniform float aoMapIntensity;\n        uniform sampler2D map1;\n        uniform sampler2D map2;\n\n        vec4 textureMAP( sampler2D mapper, in vec2 uv ){\n            if( randomUv == 1.0 ) return textureNoTile( mapper, uv );\n            else return texture2D( mapper, uv );\n        }\n\n        vec4 MappingMix( float slope, vec4 level, vec4 rocks, vec4 grasss, vec4 sands ){\n            vec4 cc = rocks;\n            if (slope < level.x) cc = grasss;\n            if (slope < level.z) cc = sands;\n            if (slope == 0.0 ) cc = sands;\n            //if (( slope < level.x ) && (slope >= level.y)) cc = mix( grasss , rocks, (slope - level.y) * (1. / (level.x - level.y)));\n            //if (( slope < level.y ) && (slope >= level.z)) cc = mix( sands , grasss, (slope - level.z) * (1. / (level.y - level.z)));\n\n            float d = level.y;\n            float rx = 1.0/level.y;\n\n            if (( slope < level.x + d ) && (slope > level.x)) cc = mix( grasss , rocks, ( slope - (level.x) ) * rx );\n\n            d = level.w;\n            rx = 1.0/level.w;\n            if (( slope < level.z + d ) && (slope > level.z )) cc = mix( sands , grasss, ( slope - (level.z) ) * rx );\n\n            //cc = mix( grasss, cc, smoothstep(0.0,1.0, slope)*20.0 );\n            return cc;\n        }\n    ",map:"\n        #ifdef USE_MAP\n\n            vec4 sand = textureMAP( map, vMapUv );\n            vec4 grass = textureMAP( map1, vMapUv );\n            vec4 rock = textureMAP( map2, vMapUv ); \n\n            vec4 sampledDiffuseColor = MappingMix(vColor.r, clevels, rock, grass, sand);\n\n            diffuseColor *= sampledDiffuseColor;\n\n        #endif\n    ",normal:"\n\n        #ifdef USE_NORMALMAP_OBJECTSPACE\n\n            normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n            #ifdef FLIP_SIDED\n\n                normal = - normal;\n\n            #endif\n\n            #ifdef DOUBLE_SIDED\n\n                normal = normal * faceDirection;\n\n            #endif\n\n            normal = normalize( normalMatrix * normal );\n\n        #elif defined( USE_NORMALMAP_TANGENTSPACE )\n\n            vec4 sandN = textureMAP( normalMap, vNormalMapUv );\n            vec4 grassN = textureMAP( normalMap1, vNormalMapUv );\n            vec4 rockN = textureMAP( normalMap2, vNormalMapUv );\n            vec3 mapN = MappingMix(vColor.r, clevels, rockN, grassN, sandN).xyz * 2.0 - 1.0;\n\n            ///vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\n            mapN.xy *= normalScale;\n            normal = normalize( tbn * mapN );\n\n        #elif defined( USE_BUMPMAP )\n\n            normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n\n        #endif\n    ",alphamap:"\n        #ifdef USE_ALPHAMAP\n            diffuseColor.a = opacity +( texture2D( alphaMap, vAlphaMapUv ).g * opacity) * (1.0-opacity);\n        #endif\n    "},kt="\n\nuniform sampler2D noiseMap;\nuniform float useNoiseMap;\n\nfloat directNoise(vec2 p){\n    vec2 ip = floor(p);\n    vec2 u = fract(p);\n    u = u*u*(3.0-2.0*u);\n    \n    float res = mix(\n        mix(rand(ip),rand(ip+vec2(1.0,0.0)),u.x),\n        mix(rand(ip+vec2(0.0,1.0)),rand(ip+vec2(1.0,1.0)),u.x),u.y);\n    return res*res;\n}\n\nfloat sum( vec4 v ) { return v.x+v.y+v.z; }\n\nvec4 textureNoTile( sampler2D mapper, in vec2 uv ){\n\n    // sample variation pattern\n    float k = 0.0;\n    if( useNoiseMap == 1.0 ) k = texture2D( noiseMap, 0.005*uv ).x;\n    else k = directNoise( uv );\n    \n    // compute index    \n    float index = k*8.0;\n    float f = fract( index );\n\n    float ia = floor( index );\n    float ib = ia + 1.0;\n    // or\n    //float ia = floor(index+0.5); // suslik's method (see comments)\n    //float ib = floor(index);\n    //f = min(f, 1.0-f)*2.0;\n\n    // offsets for the different virtual patterns    \n    vec2 offa = sin(vec2(3.0,7.0)*ia); // can replace with any other hash    \n    vec2 offb = sin(vec2(3.0,7.0)*ib); // can replace with any other hash    \n\n    // compute derivatives for mip-mapping    \n    vec2 dx = dFdx(uv);\n    vec2 dy = dFdy(uv);\n    \n    // sample the two closest virtual patterns    \n    vec4 cola = textureGrad( mapper, uv + offa, dx, dy );\n    vec4 colb = textureGrad( mapper, uv + offb, dx, dy );\n\n    // interpolate between the two virtual patterns    \n    return mix( cola, colb, smoothstep(0.2,0.8,f-0.1*sum(cola-colb)) );\n\n}\n";let jt=null;class Mt extends ie{constructor(e){super(),this.motor=e,this.engine=this.motor.engine,this.Utils=this.motor.utils,jt=this.motor.mat,this.type="terrain",this.num=B[this.type]}step(e,t){let a,i=this.list.length;for(;i--;)a=this.list[i],a.step()}add(e={}){this.setName(e),"JOLT"===this.engine&&(e.isAbsolute=!0,e.isTurned=!1),"PHYSX"===this.engine&&(e.isAbsolute=!0,e.isTurned=!0),"HAVOK"===this.engine&&(e.isAbsolute=!0,e.isTurned=!0),"OIMO"!==this.engine&&(e.zone=e.zone||.25);const t=new wt(e);return jt.extendShader(t.material,t.material.onBeforeCompile),t.physicsUpdate=(e,t)=>{this.motor.flow.tmp.push({name:e,heightData:t})},this.addToWorld(t,e.id),this.motor.post({m:"add",o:At(t,this.engine)}),t}set(e={},t=null){null===t&&(t=this.byName(e.name)),null!==t&&t.set(e)}}const At=function(e,t){const a={name:e.name,type:e.type,pos:e.position.toArray(),quat:"PHYSX"===t?[0,0,0,1]:e.quaternion.toArray()};return"PHYSX"===t||"AMMO"===t||"HAVOK"===t||"JOLT"===t?(a.type="terrain",a.size=e.sizeZ,a.sample=e.sampleZ,a.zone=e.zone,a.heightData=e.heightData):(a.type="mesh",a.v=A.getVertex(e.geometry,"OIMO"===t),a.index="OIMO"===t?null:A.getIndex(e.geometry)),a};class St extends ie{constructor(e){super(),this.motor=e,this.Utils=this.motor.utils,this.type="solver"}step(e,t){let a,i=this.list.length;for(;i--;)a=t+i*B[this.type],this.list[i].update(e,a)}add(e={}){this.setName(e);let t=new Et(e,this.motor);return this.addToWorld(t,e.id),this.motor.post({m:"add",o:e}),t}set(e={}){}}class Et{constructor(e,t){this.motor=t,this.name=e.name,this.type="solver",this.needData=e.needData||!1,this.bones=[],this.joints=[],this.jid=0,this.speed=1}addBone(e){this.bones.push(e)}dispose(){this.motor.remove(this.bones,!0)}update(e,t){if(!this.needData)return;let a,i,s=this.joints.length;for(;s--;)i=t+7*s,a=this.joints[s],a.data.target.x=e[i+0],a.data.target.y=e[i+1],a.data.target.z=e[i+2],a.data.target.rx=e[i+3],a.data.target.ry=e[i+4],a.data.target.rz=e[i+5],a.data.target.count=e[i+6]}start(){this.motor.post({m:"startArticulation",o:{name:this.name}})}stop(){this.motor.post({m:"stopArticulation",o:{name:this.name}})}commonInit(){this.motor.post({m:"commonInitArticulation",o:{name:this.name}})}addJoint(e){this.jid=this.joints.length,e.name=e.name||this.name+"_Joint_"+this.jid,e.solver=this.name,void 0!==e.rot1&&(e.quat1=A.quatFromEuler(e.rot1),delete e.rot1),void 0!==e.rot2&&(e.quat2=A.quatFromEuler(e.rot2),delete e.rot2),"fixe"!==e.type&&this.joints.push(new Ft(e,this)),this.motor.post({m:"addSolverJoint",o:e})}driveJoints(e){let t,a,i=!1,s=this.joints.length,r=[];for(;s--;)t=this.joints[s],t.update(e),a=t.isDrive,t.nup&&r.push(t.nup),i=!!a||i;i?this.motor.change(r):this.resolve&&(this.resolve(),delete this.resolve)}setAngles(e,t){if(!e)return;let a=this.joints.length;for(;a--;)this.joints[a].pose(void 0!==e[a]?e[a]:0,void 0!==t?t:this.speed);return new Promise((e=>this.resolve=e))}}class Ft{constructor(e,t){if(this.name=e.name,this.solver=t,this.type="solverJoint",this.isDrive=!1,this.current=0,this.tmp=0,this.target=0,this.start=0,this.time=0,this.nup=null,this.data={target:{x:0,y:0,z:0,rx:0,ry:0,rz:0,count:0}},e.limits&&(this.driveType=e.limits[0][0],this.min=e.limits[0][1],this.max=e.limits[0][2]),e.position&&(e.target=e.position),e.target){let t,a=e.target.length;for(;a--;)t=e.target[a],this.data.target[t[0]]=t[1]}}start(){}pose(e,t){this.target=A.clamp(e,this.min,this.max),this.current=A.clamp(this.data.target[this.driveType],this.min,this.max),this.target!==this.current&&(this.start=this.current,this.tmp=0,this.time=t,this.isDrive=!0)}update(e){if(this.isDrive){this.tmp+=e*this.time;let t=this.tmp;t=t>1?1:t;let a=this.target;this.nup={name:this.name,drivesTarget:[[this.driveType,a]]},1===t&&(this.isDrive=!1)}else this.nup=null}}class zt{constructor(e){this.map=new Map,this.motor=e,this.enginReady=["PHYSX","HAVOK","OIMO"],this.rc=this.refresh.bind(this)}reset(){this.map=new Map}step(){this.map.forEach(this.rc)}refresh(e,t){let a=this.motor.reflow.contact[t];if(void 0!==a)for(let t=0,i=a.length;t<i;t++)e.userData.collisionCallback?e.userData.collisionCallback(a[t]):e.dispatchEvent({type:"collision",data:a[t]})}isReady(){return-1!==this.enginReady.indexOf(this.motor.engine)}remove(e){this.isReady()&&this.map.has(e)&&(this.map.delete(e),this.motor.post({m:"removeCollision",o:{name:e}}))}add(e){if(!this.isReady())return;let t=e.name,a=this.motor.byName(t);null!==a&&(e.vs&&e.vs.constructor!==Array&&(e.vs=[e.vs]),e.ignore&&e.ignore.constructor!==Array&&(e.ignore=[e.ignore]),e.callback&&(a.userData.collisionCallback=e.callback,delete e.callback),this.map.set(t,a),this.motor.post({m:"addCollision",o:e}))}}const Rt=e=>e?.reduce(((e,t)=>e+t),0)/e.length;class Pt{constructor(){this.chartLen=60,this.frame=0,this.frameG=0,this.gpuAccums=[],this.activeAccums=[],this.queryCreated=!1,this.queryHasResult=!1,this.withGpu=!0,this.reset()}reset(){this.msChart=new Array(this.chartLen).fill(0),this.fpsChart=new Array(this.chartLen).fill(0),this.gpuChart=new Array(this.chartLen).fill(0)}up(e){this.msChart[this.frame]=e.ms,this.fpsChart[this.frame]=e.fps,this.frame++,this.frame===this.chartLen&&(this.frame=0)}setRenderer(e){this.withGpu&&(this.gl=e.getContext(),this.extension=this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),null!==this.extension&&this.startGpu())}upGpu(){let e=this.startGpu(this.frameG);e&&(this.gpuChart[this.frameG]=e,this.frameG++,this.frameG===this.chartLen&&(this.frameG=0)),this.endGpu()}startGpu(){const e=this.gl,t=this.extension;if(!e||!t)return;let a,i,s=!1,r=null;if(this.query){this.queryHasResult=!1;let n=this.query;if(s=e.getQueryParameter(n,e.QUERY_RESULT_AVAILABLE),a=e.getParameter(t.GPU_DISJOINT_EXT),s&&!a){i=e.getQueryParameter(this.query,e.QUERY_RESULT);const t=1e-6*i;this.gpuAccums[0]=t,(s||a)&&(e.deleteQuery(this.query),n=null),s&&t>0&&(a||(r=t))}}return!s&&this.query||(this.queryCreated=!0,this.query=e.createQuery(),e.beginQuery(t.TIME_ELAPSED_EXT,this.query)),r}endGpu(){const e=this.extension,t=this.gl;this.queryCreated&&t.getQuery(e.TIME_ELAPSED_EXT,t.CURRENT_QUERY)&&t.endQuery(e.TIME_ELAPSED_EXT)}get ms(){return Rt(this.msChart)}get fps(){return Rt(this.fpsChart)}get gpu(){return Rt(this.gpuChart)}}class Tt extends t.Mesh{constructor(e={}){super(new t.PlaneGeometry,new t.MeshBasicMaterial({polygonOffset:!0,polygonOffsetFactor:-4})),this.name=e.nam||"text",this.canvas=null,this.w=e.w||0,this.h=e.h||0,this.weight=e.weight??700,this.font=e.font??"'Mulish', sans-serif",this.fontSize=e.fontSize??32,this.backgroundColor=e.backgroundColor??"#00000000",this.fontColor=e.color??"#FFFFFF",this.material.alphaTest=.5,this.set(e.text),e.pos&&this.position.fromArray(e.pos),e.rot&&this.quaternion.fromArray(A.quatFromEuler(e.rot))}set(e){this.canvas||(this.canvas=document.createElement("canvas"));let a,i,s,r=this.canvas.getContext("2d");r.font=this.weight+" "+this.fontSize+"px "+this.font;let n=r.measureText(e);a=2**Math.ceil(Math.log2(n.width)),i=2**Math.ceil(Math.log2(r.measureText("M").width)),this.canvas.width=a,this.canvas.height=i,r.fillStyle=this.backgroundColor,r.fillRect(0,0,a,i),r.fillStyle=this.fontColor,r.font=this.weight+" "+this.fontSize+"px "+this.font,r.textAlign="center",r.textBaseline="middle",r.fillText(e,.5*a,.5*i),this.material.map=new t.CanvasTexture(this.canvas),0!==this.h?(s=this.h/i,this.scale.set(a*s,this.h,0)):0!==this.w?(s=this.w/i,this.scale.set(this.w,i*s,0)):this.scale.set(.025*a,.025*i,0)}dispose(){this.parent.remove(this),this.material.map.dispose(),this.material.dispose(),this.geometry.dispose()}}let It=0;class Bt{constructor(e={},t){this.motor=t,this.down=!1,this.time=e.time||250,this.p=e.pos||[0,0,0],this.type=e.type||"box",this.name=e.name||"button"+It++,this.pos=e.pos||[0,0,0],this.size=e.size||[1,1,1],this.radius=e.radius||0,this.axe=void 0!==e.axe?e.axe:1,this.fontSize=e.fontSize||.8,this.fontScale=e.fontScale||1,this.extraForce=!0,this.decal="sphere"===this.type?.5*this.size[1]:.5*this.size[1]-this.radius,"sphere"!==this.type&&(this.pos[this.axe]+=this.decal),this.origin=this.pos[this.axe];let a=this.size[this.axe]-2*this.radius;this.range=[this.origin-a,this.origin],this.value=this.origin,this.target=this.origin,this.speed=this.size[this.axe]/3/this.size[this.axe],this.callback=function(){console.log("action down")},e.callback&&(this.callback=e.callback,delete e.callback),e.button=!0,e.pos=this.pos,e.material||(e.material="button"),e.kinematic=!0,e.mask=1,this.timeout=null,this.b=this.motor.add(e),this.b.userData.action=this.action.bind(this),this.b.userData.out=this.out.bind(this),this.b.userData.direct=this.callback.bind(this),e.text&&this.addText(e.text)}addText(e,t){this.fontSize="box"===this.type?.8*this.size[this.axe]:.8*this.size[0],this.fontSize*=this.fontScale;let a={text:e,pos:[0,.5*this.size[1],0],rot:[-90,0,0],h:this.fontSize};2===this.axe&&(a={text:e,pos:[0,0,.5*this.size[2]],rot:[0,0,0],h:this.fontSize}),this.txt=new Tt(a),this.b.add(this.txt)}action(e){this.down||(this.down=!0,this.target=this.range[0],this.extraForce&&this.motor.explosion(e||this.p,2*this.size[0],.01),this.callback())}out(){this.down&&(this.down=!1,this.target=this.range[1],this.extraForce&&this.motor.explosion(this.p,2*this.size[0],.01))}update(){if(this.value!==this.target){this.value=A.lerp(this.value,this.target,this.speed),A.nearEquals(this.value,this.target,1e-4)?this.value=this.target:(this.pos[this.axe]=this.value,this.motor.change({name:this.b.name,pos:this.pos}))}}dispose(){this.txt&&this.txt.dispose()}}class Ct{constructor(e,a="drag",i){this.motor=i,this.needRay=!1,this.moveDirect=!1,this.moveDeep=!1,this.mode=a,this.option={},this.overObj=null,this.controler=e,this.dom=this.controler.domElement,this.selected=null,this.buttonRef=null,this.release=!1,this.numBullet=0,this.maxBullet=10,this.sticky=!1,this.pz=0,this.isActive=!1,this.raycastTest=!1,this.firstSelect=!1,this.mouseDown=!1,this.mouseDown2=!1,this.mouseMove=!1,this.decal=new t.Vector3,this.tmpPos=new t.Vector3,this.tmpD=new t.Vector3,this.mouse=new t.Vector2,this.oldMouse=new t.Vector2,this.raycast=new t.Raycaster,this.raycast.far=1e3,this.button=0,this.pos=new t.Vector3,this.velocity=new t.Vector3,this.angle=0,this.helper=null,this.dragPlane=null,this.overLock=!1,this.activeDragMouse(!0)}addDrag(){this.dragPlane||(this.floorDrag=2===this.button,this.helper=new Dt(this.motor),this.dragPlane=new t.Mesh(new t.PlaneGeometry(1,1),this.motor.mat.get("hide")),this.floorDrag&&this.dragPlane.geometry.rotateX(.5*-Math.PI),this.dragPlane.castShadow=!1,this.dragPlane.receiveShadow=!1,this.dragPlane.scale.set(1,1,1).multiplyScalar(200),this.motor.scenePlus.add(this.helper),this.motor.scenePlus.add(this.dragPlane))}clearDrag(){this.dragPlane&&(this.motor.scenePlus.remove(this.dragPlane),this.motor.scenePlus.remove(this.helper),this.dragPlane.geometry.dispose(),this.helper.geometry.dispose(),this.dragPlane=null,this.helper=null)}setMode(e,t={}){e!==this.mode&&(this.mode=e,this.option=t,"blast"===this.mode&&this.option.visible&&this.motor.initParticle())}activeDragMouse(e){e?this.isActive||(this.dom.addEventListener("pointermove",this.mousemove.bind(this),!1),this.dom.addEventListener("pointerdown",this.mousedown.bind(this),!1),document.addEventListener("pointerup",this.mouseup.bind(this),!1),this.controler.addEventListener("end",this.controleEnd.bind(this),!1),this.controler.addEventListener("start",this.controleStart.bind(this),!1),this.isActive=!0,this.raycastTest=!0):this.isActive&&(this.dom.removeEventListener("pointermove",this.mousemove.bind(this)),this.dom.removeEventListener("pointerdown",this.mousedown.bind(this)),document.removeEventListener("pointerup",this.mouseup.bind(this)),this.controler.removeEventListener("end",this.controleEnd.bind(this)),this.controler.removeEventListener("start",this.controleStart.bind(this),!1),this.isActive=!1)}controleEnd(e){this.raycastTest=!0,this.controler.getInfo&&this.controler.getInfo()}controleStart(e){this.raycastTest=!1}controleChange(e){}getMouse(e){this.motor.viewSize?(this.mouse.x=e.offsetX/this.motor.viewSize.w*2-1,this.mouse.y=-e.offsetY/this.motor.viewSize.h*2+1):(this.mouse.x=e.offsetX/this.dom.clientWidth*2-1,this.mouse.y=-e.offsetY/this.dom.clientHeight*2+1),this.button="touch"!==e.pointerType?e.button:0}contextmenu(e){}mousedown(e){switch(this.sticky&&(this.unSelect(),console.log("unstick")),this.getMouse(e),this.mode){case"drag":this.drag();break;case"shoot":this.shoot();break;case"blast":this.blast();break;case"build":this.build()}}mouseup(e){this.release=!0,document.body.style.cursor="auto",this.mouseMove=!(this.oldMouse.distanceTo(this.mouse)<.01),this.mouseDown=!1,this.mouseDown2=!1,this.sticky?this.controler.enabled=!0:(this.unSelect(),this.resetButton())}mousemove(e){if("drag"===this.mode)this.getMouse(e),this.needRay=!0}castray(){let e,t,a,i,s,r="auto";if(null!==this.selected)this.raycast.setFromCamera(this.mouse,this.controler.object),e=this.raycast.intersectObject(this.dragPlane),e.length&&this.mouseDown&&this.moveSelect(e[0].point);else{if(!this.raycastTest)return;this.controler.enableRotate=!1,this.controler.enablePan=!1,this.raycast.setFromCamera(this.mouse,this.controler.object),e=this.raycast.intersectObjects(this.motor.scene.children,!0),this.tmpSelected=null,e.length>0?(a=e[0].object,a.isInstancedMesh?(s=e[0].instanceId,t=this.motor.byName(a.getIDName(s))):a.parent!==this.motor.scene?(i=a.parent,t=i.parent!==this.motor.scene?i.parent:i):t=a,this.mouseDown2&&t.extra&&t.extra(t.name),r=t&&!t.isButton?this.select(t,e[0].point):this.actionButton(t,e[0])):(this.resetOver(),this.controler.enableRotate=!0,this.controler.enablePan=!0),this.release&&(this.release=!1,this.controler.enableRotate=!0,this.controler.enablePan=!0,r="auto",this.resetOver()),document.body.style.cursor=r}}drag(){this.mouseDown||(this.firstSelect&&(this.firstSelect=!1),this.oldMouse.copy(this.mouse)),2===this.button&&(this.mouseDown2=!0),this.mouseDown=!0,this.needRay=!0}blast(){let e=null;this.raycast.setFromCamera(this.mouse,this.controler.object);let t=this.raycast.intersectObjects(this.motor.scene.children,!0);t.length>0?t[0].object.isButton?t[0].object.parent.userData.direct():e=t[0]:(t=this.raycast.intersectObjects(this.motor.scenePlus.children,!0),t.length>0&&(e=t[0]));const a=this.option;e&&(this.motor.explosion(e.point,a.radius||3,a.power||.1),a.visible&&this.motor.addParticle({name:"blast",type:"cube",position:e.point.toArray(),numParticles:60,radius:.2,radiusRange:.1,acceleration:[50,5,50],lifeTime:.5,endTime:.5,startTime:0,gravity:[0,.2,0],startSize:.5,endSize:.1,tween:"outQuad"}))}shoot(){const e=this.option;this.raycast.setFromCamera(this.mouse,this.controler.object),this.pos.copy(this.raycast.ray.direction).add(this.raycast.ray.origin),this.velocity.copy(this.raycast.ray.direction).multiplyScalar(e.velocity||60),this.motor.add({name:"bullet_"+this.numBullet,type:"sphere",mass:e.mass||10,size:[e.size||.2],material:e.mat||"chrome",pos:this.pos.toArray(),linearVelocity:this.velocity.toArray(),bullet:!0}),this.numBullet++,this.numBullet>this.maxBullet&&(this.numBullet=0)}resetButton(){this.buttonRef&&(this.buttonRef.userData.out&&this.buttonRef.userData.out(),this.buttonRef=null),this.raycastTest=!0,this.selected=null,this.firstSelect=!0,this.controler.enableRotate=!0,this.controler.enablePan=!0}actionButton(e,t){if(this.buttonRef?this.buttonRef.name!==e.name&&(this.buttonRef.userData.out&&this.buttonRef.userData.out(),this.buttonRef=e):this.mouseDown&&(this.buttonRef=e),this.mouseDown&&this.buttonRef.userData.action){let e=t.point;this.buttonRef.userData.action(e)}return"pointer"}setOver(e){e&&(this.overObj&&e.name!==this.overObj.name&&this.resetOver(),this.overObj=e,this.overObj.over&&this.overObj.over(!0))}resetOver(){this.overObj&&(this.overObj.over&&this.overObj.over(!1),this.overObj=null)}select(e,t){if(this.mouseDown||this.setOver(e),!this.mouseDown||this.selected===e)return"grab";this.pz=0;let a=t,i=[0,0,0,1];this.selected=e,this.decal.copy(a).sub(this.selected.position),this.tmpPos.copy(a).sub(this.decal),this.angle=this.controler.getAzimuthalAngle(),i=this.selected.quaternion.toArray(),this.addDrag(),this.dragPlane.rotation.set(0,this.angle,0),this.dragPlane.position.copy(a),this.helper.position.copy(a);let s=a.toArray(),r=!1;this.motor.change({name:this.selected.name,neverSleep:!0,wake:!0});const n=this.motor.engine;if(this.moveDirect)this.motor.change({name:this.selected.name,kinematic:!1,gravity:!1,damping:[.9,.9]});else{let e=[-.1,.1,600,1],t=[-.1,.1,600,1],a="OIMO"===n||"RAPIER"===n||"JOLT"===n,o=0===this.selected.link?"fixe":"d6";"JOLT"===n&&(o="fixe");let c=[["x",...e],["y",...e],["z",...e],["rx",...t],["ry",...t],["rz",...t]];"HAVOK"===n&&(c=[["x",...e],["y",...e],["z",...e]]),"OIMO"===n&&(r=!0,o=0===this.selected.link?"fixe":"spherical",c=[["x",...e],["y",...e],["z",...e]]),"HAVOK"===n&&(o=0===this.selected.link?"fixe":"spherical",c=[-180,180,.1,.1]),this.motor.add([{name:"mouse",type:"null",pos:s,quat:i,kinematic:!a},{name:"mouseJoint",type:"joint",mode:o,lm:c,sd:[4,1],autoDrive:!0,b1:r?this.selected.name:"mouse",b2:r?"mouse":this.selected.name,worldAnchor:s,visible:!1}])}return"grabbing"}moveSelect(e){if(null===this.selected)return;if(e&&this.tmpPos.copy(e).sub(this.decal),this.moveDeep){let e=this.selected.position.y,t=e-this.tmpPos.y;this.tmpPos.y=e,this.tmpD.set(0,0,t).applyAxisAngle({x:0,y:1,z:0},this.angle),this.tmpPos.add(this.tmpD)}this.helper.position.copy(this.tmpPos);let t=this.tmpPos.toArray();this.moveDirect?this.motor.change({name:this.selected.name,pos:t,reset:!0}):this.motor.change({name:"mouse",pos:e.toArray(),lockPos:!0},!0)}unSelect(){null!==this.selected&&(this.resetOver(),this.clearDrag(),this.moveDirect?this.motor.change({name:this.selected.name,kinematic:!1,wake:!0,gravity:!0,damping:[0,.1]}):(this.motor.remove(["mouseJoint","mouse"]),this.motor.change({name:this.selected.name,neverSleep:!1,wake:!0})),this.raycastTest=!0,this.selected=null,this.firstSelect=!0)}step(){if(this.needRay&&this.castray(),this.needRay=!1,null===this.selected)return;let e=this.motor.flow.key;if(0!==e[1]){let t=.1*e[1];this.dragPlane.translateZ(t),this.needRay=!0}this.moveDirect&&this.moveSelect()}}class Dt extends t.Line{constructor(e){super(new t.BufferGeometry,e.mat.get("line"));let a=.75;const i=[a,a,a,0,0,0];this.geometry.setAttribute("position",new t.Float32BufferAttribute([0,0,0,0,-100,0],3)),this.geometry.setAttribute("color",new t.Float32BufferAttribute(i,3)),this.vertices=this.geometry.attributes.position,this.colors=this.geometry.attributes.color,this.local=[0,0,0,0,0,0,0,0,0],this.frustumCulled=!1}}const Lt=new t.Vector3;new t.Vector3;const Ot=new t.Vector3,qt=new t.Vector3,Vt=new t.Vector3,Gt=new t.Vector3,Ht=new t.Vector3;class _t{constructor(e={},a){this.first=!0,this.debug=e.debug||!1,this.motor=a,this.name=e.name||"ppp",this.pMass=e.pMass||.01,this.vSize=e.vSize||.16,this.pSize=e.pSize||.02,this.particles=[],this.density=e.density||.01,this.smoothMulty=e.smoothMulty||1,this.smoothing=e.smoothing||.2,this.smoothing*=this.smoothMulty,this.speed=e.speed||.1,this.viscosity=e.viscosity||.03,this.eps=1e-6,this.group=256,this.pressures=[],this.densities=[],this.neighbors=[],this.maxDist=0,this.tv=new t.Vector3,this.tv2=new t.Vector3,e.mesh&&this.setMesh(e.mesh,e.crossEdge)}setMesh(e,t=!1){const a=[],i=[];this.mesh=e,this.geometry=e.geometry,this.geometry.getIndex();const s=this.geometry.getAttribute("position").array,r=A.getHash(this.geometry),n=A.getFaces(this.geometry),o=t?A.getConnectedFaces(n):null;let c,h,l,b,d,u;for(let e in r)c=r[e][0],h=3*c,Lt.set(s[h],s[h+1],s[h+2]),this.mesh.localToWorld(Lt),this.add(Lt.toArray());for(let e=0;e<n.length;e++)l=n[e],b=this.getKey(r,l[0]),d=this.getKey(r,l[1]),u=this.getKey(r,l[2]),this.sameLink(a,b,d)||a.push([b,d]),this.sameLink(a,d,u)||a.push([d,u]),this.sameLink(a,u,b)||a.push([u,b]);if(this.connect(a),o){for(let e=0;e<o.length;e++)l=o[e],b=this.getKey(r,l[0]),d=this.getKey(r,l[1]),this.sameLink(a,b,d)||this.sameLink(i,b,d)||i.push([b,d]);this.connect(i,!0)}this.hash=r,this.mesh.position.set(0,0,0),this.mesh.quaternion.set(0,0,0,1),this.mesh.receiveShadow=!0,this.mesh.castShadow=!0,phy.addDirect(this.mesh)}updateMesh(){if(!this.geometry)return;let e,t,a,i=this.hash,s=this.geometry.attributes.position.array,r=this.particles.length;for(;r--;)for(t=this.particles[r],a=i[r].length;a--;)e=3*i[r][a],s[e]=t.position.x,s[e+1]=t.position.y,s[e+2]=t.position.z;this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeVertexNormals(),this.geometry.computeBoundingSphere()}add(e){let a=this.motor.add({instance:this.name,type:"particle",size:[this.vSize],pSize:this.pSize,pos:e,inertia:[0,0,0],mass:this.pMass,restitution:0,friction:.5,damping:[.2,.1],material:this.debug?"particle":"hide",shadow:!1,getVelocity:!0});this.first=!1,a.force=new t.Vector3,this.particles.push(a),this.neighbors.length<this.particles.length&&this.neighbors.push([])}connect(e,t){let a,i,s,r=e.length,n=[],o=0;for(;r--;){if(a=e[r],this.name,a[0],this.name,a[1],i=this.particles[a[0]].position,s=this.particles[a[1]].position,o=this.tv.copy(i).distanceTo(s),t){if(o>this.maxDist)continue}else o>this.maxDist&&(this.maxDist=o);this.tv.copy(s).sub(i),n.push({type:"distance",helperSize:.03,b1:this.name+a[0],b2:this.name+a[1],limit:[.5*o,o],spring:[20,1],collision:!0,noPreProcess:!0,alway:!0})}this.motor.add(n)}getPosition(){let e,t,a=[],i=this.particles.length;for(;i--;)t=3*i,e=this.particles[i],a[t]=e.position.x,a[t+1]=e.position.y,a[t+2]=e.position.z;return a}getNeighbors(e,t){const a=this.particles.length,i=e.idx,s=this.smoothing*this.smoothing;let r=0;for(let n=0;n!==a;n++){const a=this.particles[n];r=this.distanceSq(a,e),i!==a.idx&&r<s&&t.push(a)}}distance(e,t){const a=e.position.x-t.position.x,i=e.position.y-t.position.y,s=e.position.z-t.position.z;return Math.sqrt(a*a+i*i+s*s)}distanceSq(e,t){const a=e.position.x-t.position.x,i=e.position.y-t.position.y,s=e.position.z-t.position.z;return a*a+i*i+s*s}w(e){const t=this.smoothing;return 315/(64*Math.PI*Math.pow(t,9))*Math.pow(t*t-e*e,3)}gradw(e,t){const a=e.length(),i=this.smoothing,s=945/(32*Math.PI*Math.pow(i,9))*Math.pow(i*i-a*a,2);t.copy(e).multiplyScalar(s)}nablaw(e){const t=this.smoothing;return 945/(32*Math.PI*Math.pow(t,9))*(t*t-e*e)*(7*e*e-3*t*t)}getKey(e,t){let a;for(let i in e)if(a=e[i],-1!==a.indexOf(t))return i}sameLink(e,t,a){let i,s=e.length,r=!1;for(;s--;)i=e[s],t===a&&(r=!0),t===i[0]&&a===i[1]&&(r=!0),t===i[1]&&a===i[0]&&(r=!0);return r}update(){const e=[],t=this.particles.length,a=this.speed,i=this.eps;let s;for(let e=0;e!==t;e++){const t=this.particles[e];t.force.set(0,0,0);const i=this.neighbors[e];i.length=0,this.getNeighbors(t,i),i.push(this.particles[e]);let r=0;for(s=i.length;s--;){const e=this.w(this.distance(t,i[s]));r+=i[s].mass*e}this.densities[e]=r,this.pressures[e]=a*a*(this.densities[e]-this.density)}const r=Ot,n=qt,o=Vt,c=Gt,h=Ht;let l,b;for(let a=0;a!==t;a++){const t=this.particles[a];let s,d;r.set(0,0,0),n.set(0,0,0);const u=this.neighbors[a],f=u.length;for(let e=0;e!==f;e++)l=u[e],c.copy(t.position).sub(l.position),b=c.length(),s=-l.mass*(this.pressures[a]/(this.densities[a]*this.densities[a]+i)+this.pressures[e]/(this.densities[e]*this.densities[e]+i)),this.gradw(c,o),o.multiplyScalar(s),r.add(o),h.copy(l.velocity).sub(t.velocity),h.multiplyScalar(1/(1e-4+this.densities[a]*this.densities[e])*this.viscosity*l.mass),d=this.nablaw(b),h.multiplyScalar(d),n.add(h);n.multiplyScalar(t.mass),r.multiplyScalar(t.mass),t.force.add(n),t.force.add(r),e.push({name:t.name,force:t.force.toArray()})}this.motor.change(e),this.updateMesh()}}const Nt=Math.max(1e-9,Number.EPSILON),Ut=.5*Nt,Kt=Math.log10(1/Nt),Jt=Math.pow(10,Kt),Wt=Ut*Jt;function Xt(e,t,a,i){return function(e,t,a,i,s){let r=t.x-e.x,n=t.y-e.y,o=i.x-a.x,c=i.y-a.y;const h=ea(e),l=ea(a);if(h===l)return s;const b=ea(t);if(b===l)return s;const d=ea(i);if(h===d)return s;if(b===d)return s;let u=(e.x-a.x)*c-(e.y-a.y)*o,f=(t.x-a.x)*c-(t.y-a.y)*o,m=(a.x-e.x)*n-(a.y-e.y)*r,p=(i.x-e.x)*n-(i.y-e.y)*r;return(u>=0&&f<=0||u<=0&&f>=0)&&(m>=0&&p<=0||m<=0&&p>=0)}(e,t,a,i,!1)}function Qt(e,a,i,s){let r=0,n=new t.Vector3;return ta(e)===ta(a)||0===i.x&&0===i.y&&0===i.z?null:(r=((s.x-e.x)*i.x+(s.y-e.y)*i.y+(s.z-e.z)*i.z)/((a.x-e.x)*i.x+(a.y-e.y)*i.y+(a.z-e.z)*i.z),r>=0&&r<=1?(n=new t.Vector3(e.x+(a.x-e.x)*r,e.y+(a.y-e.y)*r,e.z+(a.z-e.z)*r),{x:n,s:r}):null)}function Yt(e,t,a){return(t.x-e.x)*(a.y-e.y)-(t.y-e.y)*(a.x-e.x)<=0}function Zt(e){return~~(e*Jt+Wt)}function $t(e,t){return Math.round((e+t)*(e+t+1)*.5+t)}function ea(e){return $t(Zt(e.x),Zt(e.y))}function ta(e){return function(e,t,a){const i=(e+t)*(e+t+1)*.5+t;return(i+a)*(i+a+1)*.5+a}(Zt(e.x),Zt(e.y),Zt(e.z))}function aa(e,t,a){return t.x*(e.x-a.x)+t.y*(e.y-a.y)+t.z*(e.z-a.z)>=0}class ia{constructor(e=new t.Vector3,a=new t.Vector3,i=new t.Vector2){this.position=e,this.normal=a,this.uv=i}clone(e){return new ia(this.position.clone(),this.normal.clone(),this.uv.clone())}equals(e){return ta(this.position)===ta(e.position)}toString(){return`Position = ${this.position.x}, ${this.position.y}, ${this.position.z}, Normal = ${this.normal.x}, ${this.normal.y}, ${this.normal.z}, UV = ${this.uv.x}, ${this.uv.y}`}}let sa=class{constructor(e=null){this.isFragment=!0,this.vertices=[],this.cutVertices=[],this.triangles=[[],[]],this.constraints=[],this.indexMap=[],this.bounds=new t.Box3,this.vertexAdjacency=[],this.convextested=!1,this.minSize=.005,this.good=!0,null!==e&&this.fromArgs(e)}fromArgs(e){const{positions:a,normals:i,uvs:s,indices:r}=e;for(let e=0;e<a.length/3;e++){const r=new t.Vector3(a[3*e],a[3*e+1],a[3*e+2]),n=new t.Vector3(i[3*e],i[3*e+1],i[3*e+2]),o=s?new t.Vector2(s[2*e],s[2*e+1]):new t.Vector2(0,0);this.vertices.push(new ia(r,n,o))}if(r)this.triangles=[Array.from(r),[]];else{const e=a.length/3;this.triangles=[Array.from({length:e},((e,t)=>t)),[]]}this.calculateBounds()}get valid(){let e=this.triangleCount>6&&this.vertexCount>14;return this.volume()<this.minSize&&(e=!1),e}get size(){this.bounds||this.calculateBounds();let e=new t.Vector3;return this.bounds.getSize(e)}get convex(){return this.convextested||(this.cc=this.isConvex()),this.cc}get triangleCount(){return(this.triangles[0].length+this.triangles[1].length)/3}get vertexCount(){return this.vertices.length+this.cutVertices.length}addCutFaceVertex(e,t,a){const i=new ia(e,t,a);this.vertices.push(i),this.cutVertices.push(i),this.vertexAdjacency.push(this.vertices.length-1)}addMappedVertex(e,t){this.vertices.push(e),this.indexMap[t]=this.vertices.length-1}addTriangle(e,t,a,i){this.triangles[i].push(e,t,a)}addMappedTriangle(e,t,a,i){this.triangles[i].push(this.indexMap[e],this.indexMap[t],this.indexMap[a])}weldCutFaceVertices(){const e=[],t=[],a=new Array(this.cutVertices.length);let i=0;const s=new Map;this.cutVertices.forEach(((r,n)=>{const o=ta(r.position),c=s.get(o);s.has(o)?a[n]=c:(a[n]=i,s.set(o,i),e.push(this.cutVertices[n]),t.push(this.vertexAdjacency[n]),i++)}));const r=[];for(let e=0;e<this.constraints.length;e++){const t=this.constraints[e];t.v1=a[t.v1],t.v2=a[t.v2],Math.abs(t.v1-t.v2)<1e-9||r.push(t)}this.constraints=r,this.cutVertices=e,this.vertexAdjacency=t}volume(){let e=[];this.vertices.forEach((t=>{e.push(t.position.x,t.position.y,t.position.z)})),this.cutVertices.forEach((t=>{e.push(t.position.x,t.position.y,t.position.z)}));let t,a=e.length/3,i=[0,0,0],s=[0,0,0];for(;a--;)t=3*a,e[t]<i[0]?i[0]=e[t]:e[t]>s[0]&&(s[0]=e[t]),e[t+1]<i[1]?i[1]=e[t+1]:e[t+1]>s[1]&&(s[1]=e[t+1]),e[t+2]<i[2]?i[2]=e[t+2]:e[t+2]>s[2]&&(s[2]=e[t+2]);let r=[s[0]-i[0],s[1]-i[1],s[2]-i[2]];return.5*r[0]*8*(.5*r[1])*(.5*r[2])}calculateBounds(){if(!this.vertices.length)return;let e=this.vertices[0].position.clone(),a=e.clone();this.vertices.forEach((t=>{e.x=Math.min(e.x,t.position.x),e.y=Math.min(e.y,t.position.y),e.z=Math.min(e.z,t.position.z),a.x=Math.max(a.x,t.position.x),a.y=Math.max(a.y,t.position.y),a.z=Math.max(a.z,t.position.z)})),this.bounds=new t.Box3(e,a)}toMesh(e,a=null,i=!0,s=0){const r=new t.Vector3,n=new t.Vector3;let o=this.toGeometry(i,s);o.boundingBox.getCenter(r),o.boundingBox.getSize(n),o.translate(-r.x,-r.y,-r.z),o.boundingSphere=new t.Sphere(new t.Vector3,.5*n.length());let c=e.material;a&&c.isMaterial&&(c=[e.material,a]);const h=new t.Mesh(o,c);return h.receiveShadow=e.receiveShadow,h.castShadow=e.castShadow,h.matrixAutoUpdate=e.matrixAutoUpdate,h.frustumCulled=e.frustumCulled,h.renderOrder=e.renderOrder,h.sizer=n.length(),r.applyQuaternion(e.quaternion),h.position.copy(e.position).add(r),h.quaternion.copy(e.quaternion),h.userData={origin:h.position.clone(),direction:r.normalize(),size:n},h}makeTrickness(e,t,a,i,s){let r,n=1-s,o=[...e],c=[...t],h=[...a],l=e.length/3,b=l;for(;b--;)r=3*b,o[r]*=n,o[r+1]*=n,o[r+2]*=n;let d=[];for(b=i.length;b--;)d[b]=i[b]+l;return[o,c,h,d]}toGeometry(e,a){let i;const s=new t.BufferGeometry;let r=[],n=[],o=[];if(this.vertices.forEach((e=>{r.push(e.position.x,e.position.y,e.position.z),n.push(e.normal.x,e.normal.y,e.normal.z),o.push(e.uv.x,e.uv.y)})),0!==a){let e=this.makeTrickness(r,n,o,this.triangles[0],a);r=r.concat(e[0]),n=n.concat(e[1]),o=o.concat(e[2]),i=e[3]}return e&&this.cutVertices.forEach((e=>{r.push(e.position.x,e.position.y,e.position.z),n.push(e.normal.x,e.normal.y,e.normal.z),o.push(e.uv.x,e.uv.y)})),s.addGroup(0,this.triangles[0].length,0),0!==a&&(s.addGroup(this.triangles[0].length,i.length,1),this.triangles[0]=this.triangles[0].concat(i)),e&&s.addGroup(this.triangles[0].length,this.triangles[1].length,1),s.setAttribute("position",new t.BufferAttribute(new Float32Array(r),3)),s.setAttribute("normal",new t.BufferAttribute(new Float32Array(n),3)),s.setAttribute("uv",new t.BufferAttribute(new Float32Array(o),2)),s.setIndex(new t.BufferAttribute(new Uint32Array(this.triangles.flat()),1)),s.computeBoundingBox(),s}isConvex(e=.001){this.convextested=!0;let a=0;const i=this.triangleCount,s=[...this.triangles[0],...this.triangles[1]],r=[...this.vertices,...this.cutVertices],n=r.length;if(0===i||0===n)return!1;const o=new t.Vector3,c=new t.Vector3,h=new t.Vector3,l=new t.Vector3,b=new t.Vector3;let d,u;for(let t=0;t<i;t++){a=3*t,b.copy(r[0].position),o.copy(r[s[a]].position),c.copy(r[s[a+1]].position),h.copy(r[s[a+2]].position),c.sub(o),h.sub(o),l.copy(c).cross(h).normalize(),d=b.sub(o).dot(l);for(let t=0;t<n;t++)if(u=b.copy(r[t].position).sub(o).dot(l),Math.abs(d)>e&&Math.abs(u)>e&&d*u<0)return!1}return!0}},ra=class e{constructor(e,t,a=-1,i=-1,s=0){this.v1=e,this.v2=t,this.t1=a,this.t2=i,this.t1Edge=s}clone(){return new e(this.v1,this.v2,this.t1,this.t2,this.t1Edge)}equals(e){return this.v1===e.v1&&this.v2===e.v2||this.v1===e.v2&&this.v2===e.v1}toString(){return`Edge: T${this.t1}->T${this.t2} (V${this.v1}->V${this.v2})`}},na=class{static getBinNumber(e,t,a){return e%2==0?e*a+t:(e+1)*a-t-1}static sort(e,t,a){if(a<=1)return e;t>e.length&&(t=e.length);const i=new Array(a).fill(0),s=new Array(e.length);for(let a=0;a<t;a++)i[e[a].bin]++;for(let e=1;e<a;e++)i[e]+=i[e-1];for(let a=t-1;a>=0;a--){const t=e[a].bin;i[t]--,s[i[t]]=e[a]}for(let a=t;a<s.length;a++)s[a]=e[a];return s}},oa=class{constructor(e,t){this.index=e,this.coords=t,this.bin=0}toString(){return`${this.coords} -> ${this.bin}`}};const ca=-1;let ha=class{constructor(e,a){if(this.normalizationScaleFactor=1,this.N=e.length,this.N>=3){this.triangleCount=2*this.N+1,this.triangulation=Array.from({length:this.triangleCount},(()=>new Array(6).fill(0))),this.skipTriangle=new Array(this.triangleCount).fill(!1),this.points=new Array(this.N+3),this.normal=a.clone().normalize();let r=e[0].position.clone().sub(e[1].position).normalize(),n=this.normal.clone(),o=new t.Vector3;o.crossVectors(r,n).normalize();for(let a=0;a<this.N;a++){var i=e[a].position,s=new t.Vector2(i.dot(r),i.dot(o));this.points[a]=new oa(a,s)}}else this.triangleCount=0,this.triangulation=[],this.skipTriangle=[],this.points=[],this.normal=new t.Vector3}triangulate(){if(this.N<3)return[];this.addSuperTriangle(),this.normalizeCoordinates(),this.computeTriangulation(),this.discardTrianglesWithSuperTriangleVertices();const e=[];for(let t=0;t<this.triangleCount;t++)this.skipTriangle[t]||e.push(this.triangulation[t][0],this.triangulation[t][1],this.triangulation[t][2]);return e}normalizeCoordinates(){let e=Number.MAX_VALUE,a=Number.MIN_VALUE,i=Number.MAX_VALUE,s=Number.MIN_VALUE;for(let t=0;t<this.N;t++)e=Math.min(e,this.points[t].coords.x),a=Math.max(a,this.points[t].coords.x),i=Math.min(i,this.points[t].coords.y),s=Math.max(s,this.points[t].coords.y);const r=Math.max(a-e,s-i);for(let a=0;a<this.N;a++){var n=this.points[a],o=new t.Vector2((n.coords.x-e)/r,(n.coords.y-i)/r);this.points[a].coords=o}}sortPointsIntoBins(){const e=Math.round(Math.pow(this.N,.25)),t=e*e;for(let t=0;t<this.N;t++){var a=this.points[t];const i=Math.floor(.99*e*a.coords.y),s=Math.floor(.99*e*a.coords.x);a.bin=na.getBinNumber(i,s,e)}return na.sort(this.points,this.N,t)}computeTriangulation(){let e=0,t=0,a=this.sortPointsIntoBins();for(let i=0;i<this.N;i++){let s=a[i];if(!s)break;let r=0,n=!1;for(;!n&&!(r++>t||e===ca);){let a=this.points[this.triangulation[e][0]].coords,i=this.points[this.triangulation[e][1]].coords,r=this.points[this.triangulation[e][2]].coords;Yt(a,i,s.coords)?Yt(i,r,s.coords)?Yt(r,a,s.coords)?(this.insertPointIntoTriangle(s,e,t),t+=2,e=t,n=!0):e=this.triangulation[e][5]:e=this.triangulation[e][4]:e=this.triangulation[e][3]}}}addSuperTriangle(){this.points[this.N]=new oa(this.N,new t.Vector2(-100,-100)),this.points[this.N+1]=new oa(this.N+1,new t.Vector2(0,100)),this.points[this.N+2]=new oa(this.N+2,new t.Vector2(100,-100)),this.triangulation[0][0]=this.N,this.triangulation[0][1]=this.N+1,this.triangulation[0][2]=this.N+2,this.triangulation[0][3]=ca,this.triangulation[0][4]=ca,this.triangulation[0][5]=ca}insertPointIntoTriangle(e,t,a){const i=t,s=a+1,r=a+2;this.triangulation[s][0]=e.index,this.triangulation[s][1]=this.triangulation[t][1],this.triangulation[s][2]=this.triangulation[t][2],this.triangulation[s][3]=r,this.triangulation[s][4]=this.triangulation[t][4],this.triangulation[s][5]=i,this.triangulation[r][0]=e.index,this.triangulation[r][1]=this.triangulation[t][0],this.triangulation[r][2]=this.triangulation[t][1],this.triangulation[r][3]=i,this.triangulation[r][4]=this.triangulation[t][3],this.triangulation[r][5]=s,this.updateAdjacency(this.triangulation[t][3],t,r),this.updateAdjacency(this.triangulation[t][4],t,s),this.triangulation[i][1]=this.triangulation[t][2],this.triangulation[i][2]=this.triangulation[t][0],this.triangulation[i][0]=e.index,this.triangulation[i][4]=this.triangulation[t][5],this.triangulation[i][3]=s,this.triangulation[i][5]=r,this.restoreDelauneyTriangulation(e,i,s,r)}restoreDelauneyTriangulation(e,t,a,i){const s=[];for(s.push([t,this.triangulation[t][4]]),s.push([a,this.triangulation[a][4]]),s.push([i,this.triangulation[i][4]]);s.length>0;)if([t,a]=s.pop()??[ca,ca],a!==ca){const i=this.swapQuadDiagonalIfNeeded(e.index,t,a);null!==i&&(s.push([t,i.t3]),s.push([a,i.t4]))}}swapQuadDiagonalIfNeeded(e,t,a){let i=0,s=0,r=0,n=e,o=0,c=0;return this.triangulation[a][3]===t?(i=this.triangulation[a][1],s=this.triangulation[a][0],r=this.triangulation[a][2],o=this.triangulation[a][4],c=this.triangulation[a][5]):this.triangulation[a][4]===t?(i=this.triangulation[a][2],s=this.triangulation[a][1],r=this.triangulation[a][0],o=this.triangulation[a][5],c=this.triangulation[a][3]):(i=this.triangulation[a][0],s=this.triangulation[a][2],r=this.triangulation[a][1],o=this.triangulation[a][3],c=this.triangulation[a][4]),this.swapTest(this.points[i].coords,this.points[s].coords,this.points[r].coords,this.points[n].coords)?(this.updateAdjacency(o,a,t),this.updateAdjacency(this.triangulation[t][5],t,a),this.triangulation[t][0]=n,this.triangulation[t][1]=i,this.triangulation[t][2]=r,this.triangulation[a][0]=n,this.triangulation[a][1]=r,this.triangulation[a][2]=s,this.triangulation[a][3]=t,this.triangulation[a][4]=c,this.triangulation[a][5]=this.triangulation[t][5],this.triangulation[t][4]=o,this.triangulation[t][5]=a,{t3:o,t4:c}):null}discardTrianglesWithSuperTriangleVertices(){for(let e=0;e<this.triangleCount;e++)(this.triangleContainsVertex(e,this.N)||this.triangleContainsVertex(e,this.N+1)||this.triangleContainsVertex(e,this.N+2))&&(this.skipTriangle[e]=!0)}swapTest(e,t,a,i){const s=e.x-a.x,r=t.x-a.x,n=e.y-a.y,o=t.y-a.y,c=e.x-i.x,h=t.x-i.x,l=e.y-i.y,b=t.y-i.y,d=s*r+n*o,u=h*c+b*l;return!(d>=0&&u>=0)&&(d<0&&u<0||(s*o-r*n)*u+(h*l-c*b)*d<0)}triangleContainsVertex(e,t){return this.triangulation[e][0]===t||this.triangulation[e][1]===t||this.triangulation[e][2]===t}updateAdjacency(e,t,a){if(e===ca)return;const i=this.findSharedEdge(e,t);i&&(this.triangulation[e][i]=a)}findSharedEdge(e,t){return e===ca?null:this.triangulation[e][3]===t?3:this.triangulation[e][4]===t?4:this.triangulation[e][5]===t?5:null}},la=class{constructor(e,t,a,i,s,r,n,o,c,h){this.q1=e,this.q2=t,this.q3=a,this.q4=i,this.t1=s,this.t2=r,this.t1L=n,this.t1R=o,this.t2L=c,this.t2R=h}toString(){return`T${this.t1}/T${this.t2} (V${this.q1},V${this.q2},V${this.q3},V${this.q4})`}},ba=class extends ha{edgeVertex1=[0,0,0,0,1,2];edgeVertex2=[0,0,0,1,2,0];oppositePoint=[0,0,0,2,0,1];nextEdge=[0,0,0,4,5,3];previousEdge=[0,0,0,5,3,4];constructor(e,t,a){super(e,a),this.constraints=t,this.vertexTriangles=[]}triangulate(){if(this.N<3)return[];this.addSuperTriangle(),this.normalizeCoordinates(),this.computeTriangulation(),this.constraints.length>0&&(this.applyConstraints(),this.discardTrianglesViolatingConstraints()),this.discardTrianglesWithSuperTriangleVertices();let e=[];for(let t=0;t<this.triangleCount;t++)this.skipTriangle[t]||(e.push(this.triangulation[t][0]),e.push(this.triangulation[t][1]),e.push(this.triangulation[t][2]));return e}applyConstraints(){const e=this.triangulation.length;this.vertexTriangles=new Array(this.N+3).fill(0);for(let t=0;t<e;t++)this.vertexTriangles[this.triangulation[t][0]]=t,this.vertexTriangles[this.triangulation[t][1]]=t,this.vertexTriangles[this.triangulation[t][2]]=t;for(let e of this.constraints){if(e.v1===e.v2)continue;const t=this.findIntersectingEdges(e,this.vertexTriangles);this.removeIntersectingEdges(e,t)}}findIntersectingEdges(e,t){const a=[],i=this.findStartingEdge(t,e);if(null===i)return a;a.push(i);let s=i.t1,r=i.t1Edge,n=s,o=!1;for(;!o;){n=s,s=this.triangulation[s][r];const t=this.points[e.v1].coords,i=this.points[e.v2].coords,c=this.points[this.triangulation[s][0]].coords,h=this.points[this.triangulation[s][1]].coords,l=this.points[this.triangulation[s][2]].coords;if(this.triangleContainsVertex(s,e.v2))o=!0;else if(this.triangulation[s][3]!==n&&Xt(t,i,c,h)){r=3;const e=new ra(this.triangulation[s][0],this.triangulation[s][1],s,this.triangulation[s][3],r);a.push(e)}else if(this.triangulation[s][4]!==n&&Xt(t,i,h,l)){r=4;const e=new ra(this.triangulation[s][1],this.triangulation[s][2],s,this.triangulation[s][4],r);a.push(e)}else{if(this.triangulation[s][5]===n||!Xt(t,i,l,c)){console.warn("Failed to find final triangle, exiting early.");break}{r=5;const e=new ra(this.triangulation[s][2],this.triangulation[s][0],s,this.triangulation[s][5],r);a.push(e)}}}return a}findStartingEdge(e,t){let a,i,s,r=new ra(-1,-1),n=t.v1,o=e[n],c=!1,h=null;const l=new Array(this.triangulation.length);for(;!h&&!c;){if(l[o]=!0,this.triangleContainsConstraint(o,t))return null;if(h=this.edgeConstraintIntersectsTriangle(o,t),h)break;if(a=this.triangulation[o][3],i=this.triangulation[o][4],s=this.triangulation[o][5],-1!==a&&!l[a]&&this.triangleContainsVertex(a,n))o=a;else if(-1!==i&&!l[i]&&this.triangleContainsVertex(i,n))o=i;else{if(-1===s||l[s]||!this.triangleContainsVertex(s,n)){c=!0;break}o=s}}if(h){const e=this.triangulation[o][this.edgeVertex1[h]],t=this.triangulation[o][this.edgeVertex2[h]],a=this.triangulation[o][h];return r=new ra(e,t,o,a,h),r}return null}removeIntersectingEdges(e,t){let a,i=[],s=0;for(;t.length>0&&s<=t.length;){a=t.shift(),null==a&&console.log("no edge !!");let r=this.findQuadFromSharedEdge(a.t1,a.t1Edge);if(r)if(Xt(this.points[r.q4].coords,this.points[r.q3].coords,this.points[r.q1].coords,this.points[r.q2].coords)){this.swapQuadDiagonal(r,t,i,this.constraints);let a=new ra(r.q3,r.q4,r.t1,r.t2,5);Xt(this.points[e.v1].coords,this.points[e.v2].coords,this.points[r.q3].coords,this.points[r.q4].coords)?t.push(a):(s=0,i.push(a))}else t.push(a);s++}i.length>0&&this.restoreConstrainedDelauneyTriangulation(e,i)}restoreConstrainedDelauneyTriangulation(e,t){let a=!0;for(;a;){a=!1;for(let i=0;i<t.length;i++){const s=t[i];if(s.equals(e))continue;let r=this.findQuadFromSharedEdge(s.t1,s.t1Edge);if(r&&this.swapTest(this.points[r.q1].coords,this.points[r.q2].coords,this.points[r.q3].coords,this.points[r.q4].coords)){this.swapQuadDiagonal(r,t,this.constraints,null);const e=r.q3,s=r.q4;t[i]=new ra(e,s,r.t1,r.t2,5),a=!0}}}}discardTrianglesViolatingConstraints(){this.skipTriangle.fill(!0);let e=new Set;for(let t=0;t<this.constraints.length;t++){const a=this.constraints[t];e.add($t(a.v1,a.v2))}let t,a,i,s,r,n,o,c,h,l=[];const b=new Array(this.triangulation.length);for(let d=0;d<this.triangleCount;d++)if(!b[d]&&(t=this.triangulation[d][0],a=this.triangulation[d][1],i=this.triangulation[d][2],s=e.has($t(t,a)),r=e.has($t(a,i)),n=e.has($t(i,t)),o=e.has($t(a,t)),c=e.has($t(i,a)),h=e.has($t(t,i)),!(o||c||h)&&(s||r||n)))for(this.skipTriangle[d]=!1,l=[],s||l.push(this.triangulation[d][3]),r||l.push(this.triangulation[d][4]),n||l.push(this.triangulation[d][5]);l.length>0;){const s=l.shift();void 0===s||-1===s||b[s]||(t=this.triangulation[s][0],a=this.triangulation[s][1],i=this.triangulation[s][2],o=e.has($t(a,t)),c=e.has($t(i,a)),h=e.has($t(t,i)),o||c||h?b[s]=!0:(this.skipTriangle[s]=!1,b[s]=!0,e.has($t(t,a))||l.push(this.triangulation[s][3]),e.has($t(a,i))||l.push(this.triangulation[s][4]),e.has($t(i,t))||l.push(this.triangulation[s][5])))}}triangleContainsConstraint(e,t){return!(e>=this.triangulation.length||this.triangulation[e][0]!==t.v1&&this.triangulation[e][1]!==t.v1&&this.triangulation[e][2]!==t.v1||this.triangulation[e][0]!==t.v2&&this.triangulation[e][1]!==t.v2&&this.triangulation[e][2]!==t.v2)}edgeConstraintIntersectsTriangle(e,t){const a=this.points[t.v1].coords,i=this.points[t.v2].coords,s=this.points[this.triangulation[e][0]].coords,r=this.points[this.triangulation[e][1]].coords,n=this.points[this.triangulation[e][2]].coords;return Xt(a,i,s,r)?3:Xt(a,i,r,n)?4:Xt(a,i,n,s)?5:null}findQuadFromSharedEdge(e,t){let a,i,s,r,n,o,c,h,l=this.triangulation[e][t],b=this.findSharedEdge(l,e);return b?(3===b?(i=this.triangulation[l][0],a=this.triangulation[l][1],s=this.triangulation[l][2]):4===b?(i=this.triangulation[l][1],a=this.triangulation[l][2],s=this.triangulation[l][0]):(i=this.triangulation[l][2],a=this.triangulation[l][0],s=this.triangulation[l][1]),r=this.triangulation[e][this.oppositePoint[t]],n=this.triangulation[e][this.previousEdge[t]],o=this.triangulation[e][this.nextEdge[t]],c=this.triangulation[l][this.nextEdge[b]],h=this.triangulation[l][this.previousEdge[b]],new la(a,i,s,r,e,l,n,o,c,h)):null}swapQuadDiagonal(e,t,a,i){const s=e.t1,r=e.t2,n=e.t1R,o=e.t1L,c=e.t2R,h=e.t2L;this.triangulation[s][0]=e.q4,this.triangulation[s][1]=e.q1,this.triangulation[s][2]=e.q3,this.triangulation[r][0]=e.q4,this.triangulation[r][1]=e.q3,this.triangulation[r][2]=e.q2,this.triangulation[s][3]=o,this.triangulation[s][4]=h,this.triangulation[s][5]=r,this.triangulation[r][3]=s,this.triangulation[r][4]=c,this.triangulation[r][5]=n,this.updateAdjacency(h,r,s),this.updateAdjacency(n,s,r),this.updateEdgesAfterSwap(t,s,r,o,n,h,c),this.updateEdgesAfterSwap(a,s,r,o,n,h,c),this.updateEdgesAfterSwap(i,s,r,o,n,h,c),this.vertexTriangles[e.q1]=s,this.vertexTriangles[e.q2]=r}updateEdgesAfterSwap(e,t,a,i,s,r,n){if(e)for(let o of e)o.t1===t&&o.t2===s?(o.t1=a,o.t2=s,o.t1Edge=5):o.t1===t&&o.t2===i?o.t1Edge=3:o.t1===s&&o.t2===t?o.t2=a:o.t1===i&&o.t2===t||(o.t1===a&&o.t2===n?o.t1Edge=4:o.t1===a&&o.t2===r?(o.t1=t,o.t2=r,o.t1Edge=4):o.t1===n&&o.t2===a||o.t1===r&&o.t2===a&&(o.t2=t))}};function da(e,a,i,s,r,n=!1,o=!0){const c=new sa,h=new sa,l=new Array(e.vertexCount).fill(!1);for(let t=0;t<e.vertices.length;t++){const s=e.vertices[t];l[t]=aa(s.position,a,i),(l[t]?c:h).addMappedVertex(s,t)}const b=e.vertices.length;for(let t=0;t<e.cutVertices.length;t++){const s=e.cutVertices[t];l[t+b]=aa(s.position,a,i),(l[t+b]?c:h).addMappedVertex(s,t+b)}return ua(e,c,h,a,i,l,0),o&&ua(e,c,h,a,i,l,1),o&&function(e,a,i,s,r,n){if(e.weldCutFaceVertices(),a.weldCutFaceVertices(),e.cutVertices.length<3)return;const o=n?new ha(e.cutVertices,i):new ba(e.cutVertices,e.constraints,i),c=o.triangulate();for(let n=0;n<e.cutVertices.length;n++){var h=e.cutVertices[n],l=o.points[n];const c=new t.Vector2(o.normalizationScaleFactor*l.coords.x*s.x+r.x,o.normalizationScaleFactor*l.coords.y*s.y+r.y),b=new ia(h.position.clone(),i.clone(),c.clone()),d=new ia(h.position.clone(),i.clone().negate(),c.clone());e.cutVertices[n]=b,a.cutVertices[n]=d}let b=e.vertices.length,d=a.vertices.length;for(let t=0;t<c.length;t+=3)e.addTriangle(b+c[t],b+c[t+1],b+c[t+2],1),a.addTriangle(d+c[t],d+c[t+2],d+c[t+1],1)}(c,h,a.clone().negate(),s,r,n),{topSlice:c,bottomSlice:h}}function ua(e,t,a,i,s,r,n){const o=e.triangles[n];let c,h,l;for(let b=0;b<o.length;b+=3)c=o[b],h=o[b+1],l=o[b+2],r[c]&&r[h]&&r[l]?t.addMappedTriangle(c,h,l,n):r[c]||r[h]||r[l]?r[h]&&r[l]&&!r[c]?fa(h,l,c,i,s,e,t,a,n,!0):r[l]&&r[c]&&!r[h]?fa(l,c,h,i,s,e,t,a,n,!0):r[c]&&r[h]&&!r[l]?fa(c,h,l,i,s,e,t,a,n,!0):r[h]||r[l]||!r[c]?r[l]||r[c]||!r[h]?r[c]||r[h]||!r[l]||fa(c,h,l,i,s,e,t,a,n,!1):fa(l,c,h,i,s,e,t,a,n,!1):fa(h,l,c,i,s,e,t,a,n,!1):a.addMappedTriangle(c,h,l,n)}function fa(e,a,i,s,r,n,o,c,h,l){const b=n.vertices.length;let d=e<b?n.vertices[e]:n.cutVertices[e-b],u=a<b?n.vertices[a]:n.cutVertices[a-b],f=i<b?n.vertices[i]:n.cutVertices[i-b];const m=Qt(d.position,f.position,s,r),p=Qt(u.position,f.position,s,r);if(m&&p){const s=new t.Vector3(d.normal.x+m.s*(f.normal.x-d.normal.x),d.normal.y+m.s*(f.normal.y-d.normal.y),d.normal.z+m.s*(f.normal.z-d.normal.z)).normalize(),r=new t.Vector3(u.normal.x+p.s*(f.normal.x-u.normal.x),u.normal.y+p.s*(f.normal.y-u.normal.y),u.normal.z+p.s*(f.normal.z-u.normal.z)).normalize(),n=new t.Vector2(d.uv.x+m.s*(f.uv.x-d.uv.x),d.uv.y+m.s*(f.uv.y-d.uv.y)),b=new t.Vector2(u.uv.x+p.s*(f.uv.x-u.uv.x),u.uv.y+p.s*(f.uv.y-u.uv.y));o.addCutFaceVertex(m.x,s,n),o.addCutFaceVertex(p.x,r,b),c.addCutFaceVertex(m.x,s,n),c.addCutFaceVertex(p.x,r,b);const g=o.vertices.length,y=c.vertices.length,x=o.cutVertices.length,w=c.cutVertices.length,v=g-2,k=g-1,j=y-2,M=y-1;l?(o.addTriangle(k,v,o.indexMap[a],h),o.addTriangle(v,o.indexMap[e],o.indexMap[a],h),c.addTriangle(c.indexMap[i],j,M,h),o.constraints.push(new ra(x-2,x-1)),c.constraints.push(new ra(w-1,w-2))):(o.addTriangle(v,k,o.indexMap[i],h),c.addTriangle(c.indexMap[e],c.indexMap[a],j,h),c.addTriangle(c.indexMap[a],M,j,h),o.constraints.push(new ra(x-1,x-2)),c.constraints.push(new ra(w-2,w-1)))}}let ma=class{constructor(e){this.parent=[],this.rank=[];for(let t=0;t<e;t++)this.parent[t]=t,this.rank[t]=1}find(e){return this.parent[e]!==e&&(this.parent[e]=this.find(this.parent[e])),this.parent[e]}union(e,t){const a=this.find(e),i=this.find(t);a!==i&&(this.rank[a]>this.rank[i]?this.parent[i]=a:this.rank[a]<this.rank[i]?this.parent[a]=i:(this.parent[i]=a,this.rank[a]+=1))}};function pa(e){const t=new ma(e.vertexCount),a={},i=e.vertices.length,s=e.cutVertices.length,r=new Map;e.vertices.forEach(((e,a)=>{const i=ta(e.position),s=r.get(i);void 0===s?r.set(i,a):t.union(s,a)}));for(let a=0;a<s;a++)t.union(e.vertexAdjacency[a],a+i);const n=e.triangles;for(let e=0;e<n.length;e++)for(let i=0;i<n[e].length;i+=3){const s=n[e][i],r=n[e][i+1],o=n[e][i+2];t.union(s,r),t.union(r,o);const c=t.find(s);a[c]||(a[c]=[[],[]]),a[c][e].push(s,r,o)}const o={},c=Array(e.vertexCount);for(let a=0;a<i;a++){const i=t.find(a);o[i]||(o[i]=new sa),o[i].vertices.push(e.vertices[a]),c[a]=o[i].vertices.length-1}for(let a=0;a<s;a++){const s=t.find(a+i);o[s].cutVertices.push(e.cutVertices[a]),c[a+i]=o[s].vertices.length+o[s].cutVertices.length-1}for(const i of Object.keys(a)){let s=Number(i),r=t.parent[s];for(let t=0;t<e.triangles.length;t++)for(const e of a[s][t]){const a=c[e];o[r].triangles[t].push(a)}}return Object.values(o)}const ga={textureScale:new t.Vector2(1,1),textureOffset:new t.Vector2},ya=new t.Vector3,xa=new t.Vector3,wa=new t.Vector3,va=new t.Plane,ka=new t.Plane;function ja(e,a,i,s,r,n){const o=[],c=e.matrixWorld.clone().invert(),h=e.position;a.applyMatrix4(c);const l=function(e){const a=e.attributes.position.array,i=e.attributes.normal.array,s=e.attributes.uv?.array,r=new sa,n=e.attributes.position.count;let o,c,h;for(let e=0;e<n;e++){o=3*e,c=2*e;const n=new t.Vector3(a[o],a[o+1],a[o+2]),h=new t.Vector3(i[o],i[o+1],i[o+2]),l=s?new t.Vector2(s[c],s[c+1]):new t.Vector2(0,0);r.vertices.push(new ia(n,h,l))}if(e.index)h=Array.from(e.index.array);else{const e=a.length/3;h=Array.from({length:e},((e,t)=>t))}if(e.groups&&2===e.groups.length){const t=[],a=[];for(const i of e.groups){const e=0===i.materialIndex?t:a,s=i.start,r=s+i.count;for(let t=s;t<r;t++)e.push(h[t])}r.triangles=[t,a]}else r.triangles=[h,[]];return r.calculateBounds(),r}(e.geometry);let b=l.convex,d=.03*l.volume();ya.addVectors(a,i),va.setFromCoplanarPoints(a,h,ya);const u=r+s;return function e(r,l,f,m){if(!r)return;if(Math.random()<.05*m||m>u)return void(r.valid&&o.push(r));let p=Math.PI,g=new t.Vector3;r.calculateBounds(),r.bounds.getCenter(g);let y=b;if(0===m)ka.normal.copy(va.normal),ka.constant=va.constant;else if(m<=s)p=(f-l)*(.2+.6*Math.random())+l,xa.copy(h).sub(a).applyAxisAngle(i,p).add(a),ka.setFromCoplanarPoints(a,ya,xa);else{let e=g.clone().applyMatrix4(c);p=(.5*(1&m)+.2*(2-Math.random()))*Math.PI,xa.copy(a).sub(e).applyAxisAngle(i,p).add(e),wa.copy(i).add(e),ka.setFromCoplanarPoints(e,wa,xa)}const{topSlice:x,bottomSlice:w}=da(r,ka.normal,xa,ga.textureScale,ga.textureOffset,y,n);let v=x,k=w;v=pa(x),k=pa(w),v&&(v.isFragment&&(v=[v]),v=Ma(v,d),v.length>0&&v.forEach(((t,a)=>{0===a?e(t,p,f,m+1):o.push(t)}))),k&&(k.isFragment&&(k=[k]),k=Ma(k,d),k.length>0&&k.forEach(((t,a)=>{0===a?e(t,p,f,m+1):o.push(t)})))}(l,0,2*Math.PI,0),o}function Ma(e,t){if(0===e.length)return[];let a=0,i=-1,s=[];return e.forEach(((e,s)=>{e.minSize=t,e.bounds=null;let r=.5*e.size.length();e.valid&&r>0?r>a&&(a=r,i=s):e.good=!1})),-1!==i&&s.push(e[i]),e.forEach(((e,t)=>{e.good&&t!==i&&s.push(e)})),s}class Aa{constructor(e){this.motor=e,this.tpos=new t.Vector3,this.tnormal=new t.Vector3,this.nDebris=0,this.maxDebris=1500,this.interneMat=this.motor.getMat("chrome"),this.tt=null}add(e,t=[]){let a=this,i=0;-1!==e.name.search("_debris_")&&(i=1e3),setTimeout((()=>{a.motor.addCollision({name:e.name,ignore:e.ignore}),e.addEventListener("collision",(e=>{let t=e.data;1===t.hit&&a.makeBreak(t.from,t.point,t.normal,t.impulse,t.v1)}))}),i)}makeBreak(e,a,i,s,r){let n=this.motor.byName(e);if(!n)return;if(!n.breakable)return;let o=n.breakOption;const c=void 0===o[4]||o[4];if(s<o[0])return;this.motor.removeCollision(e),this.motor.remove(e);const h=new t.Vector3;n.geometry.boundingBox.getSize(h);const l=h.length();let b=function(e,t,a,i=!0,s=0){const r=[];return e.map(((e,n)=>{r.push(e.toMesh(t,a,i,s))})),r}(ja(n,this.tpos.fromArray(a),this.tnormal.fromArray(i),o[1],o[2],c),n,this.interneMat,c,0);if(b.length<1)return;let d,u,f,m,p,g=[],y=b.length,x=0,w=[...n.ignore];for(;y--;)d=b[x],u=d.geometry.attributes.position.count,f=d.sizer/l,m={},p=[...o],p[3]=p[3]-1,f<.2&&(p[3]=0),d.sizer>.02&&u>6&&(this.nDebris++,m.name=e+"_debris_"+x,m.mass=n.mass*f,g.push(this.addDebris(d,p,m)),w.push(m.name)),x++;for(y=g.length;y--;)g[y].ignore=w;this.motor.add(g)}addDebris(e,t,a){let i=t[3]>0;return{...a,type:"convex",shape:e.geometry,material:e.material,pos:e.position.toArray(),quat:e.quaternion.toArray(),breakable:i,breakOption:t}}}class Sa{constructor(e={},t){this.motor=t,this.utils=this.motor.utils,this.id=0,this.type="autoRagdoll",this.name=e.name||this.type+this.id++;let a=this.utils.byName(this.name);a&&this.utils.remove(a),this._mode=e.mode||"follow",this._size=e.size||1,this._debug=e.debug||!1;const i=y.clone(e.model);let s;i.scale.set(1,1,1).multiplyScalar(this._size),e.pos&&i.position.fromArray(e.pos),i.raycast=function(){},i.name=this.name,i.traverse((t=>{t.isMesh&&(t.frustumCulled=!1),t.isSkinnedMesh&&(t.raycast=function(){},t.frustumCulled=!1,t.matrixAutoUpdate=!1,t.receiveShadow=!0,t.castShadow=!0,e.material&&(t.material=e.material),t.skeleton.resetScalling(),s=t.skeleton.bones)}));let r=e.mass||null;return this.skeletonBody=new Ge(this.motor,i.name,i,s,r,e.option),this.debug=this._debug,this.mode=this._mode,i.add(this.skeletonBody),this.model=i,this.utils.add(this),this}getRealPosition(){return this.utils.byName(this.skeletonBody.nodes[0].name).position}dispose(){this.skeletonBody&&this.skeletonBody.dispose(),this.model&&this.model.parent.remove(this.model)}get position(){return model.position}get size(){return this._size}set size(e){this._size=e,this.model.scale.set(1,1,1).multiplyScalar(this._size)}get debug(){return this._debug}set debug(e){this._debug=e,this.skeletonBody.isVisible(this._debug)}get mode(){return this._mode}set mode(e){this._mode=e,this.skeletonBody.setMode(this._mode)}}class Ea extends t.LineSegments{constructor(e){super(),this.rayCount=0,this.ray=[],this.motor=e,this.maxVertices=1e4,this.currentVertex=0,this.geometry=new t.BufferGeometry,this.geometry.setAttribute("position",new t.Float32BufferAttribute(3*this.maxVertices,3)),this.geometry.setAttribute("color",new t.Float32BufferAttribute(3*this.maxVertices,3)),this.positions=this.geometry.attributes.position.array,this.colors=this.geometry.attributes.color.array,this.material=new t.LineBasicMaterial({vertexColors:!0,toneMapped:!1,depthTest:!1,depthWrite:!1}),this.material.transparent=!0,this.renderOrder=3e4,this.frustumCulled=!1}DrawRay(e,a,i){i=new t.Color(i);let s=this.currentVertex,r=3*s;this.positions[r]=e.x,this.positions[r+1]=e.y,this.positions[r+2]=e.z,this.colors[r]=i.r,this.colors[r+1]=i.g,this.colors[r+2]=i.b,s++,r=3*s,this.positions[r]=e.x+a.x,this.positions[r+1]=e.y+a.y,this.positions[r+2]=e.z+a.z,this.colors[r]=i.r,this.colors[r+1]=i.g,this.colors[r+2]=i.b,this.currentVertex+=2}collapseBuffer(){let e=this.maxVertices,t=this.currentVertex,a=0;for(;e>=t;)a=3*e,this.positions[a]=0,this.positions[a+1]=0,this.positions[a+2]=0,this.colors[a]=0,this.colors[a+1]=0,this.colors[a+2]=0,e--}insertLine(e,t,a){let i=this.currentVertex,s=3*i;this.positions[s]=e.x,this.positions[s+1]=e.y,this.positions[s+2]=e.z,this.colors[s]=a.r,this.colors[s+1]=a.g,this.colors[s+2]=a.b,i++,s=3*i,this.positions[s]=t.x,this.positions[s+1]=t.y,this.positions[s+2]=t.z,this.colors[s]=a.r,this.colors[s+1]=a.g,this.colors[s+2]=a.b,this.currentVertex+=2}draw(){this.collapseBuffer(),this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0,this.currentVertex=0}dispose(){this.parent.remove(this),this.material.dispose(),this.geometry.dispose()}}const Fa={sunPosition:new t.Vector3(.27,1,.5),sunTop:new t.Vector3(0,.99,0),saturation:1,noiseMap:null,nightLuminosity:.03,cloud_size:.29,cloud_covr:.1,cloud_dens:.4,cloud_dist:.64,haze:.1,mixRatio:.76,SAMPLE:64,STEP:4,cloudColor:new t.Color(16777209).multiplyScalar(1),skyColor:new t.Color(4348022),fogColor:new t.Color(11253184),groundColor:new t.Color(8421504),sunColor:new t.Color(16777215).multiplyScalar(3)},za={defines:{USE_NOISE_MAP:!1},uniforms:{lightdir:{value:Fa.sunPosition},sunTop:{value:Fa.sunTop},noiseMap:{value:Fa.noiseMap},mixRatio:{value:Fa.mixRatio},cloud_size:{value:Fa.cloud_size},cloud_covr:{value:Fa.cloud_covr},cloud_dens:{value:Fa.cloud_dens},cloud_dist:{value:Fa.cloud_dist},nightLuminosity:{value:Fa.nightLuminosity},haze:{value:Fa.haze},saturation:{value:Fa.saturation},SAMPLE:{value:Fa.SAMPLE},STEP:{value:Fa.STEP},fogy:{value:Fa.fogy},t:{value:1},fogColor:{value:Fa.fogColor},groundColor:{value:Fa.groundColor},cloudColor:{value:Fa.cloudColor},skyColor:{value:Fa.skyColor},sunColor:{value:Fa.sunColor}},vertexShader:"\nvarying vec3 worldPosition;\nvoid main()\t{\n\tworldPosition = ( modelMatrix * vec4( position, 1.0 )).xyz;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}\n",fragmentShader:"\n//precision highp float;\nvarying vec3 worldPosition;\n\nuniform vec3 fogColor;\nuniform vec3 groundColor;\nuniform vec3 cloudColor;\nuniform vec3 skyColor;\nuniform vec3 sunColor;\n\nuniform float saturation;\n\nuniform float hue;\nuniform float mixRatio;\nuniform float fogy;\n\nuniform vec3 sunTop;\n\nuniform sampler2D noiseMap;\nuniform vec3 lightdir;\n\nuniform float cloud_size;\nuniform float cloud_covr;\nuniform float cloud_dens;\nuniform float cloud_dist;\n\nuniform float nightLuminosity;\nuniform float haze;\nuniform float t;\n\nuniform int SAMPLE;\nuniform int STEP;\n\n//const float c = 6.36e6;\n//const float d = 6.38e6;\nconst float c = 6.407e6;\nconst float d = 6.416e6;\n\n//const float g = 0.76; // mix ratio\n//const float h = g*g;\nconst float icc = 1.0/8e3;\nconst float jcc = 1.0/1200.0;\nconst float pi = 3.141592653589793;\n\nconst vec3 vm = vec3( 0,-c,0 );\n//const vec3 vn = vec3( 2.1e-5 );\n//const vec3 vo = vec3( 5.8e-6, 1.35e-5, 3.31e-5 );\n\n//const vec3 vn = vec3( 0.000021 );\n//const vec3 vo = vec3( 0.0000058, 0.0000135, 0.0000331 );// sky base color\n\n//const vec3 vo = vec3( 0.000021 );// sky base color\n\n\n#ifdef USE_NOISE_MAP\n\nfloat noise( in vec3 x ){\n    vec3 p = floor(x);\n    vec3 f = fract(x);\n    f = f*f*(3.0-2.0*f);\n    vec2 uv = (p.xy+vec2(37.0,17.0)*p.z) + f.xy;\n    vec2 rg = texture2D( noiseMap, (uv+0.5)/256.0, -16.0 ).yx;\n    return mix( rg.x, rg.y, f.z );\n}\n\n#else\n\nfloat hash( float n ) { return fract(sin(n)*753.5453123); }\nfloat noise( in vec3 x ){\n    vec3 p = floor(x);\n    vec3 f = fract(x);\n    f = f*f*(3.0-2.0*f);\n    float n = p.x + p.y*157.0 + 113.0*p.z;\n    return mix(mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\n                   mix( hash(n+157.0), hash(n+158.0),f.x),f.y),\n               mix(mix( hash(n+113.0), hash(n+114.0),f.x),\n                   mix( hash(n+270.0), hash(n+271.0),f.x),f.y),f.z);\n}\n\n#endif\n\nfloat NOISE( vec3 r )\n{\n\tr.xz += t;\n\tr *= 0.5;\n\tfloat s;\n\ts = 0.5 * noise(r);\n\tr = r * 2.52;\n\ts += 0.25 * noise(r);\n\tr = r * 2.53;\n\ts += 0.125 * noise(r);\n\tr = r * 2.51;\n\ts += 0.0625 * noise(r);\n\tr = r * 2.53;\n\ts += 0.03125 * noise(r);\n\tr = r * 2.52;\n\ts += 0.015625 * noise(r);\n\treturn s;\n}\n\nfloat MakeNoise( vec3 r )\n{\n\tfloat s,tt;\n\ts = NOISE( r * 2e-4 * ( 1.0 - cloud_size ) );\n\ttt = ( 1.0 - cloud_covr ) * 0.5 + 0.2;\n\ts = smoothstep( tt, tt+.2 , s );\n\ts *= 0.5*(cloud_dens*100.0);\n\treturn s;\n}\n\nvoid clouds( in vec3 r, out vec3 u )\n{\n\tfloat v,w;\n\tv = length( r-vm ) - c;\n\tw = 0.0;\n\tif( 5e3 < v && v < 1e4 ) w = MakeNoise( r ) * (sin( pi*(v-5e3)/5e3 ));\n\tu = vec3( exp(-v*icc), exp(-v*jcc), w );\n}\n\nfloat ca( in vec3 r, in vec3 s, in float t )\n{\n\tvec3 u = r - vm;\n\tfloat v,w,x,y,z,A;\n\tv = dot(u,s);\n\tw = dot(u,u)-t*t;\n\tx = v*v-w;\n\tif( x < 0.0 ) return -1.0;\n\ty = sqrt(x);\n\tz = -v-y;\n\tA = -v+y;\n\treturn z >= 0.0 ? z : A;\n}\n\nvec3 czm_saturation(vec3 rgb, float adjustment)\n{\n    vec3 W = vec3(0.2125, 0.7154, 0.0721);\n    vec3 intensity = vec3(dot(rgb, W));\n    return mix(intensity, rgb, adjustment);\n}\n\n\nvec3 makeSky( in vec3 lightpos, in vec3 r, in vec3 world, out float mask )\n{\n\n\tvec3 vn = vec3( 0.000021 );\n\tvec3 vo = skyColor;\n\tvo *= 0.00005;\n\n\tfloat u,v,w,x,y,z,m, M, N, S, H, F;\n\tvec3 p = lightpos;\n\tu = ca(r,world,d);\n\tv = dot(world,p);\n\tw = 1.0+v*v;\n\n\tfloat gg = mixRatio;\n\tfloat hh = gg*gg;\n\n\tx = 0.0596831*w;\n\ty = 0.0253662*(1.0-hh)*w/((2.0+hh)*pow(abs(1.0+hh-2.0*gg*v),1.5));\n\tz = 50.*pow(abs(1.+dot(world,-p)),2.0)*dot(vec3(0.,1.,0.),p)*(1.0-cloud_covr)*(1.0-min(fogy,1.0));\n\n\tm = 0.0;\n\tvec3 D,E, CB, CM, BB, BM, SX;\n\n\tF = u / float( SAMPLE );\n\n\tBB = vec3(0.0);\n\tBM = vec3(0.0);\n\n\tfloat count = 0.0;\n\n\tfor( int G=0; G<SAMPLE; ++G ){\n\n\t\tH = float(G)*F;\n\t\tvec3 I = r + world * H;\n\t\t//CB = vec3(1.0);\n\t\t//BB = vec3(0.0);\n\t\tclouds( I, CB );\n\t\tCB += fogy;// add fog\n\t\tCB.y += CB.z;// add clound\n\t\tCB.xy *= F;\n\t\tBB += CB;\n\n\t\tM = ca(I,p,d);\n\n\t\tif( M > 0.0 ){\n\n\t\t\tN = M/float(STEP);\n\t\t\tBM = vec3(0.0);\n\n\t\t\tfor( int R=0; R<STEP; ++R ){\n\n\t\t\t\tS = float(R)*N;\n\t\t\t\tvec3 T=I+p*S;\n\t\t\t\tclouds( T, CM );\n\t\t\t\tCM += fogy;// add fog\n\t\t\t\tCM.y += CM.z;// add clound\n\t\t\t\tBM += CM * N;\n\n\t\t\t}\n\n\t\t\tSX = exp(-(vo*(BM.x+BB.x)+vn*(BM.y+BB.y)* cloud_dist));\n\n\t\t\tm += CB.z;\n\t\t\tcount += 1.0;\n\t\t\tD += SX*CB.x;\n\t\t\tE += (SX*CB.y)+z*m;\n\t\t}\n\t\telse return vec3(0.0);\n\t}\n\t//mask = m * 0.0125;\n\t//mask = m / count;\n\tmask = m / float( SAMPLE );\n\n\treturn ((D * vo * x ) + (E * vn * y * sunColor)) * 15.0;\n}\n\n\nvoid main()\n{\n\tvec3 light = normalize( lightdir );\n\tvec3 world = normalize( worldPosition.xyz );\n\n\tfloat uvy = acos( world.y ) / pi;\n\n\t//float luma = smoothstep(0.0, 4.0,  1.0-(abs(world.y)/0.8) );\n    //float mid = smoothstep(0.0, 1.0,  abs(world.y) < haze ? 1.0-(abs(world.y)/(haze*1.0)) : 0.0 );\n    //mid *= nightLuminosity;//pow(  mid, 1.0 );\n\n    // ground reapeat sky\n\t//if( world.y < -0.15) world.y = -0.15+((-world.y-0.15)*0.1);\n\tif( world.y < 0.0) world.y = -world.y;\n\n\tfloat high = smoothstep(1.0, 0.0, (uvy)*10000.0);\n\tfloat top =  smoothstep(1.0, 0.0, (uvy-0.5)*50.0);\n\tfloat middle = uvy > 0.5 ? high : smoothstep(0.0, 1.0, (0.5-uvy)*((1.0-haze)*100.0));\n\n\tfloat middle2 = uvy > 0.5 ? smoothstep(0.0, 1.0, (0.5-uvy)*((1.0-haze)*100.0)) : smoothstep(0.0, 1.0, (0.5-uvy)*((1.0-haze)*100.0));\n\n\tvec3 s = sunTop;\n\tfloat lm = dot( s, light );\n\tfloat day = clamp((lm*4.0), 0.0, (1.0-nightLuminosity) )+nightLuminosity;\n\n\tif(lm <= 0.0) light *= -1.0;\n\tlight.y = abs(light.y);\n\n\t//if(light.y < 0.1) light.y = 0.1;\n\tlight.y = clamp(light.y, 0.1, 1.0 );\n\t//light.y += 0.5;\n\n\tfloat mask = 0.0;\n\n\tvec3 sky = makeSky( light, s, world, mask );\n\tmask = clamp(mask, 0.0, 1.0 );\n\tsky = mix( sky, cloudColor, mask ); //apply cloud color\n\t\n\n\t//sky = mix( sky, groundColor, 1.0-middle ); // apply ground color\n\tsky = mix( sky, fogColor, 1.0-middle2 ); // apply fog color\n\t\n    //float dd = clamp(day+(nightLuminosity*0.5), 0.0, 1.0);\n\t//luma *= 1.0-dd;\n\t//clear = mix( clear, clear+skyColor, luma ); // extra luminosity on night\n\n\tsky *= day;\n\t//sky = czm_saturation(sky, saturation);\n    //sky = clamp(sky, 0.0, 1.0 );\n\n\n \tgl_FragColor = vec4( sky, 1.0 );\n\n}\n",depthWrite:!1,depthTest:!1,side:1,toneMapped:!1,fog:!1},Ra=Math.PI/180;class Pa{constructor(e={}){this.mainScene=e.scene,this.renderer=e.renderer,this.usePrem=void 0!==e.usePmrem&&e.usePmrem,this.useBackground=void 0===e.useBackground||e.useBackground,this.envBlur=void 0!==e.envBlur?e.envBlur:0,this.callback=e.callback||null,this.isSky=!1,this.usePrem&&(this.pmremGenerator=new t.PMREMGenerator(this.renderer),this.pmremGenerator.compileEquirectangularShader()),e.cube&&this.initCubeEnv(e),e.url&&this.load(e.url)}initCubeEnv(e={}){this.isCubeEnv=!0,this._quality=e.quality||1,this.scene=new t.Scene,e.color&&(this.scene.background=new t.Color(e.color)),this.target=new t.WebGLCubeRenderTarget(256*this._quality,{minFilter:t.LinearFilter,type:t.HalfFloatType,colorSpace:t.SRGBColorSpace,anisotropy:1}),this.camera=new t.CubeCamera(e.near||.1,e.far||100,this.target),this.mainScene.environment=this.target.texture,this.useBackground&&(this.mainScene.background=this.target.texture)}addSky(){let e=new t.IcosahedronGeometry(20,1);const a=new t.ShaderMaterial(za);this.sky=new t.Mesh(e,a),this.scene.add(this.sky),this.render(),this.isSky=!0}getSkyOtion(){if(this.isSky)return Fa}setSkyOtion(e){if(!this.isSky)return;let t=this.sky.material.uniforms;for(let a in e)t[a]&&(t[a].value=e[a]);this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.render.bind(this),0)}render(){if(!this.isCubeEnv)return;const e=this.renderer,a=e.toneMapping;e.toneMapping=t.NoToneMapping,this.camera.update(e,this.scene),e.toneMapping=a}load(e){switch(this.name=e.substring(e.lastIndexOf("/")+1,e.lastIndexOf(".")),this.type=e.substring(e.lastIndexOf(".")+1).toLowerCase(),this.loader=null,this.type){case"hdr":this.loader=(new l.HDRLoader).load(e,this.end.bind(this),null,this.bug.bind(this));break;case"exr":this.loader=(new b.EXRLoader).load(e,this.end.bind(this),null,this.bug.bind(this))}}bug(){console.log("Envmap is not find :",this.name),this.callback&&this.callback()}end(){let e;switch(this.type){case"hdr":case"exr":e=this.loader,e.mapping=t.EquirectangularReflectionMapping;break;case"jpg":e=this.loader.renderTarget.texture,e.mapping=t.EquirectangularReflectionMapping}this.usePrem&&(e=this.pmremGenerator.fromEquirectangular(e).texture,this.pmremGenerator.dispose()),e.needsUpdate=!0;const a=this.isCubeEnv?this.scene:this.mainScene;(this.isCubeEnv||this.useBackground)&&(a.background=e),this.envBlur&&(a.backgroundBlurriness=this.envBlur),a.environment=e,this.loader.dispose(),this.callback&&this.callback()}get intensity(){return this.mainScene.environmentIntensity}set intensity(e){this.mainScene.environmentIntensity=e}get bgIntensity(){return this.mainScene.backgroundIntensity}set bgIntensity(e){this.mainScene.backgroundIntensity=e}get blur(){return this.mainScene.backgroundBlurriness}set blur(e){this.mainScene.backgroundBlurriness=e}rotate(e=0,t=0,a=0){0!==e&&(e*=Ra),0!==t&&(t*=Ra),0!==a&&(a*=Ra),this.mainScene.environmentRotation.set(e,t,a),this.mainScene.backgroundRotation.set(e,t,a)}}const Ta=1.25,Ia=65535,Ba=Math.pow(2,-24),Ca=Symbol("SKIP_GENERATION");function Da(e){return function(e){return e.index?e.index.count:e.attributes.position.count}(e)/3}function La(e,t){const a=Da(e),i=t||e.drawRange,s=i.start/3,r=(i.start+i.count)/3,n=Math.max(0,s),o=Math.min(a,r)-n;return[{offset:Math.floor(n),count:Math.floor(o)}]}function Oa(e,t){if(!e.groups||!e.groups.length)return La(e,t);const a=[],i=new Set,s=t||e.drawRange,r=s.start/3,n=(s.start+s.count)/3;for(const t of e.groups){const e=t.start/3,a=(t.start+t.count)/3;i.add(Math.max(r,e)),i.add(Math.min(n,a))}const o=Array.from(i.values()).sort(((e,t)=>e-t));for(let e=0;e<o.length-1;e++){const t=o[e],i=o[e+1];a.push({offset:Math.floor(t),count:Math.floor(i-t)})}return a}function qa(e,t,a,i,s){let r=1/0,n=1/0,o=1/0,c=-1/0,h=-1/0,l=-1/0,b=1/0,d=1/0,u=1/0,f=-1/0,m=-1/0,p=-1/0;for(let i=6*t,s=6*(t+a);i<s;i+=6){const t=e[i+0],a=e[i+1],s=t-a,g=t+a;s<r&&(r=s),g>c&&(c=g),t<b&&(b=t),t>f&&(f=t);const y=e[i+2],x=e[i+3],w=y-x,v=y+x;w<n&&(n=w),v>h&&(h=v),y<d&&(d=y),y>m&&(m=y);const k=e[i+4],j=e[i+5],M=k-j,A=k+j;M<o&&(o=M),A>l&&(l=A),k<u&&(u=k),k>p&&(p=k)}i[0]=r,i[1]=n,i[2]=o,i[3]=c,i[4]=h,i[5]=l,s[0]=b,s[1]=d,s[2]=u,s[3]=f,s[4]=m,s[5]=p}function Va(e,t,a){return a.min.x=t[e],a.min.y=t[e+1],a.min.z=t[e+2],a.max.x=t[e+3],a.max.y=t[e+4],a.max.z=t[e+5],a}function Ga(e){let t=-1,a=-1/0;for(let i=0;i<3;i++){const s=e[i+3]-e[i];s>a&&(a=s,t=i)}return t}function Ha(e,t){t.set(e)}function _a(e,t,a){let i,s;for(let r=0;r<3;r++){const n=r+3;i=e[r],s=t[r],a[r]=i<s?i:s,i=e[n],s=t[n],a[n]=i>s?i:s}}function Na(e,t,a){for(let i=0;i<3;i++){const s=t[e+2*i],r=t[e+2*i+1],n=s-r,o=s+r;n<a[i]&&(a[i]=n),o>a[i+3]&&(a[i+3]=o)}}function Ua(e){const t=e[3]-e[0],a=e[4]-e[1],i=e[5]-e[2];return 2*(t*a+a*i+i*t)}const Ka=(e,t)=>e.candidate-t.candidate,Ja=new Array(32).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),Wa=new Float32Array(6);class Xa{constructor(){this.boundingData=new Float32Array(6)}}function Qa(e,t,a,i,s,r){let n=i,o=i+s-1;const c=r.pos,h=2*r.axis;for(;;){for(;n<=o&&a[6*n+h]<c;)n++;for(;n<=o&&a[6*o+h]>=c;)o--;if(!(n<o))return n;for(let e=0;e<3;e++){let a=t[3*n+e];t[3*n+e]=t[3*o+e],t[3*o+e]=a}for(let e=0;e<6;e++){let t=a[6*n+e];a[6*n+e]=a[6*o+e],a[6*o+e]=t}n++,o--}}function Ya(e,t,a,i,s,r){let n=i,o=i+s-1;const c=r.pos,h=2*r.axis;for(;;){for(;n<=o&&a[6*n+h]<c;)n++;for(;n<=o&&a[6*o+h]>=c;)o--;if(!(n<o))return n;{let t=e[n];e[n]=e[o],e[o]=t;for(let e=0;e<6;e++){let t=a[6*n+e];a[6*n+e]=a[6*o+e],a[6*o+e]=t}n++,o--}}}function Za(e,t){return 65535===t[e+15]}function $a(e,t){return t[e+6]}function ei(e,t){return t[e+14]}function ti(e){return e+8}function ai(e,t){return t[e+6]}function ii(e,t){return t[e+7]}let si,ri,ni,oi;const ci=Math.pow(2,32);function hi(e){return"count"in e?1:1+hi(e.left)+hi(e.right)}function li(e,t,a){return si=new Float32Array(a),ri=new Uint32Array(a),ni=new Uint16Array(a),oi=new Uint8Array(a),bi(e,t)}function bi(e,t){const a=e/4,i=e/2,s="count"in t,r=t.boundingData;for(let e=0;e<6;e++)si[a+e]=r[e];if(s){if(t.buffer){const i=t.buffer;oi.set(new Uint8Array(i),e);for(let t=e,s=e+i.byteLength;t<s;t+=32)Za(t/2,ni)||(ri[t/4+6]+=a);return e+i.byteLength}{const s=t.offset,r=t.count;return ri[a+6]=s,ni[i+14]=r,ni[i+15]=Ia,e+32}}{const i=t.left,s=t.right,r=t.splitAxis;let n;if(n=bi(e+32,i),n/4>ci)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return ri[a+6]=n/4,n=bi(n,s),ri[a+7]=r,n}}function di(e,a){const i=e.geometry;a.indirect&&(e._indirectBuffer=function(e,t){const a=(e.index?e.index.count:e.attributes.position.count)/3,i=a>65536,s=i?4:2,r=t?new SharedArrayBuffer(a*s):new ArrayBuffer(a*s),n=i?new Uint32Array(r):new Uint16Array(r);for(let e=0,t=n.length;e<t;e++)n[e]=e;return n}(i,a.useSharedArrayBuffer),function(e,t){const a=Da(e),i=Oa(e,t).sort(((e,t)=>e.offset-t.offset)),s=i[i.length-1];s.count=Math.min(a-s.offset,s.count);let r=0;return i.forEach((({count:e})=>r+=e)),a!==r}(i,a.range)&&!a.verbose&&console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),e._indirectBuffer||function(e,a){if(!e.index){const i=e.attributes.position.count,s=function(e,t=ArrayBuffer){return e>65535?new Uint32Array(new t(4*e)):new Uint16Array(new t(2*e))}(i,a.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);e.setIndex(new t.BufferAttribute(s,1));for(let e=0;e<i;e++)s[e]=e}}(i,a);const s=a.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,r=function(e,t=null,a=null,i=null){const s=e.attributes.position,r=e.index?e.index.array:null,n=Da(e),o=s.normalized;let c;null===t?(c=new Float32Array(6*n),a=0,i=n):(c=t,a=a||0,i=i||n);const h=s.array,l=s.offset||0;let b=3;s.isInterleavedBufferAttribute&&(b=s.data.stride);const d=["getX","getY","getZ"];for(let e=a;e<a+i;e++){const t=3*e,a=6*e;let i=t+0,n=t+1,u=t+2;r&&(i=r[i],n=r[n],u=r[u]),o||(i=i*b+l,n=n*b+l,u=u*b+l);for(let e=0;e<3;e++){let t,r,l;o?(t=s[d[e]](i),r=s[d[e]](n),l=s[d[e]](u)):(t=h[i+e],r=h[n+e],l=h[u+e]);let b=t;r<b&&(b=r),l<b&&(b=l);let f=t;r>f&&(f=r),l>f&&(f=l);const m=(f-b)/2,p=2*e;c[a+p+0]=b+m,c[a+p+1]=m+(Math.abs(b)+m)*Ba}}return c}(i),n=a.indirect?La(i,a.range):Oa(i,a.range);e._roots=n.map((t=>{const i=function(e,t,a,i,s){const{maxDepth:r,verbose:n,maxLeafTris:o,strategy:c,onProgress:h,indirect:l}=s,b=e._indirectBuffer,d=e.geometry,u=d.index?d.index.array:null,f=l?Ya:Qa,m=Da(d),p=new Float32Array(6);let g=!1;const y=new Xa;return qa(t,a,i,y.boundingData,p),function e(a,i,s,h=null,l=0){if(!g&&l>=r&&(g=!0,n&&(console.warn(`MeshBVH: Max depth of ${r} reached when generating BVH. Consider increasing maxDepth.`),console.warn(d))),s<=o||l>=r)return x(i+s),a.offset=i,a.count=s,a;const m=function(e,t,a,i,s,r){let n=-1,o=0;if(0===r)n=Ga(t),-1!==n&&(o=(t[n]+t[n+3])/2);else if(1===r)n=Ga(e),-1!==n&&(o=function(e,t,a,i){let s=0;for(let r=t,n=t+a;r<n;r++)s+=e[6*r+2*i];return s/a}(a,i,s,n));else if(2===r){const r=Ua(e);let c=Ta*s;const h=6*i,l=6*(i+s);for(let e=0;e<3;e++){const i=t[e],b=(t[e+3]-i)/32;if(s<8){const t=[...Ja];t.length=s;let i=0;for(let s=h;s<l;s+=6,i++){const r=t[i];r.candidate=a[s+2*e],r.count=0;const{bounds:n,leftCacheBounds:o,rightCacheBounds:c}=r;for(let e=0;e<3;e++)c[e]=1/0,c[e+3]=-1/0,o[e]=1/0,o[e+3]=-1/0,n[e]=1/0,n[e+3]=-1/0;Na(s,a,n)}t.sort(Ka);let b=s;for(let e=0;e<b;e++){const a=t[e];for(;e+1<b&&t[e+1].candidate===a.candidate;)t.splice(e+1,1),b--}for(let i=h;i<l;i+=6){const s=a[i+2*e];for(let e=0;e<b;e++){const r=t[e];s>=r.candidate?Na(i,a,r.rightCacheBounds):(Na(i,a,r.leftCacheBounds),r.count++)}}for(let a=0;a<b;a++){const i=t[a],h=i.count,l=s-i.count,b=i.leftCacheBounds,d=i.rightCacheBounds;let u=0;0!==h&&(u=Ua(b)/r);let f=0;0!==l&&(f=Ua(d)/r);const m=1+Ta*(u*h+f*l);m<c&&(n=e,c=m,o=i.candidate)}}else{for(let e=0;e<32;e++){const t=Ja[e];t.count=0,t.candidate=i+b+e*b;const a=t.bounds;for(let e=0;e<3;e++)a[e]=1/0,a[e+3]=-1/0}for(let t=h;t<l;t+=6){let s=~~((a[t+2*e]-i)/b);s>=32&&(s=31);const r=Ja[s];r.count++,Na(t,a,r.bounds)}const t=Ja[31];Ha(t.bounds,t.rightCacheBounds);for(let e=30;e>=0;e--){const t=Ja[e],a=Ja[e+1];_a(t.bounds,a.rightCacheBounds,t.rightCacheBounds)}let d=0;for(let t=0;t<31;t++){const a=Ja[t],i=a.count,h=a.bounds,l=Ja[t+1].rightCacheBounds;0!==i&&(0===d?Ha(h,Wa):_a(h,Wa,Wa)),d+=i;let b=0,u=0;0!==d&&(b=Ua(Wa)/r);const f=s-d;0!==f&&(u=Ua(l)/r);const m=1+Ta*(b*d+u*f);m<c&&(n=e,c=m,o=a.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${r} used.`);return{axis:n,pos:o}}(a.boundingData,h,t,i,s,c);if(-1===m.axis)return x(i+s),a.offset=i,a.count=s,a;const y=f(b,u,t,i,s,m);if(y===i||y===i+s)x(i+s),a.offset=i,a.count=s;else{a.splitAxis=m.axis;const r=new Xa,n=i,o=y-i;a.left=r,qa(t,n,o,r.boundingData,p),e(r,n,o,p,l+1);const c=new Xa,h=y,b=s-o;a.right=c,qa(t,h,b,c.boundingData,p),e(c,h,b,p,l+1)}return a}(y,a,i,p),y;function x(e){h&&h(e/m)}}(e,r,t.offset,t.count,a),n=hi(i),o=new s(32*n);return li(0,i,o),o}))}class ui{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let a=1/0,i=-1/0;for(let s=0,r=e.length;s<r;s++){const r=e[s][t];a=r<a?r:a,i=r>i?r:i}this.min=a,this.max=i}setFromPoints(e,t){let a=1/0,i=-1/0;for(let s=0,r=t.length;s<r;s++){const r=t[s],n=e.dot(r);a=n<a?n:a,i=n>i?n:i}this.min=a,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}}ui.prototype.setFromBox=function(){const e=new t.Vector3;return function(t,a){const i=a.min,s=a.max;let r=1/0,n=-1/0;for(let a=0;a<=1;a++)for(let o=0;o<=1;o++)for(let c=0;c<=1;c++){e.x=i.x*a+s.x*(1-a),e.y=i.y*o+s.y*(1-o),e.z=i.z*c+s.z*(1-c);const h=t.dot(e);r=Math.min(h,r),n=Math.max(h,n)}this.min=r,this.max=n}}();const fi=function(){const e=new t.Vector3,a=new t.Vector3,i=new t.Vector3;return function(t,s,r){const n=t.start,o=e,c=s.start,h=a;i.subVectors(n,c),e.subVectors(t.end,t.start),a.subVectors(s.end,s.start);const l=i.dot(h),b=h.dot(o),d=h.dot(h),u=i.dot(o),f=o.dot(o)*d-b*b;let m,p;m=0!==f?(l*b-u*d)/f:0,p=(l+m*b)/d,r.x=m,r.y=p}}(),mi=function(){const e=new t.Vector2,a=new t.Vector3,i=new t.Vector3;return function(t,s,r,n){fi(t,s,e);let o=e.x,c=e.y;if(o>=0&&o<=1&&c>=0&&c<=1)return t.at(o,r),void s.at(c,n);if(o>=0&&o<=1)return c<0?s.at(0,n):s.at(1,n),void t.closestPointToPoint(n,!0,r);if(c>=0&&c<=1)return o<0?t.at(0,r):t.at(1,r),void s.closestPointToPoint(r,!0,n);{let e,h;e=o<0?t.start:t.end,h=c<0?s.start:s.end;const l=a,b=i;return t.closestPointToPoint(h,!0,a),s.closestPointToPoint(e,!0,i),l.distanceToSquared(h)<=b.distanceToSquared(e)?(r.copy(l),void n.copy(h)):(r.copy(e),void n.copy(b))}}}(),pi=function(){const e=new t.Vector3,a=new t.Vector3,i=new t.Plane,s=new t.Line3;return function(t,r){const{radius:n,center:o}=t,{a:c,b:h,c:l}=r;if(s.start=c,s.end=h,s.closestPointToPoint(o,!0,e).distanceTo(o)<=n)return!0;if(s.start=c,s.end=l,s.closestPointToPoint(o,!0,e).distanceTo(o)<=n)return!0;if(s.start=h,s.end=l,s.closestPointToPoint(o,!0,e).distanceTo(o)<=n)return!0;const b=r.getPlane(i);if(Math.abs(b.distanceToPoint(o))<=n){const e=b.projectPoint(o,a);if(r.containsPoint(e))return!0}return!1}}();function gi(e){return Math.abs(e)<1e-15}class yi extends t.Triangle{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new t.Vector3)),this.satBounds=new Array(4).fill().map((()=>new ui)),this.points=[this.a,this.b,this.c],this.sphere=new t.Sphere,this.plane=new t.Plane,this.needsUpdate=!0}intersectsSphere(e){return pi(e,this)}update(){const e=this.a,t=this.b,a=this.c,i=this.points,s=this.satAxes,r=this.satBounds,n=s[0],o=r[0];this.getNormal(n),o.setFromPoints(n,i);const c=s[1],h=r[1];c.subVectors(e,t),h.setFromPoints(c,i);const l=s[2],b=r[2];l.subVectors(t,a),b.setFromPoints(l,i);const d=s[3],u=r[3];d.subVectors(a,e),u.setFromPoints(d,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(n,e),this.needsUpdate=!1}}yi.prototype.closestPointToSegment=function(){const e=new t.Vector3,a=new t.Vector3,i=new t.Line3;return function(t,s=null,r=null){const{start:n,end:o}=t,c=this.points;let h,l=1/0;for(let n=0;n<3;n++){const o=(n+1)%3;i.start.copy(c[n]),i.end.copy(c[o]),mi(i,t,e,a),h=e.distanceToSquared(a),h<l&&(l=h,s&&s.copy(e),r&&r.copy(a))}return this.closestPointToPoint(n,e),h=n.distanceToSquared(e),h<l&&(l=h,s&&s.copy(e),r&&r.copy(n)),this.closestPointToPoint(o,e),h=o.distanceToSquared(e),h<l&&(l=h,s&&s.copy(e),r&&r.copy(o)),Math.sqrt(l)}}(),yi.prototype.intersectsTriangle=function(){const e=new yi,a=new Array(3),i=new Array(3),s=new ui,r=new ui,n=new t.Vector3,o=new t.Vector3,c=new t.Vector3,h=new t.Vector3,l=new t.Vector3,b=new t.Line3,d=new t.Line3,u=new t.Line3,f=new t.Vector3;function m(e,t,a){const i=e.points;let s=0,r=-1;for(let e=0;e<3;e++){const{start:n,end:c}=b;n.copy(i[e]),c.copy(i[(e+1)%3]),b.delta(o);const h=gi(t.distanceToPoint(n));if(gi(t.normal.dot(o))&&h){a.copy(b),s=2;break}const l=t.intersectLine(b,f);if(!l&&h&&f.copy(n),(l||h)&&!gi(f.distanceTo(c))){if(s<=1)(1===s?a.start:a.end).copy(f),h&&(r=s);else if(s>=2){(1===r?a.start:a.end).copy(f),s=2;break}if(s++,2===s&&-1===r)break}}return s}return function(t,o=null,b=!1){this.needsUpdate&&this.update(),t.isExtendedTriangle?t.needsUpdate&&t.update():(e.copy(t),e.update(),t=e);const f=this.plane,p=t.plane;if(Math.abs(f.normal.dot(p.normal))>1-1e-10){const e=this.satBounds,c=this.satAxes;i[0]=t.a,i[1]=t.b,i[2]=t.c;for(let t=0;t<4;t++){const a=e[t],r=c[t];if(s.setFromPoints(r,i),a.isSeparated(s))return!1}const h=t.satBounds,l=t.satAxes;a[0]=this.a,a[1]=this.b,a[2]=this.c;for(let e=0;e<4;e++){const t=h[e],i=l[e];if(s.setFromPoints(i,a),t.isSeparated(s))return!1}for(let e=0;e<4;e++){const t=c[e];for(let e=0;e<4;e++){const o=l[e];if(n.crossVectors(t,o),s.setFromPoints(n,a),r.setFromPoints(n,i),s.isSeparated(r))return!1}}return o&&(b||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),o.start.set(0,0,0),o.end.set(0,0,0)),!0}{const e=m(this,p,d);if(1===e&&t.containsPoint(d.end))return o&&(o.start.copy(d.end),o.end.copy(d.end)),!0;if(2!==e)return!1;const a=m(t,f,u);if(1===a&&this.containsPoint(u.end))return o&&(o.start.copy(u.end),o.end.copy(u.end)),!0;if(2!==a)return!1;if(d.delta(c),u.delta(h),c.dot(h)<0){let e=u.start;u.start=u.end,u.end=e}const i=d.start.dot(c),s=d.end.dot(c),r=u.start.dot(c),n=u.end.dot(c);return(i===n||r===s||s<r!=i<n)&&(o&&(l.subVectors(d.start,u.start),l.dot(c)>0?o.start.copy(d.start):o.start.copy(u.start),l.subVectors(d.end,u.end),l.dot(c)<0?o.end.copy(d.end):o.end.copy(u.end)),!0)}}}(),yi.prototype.distanceToPoint=function(){const e=new t.Vector3;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),yi.prototype.distanceToTriangle=function(){const e=new t.Vector3,a=new t.Vector3,i=["a","b","c"],s=new t.Line3,r=new t.Line3;return function(t,n=null,o=null){const c=n||o?s:null;if(this.intersectsTriangle(t,c))return(n||o)&&(n&&c.getCenter(n),o&&c.getCenter(o)),0;let h=1/0;for(let a=0;a<3;a++){let s;const r=i[a],c=t[r];this.closestPointToPoint(c,e),s=c.distanceToSquared(e),s<h&&(h=s,n&&n.copy(e),o&&o.copy(c));const l=this[r];t.closestPointToPoint(l,e),s=l.distanceToSquared(e),s<h&&(h=s,n&&n.copy(l),o&&o.copy(e))}for(let c=0;c<3;c++){const l=i[c],b=i[(c+1)%3];s.set(this[l],this[b]);for(let c=0;c<3;c++){const l=i[c],b=i[(c+1)%3];r.set(t[l],t[b]),mi(s,r,e,a);const d=e.distanceToSquared(a);d<h&&(h=d,n&&n.copy(e),o&&o.copy(a))}}return Math.sqrt(h)}}();class xi{constructor(e,a,i){this.isOrientedBox=!0,this.min=new t.Vector3,this.max=new t.Vector3,this.matrix=new t.Matrix4,this.invMatrix=new t.Matrix4,this.points=new Array(8).fill().map((()=>new t.Vector3)),this.satAxes=new Array(3).fill().map((()=>new t.Vector3)),this.satBounds=new Array(3).fill().map((()=>new ui)),this.alignedSatBounds=new Array(3).fill().map((()=>new ui)),this.needsUpdate=!1,e&&this.min.copy(e),a&&this.max.copy(a),i&&this.matrix.copy(i)}set(e,t,a){this.min.copy(e),this.max.copy(t),this.matrix.copy(a),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}xi.prototype.update=function(){const e=this.matrix,t=this.min,a=this.max,i=this.points;for(let s=0;s<=1;s++)for(let r=0;r<=1;r++)for(let n=0;n<=1;n++){const o=i[1*s|2*r|4*n];o.x=s?a.x:t.x,o.y=r?a.y:t.y,o.z=n?a.z:t.z,o.applyMatrix4(e)}const s=this.satBounds,r=this.satAxes,n=i[0];for(let e=0;e<3;e++){const t=r[e],a=s[e],o=i[1<<e];t.subVectors(n,o),a.setFromPoints(t,i)}const o=this.alignedSatBounds;o[0].setFromPointsField(i,"x"),o[1].setFromPointsField(i,"y"),o[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},xi.prototype.intersectsBox=function(){const e=new ui;return function(t){this.needsUpdate&&this.update();const a=t.min,i=t.max,s=this.satBounds,r=this.satAxes,n=this.alignedSatBounds;if(e.min=a.x,e.max=i.x,n[0].isSeparated(e))return!1;if(e.min=a.y,e.max=i.y,n[1].isSeparated(e))return!1;if(e.min=a.z,e.max=i.z,n[2].isSeparated(e))return!1;for(let a=0;a<3;a++){const i=r[a],n=s[a];if(e.setFromBox(i,t),n.isSeparated(e))return!1}return!0}}(),xi.prototype.intersectsTriangle=function(){const e=new yi,a=new Array(3),i=new ui,s=new ui,r=new t.Vector3;return function(t){this.needsUpdate&&this.update(),t.isExtendedTriangle?t.needsUpdate&&t.update():(e.copy(t),e.update(),t=e);const n=this.satBounds,o=this.satAxes;a[0]=t.a,a[1]=t.b,a[2]=t.c;for(let e=0;e<3;e++){const t=n[e],s=o[e];if(i.setFromPoints(s,a),t.isSeparated(i))return!1}const c=t.satBounds,h=t.satAxes,l=this.points;for(let e=0;e<3;e++){const t=c[e],a=h[e];if(i.setFromPoints(a,l),t.isSeparated(i))return!1}for(let e=0;e<3;e++){const t=o[e];for(let e=0;e<4;e++){const n=h[e];if(r.crossVectors(t,n),i.setFromPoints(r,a),s.setFromPoints(r,l),i.isSeparated(s))return!1}}return!0}}(),xi.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},xi.prototype.distanceToPoint=function(){const e=new t.Vector3;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),xi.prototype.distanceToBox=function(){const e=["x","y","z"],a=new Array(12).fill().map((()=>new t.Line3)),i=new Array(12).fill().map((()=>new t.Line3)),s=new t.Vector3,r=new t.Vector3;return function(t,n=0,o=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(t))return(o||c)&&(t.getCenter(r),this.closestPointToPoint(r,s),t.closestPointToPoint(s,r),o&&o.copy(s),c&&c.copy(r)),0;const h=n*n,l=t.min,b=t.max,d=this.points;let u=1/0;for(let e=0;e<8;e++){const t=d[e];r.copy(t).clamp(l,b);const a=t.distanceToSquared(r);if(a<u&&(u=a,o&&o.copy(t),c&&c.copy(r),a<h))return Math.sqrt(a)}let f=0;for(let t=0;t<3;t++)for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){const n=(t+1)%3,o=(t+2)%3,c=1<<t|s<<n|r<<o,h=d[s<<n|r<<o],u=d[c];a[f].set(h,u);const m=e[t],p=e[n],g=e[o],y=i[f],x=y.start,w=y.end;x[m]=l[m],x[p]=s?l[p]:b[p],x[g]=r?l[g]:b[p],w[m]=b[m],w[p]=s?l[p]:b[p],w[g]=r?l[g]:b[p],f++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let a=0;a<=1;a++){r.x=e?b.x:l.x,r.y=t?b.y:l.y,r.z=a?b.z:l.z,this.closestPointToPoint(r,s);const i=r.distanceToSquared(s);if(i<u&&(u=i,o&&o.copy(s),c&&c.copy(r),i<h))return Math.sqrt(i)}for(let e=0;e<12;e++){const t=a[e];for(let e=0;e<12;e++){const a=i[e];mi(t,a,s,r);const n=s.distanceToSquared(r);if(n<u&&(u=n,o&&o.copy(s),c&&c.copy(r),n<h))return Math.sqrt(n)}}return Math.sqrt(u)}}();class wi{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}const vi=new class extends wi{constructor(){super((()=>new yi))}},ki=new class{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=a=>{t&&e.push(t),t=a,this.float32Array=new Float32Array(a),this.uint16Array=new Uint16Array(a),this.uint32Array=new Uint32Array(a)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,0!==e.length&&this.setBuffer(e.pop())}}};let ji,Mi;const Ai=[],Si=new wi((()=>new t.Box3));function Ei(e,t,a,i,s,r){ji=Si.getPrimitive(),Mi=Si.getPrimitive(),Ai.push(ji,Mi),ki.setBuffer(e._roots[t]);const n=Fi(0,e.geometry,a,i,s,r);ki.clearBuffer(),Si.releasePrimitive(ji),Si.releasePrimitive(Mi),Ai.pop(),Ai.pop();const o=Ai.length;return o>0&&(Mi=Ai[o-1],ji=Ai[o-2]),n}function Fi(e,t,a,i,s=null,r=0,n=0){const{float32Array:o,uint16Array:c,uint32Array:h}=ki;let l=2*e;if(Za(l,c)){const b=$a(e,h),d=ei(l,c);return Va(e,o,ji),i(b,d,!1,n,r+e,ji)}{const u=ti(e),f=ai(e,h);let m,p,g,y,x=u,w=f;if(s&&(g=ji,y=Mi,Va(x,o,g),Va(w,o,y),m=s(g),p=s(y),p<m)){x=f,w=u;const E=m;m=p,p=E,g=y}g||(g=ji,Va(x,o,g));const v=a(g,Za(2*x,c),m,n+1,r+x);let k;if(2===v){const F=A(x);k=i(F,S(x)-F,!0,n+1,r+x,g)}else k=v&&Fi(x,t,a,i,s,r,n+1);if(k)return!0;y=Mi,Va(w,o,y);const j=a(y,Za(2*w,c),p,n+1,r+w);let M;if(2===j){const z=A(w);M=i(z,S(w)-z,!0,n+1,r+w,y)}else M=j&&Fi(w,t,a,i,s,r,n+1);return!!M;function A(e){const{uint16Array:t,uint32Array:a}=ki;let i=2*e;for(;!Za(i,t);)i=2*(e=ti(e));return $a(e,a)}function S(e){const{uint16Array:t,uint32Array:a}=ki;let i=2*e;for(;!Za(i,t);)i=2*(e=ai(e,a));return $a(e,a)+ei(i,t)}}}const zi=new t.Vector3,Ri=new t.Vector3,Pi=parseInt(t.REVISION)>=169,Ti=new t.Vector3,Ii=new t.Vector3,Bi=new t.Vector3,Ci=new t.Vector2,Di=new t.Vector2,Li=new t.Vector2,Oi=new t.Vector3,qi=new t.Vector3,Vi=new t.Vector3,Gi=new t.Vector3;function Hi(e,a,i,s,r,n,o){const c=3*s;let h=c+0,l=c+1,b=c+2;const d=e.index;e.index&&(h=d.getX(h),l=d.getX(l),b=d.getX(b));const{position:u,normal:f,uv:m,uv1:p}=e.attributes,g=function(e,a,i,s,r,n,o,c,h,l,b){Ti.fromBufferAttribute(a,n),Ii.fromBufferAttribute(a,o),Bi.fromBufferAttribute(a,c);const d=function(e,a,i,s,r,n,o,c){let h;if(h=n===t.BackSide?e.intersectTriangle(s,i,a,!0,r):e.intersectTriangle(a,i,s,n!==t.DoubleSide,r),null===h)return null;const l=e.origin.distanceTo(r);return l<o||l>c?null:{distance:l,point:r.clone()}}(e,Ti,Ii,Bi,Gi,h,l,b);if(d){const a=new t.Vector3;t.Triangle.getBarycoord(Gi,Ti,Ii,Bi,a),s&&(Ci.fromBufferAttribute(s,n),Di.fromBufferAttribute(s,o),Li.fromBufferAttribute(s,c),d.uv=t.Triangle.getInterpolation(Gi,Ti,Ii,Bi,Ci,Di,Li,new t.Vector2)),r&&(Ci.fromBufferAttribute(r,n),Di.fromBufferAttribute(r,o),Li.fromBufferAttribute(r,c),d.uv1=t.Triangle.getInterpolation(Gi,Ti,Ii,Bi,Ci,Di,Li,new t.Vector2)),i&&(Oi.fromBufferAttribute(i,n),qi.fromBufferAttribute(i,o),Vi.fromBufferAttribute(i,c),d.normal=t.Triangle.getInterpolation(Gi,Ti,Ii,Bi,Oi,qi,Vi,new t.Vector3),d.normal.dot(e.direction)>0&&d.normal.multiplyScalar(-1));const h={a:n,b:o,c:c,normal:new t.Vector3,materialIndex:0};t.Triangle.getNormal(Ti,Ii,Bi,h.normal),d.face=h,d.faceIndex=n,Pi&&(d.barycoord=a)}return d}(i,u,f,m,p,h,l,b,a,n,o);return g?(g.faceIndex=s,r&&r.push(g),g):null}function _i(e,t,a,i){const s=e.a,r=e.b,n=e.c;let o=t,c=t+1,h=t+2;a&&(o=a.getX(o),c=a.getX(c),h=a.getX(h)),s.x=i.getX(o),s.y=i.getY(o),s.z=i.getZ(o),r.x=i.getX(c),r.y=i.getY(c),r.z=i.getZ(c),n.x=i.getX(h),n.y=i.getY(h),n.z=i.getZ(h)}function Ni(e,t,a,i,s,r,n){const{geometry:o}=a,{index:c}=o,h=o.attributes.position;for(let a=e,o=t+e;a<o;a++){let e;if(e=a,_i(n,3*e,c,h),n.needsUpdate=!0,i(n,e,s,r))return!0}return!1}function Ui(e,t=null){t&&Array.isArray(t)&&(t=new Set(t));const a=e.geometry,i=a.index?a.index.array:null,s=a.attributes.position;let r,n,o,c,h=0;const l=e._roots;for(let e=0,t=l.length;e<t;e++)r=l[e],n=new Uint32Array(r),o=new Uint16Array(r),c=new Float32Array(r),b(0,h),h+=r.byteLength;function b(e,a,r=!1){const h=2*e;if(o[h+15]===Ia){const t=n[e+6];let a=1/0,r=1/0,l=1/0,b=-1/0,d=-1/0,u=-1/0;for(let e=3*t,n=3*(t+o[h+14]);e<n;e++){let t=i[e];const n=s.getX(t),o=s.getY(t),c=s.getZ(t);n<a&&(a=n),n>b&&(b=n),o<r&&(r=o),o>d&&(d=o),c<l&&(l=c),c>u&&(u=c)}return(c[e+0]!==a||c[e+1]!==r||c[e+2]!==l||c[e+3]!==b||c[e+4]!==d||c[e+5]!==u)&&(c[e+0]=a,c[e+1]=r,c[e+2]=l,c[e+3]=b,c[e+4]=d,c[e+5]=u,!0)}{const i=e+8,s=n[e+6],o=i+a,h=s+a;let l=r,d=!1,u=!1;t?l||(d=t.has(o),u=t.has(h),l=!d&&!u):(d=!0,u=!0);const f=l||u;let m=!1;(l||d)&&(m=b(i,a,l));let p=!1;f&&(p=b(s,a,l));const g=m||p;if(g)for(let t=0;t<3;t++){const a=i+t,r=s+t,n=c[a],o=c[a+3],h=c[r],l=c[r+3];c[e+t]=n<h?n:h,c[e+t+3]=o>l?o:l}return g}}}function Ki(e,t,a,i,s){let r,n,o,c,h,l;const b=1/a.direction.x,d=1/a.direction.y,u=1/a.direction.z,f=a.origin.x,m=a.origin.y,p=a.origin.z;let g=t[e],y=t[e+3],x=t[e+1],w=t[e+3+1],v=t[e+2],k=t[e+3+2];return b>=0?(r=(g-f)*b,n=(y-f)*b):(r=(y-f)*b,n=(g-f)*b),d>=0?(o=(x-m)*d,c=(w-m)*d):(o=(w-m)*d,c=(x-m)*d),!(r>c||o>n)&&((o>r||isNaN(r))&&(r=o),(c<n||isNaN(n))&&(n=c),u>=0?(h=(v-p)*u,l=(k-p)*u):(h=(k-p)*u,l=(v-p)*u),!(r>l||h>n)&&((h>r||r!=r)&&(r=h),(l<n||n!=n)&&(n=l),r<=s&&n>=i))}function Ji(e,t,a,i,s,r,n){const{geometry:o}=a,{index:c}=o,h=o.attributes.position;for(let o=e,l=t+e;o<l;o++){let e;if(e=a.resolveTriangleIndex(o),_i(n,3*e,c,h),n.needsUpdate=!0,i(n,e,s,r))return!0}return!1}function Wi(e,t,a,i,s,r,n){ki.setBuffer(e._roots[t]),Xi(0,e,a,i,s,r,n),ki.clearBuffer()}function Xi(e,t,a,i,s,r,n){const{float32Array:o,uint16Array:c,uint32Array:h}=ki,l=2*e;if(Za(l,c))!function(e,t,a,i,s,r,n,o){const{geometry:c,_indirectBuffer:h}=e;for(let e=i,h=i+s;e<h;e++)Hi(c,t,a,e,r,n,o)}(t,a,i,$a(e,h),ei(l,c),s,r,n);else{const c=ti(e);Ki(c,o,i,r,n)&&Xi(c,t,a,i,s,r,n);const l=ai(e,h);Ki(l,o,i,r,n)&&Xi(l,t,a,i,s,r,n)}}const Qi=["x","y","z"];function Yi(e,t,a,i,s,r){ki.setBuffer(e._roots[t]);const n=Zi(0,e,a,i,s,r);return ki.clearBuffer(),n}function Zi(e,t,a,i,s,r){const{float32Array:n,uint16Array:o,uint32Array:c}=ki;let h=2*e;if(Za(h,o))return function(e,t,a,i,s,r,n){const{geometry:o,_indirectBuffer:c}=e;let h=1/0,l=null;for(let e=i,c=i+s;e<c;e++){let i;i=Hi(o,t,a,e,null,r,n),i&&i.distance<h&&(l=i,h=i.distance)}return l}(t,a,i,$a(e,c),ei(h,o),s,r);{const o=ii(e,c),h=Qi[o],l=i.direction[h]>=0;let b,d;l?(b=ti(e),d=ai(e,c)):(b=ai(e,c),d=ti(e));const u=Ki(b,n,i,s,r)?Zi(b,t,a,i,s,r):null;if(u){const e=u.point[h];if(l?e<=n[d+o]:e>=n[d+o+3])return u}const f=Ki(d,n,i,s,r)?Zi(d,t,a,i,s,r):null;return u&&f?u.distance<=f.distance?u:f:u||f||null}}const $i=new t.Box3,es=new yi,ts=new yi,as=new t.Matrix4,is=new xi,ss=new xi;function rs(e,t,a,i){ki.setBuffer(e._roots[t]);const s=ns(0,e,a,i);return ki.clearBuffer(),s}function ns(e,t,a,i,s=null){const{float32Array:r,uint16Array:n,uint32Array:o}=ki;let c=2*e;if(null===s&&(a.boundingBox||a.computeBoundingBox(),is.set(a.boundingBox.min,a.boundingBox.max,i),s=is),!Za(c,n)){const n=e+8,c=o[e+6];return Va(n,r,$i),s.intersectsBox($i)&&ns(n,t,a,i,s)?!0:(Va(c,r,$i),!(!s.intersectsBox($i)||!ns(c,t,a,i,s)))}{const s=t.geometry,h=s.index,l=s.attributes.position,b=a.index,d=a.attributes.position,u=$a(e,o),f=ei(c,n);if(as.copy(i).invert(),a.boundsTree){Va(e,r,ss),ss.matrix.copy(as),ss.needsUpdate=!0;const t=a.boundsTree.shapecast({intersectsBounds:e=>ss.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let t=3*u,a=3*(f+u);t<a;t+=3)if(_i(ts,t,h,l),ts.needsUpdate=!0,e.intersectsTriangle(ts))return!0;return!1}});return t}for(let e=3*u,t=3*(f+u);e<t;e+=3){_i(es,e,h,l),es.a.applyMatrix4(as),es.b.applyMatrix4(as),es.c.applyMatrix4(as),es.needsUpdate=!0;for(let e=0,t=b.count;e<t;e+=3)if(_i(ts,e,b,d),ts.needsUpdate=!0,es.intersectsTriangle(ts))return!0}}}const os=new t.Matrix4,cs=new xi,hs=new xi,ls=new t.Vector3,bs=new t.Vector3,ds=new t.Vector3,us=new t.Vector3;function fs(e,t,a,i={},s={},r=0,n=1/0){t.boundingBox||t.computeBoundingBox(),cs.set(t.boundingBox.min,t.boundingBox.max,a),cs.needsUpdate=!0;const o=e.geometry,c=o.attributes.position,h=o.index,l=t.attributes.position,b=t.index,d=vi.getPrimitive(),u=vi.getPrimitive();let f=ls,m=bs,p=null,g=null;s&&(p=ds,g=us);let y=1/0,x=null,w=null;return os.copy(a).invert(),hs.matrix.copy(os),e.shapecast({boundsTraverseOrder:e=>cs.distanceToBox(e),intersectsBounds:(e,t,a)=>a<y&&a<n&&(t&&(hs.min.copy(e.min),hs.max.copy(e.max),hs.needsUpdate=!0),!0),intersectsRange:(e,i)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:e=>hs.distanceToBox(e),intersectsBounds:(e,t,a)=>a<y&&a<n,intersectsRange:(t,s)=>{for(let n=t,o=t+s;n<o;n++){_i(u,3*n,b,l),u.a.applyMatrix4(a),u.b.applyMatrix4(a),u.c.applyMatrix4(a),u.needsUpdate=!0;for(let t=e,a=e+i;t<a;t++){_i(d,3*t,h,c),d.needsUpdate=!0;const e=d.distanceToTriangle(u,f,p);if(e<y&&(m.copy(f),g&&g.copy(p),y=e,x=t,w=n),e<r)return!0}}}});for(let s=0,n=Da(t);s<n;s++){_i(u,3*s,b,l),u.a.applyMatrix4(a),u.b.applyMatrix4(a),u.c.applyMatrix4(a),u.needsUpdate=!0;for(let t=e,a=e+i;t<a;t++){_i(d,3*t,h,c),d.needsUpdate=!0;const e=d.distanceToTriangle(u,f,p);if(e<y&&(m.copy(f),g&&g.copy(p),y=e,x=t,w=s),e<r)return!0}}}}),vi.releasePrimitive(d),vi.releasePrimitive(u),y===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=y,i.faceIndex=x,s&&(s.point?s.point.copy(g):s.point=g.clone(),s.point.applyMatrix4(os),m.applyMatrix4(os),s.distance=m.sub(s.point).length(),s.faceIndex=w),i)}function ms(e,t=null){t&&Array.isArray(t)&&(t=new Set(t));const a=e.geometry,i=a.index?a.index.array:null,s=a.attributes.position;let r,n,o,c,h=0;const l=e._roots;for(let e=0,t=l.length;e<t;e++)r=l[e],n=new Uint32Array(r),o=new Uint16Array(r),c=new Float32Array(r),b(0,h),h+=r.byteLength;function b(a,r,h=!1){const l=2*a;if(o[l+15]===Ia){const t=n[a+6];let r=1/0,h=1/0,b=1/0,d=-1/0,u=-1/0,f=-1/0;for(let a=t,n=t+o[l+14];a<n;a++){const t=3*e.resolveTriangleIndex(a);for(let e=0;e<3;e++){let a=t+e;a=i?i[a]:a;const n=s.getX(a),o=s.getY(a),c=s.getZ(a);n<r&&(r=n),n>d&&(d=n),o<h&&(h=o),o>u&&(u=o),c<b&&(b=c),c>f&&(f=c)}}return(c[a+0]!==r||c[a+1]!==h||c[a+2]!==b||c[a+3]!==d||c[a+4]!==u||c[a+5]!==f)&&(c[a+0]=r,c[a+1]=h,c[a+2]=b,c[a+3]=d,c[a+4]=u,c[a+5]=f,!0)}{const e=a+8,i=n[a+6],s=e+r,o=i+r;let l=h,d=!1,u=!1;t?l||(d=t.has(s),u=t.has(o),l=!d&&!u):(d=!0,u=!0);const f=l||u;let m=!1;(l||d)&&(m=b(e,r,l));let p=!1;f&&(p=b(i,r,l));const g=m||p;if(g)for(let t=0;t<3;t++){const s=e+t,r=i+t,n=c[s],o=c[s+3],h=c[r],l=c[r+3];c[a+t]=n<h?n:h,c[a+t+3]=o>l?o:l}return g}}}function ps(e,t,a,i,s,r,n){ki.setBuffer(e._roots[t]),gs(0,e,a,i,s,r,n),ki.clearBuffer()}function gs(e,t,a,i,s,r,n){const{float32Array:o,uint16Array:c,uint32Array:h}=ki,l=2*e;if(Za(l,c))!function(e,t,a,i,s,r,n,o){const{geometry:c,_indirectBuffer:h}=e;for(let e=i,l=i+s;e<l;e++)Hi(c,t,a,h?h[e]:e,r,n,o)}(t,a,i,$a(e,h),ei(l,c),s,r,n);else{const c=ti(e);Ki(c,o,i,r,n)&&gs(c,t,a,i,s,r,n);const l=ai(e,h);Ki(l,o,i,r,n)&&gs(l,t,a,i,s,r,n)}}const ys=["x","y","z"];function xs(e,t,a,i,s,r){ki.setBuffer(e._roots[t]);const n=ws(0,e,a,i,s,r);return ki.clearBuffer(),n}function ws(e,t,a,i,s,r){const{float32Array:n,uint16Array:o,uint32Array:c}=ki;let h=2*e;if(Za(h,o))return function(e,t,a,i,s,r,n){const{geometry:o,_indirectBuffer:c}=e;let h=1/0,l=null;for(let e=i,b=i+s;e<b;e++){let i;i=Hi(o,t,a,c?c[e]:e,null,r,n),i&&i.distance<h&&(l=i,h=i.distance)}return l}(t,a,i,$a(e,c),ei(h,o),s,r);{const o=ii(e,c),h=ys[o],l=i.direction[h]>=0;let b,d;l?(b=ti(e),d=ai(e,c)):(b=ai(e,c),d=ti(e));const u=Ki(b,n,i,s,r)?ws(b,t,a,i,s,r):null;if(u){const e=u.point[h];if(l?e<=n[d+o]:e>=n[d+o+3])return u}const f=Ki(d,n,i,s,r)?ws(d,t,a,i,s,r):null;return u&&f?u.distance<=f.distance?u:f:u||f||null}}const vs=new t.Box3,ks=new yi,js=new yi,Ms=new t.Matrix4,As=new xi,Ss=new xi;function Es(e,t,a,i){ki.setBuffer(e._roots[t]);const s=Fs(0,e,a,i);return ki.clearBuffer(),s}function Fs(e,t,a,i,s=null){const{float32Array:r,uint16Array:n,uint32Array:o}=ki;let c=2*e;if(null===s&&(a.boundingBox||a.computeBoundingBox(),As.set(a.boundingBox.min,a.boundingBox.max,i),s=As),!Za(c,n)){const n=e+8,c=o[e+6];return Va(n,r,vs),s.intersectsBox(vs)&&Fs(n,t,a,i,s)?!0:(Va(c,r,vs),!(!s.intersectsBox(vs)||!Fs(c,t,a,i,s)))}{const s=t.geometry,h=s.index,l=s.attributes.position,b=a.index,d=a.attributes.position,u=$a(e,o),f=ei(c,n);if(Ms.copy(i).invert(),a.boundsTree){Va(e,r,Ss),Ss.matrix.copy(Ms),Ss.needsUpdate=!0;const s=a.boundsTree.shapecast({intersectsBounds:e=>Ss.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let a=u,i=f+u;a<i;a++)if(_i(js,3*t.resolveTriangleIndex(a),h,l),js.needsUpdate=!0,e.intersectsTriangle(js))return!0;return!1}});return s}for(let e=u,a=f+u;e<a;e++){const a=t.resolveTriangleIndex(e);_i(ks,3*a,h,l),ks.a.applyMatrix4(Ms),ks.b.applyMatrix4(Ms),ks.c.applyMatrix4(Ms),ks.needsUpdate=!0;for(let e=0,t=b.count;e<t;e+=3)if(_i(js,e,b,d),js.needsUpdate=!0,ks.intersectsTriangle(js))return!0}}}const zs=new t.Matrix4,Rs=new xi,Ps=new xi,Ts=new t.Vector3,Is=new t.Vector3,Bs=new t.Vector3,Cs=new t.Vector3;function Ds(e,t,a,i={},s={},r=0,n=1/0){t.boundingBox||t.computeBoundingBox(),Rs.set(t.boundingBox.min,t.boundingBox.max,a),Rs.needsUpdate=!0;const o=e.geometry,c=o.attributes.position,h=o.index,l=t.attributes.position,b=t.index,d=vi.getPrimitive(),u=vi.getPrimitive();let f=Ts,m=Is,p=null,g=null;s&&(p=Bs,g=Cs);let y=1/0,x=null,w=null;return zs.copy(a).invert(),Ps.matrix.copy(zs),e.shapecast({boundsTraverseOrder:e=>Rs.distanceToBox(e),intersectsBounds:(e,t,a)=>a<y&&a<n&&(t&&(Ps.min.copy(e.min),Ps.max.copy(e.max),Ps.needsUpdate=!0),!0),intersectsRange:(i,s)=>{if(t.boundsTree){const o=t.boundsTree;return o.shapecast({boundsTraverseOrder:e=>Ps.distanceToBox(e),intersectsBounds:(e,t,a)=>a<y&&a<n,intersectsRange:(t,n)=>{for(let v=t,k=t+n;v<k;v++){const t=o.resolveTriangleIndex(v);_i(u,3*t,b,l),u.a.applyMatrix4(a),u.b.applyMatrix4(a),u.c.applyMatrix4(a),u.needsUpdate=!0;for(let t=i,a=i+s;t<a;t++){const a=e.resolveTriangleIndex(t);_i(d,3*a,h,c),d.needsUpdate=!0;const i=d.distanceToTriangle(u,f,p);if(i<y&&(m.copy(f),g&&g.copy(p),y=i,x=t,w=v),i<r)return!0}}}})}for(let n=0,o=Da(t);n<o;n++){_i(u,3*n,b,l),u.a.applyMatrix4(a),u.b.applyMatrix4(a),u.c.applyMatrix4(a),u.needsUpdate=!0;for(let t=i,a=i+s;t<a;t++){const a=e.resolveTriangleIndex(t);_i(d,3*a,h,c),d.needsUpdate=!0;const i=d.distanceToTriangle(u,f,p);if(i<y&&(m.copy(f),g&&g.copy(p),y=i,x=t,w=n),i<r)return!0}}}}),vi.releasePrimitive(d),vi.releasePrimitive(u),y===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=y,i.faceIndex=x,s&&(s.point?s.point.copy(g):s.point=g.clone(),s.point.applyMatrix4(zs),m.applyMatrix4(zs),s.distance=m.sub(s.point).length(),s.faceIndex=w),i)}const Ls=new ki.constructor,Os=new ki.constructor,qs=new wi((()=>new t.Box3)),Vs=new t.Box3,Gs=new t.Box3,Hs=new t.Box3,_s=new t.Box3;let Ns=!1;function Us(e,t,a,i,s,r=0,n=0,o=0,c=0,h=null,l=!1){let b,d;l?(b=Os,d=Ls):(b=Ls,d=Os);const u=b.float32Array,f=b.uint32Array,m=b.uint16Array,p=d.float32Array,g=d.uint32Array,y=d.uint16Array,x=2*t,w=Za(2*e,m),v=Za(x,y);let k=!1;if(v&&w)k=l?s($a(t,g),ei(2*t,y),$a(e,f),ei(2*e,m),c,n+t,o,r+e):s($a(e,f),ei(2*e,m),$a(t,g),ei(2*t,y),o,r+e,c,n+t);else if(v){const h=qs.getPrimitive();Va(t,p,h),h.applyMatrix4(a);const b=ti(e),d=ai(e,f);Va(b,u,Vs),Va(d,u,Gs);const m=h.intersectsBox(Vs),g=h.intersectsBox(Gs);k=m&&Us(t,b,i,a,s,n,r,c,o+1,h,!l)||g&&Us(t,d,i,a,s,n,r,c,o+1,h,!l),qs.releasePrimitive(h)}else{const b=ti(t),d=ai(t,g);Va(b,p,Hs),Va(d,p,_s);const m=h.intersectsBox(Hs),y=h.intersectsBox(_s);if(m&&y)k=Us(e,b,a,i,s,r,n,o,c+1,h,l)||Us(e,d,a,i,s,r,n,o,c+1,h,l);else if(m)if(w)k=Us(e,b,a,i,s,r,n,o,c+1,h,l);else{const t=qs.getPrimitive();t.copy(Hs).applyMatrix4(a);const h=ti(e),d=ai(e,f);Va(h,u,Vs),Va(d,u,Gs);const m=t.intersectsBox(Vs),p=t.intersectsBox(Gs);k=m&&Us(b,h,i,a,s,n,r,c,o+1,t,!l)||p&&Us(b,d,i,a,s,n,r,c,o+1,t,!l),qs.releasePrimitive(t)}else if(y)if(w)k=Us(e,d,a,i,s,r,n,o,c+1,h,l);else{const t=qs.getPrimitive();t.copy(_s).applyMatrix4(a);const h=ti(e),b=ai(e,f);Va(h,u,Vs),Va(b,u,Gs);const m=t.intersectsBox(Vs),p=t.intersectsBox(Gs);k=m&&Us(d,h,i,a,s,n,r,c,o+1,t,!l)||p&&Us(d,b,i,a,s,n,r,c,o+1,t,!l),qs.releasePrimitive(t)}}return k}const Ks=new xi,Js=new t.Box3,Ws={strategy:0,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class Xs{static serialize(e,t={}){t={cloneBuffers:!0,...t};const a=e.geometry,i=e._roots,s=e._indirectBuffer,r=a.getIndex();let n;return n=t.cloneBuffers?{roots:i.map((e=>e.slice())),index:r?r.array.slice():null,indirectBuffer:s?s.slice():null}:{roots:i,index:r?r.array:null,indirectBuffer:s},n}static deserialize(e,a,i={}){i={setIndex:!0,indirect:Boolean(e.indirectBuffer),...i};const{index:s,roots:r,indirectBuffer:n}=e,o=new Xs(a,{...i,[Ca]:!0});if(o._roots=r,o._indirectBuffer=n||null,i.setIndex){const i=a.getIndex();if(null===i){const i=new t.BufferAttribute(e.index,1,!1);a.setIndex(i)}else i.array!==s&&(i.array.set(s),i.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(e,a={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((a=Object.assign({...Ws,[Ca]:!1},a)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,a[Ca]||(di(this,a),!e.boundingBox&&a.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new t.Box3))),this.resolveTriangleIndex=a.indirect?e=>this._indirectBuffer[e]:e=>e}refit(e=null){return(this.indirect?ms:Ui)(this,e)}traverse(e,t=0){const a=this._roots[t],i=new Uint32Array(a),s=new Uint16Array(a);!function t(r,n=0){const o=2*r,c=s[o+15]===Ia;if(c){const t=i[r+6],h=s[o+14];e(n,c,new Float32Array(a,4*r,6),t,h)}else{const s=r+8,o=i[r+6],h=i[r+7];e(n,c,new Float32Array(a,4*r,6),h)||(t(s,n+1),t(o,n+1))}}(0)}raycast(e,a=t.FrontSide,i=0,s=1/0){const r=this._roots,n=this.geometry,o=[],c=a.isMaterial,h=Array.isArray(a),l=n.groups,b=c?a.side:a,d=this.indirect?ps:Wi;for(let t=0,n=r.length;t<n;t++){const r=h?a[l[t].materialIndex].side:b,n=o.length;if(d(this,t,r,e,o,i,s),h){const e=l[t].materialIndex;for(let t=n,a=o.length;t<a;t++)o[t].face.materialIndex=e}}return o}raycastFirst(e,a=t.FrontSide,i=0,s=1/0){const r=this._roots,n=this.geometry,o=a.isMaterial,c=Array.isArray(a);let h=null;const l=n.groups,b=o?a.side:a,d=this.indirect?xs:Yi;for(let t=0,n=r.length;t<n;t++){const r=d(this,t,c?a[l[t].materialIndex].side:b,e,i,s);null!=r&&(null==h||r.distance<h.distance)&&(h=r,c&&(r.face.materialIndex=l[t].materialIndex))}return h}intersectsGeometry(e,t){let a=!1;const i=this._roots,s=this.indirect?Es:rs;for(let r=0,n=i.length;r<n&&(a=s(this,r,e,t),!a);r++);return a}shapecast(e){const t=vi.getPrimitive(),a=this.indirect?Ji:Ni;let{boundsTraverseOrder:i,intersectsBounds:s,intersectsRange:r,intersectsTriangle:n}=e;if(r&&n){const e=r;r=(i,s,r,o,c)=>!!e(i,s,r,o,c)||a(i,s,this,n,r,o,t)}else r||(r=n?(e,i,s,r)=>a(e,i,this,n,s,r,t):(e,t,a)=>a);let o=!1,c=0;const h=this._roots;for(let e=0,t=h.length;e<t;e++){const t=h[e];if(o=Ei(this,e,s,r,i,c),o)break;c+=t.byteLength}return vi.releasePrimitive(t),o}bvhcast(e,a,i){let{intersectsRanges:s,intersectsTriangles:r}=i;const n=vi.getPrimitive(),o=this.geometry.index,c=this.geometry.attributes.position,h=this.indirect?e=>{const t=this.resolveTriangleIndex(e);_i(n,3*t,o,c)}:e=>{_i(n,3*e,o,c)},l=vi.getPrimitive(),b=e.geometry.index,d=e.geometry.attributes.position,u=e.indirect?t=>{const a=e.resolveTriangleIndex(t);_i(l,3*a,b,d)}:e=>{_i(l,3*e,b,d)};if(r){const e=(e,t,i,s,o,c,b,d)=>{for(let f=i,m=i+s;f<m;f++){u(f),l.a.applyMatrix4(a),l.b.applyMatrix4(a),l.c.applyMatrix4(a),l.needsUpdate=!0;for(let a=e,i=e+t;a<i;a++)if(h(a),n.needsUpdate=!0,r(n,l,a,f,o,c,b,d))return!0}return!1};if(s){const t=s;s=function(a,i,s,r,n,o,c,h){return!!t(a,i,s,r,n,o,c,h)||e(a,i,s,r,n,o,c,h)}}else s=e}return function(e,a,i,s){if(Ns)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Ns=!0;const r=e._roots,n=a._roots;let o,c=0,h=0;const l=(new t.Matrix4).copy(i).invert();for(let e=0,t=r.length;e<t;e++){Ls.setBuffer(r[e]),h=0;const t=qs.getPrimitive();Va(0,Ls.float32Array,t),t.applyMatrix4(l);for(let e=0,a=n.length;e<a&&(Os.setBuffer(n[e]),o=Us(0,0,i,l,s,c,h,0,0,t),Os.clearBuffer(),h+=n[e].length,!o);e++);if(qs.releasePrimitive(t),Ls.clearBuffer(),c+=r[e].length,o)break}return Ns=!1,o}(this,e,a,s)}intersectsBox(e,t){return Ks.set(e.min,e.max,t),Ks.needsUpdate=!0,this.shapecast({intersectsBounds:e=>Ks.intersectsBox(e),intersectsTriangle:e=>Ks.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,a={},i={},s=0,r=1/0){return(this.indirect?Ds:fs)(this,e,t,a,i,s,r)}closestPointToPoint(e,t={},a=0,i=1/0){return function(e,t,a={},i=0,s=1/0){const r=i*i,n=s*s;let o=1/0,c=null;if(e.shapecast({boundsTraverseOrder:e=>(zi.copy(t).clamp(e.min,e.max),zi.distanceToSquared(t)),intersectsBounds:(e,t,a)=>a<o&&a<n,intersectsTriangle:(e,a)=>{e.closestPointToPoint(t,zi);const i=t.distanceToSquared(zi);return i<o&&(Ri.copy(zi),o=i,c=a),i<r}}),o===1/0)return null;const h=Math.sqrt(o);return a.point?a.point.copy(Ri):a.point=Ri.clone(),a.distance=h,a.faceIndex=c,a}(this,e,t,a,i)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach((t=>{Va(0,new Float32Array(t),Js),e.union(Js)})),e}}function Qs(e,t,a){return null===e?null:(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(a.ray.origin),e.object=t,e)}const Ys=parseInt(t.REVISION)>=166,Zs=new t.Ray,$s=new t.Vector3,er=new t.Matrix4,tr=t.Mesh.prototype.raycast,ar=t.BatchedMesh.prototype.raycast,ir=new t.Vector3,sr=new t.Mesh,rr=[];function nr(e,a){if(this.boundsTrees){const i=this.boundsTrees,s=this._drawInfo||this._instanceInfo,r=this._drawRanges||this._geometryInfo,n=this.matrixWorld;sr.material=this.material,sr.geometry=this.geometry;const o=sr.geometry.boundsTree,c=sr.geometry.drawRange;null===sr.geometry.boundingSphere&&(sr.geometry.boundingSphere=new t.Sphere);for(let t=0,o=s.length;t<o;t++){if(!this.getVisibleAt(t))continue;const o=s[t].geometryIndex;if(sr.geometry.boundsTree=i[o],this.getMatrixAt(t,sr.matrixWorld).premultiply(n),!sr.geometry.boundsTree){this.getBoundingBoxAt(o,sr.geometry.boundingBox),this.getBoundingSphereAt(o,sr.geometry.boundingSphere);const e=r[o];sr.geometry.setDrawRange(e.start,e.count)}sr.raycast(e,rr);for(let e=0,i=rr.length;e<i;e++){const i=rr[e];i.object=this,i.batchId=t,a.push(i)}rr.length=0}sr.geometry.boundsTree=o,sr.geometry.drawRange=c,sr.material=null,sr.geometry=null}else ar.call(this,e,a)}function or(e,t){if(this.geometry.boundsTree){if(void 0===this.material)return;er.copy(this.matrixWorld).invert(),Zs.copy(e.ray).applyMatrix4(er),ir.setFromMatrixScale(this.matrixWorld),$s.copy(Zs.direction).multiply(ir);const a=$s.length(),i=e.near/a,s=e.far/a,r=this.geometry.boundsTree;if(!0===e.firstHitOnly){const a=Qs(r.raycastFirst(Zs,this.material,i,s),this,e);a&&t.push(a)}else{const a=r.raycast(Zs,this.material,i,s);for(let i=0,s=a.length;i<s;i++){const s=Qs(a[i],this,e);s&&t.push(s)}}}else tr.call(this,e,t)}function cr(e,t,a){a[0]=e[0]>t[0]?t[0]:e[0],a[1]=e[1]<t[1]?t[1]:e[1],a[2]=e[2]>t[2]?t[2]:e[2],a[3]=e[3]<t[3]?t[3]:e[3],a[4]=e[4]>t[4]?t[4]:e[4],a[5]=e[5]<t[5]?t[5]:e[5]}function hr(e,t,a){let i=!1;const s=e[0]>t[0]?t[0]:e[0],r=e[1]<t[1]?t[1]:e[1],n=e[2]>t[2]?t[2]:e[2],o=e[3]<t[3]?t[3]:e[3],c=e[4]>t[4]?t[4]:e[4],h=e[5]<t[5]?t[5]:e[5];return a[0]>s&&(a[0]=s,i=!0),a[1]<r&&(a[1]=r,i=!0),a[2]>n&&(a[2]=n,i=!0),a[3]<o&&(a[3]=o,i=!0),a[4]>c&&(a[4]=c,i=!0),a[5]<h&&(a[5]=h,i=!0),i}function lr(e,t){let a=!1;return t[0]>e[0]&&(t[0]=e[0],a=!0),t[1]<e[1]&&(t[1]=e[1],a=!0),t[2]>e[2]&&(t[2]=e[2],a=!0),t[3]<e[3]&&(t[3]=e[3],a=!0),t[4]>e[4]&&(t[4]=e[4],a=!0),t[5]<e[5]&&(t[5]=e[5],a=!0),a}function br(e,t){e[0]-=t,e[1]+=t,e[2]-=t,e[3]+=t,e[4]-=t,e[5]+=t}function dr(e){const t=e[1]-e[0],a=e[3]-e[2],i=e[5]-e[4];return 2*(t*a+a*i+i*t)}function ur(e,t){const a=e[0]>t[0]?t[0]:e[0],i=e[1]<t[1]?t[1]:e[1],s=e[2]>t[2]?t[2]:e[2],r=e[3]<t[3]?t[3]:e[3],n=e[4]>t[4]?t[4]:e[4],o=i-a,c=r-s,h=(e[5]<t[5]?t[5]:e[5])-n;return 2*(o*c+c*h+h*o)}function fr(e,t){const a=e[0]-t[0],i=t[0]-e[1];let s=a>i?a:i;s<0&&(s=0);const r=e[2]-t[1],n=t[1]-e[3];let o=r>n?r:n;o<0&&(o=0);const c=e[4]-t[2],h=t[2]-e[5];let l=c>h?c:h;return l<0&&(l=0),s*s+o*o+l*l}class mr{constructor(){this.array=[]}clear(){this.array=[]}push(e){const t=this.array,a=e.inheritedCost,i=t.length>6?t.length-6:0;let s;for(s=t.length-1;s>=i&&!(a<=t[s].inheritedCost);s--);s>t.length-7&&t.splice(s+1,0,e)}pop(){return this.array.pop()}}let pr=class{constructor(e=!1){this.root=null,this._sortedList=new mr,this.count=0,this.highPrecision=e,this._typeArray=e?Float64Array:Float32Array}createFromArray(e,t,a,i=0){const s=t.length,r=this._typeArray;r!==(4===t[0].BYTES_PER_ELEMENT?Float32Array:Float64Array)&&console.warn("Different precision.");const n=new r(6);let o,c;this.root=function s(h,l,b){if(1===l){const s=t[h];i>0&&br(s,i);const r={box:s,object:e[h],parent:b};return a&&a(r),r}const d=function(e,a){const s=new r(6),o=e+a;s[0]=1/0,s[1]=-1/0,s[2]=1/0,s[3]=-1/0,s[4]=1/0,s[5]=-1/0,n[0]=1/0,n[1]=-1/0,n[2]=1/0,n[3]=-1/0,n[4]=1/0,n[5]=-1/0;for(let a=e;a<o;a++){const e=t[a],i=e[0],r=e[1],o=e[2],c=e[3],h=e[4],l=e[5];s[0]>i&&(s[0]=i),s[1]<r&&(s[1]=r),s[2]>o&&(s[2]=o),s[3]<c&&(s[3]=c),s[4]>h&&(s[4]=h),s[5]<l&&(s[5]=l);const b=.5*(r+i),d=.5*(c+o),u=.5*(l+h);n[0]>b&&(n[0]=b),n[1]<b&&(n[1]=b),n[2]>d&&(n[2]=d),n[3]<d&&(n[3]=d),n[4]>u&&(n[4]=u),n[5]<u&&(n[5]=u)}return s[0]-=i,s[1]+=i,s[2]-=i,s[3]+=i,s[4]-=i,s[5]+=i,s}(h,l);o=2*function(e){const t=e[1]-e[0],a=e[3]-e[2],i=e[5]-e[4];return t>a?t>i?0:2:a>i?1:2}(n),c=.5*(n[o]+n[o+1]);let u=function(a,i){let s=a,r=a+i-1;for(;s<=r;){const a=t[s];if(.5*(a[o+1]+a[o])>=c)for(;;){const a=t[r];if(.5*(a[o+1]+a[o])<c){const a=e[s];e[s]=e[r],e[r]=a;const i=t[s];t[s]=t[r],t[r]=i,r--;break}if(r--,r<=s)return s}s++}return s}(h,l);(u===h||u===h+l)&&(u=h+(l>>1));const f={box:d,parent:b};return f.left=s(h,u-h,f),f.right=s(u,l-u+h,f),f}(0,s,null)}insert(e,t,a){a>0&&br(t,a);const i=this.createLeafNode(e,t);return null===this.root?this.root=i:this.insertLeaf(i),this.count++,i}insertRange(e,t,a,i){console.warn("Method not optimized yet. It just calls 'insert' N times.");const s=e.length,r=a>0?a:a?null:0;for(let n=0;n<s;n++){const s=this.insert(e[n],t[n],r??a[n]);i&&i(s)}}move(e,t){if(!e.parent||function(e,t){return!(t[0]>e[0]||t[1]<e[1]||t[2]>e[2]||t[3]<e[3]||t[4]>e[4]||t[5]<e[5])}(e.box,e.parent.box))return void(t>0&&br(e.box,t));t>0&&br(e.box,t);const a=this.delete(e);this.insertLeaf(e,a),this.count++}delete(e){const t=e.parent;if(null===t)return this.root=null,null;const a=t.parent,i=t.left===e?t.right:t.left;return i.parent=a,e.parent=null,null===a?(this.root=i,t):(a.left===t?a.left=i:a.right=i,this.refit(a),this.count--,t)}clear(){this.root=null}insertLeaf(e,t){const a=this.findBestSibling(e.box),i=a.parent;void 0===t?t=this.createInternalNode(i,a,e):(t.parent=i,t.left=a,t.right=e),a.parent=t,e.parent=t,null===i?this.root=t:i.left===a?i.left=t:i.right=t,this.refitAndRotate(e,a)}createLeafNode(e,t){return{box:t,object:e,parent:null}}createInternalNode(e,t,a){return{parent:e,left:t,right:a,box:new this._typeArray(6)}}findBestSibling(e){const t=this.root;let a=t,i=ur(e,t.box);const s=dr(e);if(void 0!==t.object)return t;const r=this._sortedList;r.clear();let n={node:t,inheritedCost:i-dr(t.box)};do{const{node:t,inheritedCost:o}=n;if(s+o>=i)break;const c=t.left,h=t.right,l=ur(e,c.box)+o,b=l-dr(c.box),d=ur(e,h.box)+o,u=d-dr(h.box);if(l>d?i>d&&(a=h,i=d):i>l&&(a=c,i=l),u>b){if(s+b>=i||(void 0===c.object&&r.push({node:c,inheritedCost:b}),s+u>=i))continue;void 0===h.object&&r.push({node:h,inheritedCost:u})}else{if(s+u>=i||(void 0===h.object&&r.push({node:h,inheritedCost:u}),s+b>=i))continue;void 0===c.object&&r.push({node:c,inheritedCost:b})}}while(n=r.pop());return a}refit(e){for(cr(e.left.box,e.right.box,e.box);e=e.parent;)if(!hr(e.left.box,e.right.box,e.box))return}refitAndRotate(e,t){const a=e.box,i=(e=e.parent).box;for(cr(a,t.box,i);e=e.parent;){if(!lr(a,e.box))return;const t=e.left,i=e.right,s=t.box,r=i.box;let n=null,o=null,c=0;if(void 0===i.object){const e=i.left,a=i.right,r=dr(i.box),h=r-ur(s,e.box),l=r-ur(s,a.box);h>l?h>0&&(n=t,o=a,c=h):l>0&&(n=t,o=e,c=l)}if(void 0===t.object){const e=t.left,a=t.right,s=dr(t.box),h=s-ur(r,e.box),l=s-ur(r,a.box);h>l?h>c&&(n=i,o=a):l>c&&(n=i,o=e)}null!==n&&this.swap(n,o)}}swap(e,t){const a=e.parent,i=t.parent,s=i.box;a.left===e?a.left=t:a.right=t,i.left===t?i.left=e:i.right=e,e.parent=i,t.parent=a,cr(i.left.box,i.right.box,s)}};class gr{constructor(e,t){this.coordinateSystem=t,this.array=e?new Float64Array(24):new Float32Array(24)}setFromProjectionMatrix(e){if(this.updatePlane(0,e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),this.updatePlane(1,e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),this.updatePlane(2,e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),this.updatePlane(3,e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),this.updatePlane(4,e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14]),0===this.coordinateSystem)this.updatePlane(5,e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]);else{if(1!==this.coordinateSystem)throw new Error("Invalid coordinate system: "+this.coordinateSystem);this.updatePlane(5,e[2],e[6],e[10],e[14])}return this}updatePlane(e,t,a,i,s){const r=this.array,n=4*e,o=Math.sqrt(t*t+a*a+i*i);r[n+0]=t/o,r[n+1]=a/o,r[n+2]=i/o,r[n+3]=s/o}intersectsBoxMask(e,t){const a=this.array;let i,s,r,n,o,c;for(let h=0;h<6;h++){if(!(t&32>>h))continue;const l=4*h,b=a[l+0],d=a[l+1],u=a[l+2],f=a[l+3];if(b>0?(i=e[1],n=e[0]):(i=e[0],n=e[1]),d>0?(s=e[3],o=e[2]):(s=e[2],o=e[3]),u>0?(r=e[5],c=e[4]):(r=e[4],c=e[5]),b*i+d*s+u*r<-f)return-1;b*n+d*o+u*c>-f&&(t^=32>>h)}return t}isIntersected(e,t){const a=this.array;for(let i=0;i<6;i++){if(!(t&32>>i))continue;const s=4*i,r=a[s+0],n=a[s+1],o=a[s+2],c=a[s+3];if(r*(r>0?e[1]:e[0])+n*(n>0?e[3]:e[2])+o*(o>0?e[5]:e[4])<-c)return!1}return!0}isIntersectedMargin(e,t,a){if(0===t)return!0;const i=this.array;for(let s=0;s<6;s++){if(!(t&32>>s))continue;const r=4*s,n=i[r+0],o=i[r+1],c=i[r+2],h=i[r+3];if(n*(n>0?e[1]-a:e[0]+a)+o*(o>0?e[3]-a:e[2]+a)+c*(c>0?e[5]-a:e[4]+a)<-h)return!1}return!0}}function yr(e,t,a,i,s,r){let n=i[0],o=t[0],c=a[0],h=(e[n]-o)*c,l=(e[1^n]-o)*c,b=h>0?h:0,d=l<1/0?l:1/0;return n=i[1],o=t[1],c=a[1],h=(e[n+2]-o)*c,!(h>d||(l=(e[3^n]-o)*c,b>l)||(b=h>b?h:b,d=l<d?l:d,n=i[2],o=t[2],c=a[2],h=(e[n+4]-o)*c,h>d)||(l=(e[5^n]-o)*c,b>l))&&(b=h>b?h:b,d=l<d?l:d,b<=r&&d>=s)}function xr(e,t){return e[1]>=t[0]&&t[1]>=e[0]&&e[3]>=t[2]&&t[3]>=e[2]&&e[5]>=t[4]&&t[5]>=e[4]}let wr=class{constructor(e,t=0){this._sign=new Uint8Array(3),this.builder=e;const a=e.highPrecision;this.frustum=new gr(a,t),this._dirInv=a?new Float64Array(3):new Float32Array(3)}get root(){return this.builder.root}createFromArray(e,t,a,i){(null==e?void 0:e.length)>0&&this.builder.createFromArray(e,t,a,i)}insert(e,t,a){return this.builder.insert(e,t,a)}insertRange(e,t,a,i){(null==e?void 0:e.length)>0&&this.builder.insertRange(e,t,a,i)}move(e,t){this.builder.move(e,t)}delete(e){return this.builder.delete(e)}clear(){this.builder.clear()}traverse(e){null!==this.root&&function t(a,i){void 0===a.object?e(a,i)||(t(a.left,i+1),t(a.right,i+1)):e(a,i)}(this.root,0)}intersectsRay(e,t,a,i=0,s=1/0){if(null===this.root)return!1;const r=this._dirInv,n=this._sign;return r[0]=1/e[0],r[1]=1/e[1],r[2]=1/e[2],n[0]=r[0]<0?1:0,n[1]=r[1]<0?1:0,n[2]=r[2]<0?1:0,function e(o){return!!yr(o.box,t,r,n,i,s)&&(void 0!==o.object?a(o.object):e(o.left)||e(o.right))}(this.root)}intersectsBox(e,t){return null!==this.root&&function a(i){return!!xr(e,i.box)&&(void 0!==i.object?t(i.object):a(i.left)||a(i.right))}(this.root)}intersectsSphere(e,t,a){return null!==this.root&&function i(s){return!!function(e,t,a){return fr(a,e)<=t*t}(e,t,s.box)&&(void 0!==s.object?a(s.object):i(s.left)||i(s.right))}(this.root)}isNodeIntersected(e,t){const a=e.box;let i;for(;i=e.parent;){if(s(i.left===e?i.right:i.left))return!0;e=i}return!1;function s(e){return!!xr(a,e.box)&&(void 0!==e.object?t(e.object):s(e.left)||s(e.right))}}rayIntersections(e,t,a,i=0,s=1/0){if(null===this.root)return;const r=this._dirInv,n=this._sign;r[0]=1/e[0],r[1]=1/e[1],r[2]=1/e[2],n[0]=r[0]<0?1:0,n[1]=r[1]<0?1:0,n[2]=r[2]<0?1:0,function e(o){if(yr(o.box,t,r,n,i,s)){if(void 0!==o.object)return void a(o.object);e(o.left),e(o.right)}}(this.root)}frustumCulling(e,t){if(null===this.root)return;const a=this.frustum.setFromProjectionMatrix(e);function i(e){void 0===e.object?(i(e.left),i(e.right)):t(e,a,0)}!function e(s,r){if(void 0===s.object){if(!((r=a.intersectsBoxMask(s.box,r))<0)){if(0===r)return i(s.left),void i(s.right);e(s.left,r),e(s.right,r)}}else a.isIntersected(s.box,r)&&t(s,a,r)}(this.root,63)}frustumCullingLOD(e,t,a,i){if(null===this.root)return;const s=this.frustum.setFromProjectionMatrix(e);function r(e,t){null===t&&(t=n(e.box)),void 0===e.object?(r(e.left,t),r(e.right,t)):i(e,t,s,0)}function n(e){const{min:i,max:s}=function(e,t){let a,i,s,r,n,o;const c=e[0]-t[0],h=t[0]-e[1];c>h?(a=c,i=h):(a=h,i=c),a<0&&(a=0);const l=e[2]-t[1],b=t[1]-e[3];l>b?(s=l,r=b):(s=b,r=l),s<0&&(s=0);const d=e[4]-t[2],u=t[2]-e[5];return d>u?(n=d,o=u):(n=u,o=d),n<0&&(n=0),{min:a*a+s*s+n*n,max:i*i+r*r+o*o}}(e,t);for(let e=a.length-1;e>0;e--)if(s>=a[e])return i>=a[e]?e:null;return 0}!function e(t,a,o){const c=t.box;if(null===o&&(o=n(c)),void 0===t.object){if(!((a=s.intersectsBoxMask(c,a))<0)){if(0===a)return r(t.left,o),void r(t.right,o);e(t.left,a,o),e(t.right,a,o)}}else s.isIntersected(c,a)&&i(t,o,s,a)}(this.root,63,null)}closestPointToPoint(e,t){if(null===this.root)return;let a=1/0;return function i(s){if(void 0!==s.object){if(t){const i=t(s.object)??fr(s.box,e);i<a&&(a=i)}else a=fr(s.box,e);return}const r=fr(s.left.box,e),n=fr(s.right.box,e);r<n?r<a&&(i(s.left),n<a&&i(s.right)):n<a&&(i(s.right),r<a&&i(s.left))}(this.root),Math.sqrt(a)}};function vr(e,t){return t[0]=e.x,t[1]=e.y,t[2]=e.z,t}function kr(e,t){const a=e.min,i=e.max;return t[0]=a.x,t[1]=i.x,t[2]=a.y,t[3]=i.y,t[4]=a.z,t[5]=i.z,t}class jr{constructor(e,t,a=0,i=!0){this.nodesMap=new Map,this._origin=new Float32Array(3),this._dir=new Float32Array(3),this._cameraPos=new Float32Array(3),this._boxArray=new Float32Array(6),this.target=e,this.accurateCulling=i,this._margin=a,this.bvh=new wr(new pr,2e3===t?0:1)}create(){const e=this.target.instanceCount,t=this.target._instanceInfo.length,a=this.target._instanceInfo,i=new Array(e),s=new Uint32Array(e);let r=0;this.clear();for(let e=0;e<t;e++)a[e].active&&(i[r]=this.getBox(e,new Float32Array(6)),s[r]=e,r++);this.bvh.createFromArray(s,i,(e=>{this.nodesMap.set(e.object,e)}),this._margin)}insert(e){const t=this.bvh.insert(e,this.getBox(e,new Float32Array(6)),this._margin);this.nodesMap.set(e,t)}insertRange(e){const t=e.length,a=new Array(t);for(let i=0;i<t;i++)a[i]=this.getBox(e[i],new Float32Array(6));this.bvh.insertRange(e,a,this._margin,(e=>{this.nodesMap.set(e.object,e)}))}move(e){const t=this.nodesMap.get(e);t&&(this.getBox(e,t.box),this.bvh.move(t,this._margin))}delete(e){const t=this.nodesMap.get(e);t&&(this.bvh.delete(t),this.nodesMap.delete(e))}clear(){this.bvh.clear(),this.nodesMap.clear()}frustumCulling(e,t){this._margin>0&&this.accurateCulling?this.bvh.frustumCulling(e.elements,((e,a,i)=>{a.isIntersectedMargin(e.box,i,this._margin)&&t(e)})):this.bvh.frustumCulling(e.elements,t)}raycast(e,t){const a=e.ray,i=this._origin,s=this._dir;vr(a.origin,i),vr(a.direction,s),this.bvh.rayIntersections(s,i,t,e.near,e.far)}intersectBox(e,t){const a=this._boxArray;return kr(e,a),this.bvh.intersectsBox(a,t)}getBox(e,t){const a=this.target,i=a._instanceInfo[e].geometryIndex;return a.getBoundingBoxAt(i,Mr).applyMatrix4(a.getMatrixAt(e,Ar)),kr(Mr,t),t}}const Mr=new t.Box3,Ar=new t.Matrix4;function Sr(e,t){return Math.max(t,Math.ceil(Math.sqrt(e/t))*t)}class Er extends t.DataTexture{constructor(e,a,i,s,r,n){3===a&&(a=4);const{array:o,format:c,size:h,type:l}=function(e,a,i,s){3===a&&(console.warn('"channels" cannot be 3. Set to 4. More info: https://github.com/mrdoob/three.js/pull/23228'),a=4);const r=Sr(s,i),n=new e(r*r*a),o=e.name.includes("Float"),c=e.name.includes("Uint"),h=o?t.FloatType:c?t.UnsignedIntType:t.IntType;let l;switch(a){case 1:l=o?t.RedFormat:t.RedIntegerFormat;break;case 2:l=o?t.RGFormat:t.RGIntegerFormat;break;case 4:l=o?t.RGBAFormat:t.RGBAIntegerFormat}return{array:n,size:r,type:h,format:l}}(e,a,i,s);super(o,h,h,c,l),this.partialUpdate=!0,this.maxUpdateCalls=1/0,this._utils=null,this._needsUpdate=!1,this._lastWidth=null,this._data=o,this._channels=a,this._pixelsPerInstance=i,this._stride=i*a,this._rowToUpdate=new Array(h),this._uniformMap=r,this._fetchUniformsInFragmentShader=n,this.needsUpdate=!0}resize(e){const t=Sr(e,this._pixelsPerInstance);if(t===this.image.width)return;const a=this._data,i=this._channels;this._rowToUpdate.length=t;const s=a.constructor,r=new s(t*t*i),n=Math.min(a.length,r.length);r.set(new s(a.buffer,0,n)),this.dispose(),this.image={data:r,height:t,width:t},this._data=r}enqueueUpdate(e){if(this._needsUpdate=!0,!this.partialUpdate)return;const t=this.image.width/this._pixelsPerInstance,a=Math.floor(e/t);this._rowToUpdate[a]=!0}update(e){const t=e.properties.get(this),a=this.version>0&&t.__version!==this.version,i=null!==this._lastWidth&&this._lastWidth!==this.image.width;if(!this._needsUpdate||!t.__webglTexture||a||i)return this._lastWidth=this.image.width,void(this._needsUpdate=!1);if(this._needsUpdate=!1,!this.partialUpdate)return void(this.needsUpdate=!0);const s=this.getUpdateRowsInfo();0!==s.length&&(s.length>this.maxUpdateCalls?this.needsUpdate=!0:this.updateRows(t,e,s),this._rowToUpdate.fill(!1))}getUpdateRowsInfo(){const e=this._rowToUpdate,t=[];for(let a=0,i=e.length;a<i;a++)if(e[a]){const s=a;for(;a<i&&e[a];a++);t.push({row:s,count:a-s})}return t}updateRows(e,a,i){const s=a.state,r=a.getContext();this._utils??(this._utils=new t.WebGLUtils(r,a.extensions,a.capabilities));const n=this._utils.convert(this.format),o=this._utils.convert(this.type),{data:c,width:h}=this.image,l=this._channels;s.bindTexture(r.TEXTURE_2D,e.__webglTexture);const b=t.ColorManagement.getPrimaries(t.ColorManagement.workingColorSpace),d=this.colorSpace===t.NoColorSpace?null:t.ColorManagement.getPrimaries(this.colorSpace),u=this.colorSpace===t.NoColorSpace||b===d?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,this.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,this.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,u);for(const{count:e,row:t}of i)r.texSubImage2D(r.TEXTURE_2D,0,0,t,h,e,n,o,c,t*h*l);this.onUpdate&&this.onUpdate(this)}setUniformAt(e,t,a){const{offset:i,size:s}=this._uniformMap.get(t),r=this._stride;1===s?this._data[e*r+i]=a:a.toArray(this._data,e*r+i)}getUniformAt(e,t,a){const{offset:i,size:s}=this._uniformMap.get(t),r=this._stride;return 1===s?this._data[e*r+i]:a.fromArray(this._data,e*r+i)}getUniformsGLSL(e,t,a){return{vertex:this.getUniformsVertexGLSL(e,t,a),fragment:this.getUniformsFragmentGLSL(e,t,a)}}getUniformsVertexGLSL(e,t,a){if(this._fetchUniformsInFragmentShader)return`\n        flat varying ${a} ez_v${t}; \n        void main() {\n          ez_v${t} = ${t};`;const i=this.texelsFetchGLSL(e,t),s=this.getFromTexelsGLSL(),{assignVarying:r,declareVarying:n}=this.getVarying();return`\n      uniform highp sampler2D ${e};  \n      ${n}\n      void main() {\n        ${i}\n        ${s}\n        ${r}`}getUniformsFragmentGLSL(e,t,a){if(!this._fetchUniformsInFragmentShader){const{declareVarying:e,getVarying:t}=this.getVarying();return`\n      ${e}\n      void main() {\n        ${t}`}return`\n      uniform highp sampler2D ${e};  \n      flat varying ${a} ez_v${t};\n      void main() {\n        ${this.texelsFetchGLSL(e,`ez_v${t}`)}\n        ${this.getFromTexelsGLSL()}`}texelsFetchGLSL(e,t){const a=this._pixelsPerInstance;let i=`\n      int size = textureSize(${e}, 0).x;\n      int j = int(${t}) * ${a};\n      int x = j % size;\n      int y = j / size;\n    `;for(let t=0;t<a;t++)i+=`vec4 ez_texel${t} = texelFetch(${e}, ivec2(x + ${t}, y), 0);\n`;return i}getFromTexelsGLSL(){const e=this._uniformMap;let t="";for(const[a,{type:i,offset:s,size:r}]of e){const e=Math.floor(s/this._channels);t+="mat3"===i?`mat3 ${a} = mat3(ez_texel${e}.rgb, vec3(ez_texel${e}.a, ez_texel${e+1}.rg), vec3(ez_texel${e+1}.ba, ez_texel${e+2}.r));\n`:"mat4"===i?`mat4 ${a} = mat4(ez_texel${e}, ez_texel${e+1}, ez_texel${e+2}, ez_texel${e+3});\n`:`${i} ${a} = ez_texel${e}.${this.getUniformComponents(s,r)};\n`}return t}getVarying(){const e=this._uniformMap;let t="",a="",i="";for(const[s,{type:r}]of e)t+=`flat varying ${r} ez_v${s};\n`,a+=`ez_v${s} = ${s};\n`,i+=`${r} ${s} = ez_v${s};\n`;return{declareVarying:t,assignVarying:a,getVarying:i}}getUniformComponents(e,t){const a=e%this._channels;let i="";for(let e=0;e<t;e++)i+=Fr[a+e];return i}copy(e){return super.copy(e),this.partialUpdate=e.partialUpdate,this.maxUpdateCalls=e.maxUpdateCalls,this._channels=e._channels,this._pixelsPerInstance=e._pixelsPerInstance,this._stride=e._stride,this._rowToUpdate=e._rowToUpdate,this._uniformMap=e._uniformMap,this._fetchUniformsInFragmentShader=e._fetchUniformsInFragmentShader,this}}const Fr=["r","g","b","a"];function zr(e,t={}){this.bvh=new jr(this,e,t.margin,t.accurateCulling),this.bvh.create()}function Rr(e,t){return e.z-t.z}function Pr(e,t){return t.z-e.z}const Tr=new t.Frustum,Ir=new class{constructor(){this.array=[],this.pool=[]}push(e,t,a,i){const s=this.pool,r=this.array,n=r.length;n>=s.length&&s.push({start:null,count:null,z:null,zSort:null,index:null});const o=s[n];o.index=e,o.start=a,o.count=i,o.z=t,r.push(o)}reset(){this.array.length=0}},Br=new t.Matrix4,Cr=new t.Matrix4,Dr=new t.Vector3,Lr=new t.Vector3,Or=new t.Vector3,qr=new t.Vector3,Vr=new t.Sphere;function Gr(e,t,a,i,s,r){this.frustumCulling(a)}function Hr(e,t=e){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;this._indirectTexture.needsUpdate=!0,this._visibilityChanged=!1;const a=this.sortObjects,i=this.perObjectFrustumCulled;if(i||a){if(Cr.copy(this.matrixWorld).invert(),Lr.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Cr),Or.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Cr),Dr.set(0,0,-1).transformDirection(e.matrixWorld).transformDirection(Cr),i?(Br.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse).multiply(this.matrixWorld),this.bvh?this.BVHCulling(e,t):this.linearCulling(e,t)):this.updateRenderList(),a){const e=this.geometry.getIndex(),t=null===e?1:e.array.BYTES_PER_ELEMENT,a=this._multiDrawStarts,i=this._multiDrawCounts,s=this._indirectTexture.image.data,r=this.customSort;null===r?Ir.array.sort(this.material.transparent?Pr:Rr):r(Ir.array);const n=Ir.array,o=n.length;for(let e=0;e<o;e++){const r=n[e];a[e]=r.start*t,i[e]=r.count,s[e]=r.index}Ir.reset()}}else this.updateIndexArray()}function _r(){if(!this._visibilityChanged)return;const e=this.geometry.getIndex(),t=null===e?1:e.array.BYTES_PER_ELEMENT,a=this._instanceInfo,i=this._geometryInfo,s=this._multiDrawStarts,r=this._multiDrawCounts,n=this._indirectTexture.image.data;let o=0;for(let e=0,c=a.length;e<c;e++){const c=a[e];if(c.visible&&c.active){const a=i[c.geometryIndex];s[o]=a.start*t,r[o]=a.count,n[o]=e,o++}}this._multiDrawCount=o}function Nr(){const e=this._instanceInfo,t=this._geometryInfo;for(let a=0,i=e.length;a<i;a++){const i=e[a];if(i.visible&&i.active){const e=t[i.geometryIndex],s=this.getPositionAt(a).sub(Lr).dot(Dr);Ir.push(a,s,e.start,e.count)}}this._multiDrawCount=Ir.array.length}function Ur(e,t){const a=this.geometry.getIndex(),i=null===a?1:a.array.BYTES_PER_ELEMENT,s=this._instanceInfo,r=this._geometryInfo,n=this.sortObjects,o=this._multiDrawStarts,c=this._multiDrawCounts,h=this._indirectTexture.image.data,l=this.onFrustumEnter;let b=0;this.bvh.frustumCulling(Br,(a=>{const d=a.object,u=s[d];if(!u.visible)return;const f=u.geometryIndex,m=r[f],p=m.LOD;let g,y;if(p){const a=this.getPositionAt(d).distanceToSquared(Or),i=this.getLODIndex(p,a);if(l&&!l(d,e,t,i))return;g=p[i].start,y=p[i].count}else{if(l&&!l(d,e))return;g=m.start,y=m.count}if(n){const e=this.getPositionAt(d).sub(Lr).dot(Dr);Ir.push(d,e,g,y)}else o[b]=g*i,c[b]=y,h[b]=d,b++})),this._multiDrawCount=n?Ir.array.length:b}function Kr(e,t){const a=this.geometry.getIndex(),i=null===a?1:a.array.BYTES_PER_ELEMENT,s=this._instanceInfo,r=this._geometryInfo,n=this.sortObjects,o=this._multiDrawStarts,c=this._multiDrawCounts,h=this._indirectTexture.image.data,l=this.onFrustumEnter;let b=0;Tr.setFromProjectionMatrix(Br);for(let a=0,d=s.length;a<d;a++){const d=s[a];if(!d.visible||!d.active)continue;const u=r[d.geometryIndex],f=u.LOD;let m,p;const g=u.boundingSphere,y=g.radius,x=g.center;if(0===x.x&&0===x.y&&0===x.z){const e=this.getPositionAndMaxScaleOnAxisAt(a,Vr.center);Vr.radius=y*e}else this.applyMatrixAtToSphere(a,Vr,x,y);if(Tr.intersectsSphere(Vr)){if(f){const i=Vr.center.distanceToSquared(Or),s=this.getLODIndex(f,i);if(l&&!l(a,e,t,s))continue;m=f[s].start,p=f[s].count}else{if(l&&!l(a,e))continue;m=u.start,p=u.count}if(n){const e=qr.subVectors(Vr.center,Lr).dot(Dr);Ir.push(a,e,m,p)}else o[b]=m*i,c[b]=p,h[b]=a,b++}}this._multiDrawCount=n?Ir.array.length:b}const Jr=new t.Vector3;function Wr(e,t=Jr){const a=16*e,i=this._matricesTexture.image.data;return t.x=i[a+12],t.y=i[a+13],t.z=i[a+14],t}function Xr(e,t){const a=16*e,i=this._matricesTexture.image.data,s=i[a+0],r=i[a+1],n=i[a+2],o=s*s+r*r+n*n,c=i[a+4],h=i[a+5],l=i[a+6],b=c*c+h*h+l*l,d=i[a+8],u=i[a+9],f=i[a+10],m=d*d+u*u+f*f;return t.x=i[a+12],t.y=i[a+13],t.z=i[a+14],Math.sqrt(Math.max(o,b,m))}function Qr(e,t,a,i){const s=16*e,r=this._matricesTexture.image.data,n=r[s+0],o=r[s+1],c=r[s+2],h=r[s+3],l=r[s+4],b=r[s+5],d=r[s+6],u=r[s+7],f=r[s+8],m=r[s+9],p=r[s+10],g=r[s+11],y=r[s+12],x=r[s+13],w=r[s+14],v=r[s+15],k=t.center,j=a.x,M=a.y,A=a.z,S=1/(h*j+u*M+g*A+v);k.x=(n*j+l*M+f*A+y)*S,k.y=(o*j+b*M+m*A+x)*S,k.z=(c*j+d*M+p*A+w)*S;const E=n*n+o*o+c*c,F=l*l+b*b+d*d,z=f*f+m*m+p*p;t.radius=i*Math.sqrt(Math.max(E,F,z))}function Yr(e,t,a,i=0){const s=this._geometryInfo[e];a=a**2,s.LOD??(s.LOD=[{start:s.start,count:s.count,distance:0,hysteresis:0}]);const r=s.LOD,n=r[r.length-1],o=n.start+n.count,c=t.index.count;if(o-s.start+c>s.reservedIndexCount)throw new Error("BatchedMesh LOD: Reserved space request exceeds the maximum buffer size.");r.push({start:o,count:c,distance:a,hysteresis:i});const h=t.getIndex().array,l=this.geometry.getIndex(),b=l.array,d=s.vertexStart;for(let e=0;e<c;e++)b[o+e]=h[e]+d;l.needsUpdate=!0}function Zr(e,t){for(let a=e.length-1;a>0;a--){const i=e[a];if(t>=i.distance-i.distance*i.hysteresis)return a}return 0}const $r=[],en=new t.Mesh,tn=new t.Ray,an=new t.Vector3,sn=new t.Vector3,rn=new t.Matrix4;function nn(e,a){var i,s;if(!this.material||0===this.instanceCount)return;en.geometry=this.geometry,en.material=this.material,(i=en.geometry).boundingBox??(i.boundingBox=new t.Box3),(s=en.geometry).boundingSphere??(s.boundingSphere=new t.Sphere);const r=e.ray,n=e.near,o=e.far;rn.copy(this.matrixWorld).invert(),sn.setFromMatrixScale(this.matrixWorld),an.copy(e.ray.direction).multiply(sn);const c=an.length();if(e.ray=tn.copy(e.ray).applyMatrix4(rn),e.near/=c,e.far/=c,this.bvh)this.bvh.raycast(e,(t=>this.checkInstanceIntersection(e,t,a)));else if(null===this.boundingSphere&&this.computeBoundingSphere(),e.ray.intersectsSphere(this.boundingSphere))for(let t=0,i=this._instanceInfo.length;t<i;t++)this.checkInstanceIntersection(e,t,a);e.ray=r,e.near=n,e.far=o}function on(e,t,a){const i=this._instanceInfo[t];if(!i.active||!i.visible)return;const s=i.geometryIndex,r=this._geometryInfo[s];this.getMatrixAt(t,en.matrixWorld),en.geometry.boundsTree=this.boundsTrees?this.boundsTrees[s]:void 0,en.geometry.boundsTree||(this.getBoundingBoxAt(s,en.geometry.boundingBox),this.getBoundingSphereAt(s,en.geometry.boundingSphere),en.geometry.setDrawRange(r.start,r.count)),en.raycast(e,$r);for(const e of $r)e.batchId=t,e.object=this,a.push(e);$r.length=0}function cn(e,t,a){if(!this.uniformsTexture)throw new Error('Before get/set uniform, it\'s necessary to use "initUniformsPerInstance".');return this.uniformsTexture.getUniformAt(e,t,a)}function hn(e,t,a){if(!this.uniformsTexture)throw new Error('Before get/set uniform, it\'s necessary to use "initUniformsPerInstance".');this.uniformsTexture.setUniformAt(e,t,a),this.uniformsTexture.enqueueUpdate(e)}function ln(e){if(this.uniformsTexture)throw new Error('"initUniformsPerInstance" must be called only once.');const{channels:t,pixelsPerInstance:a,uniformMap:i,fetchInFragmentShader:s}=function(e){let t=0;const a=new Map,i=[],s=e.vertex??{},r=e.fragment??{};let n=!0;for(const e in s){const a=s[e],r=dn(a);t+=r,i.push({name:e,type:a,size:r}),n=!1}for(const e in r)if(!s[e]){const a=r[e],s=dn(a);t+=s,i.push({name:e,type:a,size:s})}i.sort(((e,t)=>t.size-e.size));const o=[];for(const{name:e,size:t,type:s}of i){const i=bn(t,o);a.set(e,{offset:i,size:t,type:s})}const c=Math.ceil(t/4);return{channels:Math.min(t,4),pixelsPerInstance:c,uniformMap:a,fetchInFragmentShader:n}}(e);this.uniformsTexture=new Er(Float32Array,t,a,this.maxInstanceCount,i,s),function(e){const t=e.material,a=t.onBeforeCompile.bind(t);t.onBeforeCompile=(t,i)=>{if(e.uniformsTexture){t.uniforms.uniformsTexture={value:e.uniformsTexture};const{vertex:a,fragment:i}=e.uniformsTexture.getUniformsGLSL("uniformsTexture","batchIndex","float");t.vertexShader=t.vertexShader.replace("void main() {",a),t.fragmentShader=t.fragmentShader.replace("void main() {",i),t.vertexShader=t.vertexShader.replace("void main() {","void main() { float batchIndex = getIndirectIndex( gl_DrawID );")}a(t,i)}}(this)}function bn(e,t){if(e<4)for(let a=0;a<t.length;a++)if(t[a]+e<=4){const i=4*a+t[a];return t[a]+=e,i}const a=4*t.length;for(;e>0;e-=4)t.push(e);return a}function dn(e){switch(e){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;case"mat3":return 9;case"mat4":return 16;default:throw new Error(`Invalid uniform type: ${e}`)}}!function(){var e,t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};WebAssembly.instantiate(function(){for(var e=new Uint8Array(15574),a=0;a<15574;++a){var i="b9H79Tebbbe9nk9Geueu9Geub9Gbb9Gouuuuuueu9Gvuuuuueu9Gduueu9Gluuuueu9Gvuuuuub9Gouuuuuub9Gluuuub9GiuuueuiYKdilveoveovrrwrrDDoDbqqbelve9Weiiviebeoweuec;G:Qdkr:nlAo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8F9TW79O9V9Wt9FW9U9J9V9KW9wWVtW949c919M9MWV9mW4W2be8A9TW79O9V9Wt9FW9U9J9V9KW9wWVtW949c919M9MWVbd8F9TW79O9V9Wt9FW9U9J9V9KW9wWVtW949c919M9MWV9c9V919U9KbiE9TW79O9V9Wt9FW9U9J9V9KW9wWVtW949wWV79P9V9UblY9TW79O9V9Wt9FW9U9J9V9KW69U9KW949c919M9MWVbv8E9TW79O9V9Wt9FW9U9J9V9KW69U9KW949c919M9MWV9c9V919U9Kbo8A9TW79O9V9Wt9FW9U9J9V9KW69U9KW949wWV79P9V9UbrE9TW79O9V9Wt9FW9U9J9V9KW69U9KW949tWG91W9U9JWbwa9TW79O9V9Wt9FW9U9J9V9KW69U9KW949tWG91W9U9JW9c9V919U9KbDL9TW79O9V9Wt9FW9U9J9V9KWS9P2tWV9p9JtbqK9TW79O9V9Wt9FW9U9J9V9KWS9P2tWV9r919HtbkL9TW79O9V9Wt9FW9U9J9V9KWS9P2tWVT949WbxE9TW79O9V9Wt9F9V9Wt9P9T9P96W9wWVtW94J9H9J9OWbsa9TW79O9V9Wt9F9V9Wt9P9T9P96W9wWVtW94J9H9J9OW9ttV9P9Wbza9TW79O9V9Wt9F9V9Wt9P9T9P96W9wWVtW94SWt9J9O9sW9T9H9WbHK9TW79O9V9Wt9F79W9Ht9P9H29t9VVt9sW9T9H9WbOl79IV9RbADwebcekdLQq:X9MKdbk:xhdgud9:8Jjjjjbc;qw9Rgo8Kjjjjbdndnaembcbhrxekabcbyd;C:kjjbgwc:GeV86bbaoc;adfcbcjdz:vjjjb8AdnaiTmbaoc;adfadalzNjjjb8Akaoc;abfalfcbcbcjdal9RalcFe0Ez:vjjjb8Aaoc;abfaoc;adfalzNjjjb8AaocUf9cb83ibaoc8Wf9cb83ibaocyf9cb83ibaocaf9cb83ibaocKf9cb83ibaoczf9cb83ibao9cb83iwao9cb83ibcj;abal9Uc;WFbGcjdalca0EhDdnaicd6mbavcd9imbawTmbadcefhqaDci2gkal2hxaoc;alfclfhmaoc;qlfceVhPaoc;qofclVhsaoc;qofcKfhzaoc;qofczfhHcbhOincdhAcbhrdnavci6mbaz9cb83ibaH9cb83ibao9cb83i;yoao9cb83i;qoadaOfgrybbhCcbhXincbhQcbhLdninaralfhKarybbgYaC7aLVhLaQcP0meaKhraYhCaQcefgQaXfai6mbkkcbhCaoc;qofhQincwh8AcwhEdnaLaC93grcFeGg3cs0mbclhEa3ci0mba3cb9hcethEkdnarcw4cFeGg3cs0mbclh8Aa3ci0mba3cb9hceth8Aka8AaEfh3aQydbh5cwh8AcwhEdnarcz4cFeGg8Ecs0mbclhEa8Eci0mba8Ecb9hcethEka3a5fh3dnarcFFFFb0mbclh8AarcFFF8F0mbarcFFFr0ceth8AkaQa3aEfa8AfBdbaQclfhQaCcefgCcw9hmbkaKhraYhCaXczfgXai6mbkcbhrcehQashLinaQaraLydbaoc;qofarcdtfydb6EhraLclfhLaQcefgQcw9hmbkcihAkcbh3aoc;qlfcbcjdz:vjjjb8Aaoc;alfcwfcbBdbao9cb83i;alarclth8FadhaaDhhaqh5inaoc;qlfadcba3cufgrara30Eal2falzNjjjb8Aaiahaiah6EhgdnaDaia39Ra3aDfai6EgYcsfc9WGgraY9nmbaoc;qofaYfcbaraY9Rz:vjjjb8Akada3al2fh8Jcbh8Kina8Ka8FVcl4hXaoc;alfa8Kcdtfh8LaOh8Mcbh8Nina8NaOfhQdndndndndndna8KPldebidkaPa8Mc98GgLfhra5aLfh8Aaoc;qlfaQc98GgLfRbbhCcwhQinarRbbaQtaCVhCarcefhraQcwfgQca9hmbkaYTmla8Ncith8Ea8JaLfhEcbhKinaERbbhLcwhra8AhQinaQRbbartaLVhLaQcefhQarcwfgrca9hmbkaoc;qofaKfaLaC7aX93a8E486bba8Aalfh8AaEalfhEaLhCaKcefgKaY9hmbxlkkaYTmia8Mc9:Ghra8NcitcwGhEaoc;qlfaQceVfRbbcwtaoc;qlfaQc9:GfRbbVhLaoc;qofhQaghCinaQa5arfRbbcwtaaarfRbbVg8AaL9RgLcetaLcztcz91cs47cFFiGaE486bbaralfhraQcefhQa8AhLa3aCcufgC9hmbxikkaYTmda8JaQfhraoc;qlfaQfRbbhLaoc;qofhQaghCinaQarRbbg8AaL9RgLcetaLcKtcK91cr4786bbaQcefhQaralfhra8AhLa3aCcufgC9hmbxdkkaYTmeka8LydbhEcbhKaoc;qofhrincdhLcbhQinaLaraQfRbbcb9hfhLaQcefgQcz9hmbkclhCcbhQinaCaraQfRbbcd0fhCaQcefgQcz9hmbkcwh8AcbhQina8AaraQfRbbcP0fh8AaQcefgQcz9hmbkaLaCaLaC6EgQa8AaQa8A6EgQczaQcz6EaEfhEarczfhraKczfgKaY6mbka8LaEBdbka8Mcefh8Ma8Ncefg8Ncl9hmbka8Kcefg8KaA9hmbkaaaxfhaahakfhha5axfh5a3akfg3ai6mbkcbhrcehQamhLinaQaraLydbaoc;alfarcdtfydb6EhraLclfhLaQcefgChQaAaC9hmbkaoaOcd4fa8FcdVararcdSE86bbaOclfgOal6mbkkabaefh8Kabcefhralcd4gecbawEhqadcefhHaoc;abfceVhzcbhxdndninaiax9nmeaoc;qofcbcjdz:vjjjb8Aa8Kar9Raq6mdadaxal2gQfhkcbh8JaHaQfhsarcbaqz:vjjjbghaqfh5aDaiax9RaxaDfai6EgPcsfgrcl4cifcd4hAarc9WGg8LThmindndndndndndndndndndnawTmbaoa8Jcd4fRbbgLciGPlbedlbkaPTmdaka8Jfhraoc;abfa8JfRbbhLaoc;qofhQaPhCinaQarRbbg8AaL9RgLcetaLcKtcK91cr4786bbaQcefhQaralfhra8AhLaCcufgCmbxikkaPTmia8JcitcwGhEaoc;abfa8JceVfRbbcwtaoc;abfa8Jc9:GgrfRbbVhLakarfhraoc;qofhQaPhCinaQar8Vbbg8AaL9RgLcetaLcztcz91cs47cFFiGaE486bbaQcefhQaralfhra8AhLaCcufgCmbxdkkaza8Jc98GgEfhrasaEfh8Aaoc;abfaEfRbbhCcwhQinarRbbaQtaCVhCarcefhraQcwfgQca9hmbkaPTmbaLcl4hYa8JcitcKGh3akaEfhEcbhKinaERbbhLcwhra8AhQinaQRbbartaLVhLaQcefhQarcwfgrca9hmbkaoc;qofaKfaLaC7aY93a3486bba8Aalfh8AaEalfhEaLhCaKcefgKaP9hmbkkawmbcbhrxlka8LTmbcbhrdninaoc;qofarfgQcwf8PibaQ8Pib:e9qTmearczfgra8L9pmdxbkkdnavmbcehrxikcbhEaAhKaAhYinaoc;qofaEfgrcwf8Pibhyar8Pibh8PcdhLcbhQinaLaraQfRbbcb9hfhLaQcefgQcz9hmbkclhCcbhQinaCaraQfRbbcd0fhCaQcefgQcz9hmbkcwh8AcbhQina8AaraQfRbbcP0fh8AaQcefgQcz9hmbkaLaCaLaC6Egra8Aara8A6Egrczarcz6EaYfhYarcucbaya8P:e9cb9sEgQaraQ6EaKfhKaEczfgEa8L9pmdxbkkaha8Jcd4fgrarRbbcda8JcetcoGtV86bbxikdnaKaP6mbaYaP6mbaha8Jcd4fgrarRbbcia8JcetcoGtV86bba8Ka59RaP6mra5aoc;qofaPzNjjjbaPfh5xikaKaY9phrkaha8Jcd4fgQaQRbbara8JcetcoGtV86bbka8Ka59RaA6mla5cbaAz:vjjjbgOaAfhYdndna8Lmbamhrxekdna8KaY9RcK9pmbamhrxekarcdtc:q1jjbfcj1jjbawEg5ydxggcetc;:FFFeGh8Fcuh3cuagtcu7cFeGhacbh8Maoc;qofhLinaoc;qofa8MfhXczhEdndndnagPDbeeeeeeedekcucbaXcwf8PibaX8Pib:e9cb9sEhExekcbhra8FhEinaEaaaLarfRbb9nfhEarcefgrcz9hmbkkcih8Ecbh8AinczhQdndndna5a8AcdtfydbgKPDbeeeeeeedekcucbaXcwf8PibaX8Pib:e9cb9sEhQxekaKcetc;:FFFeGhQcuaKtcu7cFeGhCcbhrinaQaCaLarfRbb9nfhQarcefgrcz9hmbkkdndnaQaE6mbaKa39hmeaQaE9hmea5a8EcdtfydbcwSmeka8Ah8EaQhEka8Acefg8Aci9hmbkaOa8Mco4fgrarRbba8Ea8Mci4coGtV86bbdndndna5a8Ecdtfydbg3PDdbbbbbbbebkdncwa39Tg8ETmbcua3tcu7hQdndna3ceSmbcbh8NaLhXinaXhra8Eh8AcbhCinarRbbgEaQcFeGgKaEaK6EaCa3tVhCarcefhra8Acufg8AmbkaYaC86bbaXa8EfhXaYcefhYa8Na8Efg8Ncz6mbxdkkcbh8NaLhXinaXhra8Eh8AcbhCinarRbbgEaQcFeGgKaEaK6EaCcetVhCarcefhra8Acufg8AmbkaYaC:T9cFe:d9c:c:qj:bw9:9c:q;c1:I1e:d9c:b:c:e1z9:9ca188bbaXa8EfhXaYcefhYa8Na8Efg8Ncz6mbkkcbhrinaYaLarfRbbgC86bbaYaCaQcFeG9pfhYarcefgrcz9hmbxikkdna3ceSmbinaYcb86bbaYcefhYxbkkinaYcb86bbaYcefhYxbkkaYaX8Pbb83bbaYcwfaXcwf8Pbb83bbaYczfhYka8Mczfg8Ma8L9pgrmeaLczfhLa8KaY9RcK9pmbkkarTmlaYh5aYTmlka8Jcefg8Jal9hmbkaoc;abfakaPcufal2falzNjjjb8AaPaxfhxa5hra5mbkcbhrxdkdna8Kar9RaqalfgQcKcaawEgLaQaL0EgC9pmbcbhrxdkdnaQaL9pmbarcbaCaQ9RgQz:vjjjbaQfhrkaraoc;adfalzNjjjbalfhrdnawTmbaraoaezNjjjbaefhrkarab9Rhrxekcbhrkaoc;qwf8KjjjjbarkCbabaeadaialcdz:bjjjbk9reduaecd4gdaefgicaaica0Eabcj;abae9Uc;WFbGcjdaeca0Egifcufai9Uae2aiadfaicl4cifcd4f2fcefkmbcbabBd;C:kjjbk:Ese5u8Jjjjjbc;ae9Rgl8Kjjjjbcbhvdnaici9UgocHfae0mbabcbyd;m:kjjbgrc;GeV86bbalc;abfcFecjez:vjjjb8AalcUfgw9cu83ibalc8WfgD9cu83ibalcyfgq9cu83ibalcafgk9cu83ibalcKfgx9cu83ibalczfgm9cu83ibal9cu83iwal9cu83ibabaefc9WfhPabcefgsaofhednaiTmbcmcsarcb9kgzEhHcbhOcbhAcbhCcbhXcbhQindnaeaP9nmbcbhvxikaQcufhvadaCcdtfgLydbhKaLcwfydbhYaLclfydbh8AcbhEdndndninalc;abfavcsGcitfgoydlh3dndndnaoydbgoaK9hmba3a8ASmekdnaoa8A9hmba3aY9hmbaEcefhExekaoaY9hmea3aK9hmeaEcdfhEkaEc870mdaXcufhvaLaEciGcx2goc;i1jjbfydbcdtfydbh3aLaoc;e1jjbfydbcdtfydbh8AaLaoc;a1jjbfydbcdtfydbhKcbhodnindnalavcsGcdtfydba39hmbaohYxdkcuhYavcufhvaocefgocz9hmbkkaOa3aOSgvaYce9iaYaH9oVgoGfhOdndndncbcsavEaYaoEgvcs9hmbarce9imba3a3aAa3cefaASgvEgAcefSmecmcsavEhvkasavaEcdtc;WeGV86bbavcs9hmea3aA9Rgvcetavc8F917hvinaeavcFb0crtavcFbGV86bbaecefheavcje6hoavcr4hvaoTmbka3hAxvkcPhvasaEcdtcPV86bba3hAkavTmiavaH9omicdhocehEaQhYxlkavcufhvaEclfgEc;ab9hmbkkdnaLceaYaOSceta8AaOSEcx2gvc;a1jjbfydbcdtfydbgKTaLavc;e1jjbfydbcdtfydbg8AceSGaLavc;i1jjbfydbcdtfydbg3cdSGaOcb9hGazGg5ce9hmbaw9cu83ibaD9cu83ibaq9cu83ibak9cu83ibax9cu83ibam9cu83ibal9cu83iwal9cu83ibcbhOkcbhEaXcufgvhodnindnalaocsGcdtfydba8A9hmbaEhYxdkcuhYaocufhoaEcefgEcz9hmbkkcbhodnindnalavcsGcdtfydba39hmbaohExdkcuhEavcufhvaocefgocz9hmbkkaOaKaOSg8EfhLdndnaYcm0mbaYcefhYxekcbcsa8AaLSgvEhYaLavfhLkdndnaEcm0mbaEcefhExekcbcsa3aLSgvEhEaLavfhLkc9:cua8EEh8FcbhvaEaYcltVgacFeGhodndndninavc:W1jjbfRbbaoSmeavcefgvcz9hmbxdkka5aKaO9havcm0VVmbasavc;WeV86bbxekasa8F86bbaeaa86bbaecefhekdna8EmbaKaA9Rgvcetavc8F917hvinaeavcFb0gocrtavcFbGV86bbavcr4hvaecefheaombkaKhAkdnaYcs9hmba8AaA9Rgvcetavc8F917hvinaeavcFb0gocrtavcFbGV86bbavcr4hvaecefheaombka8AhAkdnaEcs9hmba3aA9Rgvcetavc8F917hvinaeavcFb0gocrtavcFbGV86bbavcr4hvaecefheaombka3hAkalaXcdtfaKBdbaXcefcsGhvdndnaYPzbeeeeeeeeeeeeeebekalavcdtfa8ABdbaXcdfcsGhvkdndnaEPzbeeeeeeeeeeeeeebekalavcdtfa3BdbavcefcsGhvkcihoalc;abfaQcitfgEaKBdlaEa8ABdbaQcefcsGhYcdhEavhXaLhOxekcdhoalaXcdtfa3BdbcehEaXcefcsGhXaQhYkalc;abfaYcitfgva8ABdlava3Bdbalc;abfaQaEfcsGcitfgva3BdlavaKBdbascefhsaQaofcsGhQaCcifgCai6mbkkdnaeaP9nmbcbhvxekcbhvinaeavfavc:W1jjbfRbb86bbavcefgvcz9hmbkaeab9Ravfhvkalc;aef8KjjjjbavkZeeucbhddninadcefgdc8F0meceadtae6mbkkadcrfcFeGcr9Uci2cdfabci9U2cHfkmbcbabBd;m:kjjbk:Adewu8Jjjjjbcz9Rhlcbhvdnaicvfae0mbcbhvabcbRb;m:kjjbc;qeV86bbal9cb83iwabcefhoabaefc98fhrdnaiTmbcbhwcbhDindnaoar6mbcbskadaDcdtfydbgqalcwfawaqav9Rgvavc8F91gv7av9Rc507gwcdtfgkydb9Rgvc8E91c9:Gavcdt7awVhvinaoavcFb0gecrtavcFbGV86bbavcr4hvaocefhoaembkakaqBdbaqhvaDcefgDai9hmbkkdnaoar9nmbcbskaocbBbbaoab9RclfhvkavkBeeucbhddninadcefgdc8F0meceadtae6mbkkadcwfcFeGcr9Uab2cvfk:bvli99dui99ludnaeTmbcuadcetcuftcu7:Zhvdndncuaicuftcu7:ZgoJbbbZMgr:lJbbb9p9DTmbar:Ohwxekcjjjj94hwkcbhicbhDinalclfIdbgrJbbbbJbbjZalIdbgq:lar:lMalcwfIdbgk:lMgr:varJbbbb9BEgrNhxaqarNhrdndnakJbbbb9GTmbaxhqxekJbbjZar:l:tgqaq:maxJbbbb9GEhqJbbjZax:l:tgxax:marJbbbb9GEhrkdndnalcxfIdbgxJbbj:;axJbbj:;9GEgkJbbjZakJbbjZ9FEavNJbbbZJbbb:;axJbbbb9GEMgx:lJbbb9p9DTmbax:Ohmxekcjjjj94hmkdndnaqJbbj:;aqJbbj:;9GEgxJbbjZaxJbbjZ9FEaoNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:OhPxekcjjjj94hPkdndnarJbbj:;arJbbj:;9GEgqJbbjZaqJbbjZ9FEaoNJbbbZJbbb:;arJbbbb9GEMgr:lJbbb9p9DTmbar:Ohsxekcjjjj94hskdndnadcl9hmbabaifgzas86bbazcifam86bbazcdfaw86bbazcefaP86bbxekabaDfgzas87ebazcofam87ebazclfaw87ebazcdfaP87ebkalczfhlaiclfhiaDcwfhDaecufgembkkk;hlld99eud99eudnaeTmbdndncuaicuftcu7:ZgvJbbbZMgo:lJbbb9p9DTmbao:Ohixekcjjjj94hikaic;8FiGhrinabcofcicdalclfIdb:lalIdb:l9EgialcwfIdb:lalaicdtfIdb:l9EEgialcxfIdb:lalaicdtfIdb:l9EEgiarV87ebdndnJbbj:;JbbjZalaicdtfIdbJbbbb9DEgoalaicd7cdtfIdbJ;Zl:1ZNNgwJbbj:;awJbbj:;9GEgDJbbjZaDJbbjZ9FEavNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohqxekcjjjj94hqkabcdfaq87ebdndnalaicefciGcdtfIdbJ;Zl:1ZNaoNgwJbbj:;awJbbj:;9GEgDJbbjZaDJbbjZ9FEavNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohqxekcjjjj94hqkabaq87ebdndnaoalaicufciGcdtfIdbJ;Zl:1ZNNgoJbbj:;aoJbbj:;9GEgwJbbjZawJbbjZ9FEavNJbbbZJbbb:;aoJbbbb9GEMgo:lJbbb9p9DTmbao:Ohixekcjjjj94hikabclfai87ebabcwfhbalczfhlaecufgembkkk;3viDue99eu8Jjjjjbcjd9Rgo8Kjjjjbadcd4hrdndndndnavcd9hmbadcl6meaohwarhDinawc:CuBdbawclfhwaDcufgDmbkaeTmiadcl6mdarcdthqalhkcbhxinaohwakhDarhminawawydbgPcbaDIdbgs:8cL4cFeGc:cufasJbbbb9BEgzaPaz9kEBdbaDclfhDawclfhwamcufgmmbkakaqfhkaxcefgxaeSmixbkkaeTmdxekaeTmekarcdthkavce9hhqadcl6hdcbhxindndndnaqmbadmdc:CuhDalhwarhminaDcbawIdbgs:8cL4cFeGc:cufasJbbbb9BEgPaDaP9kEhDawclfhwamcufgmmbxdkkc:CuhDdndnavPleddbdkadmdaohwalhmarhPinawcbamIdbgs:8cL4cFeGgzc;:bazc;:b0Ec:cufasJbbbb9BEBdbamclfhmawclfhwaPcufgPmbxdkkadmecbhwarhminaoawfcbalawfIdbgs:8cL4cFeGgPc8AaPc8A0Ec:cufasJbbbb9BEBdbawclfhwamcufgmmbkkadmbcbhwarhPinaDhmdnavceSmbaoawfydbhmkdndnalawfIdbgscjjj;8iamai9RcefgmcLt9R::NJbbbZJbbb:;asJbbbb9GEMgs:lJbbb9p9DTmbas:Ohzxekcjjjj94hzkabawfazcFFFrGamcKtVBdbawclfhwaPcufgPmbkkabakfhbalakfhlaxcefgxae9hmbkkaocjdf8Kjjjjbk;YqdXui998Jjjjjbc:qd9Rgv8Kjjjjbavc:Sefcbc;Kbz:vjjjb8AcbhodnadTmbcbhoaiTmbdndnabaeSmbaehrxekavcuadcdtgwadcFFFFi0Ecbyd;u:kjjbHjjjjbbgrBd:SeavceBd:mdaraeawzNjjjb8Akavc:GefcwfcbBdbav9cb83i:Geavc:Gefaradaiavc:Sefz:ojjjbavyd:GehDadci9Ugqcbyd;u:kjjbHjjjjbbheavc:Sefavyd:mdgkcdtfaeBdbavakcefgwBd:mdaecbaqz:vjjjbhxavc:SefawcdtfcuaicdtaicFFFFi0Ecbyd;u:kjjbHjjjjbbgmBdbavakcdfgPBd:mdalc;ebfhsaDheamhwinawalIdbasaeydbgzcwazcw6EcdtfIdbMUdbaeclfheawclfhwaicufgimbkavc:SefaPcdtfcuaqcdtadcFFFF970Ecbyd;u:kjjbHjjjjbbgPBdbdnadci6mbarheaPhwaqhiinawamaeydbcdtfIdbamaeclfydbcdtfIdbMamaecwfydbcdtfIdbMUdbaecxfheawclfhwaicufgimbkkakcifhoalc;ebfhHavc;qbfhOavheavyd:KehAavyd:OehCcbhzcbhwcbhXcehQinaehLcihkarawci2gKcdtfgeydbhsaeclfydbhdabaXcx2fgicwfaecwfydbgYBdbaiclfadBdbaiasBdbaxawfce86bbaOaYBdwaOadBdlaOasBdbaPawcdtfcbBdbdnazTmbcihkaLhiinaOakcdtfaiydbgeBdbakaeaY9haeas9haead9hGGfhkaiclfhiazcufgzmbkkaXcefhXcbhzinaCaAarazaKfcdtfydbcdtgifydbcdtfgYheaDaifgdydbgshidnasTmbdninaeydbawSmeaeclfheaicufgiTmdxbkkaeaYascdtfc98fydbBdbadadydbcufBdbkazcefgzci9hmbkdndnakTmbcuhwJbbbbh8Acbhdavyd:KehYavyd:OehKindndnaDaOadcdtfydbcdtgzfydbgembadcefhdxekadcs0hiamazfgsIdbhEasalcbadcefgdaiEcdtfIdbaHaecwaecw6EcdtfIdbMg3Udba3aE:th3aecdthiaKaYazfydbcdtfheinaPaeydbgzcdtfgsa3asIdbMgEUdbaEa8Aa8AaE9DgsEh8AazawasEhwaeclfheaic98fgimbkkadak9hmbkawcu9hmekaQaq9pmdindnaxaQfRbbmbaQhwxdkaqaQcefgQ9hmbxikkakczakcz6EhzaOheaLhOawcu9hmbkkaocdtavc:Seffc98fhedninaoTmeaeydbcbyd;q:kjjbH:bjjjbbaec98fheaocufhoxbkkavc:qdf8Kjjjjbk;IlevucuaicdtgvaicFFFFi0Egocbyd;u:kjjbHjjjjbbhralalyd9GgwcdtfarBdbalawcefBd9GabarBdbaocbyd;u:kjjbHjjjjbbhralalyd9GgocdtfarBdbalaocefBd9GabarBdlcuadcdtadcFFFFi0Ecbyd;u:kjjbHjjjjbbhralalyd9GgocdtfarBdbalaocefBd9GabarBdwabydbcbavz:vjjjb8Aadci9UhDdnadTmbabydbhoaehladhrinaoalydbcdtfgvavydbcefBdbalclfhlarcufgrmbkkdnaiTmbabydbhlabydlhrcbhvaihoinaravBdbarclfhralydbavfhvalclfhlaocufgombkkdnadci6mbabydlhrabydwhvcbhlinaecwfydbhoaeclfydbhdaraeydbcdtfgwawydbgwcefBdbavawcdtfalBdbaradcdtfgdadydbgdcefBdbavadcdtfalBdbaraocdtfgoaoydbgocefBdbavaocdtfalBdbaecxfheaDalcefgl9hmbkkdnaiTmbabydlheabydbhlinaeaeydbalydb9RBdbalclfhlaeclfheaicufgimbkkkQbabaeadaic;K1jjbz:njjjbkQbabaeadaic;m:jjjbz:njjjbk9DeeuabcFeaicdtz:vjjjbhlcbhbdnadTmbindnalaeydbcdtfgiydbcu9hmbaiabBdbabcefhbkaeclfheadcufgdmbkkabk;:kivuo99lu8Jjjjjbcj;Hb9Rgl8Kjjjjbcbhvalc:m;Gbfcbc;Kbz:vjjjb8AalcuadcdtadcFFFFi0Egocbyd;u:kjjbHjjjjbbgrBd:m9GalceBd;S9Galcwfcbyd:8:kjjbBdbalcb8Pd:0:kjjb83ibalc;W;Gbfcwfcbyd;i:kjjbBdbalcb8Pd;a:kjjb83i;W9Gaicd4hwdndnadmbJFFuFhDJFFuuhqJFFuuhkJFFuFhxJFFuuhmJFFuFhPxekawcdthsaehzincbhiinalaifgHazaifIdbgDaHIdbgxaxaD9EEUdbalc;W;GbfaifgHaDaHIdbgxaxaD9DEUdbaiclfgicx9hmbkazasfhzavcefgvad9hmbkalIdwhqalId;49GhDalIdlhkalId;09GhxalIdbhmalId;W9GhPkdndnadTmbJbbbbJbbjZJbbbbaPam:tgPaPJbbbb9DEgPaxak:tgxaxaP9DEgxaDaq:tgDaDax9DEgD:vaDJbbbb9BEhDawcdthsarhHadhzindndnaDaeIdbam:tNJb;au9eNJbbbZMgx:lJbbb9p9DTmbax:Ohixekcjjjj94hikaicztaicwtcj;GiGVaicsGVc:p;G:dKGcH2c;d;H:WKGcv2c;j:KM;jbGhvdndnaDaeclfIdbak:tNJb;au9eNJbbbZMgx:lJbbb9p9DTmbax:Ohixekcjjjj94hikaicztaicwtcj;GiGVaicsGVc:p;G:dKGcH2c;d;H:WKGcq2cM;j:KMeGavVhvdndnaDaecwfIdbaq:tNJb;au9eNJbbbZMgx:lJbbb9p9DTmbax:Ohixekcjjjj94hikaHavaicztaicwtcj;GiGVaicsGVc:p;G:dKGcH2c;d;H:WKGcC2c:KM;j:KdGVBdbaeasfheaHclfhHazcufgzmbkalcbcj;Gbz:vjjjbhiarhHadheinaiaHydbgzcFrGcx2fgvavydbcefBdbaiazcq4cFrGcx2fgvavydlcefBdlaiazcC4cFrGcx2fgzazydwcefBdwaHclfhHaecufgembxdkkalcbcj;Gbz:vjjjb8AkcbhHcbhzcbhecbhvinalaHfgiydbhsaiazBdbaicwfgwydbhOawavBdbaiclfgiydbhwaiaeBdbasazfhzaOavfhvawaefheaHcxfgHcj;Gb9hmbkcbhHalaocbyd;u:kjjbHjjjjbbgiBd:q9GdnadTmbabhzinazaHBdbazclfhzadaHcefgH9hmbkabhHadhzinalaraHydbgecdtfydbcFrGcx2fgvavydbgvcefBdbaiavcdtfaeBdbaHclfhHazcufgzmbkaihHadhzinalaraHydbgecdtfydbcq4cFrGcx2fgvavydlgvcefBdlabavcdtfaeBdbaHclfhHazcufgzmbkabhHadhzinalaraHydbgecdtfydbcC4cFrGcx2fgvavydwgvcefBdwaiavcdtfaeBdbaHclfhHazcufgzmbkcbhHinabaiydbcdtfaHBdbaiclfhiadaHcefgH9hmbkkclhidninaic98Smealc:m;Gbfaifydbcbyd;q:kjjbH:bjjjbbaic98fhixbkkalcj;Hbf8Kjjjjbk9teiucbcbyd;y:kjjbgeabcifc98GfgbBd;y:kjjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;teeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiaeydlBdlaiaeydwBdwaiaeydxBdxaeczfheaiczfhiadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk:3eedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdxaialBdwaialBdlaialBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabk9teiucbcbyd;y:kjjbgeabcrfc94GfgbBd;y:kjjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik9:eiuZbhedndncbyd;y:kjjbgdaecztgi9nmbcuheadai9RcFFifcz4nbcuSmekadhekcbabae9Rcifc98Gcbyd;y:kjjbfgdBd;y:kjjbdnadZbcztge9nmbadae9RcFFifcz4nb8Akkk;Qddbcjwk;mdbbbbdbbblbbbwbbbbbbbebbbdbbblbbbwbbbbbbbbbbbbbbbb4:h9w9N94:P:gW:j9O:ye9Pbbbbbbebbbdbbbebbbdbbbbbbbdbbbbbbbebbbbbbb:l29hZ;69:9kZ;N;76Z;rg97Z;z;o9xZ8J;B85Z;:;u9yZ;b;k9HZ:2;Z9DZ9e:l9mZ59A8KZ:r;T3Z:A:zYZ79OHZ;j4::8::Y:D9V8:bbbb9s:49:Z8R:hBZ9M9M;M8:L;z;o8:;8:PG89q;x:J878R:hQ8::M:B;e87bbbbbbjZbbjZbbjZ:E;V;N8::Y:DsZ9i;H;68:xd;R8:;h0838:;W:NoZbbbb:WV9O8:uf888:9i;H;68:9c9G;L89;n;m9m89;D8Ko8:bbbbf:8tZ9m836ZS:2AZL;zPZZ818EZ9e:lxZ;U98F8:819E;68:FFuuFFuuFFuuFFuFFFuFFFuFbc;mqkzebbbebbbdbbb9G:vbb".charCodeAt(a);e[a]=i>96?i-97:i>64?i-39:i+4}var s=0;for(a=0;a<15574;++a)e[s++]=e[a]<60?t[e[a]]:64*(e[a]-60)+e[++a];return e.buffer.slice(0,s)}(),{}).then((function(t){(e=t.instance).exports.__wasm_call_ctors(),e.exports.meshopt_encodeVertexVersion(0),e.exports.meshopt_encodeIndexVersion(1)}))}(),function(){var e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};var a=WebAssembly.validate(e)?i("b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q:6dkr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;X9Mqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk:183lYud97dur978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnalTmbcuhoaiRbbgrc;WeGc:Ge9hmbarcsGgwce0mbc9:hoalcufadcd4cbawEgDadfgrcKcaawEgqaraq0Egk6mbaicefhxavaialfgmar9Rgoad;8qbbcj;abad9Uc;WFbGcjdadca0EhPdndndnadTmbaoadfhscbhzinaeaz9nmdamax9RaD6miabazad2fhHaxaDfhOaPaeaz9RazaPfae6EgAcsfgocl4cifcd4hCavcj;cbfaoc9WGgXcetfhQavcj;cbfaXci2fhLavcj;cbfaXfhKcbhYaoc;ab6h8AincbhodnawTmbaxaYcd4fRbbhokaocFeGhEcbh3avcj;cbfh5indndndndnaEa3cet4ciGgoc9:fPdebdkamaO9RaX6mwavcj;cbfa3aX2faOaX;8qbbaOaAfhOxdkavcj;cbfa3aX2fcbaX;8kbxekamaO9RaC6moaoclVcbawEhraOaCfhocbhidna8Ambamao9Rc;Gb6mbcbhlina5alfhidndndndndndnaOalco4fRbbgqciGarfPDbedibledibkaipxbbbbbbbbbbbbbbbbpklbxlkaiaopbblaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLg8Ecdp:mea8EpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9og8Fpxiiiiiiiiiiiiiiiip8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngacitc:q1jjbfpbibaac:q:yjjbfRbbgapsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Nghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spklbaaaoclffahc:q:yjjbfRbbfhoxikaiaopbbwaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9og8Fpxssssssssssssssssp8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngacitc:q1jjbfpbibaac:q:yjjbfRbbgapsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Nghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spklbaaaocwffahc:q:yjjbfRbbfhoxdkaiaopbbbpklbaoczfhoxekaiaopbbdaoRbbgacitc:q1jjbfpbibaac:q:yjjbfRbbgapsaoRbeghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPpklbaaaocdffahc:q:yjjbfRbbfhokdndndndndndnaqcd4ciGarfPDbedibledibkaiczfpxbbbbbbbbbbbbbbbbpklbxlkaiczfaopbblaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLg8Ecdp:mea8EpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9og8Fpxiiiiiiiiiiiiiiiip8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngacitc:q1jjbfpbibaac:q:yjjbfRbbgapsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Nghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spklbaaaoclffahc:q:yjjbfRbbfhoxikaiczfaopbbwaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9og8Fpxssssssssssssssssp8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngacitc:q1jjbfpbibaac:q:yjjbfRbbgapsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Nghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spklbaaaocwffahc:q:yjjbfRbbfhoxdkaiczfaopbbbpklbaoczfhoxekaiczfaopbbdaoRbbgacitc:q1jjbfpbibaac:q:yjjbfRbbgapsaoRbeghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPpklbaaaocdffahc:q:yjjbfRbbfhokdndndndndndnaqcl4ciGarfPDbedibledibkaicafpxbbbbbbbbbbbbbbbbpklbxlkaicafaopbblaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLg8Ecdp:mea8EpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9og8Fpxiiiiiiiiiiiiiiiip8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngacitc:q1jjbfpbibaac:q:yjjbfRbbgapsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Nghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spklbaaaoclffahc:q:yjjbfRbbfhoxikaicafaopbbwaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9og8Fpxssssssssssssssssp8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngacitc:q1jjbfpbibaac:q:yjjbfRbbgapsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Nghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spklbaaaocwffahc:q:yjjbfRbbfhoxdkaicafaopbbbpklbaoczfhoxekaicafaopbbdaoRbbgacitc:q1jjbfpbibaac:q:yjjbfRbbgapsaoRbeghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPpklbaaaocdffahc:q:yjjbfRbbfhokdndndndndndnaqco4arfPDbedibledibkaic8Wfpxbbbbbbbbbbbbbbbbpklbxlkaic8Wfaopbblaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLg8Ecdp:mea8EpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9og8Fpxiiiiiiiiiiiiiiiip8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngicitc:q1jjbfpbibaic:q:yjjbfRbbgipsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Ngqcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spklbaiaoclffaqc:q:yjjbfRbbfhoxikaic8Wfaopbbwaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9og8Fpxssssssssssssssssp8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngicitc:q1jjbfpbibaic:q:yjjbfRbbgipsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Ngqcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spklbaiaocwffaqc:q:yjjbfRbbfhoxdkaic8Wfaopbbbpklbaoczfhoxekaic8WfaopbbdaoRbbgicitc:q1jjbfpbibaic:q:yjjbfRbbgipsaoRbegqcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPpklbaiaocdffaqc:q:yjjbfRbbfhokalc;abfhialcjefaX0meaihlamao9Rc;Fb0mbkkdnaiaX9pmbaici4hlinamao9RcK6mwa5aifhqdndndndndndnaOaico4fRbbalcoG4ciGarfPDbedibledibkaqpxbbbbbbbbbbbbbbbbpkbbxlkaqaopbblaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLg8Ecdp:mea8EpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9og8Fpxiiiiiiiiiiiiiiiip8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngacitc:q1jjbfpbibaac:q:yjjbfRbbgapsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Nghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spkbbaaaoclffahc:q:yjjbfRbbfhoxikaqaopbbwaopbbbg8Eclp:mea8EpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9og8Fpxssssssssssssssssp8Jg8Ep5b9cjF;8;4;W;G;ab9:9cU1:Ngacitc:q1jjbfpbibaac:q:yjjbfRbbgapsa8Ep5e9cjF;8;4;W;G;ab9:9cU1:Nghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPa8Fa8Ep9spkbbaaaocwffahc:q:yjjbfRbbfhoxdkaqaopbbbpkbbaoczfhoxekaqaopbbdaoRbbgacitc:q1jjbfpbibaac:q:yjjbfRbbgapsaoRbeghcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPpkbbaaaocdffahc:q:yjjbfRbbfhokalcdfhlaiczfgiaX6mbkkaohOaoTmoka5aXfh5a3cefg3cl9hmbkdndndndnawTmbasaYcd4fRbbglciGPlbedwbkaXTmdavcjdfaYfhlavaYfpbdbhgcbhoinalavcj;cbfaofpblbg8JaKaofpblbg8KpmbzeHdOiAlCvXoQrLg8LaQaofpblbg8MaLaofpblbg8NpmbzeHdOiAlCvXoQrLgypmbezHdiOAlvCXorQLg8Ecep9Ta8Epxeeeeeeeeeeeeeeeeg8Fp9op9Hp9rg8Eagp9Uggp9Abbbaladfglaga8Ea8Epmlvorlvorlvorlvorp9Uggp9Abbbaladfglaga8Ea8EpmwDqkwDqkwDqkwDqkp9Uggp9Abbbaladfglaga8Ea8EpmxmPsxmPsxmPsxmPsp9Uggp9Abbbaladfglaga8LaypmwDKYqk8AExm35Ps8E8Fg8Ecep9Ta8Ea8Fp9op9Hp9rg8Ep9Uggp9Abbbaladfglaga8Ea8Epmlvorlvorlvorlvorp9Uggp9Abbbaladfglaga8Ea8EpmwDqkwDqkwDqkwDqkp9Uggp9Abbbaladfglaga8Ea8EpmxmPsxmPsxmPsxmPsp9Uggp9Abbbaladfglaga8Ja8KpmwKDYq8AkEx3m5P8Es8Fg8Ja8Ma8NpmwKDYq8AkEx3m5P8Es8Fg8KpmbezHdiOAlvCXorQLg8Ecep9Ta8Ea8Fp9op9Hp9rg8Ep9Uggp9Abbbaladfglaga8Ea8Epmlvorlvorlvorlvorp9Uggp9Abbbaladfglaga8Ea8EpmwDqkwDqkwDqkwDqkp9Uggp9Abbbaladfglaga8Ea8EpmxmPsxmPsxmPsxmPsp9Uggp9Abbbaladfglaga8Ja8KpmwDKYqk8AExm35Ps8E8Fg8Ecep9Ta8Ea8Fp9op9Hp9rg8Ep9Ug8Fp9Abbbaladfgla8Fa8Ea8Epmlvorlvorlvorlvorp9Ug8Fp9Abbbaladfgla8Fa8Ea8EpmwDqkwDqkwDqkwDqkp9Ug8Fp9Abbbaladfgla8Fa8Ea8EpmxmPsxmPsxmPsxmPsp9Uggp9AbbbaladfhlaoczfgoaX6mbxikkaXTmeavcjdfaYfhlavaYfpbdbhgcbhoinalavcj;cbfaofpblbg8JaKaofpblbg8KpmbzeHdOiAlCvXoQrLg8LaQaofpblbg8MaLaofpblbg8NpmbzeHdOiAlCvXoQrLgypmbezHdiOAlvCXorQLg8Ecep:nea8Epxebebebebebebebebg8Fp9op:bep9rg8Eagp:oeggp9Abbbaladfglaga8Ea8Epmlvorlvorlvorlvorp:oeggp9Abbbaladfglaga8Ea8EpmwDqkwDqkwDqkwDqkp:oeggp9Abbbaladfglaga8Ea8EpmxmPsxmPsxmPsxmPsp:oeggp9Abbbaladfglaga8LaypmwDKYqk8AExm35Ps8E8Fg8Ecep:nea8Ea8Fp9op:bep9rg8Ep:oeggp9Abbbaladfglaga8Ea8Epmlvorlvorlvorlvorp:oeggp9Abbbaladfglaga8Ea8EpmwDqkwDqkwDqkwDqkp:oeggp9Abbbaladfglaga8Ea8EpmxmPsxmPsxmPsxmPsp:oeggp9Abbbaladfglaga8Ja8KpmwKDYq8AkEx3m5P8Es8Fg8Ja8Ma8NpmwKDYq8AkEx3m5P8Es8Fg8KpmbezHdiOAlvCXorQLg8Ecep:nea8Ea8Fp9op:bep9rg8Ep:oeggp9Abbbaladfglaga8Ea8Epmlvorlvorlvorlvorp:oeggp9Abbbaladfglaga8Ea8EpmwDqkwDqkwDqkwDqkp:oeggp9Abbbaladfglaga8Ea8EpmxmPsxmPsxmPsxmPsp:oeggp9Abbbaladfglaga8Ja8KpmwDKYqk8AExm35Ps8E8Fg8Ecep:nea8Ea8Fp9op:bep9rg8Ep:oeg8Fp9Abbbaladfgla8Fa8Ea8Epmlvorlvorlvorlvorp:oeg8Fp9Abbbaladfgla8Fa8Ea8EpmwDqkwDqkwDqkwDqkp:oeg8Fp9Abbbaladfgla8Fa8Ea8EpmxmPsxmPsxmPsxmPsp:oeggp9AbbbaladfhlaoczfgoaX6mbxdkkaXTmbcbhocbalcl4gl9Rc8FGhiavcjdfaYfhravaYfpbdbh8Finaravcj;cbfaofpblbggaKaofpblbg8JpmbzeHdOiAlCvXoQrLg8KaQaofpblbg8LaLaofpblbg8MpmbzeHdOiAlCvXoQrLg8NpmbezHdiOAlvCXorQLg8Eaip:Rea8Ealp:Sep9qg8Ea8Fp9rg8Fp9Abbbaradfgra8Fa8Ea8Epmlvorlvorlvorlvorp9rg8Fp9Abbbaradfgra8Fa8Ea8EpmwDqkwDqkwDqkwDqkp9rg8Fp9Abbbaradfgra8Fa8Ea8EpmxmPsxmPsxmPsxmPsp9rg8Fp9Abbbaradfgra8Fa8Ka8NpmwDKYqk8AExm35Ps8E8Fg8Eaip:Rea8Ealp:Sep9qg8Ep9rg8Fp9Abbbaradfgra8Fa8Ea8Epmlvorlvorlvorlvorp9rg8Fp9Abbbaradfgra8Fa8Ea8EpmwDqkwDqkwDqkwDqkp9rg8Fp9Abbbaradfgra8Fa8Ea8EpmxmPsxmPsxmPsxmPsp9rg8Fp9Abbbaradfgra8Faga8JpmwKDYq8AkEx3m5P8Es8Fgga8La8MpmwKDYq8AkEx3m5P8Es8Fg8JpmbezHdiOAlvCXorQLg8Eaip:Rea8Ealp:Sep9qg8Ep9rg8Fp9Abbbaradfgra8Fa8Ea8Epmlvorlvorlvorlvorp9rg8Fp9Abbbaradfgra8Fa8Ea8EpmwDqkwDqkwDqkwDqkp9rg8Fp9Abbbaradfgra8Fa8Ea8EpmxmPsxmPsxmPsxmPsp9rg8Fp9Abbbaradfgra8Faga8JpmwDKYqk8AExm35Ps8E8Fg8Eaip:Rea8Ealp:Sep9qg8Ep9rg8Fp9Abbbaradfgra8Fa8Ea8Epmlvorlvorlvorlvorp9rg8Fp9Abbbaradfgra8Fa8Ea8EpmwDqkwDqkwDqkwDqkp9rg8Fp9Abbbaradfgra8Fa8Ea8EpmxmPsxmPsxmPsxmPsp9rg8Fp9AbbbaradfhraoczfgoaX6mbkkaYclfgYad6mbkaHavcjdfaAad2;8qbbavavcjdfaAcufad2fad;8qbbaAazfhzc9:hoaOhxaOmbxlkkaeTmbaDalfhrcbhocuhlinaralaD9RglfaD6mdaPaeao9RaoaPfae6Eaofgoae6mbkaial9Rhxkcbc99amax9RakSEhoxekc9:hokavcj;kbf8Kjjjjbaokwbz:bjjjbk::seHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgwce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhDaicefgqarfhidnaeTmbcmcsawceSEhkcbhxcbhmcbhPcbhwcbhlindnaiaD9nmbc9:hoxikdndnaqRbbgoc;Ve0mbavc;abfalaocu7gscl4fcsGcitfgzydlhrazydbhzdnaocsGgHak9pmbavawasfcsGcdtfydbaxaHEhoaHThsdndnadcd9hmbabaPcetfgHaz87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHazBdbaHcwfaoBdbaHclfarBdbkaxasfhxcdhHavawcdtfaoBdbawasfhwcehsalhOxdkdndnaHcsSmbaHc987aHamffcefhoxekaicefhoai8SbbgHcFeGhsdndnaHcu9mmbaohixekaicvfhiascFbGhscrhHdninao8SbbgOcFbGaHtasVhsaOcu9kmeaocefhoaHcrfgHc8J9hmbxdkkaocefhikasce4cbasceG9R7amfhokdndnadcd9hmbabaPcetfgHaz87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHazBdbaHcwfaoBdbaHclfarBdbkcdhHavawcdtfaoBdbcehsawcefhwalhOaohmxekdnaocpe0mbaxcefgHavawaDaocsGfRbbgocl49RcsGcdtfydbaocz6gzEhravawao9RcsGcdtfydbaHazfgAaocsGgHEhoaHThCdndnadcd9hmbabaPcetfgHax87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHaxBdbaHcwfaoBdbaHclfarBdbkcdhsavawcdtfaxBdbavawcefgwcsGcdtfarBdbcihHavc;abfalcitfgOaxBdlaOarBdbavawazfgwcsGcdtfaoBdbalcefcsGhOawaCfhwaxhzaAaCfhxxekaxcbaiRbbgOEgzaoc;:eSgHfhraOcsGhCaOcl4hAdndnaOcs0mbarcefhoxekarhoavawaA9RcsGcdtfydbhrkdndnaCmbaocefhxxekaohxavawaO9RcsGcdtfydbhokdndnaHTmbaicefhHxekaicdfhHai8SbegscFeGhzdnascu9kmbaicofhXazcFbGhzcrhidninaH8SbbgscFbGaitazVhzascu9kmeaHcefhHaicrfgic8J9hmbkaXhHxekaHcefhHkazce4cbazceG9R7amfgmhzkdndnaAcsSmbaHhsxekaHcefhsaH8SbbgicFeGhrdnaicu9kmbaHcvfhXarcFbGhrcrhidninas8SbbgHcFbGaitarVhraHcu9kmeascefhsaicrfgic8J9hmbkaXhsxekascefhskarce4cbarceG9R7amfgmhrkdndnaCcsSmbashixekascefhias8SbbgocFeGhHdnaocu9kmbascvfhXaHcFbGhHcrhodninai8SbbgscFbGaotaHVhHascu9kmeaicefhiaocrfgoc8J9hmbkaXhixekaicefhikaHce4cbaHceG9R7amfgmhokdndnadcd9hmbabaPcetfgHaz87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHazBdbaHcwfaoBdbaHclfarBdbkcdhsavawcdtfazBdbavawcefgwcsGcdtfarBdbcihHavc;abfalcitfgXazBdlaXarBdbavawaOcz6aAcsSVfgwcsGcdtfaoBdbawaCTaCcsSVfhwalcefcsGhOkaqcefhqavc;abfaOcitfgOarBdlaOaoBdbavc;abfalasfcsGcitfgraoBdlarazBdbawcsGhwalaHfcsGhlaPcifgPae6mbkkcbc99aiaDSEhokavc;aef8Kjjjjbaok:clevu8Jjjjjbcz9Rhvdnaecvfal9nmbc9:skdnaiRbbc;:eGc;qeSmbcuskav9cb83iwaicefhoaialfc98fhrdnaeTmbdnadcdSmbcbhwindnaoar6mbc9:skaocefhlao8SbbgicFeGhddndnaicu9mmbalhoxekaocvfhoadcFbGhdcrhidninal8SbbgDcFbGaitadVhdaDcu9kmealcefhlaicrfgic8J9hmbxdkkalcefhokabawcdtfadc8Etc8F91adcd47avcwfadceGcdtVglydbfgiBdbalaiBdbawcefgwae9hmbxdkkcbhwindnaoar6mbc9:skaocefhlao8SbbgicFeGhddndnaicu9mmbalhoxekaocvfhoadcFbGhdcrhidninal8SbbgDcFbGaitadVhdaDcu9kmealcefhlaicrfgic8J9hmbxdkkalcefhokabawcetfadc8Etc8F91adcd47avcwfadceGcdtVglydbfgi87ebalaiBdbawcefgwae9hmbkkcbc99aoarSEk:SPliuo97eue978Jjjjjbca9Rhiaec98Ghldndnadcl9hmbdnalTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalaeSmeaipxbbbbbbbbbbbbbbbbgqpklbaiabalcdtfgdaeciGglcdtgv;8qbbdnalTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDaqp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkadaiav;8qbbskdnalTmbcbhvabhdinadczfgxaxpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmbediwDqkzHOAKY8AEgwczp:Reczp:Sep;6egraDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;7eawczp:Sep;6egwp;Gearp;Gep;Kep;Legopxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegrpxb;:FSb;:FSb;:FSb;:FSararp;Meaoaop;Meawaqawamp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFFbbFFbbFFbbFFbbp9oaoawp;Meaqp;Keczp:Rep9qgoarawp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogrpmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oaoarpmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgval6mbkkalaeSmbaiczfpxbbbbbbbbbbbbbbbbgopklbaiaopklbaiabalcitfgdaeciGglcitgv;8qbbdnalTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmbediwDqkzHOAKY8AEgwczp:Reczp:Sep;6egraDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;7eawczp:Sep;6egwp;Gearp;Gep;Kep;Legopxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegrpxb;:FSb;:FSb;:FSb;:FSararp;Meaoaop;Meawaqawamp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFFbbFFbbFFbbFFbbp9oaoawp;Meaqp;Keczp:Rep9qgoarawp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogrpmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oaoarpmbezHdiOAlvCXorQLp9qpklbkadaiav;8qbbkk:oDllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaDakp;Mearp;Keamp9oaqakp;Mearp;Keczp:Rep9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalaeSmbaiczfpxbbbbbbbbbbbbbbbbgkpklbaiakpklbaiabalcitfgoaeciGgvcitgw;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaDakp;Mearp;Keamp9oaqakp;Mearp;Keczp:Rep9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkaoaiaw;8qbbkk;uddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbheabhdinadadpbbbgocwp:Recwp:Sep;6eaocep:SepxbbjFbbjFbbjFbbjFp9opxbbjZbbjZbbjZbbjZp:Uep;Mepkbbadczfhdaeclfgeav6mbkkdnavalSmbaic8WfpxbbbbbbbbbbbbbbbbgopklbaicafaopklbaiczfaopklbaiaopklbaiabavcdtfgdalciGgecdtgv;8qbbdnaeTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjFbbjFbbjFbbjFp9opxbbjZbbjZbbjZbbjZp:Uep;Mepklbkadaiav;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz:Dbb"):i("b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:W:Odkr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:986qdbk;jYi5ud9:du8Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnalTmbcuhoaiRbbgrc;WeGc:Ge9hmbarcsGgwce0mbc9:hoalcufadcd4cbawEgDadfgrcKcaawEgqaraq0Egk6mbaicefhxcj;abad9Uc;WFbGcjdadca0EhmaialfgPar9Rgoadfhsavaoadz1jjjbgzceVhHcbhOdndninaeaO9nmeaPax9RaD6mdamaeaO9RaOamfgoae6EgAcsfglc9WGhCabaOad2fhXaAcethQaxaDfhiaOaeaoaeao6E9RhLalcl4cifcd4hKazcj;cbfaAfhYcbh8AazcjdfhEaHh3incbhodnawTmbaxa8Acd4fRbbhokaocFeGh5cbh8Eazcj;cbfhqinaih8Fdndndndna5a8Ecet4ciGgoc9:fPdebdkaPa8F9RaA6mrazcj;cbfa8EaA2fa8FaAz1jjjb8Aa8FaAfhixdkazcj;cbfa8EaA2fcbaAz:jjjjb8Aa8FhixekaPa8F9RaK6mva8FaKfhidnaCTmbaPai9RcK6mbaocdtc:q1jjbfcj1jjbawEhaczhrcbhlinargoc9Wfghaqfhrdndndndndndnaaa8Fahco4fRbbalcoG4ciGcdtfydbPDbedvivvvlvkar9cb83bbarcwf9cb83bbxlkarcbaiRbdai8Xbb9c:c:qj:bw9:9c:q;c1:I1e:d9c:b:c:e1z9:gg9cjjjjjz:dg8J9qE86bbaqaofgrcGfag9c8F1:NghcKtc8F91aicdfa8J9c8N1:Nfg8KRbbG86bbarcVfcba8KahcjeGcr4fghRbbag9cjjjjjl:dg8J9qE86bbarc7fcbaha8J9c8L1:NfghRbbag9cjjjjjd:dg8J9qE86bbarctfcbaha8J9c8K1:NfghRbbag9cjjjjje:dg8J9qE86bbarc91fcbaha8J9c8J1:NfghRbbag9cjjjj;ab:dg8J9qE86bbarc4fcbaha8J9cg1:NfghRbbag9cjjjja:dg8J9qE86bbarc93fcbaha8J9ch1:NfghRbbag9cjjjjz:dgg9qE86bbarc94fcbahag9ca1:NfghRbbai8Xbe9c:c:qj:bw9:9c:q;c1:I1e:d9c:b:c:e1z9:gg9cjjjjjz:dg8J9qE86bbarc95fag9c8F1:NgicKtc8F91aha8J9c8N1:NfghRbbG86bbarc96fcbahaicjeGcr4fgiRbbag9cjjjjjl:dg8J9qE86bbarc97fcbaia8J9c8L1:NfgiRbbag9cjjjjjd:dg8J9qE86bbarc98fcbaia8J9c8K1:NfgiRbbag9cjjjjje:dg8J9qE86bbarc99fcbaia8J9c8J1:NfgiRbbag9cjjjj;ab:dg8J9qE86bbarc9:fcbaia8J9cg1:NfgiRbbag9cjjjja:dg8J9qE86bbarcufcbaia8J9ch1:NfgiRbbag9cjjjjz:dgg9qE86bbaiag9ca1:NfhixikaraiRblaiRbbghco4g8Ka8KciSg8KE86bbaqaofgrcGfaiclfa8Kfg8KRbbahcl4ciGg8La8LciSg8LE86bbarcVfa8Ka8Lfg8KRbbahcd4ciGg8La8LciSg8LE86bbarc7fa8Ka8Lfg8KRbbahciGghahciSghE86bbarctfa8Kahfg8KRbbaiRbeghco4g8La8LciSg8LE86bbarc91fa8Ka8Lfg8KRbbahcl4ciGg8La8LciSg8LE86bbarc4fa8Ka8Lfg8KRbbahcd4ciGg8La8LciSg8LE86bbarc93fa8Ka8Lfg8KRbbahciGghahciSghE86bbarc94fa8Kahfg8KRbbaiRbdghco4g8La8LciSg8LE86bbarc95fa8Ka8Lfg8KRbbahcl4ciGg8La8LciSg8LE86bbarc96fa8Ka8Lfg8KRbbahcd4ciGg8La8LciSg8LE86bbarc97fa8Ka8Lfg8KRbbahciGghahciSghE86bbarc98fa8KahfghRbbaiRbigico4g8Ka8KciSg8KE86bbarc99faha8KfghRbbaicl4ciGg8Ka8KciSg8KE86bbarc9:faha8KfghRbbaicd4ciGg8Ka8KciSg8KE86bbarcufaha8KfgrRbbaiciGgiaiciSgiE86bbaraifhixdkaraiRbwaiRbbghcl4g8Ka8KcsSg8KE86bbaqaofgrcGfaicwfa8Kfg8KRbbahcsGghahcsSghE86bbarcVfa8KahfghRbbaiRbeg8Kcl4g8La8LcsSg8LE86bbarc7faha8LfghRbba8KcsGg8Ka8KcsSg8KE86bbarctfaha8KfghRbbaiRbdg8Kcl4g8La8LcsSg8LE86bbarc91faha8LfghRbba8KcsGg8Ka8KcsSg8KE86bbarc4faha8KfghRbbaiRbig8Kcl4g8La8LcsSg8LE86bbarc93faha8LfghRbba8KcsGg8Ka8KcsSg8KE86bbarc94faha8KfghRbbaiRblg8Kcl4g8La8LcsSg8LE86bbarc95faha8LfghRbba8KcsGg8Ka8KcsSg8KE86bbarc96faha8KfghRbbaiRbvg8Kcl4g8La8LcsSg8LE86bbarc97faha8LfghRbba8KcsGg8Ka8KcsSg8KE86bbarc98faha8KfghRbbaiRbog8Kcl4g8La8LcsSg8LE86bbarc99faha8LfghRbba8KcsGg8Ka8KcsSg8KE86bbarc9:faha8KfghRbbaiRbrgicl4g8Ka8KcsSg8KE86bbarcufaha8KfgrRbbaicsGgiaicsSgiE86bbaraifhixekarai8Pbb83bbarcwfaicwf8Pbb83bbaiczfhikdnaoaC9pmbalcdfhlaoczfhraPai9RcL0mekkaoaC6moaimexokaCmva8FTmvkaqaAfhqa8Ecefg8Ecl9hmbkdndndndnawTmbasa8Acd4fRbbgociGPlbedrbkaATmdaza8Afh8Fazcj;cbfhhcbh8EaEhaina8FRbbhraahocbhlinaoahalfRbbgqce4cbaqceG9R7arfgr86bbaoadfhoaAalcefgl9hmbkaacefhaa8Fcefh8FahaAfhha8Ecefg8Ecl9hmbxikkaATmeaza8Afhaazcj;cbfhhcbhoceh8EaYh8FinaEaofhlaa8Vbbhrcbhoinala8FaofRbbcwtahaofRbbgqVc;:FiGce4cbaqceG9R7arfgr87bbaladfhlaLaocefgofmbka8FaQfh8FcdhoaacdfhaahaQfhha8EceGhlcbh8EalmbxdkkaATmbcbaocl49Rh8Eaza8AfRbbhqcwhoa3hlinalRbbaotaqVhqalcefhlaocwfgoca9hmbkcbhhaEh8FaYhainazcj;cbfahfRbbhrcwhoaahlinalRbbaotarVhralaAfhlaocwfgoca9hmbkara8E93aq7hqcbhoa8Fhlinalaqao486bbalcefhlaocwfgoca9hmbka8Fadfh8FaacefhaahcefghaA9hmbkkaEclfhEa3clfh3a8Aclfg8Aad6mbkaXazcjdfaAad2z1jjjb8AazazcjdfaAcufad2fadz1jjjb8AaAaOfhOaihxaimbkc9:hoxdkcbc99aPax9RakSEhoxekc9:hokavcj;kbf8Kjjjjbaok;cseHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgwce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhDaicefgqarfhidnaeTmbcmcsawceSEhkcbhxcbhmcbhPcbhwcbhlindnaiaD9nmbc9:hoxikdndnaqRbbgoc;Ve0mbavc;abfalaocu7gscl4fcsGcitfgzydlhrazydbhzdnaocsGgHak9pmbavawasfcsGcdtfydbaxaHEhoaHThsdndnadcd9hmbabaPcetfgHaz87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHazBdbaHcwfaoBdbaHclfarBdbkaxasfhxcdhHavawcdtfaoBdbawasfhwcehsalhOxdkdndnaHcsSmbaHc987aHamffcefhoxekaicefhoai8SbbgHcFeGhsdndnaHcu9mmbaohixekaicvfhiascFbGhscrhHdninao8SbbgOcFbGaHtasVhsaOcu9kmeaocefhoaHcrfgHc8J9hmbxdkkaocefhikasce4cbasceG9R7amfhokdndnadcd9hmbabaPcetfgHaz87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHazBdbaHcwfaoBdbaHclfarBdbkcdhHavawcdtfaoBdbcehsawcefhwalhOaohmxekdnaocpe0mbaxcefgHavawaDaocsGfRbbgocl49RcsGcdtfydbaocz6gzEhravawao9RcsGcdtfydbaHazfgAaocsGgHEhoaHThCdndnadcd9hmbabaPcetfgHax87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHaxBdbaHcwfaoBdbaHclfarBdbkcdhsavawcdtfaxBdbavawcefgwcsGcdtfarBdbcihHavc;abfalcitfgOaxBdlaOarBdbavawazfgwcsGcdtfaoBdbalcefcsGhOawaCfhwaxhzaAaCfhxxekaxcbaiRbbgOEgzaoc;:eSgHfhraOcsGhCaOcl4hAdndnaOcs0mbarcefhoxekarhoavawaA9RcsGcdtfydbhrkdndnaCmbaocefhxxekaohxavawaO9RcsGcdtfydbhokdndnaHTmbaicefhHxekaicdfhHai8SbegscFeGhzdnascu9kmbaicofhXazcFbGhzcrhidninaH8SbbgscFbGaitazVhzascu9kmeaHcefhHaicrfgic8J9hmbkaXhHxekaHcefhHkazce4cbazceG9R7amfgmhzkdndnaAcsSmbaHhsxekaHcefhsaH8SbbgicFeGhrdnaicu9kmbaHcvfhXarcFbGhrcrhidninas8SbbgHcFbGaitarVhraHcu9kmeascefhsaicrfgic8J9hmbkaXhsxekascefhskarce4cbarceG9R7amfgmhrkdndnaCcsSmbashixekascefhias8SbbgocFeGhHdnaocu9kmbascvfhXaHcFbGhHcrhodninai8SbbgscFbGaotaHVhHascu9kmeaicefhiaocrfgoc8J9hmbkaXhixekaicefhikaHce4cbaHceG9R7amfgmhokdndnadcd9hmbabaPcetfgHaz87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHazBdbaHcwfaoBdbaHclfarBdbkcdhsavawcdtfazBdbavawcefgwcsGcdtfarBdbcihHavc;abfalcitfgXazBdlaXarBdbavawaOcz6aAcsSVfgwcsGcdtfaoBdbawaCTaCcsSVfhwalcefcsGhOkaqcefhqavc;abfaOcitfgOarBdlaOaoBdbavc;abfalasfcsGcitfgraoBdlarazBdbawcsGhwalaHfcsGhlaPcifgPae6mbkkcbc99aiaDSEhokavc;aef8Kjjjjbaok:clevu8Jjjjjbcz9Rhvdnaecvfal9nmbc9:skdnaiRbbc;:eGc;qeSmbcuskav9cb83iwaicefhoaialfc98fhrdnaeTmbdnadcdSmbcbhwindnaoar6mbc9:skaocefhlao8SbbgicFeGhddndnaicu9mmbalhoxekaocvfhoadcFbGhdcrhidninal8SbbgDcFbGaitadVhdaDcu9kmealcefhlaicrfgic8J9hmbxdkkalcefhokabawcdtfadc8Etc8F91adcd47avcwfadceGcdtVglydbfgiBdbalaiBdbawcefgwae9hmbxdkkcbhwindnaoar6mbc9:skaocefhlao8SbbgicFeGhddndnaicu9mmbalhoxekaocvfhoadcFbGhdcrhidninal8SbbgDcFbGaitadVhdaDcu9kmealcefhlaicrfgic8J9hmbxdkkalcefhokabawcetfadc8Etc8F91adcd47avcwfadceGcdtVglydbfgi87ebalaiBdbawcefgwae9hmbkkcbc99aoarSEk:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;oiliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabaiavcefciGfcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:OhDxekcjjjj94hDkabaiavciGfgkcd7cetfaD87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:OhDxekcjjjj94hDkabaiavcufciGfcetfaD87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohvxekcjjjj94hvkabakcetfav87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2gdTmbinababydbgecwtcw91:Yaece91cjjj98Gcjjj;8if::NUdbabclfhbadcufgdmbkkk9teiucbcbyd:K1jjbgeabcifc98GfgbBd:K1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;teeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiaeydlBdlaiaeydwBdwaiaeydxBdxaeczfheaiczfhiadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk:3eedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdxaialBdwaialBdlaialBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkk81dbcjwk8Kbbbbdbbblbbbwbbbbbbbebbbdbbblbbbwbbbbc:Kwkl8WNbb");function i(e){for(var a=new Uint8Array(e.length),i=0;i<e.length;++i){var s=e.charCodeAt(i);a[i]=s>96?s-97:s>64?s-39:s+4}var r=0;for(i=0;i<e.length;++i)a[r++]=a[i]<60?t[a[i]]:64*(a[i]-60)+a[++i];return a.buffer.slice(0,r)}WebAssembly.instantiate(a,{}).then((function(e){e.instance.exports.__wasm_call_ctors()}))}(),function(){var e,t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};var a=WebAssembly.instantiate(function(){for(var e=new Uint8Array(21504),a=0;a<21504;++a){var i="b9H79Tebbbe9Hk9Geueu9Geub9Gbb9Gsuuuuuuuuuuuu99uueu9Gvuuuuub9Gvuuuuue999Gquuuuuuu99uueu9Gwuuuuuu99ueu9Giuuue999Gluuuueu9GiuuueuizsdilvoirwDbqqbeqlve9Weiiviebeoweuec:G:Pdkr:Tewo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bbz9TW79O9V9Wt9F79P9T9W29P9M95bl8E9TW79O9V9Wt9F79P9T9W29P9M959x9Pt9OcttV9P9I91tW7bvQ9TW79O9V9Wt9F79P9T9W29P9M959q9V9P9Ut7boX9TW79O9V9Wt9F79P9T9W29P9M959t9J9H2Wbra9TW79O9V9Wt9F9V9Wt9P9T9P96W9wWVtW94SWt9J9O9sW9T9H9Wbwl79IV9RbDDwebcekdmxq:x:yesdbk:Z9VvKue99euY99Ou8Jjjjjbc;W;qb9Rgs8Kjjjjbcbhzascxfcbc;Kbz:ljjjb8AdnabaeSmbabaeadcdtz:kjjjb8AkdnamcdGTmbalcrfci4gHcbyd:m:jjjbHjjjjbbheascxfasyd2gOcdtfaeBdbasaOcefBd2aecbaHz:ljjjbhAcbhlcbhednadTmbcbhlabheadhHinaAaeydbgOci4fgCaCRbbgCceaOcrGgOtV86bbaCcu7aO4ceGalfhlaeclfheaHcufgHmbkcualcdtalcFFFFi0Ehekaecbyd:m:jjjbHjjjjbbhzascxfasyd2gecdtfazBdbasaecefBd2alcd4alfhOcehHinaHgecethHaeaO6mbkcbhXcuaecdtgOaecFFFFi0Ecbyd:m:jjjbHjjjjbbhHascxfasyd2gCcdtfaHBdbasaCcefBd2aHcFeaOz:ljjjbhQdnadTmbaecufhLcbhKindndnaQabaXcdtfgYydbgCc:v;t;h;Ev2aLGgOcdtfgAydbgHcuSmbceheinazaHcdtfydbaCSmdaOaefhHaecefheaQaHaLGgOcdtfgAydbgHcu9hmbkkazaKcdtfaCBdbaAaKBdbaKhHaKcefhKkaYaHBdbaXcefgXad9hmbkkaQcbyd1:jjjbH:bjjjbbasasyd2cufBd2kcualcefgecdtaecFFFFi0Ecbyd:m:jjjbHjjjjbbh8Aascxfasyd2gecdtfa8ABdbasa8ABdlasaecefBd2cuadcitadcFFFFe0Ecbyd:m:jjjbHjjjjbbhEascxfasyd2gecdtfaEBdbasaEBdwasaecefBd2asclfabadalcbz:cjjjbcualcdtg3alcFFFFi0Eg5cbyd:m:jjjbHjjjjbbhLascxfasyd2gecdtfaLBdbasaecefBd2a5cbyd:m:jjjbHjjjjbbh8Eascxfasyd2gecdtfa8EBdbasaecefBd2alcd4alfhOcehHinaHgecethHaeaO6mbkcbhYcuaecdtgOaecFFFFi0Ecbyd:m:jjjbHjjjjbbhHascxfasyd2gCcdtfaHBdbasaCcefBd2aHcFeaOz:ljjjbhQdnalTmbavcd4hCaecufhKinaYhednazTmbazaYcdtfydbhekaiaeaC2cdtfgeydlgHcH4aH7c:F:b:DD2aeydbgHcH4aH7c;D;O:B8J27aeydwgecH4ae7c:3F;N8N27aKGhHaYcdth8FdndndnazTmbaQaHcdtfgAydbgecuSmeaiaza8FfydbaC2cdtfhXcehOinaiazaecdtfydbaC2cdtfaXcxz:ojjjbTmiaHaOfheaOcefhOaQaeaKGgHcdtfgAydbgecu9hmbxdkkaQaHcdtfgAydbgecuSmbaiaYaC2cdtfhXcehOinaiaeaC2cdtfaXcxz:ojjjbTmdaHaOfheaOcefhOaQaeaKGgHcdtfgAydbgecu9hmbkkaAaYBdbaYhekaLa8FfaeBdbaYcefgYal9hmbkcbhea8EhHinaHaeBdbaHclfhHalaecefge9hmbkcbheaLhHa8EhOindnaeaHydbgCSmbaOa8EaCcdtfgCydbBdbaCaeBdbkaHclfhHaOclfhOalaecefge9hmbkkcbhaaQcbyd1:jjjbH:bjjjbbasasyd2cufBd2alcbyd:m:jjjbHjjjjbbhKascxfasyd2gecdtfaKBdbasaecefBd2a5cbyd:m:jjjbHjjjjbbheascxfasyd2gHcdtfaeBdbasaHcefBd2a5cbyd:m:jjjbHjjjjbbhHascxfasyd2gOcdtfaHBdbasaOcefBd2aecFea3z:ljjjbhhaHcFea3z:ljjjbhgdnalTmbaEcwfh8Jindna8AaagOcefgacdtfydbgCa8AaOcdtgefydbgHSmbaCaH9Rh8FaEaHcitfh3agaefh8KahaefhYcbhAindndna3aAcitfydbgQaO9hmbaYaOBdba8KaOBdbxekdna8AaQcdtg8LfgeclfydbgHaeydbgeSmbaEaecitgCfydbaOSmeaHae9Rh8Maecu7aHfhXa8JaCfhHcbheinaXaeSmeaecefheaHydbhCaHcwfhHaCaO9hmbkaea8M6mekaga8LfgeaOaQaeydbcuSEBdbaYaQaOaYydbcuSEBdbkaAcefgAa8F9hmbkkaaal9hmbkaLhHa8EhOaghCahhAcbheindndnaeaHydbgQ9hmbdnaeaOydbgQ9hmbaAydbhQdnaCydbgXcu9hmbaQcu9hmbaKaefcb86bbxikaKaefhYdnaeaXSmbaeaQSmbaYce86bbxikaYcl86bbxdkdnaea8EaQcdtgXfydb9hmbdnaCydbgYcuSmbaeaYSmbaAydbg8FcuSmbaea8FSmbagaXfydbg3cuSmba3aQSmbahaXfydbgXcuSmbaXaQSmbdnaLaYcdtfydbgQaLaXcdtfydb9hmbaQaLa8FcdtfydbgXSmbaXaLa3cdtfydb9hmbaKaefcd86bbxlkaKaefcl86bbxikaKaefcl86bbxdkaKaefcl86bbxekaKaefaKaQfRbb86bbkaHclfhHaOclfhOaCclfhCaAclfhAalaecefge9hmbkdnaqTmbdndnazTmbazheaLhHalhOindnaqaeydbfRbbTmbaKaHydbfcl86bbkaeclfheaHclfhHaOcufgOmbxdkkaLhealhHindnaqRbbTmbaKaeydbfcl86bbkaqcefhqaeclfheaHcufgHmbkkaLhealhOaKhHindnaKaeydbfRbbcl9hmbaHcl86bbkaeclfheaHcefhHaOcufgOmbkkamceGTmbaKhealhHindnaeRbbce9hmbaecl86bbkaecefheaHcufgHmbkkcualcx2alc;v:Q;v:Qe0Ecbyd:m:jjjbHjjjjbbhaascxfasyd2gecdtfaaBdbasaecefBd2aaaialavazz:djjjbh8NdndnaDmbcbhycbh8Jxekcbh8JawhecbhHindnaeIdbJbbbb9ETmbasc;Wbfa8JcdtfaHBdba8Jcefh8JkaeclfheaDaHcefgH9hmbkcua8Jal2gecdtaecFFFFi0Ecbyd:m:jjjbHjjjjbbhyascxfasyd2gecdtfayBdbasaecefBd2alTmba8JTmbarcd4hYdnazTmba8Jcdth8FcbhQayhXinaoazaQcdtfydbaY2cdtfhAasc;WbfheaXhHa8JhOinaHaAaeydbcdtgCfIdbawaCfIdbNUdbaeclfheaHclfhHaOcufgOmbkaXa8FfhXaQcefgQal9hmbxdkka8Jcdth8FcbhQayhXinaoaQaY2cdtfhAasc;WbfheaXhHa8JhOinaHaAaeydbcdtgCfIdbawaCfIdbNUdbaeclfheaHclfhHaOcufgOmbkaXa8FfhXaQcefgQal9hmbkkcualc8S2gHalc;D;O;f8U0EgCcbyd:m:jjjbHjjjjbbheascxfasyd2gOcdtfaeBdbasaOcefBd2aecbaHz:ljjjbhqdndndndna8JTmbaCcbyd:m:jjjbHjjjjbbhvascxfasyd2gecdtfavBdbcehOasaecefBd2avcbaHz:ljjjb8Acua8Jal2gecltgHaecFFFFb0Ecbyd:m:jjjbHjjjjbbhrascxfasyd2gecdtfarBdbasaecefBd2arcbaHz:ljjjb8AadmexikcbhvadTmecbhrkcbhAabhHindnaaaHclfydbgQcx2fgeIdbaaaHydbgXcx2fgOIdbg8P:tgIaaaHcwfydbgYcx2fgCIdlaOIdlg8R:tg8SNaCIdba8P:tgRaeIdla8R:tg8UN:tg8Va8VNa8UaCIdwaOIdwg8W:tg8XNa8SaeIdwa8W:tg8UN:tg8Sa8SNa8UaRNa8XaIN:tgIaINMM:rgRJbbbb9ETmba8VaR:vh8VaIaR:vhIa8SaR:vh8SkaqaLaXcdtfydbc8S2fgea8SaR:rgRa8SNNg8UaeIdbMUdbaeaIaRaINg8YNg8XaeIdlMUdlaea8VaRa8VNg8ZNg80aeIdwMUdwaea8Ya8SNg8YaeIdxMUdxaea8Za8SNg81aeIdzMUdzaea8ZaINg8ZaeIdCMUdCaea8SaRa8Va8WNa8Sa8PNa8RaINMM:mg8RNg8PNg8SaeIdKMUdKaeaIa8PNgIaeId3MUd3aea8Va8PNg8VaeIdaMUdaaea8Pa8RNg8PaeId8KMUd8KaeaRaeIdyMUdyaqaLaQcdtfydbc8S2fgea8UaeIdbMUdbaea8XaeIdlMUdlaea80aeIdwMUdwaea8YaeIdxMUdxaea81aeIdzMUdzaea8ZaeIdCMUdCaea8SaeIdKMUdKaeaIaeId3MUd3aea8VaeIdaMUdaaea8PaeId8KMUd8KaeaRaeIdyMUdyaqaLaYcdtfydbc8S2fgea8UaeIdbMUdbaea8XaeIdlMUdlaea80aeIdwMUdwaea8YaeIdxMUdxaea81aeIdzMUdzaea8ZaeIdCMUdCaea8SaeIdKMUdKaeaIaeId3MUd3aea8VaeIdaMUdaaea8PaeId8KMUd8KaeaRaeIdyMUdyaHcxfhHaAcifgAad6mbkcbh8FabhXinaba8FcdtfhQcbhHinaKaQaHc;a1jjbfydbcdtfydbgOfRbbhedndnaKaXaHfydbgCfRbbgAc99fcFeGcpe0mbaec99fcFeGc;:e6mekdnaAcufcFeGce0mbahaCcdtfydbaO9hmekdnaecufcFeGce0mbagaOcdtfydbaC9hmekdnaAcv2aefc:G1jjbfRbbTmbaLaOcdtfydbaLaCcdtfydb0mekJbbacJbbacJbbjZaecFeGceSEaAceSEh8ZdnaaaQaHc;e1jjbfydbcdtfydbcx2fgeIdwaaaCcx2fgAIdwg8R:tg8VaaaOcx2fgYIdwa8R:tg8Sa8SNaYIdbaAIdbg8W:tgIaINaYIdlaAIdlg8U:tgRaRNMMg8PNa8Va8SNaeIdba8W:tg80aINaRaeIdla8U:tg8YNMMg8Xa8SN:tg8Va8VNa80a8PNa8XaIN:tg8Sa8SNa8Ya8PNa8XaRN:tgIaINMM:rgRJbbbb9ETmba8VaR:vh8VaIaR:vhIa8SaR:vh8SkaqaLaCcdtfydbc8S2fgea8Sa8Za8P:rNgRa8SNNg8XaeIdbMUdbaeaIaRaINg8ZNg80aeIdlMUdlaea8VaRa8VNg8PNg8YaeIdwMUdwaea8Za8SNg8ZaeIdxMUdxaea8Pa8SNg81aeIdzMUdzaea8PaINgBaeIdCMUdCaea8SaRa8Va8RNa8Sa8WNa8UaINMM:mg8RNg8PNg8SaeIdKMUdKaeaIa8PNgIaeId3MUd3aea8Va8PNg8VaeIdaMUdaaea8Pa8RNg8PaeId8KMUd8KaeaRaeIdyMUdyaqaLaOcdtfydbc8S2fgea8XaeIdbMUdbaea80aeIdlMUdlaea8YaeIdwMUdwaea8ZaeIdxMUdxaea81aeIdzMUdzaeaBaeIdCMUdCaea8SaeIdKMUdKaeaIaeId3MUd3aea8VaeIdaMUdaaea8PaeId8KMUd8KaeaRaeIdyMUdykaHclfgHcx9hmbkaXcxfhXa8Fcifg8Fad6mbkdna8JTmbcbhXinJbbbbh8WaaabaXcdtfgeclfydbgYcx2fgHIdwaaaeydbg8Fcx2fgOIdwg8Y:tgIaINaHIdbaOIdbg81:tg8Va8VNaHIdlaOIdlgB:tgRaRNMMg8Zaaaecwfydbg3cx2fgeIdwa8Y:tg8PNaIaIa8PNa8VaeIdba81:tg8RNaRaeIdlaB:tg8UNMMg8SN:tJbbbbJbbjZa8Za8Pa8PNa8Ra8RNa8Ua8UNMMg80Na8Sa8SN:tg8X:va8XJbbbb9BEg8XNh83a80aINa8Pa8SN:ta8XNhUa8Za8UNaRa8SN:ta8XNh85a80aRNa8Ua8SN:ta8XNh86a8Za8RNa8Va8SN:ta8XNh87a80a8VNa8Ra8SN:ta8XNh88a8Va8UNa8RaRN:tg8Sa8SNaRa8PNa8UaIN:tg8Sa8SNaIa8RNa8Pa8VN:tg8Sa8SNMM:rJbbbZNh8Saya8Fa8J2gwcdtfhHaya3a8J2g8LcdtfhOayaYa8J2gicdtfhCa8Y:mh89aB:mh8:a81:mhZcbhAa8JhQJbbbbh8UJbbbbh8XJbbbbh8ZJbbbbh80Jbbbbh8YJbbbbh81JbbbbhBJbbbbhnJbbbbhcinasc;WbfaAfgecwfa8SaUaCIdbaHIdbg8P:tgRNa83aOIdba8P:tg8RNMgINUdbaeclfa8Sa86aRNa85a8RNMg8VNUdbaea8Sa88aRNa87a8RNMgRNUdbaecxfa8Sa89aINa8:a8VNa8PaZaRNMMMg8PNUdba8SaIa8VNNa80Mh80a8SaIaRNNa8YMh8Ya8Sa8VaRNNa81Mh81a8Sa8Pa8PNNa8WMh8Wa8SaIa8PNNa8UMh8Ua8Sa8Va8PNNa8XMh8Xa8SaRa8PNNa8ZMh8Za8SaIaINNaBMhBa8Sa8Va8VNNanMhna8SaRaRNNacMhcaHclfhHaCclfhCaOclfhOaAczfhAaQcufgQmbkava8Fc8S2fgeacaeIdbMUdbaeanaeIdlMUdlaeaBaeIdwMUdwaea81aeIdxMUdxaea8YaeIdzMUdzaea80aeIdCMUdCaea8ZaeIdKMUdKaea8XaeId3MUd3aea8UaeIdaMUdaaea8WaeId8KMUd8Kaea8SaeIdyMUdyavaYc8S2fgeacaeIdbMUdbaeanaeIdlMUdlaeaBaeIdwMUdwaea81aeIdxMUdxaea8YaeIdzMUdzaea80aeIdCMUdCaea8ZaeIdKMUdKaea8XaeId3MUd3aea8UaeIdaMUdaaea8WaeId8KMUd8Kaea8SaeIdyMUdyava3c8S2fgeacaeIdbMUdbaeanaeIdlMUdlaeaBaeIdwMUdwaea81aeIdxMUdxaea8YaeIdzMUdzaea80aeIdCMUdCaea8ZaeIdKMUdKaea8XaeId3MUd3aea8UaeIdaMUdaaea8WaeId8KMUd8Kaea8SaeIdyMUdyarawcltfhQcbhHa8JhCinaQaHfgeasc;WbfaHfgOIdbaeIdbMUdbaeclfgAaOclfIdbaAIdbMUdbaecwfgAaOcwfIdbaAIdbMUdbaecxfgeaOcxfIdbaeIdbMUdbaHczfhHaCcufgCmbkaraicltfhQcbhHa8JhCinaQaHfgeasc;WbfaHfgOIdbaeIdbMUdbaeclfgAaOclfIdbaAIdbMUdbaecwfgAaOcwfIdbaAIdbMUdbaecxfgeaOcxfIdbaeIdbMUdbaHczfhHaCcufgCmbkara8LcltfhQcbhHa8JhCinaQaHfgeasc;WbfaHfgOIdbaeIdbMUdbaeclfgAaOclfIdbaAIdbMUdbaecwfgAaOcwfIdbaAIdbMUdbaecxfgeaOcxfIdbaeIdbMUdbaHczfhHaCcufgCmbkaXcifgXad6mbkkcbhOxekcehOcbhrkcbh3dndnamcwGg9cmbJbbbbh8UcbhJcbhocbhCxekcbhea5cbyd:m:jjjbHjjjjbbhCascxfasyd2gHcdtfaCBdbasaHcefBd2dnalTmbaChHinaHaeBdbaHclfhHalaecefge9hmbkkdnaOmbcbh8Finaba8FcdtfhYcbhXinaLaYaXcdtgec;a1jjbfydbcdtfydbcdtfydbhHdnaCaLaYaefydbcdtfydbgOcdtfgAydbgeaOSmbinaAaCaegOcdtfgQydbgeBdbaQhAaOae9hmbkkdnaCaHcdtfgAydbgeaHSmbinaAaCaegHcdtfgQydbgeBdbaQhAaHae9hmbkkdnaOaHSmbaCaOaHaOaH0EcdtfaOaHaOaH6EBdbkaXcefgXci9hmbka8Fcifg8Fad6mbkkcbhJdnalTmbcbhQindnaLaQcdtgefydbaQ9hmbaQhHdnaCaefgXydbgeaQSmbaXhOinaOaCaegHcdtfgAydbgeBdbaAhOaHae9hmbkkaXaHBdbkaQcefgQal9hmbkcbheaLhOaChHcbhJindndnaeaOydbgA9hmbdnaeaHydbgA9hmbaHaJBdbaJcefhJxdkaHaCaAcdtfydbBdbxekaHaCaAcdtfydbBdbkaOclfhOaHclfhHalaecefge9hmbkkcuaJcltgeaJcjjjjiGEcbyd:m:jjjbHjjjjbbhoascxfasyd2gHcdtfaoBdbasaHcefBd2aocbaez:ljjjbhAdnalTmbaChOaahealhQinaecwfIdbh8SaeclfIdbhIaAaOydbcltfgHaeIdbaHIdbMUdbaHclfgXaIaXIdbMUdbaHcwfgXa8SaXIdbMUdbaHcxfgHaHIdbJbbjZMUdbaOclfhOaecxfheaQcufgQmbkkdnaJTmbaAheaJhHinaecxfgOIdbh8SaOcbBdbaeaeIdbJbbbbJbbjZa8S:va8SJbbbb9BEg8SNUdbaeclfgOa8SaOIdbNUdbaecwfgOa8SaOIdbNUdbaeczfheaHcufgHmbkkdnalTmbaChOaahealhQinaAaOydbcltfgHcxfgXaecwfIdbaHcwfIdb:tg8Sa8SNaeIdbaHIdb:tg8Sa8SNaeclfIdbaHclfIdb:tg8Sa8SNMMg8SaXIdbgIaIa8S9DEUdbaOclfhOaecxfheaQcufgQmbkkdnaJmbcbhJJFFuuh8UxekaAcxfheaAhHaJhOinaHaeIdbUdbaeczfheaHclfhHaOcufgOmbkJFFuuh8UaAheaJhHinaeIdbg8Sa8Ua8Ua8S9EEh8UaeclfheaHcufgHmbkkasydlh9ednalTmba9eclfhea9eydbhAaKhHalhQcbhOincbaeydbgXaA9RaHRbbcpeGEaOfhOaHcefhHaeclfheaXhAaQcufgQmbkaOce4h3kcuada39RcifgTcx2aTc;v:Q;v:Qe0Ecbyd:m:jjjbHjjjjbbhDascxfasyd2gecdtfaDBdbasaecefBd2cuaTcdtaTcFFFFi0Ecbyd:m:jjjbHjjjjbbhSascxfasyd2gecdtfaSBdbasaecefBd2a5cbyd:m:jjjbHjjjjbbh8Mascxfasyd2gecdtfa8MBdbasaecefBd2alcbyd:m:jjjbHjjjjbbh9hascxfasyd2gecdtfa9hBdbasaecefBd2axaxNa8NJbbjZamclGEg83a83N:vhcJbbbbhndnadak9nmbdnaTci6mba8Jclth9iaDcwfh6JbbbbhBJbbbbhninasclfabadalaLz:cjjjbabh3cbhEcbh5inaba5cdtfhwcbheindnaLa3aefydbgOcdtg8FfydbgQaLawaec;q1jjbfydbcdtfydbgHcdtg8LfydbgXSmbaKaHfRbbgYcv2aKaOfRbbgAfc;G1jjbfRbbg8AaAcv2aYfgic;G1jjbfRbbg8KVcFeGTmbdnaXaQ9nmbaic:G1jjbfRbbcFeGmekaAcufhQdnaAaY9hmbaQcFeGce0mbaha8FfydbaH9hmekdndnaAclSmbaYcl9hmekdnaQcFeGce0mbaha8FfydbaH9hmdkaYcufcFeGce0mbaga8LfydbaO9hmekaDaEcx2fgAaHaOa8KcFeGgQEBdlaAaOaHaQEBdbaAaQa8AGcb9hBdwaEcefhEkaeclfgecx9hmbkdna5cifg5ad9pmba3cxfh3aEcifaT9nmekkaETmdcbhYinaqaLaDaYcx2fgAydbgQcdtg3fydbc8S2fgeIdwaaaAydlgXcx2fgHIdwg8VNaeIdzaHIdbgRNaeIdaMg8Sa8SMMa8VNaeIdlaHIdlg8PNaeIdCa8VNaeId3Mg8Sa8SMMa8PNaeIdbaRNaeIdxa8PNaeIdKMg8Sa8SMMaRNaeId8KMMM:lh8SJbbbbJbbjZaeIdygI:vaIJbbbb9BEhIdndnaAydwg8FmbJFFuuh8XxekJbbbbJbbjZaqaLaXcdtfydbc8S2fgeIdyg8R:va8RJbbbb9BEaeIdwaaaQcx2fgHIdwg8RNaeIdzaHIdbg8WNaeIdaMg8Xa8XMMa8RNaeIdlaHIdlg8XNaeIdCa8RNaeId3Mg8Ra8RMMa8XNaeIdba8WNaeIdxa8XNaeIdKMg8Ra8RMMa8WNaeId8KMMM:lNh8XkaIa8SNh8Zdna8JTmbavaQc8S2fgOIdwa8VNaOIdzaRNaOIdaMg8Sa8SMMa8VNaOIdla8PNaOIdCa8VNaOId3Mg8Sa8SMMa8PNaOIdbaRNaOIdxa8PNaOIdKMg8Sa8SMMaRNaOId8KMMMh8SayaXa8J2gwcdtfhHaraQa8J2g8LcltfheaOIdyh8Ra8JhOinaHIdbgIaIa8RNaecxfIdba8VaecwfIdbNaRaeIdbNa8PaeclfIdbNMMMgIaIM:tNa8SMh8SaHclfhHaeczfheaOcufgOmbkdndna8FmbJbbbbhIxekavaXc8S2fgOIdwaaaQcx2fgeIdwgRNaOIdzaeIdbg8PNaOIdaMgIaIMMaRNaOIdlaeIdlg8RNaOIdCaRNaOId3MgIaIMMa8RNaOIdba8PNaOIdxa8RNaOIdKMgIaIMMa8PNaOId8KMMMhIaya8LcdtfhHarawcltfheaOIdyh8Wa8JhOinaHIdbg8Va8Va8WNaecxfIdbaRaecwfIdbNa8PaeIdbNa8RaeclfIdbNMMMg8Va8VM:tNaIMhIaHclfhHaeczfheaOcufgOmbkaI:lhIka8Za8S:lMh8Za8XaIMh8XaKaQfRbbcd9hmbdnagahaha3fydbaXSEa8Ea3fydbgwcdtfydbg3cu9hmba8EaXcdtfydbh3kavawc8S2fgOIdwaaa3cx2fgeIdwg8VNaOIdzaeIdbgRNaOIdaMg8Sa8SMMa8VNaOIdlaeIdlg8PNaOIdCa8VNaOId3Mg8Sa8SMMa8PNaOIdbaRNaOIdxa8PNaOIdKMg8Sa8SMMaRNaOId8KMMMh8Saya3a8J2g8LcdtfhHarawa8J2gicltfheaOIdyh8Ra8JhOinaHIdbgIaIa8RNaecxfIdba8VaecwfIdbNaRaeIdbNa8PaeclfIdbNMMMgIaIM:tNa8SMh8SaHclfhHaeczfheaOcufgOmbkdndna8FmbJbbbbhIxekava3c8S2fgOIdwaaawcx2fgeIdwgRNaOIdzaeIdbg8PNaOIdaMgIaIMMaRNaOIdlaeIdlg8RNaOIdCaRNaOId3MgIaIMMa8RNaOIdba8PNaOIdxa8RNaOIdKMgIaIMMa8PNaOId8KMMMhIayaicdtfhHara8LcltfheaOIdyh8Wa8JhOinaHIdbg8Va8Va8WNaecxfIdbaRaecwfIdbNa8PaeIdbNa8RaeclfIdbNMMMg8Va8VM:tNaIMhIaHclfhHaeczfheaOcufgOmbkaI:lhIka8Za8S:lMh8Za8XaIMh8XkaAa8Za8Xa8Za8X9FgeEUdwaAaXaQaea8FTVgeEBdlaAaQaXaeEBdbaYcefgYaE9hmbkasc;Wbfcbcj;qbz:ljjjb8Aa6heaEhHinasc;WbfaeydbcA4cF8FGgOcFAaOcFA6EcdtfgOaOydbcefBdbaecxfheaHcufgHmbkcbhecbhHinasc;WbfaefgOydbhAaOaHBdbaAaHfhHaeclfgecj;qb9hmbkcbhea6hHinasc;WbfaHydbcA4cF8FGgOcFAaOcFA6EcdtfgOaOydbgOcefBdbaSaOcdtfaeBdbaHcxfhHaEaecefge9hmbkadak9RgOci9Uh9kdnalTmbcbhea8MhHinaHaeBdbaHclfhHalaecefge9hmbkkcbh0a9hcbalz:ljjjbh5aOcO9Uh9ma9kce4h9nasydwh9ocbh8Kcbh8AdninaDaSa8Acdtfydbcx2fgiIdwg8Sac9Emea8Ka9k9pmeJFFuuhIdna9naE9pmbaDaSa9ncdtfydbcx2fIdwJbb;aZNhIkdna8SaI9ETmba8San9ETmba8Ka9m0mdkdna5aLaiydlgwcdtg9pfydbgAfg9qRbba5aLaiydbg3cdtg9rfydbgefg9sRbbVmbaKa3fRbbh9tdna9eaecdtfgHclfydbgOaHydbgHSmbaOaH9RhQaaaAcx2fhYaaaecx2fh8Fa9oaHcitfhecbhHceh8Ldnindna8MaeydbcdtfydbgOaASmba8MaeclfydbcdtfydbgXaASmbaOaXSmbaaaXcx2fgXIdbaaaOcx2fgOIdbg8V:tg8Sa8FIdlaOIdlgR:tg8WNa8FIdba8V:tg8XaXIdlaR:tgIN:tg8Pa8SaYIdlaR:tg8ZNaYIdba8V:tg80aIN:tgRNaIa8FIdwaOIdwg8R:tg8YNa8WaXIdwa8R:tg8VN:tg8WaIaYIdwa8R:tg81Na8Za8VN:tgINa8Va8XNa8Ya8SN:tg8Ra8Va80Na81a8SN:tg8SNMMa8Pa8PNa8Wa8WNa8Ra8RNMMaRaRNaIaINa8Sa8SNMMN:rJbbj8:N9FmdkaecwfheaHcefgHaQ6h8LaQaH9hmbkka8LceGTmba9ncefh9nxekdndndndna9tc9:fPdebdka3heina8MaecdtgefawBdba8Eaefydbgea39hmbxikkdnagahaha9rfydbawSEa8Ea9rfydbg3cdtfydbgecu9hmba8Ea9pfydbheka8Ma9rfawBdbaehwka8Ma3cdtfawBdbka9sce86bba9qce86bbaiIdwg8Sanana8S9DEhna0cefh0cecda9tceSEa8Kfh8Kka8Acefg8AaE9hmbkka0TmddnalTmbcbhXcbh8Findna8Ma8FcdtgefydbgOa8FSmbaLaOcdtfydbh3dna8FaLaefydb9hgwmbaqa3c8S2fgeaqa8Fc8S2fgHIdbaeIdbMUdbaeaHIdlaeIdlMUdlaeaHIdwaeIdwMUdwaeaHIdxaeIdxMUdxaeaHIdzaeIdzMUdzaeaHIdCaeIdCMUdCaeaHIdKaeIdKMUdKaeaHId3aeId3MUd3aeaHIdaaeIdaMUdaaeaHId8KaeId8KMUd8KaeaHIdyaeIdyMUdyka8JTmbavaOc8S2fgeava8Fc8S2g8LfgHIdbaeIdbMUdbaeaHIdlaeIdlMUdlaeaHIdwaeIdwMUdwaeaHIdxaeIdxMUdxaeaHIdzaeIdzMUdzaeaHIdCaeIdCMUdCaeaHIdKaeIdKMUdKaeaHId3aeId3MUd3aeaHIdaaeIdaMUdaaeaHId8KaeId8KMUd8KaeaHIdyaeIdyMUdya9iaO2hYarhHa8JhAinaHaYfgeaHaXfgOIdbaeIdbMUdbaeclfgQaOclfIdbaQIdbMUdbaecwfgQaOcwfIdbaQIdbMUdbaecxfgeaOcxfIdbaeIdbMUdbaHczfhHaAcufgAmbkawmbJbbbbJbbjZaqa8LfgeIdyg8S:va8SJbbbb9BEaeIdwaaa3cx2fgHIdwg8SNaeIdzaHIdbgINaeIdaMg8Va8VMMa8SNaeIdlaHIdlg8VNaeIdCa8SNaeId3Mg8Sa8SMMa8VNaeIdbaINaeIdxa8VNaeIdKMg8Sa8SMMaINaeId8KMMM:lNg8SaBaBa8S9DEhBkaXa9ifhXa8Fcefg8Fal9hmbkcbhHahheindnaeydbgOcuSmbdnaHa8MaOcdtgAfydbgO9hmbcuhOahaAfydbgAcuSmba8MaAcdtfydbhOkaeaOBdbkaeclfhealaHcefgH9hmbkcbhHagheindnaeydbgOcuSmbdnaHa8MaOcdtgAfydbgO9hmbcuhOagaAfydbgAcuSmba8MaAcdtfydbhOkaeaOBdbkaeclfhealaHcefgH9hmbkkaBana8JEhBcbhAabhecbhQindna8MaeydbcdtfydbgHa8MaeclfydbcdtfydbgOSmbaHa8MaecwfydbcdtfydbgXSmbaOaXSmbabaAcdtfgYaHBdbaYcwfaXBdbaYclfaOBdbaAcifhAkaecxfheaQcifgQad6mbkdndna9cTmbaAak9nmba8UaB9FTmbcbhdabhecbhHindnaoaCaeydbgOcdtfydbcdtfIdbaB9ETmbabadcdtfgQaOBdbaQclfaeclfydbBdbaQcwfaecwfydbBdbadcifhdkaecxfheaHcifgHaA6mbkJFFuuh8UaJTmeaoheaJhHJFFuuh8SinaeIdbgIa8Sa8SaI9EEg8Va8SaIaB9EgOEh8Sa8Va8UaOEh8UaeclfheaHcufgHmbxdkkaAhdkadak0mbxdkkasclfabadalaLz:cjjjbkdndnadak0mbadhOxekdna9cmbadhOxekdna8Uac9FmbadhOxekina8UJbb;aZNg8Saca8Sac9DEh8VJbbbbh8SdnaJTmbaoheaJhHinaeIdbgIa8SaIa8V9FEa8SaIa8S9EEh8SaeclfheaHcufgHmbkkcbhOabhecbhHindnaoaCaeydbgAcdtfydbcdtfIdba8V9ETmbabaOcdtfgQaABdbaQclfaeclfydbBdbaQcwfaecwfydbBdbaOcifhOkaecxfheaHcifgHad6mbkJFFuuh8UdnaJTmbaoheaJhHJFFuuhIinaeIdbgRaIaIaR9EEg8PaIaRa8V9EgAEhIa8Pa8UaAEh8UaeclfheaHcufgHmbkkdnaOad9hmbadhOxdka8Sanana8S9DEhnaOak9nmeaOhda8Uac9FmbkkdnamcjjjjlGTmbazmbaOTmbcbhLabheinaKaeydbgAfRbbc3thXaecwfgYydbhHdndnahaAcdtg3fydbaeclfg8FydbgCSmbcbhQagaCcdtfydbaA9hmekcjjjj94hQkaeaXaQVaAVBdbaKaCfRbbc3thXdndnahaCcdtfydbaHSmbcbhQagaHcdtfydbaC9hmekcjjjj94hQka8FaXaQVaCVBdbaKaHfRbbc3thQdndnahaHcdtfydbaASmbcbhCaga3fydbaH9hmekcjjjj94hCkaYaQaCVaHVBdbaecxfheaLcifgLaO6mbkkdnazTmbaOTmbaOheinabazabydbcdtfydbBdbabclfhbaecufgembkkdnaPTmbaPa83an:rNUdbkasyd2gecdtascxffc98fhHdninaeTmeaHydbcbyd1:jjjbH:bjjjbbaHc98fhHaecufhexbkkasc;W;qbf8KjjjjbaOk;Yieouabydlhvabydbclfcbaicdtz:ljjjbhoadci9UhrdnadTmbdnalTmbaehwadhDinaoalawydbcdtfydbcdtfgqaqydbcefBdbawclfhwaDcufgDmbxdkkaehwadhDinaoawydbcdtfgqaqydbcefBdbawclfhwaDcufgDmbkkdnaiTmbcbhDaohwinawydbhqawaDBdbawclfhwaqaDfhDaicufgimbkkdnadci6mbinaecwfydbhwaeclfydbhDaeydbhidnalTmbalawcdtfydbhwalaDcdtfydbhDalaicdtfydbhikavaoaicdtfgqydbcitfaDBdbavaqydbcitfawBdlaqaqydbcefBdbavaoaDcdtfgqydbcitfawBdbavaqydbcitfaiBdlaqaqydbcefBdbavaoawcdtfgwydbcitfaiBdbavawydbcitfaDBdlawawydbcefBdbaecxfhearcufgrmbkkabydbcbBdbk;Qodvuv998Jjjjjbca9Rgvczfcwfcbyd11jjbBdbavcb8Pdj1jjb83izavcwfcbydN1jjbBdbavcb8Pd:m1jjb83ibdnadTmbaicd4hodnabmbdnalTmbcbhrinaealarcdtfydbao2cdtfhwcbhiinavczfaifgDawaifIdbgqaDIdbgkakaq9EEUdbavaifgDaqaDIdbgkakaq9DEUdbaiclfgicx9hmbkarcefgrad9hmbxikkaocdthrcbhwincbhiinavczfaifgDaeaifIdbgqaDIdbgkakaq9EEUdbavaifgDaqaDIdbgkakaq9DEUdbaiclfgicx9hmbkaearfheawcefgwad9hmbxdkkdnalTmbcbhrinabarcx2fgiaealarcdtfydbao2cdtfgwIdbUdbaiawIdlUdlaiawIdwUdwcbhiinavczfaifgDawaifIdbgqaDIdbgkakaq9EEUdbavaifgDaqaDIdbgkakaq9DEUdbaiclfgicx9hmbkarcefgrad9hmbxdkkaocdthlcbhraehwinabarcx2fgiaearao2cdtfgDIdbUdbaiaDIdlUdlaiaDIdwUdwcbhiinavczfaifgDawaifIdbgqaDIdbgkakaq9EEUdbavaifgDaqaDIdbgkakaq9DEUdbaiclfgicx9hmbkawalfhwarcefgrad9hmbkkJbbbbavIdbavIdzgk:tgqaqJbbbb9DEgqavIdlavIdCgx:tgmamaq9DEgqavIdwavIdKgm:tgPaPaq9DEhPdnabTmbadTmbJbbbbJbbjZaP:vaPJbbbb9BEhqinabaqabIdbak:tNUdbabclfgvaqavIdbax:tNUdbabcwfgvaqavIdbam:tNUdbabcxfhbadcufgdmbkkaPk8MbabaeadaialavcbcbcbcbcbaoarawaDz:bjjjbk8MbabaeadaialavaoarawaDaqakaxamaPz:bjjjbk:DCoDud99rue99iul998Jjjjjbc;Wb9Rgw8KjjjjbdndnarmbcbhDxekawcxfcbc;Kbz:ljjjb8Aawcuadcx2adc;v:Q;v:Qe0Ecbyd:m:jjjbHjjjjbbgqBdxawceBd2aqaeadaicbz:djjjb8AawcuadcdtadcFFFFi0Egkcbyd:m:jjjbHjjjjbbgxBdzawcdBd2adcd4adfhmceheinaegicetheaiam6mbkcbhPawcuaicdtgsaicFFFFi0Ecbyd:m:jjjbHjjjjbbgzBdCawciBd2dndnar:ZgH:rJbbbZMgO:lJbbb9p9DTmbaO:Ohexekcjjjj94hekaicufhAc:bwhmcbhCadhXcbhQinaChLaeamgKcufaeaK9iEaPgDcefaeaD9kEhYdndnadTmbaYcuf:YhOaqhiaxheadhmindndnaiIdbaONJbbbZMg8A:lJbbb9p9DTmba8A:OhCxekcjjjj94hCkaCcCthCdndnaiclfIdbaONJbbbZMg8A:lJbbb9p9DTmba8A:OhExekcjjjj94hEkaEcqtaCVhCdndnaicwfIdbaONJbbbZMg8A:lJbbb9p9DTmba8A:OhExekcjjjj94hEkaeaCaEVBdbaicxfhiaeclfheamcufgmmbkazcFeasz:ljjjbh3cbh5cbhPindna3axaPcdtfydbgCcm4aC7c:v;t;h;Ev2gics4ai7aAGgmcdtfgEydbgecuSmbaeaCSmbcehiina3amaifaAGgmcdtfgEydbgecuSmeaicefhiaeaC9hmbkkaEaCBdba5aecuSfh5aPcefgPad9hmbxdkkazcFeasz:ljjjb8Acbh5kaDaYa5ar0giEhPaLa5aiEhCdna5arSmbaYaKaiEgmaP9Rcd9imbdndnaQcl0mbdnaX:ZgOaL:Zg8A:taY:Yg8EaD:Y:tg8Fa8EaK:Y:tgaa5:ZghaH:tNNNaOaH:taaNa8Aah:tNa8AaH:ta8FNahaO:tNM:va8EMJbbbZMgO:lJbbb9p9DTmbaO:Ohexdkcjjjj94hexekaPamfcd9Theka5aXaiEhXaQcefgQcs9hmekkdndnaCmbcihicbhDxekcbhiawakcbyd:m:jjjbHjjjjbbg5BdKawclBd2aPcuf:Yh8AdndnadTmbaqhiaxheadhmindndnaiIdba8ANJbbbZMgO:lJbbb9p9DTmbaO:OhCxekcjjjj94hCkaCcCthCdndnaiclfIdba8ANJbbbZMgO:lJbbb9p9DTmbaO:OhExekcjjjj94hEkaEcqtaCVhCdndnaicwfIdba8ANJbbbZMgO:lJbbb9p9DTmbaO:OhExekcjjjj94hEkaeaCaEVBdbaicxfhiaeclfheamcufgmmbkazcFeasz:ljjjbh3cbhDcbhYindndndna3axaYcdtgKfydbgCcm4aC7c:v;t;h;Ev2gics4ai7aAGgmcdtfgEydbgecuSmbcehiinaxaecdtgefydbaCSmdamaifheaicefhia3aeaAGgmcdtfgEydbgecu9hmbkkaEaYBdbaDhiaDcefhDxeka5aefydbhika5aKfaiBdbaYcefgYad9hmbkcuaDc32giaDc;j:KM;jb0EhexekazcFeasz:ljjjb8AcbhDcbhekawaecbyd:m:jjjbHjjjjbbgeBd3awcvBd2aecbaiz:ljjjbhEavcd4hKdnadTmbdnalTmbaKcdth3a5hCaqhealhmadhAinaEaCydbc32fgiaeIdbaiIdbMUdbaiaeclfIdbaiIdlMUdlaiaecwfIdbaiIdwMUdwaiamIdbaiIdxMUdxaiamclfIdbaiIdzMUdzaiamcwfIdbaiIdCMUdCaiaiIdKJbbjZMUdKaCclfhCaecxfheama3fhmaAcufgAmbxdkka5hmaqheadhCinaEamydbc32fgiaeIdbaiIdbMUdbaiaeclfIdbaiIdlMUdlaiaecwfIdbaiIdwMUdwaiaiIdxJbbbbMUdxaiaiIdzJbbbbMUdzaiaiIdCJbbbbMUdCaiaiIdKJbbjZMUdKamclfhmaecxfheaCcufgCmbkkdnaDTmbaEhiaDheinaiaiIdbJbbbbJbbjZaicKfIdbgO:vaOJbbbb9BEgONUdbaiclfgmaOamIdbNUdbaicwfgmaOamIdbNUdbaicxfgmaOamIdbNUdbaiczfgmaOamIdbNUdbaicCfgmaOamIdbNUdbaic3fhiaecufgembkkcbhCawcuaDcdtgYaDcFFFFi0Egicbyd:m:jjjbHjjjjbbgeBdaawcoBd2awaicbyd:m:jjjbHjjjjbbg3Bd8KaecFeaYz:ljjjbhxdnadTmbJbbjZJbbjZa8A:vaPceSEaoNgOaONh8AaKcdthPalheina8Aaec;81jjbalEgmIdwaEa5ydbgAc32fgiIdC:tgOaONamIdbaiIdx:tgOaONamIdlaiIdz:tgOaONMMNaqcwfIdbaiIdw:tgOaONaqIdbaiIdb:tgOaONaqclfIdbaiIdl:tgOaONMMMhOdndnaxaAcdtgifgmydbcuSmba3aifIdbaO9ETmekamaCBdba3aifaOUdbka5clfh5aqcxfhqaeaPfheadaCcefgC9hmbkkabaxaYz:kjjjb8AcrhikaicdthiinaiTmeaic98fgiawcxffydbcbyd1:jjjbH:bjjjbbxbkkawc;Wbf8KjjjjbaDk:Ydidui99ducbhi8Jjjjjbca9Rglczfcwfcbyd11jjbBdbalcb8Pdj1jjb83izalcwfcbydN1jjbBdbalcb8Pd:m1jjb83ibdndnaembJbbjFhvJbbjFhoJbbjFhrxekadcd4cdthwincbhdinalczfadfgDabadfIdbgvaDIdbgoaoav9EEUdbaladfgDavaDIdbgoaoav9DEUdbadclfgdcx9hmbkabawfhbaicefgiae9hmbkalIdwalIdK:thralIdlalIdC:thoalIdbalIdz:thvkJbbbbavavJbbbb9DEgvaoaoav9DEgvararav9DEk9DeeuabcFeaicdtz:ljjjbhlcbhbdnadTmbindnalaeydbcdtfgiydbcu9hmbaiabBdbabcefhbkaeclfheadcufgdmbkkabk9teiucbcbyd:q:jjjbgeabcifc98GfgbBd:q:jjjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;teeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiaeydlBdlaiaeydwBdwaiaeydxBdxaeczfheaiczfhiadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk:3eedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdxaialBdwaialBdlaialBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabk9teiucbcbyd:q:jjjbgeabcrfc94GfgbBd:q:jjjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik9:eiuZbhedndncbyd:q:jjjbgdaecztgi9nmbcuheadai9RcFFifcz4nbcuSmekadhekcbabae9Rcifc98Gcbyd:q:jjjbfgdBd:q:jjjbdnadZbcztge9nmbadae9RcFFifcz4nb8Akk6eiucbhidnadTmbdninabRbbglaeRbbgv9hmeaecefheabcefhbadcufgdmbxdkkalav9Rhikaikk:Iedbcjwk1eFFuuFFuuFFuuFFuFFFuFFFuFbbbbbbbbeeebeebebbeeebebbbbbebebbbbbbbbbebbbdbbbbbbbebbbebbbdbbbbbbbbbbbeeeeebebbebbebebbbeebbbbbbbbbbbbbbbbbbbbbc1Dkxebbbdbbb:GNbb".charCodeAt(a);e[a]=i>96?i-97:i>64?i-39:i+4}var s=0;for(a=0;a<21504;++a)e[s++]=e[a]<60?t[e[a]]:64*(e[a]-60)+e[++a];return e.buffer.slice(0,s)}(),{}).then((function(t){(e=t.instance).exports.__wasm_call_ctors()}));function i(e){if(!e)throw new Error("Assertion failed")}function s(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}function r(t,a,i,r,n,o,c,h){var l=e.exports.sbrk,b=l(4*h),d=l(i*r),u=l(i*o),f=new Uint8Array(e.exports.memory.buffer);f.set(s(a),d),n&&f.set(s(n),u);var m=t(b,d,i,r,u,o,c,h);new Uint8Array(e.exports.memory.buffer);var p=new Uint32Array(m);return s(p).set(f.subarray(b,b+4*m)),l(b-l(0)),p}var n={LockBorder:1,Sparse:2,ErrorAbsolute:4,Prune:8,_InternalDebug:1<<30}}(),function(){var e=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};WebAssembly.instantiate(function(){for(var t=new Uint8Array(12765),a=0;a<12765;++a){var i="b9H79TebbbeVx9Geueu9Geub9Gbb9Giuuueu9Gmuuuuuuuuuuu9999eu9Gvuuuuueu9Gwuuuuuuuub9Gxuuuuuuuuuuuueu9Gkuuuuuuuuuu99eu9Gouuuuuub9Gruuuuuuub9GluuuubiOHdilvorwDDqkbiibeilve9Weiiviebeoweuec:q:Odkr:Yewo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9I919P29K9nW79O2Wt79c9V919U9KbeX9TW79O9V9Wt9F9I919P29K9nW79O2Wt7bo39TW79O9V9Wt9F9J9V9T9W91tWJ2917tWV9c9V919U9K7br39TW79O9V9Wt9F9J9V9T9W91tW9nW79O2Wt9c9V919U9K7bDL9TW79O9V9Wt9F9V9Wt9P9T9P96W9nW79O2Wtbql79IV9RbkDwebcekdsPq;29zHdbkIbabaec9:fgefcufae9Ugeabci9Uadfcufad9Ugbaeab0Ek:w8KDPue99eux99dui99euo99iu8Jjjjjbc:WD9Rgm8KjjjjbdndnalmbcbhPxekamc:Cwfcbc;Kbz:njjjb8Adndnalcb9imbaoal9nmbamcuaocdtaocFFFFi0Egscbyd:e1jjbHjjjjbbgzBd:CwamceBd;8wamascbyd:e1jjbHjjjjbbgHBd:GwamcdBd;8wamcualcdtalcFFFFi0Ecbyd:e1jjbHjjjjbbgOBd:KwamciBd;8waihsalhAinazasydbcdtfcbBdbasclfhsaAcufgAmbkaihsalhAinazasydbcdtfgCaCydbcefBdbasclfhsaAcufgAmbkaihsalhCcbhXindnazasydbcdtgQfgAydbcb9imbaHaQfaXBdbaAaAydbgQcjjjj94VBdbaQaXfhXkasclfhsaCcufgCmbkalci9UhLdnalci6mbcbhsaihAinaAcwfydbhCaAclfydbhXaHaAydbcdtfgQaQydbgQcefBdbaOaQcdtfasBdbaHaXcdtfgXaXydbgXcefBdbaOaXcdtfasBdbaHaCcdtfgCaCydbgCcefBdbaOaCcdtfasBdbaAcxfhAaLascefgs9hmbkkaihsalhAindnazasydbcdtgCfgXydbgQcu9kmbaXaQcFFFFrGgQBdbaHaCfgCaCydbaQ9RBdbkasclfhsaAcufgAmbxdkkamcuaocdtgsaocFFFFi0EgAcbyd:e1jjbHjjjjbbgzBd:CwamceBd;8wamaAcbyd:e1jjbHjjjjbbgHBd:GwamcdBd;8wamcualcdtalcFFFFi0Ecbyd:e1jjbHjjjjbbgOBd:KwamciBd;8wazcbasz:njjjbhXalci9UhLaihsalhAinaXasydbcdtfgCaCydbcefBdbasclfhsaAcufgAmbkdnaoTmbcbhsaHhAaXhCaohQinaAasBdbaAclfhAaCydbasfhsaCclfhCaQcufgQmbkkdnalci6mbcbhsaihAinaAcwfydbhCaAclfydbhQaHaAydbcdtfgKaKydbgKcefBdbaOaKcdtfasBdbaHaQcdtfgQaQydbgQcefBdbaOaQcdtfasBdbaHaCcdtfgCaCydbgCcefBdbaOaCcdtfasBdbaAcxfhAaLascefgs9hmbkkaoTmbcbhsaohAinaHasfgCaCydbaXasfydb9RBdbasclfhsaAcufgAmbkkamaLcbyd:e1jjbHjjjjbbgsBd:OwamclBd;8wascbaLz:njjjbhYamcuaLcK2alcjjjjd0Ecbyd:e1jjbHjjjjbbg8ABd:SwamcvBd;8wJbbbbhEdnalci6g3mbarcd4hKaihAa8AhsaLhrJbbbbh5inavaAclfydbaK2cdtfgCIdlh8EavaAydbaK2cdtfgXIdlhEavaAcwfydbaK2cdtfgQIdlh8FaCIdwhaaXIdwhhaQIdwhgasaCIdbg8JaXIdbg8KMaQIdbg8LMJbbnn:vUdbasclfaXIdlaCIdlMaQIdlMJbbnn:vUdbaQIdwh8MaCIdwh8NaXIdwhyascxfa8EaE:tg8Eagah:tggNa8FaE:tg8Faaah:tgaN:tgEJbbbbJbbjZa8Ja8K:tg8Ja8FNa8La8K:tg8Ka8EN:tghahNaEaENaaa8KNaga8JN:tgEaENMM:rg8K:va8KJbbbb9BEg8ENUdbasczfaEa8ENUdbascCfaha8ENUdbascwfa8Maya8NMMJbbnn:vUdba5a8KMh5aAcxfhAascKfhsarcufgrmbka5aL:Z:vJbbbZNhEkamcuaLcdtalcFFFF970Ecbyd:e1jjbHjjjjbbgCBd:WwamcoBd;8waEaq:ZNhEdna3mbcbhsaChAinaAasBdbaAclfhAaLascefgs9hmbkkaE:rhhcuh8PamcuaLcltalcFFFFd0Ecbyd:e1jjbHjjjjbbgIBd:0wamcrBd;8wcbaIa8AaCaLz:djjjb8AJFFuuhyJFFuuh8RJFFuuh8Sdnalci6gXmbJFFuuh8Sa8AhsaLhAJFFuuh8RJFFuuhyinascwfIdbgEayayaE9EEhyasclfIdbgEa8Ra8RaE9EEh8RasIdbgEa8Sa8SaE9EEh8SascKfhsaAcufgAmbkkahJbbbZNhgamaocetgscuaocu9kEcbyd:e1jjbHjjjjbbgABd:4waAcFeasz:njjjbhCdnaXmbcbhAJFFuuhEa8Ahscuh8PinascwfIdbay:tghahNasIdba8S:tghahNasclfIdba8R:tghahNMM:rghaEa8PcuSahaE9DVgXEhEaAa8PaXEh8PascKfhsaLaAcefgA9hmbkkamczfcbcjwz:njjjb8Aamcwf9cb83ibam9cb83ibagaxNhRJbbjZak:th8Ncbh8UJbbbbh8VJbbbbh8WJbbbbh8XJbbbbh8YJbbbbh8ZJbbbbh80cbh81cbhPinJbbbbhEdna8UTmbJbbjZa8U:Z:vhEkJbbbbhhdna80a80Na8Ya8YNa8Za8ZNMMg8KJbbbb9BmbJbbjZa8K:r:vhhka8XaENh5a8WaENh8Fa8VaENhaa8PhQdndndndndna8UaPVTmbamydwgBTmea80ahNh8Ja8ZahNh8La8YahNh8Maeamydbcdtfh83cbh3JFFuuhEcvhXcuhQindnaza83a3cdtfydbcdtgsfydbgvTmbaOaHasfydbcdtfhAindndnaCaiaAydbgKcx2fgsclfydbgrcetf8Vebcs4aCasydbgLcetf8Vebcs4faCascwfydbglcetf8Vebcs4fgombcbhsxekcehsazaLcdtfydbgLceSmbcehsazarcdtfydbgrceSmbcehsazalcdtfydbglceSmbdnarcdSaLcdSfalcdSfcd6mbaocefhsxekaocdfhskdnasaX9kmba8AaKcK2fgLIdwa5:thhaLIdla8F:th8KaLIdbaa:th8EdndnakJbbbb9DTmba8E:lg8Ea8K:lg8Ka8Ea8K9EEg8Kah:lgha8Kah9EEag:vJbbjZMhhxekahahNa8Ea8ENa8Ka8KNMM:rag:va8NNJbbjZMJ9VO:d86JbbjZaLIdCa8JNaLIdxa8MNa8LaLIdzNMMakN:tghahJ9VO:d869DENhhkaKaQasaX6ahaE9DVgLEhQasaXaLEhXahaEaLEhEkaAclfhAavcufgvmbkka3cefg3aB9hmbkkaQcu9hmekama5Ud:ODama8FUd:KDamaaUd:GDamcuBd:qDamcFFF;7rBdjDaIcba8AaYamc:GDfakJbbbb9Damc:qDfamcjDfz:ejjjbamyd:qDhQdndnaxJbbbb9ETmba8UaD6mbaQcuSmeceh3amIdjDaR9EmixdkaQcu9hmekdna8UTmbdnamydlgza8Uci2fgsciGTmbadasfcba8Uazcu7fciGcefz:njjjb8AkabaPcltfgzam8Pib83dbazcwfamcwf8Pib83dbaPcefhPkc3hzinazc98Smvamc:Cwfazfydbcbydj1jjbH:bjjjbbazc98fhzxbkkcbh3a8Uaq9pmbamydwaCaiaQcx2fgsydbcetf8Vebcs4aCascwfydbcetf8Vebcs4faCasclfydbcetf8Vebcs4ffaw9nmekcbhscbhAdna81TmbcbhAamczfhXinamczfaAcdtfaXydbgLBdbaXclfhXaAaYaLfRbbTfhAa81cufg81mbkkamydwhlamydbhXam9cu83i:GDam9cu83i:ODam9cu83i:qDam9cu83i:yDaAc;8eaAclfc:bd6Eh81inamcjDfasfcFFF;7rBdbasclfgscz9hmbka81cdthBdnalTmbaeaXcdtfhocbhrindnazaoarcdtfydbcdtgsfydbgvTmbaOaHasfydbcdtfhAcuhLcuhsinazaiaAydbgKcx2fgXclfydbcdtfydbazaXydbcdtfydbfazaXcwfydbcdtfydbfgXasaXas6gXEhsaKaLaXEhLaAclfhAavcufgvmbkaLcuSmba8AaLcK2fgAIdway:tgEaENaAIdba8S:tgEaENaAIdla8R:tgEaENMM:rhEcbhAindndnasamc:qDfaAfgvydbgX6mbasaX9hmeaEamcjDfaAfIdb9FTmekavasBdbamc:GDfaAfaLBdbamcjDfaAfaEUdbxdkaAclfgAcz9hmbkkarcefgral9hmbkkamczfaBfhLcbhscbhAindnamc:GDfasfydbgXcuSmbaLaAcdtfaXBdbaAcefhAkasclfgscz9hmbkaAa81fg81TmbJFFuuhhcuhKamczfhsa81hvcuhLina8AasydbgXcK2fgAIdway:tgEaENaAIdba8S:tgEaENaAIdla8R:tgEaENMM:rhEdndnazaiaXcx2fgAclfydbcdtfydbazaAydbcdtfydbfazaAcwfydbcdtfydbfgAaL6mbaAaL9hmeaEah9DTmekaEhhaAhLaXhKkasclfhsavcufgvmbkaKcuSmbaKhQkdnamaiaQcx2fgrydbarclfydbarcwfydbaCabaeadaPawaqa3z:fjjjbTmbaPcefhPJbbbbh8VJbbbbh8WJbbbbh8XJbbbbh8YJbbbbh8ZJbbbbh80kcbhXinaOaHaraXcdtfydbcdtgAfydbcdtfgKhsazaAfgvydbgLhAdnaLTmbdninasydbaQSmeasclfhsaAcufgATmdxbkkasaKaLcdtfc98fydbBdbavavydbcufBdbkaXcefgXci9hmbka8AaQcK2fgsIdbhEasIdlhhasIdwh8KasIdxh8EasIdzh5asIdCh8FaYaQfce86bba80a8FMh80a8Za5Mh8Za8Ya8EMh8Ya8Xa8KMh8Xa8WahMh8Wa8VaEMh8Vamydxh8Uxbkkamc:WDf8KjjjjbaPk;Vvivuv99lu8Jjjjjbca9Rgv8Kjjjjbdndnalcw0mbaiydbhoaeabcitfgralcdtcufBdlaraoBdbdnalcd6mbaiclfhoalcufhwarcxfhrinaoydbhDarcuBdbarc98faDBdbarcwfhraoclfhoawcufgwmbkkalabfhrxekcbhDavczfcwfcbBdbav9cb83izavcwfcbBdbav9cb83ibJbbjZhqJbbjZhkinadaiaDcdtfydbcK2fhwcbhrinavczfarfgoawarfIdbgxaoIdbgm:tgPakNamMgmUdbavarfgoaPaxam:tNaoIdbMUdbarclfgrcx9hmbkJbbjZaqJbbjZMgq:vhkaDcefgDal9hmbkcbhoadcbcecdavIdlgxavIdwgm9GEgravIdbgPam9GEaraPax9GEgscdtgrfhzavczfarfIdbhxaihralhwinaiaocdtfgDydbhHaDarydbgOBdbaraHBdbarclfhraoazaOcK2fIdbax9Dfhoawcufgwmbkaeabcitfhrdndnaocv6mbaoalc98f6mekaraiydbBdbaralcdtcufBdlaiclfhoalcufhwarcxfhrinaoydbhDarcuBdbarc98faDBdbarcwfhraoclfhoawcufgwmbkalabfhrxekaraxUdbararydlc98GasVBdlabcefaeadaiaoz:djjjbhwararydlciGawabcu7fcdtVBdlawaeadaiaocdtfalao9Rz:djjjbhrkavcaf8Kjjjjbark:;idiud99dndnabaecitfgwydlgDciGgqciSmbinabcbaDcd4gDalaqcdtfIdbawIdb:tgkJbbbb9FEgwaecefgefadaialavaoarz:ejjjbak:larIdb9FTmdabawaD7aefgecitfgwydlgDciGgqci9hmbkkabaecitfgeclfhbdnavmbcuhwindnaiaeydbgDfRbbmbadaDcK2fgqIdwalIdw:tgkakNaqIdbalIdb:tgkakNaqIdlalIdl:tgkakNMM:rgkarIdb9DTmbarakUdbaoaDBdbkaecwfheawcefgwabydbcd46mbxdkkcuhwindnaiaeydbgDfRbbmbadaDcK2fgqIdbalIdb:t:lgkaqIdlalIdl:t:lgxakax9EEgkaqIdwalIdw:t:lgxakax9EEgkarIdb9DTmbarakUdbaoaDBdbkaecwfheawcefgwabydbcd46mbkkk;llevudnabydwgxaladcetfgm8Vebcs4alaecetfgP8Vebgscs4falaicetfgz8Vebcs4ffaD0abydxaq9pVakVgDce9hmbavawcltfgxab8Pdb83dbaxcwfabcwfgx8Pdb83dbdnaxydbgqTmbaoabydbcdtfhxaqhsinalaxydbcetfcFFi87ebaxclfhxascufgsmbkkdnabydxglci2gsabydlgxfgkciGTmbarakfcbalaxcu7fciGcefz:njjjb8Aabydxci2hsabydlhxabydwhqkab9cb83dwababydbaqfBdbabascifc98GaxfBdlaP8Vebhscbhxkdnascztcz91cu9kmbabaxcefBdwaPax87ebaoabydbcdtfaxcdtfaeBdbkdnam8Uebcu9kmbababydwgxcefBdwamax87ebaoabydbcdtfaxcdtfadBdbkdnaz8Uebcu9kmbababydwgxcefBdwazax87ebaoabydbcdtfaxcdtfaiBdbkarabydlfabydxci2faPRbb86bbarabydlfabydxci2fcefamRbb86bbarabydlfabydxci2fcdfazRbb86bbababydxcefBdxaDk8LbabaeadaialavaoarawaDaDaqJbbbbz:cjjjbk;Jkovud99euv99eul998Jjjjjbc:W;ae9Rgo8KjjjjbdndnadTmbavcd4hrcbhwcbhDindnaiaeclfydbar2cdtfgvIdbaiaeydbar2cdtfgqIdbgk:tgxaiaecwfydbar2cdtfgmIdlaqIdlgP:tgsNamIdbak:tgzavIdlaP:tgPN:tgkakNaPamIdwaqIdwgH:tgONasavIdwaH:tgHN:tgPaPNaHazNaOaxN:tgxaxNMM:rgsJbbbb9Bmbaoc:W:qefawcx2fgAakas:vUdwaAaxas:vUdlaAaPas:vUdbaoc8Wfawc8K2fgAaq8Pdb83dbaAav8Pdb83dxaAam8Pdb83dKaAcwfaqcwfydbBdbaAcCfavcwfydbBdbaAcafamcwfydbBdbawcefhwkaecxfheaDcifgDad6mbkab9cb83dbabcyf9cb83dbabcaf9cb83dbabcKf9cb83dbabczf9cb83dbabcwf9cb83dbawTmeaocbBd8Sao9cb83iKao9cb83izaoczfaoc8Wfawci2cxaoc8Sfcbz1jjjbaoIdKhCaoIdChXaoIdzhQao9cb83iwao9cb83ibaoaoc:W:qefawcxaoc8Sfcbz1jjjbJbbjZhkaoIdwgPJbbbbJbbjZaPaPNaoIdbgPaPNaoIdlgsasNMM:rgx:vaxJbbbb9BEgzNhxasazNhsaPazNhzaoc:W:qefheawhvinaecwfIdbaxNaeIdbazNasaeclfIdbNMMgPakaPak9DEhkaecxfheavcufgvmbkabaCUdwabaXUdlabaQUdbabaoId3UdxdndnakJ;n;m;m899FmbJbbbbhPaoc:W:qefheaoc8WfhvinaCavcwfIdb:taecwfIdbgHNaQavIdb:taeIdbgONaXavclfIdb:taeclfIdbgLNMMaxaHNazaONasaLNMM:vgHaPaHaP9EEhPavc8KfhvaecxfheawcufgwmbkabaxUd8KabasUdaabazUd3abaCaxaPN:tUdKabaXasaPN:tUdCabaQazaPN:tUdzabJbbjZakakN:t:rgkUdydndnaxJbbj:;axJbbj:;9GEgPJbbjZaPJbbjZ9FEJbb;:9cNJbbbZJbbb:;axJbbbb9GEMgP:lJbbb9p9DTmbaP:Ohexekcjjjj94hekabae86b8UdndnasJbbj:;asJbbj:;9GEgPJbbjZaPJbbjZ9FEJbb;:9cNJbbbZJbbb:;asJbbbb9GEMgP:lJbbb9p9DTmbaP:Ohvxekcjjjj94hvkabav86bRdndnazJbbj:;azJbbj:;9GEgPJbbjZaPJbbjZ9FEJbb;:9cNJbbbZJbbb:;azJbbbb9GEMgP:lJbbb9p9DTmbaP:Ohqxekcjjjj94hqkabaq86b8SdndnaecKtcK91:YJbb;:9c:vax:t:lavcKtcK91:YJbb;:9c:vas:t:laqcKtcK91:YJbb;:9c:vaz:t:lakMMMJbb;:9cNJbbjZMgk:lJbbb9p9DTmbak:Ohexekcjjjj94hekaecFbaecFb9iEhexekabcjjj;8iBdycFbhekabae86b8Vxekab9cb83dbabcyf9cb83dbabcaf9cb83dbabcKf9cb83dbabczf9cb83dbabcwf9cb83dbkaoc:W;aef8Kjjjjbk;Yodouk99cbho8Jjjjjbca9RgrczfcwfcbBdbar9cb83izarcwfcbBdbar9cb83ibavcd4hwaicd4hDdnadTmbaDcdthqaehkinalaoaw2cdtfIdbhxcbhvinarczfavfgiaoaiydbgiakavfIdbgmax:taeavaqai2ffIdbalaiaw2cdtfIdb:t9DEBdbaravfgiaoaiydbgiaxamMaeavaqai2ffIdbalaiaw2cdtfIdbM9EEBdbavclfgvcx9hmbkakaqfhkaocefgoad9hmbkkJbbbbhxcbhvcbhkcbhiinalaravfydbgoaw2cdtfIdbalarczfavfydbgqaw2cdtfIdbaeaoaD2cdtfgoIdwaeaqaD2cdtfgqIdw:tgmamNaoIdbaqIdb:tgmamNaoIdlaqIdl:tgmamNMM:rMMgmaxamax9EgoEhxaiakaoEhkavclfhvaicefgici9hmbkJbbbbhmdnaearakcdtgifydbgoaD2cdtfgvIdwaearczfaifydbgraD2cdtfgiIdwgP:tgsasNavIdbaiIdbgz:tgHaHNavIdlaiIdlgO:tgAaANMM:rgCJbbbb9ETmbaCalaoaw2cdtfIdbMalaraw2cdtfIdb:taCaCM:vhmkaxJbbbZNhCasamNaPMhPaAamNaOMhOaHamNazMhzdnadTmbaDcdthvawcdthiindnalIdbgXaecwfIdbaP:tgxaxNaeIdbaz:tgmamNaeclfIdbaO:tgsasNMM:rgHMgQaC9ETmbJbbbbhAdnaHJbbbb9ETmbaQaC:taHaHM:vhAkaAaxNaPMhPaAasNaOMhOaAamNazMhzaXaCaHMMJbbbZNhCkaeavfhealaifhladcufgdmbkkabaCUdxabaPUdwabaOUdlabazUdbkjeeiu8Jjjjjbcj8W9Rgr8Kjjjjbaici2hwdnaiTmbawceawce0EhDarhiinaiaeadRbbcdtfydbBdbadcefhdaiclfhiaDcufgDmbkkabarawaladaoz:hjjjbarcj8Wf8Kjjjjbk:3lequ8JjjjjbcjP9Rgl8Kjjjjbcbhvalcjxfcbaiz:njjjb8AdndnadTmbcjehoaehrincuhwarhDcuhqavhkdninawakaoalcjxfaDcefRbbfRbb9RcFeGci6aoalcjxfaDRbbfRbb9RcFeGci6faoalcjxfaDcdfRbbfRbb9RcFeGci6fgxaq9mgmEhwdnammbaxce0mdkaxaqaxaq9kEhqaDcifhDadakcefgk9hmbkkaeawci2fgDcdfRbbhqaDcefRbbhxaDRbbhkaeavci2fgDcifaDawav9Rci2z:qjjjb8Aakalcjxffaocefgo86bbaxalcjxffao86bbaDcdfaq86bbaDcefax86bbaDak86bbaqalcjxffao86bbarcifhravcefgvad9hmbkalcFeaicetz:njjjbhoadci2gDceaDce0EhqcbhxindnaoaeRbbgkcetfgw8UebgDcu9kmbawax87ebaocjlfaxcdtfabakcdtfydbBdbaxhDaxcefhxkaeaD86bbaecefheaqcufgqmbkaxcdthDxekcbhDkabalcjlfaDz:mjjjb8AalcjPf8Kjjjjbk9teiucbcbyd11jjbgeabcifc98GfgbBd11jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;teeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiaeydlBdlaiaeydwBdwaiaeydxBdxaeczfheaiczfhiadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk:3eedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdxaialBdwaialBdlaialBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabk9teiucbcbyd11jjbgeabcrfc94GfgbBd11jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik9:eiuZbhedndncbyd11jjbgdaecztgi9nmbcuheadai9RcFFifcz4nbcuSmekadhekcbabae9Rcifc98Gcbyd11jjbfgdBd11jjbdnadZbcztge9nmbadae9RcFFifcz4nb8Akk:;Deludndndnadch9pmbabaeSmdaeabadfgi9Rcbadcet9R0mekabaead;8qbbxekaeab7ciGhldndndnabae9pmbdnalTmbadhvabhixikdnabciGmbadhvabhixdkadTmiabaeRbb86bbadcufhvdnabcefgiciGmbaecefhexdkavTmiabaeRbe86beadc9:fhvdnabcdfgiciGmbaecdfhexdkavTmiabaeRbd86bdadc99fhvdnabcifgiciGmbaecifhexdkavTmiabaeRbi86biabclfhiaeclfheadc98fhvxekdnalmbdnaiciGTmbadTmlabadcufgifglaeaifRbb86bbdnalciGmbaihdxekaiTmlabadc9:fgifglaeaifRbb86bbdnalciGmbaihdxekaiTmlabadc99fgifglaeaifRbb86bbdnalciGmbaihdxekaiTmlabadc98fgdfaeadfRbb86bbkadcl6mbdnadc98fgocd4cefciGgiTmbaec98fhlabc98fhvinavadfaladfydbBdbadc98fhdaicufgimbkkaocx6mbaec9Wfhvabc9WfhoinaoadfgicxfavadfglcxfydbBdbaicwfalcwfydbBdbaiclfalclfydbBdbaialydbBdbadc9Wfgdci0mbkkadTmdadhidnadciGglTmbaecufhvabcufhoadhiinaoaifavaifRbb86bbaicufhialcufglmbkkadcl6mdaec98fhlabc98fhvinavaifgecifalaifgdcifRbb86bbaecdfadcdfRbb86bbaecefadcefRbb86bbaeadRbb86bbaic98fgimbxikkavcl6mbdnavc98fglcd4cefcrGgdTmbavadcdt9RhvinaiaeydbBdbaeclfheaiclfhiadcufgdmbkkalc36mbinaiaeydbBdbaiaeydlBdlaiaeydwBdwaiaeydxBdxaiaeydzBdzaiaeydCBdCaiaeydKBdKaiaeyd3Bd3aecafheaicafhiavc9Gfgvci0mbkkavTmbdndnavcrGgdmbavhlxekavc94GhlinaiaeRbb86bbaicefhiaecefheadcufgdmbkkavcw6mbinaiaeRbb86bbaiaeRbe86beaiaeRbd86bdaiaeRbi86biaiaeRbl86blaiaeRbv86bvaiaeRbo86boaiaeRbr86braicwfhiaecwfhealc94fglmbkkabkkAebcjwkxebbbdbbbzNbb".charCodeAt(a);t[a]=i>96?i-97:i>64?i-39:i+4}var s=0;for(a=0;a<12765;++a)t[s++]=t[a]<60?e[t[a]]:64*(t[a]-60)+t[++a];return t.buffer.slice(0,s)}(),{}).then((function(e){e.instance.exports.__wasm_call_ctors()}))}();class un extends t.BufferGeometry{constructor(e=3){super();const i=A.rand,s=A.torad;let r=new t.PlaneGeometry;r.translate(0,.5,0);const n=[];let o,c,h=360/e;for(let t=0;t<e;t++)o=r.clone(),o.translate(i(-.2,.2),0,i(-.2,.2)),o.rotateX(i(-22,22)*s),o.rotateY((h*t+i(-10,10))*s),c=i(.8,1.2),o.scale(c,c,c),n.push(o);let l=a.mergeVertices(a.mergeGeometries(n));this.copy(l)}}t.BatchedMesh.prototype.computeBVH=zr,t.BatchedMesh.prototype.onBeforeRender=Gr,t.BatchedMesh.prototype.frustumCulling=Hr,t.BatchedMesh.prototype.updateIndexArray=_r,t.BatchedMesh.prototype.updateRenderList=Nr,t.BatchedMesh.prototype.BVHCulling=Ur,t.BatchedMesh.prototype.linearCulling=Kr,t.BatchedMesh.prototype.getPositionAt=Wr,t.BatchedMesh.prototype.getPositionAndMaxScaleOnAxisAt=Xr,t.BatchedMesh.prototype.applyMatrixAtToSphere=Qr,t.BatchedMesh.prototype.addGeometryLOD=Yr,t.BatchedMesh.prototype.getLODIndex=Zr,t.BatchedMesh.prototype.raycast=nn,t.BatchedMesh.prototype.checkInstanceIntersection=on,t.BatchedMesh.prototype.getUniformAt=cn,t.BatchedMesh.prototype.setUniformAt=hn,t.BatchedMesh.prototype.initUniformsPerInstance=ln,t.Mesh.prototype.raycast=function(e,t){this.isBatchedMesh?nr.call(this,e,t):or.call(this,e,t)},t.BatchedMesh.prototype.computeBoundsTree=function(e=-1,t={}){if(!Ys)throw new Error("BatchedMesh: Three r166+ is required to compute bounds trees.");t.indirect&&console.warn('"Indirect" is set to false because it is not supported for BatchedMesh.'),t={...t,indirect:!1,range:null};const a=this._drawRanges||this._geometryInfo,i=this._geometryCount;this.boundsTrees||(this.boundsTrees=new Array(i).fill(null));const s=this.boundsTrees;for(;s.length<i;)s.push(null);if(e<0){for(let e=0;e<i;e++)t.range=a[e],s[e]=new Xs(this.geometry,t);return s}return e<a.length&&(t.range=a[e],s[e]=new Xs(this.geometry,t)),s[e]||null};const fn=new t.Vector3,mn=new t.Euler,pn=new t.Quaternion,gn=new t.Vector3;class yn{constructor(e={},t){this.motor=t,this.ids=[],this.useLod=!0,this.maxVertex=0,this.maxIndex=0,this.initGeometries(),this.initBatchedMesh()}initGeometries(){if(this.geometriesLOD=[],this.geo=[new un,new un,new un,new un,new un],this.useLod){for(let e=0;e<this.geo.length;e++)this.geometriesLOD.push([this.geo[e],new un(2),new un(1)]);let{vertexCount:e,indexCount:t,LODIndexCount:a}=function(e){const t=[];let a=0,i=0;for(const s of e){let e=0;for(const t of s){const s=t.index.count;i+=s,e+=s,a+=t.attributes.position.count}t.push(e)}return{vertexCount:a,indexCount:i,LODIndexCount:t}}(this.geometriesLOD);this.vertexCount=e,this.indexCount=t,this.LODIndexCount=a}else{let{vertexCount:e,indexCount:t}=function(e){let t=0,a=0;for(const i of e)t+=i.attributes.position.count,a+=i.index.count;return{vertexCount:t,indexCount:a}}(this.geo);this.vertexCount=e,this.indexCount=t}console.log(this.vertexCount,this.indexCount)}createMaterial(){return this.material||(this.material=new t.MeshStandardMaterial({side:t.DoubleSide,alphaTest:.6,roughness:1}),this.material.map=this.motor.texture({url:"./assets/textures/plante/grass_c.jpg",flipY:!0,encoding:!0}),this.material.alphaMap=this.motor.texture({url:"./assets/textures/plante/grass_a.jpg",flipY:!0,encoding:!1}),this.material.normalMap=this.motor.texture({url:"./assets/textures/plante/grass_n.jpg",flipY:!0,encoding:!1}),this.material.aoMap=this.motor.texture({url:"./assets/textures/plante/grass_ao.jpg",flipY:!0,encoding:!1}),this.material.roughnessMap=this.motor.texture({url:"./assets/textures/plante/grass_r.jpg",flipY:!0,encoding:!1})),this.material}randomizeMatrix(e){return fn.x=40*Math.random()-20,fn.z=40*Math.random()-20,mn.y=2*Math.random()*Math.PI,pn.setFromEuler(mn),gn.x=gn.y=gn.z=.5+.5*Math.random(),e.compose(fn,pn,gn)}initBatchedMesh(){new t.Euler;const e=new t.Matrix4;let a=new t.BatchedMesh(16e3,this.vertexCount,this.indexCount,this.createMaterial());if(a.customSort=function(e){const t={get:e=>e.zSort,aux:new Array(e.maxInstanceCount),reversed:null};return function(a){t.reversed=e.material.transparent,e.maxInstanceCount>t.aux.length&&(t.aux.length=e.maxInstanceCount);let i=1/0,s=-1/0;for(const{z:e}of a)e>s&&(s=e),e<i&&(i=e);const r=(2**32-1)/(s-i);for(const e of a)e.zSort=(e.z-i)*r;f.radixSort(a,t)}}(a),this.useLod)for(let e=0;e<this.geometriesLOD.length;e++){const t=this.geometriesLOD[e],i=a.addGeometry(t[0],-1,this.LODIndexCount[e]);a.addGeometryLOD(i,t[1],15),a.addGeometryLOD(i,t[2],20)}else this.geometryIds=[a.addGeometry(this.geo[0]),a.addGeometry(this.geo[1]),a.addGeometry(this.geo[2])];this.ids.length=0;for(let t=0;t<16e3;t++){let i;i=this.useLod?a.addInstance(Math.floor(Math.random()*this.geometriesLOD.length)):a.addInstance(this.geometryIds[t%this.geometryIds.length]),a.setMatrixAt(i,this.randomizeMatrix(e)),this.ids.push(i)}a.computeBVH(t.WebGLCoordinateSystem,{margin:0}),a.raycast=()=>{},a.castShadow=!0,a.receiveShadow=!1,this.motor.scenePlus.add(a)}}class xn extends t.BufferGeometry{constructor(e=1,i=1,s=1,r=.01,n=1,o=1,c=1,h=2){super(),this.type="ChamferBox",n=Math.floor(n),o=Math.floor(o),c=Math.floor(c),h=Math.floor(h);let l=Math.PI,b=.5*l,d=2*r,u=.5*e,f=.5*i,m=.5*s,p=new t.Matrix4,g=new t.Matrix4,y=new t.Matrix4,x=r/e,w=1-2*x,v=r/i,k=1-2*x,j=r/s,M=1-2*j,A=new t.PlaneGeometry(e-d,i-d,n,o),S=new t.CylinderGeometry(r,r,e-d,h,n,!0,0,b),E=new t.CylinderGeometry(r,r,i-d,h,o,!0,0,b),F=new wn(r,h,h,0,b,0,-b),z=new wn(r,h,h,0,b,0,-b);vn(A,-x,v,w,k),vn(S,0,x,v,w),g.makeTranslation(0,f-r,0),p.makeRotationX(b),F.applyMatrix4(g.multiply(p)),g.makeTranslation(0,-f+r,0),p.makeRotationX(b),y.makeRotationY(-b),z.applyMatrix4(g.multiply(p).multiply(y));let R=a.mergeGeometries([E,F,z]),P=R.clone();g.makeTranslation(u-r,0,-r),R.applyMatrix4(g),g.makeTranslation(-u+r,0,-r),p.makeRotationZ(l),P.applyMatrix4(g.multiply(p));let T=S.clone();p.makeRotationZ(b),g.makeTranslation(0,f-r,-r),S.applyMatrix4(g.multiply(p)),g.makeTranslation(0,-f+r,-r),p.makeRotationZ(-b),T.applyMatrix4(g.multiply(p));let I=a.mergeGeometries([S,T,A,R,P]),B=I.clone();g.makeTranslation(0,0,m),I.applyMatrix4(g),g.makeTranslation(0,0,-m),p.makeRotationY(l),B.applyMatrix4(g.multiply(p)),A=new t.PlaneGeometry(s-d,i-d,c,o),S=new t.CylinderGeometry(r,r,s-d,h,c,!0,0,b),T=S.clone(),vn(A,-j,v,M,k),g.makeTranslation(0,-(f-r),-r,0),p.makeRotationZ(-b),S.applyMatrix4(g.multiply(p)),g.makeTranslation(0,f-r,-r,0),p.makeRotationZ(b),T.applyMatrix4(g.multiply(p));let C=a.mergeGeometries([S,T,A]),D=C.clone();g.makeTranslation(-u,0,0),p.makeRotationY(-b),C.applyMatrix4(g.multiply(p)),g.makeTranslation(u,0,0),p.makeRotationY(b),D.applyMatrix4(g.multiply(p)),A=new t.PlaneGeometry(e-d,s-d,n,c),vn(A,-x,j,w,M);let L=A.clone();g.makeTranslation(0,f,0),p.makeRotationX(-b),A.applyMatrix4(g.multiply(p)),g.makeTranslation(0,-f,0),p.makeRotationX(b),L.applyMatrix4(g.multiply(p));let O=a.mergeVertices(a.mergeGeometries([I,B,C,D,A,L]));!function(e,a="sphere",i,s=[0,0,0],r=[0,0,0,1],n){void 0===n&&(n=new t.Matrix4);if(n.compose({x:s[0],y:s[1],z:s[2]},{_x:r[0],_y:r[1],_z:r[2],_w:r[3]},{x:1,y:1,z:1}),void 0===i){e.boundingBox||e.computeBoundingBox();let t=e.boundingBox;i=Math.max(t.max.x-t.min.x,t.max.y-t.min.y,t.max.z-t.min.z)}let o=new t.Box3(new t.Vector3(-i/2,-i/2,-i/2),new t.Vector3(i/2,i/2,i/2)),c=[];c.length=2*e.attributes.position.count,void 0===e.attributes.uv&&e.setAttribute("uv",new t.Float32BufferAttribute(c,2));let h,l,b,d,u,f=function(e,a,i){e.applyMatrix4(n),a.applyMatrix4(n),i.applyMatrix4(n);let s=1/(2*Math.PI),r=1/Math.PI;return e.normalize(),a.normalize(),i.normalize(),{uv0:new t.Vector2(.5-Math.atan(e.z,-e.x)*s,.5-Math.asin(e.y)*r),uv1:new t.Vector2(.5-Math.atan(a.z,-a.x)*s,.5-Math.asin(a.y)*r),uv2:new t.Vector2(.5-Math.atan(i.z,-i.x)*s,.5-Math.asin(i.y)*r)}},m=function(e,a,s){e.applyMatrix4(n),a.applyMatrix4(n),s.applyMatrix4(n);let r=new t.Vector3;r.crossVectors(a.clone().sub(e),a.clone().sub(s)).normalize(),r.x<0||r.y<0||r.z,r.x=Math.abs(r.x),r.y=Math.abs(r.y),r.z=Math.abs(r.z);let c=new t.Vector2,h=new t.Vector2,l=new t.Vector2,b=1/i;return r.y>r.x&&r.y>r.z?(c.set(e.x-o.min.x,o.max.z-e.z).multiplyScalar(b),h.set(a.x-o.min.x,o.max.z-a.z).multiplyScalar(b),l.set(s.x-o.min.x,o.max.z-s.z).multiplyScalar(b)):r.x>r.y&&r.x>r.z?(c.set(e.z-o.min.z,e.y-o.min.y).multiplyScalar(b),h.set(a.z-o.min.z,a.y-o.min.y).multiplyScalar(b),l.set(s.z-o.min.z,s.y-o.min.y).multiplyScalar(b)):r.z>r.y&&r.z>r.x&&(c.set(e.x-o.min.x,e.y-o.min.y).multiplyScalar(b),h.set(a.x-o.min.x,a.y-o.min.y).multiplyScalar(b),l.set(s.x-o.min.x,s.y-o.min.y).multiplyScalar(b)),{uv0:c,uv1:h,uv2:l}},p=new t.Vector3,g=new t.Vector3,y=new t.Vector3;new t.Vector3,new t.Vector3,new t.Vector3;const x=e.getAttribute("position");if(e.getAttribute("normal"),e.index)for(h=0;h<e.index.count;h+=3)l=e.index.getX(h+0),b=e.index.getX(h+1),d=e.index.getX(h+2),p.fromBufferAttribute(x,l),g.fromBufferAttribute(x,b),y.fromBufferAttribute(x,d),u="sphere"===a?f(p,g,y):m(p,g,y),c[2*l]=u.uv0.x,c[2*l+1]=u.uv0.y,c[2*b]=u.uv1.x,c[2*b+1]=u.uv1.y,c[2*d]=u.uv2.x,c[2*d+1]=u.uv2.y;else for(h=0;h<x.count;h+=3){p.fromBufferAttribute(x,h+0),g.fromBufferAttribute(x,h+1),y.fromBufferAttribute(x,h+2),u="sphere"===a?f(p,g,y):m(p,g,y);let e=h,t=h+1,i=h+2;c[2*e]=u.uv0.x,c[2*e+1]=u.uv0.y,c[2*t]=u.uv1.x,c[2*t+1]=u.uv1.y,c[2*i]=u.uv2.x,c[2*i+1]=u.uv2.y}e.attributes.uv.array=new Float32Array(c),e.attributes.uv.needsUpdate=!0}(O,"box"),this.copy(O)}}class wn extends t.BufferGeometry{constructor(e=1,a=8,i=6,s=0,r=2*Math.PI,n=0,o=Math.PI){super(),this.type="SphereGeometryFix",this.parameters={radius:e,widthSegments:a,heightSegments:i,phiStart:s,phiLength:r,thetaStart:n,thetaLength:o},a=Math.floor(a),i=Math.floor(i);const c=Math.min(n+o,Math.PI);let h=0;const l=[],b=new t.Vector3,d=new t.Vector3,u=[],f=[],m=[],p=[];for(let t=0;t<=i;t++){const u=[],g=t/i;let y=0;0==t&&0==n?y=.5/a:t==i&&c==Math.PI&&(y=-.5/a);for(let t=0;t<=a;t++){const i=t/a;b.x=-e*Math.cos(s+i*r)*Math.sin(n+g*o),b.y=e*Math.cos(n+g*o),b.z=e*Math.sin(s+i*r)*Math.sin(n+g*o),f.push(b.x,b.y,b.z),d.copy(b).normalize(),m.push(d.x,d.y,d.z),p.push(i+y,1-g),u.push(h++)}l.push(u)}for(let e=0;e<i;e++)for(let t=0;t<a;t++){const a=l[e][t+1],s=l[e][t],r=l[e+1][t],o=l[e+1][t+1];(0!==e||n>0)&&u.push(a,s,o),(e!==i-1||c<Math.PI)&&u.push(s,r,o)}this.setIndex(u),this.setAttribute("position",new t.Float32BufferAttribute(f,3)),this.setAttribute("normal",new t.Float32BufferAttribute(m,3)),this.setAttribute("uv",new t.Float32BufferAttribute(p,2))}}function vn(e,t=0,a=0,i=1,s=1,r){let n=e.attributes.uv,o=n.array,c=n.count,h=0;for(;c--;)h=2*c,o[h]=o[h]*i-t,o[h+1]=o[h+1]*s+a}const kn=new t.Box3;class jn extends t.LineSegments{constructor(e,a=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Float32Array(24);let r=new t.Color(a),n=[],o=8;for(;o--;)n.push(r.r,r.g,r.b);const c=new Float32Array(n),h=new t.BufferGeometry;h.setIndex(new t.BufferAttribute(i,1)),h.setAttribute("position",new t.BufferAttribute(s,3)),h.setAttribute("color",new t.BufferAttribute(c,3)),super(h,new t.LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&kn.setFromObject(this.object),kn.isEmpty())return;const t=kn.min,a=kn.max,i=this.geometry.attributes.position,s=i.array;s[0]=a.x,s[1]=a.y,s[2]=a.z,s[3]=t.x,s[4]=a.y,s[5]=a.z,s[6]=t.x,s[7]=t.y,s[8]=a.z,s[9]=a.x,s[10]=t.y,s[11]=a.z,s[12]=a.x,s[13]=a.y,s[14]=t.z,s[15]=t.x,s[16]=a.y,s[17]=t.z,s[18]=t.x,s[19]=t.y,s[20]=t.z,s[21]=a.x,s[22]=t.y,s[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Mn{constructor(e={},t){this.motor=t,this.isCompound=!0,this.remplace=e.remplace||!1,this.init(e)}init(e={}){const a=e.intern||!1;let i=e.size||[5,3,8],s=e.pos||[0,2,0],r=e.wall||.1;void 0!==e.size[3]&&(r=e.size[3]),r<=0&&(r=.01);let n=.5*r,o=2*r;e.face||(e.face={});let c={up:1,down:1,left:1,right:1,front:1,back:1,...e.face};delete e.face;const h=[];a?(1===c.up&&h.push({pos:[0,.5*i[1]+n,0],size:[i[0]+o,r,i[2]+o]}),1===c.down&&h.push({pos:[0,-n-.5*i[1],0],size:[i[0]+o,r,i[2]+o]}),1===c.left&&h.push({pos:[-n-.5*i[0],0,0],size:[r,i[1],i[2]]}),1===c.right&&h.push({pos:[.5*i[0]+n,0,0],size:[r,i[1],i[2]]}),1===c.back&&h.push({pos:[0,0,-n-.5*i[2]],size:[i[0]+o,i[1],r]}),1===c.front&&h.push({pos:[0,0,.5*i[2]+n],size:[i[0]+o,i[1],r]})):(1===c.up&&h.push({pos:[0,.5*i[1]-n,0],size:[i[0],r,i[2]]}),1===c.down&&h.push({pos:[0,n-.5*i[1],0],size:[i[0],r,i[2]]}),1===c.left&&h.push({pos:[n-.5*i[0],0,0],size:[r,i[1]-o,i[2]]}),1===c.right&&h.push({pos:[.5*i[0]-n,0,0],size:[r,i[1]-o,i[2]]}),1===c.back&&h.push({pos:[0,0,n-.5*i[2]],size:[i[0]-o,i[1]-o,r]}),1===c.front&&h.push({pos:[0,0,.5*i[2]-n],size:[i[0]-o,i[1]-o,r]}));const l=[];let b,d,u=h.length,f=0;for(;u--;)d=h[f],b=this.isCompound?d.pos:A.addArray(s,d.pos),l.push({type:"box",size:d.size,pos:b,material:e.material}),f++;if(this.isCompound){let a=null;this.remplace&&(a=0===e.radius?new t.Mesh(new t.BoxGeometry(i[0],i[1],i[2])):new t.Mesh(new xn(i[0],i[1],i[2],e.radius||n)),e.material&&"debug"===e.material&&(a=new jn(a,e.color),e.material="line"),a.raycast=()=>{}),this.motor.add({...e,mesh:a,shapes:l,type:"compound",ray:!1})}else this.motor.add(l)}}const An=Math.PI/180,Sn=[new t.Vector3(1,0,0),new t.Vector3(0,1,0),new t.Vector3(0,0,1)],En=new t.Vector3,Fn=new t.Vector3,zn=new t.Vector3,Rn=new t.Vector3,Pn=[],Tn=[],In=new t.Vector3,Bn=new t.Vector3,Cn=new t.Vector3;new t.Matrix4;class Dn{constructor(e={},a){this.motor=a,this.extra={},this.tmp={forwardForce:0,steerValue:0,steerDirection:0,brakeForce:0},this.localWheel=!0,this.maxSpeed=70,this.maxForce=1500,this.maxBrakeForce=45,this.maxSteer=.4,this.steeringIncrement=.15,this.steerRecover=.15,this.name=e.name||"car",this.mass=e.mass||1e3,this.size=e.size||[1.5,.7,3.8],this.pos=e.pos||[0,4,0],this.rot=e.rot||[0,0,0],this.friction=e.friction||.2,this.restitution=e.restitution||.3,this.massCenter=e.massCenter||[0,0,0],this.driveWheel=e.driveWheel||null;let i=[{type:"box",pos:this.massCenter,size:this.size,radius:.02}];e.shapeMesh&&(i=[{type:"convex",shape:e.shapeMesh.geometry,pos:e.shapePos||[0,0,0]}]),this.body=this.motor.add({type:"compound",shapes:i,name:this.name,pos:this.pos,rot:this.rot,friction:this.friction,restitution:this.restitution,mass:this.mass,mesh:e.bodyMesh||null,meshPos:e.meshPos||[0,-1.1,0],material:e.material,damping:[.05,.05],debug:!1}),this.body.inertia=new t.Vector3(1.416666865348816,1.666666865348816,.416666716337204),this.vehicle=new Ln({chassis:this.body},this.motor);let s=e.wheelPosition||[.61,0,1.2];const r=[new t.Vector3(-s[0],s[1],-s[2]),new t.Vector3(s[0],s[1],-s[2]),new t.Vector3(-s[0],s[1],s[2]),new t.Vector3(s[0],s[1],s[2])],n={radius:e.wheelRadius||.31,directionLocal:new t.Vector3(0,-1,0),suspensionStiffness:100,suspensionRestLength:.5,suspensionMaxLength:1,maxSuspensionTravel:.3,frictionSlip:4,dampingRelaxation:2.3,dampingCompression:4.4,maxSuspensionForce:1e5,rollInfluence:.001,axleLocal:new t.Vector3(1,0,0),chassisConnectionPointLocal:new t.Vector3(1,1,0)};let o,c,h;this.addParametre("frictionSlip",4),this.addParametre("maxSuspensionTravel",.3),this.addParametre("suspensionRestLength",.5),this.addParametre("suspensionMaxLength",1),r.forEach((e=>{n.chassisConnectionPointLocal.copy(e),this.vehicle.addWheel(n)}));let l=this.motor.getMat("debug");if(e.wheelMesh?(c=e.wheelMesh,h=e.wheelMesh2?e.wheelMesh2:null,e.material&&(l=e.material||l,c.material=l,h&&(h.material=l))):(o=new t.CylinderGeometry(n.radius,n.radius,e.wheelDepth||.2),o.rotateZ(.5*Math.PI),c=new t.Mesh(o,l),h=null),this.vehicle.localWheel=this.localWheel,this.localWheel){this.vehicle.wheelMeshes=[h||c.clone(),c,h?h.clone():c.clone(),c.clone()];let e=this.vehicle.wheelMeshes.length,t=0;for(;e--;)this.body.add(this.vehicle.wheelMeshes[t++])}else m.matrixAutoUpdate=!1,h&&(h.matrixAutoUpdate=!1),this.vehicle.wheelMeshes=[this.motor.add(h||m.clone()),this.motor.add(m),this.motor.add(h?h.clone():m.clone()),this.motor.add(m.clone())]}step(){this.tmp.forwardForce=0,this.tmp.brakeForce=0,this.tmp.steerDirection=0;let e=this.motor.getDelta();this.motor.getAzimut();let t=this.motor.getKey();this.tmp.forwardForce=t[1],this.tmp.steerDirection=-1*t[0],this.tmp.brakeForce=1===t[4]?this.maxBrakeForce:0,this.tmp.steerValue+=this.tmp.steerDirection*this.steeringIncrement,this.tmp.steerValue=Math.min(Math.max(this.tmp.steerValue,-this.maxSteer),this.maxSteer),this.tmp.steerValue*=1-(1-Math.abs(this.tmp.steerDirection))*this.steerRecover;let a=Math.abs(this.vehicle.currentVehicleSpeedKmHour);a=Math.min(a,this.maxSpeed),this.maxSpeed;const i=1*this.tmp.forwardForce*this.maxForce;this.vehicle.applyEngineForce(i,0),this.vehicle.applyEngineForce(i,1),this.vehicle.applyEngineForce(i,2),this.vehicle.applyEngineForce(i,3),this.vehicle.setSteeringValue(this.tmp.steerValue,2),this.vehicle.setSteeringValue(this.tmp.steerValue,3),this.vehicle.setBrake(this.tmp.brakeForce,0),this.vehicle.setBrake(this.tmp.brakeForce,1),this.vehicle.setBrake(0,2),this.vehicle.setBrake(0,3),this.vehicle.wheelInfos[0].frictionSlip=8,this.vehicle.wheelInfos[1].frictionSlip=8,this.vehicle.wheelInfos[2].frictionSlip=8,this.vehicle.wheelInfos[3].frictionSlip=8,this.vehicle.updateVehicle(e),this.driveWheel&&(this.driveWheel.rotation.y=180*this.tmp.steerValue*An)}addParametre(e,t){this.extra[e]=t,Object.defineProperty(this,e,{get:()=>this.extra[e],set:t=>{this.extra[e]=t,this.vehicle&&this.vehicle.setWheels(e,this.extra[e])}})}}class Ln{constructor(e,t){this.motor=t,this.chassisBody=e.chassis,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==e.indexRightAxis?e.indexRightAxis:0,this.indexForwardAxis=void 0!==e.indexForwardAxis?e.indexForwardAxis:2,this.indexUpAxis=void 0!==e.indexUpAxis?e.indexUpAxis:1,this.wheelMeshes=[],this.brakeMeshs=null,this.localWheel=!1}addWheel(e={}){let t=new Vn(e,this.motor),a=this.wheelInfos.length-1;t.chassisBody=this.chassisBody;let i=t.suspensionRestLength+t.radius;return t.ray=this.motor.add({type:"ray",name:this.chassisBody.name+"_wheel_"+a,begin:t.chassisConnectionPointLocal.toArray(),end:[t.chassisConnectionPointLocal.x,-i,t.chassisConnectionPointLocal.z],callback:function(e){t.castRay(e)},visible:!1,parent:this.chassisBody}),this.wheelInfos.push(t),a}setWheels(e,t){let a,i=this.wheelInfos.length;for(;i--;)a=this.wheelInfos[i],a[e]&&(a[e]=t)}setSteeringValue(e,t){this.wheelInfos[t].steering=e}applyEngineForce(e,t){this.wheelInfos[t].engineForce=e}setBrake(e,t){this.wheelInfos[t].brake=e}getVehicleAxisWorld(e,a){return a.set(0===e?1:0,1===e?1:0,2===e?1:0),$n(a,Kn(this.chassisBody,new t.Matrix4),a),a}updateVehicle(e){let a=this.wheelInfos,i=a.length,s=this.chassisBody,r=i;for(;r--;)this.updateWheelTransform(r);const n=Un(s,new t.Vector3),o=eo(n,Kn(s,new t.Matrix4).invert(),new t.Vector3);this.currentVehicleSpeedKmHour=o.z;let c=new t.Vector3;this.getVehicleAxisWorld(this.indexForwardAxis,c),c.dot(s.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1),this.updateSuspension(e);let h=new t.Vector3;for(new t.Vector3,r=0;r<i;r++){let t=a[r],i=t.suspensionForce;i>t.maxSuspensionForce&&(i=t.maxSuspensionForce),h.copy(t.raycastResult.hitNormalWorld).multiplyScalar(i*e),Wn(this.motor,s,h,t.raycastResult.hitPointWorld)}this.updateFriction(e);let l=new t.Vector3,b=new t.Vector3,d=new t.Vector3;for(r=0;r<i;r++){let t=a[r];Xn(s,t.chassisConnectionPointWorld,d);let i=1;if(1===this.indexUpAxis)i=-1;if(t.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,b);let a=Yn(b,t.raycastResult.hitNormalWorld);l.copy(t.raycastResult.hitNormalWorld).multiplyScalar(a),b.sub(l);let s=Yn(b,d);t.deltaRotation=i*s*e/t.radius}!t.sliding&&t.isInContact||0===t.engineForce||!t.useCustomSlidingRotationalSpeed||(t.deltaRotation=(t.engineForce>0?1:-1)*t.customSlidingRotationalSpeed*e),Math.abs(t.brake)>Math.abs(t.engineForce)&&(t.deltaRotation=0),t.rotation-=t.deltaRotation,t.deltaRotation*=.99}}updateSuspension(e){let t=this.chassisBody,a=Hn(t),i=this.wheelInfos,s=i.length;for(let e=0;e<s;e++){let t=i[e];if(t.isInContact){let e,i=t.suspensionRestLength-t.suspensionLength;e=t.suspensionStiffness*i*t.clippedInvContactDotSuspension;let s,r=t.suspensionRelativeVelocity;s=r<0?t.dampingCompression:t.dampingRelaxation,e-=s*r,t.suspensionForce=e*a,t.suspensionForce<0&&(t.suspensionForce=0)}else t.suspensionForce=0}}updateFriction(e){let a,i,s,r=Rn,n=this.wheelInfos,o=n.length,c=this.chassisBody,h=Pn,l=Tn;for(a=0;a<o;a++)if(i=n[a],s=i.raycastResult.body,i.sideImpulse=0,i.forwardImpulse=0,h[a]||(h[a]=new t.Vector3),l[a]||(l[a]=new t.Vector3),s){let e=l[a],t=this.getWheelTransformWorld(a);eo(Sn[this.indexRightAxis],t,e);let n=i.raycastResult.hitNormalWorld,o=Yn(e,n);r.copy(n).multiplyScalar(o),e.sub(r).normalize(),Zn(n,e,h[a]),h[a].normalize(),i.sideImpulse=bo(c,i.raycastResult.hitPointWorld,s,i.raycastResult.hitPointWorld,e),i.sideImpulse*=1}for(this.sliding=!1,a=0;a<o;a++){i=n[a],s=i.raycastResult.body;let t=0;if(i.slipInfo=1,s){let r=0,n=i.brake?i.brake:r;t=ao(c,s,i.raycastResult.hitPointWorld,h[a],n),t+=i.engineForce*e;let o=n/t;i.slipInfo*=o}if(i.forwardImpulse=0,i.skidInfo=1,s){i.skidInfo=1;let a=i.suspensionForce*e*i.frictionSlip,s=a*a;i.forwardImpulse=t;let r=.5*i.forwardImpulse/i.forwardAcceleration,n=1*i.sideImpulse/i.sideAcceleration,o=r*r+n*n;if(i.sliding=!1,o>s){this.sliding=!0,i.sliding=!0;let e=a/Math.sqrt(o);i.skidInfo*=e}}}if(this.sliding)for(let e=0;e<o;e++)i=n[e],0!==i.sideImpulse&&i.skidInfo<1&&(i.forwardImpulse*=i.skidInfo,i.sideImpulse*=i.skidInfo);for(a=0;a<o;a++){i=n[a];let e=new t.Vector3;if(e.copy(i.raycastResult.hitPointWorld).sub(Nn(c,new t.Vector3)),0!==i.forwardImpulse){let e=new t.Vector3;e.copy(h[a]).multiplyScalar(i.forwardImpulse),Wn(this.motor,c,e,i.raycastResult.hitPointWorld)}if(0!==i.sideImpulse){s=i.raycastResult.body,(new t.Vector3).copy(i.raycastResult.hitPointWorld).sub(Nn(s,new t.Vector3));let r=new t.Vector3;r.copy(l[a]).multiplyScalar(i.sideImpulse),eo(e,Kn(c,new t.Matrix4).invert(),e),e["xyz"[this.indexUpAxis]]*=i.rollInfluence,eo(e,Kn(c,new t.Matrix4),e),Wn(this.motor,c,r,Nn(c,new t.Vector3).add(e)),r.multiplyScalar(-1),Wn(this.motor,s,r,i.raycastResult.hitPointWorld)}}}updateWheelTransformWorld(e){const t=this.chassisBody.matrixWorld;$n(e.chassisConnectionPointLocal,t,e.chassisConnectionPointWorld),eo(e.directionLocal,t,e.directionWorld)}updateWheelTransform(e){let a=In,i=Bn,s=Cn,r=this.wheelInfos[e];this.updateWheelTransformWorld(r),a.copy(r.directionLocal).multiplyScalar(-1),i.copy(r.axleLocal),Zn(a,i,s),s.normalize(),i.normalize();let n=r.steering,o=new t.Quaternion;to(a,n,o);let c=new t.Quaternion;to(i,r.rotation,c);let h=r.quaternion;Jn(this.chassisBody,h),h.multiply(o).multiply(c).normalize();let l=r.position;l.copy(r.directionWorld),l.multiplyScalar(r.suspensionLength);let b=l.clone();l.add(r.chassisConnectionPointWorld),r.matrix.compose(r.position,r.quaternion,{x:1,y:1,z:1}),this.localWheel?(b.add(r.chassisConnectionPointLocal),this.wheelMeshes[e].quaternion.copy(o).multiply(c).normalize(),this.wheelMeshes[e].position.copy(b),this.brakeMeshs&&(2!==e&&3!==e||this.brakeMeshs[e].quaternion.copy(o).normalize(),this.brakeMeshs[e].position.copy(b),this.brakeMeshs[e].updateMatrix())):(this.wheelMeshes[e].position.copy(r.position),this.wheelMeshes[e].quaternion.copy(r.quaternion),this.wheelMeshes[e].updateMatrix())}getWheelTransformWorld(e){return this.wheelInfos[e].matrix}}var On=new t.Vector3,qn=new t.Vector3;class Vn{constructor(e,a){this.motor=a,e=((e,t)=>{for(var a in e=e||{},t)a in e||(e[a]=t[a]);return e})(e,{chassisConnectionPointLocal:new t.Vector3,chassisConnectionPointWorld:new t.Vector3,directionLocal:new t.Vector3,directionWorld:new t.Vector3,axleLocal:new t.Vector3,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,forwardAcceleration:1,sideAcceleration:1,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=e.maxSuspensionTravel,this.customSlidingRotationalSpeed=e.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=e.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=e.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=e.chassisConnectionPointLocal.clone(),this.directionLocal=e.directionLocal.clone(),this.directionWorld=e.directionLocal.clone(),this.axleLocal=e.axleLocal.clone(),this.suspensionRestLength=e.suspensionRestLength,this.suspensionMaxLength=e.suspensionMaxLength,this.radius=e.radius,this.suspensionStiffness=e.suspensionStiffness,this.dampingCompression=e.dampingCompression,this.dampingRelaxation=e.dampingRelaxation,this.frictionSlip=e.frictionSlip,this.forwardAcceleration=e.forwardAcceleration,this.sideAcceleration=e.sideAcceleration,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=e.rollInfluence,this.maxSuspensionForce=e.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=e.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new Gn,this.position=(new t.Vector3).copy(this.chassisConnectionPointLocal),this.quaternion=new t.Quaternion,this.isInContact=!1,this.chassisBody=null,this.ray=null,this.matrix=new t.Matrix4}castRay(e){if(e.hit){this.isInContact=!0;let a=e.distance;this.raycastResult.hitPointWorld.fromArray(e.point),this.raycastResult.hitNormalWorld.fromArray(e.normal),this.raycastResult.body=this.motor.byName(e.body),this.suspensionLength=a-this.radius;let i=this.suspensionRestLength-this.maxSuspensionTravel,s=this.suspensionRestLength+this.maxSuspensionTravel;this.suspensionLength<i&&(this.suspensionLength=i),this.suspensionLength>s&&(this.suspensionLength=s,this.raycastResult.reset());let r=Yn(this.raycastResult.hitNormalWorld,this.directionWorld);Xn(this.chassisBody,this.raycastResult.hitPointWorld,On);var t=Yn(this.raycastResult.hitNormalWorld,On);if(r>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{let e=-1/r;this.suspensionRelativeVelocity=t*e,this.clippedInvContactDotSuspension=e}}else this.isInContact=!1,this.suspensionLength=this.suspensionRestLength+0*this.maxSuspensionTravel,this.suspensionRelativeVelocity=0,this.raycastResult.hitNormalWorld.copy(this.directionWorld).multiplyScalar(-1),this.clippedInvContactDotSuspension=1}updateWheel(e){let t=this.raycastResult;if(this.isInContact){let a=t.hitNormalWorld.dot(t.directionWorld);qn.copy(t.hitPointWorld).sub(e.position),Xn(e,qn,On);let i=t.hitNormalWorld.dot(On);if(a>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{let e=-1/a;this.suspensionRelativeVelocity=i*e,this.clippedInvContactDotSuspension=e}}else t.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,t.hitNormalWorld.copy(t.directionWorld).scaleInPlace(-1),this.clippedInvContactDotSuspension=1}}class Gn{constructor(){this.body=null,this.hitPointWorld=new t.Vector3,this.hitNormalWorld=new t.Vector3,this.directionWorld=new t.Vector3}reset(){this.body=null,this.hitPointWorld=new t.Vector3,this.hitNormalWorld=new t.Vector3,this.directionWorld=new t.Vector3}}const Hn=e=>e.mass,_n=e=>e.mass>0?1/e.mass:0,Nn=(e,t)=>t.copy(e.position),Un=(e,t)=>t.copy(e.velocity),Kn=(e,t)=>t.copy(e.matrixWorld),Jn=(e,t)=>t.copy(e.quaternion),Wn=(e,t,a,i)=>{e.change({name:t.name,impulse:a.toArray(),impulseCenter:i.toArray()})},Xn=(e,t,a)=>(a.copy(t).sub(e.position),a.crossVectors(e.angular,a),a.add(e.velocity),a),Qn=(e,t)=>(e.inertia&&t.copy(e.inertia),eo(t,e.matrixWorld,t),t.x=t.x>0?1/t.x:0,t.y=t.y>0?1/t.y:0,t.z=t.z>0?1/t.z:0,t),Yn=(e,t)=>e.x*t.x+e.y*t.y+e.z*t.z,Zn=(e,t,a)=>{const i=e.y*t.z-e.z*t.y,s=e.z*t.x-e.x*t.z,r=e.x*t.y-e.y*t.x;return a.set(i,s,r),a},$n=(e,t,a)=>{const i=e.x,s=e.y,r=e.z,n=t.elements,o=i*n[0]+s*n[4]+r*n[8]+n[12],c=i*n[1]+s*n[5]+r*n[9]+n[13],h=i*n[2]+s*n[6]+r*n[10]+n[14],l=1/(i*n[3]+s*n[7]+r*n[11]+n[15]);return a.x=o*l,a.y=c*l,a.z=h*l,a},eo=(e,t,a)=>{const i=e.x,s=e.y,r=e.z,n=t.elements;return a.x=i*n[0]+s*n[4]+r*n[8],a.y=i*n[1]+s*n[5]+r*n[9],a.z=i*n[2]+s*n[6]+r*n[10],a},to=(e,t,a)=>{const i=Math.sin(t/2);return e.normalize(),a.w=Math.cos(t/2),a.x=e.x*i,a.y=e.y*i,a.z=e.z*i,a};function ao(e,t,a,i,s){var r=0,n=a,o=En,c=Fn,h=zn;Xn(e,n,o),Xn(t,n,c),h.copy(o).sub(c);return s<(r=-Yn(i,h)*(1/(oo(e,a,i)+oo(t,a,i))))&&(r=s),r<-s&&(r=-s),r}var io=new t.Vector3,so=new t.Vector3,ro=new t.Vector3,no=new t.Vector3;function oo(e,a,i){var s=io,r=so,n=ro,o=no;return s.copy(a).sub(Nn(e,new t.Vector3)),Zn(s,i,r),o.copy(Qn(e,new t.Vector3)).multiply(r),Zn(o,s,n),_n(e)+Yn(i,n)}var co=new t.Vector3,ho=new t.Vector3,lo=new t.Vector3;function bo(e,t,a,i,s){if(s.lengthSq()>1.1)return 0;let r=co,n=ho,o=lo;return Xn(e,t,r),Xn(a,i,n),o.copy(r).sub(n),-.1*Yn(s,o)*(1/(_n(e)+_n(a)))}class uo{constructor(e={},a){this.MoveSpeed=50,this.MaxSpeed=15,this.Drag=.98,this.SteerAngle=20,this.Traction=10,this.MoveForce=new t.Vector3(0,0,0),this.tt=new t.Vector3(0,0,0),this.v1=new t.Vector3(0,0,0),this.v2=new t.Vector3(0,0,0),this.motor=a,this.debug=this.motor.addDebuger(),this._reponsivness=500,this._throttleAmt=25,this._thottle=0,this._roll=0,this._pitch=0,this._yaw=0,this.init(e)}init(){this.car=new t.Mesh(new t.BoxGeometry(2,1,3),new t.MeshBasicMaterial({wireframe:!0})),this.car.position.y=.5,this.motor.add(this.car);let e=new t.AxesHelper;this.car.add(e)}update(e){this.updateCar(e)}updateCar(e){const t=this.motor.getKey(),a=this.motor.getTransform(this.car);this.tt.copy(a.forward).multiplyScalar(this.MoveSpeed*-t[1]*e),this.MoveForce.add(this.tt),this.car.position.add(this.MoveForce.clone().multiplyScalar(e));let i=-t[0],s=this.MoveForce.length();a.up.multiplyScalar(i*s*this.SteerAngle*e),this.car.rotation.y+=a.up.y*this.motor.math.torad,this.MoveForce.multiplyScalar(this.Drag),this.MoveForce.clampLength(0,this.MaxSpeed),s=this.MoveForce.length(),this.v1.copy(this.MoveForce).normalize().multiplyScalar(3),this.v2.copy(a.forward).multiplyScalar(3),this.debug.DrawRay(a.position,this.v1,"white"),this.debug.DrawRay(a.position,this.v2,"blue"),this.debug.DrawRay(a.position,a.right,"red"),this.v1.copy(this.MoveForce).normalize().lerp(a.forward,this.Traction*e),this.MoveForce.copy(this.v1).multiplyScalar(s)}fixedUpdate(e){const t=this.motor.getTransform(this.body);t.position.copy(this.body.position),t.forward.copy(this.forward).applyQuaternion(this.body.quaternion),t.right.copy(this.right).applyQuaternion(this.body.quaternion),t.up.copy(this.up).applyQuaternion(this.body.quaternion),t.thottle.copy(t.up),this.motor.change({name:this.body.name,impulse:t.thottle.multiplyScalar(this._thottle).toArray()}),this.debug.DrawRay(t.position,t.thottle,"red"),this.debug.DrawRay(t.position,t.forward,"yellow"),this.debug.DrawRay(t.position,t.right,"cyan"),this.debug.DrawRay(t.position,t.up,"green")}handleInputs(e){const t=this.motor.getKey();this._roll=t[0],this._pitch=t[1],t[4]?this._thottle+=e*this._throttleAmt:t[5]&&(this._thottle-=e*this._throttleAmt),this._thottle=this.motor.math.clamp(this._thottle,0,100)}}class fo{constructor(e={},a){this.startPosition=e.pos||[0,0,0],this.model=e.model||null,this.debug=e.debug||!1,this.angle=0,this.speed=50,this.maxSpeed=20,this.drag=.98,this.steerAngle=5,this.traction=3,this.moveForce=new t.Vector3(0,0,0),this.side=0,this.onAir=!1,this.tt=new t.Vector3(0,0,0),this.v1=new t.Vector3(0,0,0),this.v2=new t.Vector3(0,0,0),this.floorNormal=new t.Vector3(0,0,0),this.up=new t.Vector3(0,1,0),this.decal=new t.Vector3(0,-.5,0),this.tmpQ1=new t.Quaternion,this.tmpQ2=new t.Quaternion,this.tmpQ3=new t.Quaternion,this.motor=a,this.angleS=0,this.debug&&(this.debuger=this.motor.addDebuger()),this.phyMove=!0,this.init(e)}setDebug(e){e&&(this.debug=e),this.sphere.visible=this.debug,this.ray.visible=this.debug}init(){this.radius=1,this.decal.y=-.5,this.radius=1.7,this.decal.y=-1.2;const e=this.motor.math;this.sphere=this.motor.add({type:"sphere",name:"baser",mass:1,size:[this.radius],pos:e.addArray(this.startPosition,[0,this.radius,0]),friction:.5,material:"debug",getVelocity:!0,visible:this.debug,shadow:!1,ray:!1});let a=this.rayHit.bind(this);if(this.ray=this.motor.add({name:"raySphere",type:"ray",begin:[0,0,0],end:[0,-(this.radius+1),0],visible:this.debug,parent:this.sphere,noRotation:!0,callback:a}),this.model){for(let e in this.model)this.model[e].receiveShadow=!0,this.model[e].castShadow=!0;this.car=this.model.body,this.w=[this.model.wheel_0,this.model.wheel_1,this.model.wheel_2,this.model.wheel_3,this.model.d_wheel]}else this.car=new t.Mesh(new t.BoxGeometry(1,.4,2),new t.MeshBasicMaterial({wireframe:!0})),this.addWheels();this.motor.add(this.car)}addWheels(){let e=new t.CylinderGeometry(.3,.3,.3,16);e.rotateZ(Math.PI/2);let a,i=new t.MeshBasicMaterial({wireframe:!0}),s=4,r=[.7,-.2,.7],n=[];for(;s--;)n[s]=new t.Mesh(e,i),a=[0===s||3===s?r[0]:-.7,r[1],s<2?r[2]:-.7],n[s].position.fromArray(a),this.car.add(n[s]);this.w=n}updateWheels(){this.motor.math;let e,t=4;this.tmpQ3.setFromAxisAngle({x:0,y:1,z:0},3*this.angleS);let a=this.sphere.velocity.length()*this.side,i={x:1,y:0,z:0};for(;t--;)e=this.w[t],t<2?e.quaternion.setFromAxisAngle(i,a).premultiply(this.tmpQ3):e.quaternion.setFromAxisAngle(i,a);this.w[4]&&(this.w[4].rotation.y=10*this.angleS)}rayHit(e){e.hit?this.floorNormal.fromArray(e.normal).normalize():this.floorNormal.set(0,0,0),this.onAir=!e.hit}update(e){const t=this.motor.getKey(),a=this.motor.math;this.phyMove&&this.car.position.copy(this.sphere.position).add(this.decal);const i=this.motor.getTransform(this.car);let s=-t[1]*this.speed*e;this.onAir&&(s=0),this.tt.copy(i.forward).multiplyScalar(s),this.moveForce.add(this.tt),this.phyMove||this.car.position.add(this.moveForce.clone().multiplyScalar(e)),this.tmpQ1.setFromUnitVectors(this.up,this.floorNormal),this.tmpQ2.slerp(this.tmpQ1,4*e);let r=this.moveForce.toArray();this.motor.change({name:this.sphere.name,linear:r,velocityOperation:"xz"}),this.chassis&&this.motor.change({name:this.chassis.name,quat:this.car.quaternion.toArray(),pos:this.car.position.toArray()});let n=-t[0],o=this.moveForce.length();this.angleS=n*this.steerAngle*a.torad,this.angle+=this.angleS*o*e,this.car.quaternion.setFromAxisAngle(this.up,this.angle).premultiply(this.tmpQ2),this.moveForce.multiplyScalar(this.drag),this.moveForce.clampLength(0,this.maxSpeed),o=this.moveForce.length(),this.v1.copy(this.moveForce).normalize().multiplyScalar(1),this.v2.copy(i.forward).multiplyScalar(1),this.debug&&(this.debuger.DrawRay(i.position,this.v1,"white"),this.debuger.DrawRay(i.position,this.v2,"blue")),this.v1.copy(this.moveForce).normalize().lerp(i.forward,this.traction*e),this.moveForce.copy(this.v1).multiplyScalar(o),this.side=this.moveForce.dot(i.forward)>0?-1:1,this.updateWheels()}}const mo=new t.Matrix4,po=new t.Matrix4;new t.Vector3;let go=t.Skeleton.prototype;go.byName=function(e){let t=this.bones.length;for(;t--;)if(this.bones[t].name===e)return this.bones[t];return null},go.getId=function(e){let t=this.bones.length;for(;t--;)if(this.bones[t].name===e)return t;return null},go.setExtraRotation=function(e,a,i,s){(e.isBone?e:this.byName(e))&&t.MathUtils.DEG2RAD},go.setScalling=function(e,a,i,s){let r=e.isBone?e:this.byName(e);r&&(r.scalling=new t.Vector3(a,i,s))},go.resetScalling=function(e){this.pose(),this.scalled=!0;for(let e=0,a=this.bones.length;e<a;e++)this.bones[e].isPhysics=!1,this.bones[e].phyMtx=new t.Matrix4;e||this.applyScalling()},go.childScale=function(e,t){if(!this.scalled)return;e.scalling&&t.scale(e.scalling);let a,i=e.children.length,s=0;for(;i--;)a=e.children[s],s++,a.isBone,a.matrixWorld.multiplyMatrices(t,a.matrix)},go.applyScalling=function(e){let t,a,i,s=this.bones.length;for(a=0;a<s;a++)t=this.bones[a],i=t.parent||null,null!==i&&i.scalling&&"root"!==t.name&&(t.position.multiply(i.scalling),t.updateMatrixWorld(!0));this.calculateInverses()},go.update=function(){const e=this.bones,t=this.boneInverses,a=this.boneMatrices,i=this.boneTexture;let s,r=e.length,n=0;for(;r--;){s=e[n];const i=s?s.isPhysics?s.phyMtx:s.matrixWorld:po;this.childScale(s,i),mo.multiplyMatrices(i,t[n]),mo.toArray(a,16*n),n++}null!==i&&(i.needsUpdate=!0)};const yo={getColor(e){let t=e.toString();t=t.substring(t.lastIndexOf(".")+1);let a,i=[255,255,255];switch(t){case"grass":i=[.223,.827,.325],a=[.741,.498,.258];break;case"dirt":i=[.741,.498,.258];break;case"leaves":i=[.152,.682,.376];break;case"sand":i=[.878,.819,.686];break;case"ice":i=[.65,.882,.96];break;case"stone":i=[.537,.64,.65];break;case"cobblestone":i=[.666,.647,.588];break;case"wood":i=[.603,.321,.152];break;case"snow":i=[.905,.976,1]}return a?[i[0],i[1],i[2],a[0],a[1],a[2]]:[i[0],i[1],i[2]]},fire:{type:"star",numParticles:20,position:[0,0,0],colors:[1,1,0,0,1,1,0,1,1,0,0,1,1,0,0,1,1,0,0,.5,0,0,0,0],lifeTime:2,timeRange:2,startSize:.3,endSize:.9,velocity:[0,.8,0],velocityRange:[.15,.15,.15],gravity:[0,-.2,0],spinSpeedRange:4},smoke:{position:[-2,-.2,0],colors:[0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0],numParticles:20,lifeTime:2,timeRange:2,startSize:.5,endSize:2,velocity:[0,1.6,0],velocityRange:[.2,0,.2],gravity:[0,-.25,0],spinSpeedRange:4,blending:"normal"},addBlock:{type:"cube",numParticles:30,lifeTime:1.5,endTime:1.5,startTime:0,startSize:.25,endSize:.5,sizeRange:.25,spinSpeedRange:2,radius:.25,velocity:[1,0,1],velocityRange:[.25,0,.25],acceleration:[1,0,1],accelerationRange:[.25,0,.25],gravity:[0,.05,0],tween:"outQuad",blending:"normal",alphaTest:.1},removeBlock:{type:"cube",lifeTime:1.5,endTime:1.5,startTime:0,startSize:.5,sizeRange:.25,endSize:.1,spinSpeedRange:2,accelerationRange:[.5,.5,.5],gravity:[0,-.1,0],tween:"outQuad",blending:"normal",alphaTest:.1},explosion:{colors:[1,0,0,0,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,.5,1,1,1,0],type:"cloud",radius:.5,radiusRange:.5,numParticles:400,positionRange:[2,1,2],lifeTime:3,endTime:4,lifeTimeRange:1,startTime:0,startSize:.1,endSize:2,sizeRange:1,accelerationRange:[1,.3,1],acceleration:[.8,.8,.8],gravity:[0,-.5,0],spinSpeedRange:2,luma:!1},playerMove:{trail:!0,colors:[1,1,1,1,.2,.2,.2,0],type:"round",blending:"normal",numParticles:4,maxParticles:1e3,positionRange:[.2,0,.2],lifeTime:1.5,startSize:.5,endSize:1,sizeRange:.25,velocityRange:[.6,0,.6],gravity:[0,.1,0]},vehicleMove:{trail:!0,colors:[.5,.5,.5,.25,.2,.2,.2,0],type:"round",blending:"normal",numParticles:4,maxParticles:2e3,positionRange:[.25,0,.25],lifeTime:1.5,startSize:.5,endSize:1,sizeRange:.25,velocityRange:[.6,0,.6],gravity:[0,.2,0]},vehicleTrack:{trail:!0,colors:[.2,.2,.2,.1,.2,.2,.2,0],type:"round2",blending:"normal",startSize:.3,endSize:.3,numParticles:4,maxParticles:2e3,position:[0,-.1,0],lifeTime:6,oriented:!0},underWater:{trail:!0,colors:[1,1,1,1,.5,.5,1,0],type:"bubble",blending:"normal",numParticles:1,maxParticles:1e3,positionRange:[.25,0,.25],lifeTime:1.5,startSize:.1,endSize:.5,sizeRange:.05,velocity:[0,1,0],velocityRange:[1,0,1],acceleration:[.2,0,.2],gravity:[0,1,0]},bazookaFire:{trail:!0,colors:[1,0,0,1,1,1,0,.5,1,1,1,0],type:"round",numParticles:2,maxParticles:600,positionRange:[.1,.1,.1],lifeTime:1.5,startSize:.5,endSize:1,sizeRange:.1,velocityRange:[.6,.6,.6],gravity:[0,.1,0],luma:!1}},xo=["pixel","basic","cube","cloud","round","round2","donut","bubble","smoke","circle","field","star","octo"];function wo(){this.parent=null,this.position=[0,0,0],this.rotation=[0,0,0],this.name="default",this.type="round",this.tween="linear",this.trail=!1,this.model="",this.numParticles=1,this.maxParticles=0,this.numFrames=1,this.frameDuration=1,this.frameStart=0,this.frameStartRange=0,this.timeRange=99999999,this.startTime=null,this.lifeTime=1,this.endTime=-1,this.lifeTimeRange=0,this.sizeRange=0,this.startSize=1,this.startSizeRange=0,this.endSize=1,this.endSizeRange=0,this.pposition=[0,0,0],this.positionRange=[0,0,0],this.velocity=[0,0,0],this.velocityRange=[0,0,0],this.acceleration=[0,0,0],this.accelerationRange=[0,0,0],this.spinStart=0,this.spinStartRange=0,this.spinSpeed=0,this.spinSpeedRange=0,this.colorMult=[1,1,1,1],this.colorMultRange=[0,0,0,0],this.worldVelocity=[0,0,0],this.gravity=[0,0,0],this.oriented=!1,this.orientation=[0,0,0,1],this.colors=[1,1,1,1],this.blending="additive",this.radius=0,this.radiusPosition=!1,this.axis="Y",this.radiusRange=0,this.tmpRotation=null,this.alphaTest=0,this.renderOrder=0,this.luma=!0,this.depthWrite=!1,this.transparent=!0}const vo={torad:Math.PI/180,todeg:180/Math.PI,random:()=>Math.random(),rand:(e,t)=>e+vo.random()*(t-e),randInt:(e,t)=>e+Math.floor(vo.random()*(t-e+1)),plusMinus:e=>(vo.random()-.5)*e*2,plusMinusVector:e=>{const t=[];let a=e.length;for(;a--;)t.push(vo.plusMinus(e[a]));return t},toTexture:e=>{let a=new t.Texture(e);return a.minFilter=t.LinearFilter,a.magFilter=t.LinearFilter,a.flipY=!1,a.colorSpace=t.SRGBColorSpace,a.needsUpdate=!0,a},createTextureFromFloats:(e,a,i,s)=>{let r=null;if(null==s){const s=new Uint8Array(i.length);let n;for(let e=0;e<i.length;e++)n=255*i[e],s[e]=n;return r=new t.DataTexture(s,e,a,t.RGBAFormat),r.minFilter=t.LinearFilter,r.magFilter=t.LinearFilter,r.needsUpdate=!0,r}return r=s,r}},ko=function(e){let t;switch(e){case"linear":t="float tween( float k ) { return k; }";break;case"inQuad":t="float tween( float k ) { return k * k; }";break;case"outQuad":t="float tween( float k ) { return k * ( 2.0 - k ); }";break;case"inOutQuad":t="float tween( float k ) { \n\t\t\tif ( ( k *= 2.0 ) < 1.0 ) return 0.5 * k * k;\n            return - 0.5 * ( --k * ( k - 2.0 ) - 1.0 ); \n        }";break;case"inCubic":t="float tween( float k ) { return k * k * k; }";break;case"outCubic":t="float tween( float k ) { return --k * k * k + 1.0; }";break;case"inOutCubic":t="float tween( float k ) { \n\t\t\tif ( ( k *= 2.0 ) < 1.0 ) return 0.5 * k * k * k;\n\t\t\treturn 0.5 * ( ( k -= 2.0 ) * k * k + 2.0 ); \n        }";break;case"inQuart":t="float tween( float k ) { return k * k * k * k; }";break;case"outQuart":t="float tween( float k ) { return 1.0 - ( --k * k * k * k ); }";break;case"inOutQuart":t="float tween( float k ) { \n\t\t\tif ( ( k *= 2.0 ) < 1.0) return 0.5 * k * k * k * k;\n\t\t\treturn - 0.5 * ( ( k -= 2.0 ) * k * k * k - 2.0 ); \n        }";break;case"inQuint":t="float tween( float k ) { return k * k * k * k * k; }";break;case"outQuint":t="float tween( float k ) { return --k * k * k * k * k + 1.0; }";break;case"inOutQuint":t="float tween( float k ) { \n\t\t\tif ( ( k *= 2.0 ) < 1.0 ) return 0.5 * k * k * k * k * k;\n\t\t\treturn 0.5 * ( ( k -= 2.0 ) * k * k * k * k + 2.0 );\n        }";break;case"inSine":t="#define PI_90 1.570796326794896\n        float tween( float k ) { float j = k * PI_90; return 1.0 - cos( j ); }";break;case"outSine":t="#define PI_90 1.570796326794896\n\t\tfloat tween( float k ) { float j = k * PI_90; return sin( j ); }";break;case"inOutSine":t="#define M_PI 3.14159265358979323846\n\t\tfloat tween( float k ) { \n\t\t\tfloat j = k * M_PI; return 0.5 * (1.0-cos(j));\n        }";break;case"inExpo":t="float tween( float k ) { return k == 0.0 ? 0.0 : pow( 1024.0, k - 1.0 ); }";break;case"outExpo":t="float tween( float k ) { return k == 1.0 ? 1.0 : 1.0 - pow( 2.0, - 10.0 * k ); }";break;case"inOutExpo":t="float tween( float k ) { \n\t\t\tif ( k == 0.0 ) return 0.0;\n\t\t    if ( k == 1.0 ) return 1.0;\n\t\t    if ( ( k *= 2.0 ) < 1.0 ) return 0.5 * pow( 1024.0, k - 1.0 );\n\t\t    return 0.5 * ( - pow( 2.0, - 10.0 * ( k - 1.0 ) ) + 2.0 );\n        }";break;case"inCirc":t="float tween( float k ) { return 1.0 - sqrt( 1.0 - k * k ); }";break;case"outCirc":t="float tween( float k ) { return sqrt( 1.0 - ( --k * k ) ); }";break;case"inOutCirc":t="float tween( float k ) { \n\t\t\tif ( ( k *= 2.0 ) < 1.0) return - 0.5 * ( sqrt( 1.0 - k * k ) - 1.0 );\n\t\t\treturn 0.5 * ( sqrt( 1.0 - ( k -= 2.0 ) * k ) + 1.0 ); \n        }";break;case"inElastic":t="#define TWO_PI 6.28318530717958647692\n        float tween(float k) {\n\t\t    float s;\n\t\t    float a = 0.1;\n\t\t    float p = 0.4;\n\t\t    if ( k == 0.0 ) return 0.0;\n\t\t    if ( k == 1.0 ) return 1.0;\n\t\t    if ( a < 1.0 ) { a = 1.0; s = p * 0.25; }\n\t\t    else s = p * asin( 1.0 / a ) / TWO_PI;\n\t\t    return - ( a * pow( 2.0, 10.0 * ( k -= 1.0 ) ) * sin( ( k - s ) * TWO_PI / p ) );\n\t\t}";break;case"outElastic":t="#define TWO_PI 6.28318530717958647692\n\t\tfloat tween(float k) {\n\t\t    float s;\n\t\t    float a = 0.1; \n\t\t    float p = 0.4;\n\t\t    if ( k == 0.0 ) return 0.0;\n\t\t    if ( k == 1.0 ) return 1.0;\n\t\t    if ( a < 1.0 ) { a = 1.0; s = p * 0.25; }\n\t\t    else s = p * asin( 1.0 / a ) / TWO_PI;\n\t\t    return ( a * pow( 2.0, - 10.0 * k) * sin( ( k - s ) * TWO_PI / p ) + 1.0 );\n\t\t}";break;case"inOutElastic":t="#define TWO_PI 6.28318530717958647692\n\t\tfloat tween(float k) {\n\t\t    float s;\n\t\t    float a = 0.1;\n\t\t    float p = 0.4;\n\t\t    if ( k == 0.0 ) return 0.0;\n\t\t    if ( k == 1.0 ) return 1.0;\n\t\t    if ( a < 1.0 ) { a = 1.0; s = p * 0.25; }\n\t\t    else s = p * asin( 1.0 / a ) / TWO_PI;\n\t\t    if ( ( k *= 2.0 ) < 1.0 ) return - 0.5 * ( a * pow( 2.0, 10.0 * ( k -= 1.0 ) ) * sin( ( k - s ) * TWO_PI / p ) );\n\t\t    return a * pow( 2.0, -10.0 * ( k -= 1.0 ) ) * sin( ( k - s ) * TWO_PI / p ) * 0.5 + 1.0;\n\t\t}";break;case"inBack":t="float tween(float k) {\n\t\t    float s = 1.70158;\n\t\t    return k * k * ( ( s + 1.0 ) * k - s );\n\t\t}";break;case"outBack":t="float tween(float k) {\n\t\t    float s = 1.70158;\n\t\t    return --k * k * ( ( s + 1.0 ) * k + s ) + 1.0;\n\t\t}";break;case"inOutBack":t="float tween(float k) {\n\t\t    float s = 1.70158 * 1.525;\n\t\t    if ( ( k *= 2.0 ) < 1.0 ) return 0.5 * ( k * k * ( ( s + 1.0 ) * k - s ) );\n\t\t    return 0.5 * ( ( k -= 2.0 ) * k * ( ( s + 1.0 ) * k + s ) + 2.0 );\n\t\t}";break;case"inBounce":t="float outBounce(float k) {\n\t\t    if ( k < ( 1.0 / 2.75 ) ) return 7.5625 * k * k;\n\t\t    else if ( k < ( 2.0 / 2.75 ) ) return 7.5625 * ( k -= ( 1.5 / 2.75 ) ) * k + 0.75;\n\t\t    else if ( k < ( 2.5 / 2.75 ) ) return 7.5625 * ( k -= ( 2.25 / 2.75 ) ) * k + 0.9375;\n\t\t    else return 7.5625 * ( k -= ( 2.625 / 2.75 ) ) * k + 0.984375;\n\t\t}\n\t\tfloat tween(float k) { return 1.0 - outBounce( 1.0 - k ); }";break;case"outBounce":t="float tween(float k) {\n\t\t    if ( k < ( 1.0 / 2.75 ) ) return 7.5625 * k * k;\n\t\t    else if ( k < ( 2.0 / 2.75 ) ) return 7.5625 * ( k -= ( 1.5 / 2.75 ) ) * k + 0.75;\n\t\t    else if ( k < ( 2.5 / 2.75 ) ) return 7.5625 * ( k -= ( 2.25 / 2.75 ) ) * k + 0.9375;\n\t\t    else return 7.5625 * ( k -= ( 2.625 / 2.75 ) ) * k + 0.984375;\n\t\t}";break;case"inOutBounce":t="float outBounce(float k) {\n\t\t    if ( k < ( 1.0 / 2.75 ) ) return 7.5625 * k * k;\n\t\t    else if ( k < ( 2.0 / 2.75 ) ) return 7.5625 * ( k -= ( 1.5 / 2.75 ) ) * k + 0.75;\n\t\t    else if ( k < ( 2.5 / 2.75 ) ) return 7.5625 * ( k -= ( 2.25 / 2.75 ) ) * k + 0.9375;\n\t\t    else return 7.5625 * ( k -= ( 2.625 / 2.75 ) ) * k + 0.984375;\n\t\t}\n\t\tfloat inBounce(float k) { return 1.0 - outBounce( 1.0 - k ); }\n\t\tfloat tween(float k) {\n\t\t    if ( k < 0.5 ) return inBounce( k * 2.0 ) * 0.5;\n\t\t    return outBounce( k * 2.0 - 1.0 ) * 0.5 + 0.5;\n\t\t}"}return t},jo=[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]],Mo=new Float32Array(28);class Ao extends t.Points{constructor(e,t){super(),this.pe=e,this.count=0,this.color=null,this.texture=null,this.localTime=0,this.time=0,this.endTime=-1,this.num=0,this.matrixAutoUpdate=!1,this.frustumCulled=t.frustum||!1,this.receiveShadow=!1,this.castShadow=!1,this.birthIndex=0,this.luma=!0,t&&this.setParameters(t)}setParameters(e){this.validateParameters(e),this.geometry&&this.geometry.dispose(),this.material&&this.material.dispose(),this.name=e.name,this.isTrail=e.trail||!1,this.parameters=e;const t=this.isTrail?e.maxParticles:e.numParticles;this.allocateParticles_(t,e),this.isTrail||this.createParticles_(0,t,e),e.parent?e.parent.add(this):this.pe.scene?this.pe.scene.add(this):this.pe.add(this)}makeGeometry(e){this.geometry=e.oriented?new t.InstancedBufferGeometry:new t.BufferGeometry,this.isMesh=e.oriented}setColorRamp(e){const t=e.length/4;if(t%1!=0)throw"colorRamp must have multiple of 4 entries";this.color=vo.createTextureFromFloats(t,1,e)}validateParameters(e){var t=new wo;for(let a in e)if(void 0===t[a])throw'unknown particle parameter "'+a+'"';for(let a in t)void 0===e[a]&&(e[a]=t[a])}perParticle(e,t){}birthParticles(e,t){var a=this.parameters.numParticles;this.parameters.pposition=e,this.parameters.startTime=this.time,this.endTime=this.time+this.parameters.lifeTime,t&&this.setColorRamp(t),this.createParticles_(this.birthIndex,a,this.parameters),this.birthIndex+=a,this.birthIndex+a>=this.parameters.maxParticles&&(this.birthIndex=0)}createParticles_(e,a,i){const s=vo.plusMinus,r=vo.plusMinusVector,n=this.interleavedBuffer.array;let o,c=a;for(;c--;){this.perParticle(c,i);let h=i.lifeTime+s(i.lifeTimeRange),l=null===i.startTime?c*i.lifeTime/a:i.startTime,b=i.frameStart+s(i.frameStartRange),d=(new t.Vector3).addVectors((new t.Vector3).fromArray(i.pposition),(new t.Vector3).fromArray(r(i.positionRange))),u=(new t.Vector3).addVectors((new t.Vector3).fromArray(i.velocity),(new t.Vector3).fromArray(r(i.velocityRange))),f=(new t.Vector3).addVectors((new t.Vector3).fromArray(i.acceleration),(new t.Vector3).fromArray(r(i.accelerationRange))),m=(new t.Vector4).addVectors((new t.Vector4).fromArray(i.colorMult),(new t.Vector4).fromArray(r(i.colorMultRange))),p=i.spinStart+s(i.spinStartRange),g=i.spinSpeed+s(i.spinSpeedRange),y=i.startSize+s(i.sizeRange||i.startSizeRange),x=i.endSize+s(i.sizeRange||i.endSizeRange),w=(new t.Vector4).fromArray(i.orientation);if(i.positionRange[0],i.positionRange[1],i.positionRange[2],i.radius){let e=i.axis||"Y",a=vo.rand(0,2*Math.PI);i.tmpRotation=[90,-a*vo.todeg,90,"YXZ"];let r=i.radius+s(i.radiusRange),n=Math.cos(a),o=Math.sin(a),c=new t.Vector3;switch(e){case"X":c.y=n,c.z=o;break;case"Y":c.x=n,c.z=o;break;case"Z":c.x=n,c.y=o}switch(c.multiplyScalar(r),i.radiusPosition&&d.add(c),e){case"X":c.x=1;break;case"Y":c.y=1;break;case"Z":c.z=1}f.multiply(c),u.multiply(c)}i.tmpRotation&&(w=(new t.Quaternion).setFromEuler(new t.Euler(i.tmpRotation[0]*vo.torad,i.tmpRotation[1]*vo.torad,i.tmpRotation[2]*vo.torad,i.tmpRotation[3]))),o=0+28*c*4+28*e*4,n[0+o]=d.x,n[0+o+1]=d.y,n[0+o+2]=d.z,n[0+o+3]=l,n[4+o]=jo[0][0],n[4+o+1]=jo[0][1],n[4+o+2]=h,n[4+o+3]=b,n[8+o]=u.x,n[8+o+1]=u.y,n[8+o+2]=u.z,n[8+o+3]=y,n[12+o]=f.x,n[12+o+1]=f.y,n[12+o+2]=f.z,n[12+o+3]=x,n[16+o]=p,n[16+o+1]=g,n[16+o+2]=0,n[16+o+3]=0,n[20+o]=w.x,n[20+o+1]=w.y,n[20+o+2]=w.z,n[20+o+3]=w.w,n[24+o]=m.x,n[24+o+1]=m.y,n[24+o+2]=m.z,n[24+o+3]=m.w}this.interleavedBuffer.needsUpdate=!0,this.material.uniforms.worldVelocity.value.fromArray(i.worldVelocity),this.material.uniforms.gravity.value.fromArray(i.gravity),this.material.uniforms.timeRange.value=i.timeRange,this.material.uniforms.frameDuration.value=i.frameDuration,this.material.uniforms.numFrames.value=i.numFrames,this.material.uniforms.rampSampler.value=this.color,this.material.uniforms.colorSampler.value=this.texture,this.material.blending="normal"===i.blending?t.NormalBlending:t.AdditiveBlending,this.updateMatrix()}allocateParticles_(e,a){if(this.count!==e){if(a.oriented||(a.oriented=!1),a.position&&this.position.fromArray(a.position),a.rotation&&this.quaternion.setFromEuler(new t.Euler(a.rotation[0]*vo.torad,a.rotation[1]*vo.torad,a.rotation[2]*vo.torad)),this.setColorRamp(a.colors),this.pe.textures.has(a.type)||-1!==xo.indexOf(a.type)&&this.pe.textures.make(a.type),this.texture=this.pe.textures.get(a.type),this.texture||console.log("this texture is undefined !!"),this.endTime=a.endTime||-1,this.luma=a.luma,this.makeGeometry(a),this.count=e,a.oriented){var i=new t.InterleavedBuffer(new Float32Array([0,0,0,0,-.5,-.5,0,0,0,0,0,0,.5,-.5,0,0,0,0,0,0,.5,.5,0,0,0,0,0,0,-.5,.5,0,0]),8);this.geometry.setAttribute("position",new t.InterleavedBufferAttribute(i,3,0)),this.geometry.setAttribute("uv",new t.InterleavedBufferAttribute(i,2,4)),this.geometry.setIndex(new t.BufferAttribute(new Uint16Array([0,1,2,0,2,3]),1)),this.interleavedBuffer=new t.InstancedInterleavedBuffer(new Float32Array(e*Mo.byteLength),28,1).setUsage(t.DynamicDrawUsage)}else this.interleavedBuffer=new t.InterleavedBuffer(new Float32Array(e*Mo.byteLength),28).setUsage(t.DynamicDrawUsage);this.geometry.setAttribute("position",new t.InterleavedBufferAttribute(this.interleavedBuffer,3,0)),this.geometry.setAttribute("startTime",new t.InterleavedBufferAttribute(this.interleavedBuffer,1,3)),this.geometry.setAttribute("uvLifeTimeFrameStart",new t.InterleavedBufferAttribute(this.interleavedBuffer,4,4)),this.geometry.setAttribute("velocityStartSize",new t.InterleavedBufferAttribute(this.interleavedBuffer,4,8)),this.geometry.setAttribute("accelerationEndSize",new t.InterleavedBufferAttribute(this.interleavedBuffer,4,12)),this.geometry.setAttribute("spinStartSpinSpeed",new t.InterleavedBufferAttribute(this.interleavedBuffer,4,16)),this.geometry.setAttribute("orientation",new t.InterleavedBufferAttribute(this.interleavedBuffer,4,20)),this.geometry.setAttribute("colorMult",new t.InterleavedBufferAttribute(this.interleavedBuffer,4,24)),this.geometry.boundingSphere=new t.Sphere,this.geometry.boundingSphere.radius=3;let r=t.AdditiveBlending;switch(a.blending){case"sub":case"subtractive":r=t.SubtractiveBlending;break;case"multi":case"multiply":r=t.MultiplyBlending;break;case"normal":r=t.NormalBlending;break;default:r=t.AdditiveBlending}var s={worldVelocity:{value:new t.Vector3},gravity:{value:new t.Vector3},timeRange:{value:0},time:{value:0},timeOffset:{value:0},frameDuration:{value:0},numFrames:{value:0},rampSampler:{value:null},colorSampler:{value:null},scale:{value:.5*window.innerHeight},luma:{value:this.luma?this.pe.luminosity:1},alphaTest:{value:a.alphaTest}};this.material=new t.ShaderMaterial({defines:{USE_ORIENTATION:a.oriented},uniforms:s,vertexShader:ko(a.tween||"linear")+"\nprecision mediump float;\nprecision mediump int;\n\n#ifdef USE_ORIENTATION\n\t//uniform mat4 worldViewProjection;\n\t//uniform mat4 world;\n\tattribute vec3 offset;\n\tattribute vec4 orientation;\n#else\n    uniform float scale;\n#endif\n\nuniform vec3 worldVelocity;\nuniform vec3 gravity;\nuniform float timeRange;\nuniform float time;\nuniform float timeOffset;\nuniform float frameDuration;\nuniform float numFrames;\n\nattribute vec4 uvLifeTimeFrameStart;\nattribute float startTime;\nattribute vec4 velocityStartSize;\nattribute vec4 accelerationEndSize;\nattribute vec4 spinStartSpinSpeed;\nattribute vec4 colorMult;\n\nvarying vec2 outputTexcoord;\nvarying float outputPercentLife;\nvarying vec4 outputColorMult;\nvarying mat2 rotationMtx;\n\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n//#include <clipping_planes_pars_vertex>\n\nvec3 lerp( vec3 a, vec3 b, float p ){ return a + (b - a) * p; }\n\nvoid main() \n{\n    float lifeTime = uvLifeTimeFrameStart.z;\n    float frameStart = uvLifeTimeFrameStart.w;\n    float startSize = velocityStartSize.w;\n\n    //vec3 velocity = (modelMatrix * vec4(velocityStartSize.xyz, 0.0)).xyz + worldVelocity;\n\t//vec3 acceleration = (modelMatrix * vec4(accelerationEndSize.xyz, 0.0)).xyz + gravity;\n\n    //vec3 velocity = velocityStartSize.xyz + worldVelocity;\n\t//vec3 acceleration = accelerationEndSize.xyz + gravity;\n\n\tvec3 velocity = velocityStartSize.xyz + (inverse(modelMatrix) * vec4(worldVelocity, 0.0)).xyz;\n\tvec3 acceleration = accelerationEndSize.xyz + (inverse(modelMatrix) * vec4(gravity, 0.0)).xyz;\n\n    float endSize = accelerationEndSize.w;\n    float spinStart = spinStartSpinSpeed.x;\n    float spinSpeed = spinStartSpinSpeed.y;\n\n    float localTime = mod((time - timeOffset - startTime), timeRange);\n    //localTime = tween( localTime );\n    float percentLife = localTime / lifeTime;\n    percentLife = tween( percentLife );\n\n    vec3 posEnd = velocity * lifeTime + acceleration * lifeTime * lifeTime;\n\n    float frame = mod(floor(localTime / frameDuration + frameStart), numFrames);\n    float uOffset = frame / numFrames;\n    float u = uOffset + (uv.x + 0.5) * (1. / numFrames);\n\n    outputTexcoord = vec2(u, uv.y + 0.5);\n    outputColorMult = colorMult;\n\n    float size = mix(startSize, endSize, percentLife);\n\tsize = (percentLife < 0. || percentLife > 1.0) ? 0.0 : size;\n\n\tfloat s = sin(spinStart + spinSpeed * localTime);\n\tfloat c = cos(spinStart + spinSpeed * localTime);\n\n    #ifdef USE_ORIENTATION\n\t\t\n\t\tvec4 rotatedPoint = vec4((uv.x * c + uv.y * s) * size, 0., (uv.x * s - uv.y * c) * size, 1.);\n\t\t//vec3 center = velocity * localTime + acceleration * localTime * localTime + position + offset;\n\t\tvec3 center = (posEnd * percentLife) + position + offset;\n\n\t\tvec4 q2 = orientation + orientation;\n\t\tvec4 qx = orientation.xxxw * q2.xyzx;\n\t\tvec4 qy = orientation.xyyw * q2.xyzy;\n\t\tvec4 qz = orientation.xxzw * q2.xxzz;\n\n\t\tmat4 localMatrix = mat4(\n\t\t    (1.0 - qy.y) - qz.z,  qx.y + qz.w,  qx.z - qy.w, 0,\n\t\t    qx.y - qz.w, (1.0 - qx.x) - qz.z, qy.z + qx.w, 0,\n\t\t    qx.z + qy.w, qy.z - qx.w, (1.0 - qx.x) - qy.y, 0,\n\t\t    center.x, center.y, center.z, 1\n\t\t);\n\t\trotatedPoint = localMatrix * rotatedPoint;\n\t\tgl_Position = projectionMatrix * modelViewMatrix * rotatedPoint;\n\n\t#else\n\n\t    //vec3 pos = position + velocity * localTime + acceleration * localTime * localTime;\n\n\t    vec3 pos = (posEnd * percentLife) + position;\n\t    \n\t    vec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );\n        //gl_PointSize = size * 1.5 * ( scale / length( mvPosition.xyz ) );\n        gl_PointSize = size * 1.5 * ( scale / - mvPosition.z );\n\n        mat2 r = mat2( c, -s, s, c);\n        r *= 0.5; r += 0.5;  r = r * 2.0 - 1.0;\n        rotationMtx = r;\n\n        gl_Position = projectionMatrix * mvPosition;\n\n\t#endif\n\n\toutputPercentLife = percentLife;\n\n\t#include <logdepthbuf_vertex>\n\t//#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\n\nuniform sampler2D rampSampler;\nuniform sampler2D colorSampler;\nuniform float luma;\nuniform float alphaTest;\n\nvarying vec2 outputTexcoord;\nvarying float outputPercentLife;\nvarying vec4 outputColorMult;\nvarying mat2 rotationMtx;\n\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n//#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t//#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\n\tvec4 diffuseColor = texture2D( rampSampler, vec2(outputPercentLife, 0.5) ) * outputColorMult;\n\n    vec2 uv = vec2(0.0);\n    #ifdef USE_ORIENTATION\n        uv = outputTexcoord;\n\t#else\n\t    uv = gl_PointCoord;\n\t    uv -= 0.5; uv = uv * rotationMtx; uv += 0.5;\n\t#endif\n\n\t// texture\n\tdiffuseColor *= texture2D( colorSampler, uv );\n\n\tif ( diffuseColor.a < alphaTest ) discard;\n\n\tdiffuseColor.rgb *= luma;\n\n\tgl_FragColor = diffuseColor; \n\t#include <fog_fragment>\n\n}\n",side:a.oriented?t.DoubleSide:t.FrontSide,blending:r,depthTest:!0,depthWrite:a.depthWrite,transparent:a.transparent,forceSinglePass:a.single||!1,fog:a.fog||!1}),this.renderOrder=a.renderOrder||0}}draw(e=0){if(!this.material.uniforms)return;const t=this.material.uniforms;this.time+=this.pe.delta,t.time.value=this.time,t.timeOffset.value=e,t.scale.value=this.pe.hscale,t.luma.value=this.luma?this.pe.luminosity:1,-1!==this.endTime&&this.time>=this.endTime&&this.pe.remove(this.name)}dispose(){this.parent.remove(this),this.geometry.dispose(),this.material.dispose(),this.color.dispose()}raycast(){}clone(e){return void 0===e&&(e=this.pe.createEmitter(this.texture)),e.time=0,e.endTime=this.endTime,e.geometry=this.geometry,e.material=this.material.clone(),e.material.uniforms.rampSampler.value=this.color,e.material.uniforms.colorSampler.value=this.texture,super.copy(e),this.num++,e.name=this.name+this.num,e}}class So extends Map{constructor(){super()}dispose(){this.forEach((e=>{e.dispose()})),this.clear()}add(e,t){this.has(e)||this.set(e,t)}make(e){if(!this.has(e)){let t=this["make"+e[0].toUpperCase()+e.substring(1)]();this.set(e,t)}}makePixel(){const e=[];for(let t=0;t<2;++t)for(let t=0;t<2;++t)e.push(1,1,1,1);return vo.createTextureFromFloats(2,2,e)}makeBasic(){const e=[0,.2,.7,1,.7,.2,0,0],t=[];for(let a=0;a<8;++a)for(let i=0;i<8;++i){let s=e[i]*e[a];t.push(s,s,s,1)}return vo.createTextureFromFloats(8,8,t)}makeCube(){let e=document.createElement("canvas");e.width=e.height=8;const t=e.getContext("2d");return t.fillStyle="rgba(255,255,255,1.0)",t.fillRect(2,2,4,4),vo.toTexture(e)}makeCloud(){let e=16,t=document.createElement("canvas");t.width=t.height=e;const a=t.getContext("2d");let i="rgba(255,255,255,1)",s="rgba(255,255,255,0)",r=a.createRadialGradient(8,6.4,0,8,6.4,6.4);return r.addColorStop(.3,i),r.addColorStop(1,s),a.fillStyle=r,a.fillRect(0,0,e,e),r=a.createRadialGradient(6.4,9.92,0,6.4,9.92,5.6),r.addColorStop(.3,i),r.addColorStop(1,s),a.fillStyle=r,a.fillRect(0,0,e,e),r=a.createRadialGradient(4.32,6.4,0,4.32,6.4,4.16),r.addColorStop(.2,i),r.addColorStop(1,s),a.fillStyle=r,a.fillRect(0,0,e,e),r=a.createRadialGradient(12.16,9.6,0,12.16,9.6,3.68),r.addColorStop(.2,i),r.addColorStop(1,s),a.fillStyle=r,a.fillRect(0,0,e,e),vo.toTexture(t)}makeRound(){let e=document.createElement("canvas");e.width=e.height=16;const t=e.getContext("2d"),a=t.createRadialGradient(8,8,0,8,8,8);return a.addColorStop(0,"rgba(255,255,255,1)"),a.addColorStop(.3,"rgba(255,255,255,0.1)"),a.addColorStop(.9,"rgba(255,255,255,0)"),a.addColorStop(1,"rgba(255,255,255,0)"),t.fillStyle=a,t.fillRect(0,0,16,16),vo.toTexture(e)}makeRound2(){let e=document.createElement("canvas");e.width=e.height=16;const t=e.getContext("2d"),a=t.createRadialGradient(8,8,0,8,8,8);return a.addColorStop(0,"rgba(255,255,255,1)"),a.addColorStop(.9,"rgba(255,255,255,1)"),a.addColorStop(1,"rgba(255,255,255,0)"),t.fillStyle=a,t.fillRect(0,0,16,16),vo.toTexture(e)}makeDonut(){let e=document.createElement("canvas");e.width=e.height=32;const t=e.getContext("2d"),a=t.createRadialGradient(16,16,0,16,16,16);return a.addColorStop(0,"rgba(255,255,255,1)"),a.addColorStop(.9,"rgba(255,255,255,0.1)"),a.addColorStop(1,"rgba(255,255,255,0)"),t.fillStyle=a,t.beginPath(),t.arc(16,16,16,0,2*Math.PI,!1),t.arc(16,16,8,0,2*Math.PI,!0),t.fill(),vo.toTexture(e)}makeBubble(){let e=document.createElement("canvas");e.width=e.height=64;let t="rgba(0,255,255,0)";const a=e.getContext("2d"),i=a.createRadialGradient(25.6,25.6,0,32,32,32);return i.addColorStop(.4,t),i.addColorStop(.9,"rgba(0,255,255,0.6)"),i.addColorStop(.99,"rgba(0,255,255,1)"),i.addColorStop(1,t),a.fillStyle=i,a.fillRect(0,0,64,64),a.fillStyle="rgba(255,255,255,1)",a.beginPath(),a.arc(44.8,25.6,8.96,0,2*Math.PI,!1),a.fill(),a.beginPath(),a.arc(12.8,41.6,3.2,0,2*Math.PI,!1),a.fill(),vo.toTexture(e)}makeSmoke(){let e=document.createElement("canvas");e.width=e.height=64;const t=e.getContext("2d");let a=new Image;a.src=Eo;let i=vo.toTexture(e);return a.onload=function(){t.drawImage(a,0,0),i.needsUpdate=!0},i}makeCircle(){let e=document.createElement("canvas");e.width=e.height=64;const t=e.getContext("2d");return t.strokeStyle="white",t.lineWidth=4,t.beginPath(),t.arc(32,32,30,0,2*Math.PI),t.stroke(),vo.toTexture(e)}makeField(){let e=document.createElement("canvas");e.width=e.height=64;const t=e.getContext("2d"),a=t.createLinearGradient(0,0,0,64);return a.addColorStop(0,"rgba(255,255,255,0)"),a.addColorStop(.8,"rgba(255,255,255,0.4)"),a.addColorStop(1,"rgba(255,255,255,0)"),t.fillStyle=a,t.fillRect(24,0,16,64),vo.toTexture(e)}makeStar(){let e=document.createElement("canvas");e.width=e.height=64;const t=e.getContext("2d"),a=t.createRadialGradient(32,32,0,32,32,32);return a.addColorStop(0,"rgba(255,255,255,0.5)"),a.addColorStop(.5,"rgba(255,255,255,0.1)"),a.addColorStop(.9,"rgba(255,255,255,0)"),t.fillStyle=a,this.star(t,32,6.4,32,32,3),this.star(t,32,25.6,32,32,3),vo.toTexture(e)}makeOcto(){let e=document.createElement("canvas");e.width=e.height=64;const t=e.getContext("2d"),a=t.createRadialGradient(32,32,0,32,32,32);return a.addColorStop(.4,"rgba(255,255,255,0.2)"),a.addColorStop(1,"rgba(255,255,255,0.4)"),t.fillStyle=a,this.star(t,25.6,22.4,32,32,6),t.strokeStyle="rgba(255,255,255,0.1)",t.lineWidth=6,t.stroke(),vo.toTexture(e)}star(e,t,a,i,s,r){let n,o,c;e.beginPath(),e.moveTo(i+t,s);for(var h=1;h<=2*r;h++)h%2==0?(c=h*(2*Math.PI)/(2*r),n=i+t*Math.cos(c),o=s+t*Math.sin(c)):(c=h*(2*Math.PI)/(2*r),n=i+a*Math.cos(c),o=s+a*Math.sin(c)),e.lineTo(n,o);e.closePath(),e.fill()}}const Eo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAPOklEQVR42rWb224dRRaGq\n7r30Tu2Y5MhmYsZRZqbeahBiCvgPnCBOCeAEEjcI/E2vAfiYqJJgIHE2/Y+Vk2tzf9Ji2XZDsmkpeXu3V1dXf9f61Sr2316wa3Wmj/++GO\nTrkkvSTo3aDKUdB999JHJoMlEYud72tk13ce53kmmX5PWNr///vvpgw8+yPfv30+llPzee+917Xd68ODBM4+/f1HwbYd04XhgouNqx3re0\nF3rc85DtUntmK6zk7G11XHh0fZns9nk1WqVjYR23J2ennZtn7788sv6UgkA/Hq97mzwbevbbwMzEMBJGPj290HnDrC2qe3IzrV7N2oXSR2\nZ2PN4dNbW972JjSOfnJx0o9EoDwaD+sUXX7w8Ah4+fJgbw7nWCphRztnkDzMr0Wwx8ISWVNvTXrNv14xI7u+4LmLpE82xbcd+A50nk0kdj\n8fJCHnzzTfTN998U18KAW+88UY+OjoypjsNdtTGMLQJYXYBDUjTjqC+nYD1XtVbu7Ht23lIsfPW936TiZ0HOP3YRLTNNKG2LW2aVp6dnqZ\n/vfZa/fbbb//vBJiDMcbtgTv71aDs2IMvkl4AbKDJ9tZW94w0k0nmcsOO7bp+j0TErO1nOgeRmIqZQ3UkNlOYp58eP0qL5bJ+99139YUJ+\nP77702l8ttvv51ff/31bjab5f39/a7h3wFv7GP7nfMPqC8qW5htAd8ToKTr+9pXAZ+atH72pCkFMtVmg48Ag55Rt9tt3pRSbx4epPv3H+T\nPP/+8mrP89NNPn48AA95sKw+Hw7xcLvPh4WG3t7eXmhb0+AER4L3/UOKdYFbbPQOs6xknh1MUMfQ71bkiDaO/KvFRZrsD1Hf1xmy2PTy8m\nc0pWli07cMPP4SEP0fAu+++m9ssAz5Pp1MzAXuone+c+mcAAEr9V+0xh5ns3druOe0ZVbv++zERoUdbpOreufZ6Bu1LbVsjoLTxFXtuKaV\nmF1v/NAE//PCDObtk4J8+fZru3LnTNfXPTc0MuBExMBNgxph5+YbeacN0Z+8pT2qqaIYBu6H7JtYmy/tLcJY7LfBaBpkci6zN76aSa3DC6\nbkJuHfvns18Oj8/z/P5PN29e7c3AizWNsmEJ0DrgcwMmnBDx5yHgJGAkzNwL2qfaEN/zvvzLHwBJlDYk1hJc5KN+Zl9wOPHj/Nbb72VF4t\nFMqfSJN26das7Pj7uBDzLAe5mzhwbaqvBzQAmQBBVNPO3mhziH3R96tp2uncm4N6nmPbZPWvA4hjdcRZwSLDUOX3yySfPRsBXX31l6tKSi\n3GaTmfN9g924Jsz9NmeATcbTnr4K03+0eS2AwEJaEMS+L/p2mmTousHTY5s77z/EBIEHFNgNrdEADcBbBXnye9nIoDts88+a1502Lz/yLx\n+3zIt4rl1aLO/51TxZpN/Nvm7wJ+LfYvtM9vL8++3xsf2WwNeYCYCuqd8YExYM6J1viOlJqSi8oRT38Y0BALIqdCCawkwtd85+G4X5bu+R\nX2lqR2q6LzrRMDvaqbO9PChG3wvMzlq+4NUKzNETnCg/ZA0mO51Du1Z2vBEAODxA7TBNOgju8VWtRUlJFxKQGtkM52hAG+q2TQQE2K+4vq\nrTf5CMqP9mFlxWeG+zW7F4THrzjG6sBjziixwC5PWbi3wtIWMVZOiBZT1h6ZU7a8mwICLva4dDGgjsH9tcstASI2P5KTMBI6lytPWybQaM\nFskaXZqO6e21nfVnri+lmrPlBsAyGSsxVYncGcysRVpsPcBkmrgyTad06xXEQD4rIXHrB0NmzCbNpA7Lvk4tt8Cf2gDx4sbcFP1LIIEaso\nCiDiv2L0SiIna9HZeA06ocq311EzA5RhbgTtX25Eky/aL4WlixxtpzPZSAnTB1H/MzMrmqmb9WECxa0LdDQjQAAa0IaZr1WbgR5yzKZKNk\nvtjCpgb8R1Vt/b4lTFaAilyxGM0Aa2wRZj8BqZxrQbsCViV0Pmr2ncCfSwSpiQ72DGgdT+eewx4BxBCmHnsH8FubdYP3RpiWWs9MVDSwCM\nIwDnqEUVttiKhxHDYB/CEExzPvpzbEbMPYInXhJ4Bh7oAMvAAQ2aIWbB1FD1Ybvt1hsBh0zM3tuzMp9CuyVIkFJMLBAC+2kSlDAl7YvUVN\n8PTkOWh5iP6Ql19Dc9XiaKHD+cK99LepcUrSYdPCmk096+UYJ0T1Ru+FVHjAgEsFSlJ5STV1AMkexJ+Q8bEgc8BTGJgYZZzJILjIPSJhi7\nl+akTohFDgV4TCgV+ASHyE7oeCCilsKQdNfDYsLdjzmGnFD1nzM4ldT7AebBe2OL5DgE7lR9MwfVXQypcHQlryZmZAATJB3Bf2tXbvXfFk\nzuwPmxBCFrRexAcR3XHriPweG/Yxy0z44B3oFJIhM4VwRYco/4mfyCg5ceoPwMO+zBoPDkq6BxbsN84o33s6wrANYIPYwF8hQyBXDkS5k1\nOjASIwkmTDnsC6DiWtHyUsGMywL1QAq9h9qNtR9WOYCIZRJN4Lap4If/HSZIuC/wTaQAEEA53aYiREDVggODdA7CZZXgu6ekYBGEngI4zG\nDeARo2IfiX5NNcdF8BpjwN8auC1xxkWHwW8BpD7Q0DvvHzPAJWCjmuq45zyGPWP6oq6M2gGGK6zlUsIyvE8M49msAc4CRAE1Fqf5Jznvk5\nwqQ/ggVRecTaAQTt8FMiJWj0DdKrvPLPi8JaiZvDg0TzYIhGAAwzgVxYeqf6wWML+2/kzTxraEwnABdgegIPg8SeszRvwvSb7So6IGBlwJ\ngK9Id3lAdFEop+4wkQAsXZkFmxeE7cR+FMtnObtvHOA9HExDCZMAEAhvFGYzJSuAE97rwXMmDAPfJv4yuwa71/DbBdWeZw3Mpg5A0rI08J\nnIQJ8kkQekDwBdnN0gjGx6STEf9oQCuNM9aFymzwBPO8a8EiJ4RIwqikMCH0ihcRpHULjBkyEQQiICYm30S4scGKGiCNMHrykwjj9egn91\n0tUv9qmWS/BZIonR9qw1OJnFRKgKnJKLIr0qgF4Aipg48tIVn+sA3CWGsAaH8IAQRM0KZKcaQRoSKgURoPTJLp4AjTjC6W+Oz8gItZMhpb\nHjgCpobSADVUfQgDnRcC+r+UxKzg8SQ5ZYQxxSNyKN4EMQHfORwQJx+da+xdMgCTIRw9INudv0sMGzpAECNaoBKtcFatBgMtBa6JfAVy0/\nwg67itLdaq6zt6XIc9Y6Fqv945FYZC2tKd/+7iiMhBIGJHrMzAqv8w8xRDqf0HVAZwlHPs4nJ2UeC2S4AlWZCHZWVzTZ5YJzBUeF/5ZBn4\n34FgOJw9A3GupiSovN0XGOFaBorML4FNMlIJEP1QFIprLhvhOe2npxNoqAXqiPs0kfm3X5+3KihenmL1JJCChyiEhwr4PAR8iBGSi/hFIu\nSZFjibC7EftoJK8dZ4dM4QYy/9/bccmv7XrLIm3XrtUbquxKlwbCdF2s3/1Hew8xvUcB891hOtIyPUJo7H/qBXYvG0DJT0PDbgRq7XATyy\nHCYUCbR0U8EJA1AJf0CgskTnHbwZ+hbevkflos5yL/dA+fB5nUlj+4tQE/D/SgCxCfpPtky1Gjaq75XD44tNXbgEQzSIukhJZWIjTyautB\nx8JiWbCfQKdEPry1R/z9E2eKuxx75oQKNL88hlJEADLvQMY1Tb7zC/k6RsHehVUGm3iOM58zBTZs3kNKgrLBXtX9Zd8vwJOoTApDK5jvRB\nt8olQVD1fDI3LYcBWsXzC93p6TcXD1hKWwcEfsOFf4nlAx3UGROeleXa3Cly68hd+jklZ+fsBHwngZFT5HgEYbXR8oj2VJexzKYJKzBdi3\nVHiNSQ60Q0AciYRspw/VcX5X/S8gZ4/17qAfs/1bsC/GYoEsF0sZjIb0aGFslTiCzBXmKiE05jxcR67DoAhwKktYZM3PQkT+K9kqDCdjBA\n5wY1ejvpMMPsPJXwqnAP4dEkeTgaI7fGd0MS9UCnGOKRAABJtPPgTzKtwLhCNZhnAx9qva7U6RZ3hH3SPOce5osJWDlFZoNOAK7Qggu/8C\nlBveW8oC6vKyLZ8RNUEMr3jZPMLGsBCRqWqJEDVacpCBc9fZX4qe9WO+3DoAv4katgFEwgLouioiMdJlTMADUO1J5KWib2Q6olgJgHgica\nBatY8YWu1/012fyo175y/8vn/mUUCCiWMg3+8cHlAICFUZtbrddJXoYWZ452/V2m7jr36d3GQo2tLvvKgYhPMASe6DuaysEovs45NKzWfE\nqIF/t9NfpYjJOwl7XdcXFgMeVOIBJydnSX77lY328CQWAcE4EbHzCzhaIEAIBQsmf1YzFyR4wsgaj4LobrIPB5ZUcSFQsBnbwYNF4uhK7T\nAenv0KLUvRJWKJr684CMEPl4sOL743Q7FCcJjfI3Fbw8Y4VU3ak07/JEnEfWXFLROmkl9IZVS7DtI+xTw0q/EsoGFiB9//DG1DyVT3/fVv\nSgZmWgg5Og4RpPs1G/DQH3CErw64NAA2s0hA63w4ZE+Q4EEKe5bwYrqG/jgBC9qgTeH27dvJ3VQmtqU4XDYt474jLWYkHqhjuTvfBjFmgF\nNCCqPFgAe/xBJAnwN959KqGgV/c5kmTjya78TjERgEsbccrWqv/z8c9o/OBjq32SSr7pCArNuh/xGRRXa8DPk9ZjAGWCYccwgRIu42oTA5\nN8UY4oQR0SxRMjVBNmuJ8Js5uuvv+7MFHwMj6s5acWaNl6FfbE01PgXCm9zpyVr7B+zCNEBcMUVY88k29A+VqbytRpwlXmEjxJZb7Px1ma\ntGUaVS9Zmx4EcoodpyRqtQGhLP8Gn4PBYB5yiBY6guNXnIgCTkJOsLv4jqOaaj5NM9LuSHOWUlyEk4jCLTMXab3B8OFIvgPR+QhKrwHGro\nSr8fFoAGd4HsF7Hthk49opG4OVjfZ/j0rZt2+y4DbSgVSEZox/fnzO9izMPcDAEAp6LDDSBZMMGvml+gvjrFzokS+uUk2lHVOfdrJO2bjY\n6NFEmJxIgwAvA/TMrYL2wQcALb1ETmDGfpDDzDPaSLLAivMtbrVZpcX6+y0G6JlnpbAAaS14cAzhsgYCXQAL7uK4v7C8T8gpy9fl8npeNh\nJZ71L7ryUYhwUsKx+T7L5WASAJSEUjBWfK7bQCOIGi/S1lLazadTtPBwUF955179r+A9g9QXq13MV2qXtvxM4Fn+x+D0fC1BkndygAAAAB\nJRU5ErkJggg==";class Fo extends t.Group{constructor(e){super(),this.scene=e||null,this.isGl2=!0,this.emitters=new Map,this.textures=new So,this.loader=null,this.now=0,this.last=0,this.delta=0,this.elapsed=0,this.num=0,this.hscale=.5*window.innerHeight,this.luminosity=1,this.matrixAutoUpdate=!1,this.matrixWorldAutoUpdate=!1}updateMatrixWorld(e){super.updateMatrixWorld(e),null===this.scene&&this.update()}get(e){return this.emitters.has(e)?this.emitters.get(e):null}add(e,t){if(e.isPoints)return void super.add(e);e.name||(e.name="PP"+this.num++),this.remove(e.name),e.model&&yo[e.model]&&(e={...yo[e.model],...e});let a=new Ao(this,e);return this.emitters.set(e.name,a),a}remove(e){if("string"==typeof e||e instanceof String){if(!this.emitters.has(e))return;this.emitters.get(e).dispose(),this.emitters.delete(e)}else if(e.isPoints)return void super.remove(e)}addTexture(e,a,i=!0){this.textures.has(e)?console.log("this name of texture is already take !"):"string"==typeof a?(this.loader||(this.loader=new t.TextureLoader),this.loader.load(a,(a=>{a.flipY=!1,i&&(a.colorSpace=t.SRGBColorSpace),this.textures.add(e,a)}))):a.isTexture&&(a.flipY=!1,this.textures.add(e,a))}load(e){const t=e.substring(e.lastIndexOf("/")+1,e.lastIndexOf("."));var a=new XMLHttpRequest;a.open("GET",e),a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status||0===a.status){let e=JSON.parse(a.responseText);for(let t in e)this.add(e[t])}else console.error("Couldn't load ["+t+"] ["+a.status+"]")}.bind(this),a.send()}resize(e){this.hscale=.5*e}onresize(e){this.hscale=.5*e}loop(e){this.delta=e,this.emitters.forEach((e=>{e.draw()}))}update(e){this.now=void 0!==e?e:Date.now(),this.delta=.001*(this.now-this.last),this.elapsed+=this.delta,this.last=this.now,this.emitters.forEach((e=>{e.draw()}))}dispose(e=!0){this.emitters.forEach((e=>{e.dispose()})),this.emitters.clear(),e&&this.textures.dispose(),this.num=0}addBlock(e,t){let a=e[1]<=4?-2:0,i=yo.getColor(t),s=i[0],r=i[1],n=i[2];i.length>3&&(s=i[3],r=i[4],n=i[5]),e[0]+=.5,e[2]+=.5,this.add({position:e,colors:[s,r,n,1,s,r,n,0],renderOrder:a,...yo.addBlock})}delBlock(e,t){let a=e[1]<=4?-2:0,i=yo.getColor(t),s=i[0],r=i[1],n=i[2];e[0]+=.5,e[2]+=.5,e[1]+=.5;let o=30;i.length>3&&(o=20,this.add({position:[e[0],e[1]+.375,e[2]],positionRange:[.5,.25,.5],colors:[s,r,n,.5,s,r,n,0],numParticles:10,renderOrder:a,...yo.removeBlock}),s=i[3],r=i[4],n=i[5]),this.add({position:e,positionRange:[.5,.5,.5],colors:[s,r,n,.5,s,r,n,0],numParticles:o,renderOrder:a,...yo.removeBlock})}removePlayerTrail(e){this.remove("PlayerTrail_"+e)}onPlayerWalk(e,t,a){let i=this.get("PlayerTrail_"+t);null===i&&(i=this.addTrail({name:"PlayerTrail_"+t,...yo.playerMove}));let s=e.toArray();s[1]+=.2;let r=yo.getColor(a),n=[r[0],r[1],r[2],.75,r[0],r[1],r[2],0];r.length>3&&(n=[r[0],r[1],r[2],.75,r[3],r[4],r[5],0]),i.birthParticles(s,n)}onVehicleDrive(e,t){let a=this.get("VehicleTrail_"+t);null===a&&(a=this.addTrail({name:"VehicleTrail_"+t,...yo.vehicleMove})),a.birthParticles(e.toArray())}onBazookaFire(e,t){let a=this.get("BazookaTrail_"+t);null===a&&(a=this.addTrail({name:"BazookaTrail_"+t,...yo.bazookaFire})),a.birthParticles(e.toArray())}onExplosion(e){this.add({position:e.toArray(),...yo.explosion})}}new t.Vector3,new t.Vector3,new t.Mesh(new t.SphereGeometry(.03),new t.MeshBasicMaterial({transparent:!0})),new t.Vector3,new t.Vector3,new t.Mesh(new t.SphereGeometry(.03),new t.MeshBasicMaterial({transparent:!0})),new t.PlaneGeometry;new t.CylinderGeometry(1,1,1).rotateX(Math.PI/2),new t.Object3D,new t.Vector3,new t.Vector3,new t.Color("red");const zo={PHY:"0.5.0",PHYSX:"5.06.10",HAVOK:"1.2.1",JOLT:"0.39.0",RAPIER:"0.20.0",OIMO:"1.2.4",AMMO:"3.2.6"};class Ro{constructor(e={}){this.noBuffer=!0,this.stats=new Pt,this.geo=new U,this.mat=new $,this.math=A,this.pool=Ye,this.version=zo.PHY,this.Version=zo,this.engine="",this.jointVisible=!1,this.utils=new To(this),this.collision=new zt(this),this.viewSize=null,this.debug=!1,this.delta=0,this.debuger=null,this.mouseActive=!1;const a=this;let i=null,s=!1,r=!1,n=!1,o=null,c=null,h=null,l=!1,b=!1,d=!1,u=!0,f=!1,m=null,g=!1,y={t1:0,t2:0,t3:0,t4:0},x=null,w=null,v=null,k=!1,j=!0,M=null,S=null,E=0,F=0,z="",R=null,P=null,T=null;const I=new te,B=new ee(60),D={start:0,end:0,startTime:""};let L=()=>0,O=()=>{},q=()=>{},V=()=>{},G=[],H=[],_=[],N=null;const K={fps:60,fixe:!0,full:!1,substep:2,gravity:[0,-9.81,0]};let J=null,W={};this.flow={stamp:0,current:"",key:[],tmp:[],add:[],remove:[]},this.reflow={ray:[],stat:{fps:0,delta:0,ms:0},point:{},contact:{},velocity:{}};const X={};this.scene=null,this.scenePlus=null,this.ws=1,this.uws=1,this.garbage=[],this.tmpMesh=[],this.instanceMesh={},this.tmpTex=[],this.disposeTmp=()=>{let e,t,a;for(e in this.tmpMesh){if(a=this.tmpMesh[e],a.children)for(t in a.children)this.disposeMesh(a.children[t]);this.disposeMesh(a),a.parent&&a.parent.remove(a)}for(e in this.tmpMesh=[],this.tmpTex)this.tmpTex[e].dispose();this.tmpTex=[]},this.disposeMesh=e=>{e.geometry&&e.geometry.dispose(),e.dispose&&e.dispose()},this.setStep=e=>{q=e},this.debugMode=e=>{this.setDebugMode(e)},this.setDebugMode=e=>{this.debug=e},this.useRealLight=e=>{this.mat.useRealLight(e)},this.getSetting=()=>K,this.setGravity=e=>{e&&(K.gravity=e),this.post({m:"setGravity",o:{gravity:K.gravity}})},this.set=(e={})=>{K.fixe=void 0===e.fixe||e.fixe,K.full=void 0!==e.full&&e.full,K.gravity=e.gravity?e.gravity:[0,-9.81,0],K.substep=e.substep?e.substep:1,K.fps=e.fps?e.fps:60,this.ws=void 0!==e.worldScale?e.worldScale:1,this.uws=1/this.ws,e.key&&V(),X.body.setFull(K.full),this.initArray(K.full),F=0,d=l,u=!d,this.jointVisible=e.jointVisible||!1,u&&B.setFramerate(K.fps);const t={...e,...K,ArPos:W,isTimeout:d,outsideStep:u};this.post({m:"set",o:t})},this.activeMouse=(e,t)=>{x||(x=new Ct(e,t,this)),this.mouseActive=!0},this.mouseMode=(e,t)=>{x&&x.setMode(e,t)},this.getTime=()=>ee.now(),this.readTime=e=>ee.format_time(e),this.startTime=()=>D.startTime,this.getTimeTest=()=>y,this.setMaxFps=e=>{},this.getMouse=()=>x?x.mouse:null,this.setMaxAnisotropy=e=>{Ye.maxAnisotropy=e},this.setAddControl=e=>{V=e},this.setPrevUpdate=e=>{},this.setPostUpdate=e=>{q=null!==e?e:()=>{}},this.setAzimut=e=>{L=e},this.setRenderer=e=>{P=e,Ye.renderer=P},this.setKey=(e,t)=>I.setKey(e,t),this.getKey=()=>I.key,this.getKey2=()=>I.key2,this.getAzimut=()=>L(),this.setContent=e=>{g||(T=e,T.add(this.scene),T.add(this.scenePlus),g=!0)},this.message=e=>{let t=e.data;t.Ar&&(J=t.Ar),t.reflow&&(this.reflow=t.reflow,this.reflow.stat.delta&&(this.stats.up(this.reflow.stat),F+=this.reflow.stat.delta)),a[t.m](t.o)},this.worldScaler=e=>{const t=this.ws;if(e.pos&&(e.pos=A.worldscale(e.pos,t)),e.localPos&&(e.localPos=A.worldscale(e.localPos,t)),e.massCenter&&(e.massCenter=A.worldscale(e.massCenter,t)),e.pos1&&(e.pos1=A.worldscale(e.pos1,t)),e.pos2&&(e.pos2=A.worldscale(e.pos2,t)),e.shapes){let a,i=e.shapes.length;for(;i--;)a=e.shapes[i],a.size&&(e.shapes[i].size=A.worldscale(a.size,t)),a.pos&&(e.shapes[i].pos=A.worldscale(a.pos,t)),a.v&&(e.shapes[i].v=A.worldscale(a.v,t))}else e.size&&(e.size=A.worldscale(e.size,t)),e.v&&(e.v=A.worldscale(e.v,t))},this.post=(e,t=null,a=!1)=>{1!==this.ws&&("add"!==e.m&&"change"!==e.m||this.worldScaler(e.o)),l?(e.o&&("solver"===e.o.type&&(a=!0),void 0!==e.o.solver&&(a=!0)),a?h.postMessage(e,t):"add"===e.m?this.flow.add.push(e.o):"remove"===e.m?this.flow.remove.push(e.o):h.postMessage(e,t)):w({data:e})},this.addDebuger=()=>{if(null===this.debuger)return this.debuger=new Ea(this),this.scenePlus.add(this.debuger),this.debuger},this.removeDebuger=()=>{null!==this.debuger&&(this.debuger.dispose(),this.debuger=null)},this.vehicle=e=>{let t;switch(e.type){case"raycar":t=new Dn(e,this);break;case"kart":t=new fo(e,this);break;case"helico":t=new uo(e,this)}return t},this.autoRagdoll=e=>{const t=new Sa(e,this);return this.scene.add(t.model),t},this.byName=e=>this.utils.byName(e),this.getScene=()=>this.scene,this.makeView=()=>{},this.resize=e=>{this.viewSize=e,i&&i.resize(this.viewSize.h)},this.init=(e={})=>{"undefined"!=typeof document&&document.currentScript&&document.currentScript.src,D.start=ee.now();const i=e.compact||!1;let n=document.location.href.replace(/\/[^/]*$/,"/"),o=n.split("/");n=o[0]+"//"+o[2]+"/","https://lo-th.github.io/"===n&&(n="https://lo-th.github.io/phy/");let d=e.path||"";d+=i?"compact/":"build/";let u=e.type||"PHYSX",f=u.toLowerCase(),m=f.charAt(0).toUpperCase()+f.slice(1);if(this.engine=u.toUpperCase(),this.initItems(),Ye.materialRoot=this.mat.set.bind(this.mat),e.callback&&(c=e.callback,delete e.callback),l=e.worker||!1,this.scene=new t.Group,this.scene.name="phy_scene",this.scenePlus=new t.Group,this.scenePlus.name="phy_scenePlus",e.scene&&(this.setContent(e.scene),delete e.scene),e.renderer&&(this.setRenderer(e.renderer),delete e.renderer),z=e.envmap||"",r=!!e.useModule&&this.supportModuleWorker(),s=e.useLocal||!1,e.useDecal,Ye.useLocal=s,i)s?r?Ye.load(new URL("../"+d+m+".module.hex","undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:p&&"SCRIPT"===p.tagName.toUpperCase()&&p.src||new URL("Phy.min.js",document.baseURI).href),(function(){a.onCompactDone(e)})):Ye.load(new URL("../"+d+m+".hex","undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:p&&"SCRIPT"===p.tagName.toUpperCase()&&p.src||new URL("Phy.min.js",document.baseURI).href),(function(){a.onCompactDone(e)})):r?Ye.load(n+d+m+".module.hex",(function(){a.onCompactDone(e)})):Ye.load(n+d+m+".hex",(function(){a.onCompactDone(e)}));else if(l){let t,a=r?m+".module.js":m+".min.js";if(t=s?new URL(`./${a}`,"undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:p&&"SCRIPT"===p.tagName.toUpperCase()&&p.src||new URL("Phy.min.js",document.baseURI).href):n+d+a,h=new Worker(t,{type:r?"module":"classic"}),h.postMessage=h.webkitPostMessage||h.postMessage,h.onmessage=this.message,this.noBuffer)e.isBuffer=!1;else{let t=new ArrayBuffer(1);h.postMessage({m:"test",ab:t},[t]),b=!t.byteLength,e.isBuffer=b}this.initPhysics(e)}else e.devMode?this.preLoad(m,e,n):this.preLoadMin(m,e,n,s)},this.supportModuleWorker=()=>{let e=!1;const t={get type(){e=!0}};try{new Worker("data:,",t).terminate()}finally{return e}},this.onCompactDone=e=>{let t=this.engine.toLowerCase(),a=t.charAt(0).toUpperCase()+t.slice(1),i=r?Ye.get(a+".module","H"):Ye.get(a,"H");if(l){let t;try{t=new Blob([i],{type:"application/javascript"})}catch(e){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,t=new BlobBuilder,t.append(i),t=t.getBlob()}if(h=r?new Worker(URL.createObjectURL(t),{type:"module"}):new Worker(URL.createObjectURL(t)),h.postMessage=h.webkitPostMessage||h.postMessage,h.onmessage=this.message,this.noBuffer)e.isBuffer=!1;else{let t=new ArrayBuffer(1);h.postMessage({m:"test",ab:t},[t]),b=!t.byteLength,e.isBuffer=b}this.initPhysics(e)}else{let a=t.toUpperCase(),s=document.createElement("script");s.language="javascript",s.type="text/javascript",s.charset="utf-8",s.async=!0,s.innerHTML=i,document.getElementsByTagName("head")[0].appendChild(s),w=window[a].engine.message,e.message=this.message,this.initPhysics(e)}},this.loadWasmDirect=(e,t,a,i)=>{let s=document.createElement("script");s.src=i+e,document.body.appendChild(s),s.onload=()=>{this.preLoad(a,t,i)}},this.preLoadMin=(e,t,a,i=!1)=>{let s=a+"build/"+e+".min.js";i&&(s=new URL("./"+e+".min.js","undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:p&&"SCRIPT"===p.tagName.toUpperCase()&&p.src||new URL("Phy.min.js",document.baseURI).href));let r=e.toUpperCase();var n=new XMLHttpRequest;n.open("GET",s),n.overrideMimeType("text/javascript"),n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status||0===n.status){let e=document.createElement("script");e.language="javascript",e.type="text/javascript",e.charset="utf-8",e.async=!0,e.innerHTML=n.responseText,console.log(n.responseText),document.getElementsByTagName("head")[0].appendChild(e),w=window[r].engine.message,t.message=this.message,this.initPhysics(t)}else console.error("Couldn't load ["+e+"] ["+n.status+"]")}.bind(this),n.send(null)},this.preLoad=async(e,t,a)=>{let i=a+"build/"+e+".module.js";t.devMode&&(i=a+"src/"+e+".js");let s=await import(i);w=s.engine.message,t.message=this.message,this.initPhysics(t)},this.initPhysics=e=>{""===z?(this.post({m:"init",o:e}),f=!0):this.preloadEnvmap(e)},this.addEnvmap=e=>(R||(R=new Pa({renderer:P,scene:T,...e})),R),this.preloadEnvmap=e=>{R=new Pa({url:z,renderer:P,scene:T,usePmrem:e.usePmrem,useBackground:void 0===e.useBackground||e.useBackground,envBlur:void 0!==e.envBlur?e.envBlur:0,callback:()=>{z="",this.initPhysics(e)}})},this.getPause=()=>k,this.pause=e=>{e!==k&&(k=e,k?this.pausetimout():this.playtimout(),this.post({m:"pause",o:{value:k}}))},this.flowReset=()=>{this.flow={stamp:0,current:"",key:[],tmp:[],add:[],remove:[]}},this.reset=e=>{if(j)return j=!1,void e();G=[],o=null,n=!1,v&&v.resetAll(),x&&x.unSelect(),i&&(i.dispose(),i=null),O=e,q=function(){},this.collision.reset(),this.clearText(),this.clearSoftSolver(),this.cleartimout(),this.flowReset(),this.clearInstance(),this.resetItems(),this.geo.dispose(),this.mat.dispose(),this.disposeTmp(),this.stats.reset(),this.garbage=[],N=null,null!==m&&(m=null),null!==this.debuger&&this.removeDebuger(),this.scenePlus.children=[],this.scene.children=[],this.post({m:"reset",o:{}})},this.clearGarbage=()=>{this.remove(this.garbage),this.clearInstance(),this.garbage=[]},this.clear=e=>{this.reset(e)},this.resetCallback=()=>{O()},this.dispose=()=>{this.reset((()=>{h&&(h.terminate(),h=null),g&&(a.scene.parent.remove(a.scene),a.scenePlus.parent.remove(a.scenePlus),g=!1)}))},this.ready=()=>{D.end=ee.now(),D.startTime=ee.format_time(D.end-D.start),console.log("%c"+this.engine+" %c"+zo[this.engine]+"%c | "+(r?"Module ":"")+(l?"Worker":"Direct")+" "+D.startTime,"font-size:16px","font-size:12px","font-size:12px"),c&&c()},this.start=(e={})=>{this.post({m:"start",o:e})},this.morph=(e,t,a)=>{this.utils.morph(e,t,a)},this.getFps=()=>this.stats.fps.toFixed(0),this.getMs=()=>this.stats.ms.toFixed(1),this.getGpu=()=>this.stats.gpu.toFixed(1),this.getDelta2=()=>this.delta,this.getElapsedTime2=()=>F,this.setDelta=e=>{B.delta=e},this.getDelta=()=>B.delta,this.getElapsedTime=()=>B.elapsedTime,this.doStep=e=>{f&&u&&B.up(e)&&this.post({m:"step",o:e})},this.step=()=>{this.delta=this.reflow.stat.delta,this.flow.key=I.update(),this.flow.current=null!==o?o.name:"",this.stepItems(),this.collision.step(),x&&x.step(),null!==o&&o.move(),null!==this.debuger&&this.debuger.draw();let e=u?B.delta:this.delta;q(e),this.changes(this.flow.tmp),b?this.post({m:"poststep",flow:this.flow,Ar:J},[J.buffer]):this.post({m:"poststep",flow:this.flow}),this.flowReset()},this.initArray=(e=!1)=>{W={...C(this.engine,e)}},this.takeControl=(e=null)=>{this.control(e)},this.control=(e=null)=>{null!==o?null===e?(o.isPlayer&&(o.isPlayer=!1),o=null):e!==o.name&&(o=this.byName(e),o&&(o.isPlayer=!0)):null!==e&&(o=this.byName(e),o&&(o.isPlayer=!0))},this.getAllBody=e=>X.body.list,this.activeContact=()=>{n||(n=!0,this.post({m:"activeContact",o:{}}))},this.addCollision=e=>{this.collision.add(e)},this.removeCollision=e=>{this.collision.remove(e)},this.initItems=()=>{X.body=new Ae(a),X.ray=new se(a),X.joint=new Fe(a),X.solid=new Po(a),X.contact=new ze(a),X.terrain=new Mt(a),X.character=new gt(a),"PHYSX"!==this.engine&&"AMMO"!==this.engine||(X.vehicle=new Te(a)),"PHYSX"===this.engine&&(X.solver=new St(a))},this.getBodyRef=()=>X.body,this.getCharacterRef=()=>X.character,this.getGeometryRef=(e,t,a)=>{X.body.geometry(e,t,a)},this.clearBody=()=>{X.body.reset()},this.resetItems=()=>{Object.values(X).forEach((e=>e.reset()))},this.stepItems=()=>{Object.values(X).forEach((e=>e.step(J,W[e.type]))),this.upInstance(),this.upButton()},this.getTransform=e=>X.body.getTransform(e),this.upInstance=()=>{Object.values(this.instanceMesh).forEach((e=>e.update()))},this.clearInstance=()=>{Object.values(this.instanceMesh).forEach((e=>e.dispose())),this.instanceMesh={}},this.adds=(e=[],t=!1)=>{let a=e.length,i=0;for(;a--;)this.add(e[i++],t)},this.add=(e={},t=!1)=>{if(e.isObject3D)return this.addDirect(e);if(e.constructor===Array)return this.adds(e,t);if("container"===e.type)return new Mn(e,this);void 0!==e.bounce&&(e.restitution=e.bounce),void 0===e.type&&(e.type="box"),void 0!==e.mode&&(e.type="joint");let a=function(e){switch(e.type){case"plane":case"box":case"sphere":case"highSphere":case"customSphere":case"cylinder":case"stair":case"particle":case"cone":case"capsule":case"mesh":case"convex":case"compound":case"null":return e.mass||e.density||e.kinematic?"body":"solid";case"fixe":case"generic":case"universal":case"dof":case"d6":case"hinge":case"revolute":case"prismatic":case"cylindrical":case"slider":case"spherical":case"ragdoll":case"distance":return"joint";default:return e.type}}(e);"joint"===a&&void 0===e.mode&&(e.mode=e.type,e.type="joint");let i=X[a].add(e);return this.garbage.push(i.name),i},this.addDirect=e=>(this.scenePlus.add(e),this.tmpMesh.push(e),e),this.removes=(e=[],t)=>{let a=e.length,i=0;for(;a--;)this.remove(e[i++],t)},this.remove=(e,t=!1)=>{if(e.constructor===Array)return this.removes(e,t);let a=this.byName(e);null!==a?(this.removeCollision(e),"autoRagdoll"!==a.type?(a.extraRemove&&a.extraRemove(),X[a.type].clear(a),this.post({m:"remove",o:{name:e,type:a.type}},null,t)):this.utils.remove(a)):this.instanceMesh[e]&&X.body.clearInstance(e)},this.changes=(e=[],t=!1)=>{let a=e.length,i=0;for(;a--;)this.changeOne(e[i++],t)},this.change=(e,t=!1)=>{t?e instanceof Array?this.changes(e,!0):this.changeOne(e,!0):e instanceof Array?this.flow.tmp.push(...e):this.flow.tmp.push(e)},this.changeOne=(e={},t=!1)=>{if(e.heightData)return;let a=this.byName(e.name);if(null===a)return null;let i=a.type;switch(e.drivePosition&&void 0!==e.drivePosition.rot&&(e.drivePosition.quat=A.quatFromEuler(e.drivePosition.rot),delete e.drivePosition.rot),void 0!==e.rot&&(e.quat=A.quatFromEuler(e.rot),delete e.rot),void 0!==e.localRot&&(e.quat=A.toLocalQuatArray(e.localRot,a),delete e.localRot),i){case"terrain":a=X.terrain.set(e,a),t=!1;break;case"ray":a=X.ray.set(e,a),t=!1;break;case"character":a=X.character.set(e,a);break;case"solid":a=X.solid.set(e,a);break;case"joint":a=X.joint.set(e,a);break;case"body":a.isKinematic||(a.actif&&!a.sleep||X.body.set(e,a),e.sleep&&X.body.set(e,a))}t&&this.post({m:"change",o:e},null,t)},this.setControl=e=>{v=e,L=()=>v.getAzimuthalAngle()},this.getControl=()=>v,this.getCurrentCharacterPosition=()=>v.followGroup.position,this.getCamera=(e={})=>v.object,this.setCamera=(e={})=>{v.moveCam(e)},this.follow=(e="",t={})=>{let a=null;"string"==typeof e||e instanceof String?a=""===e?null:this.byName(e):e.isObject3D&&(a=e),null===a?v.resetFollow():v.startFollow(a,t)},this.setTimeout=(e,t=0,a=!1)=>{a?M=setTimeout(e,t):(S=e,E=t,M=setTimeout(S,E))},this.playtimout=()=>{null!==S&&(M=setTimeout(S,E))},this.pausetimout=()=>{null!==M&&clearTimeout(M)},this.cleartimout=(e,t)=>{null!==M&&(S=null,E=0,clearTimeout(M),M=null)},this.texture=(e={})=>Ye.texture(e),this.getTexture=(e,t={})=>Ye.getTexture(e,t),this.setExtendShader=e=>{this.mat.extendShader=e},this.addMaterial=(e,t)=>{this.mat.set(e,t)},this.directIntensity=e=>{},this.setEnvmapIntensity=e=>{},this.getMatRef=()=>this.mat,this.getMat=e=>this.mat.get(e),this.getMaterial=e=>this.mat.get(e),this.getMaterialList=()=>this.mat.getList(),this.material=(e={})=>this.mat.create(e),this.changeRenderMode=e=>this.mat.changeRenderMode(e),this.load=Ye.load,this.get=Ye.get,this.getGroup=Ye.getGroup,this.getScript=Ye.getScript,this.preload=(e,t)=>{ft.add(e,t)},this.applyMorph=(e,t=null,a=!0,i=!0)=>{Ye.applyMorph(e,null,!0,!0)},this.getMesh=(e,t,a)=>{if(t){let t=Ye.getMaterials(e);for(let e in t)this.addMaterial(t[e])}return Ye.getMesh(e,a)},this.getGlb=(e,t,a)=>{if(t){let t=Ye.getMaterials(e);for(let e in t)this.addMaterial(t[e])}return Ye.getGLB(e,a)},this.getGlbMaterial=e=>{let t=Ye.getMaterials(e);return this.mat.addToMat(t),t},this.poolDispose=()=>{},this.setDracoPath=e=>Ye.dracoPath=e,this.initParticle=()=>{},this.addParticle=()=>{},this.getParticle=()=>{},this.addSoftSolver=e=>{let t=new _t(e,this);return _.push(t),t},this.updateSoftSolver=()=>{let e=_.length;for(;e--;)_[e].update()},this.clearSoftSolver=()=>{_.length,_=[]},this.addButton=e=>{let t=new Bt(e,this);return G.push(t),t},this.upButton=e=>{for(const e in G)G[e].update()},this.addGrass=e=>new yn(e,this),this.addText=e=>{let t=new Tt(e);return e.parent?e.parent.add(t):this.scenePlus.add(t),H.push(t),t},this.clearText=()=>{let e=H.length;for(;e--;)H[e].dispose();H=[]},this.screenshot=()=>{var e=window.open("","");e.document.title="Screenshot",e.document.body.style.cssText="margin:0; padding:0; overflow:hidden;";var t=new Image;P.render(T,this.getCamera()),t.src=P.domElement.toDataURL(),e.document.body.appendChild(t)},this.getBreaker=()=>(null!==m||(m=new Aa(this)),m),this.setColorChecker=e=>{N=e},this.getColorChecker=()=>N,this.addWiggle=(e={})=>{},this.initParticleEngine=()=>{i||(i=new Fo,this.scene.add(i))},this.addParticle=(e={})=>(null===i&&this.initParticleEngine(),i.add(e)),this.getParticle=e=>null===i?null:i.get(e),this.explosion=(e=[0,0,0],a=10,i=1)=>{let s=[],r=new t.Vector3;e&&(e.isVector3?r.copy(e):r.fromArray(e));let n,o,c=new t.Vector3,h=X.body.list.length;for(;h--;)n=X.body.list[h],c.copy(n.position).sub(r),o=1-c.length()/a,n.isKinematic||o<0||(c.setLength(o),c.multiplyScalar(i),s.push({name:n.name,impulse:c.toArray(),wake:!0}));this.change(s)}}set onStep(e){this.setStep(e)}}class Po extends Ae{constructor(e){super(e),this.type="solid"}step(){}}class To{constructor(e){this.map=new Map,this.motor=e}byName(e){return this.map.has(e)?this.map.get(e):null}add(e,t){if("contact"!==e.type&&!e.isInstance&&e.isObject3D)if(t)t.add(e);else if(e.isButton)this.motor.scene.add(e);else switch(e.type){case"terrain":case"solid":case"joint":case"ray":case"articulation":this.motor.scenePlus.add(e);break;default:this.motor.scene.add(e)}this.map.set(e.name,e)}remove(e){e.dispose&&e.dispose(),e.parent&&e.parent.remove(e),e.isInstance&&e.instance.remove(e.idx),this.map.delete(e.name)}noRay(e){e.isObject3D&&(e.raycast=()=>{},e.traverse((e=>{e.isObject3D&&(e.raycast=()=>{})})))}morph(e,t,a){e.morphTargetInfluences&&void 0!==e.morphTargetDictionary[t]&&(e.morphTargetInfluences[e.morphTargetDictionary[t]]=a)}toLocal(e,t,a=!1){a||e.sub(t.position);let i=t.quaternion;return e.applyQuaternion({x:-i._x,y:-i._y,z:-i._z,w:i._w}),e}quatLocal(e,a){a.isObject3D&&a.updateWorldMatrix(!0,!1);let i=(new t.Quaternion).fromArray(e),s=a.quaternion.clone().invert();return i.premultiply(s),i.normalize().toArray()}axisLocal(e,a){a.isObject3D&&a.updateWorldMatrix(!0,!1);let i=(new t.Matrix3).setFromMatrix4(a.matrixWorld);return(new t.Vector3).fromArray(e).applyMatrix3(i).toArray()}quatToAngular(e,a){a[0]*=-1,a[1]*=-1,a[2]*=-1;let i,s=a[0]*e[3]+a[3]*e[0]+a[1]*e[2]-a[2]*e[1],r=a[1]*e[3]+a[3]*e[1]+a[2]*e[0]-a[0]*e[2],n=a[2]*e[3]+a[3]*e[2]+a[0]*e[1]-a[1]*e[0],o=a[3]*e[3]-a[0]*e[0]-a[1]*e[1]-a[2]*e[2],c=2*Math.acos(o),h=Math.sqrt(1-o*o);i=h<.001?[0,0,0]:[s/h,r/h,n/h];(new t.Vector3).fromArray(i).multiplyScalar(c/1)}refAxis(e,a){let i=(new t.Vector3).fromArray(a),s=new t.Vector3(1,0,0),r=new t.Vector3(0,1,0);Math.abs(a[1])>.9999||s.copy(i).cross(r).normalize(),r.copy(s).cross(i).normalize(),e.makeBasis(s,r,i)}}const Io=new Ro,Bo=Ro,Co=A,Do=Ye;e.math=Co,e.phy=Io,e.phy2=Bo,e.pool=Do}));
