!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).PHY={})}(this,(function(t){"use strict";var e=function(t){var e,i=Object.prototype,n=i.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},r=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",o=s.toStringTag||"@@toStringTag";function l(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,i){return t[e]=i}}function h(t,e,i,n){var s=e&&e.prototype instanceof g?e:g,r=Object.create(s.prototype),a=new L(n||[]);return r._invoke=function(t,e,i){var n=u;return function(s,r){if(n===p)throw new Error("Generator is already running");if(n===m){if("throw"===s)throw r;return P()}for(i.method=s,i.arg=r;;){var a=i.delegate;if(a){var o=T(a,i);if(o){if(o===f)continue;return o}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(n===u)throw n=m,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n=p;var l=c(t,e,i);if("normal"===l.type){if(n=i.done?m:d,l.arg===f)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(n=m,i.method="throw",i.arg=l.arg)}}}(t,i,a),r}function c(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}t.wrap=h;var u="suspendedStart",d="suspendedYield",p="executing",m="completed",f={};function g(){}function v(){}function x(){}var y={};y[r]=function(){return this};var b=Object.getPrototypeOf,w=b&&b(b(C([])));w&&w!==i&&n.call(w,r)&&(y=w);var _=x.prototype=g.prototype=Object.create(y);function M(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function i(s,r,a,o){var l=c(t[s],t,r);if("throw"!==l.type){var h=l.arg,u=h.value;return u&&"object"==typeof u&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){i("next",t,a,o)}),(function(t){i("throw",t,a,o)})):e.resolve(u).then((function(t){h.value=t,a(h)}),(function(t){return i("throw",t,a,o)}))}o(l.arg)}var s;this._invoke=function(t,n){function r(){return new e((function(e,s){i(t,n,e,s)}))}return s=s?s.then(r,r):r()}}function T(t,i){var n=t.iterator[i.method];if(n===e){if(i.delegate=null,"throw"===i.method){if(t.iterator.return&&(i.method="return",i.arg=e,T(t,i),"throw"===i.method))return f;i.method="throw",i.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var s=c(n,t.iterator,i.arg);if("throw"===s.type)return i.method="throw",i.arg=s.arg,i.delegate=null,f;var r=s.arg;return r?r.done?(i[t.resultName]=r.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=e),i.delegate=null,f):r:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,f)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function C(t){if(t){var i=t[r];if(i)return i.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var s=-1,a=function i(){for(;++s<t.length;)if(n.call(t,s))return i.value=t[s],i.done=!1,i;return i.value=e,i.done=!0,i};return a.next=a}}return{next:P}}function P(){return{value:e,done:!0}}return v.prototype=_.constructor=x,x.constructor=v,v.displayName=l(x,o,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,l(t,o,"GeneratorFunction")),t.prototype=Object.create(_),t},t.awrap=function(t){return{__await:t}},M(S.prototype),S.prototype[a]=function(){return this},t.AsyncIterator=S,t.async=function(e,i,n,s,r){void 0===r&&(r=Promise);var a=new S(h(e,i,n,s),r);return t.isGeneratorFunction(i)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},M(_),l(_,o,"Generator"),_[r]=function(){return this},_.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var n=e.pop();if(n in t)return i.value=n,i.done=!1,i}return i.done=!0,i}},t.values=C,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var i in this)"t"===i.charAt(0)&&n.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var i=this;function s(n,s){return o.type="throw",o.arg=t,i.next=n,s&&(i.method="next",i.arg=e),!!s}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],o=a.completion;if("root"===a.tryLoc)return s("end");if(a.tryLoc<=this.prev){var l=n.call(a,"catchLoc"),h=n.call(a,"finallyLoc");if(l&&h){if(this.prev<a.catchLoc)return s(a.catchLoc,!0);if(this.prev<a.finallyLoc)return s(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return s(a.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return s(a.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.tryLoc<=this.prev&&n.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var r=s;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),E(i),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var s=n.arg;E(i)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(t,i,n){return this.delegate={iterator:C(t),resultName:i,nextLoc:n},"next"===this.method&&(this.arg=e),f}},t}("object"==typeof module?module.exports:{});try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}
/**
   * @license
   * Copyright 2010-2021 Three.js Authors
   * SPDX-License-Identifier: MIT
   */const i="134dev",n={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},r=100,a=200,l=206,h=208,c=300,u=301,d=302,p=303,m=304,f=306,g=307,v=1e3,x=1001,y=1002,b=1003,w=1004,_=1005,M=1006,S=1007,T=1008,A=1009,E=1012,L=1014,C=1015,P=1016,R=1020,F=1022,I=1023,D=I,N=1026,k=1027,z=33776,U=33777,O=33778,B=33779,H=35840,G=35841,V=35842,W=35843,j=37492,X=37496,Y=2300,q=2301,Q=2302,Z=2400,J=2401,K=2402,$=2500,tt=2501,et=3e3,it=3001,nt=3007,st=3002,rt=3004,at=3005,ot=3006,lt=3201,ht=7680,ct=35044,ut=35048,dt="300 es";class pt{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,n=i.length;e<n;e++)i[e].call(this,t);t.target=null}}}let mt=1234567;const ft=Math.PI/180,gt=180/Math.PI,vt=[];for(let t=0;t<256;t++)vt[t]=(t<16?"0":"")+t.toString(16);const xt="undefined"!=typeof crypto&&"randomUUID"in crypto;function yt(){if(xt)return crypto.randomUUID().toUpperCase();const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(vt[255&t]+vt[t>>8&255]+vt[t>>16&255]+vt[t>>24&255]+"-"+vt[255&e]+vt[e>>8&255]+"-"+vt[e>>16&15|64]+vt[e>>24&255]+"-"+vt[63&i|128]+vt[i>>8&255]+"-"+vt[i>>16&255]+vt[i>>24&255]+vt[255&n]+vt[n>>8&255]+vt[n>>16&255]+vt[n>>24&255]).toUpperCase()}function bt(t,e,i){return Math.max(e,Math.min(i,t))}function wt(t,e){return(t%e+e)%e}function _t(t,e,i){return(1-i)*t+i*e}function Mt(t){return 0==(t&t-1)&&0!==t}function St(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Tt(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var At=Object.freeze({__proto__:null,DEG2RAD:ft,RAD2DEG:gt,generateUUID:yt,clamp:bt,euclideanModulo:wt,mapLinear:function(t,e,i,n,s){return n+(t-e)*(s-n)/(i-e)},inverseLerp:function(t,e,i){return t!==e?(i-t)/(e-t):0},lerp:_t,damp:function(t,e,i,n){return _t(t,e,1-Math.exp(-i*n))},pingpong:function(t,e=1){return e-Math.abs(wt(t,2*e)-e)},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(mt=t%2147483647),mt=16807*mt%2147483647,(mt-1)/2147483646},degToRad:function(t){return t*ft},radToDeg:function(t){return t*gt},isPowerOfTwo:Mt,ceilPowerOfTwo:St,floorPowerOfTwo:Tt,setQuaternionFromProperEuler:function(t,e,i,n,s){const r=Math.cos,a=Math.sin,o=r(i/2),l=a(i/2),h=r((e+n)/2),c=a((e+n)/2),u=r((e-n)/2),d=a((e-n)/2),p=r((n-e)/2),m=a((n-e)/2);switch(s){case"XYX":t.set(o*c,l*u,l*d,o*h);break;case"YZY":t.set(l*d,o*c,l*u,o*h);break;case"ZXZ":t.set(l*u,l*d,o*c,o*h);break;case"XZX":t.set(o*c,l*m,l*p,o*h);break;case"YXY":t.set(l*p,o*c,l*m,o*h);break;case"ZYZ":t.set(l*m,l*p,o*c,o*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}});class Et{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),s=this.x-t.x,r=this.y-t.y;return this.x=s*i-r*n+t.x,this.y=s*n+r*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Et.prototype.isVector2=!0;class Lt{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,s,r,a,o,l){const h=this.elements;return h[0]=t,h[1]=n,h[2]=a,h[3]=e,h[4]=s,h[5]=o,h[6]=i,h[7]=r,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,s=this.elements,r=i[0],a=i[3],o=i[6],l=i[1],h=i[4],c=i[7],u=i[2],d=i[5],p=i[8],m=n[0],f=n[3],g=n[6],v=n[1],x=n[4],y=n[7],b=n[2],w=n[5],_=n[8];return s[0]=r*m+a*v+o*b,s[3]=r*f+a*x+o*w,s[6]=r*g+a*y+o*_,s[1]=l*m+h*v+c*b,s[4]=l*f+h*x+c*w,s[7]=l*g+h*y+c*_,s[2]=u*m+d*v+p*b,s[5]=u*f+d*x+p*w,s[8]=u*g+d*y+p*_,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],a=t[5],o=t[6],l=t[7],h=t[8];return e*r*h-e*a*l-i*s*h+i*a*o+n*s*l-n*r*o}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=h*r-a*l,u=a*o-h*s,d=l*s-r*o,p=e*c+i*u+n*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=c*m,t[1]=(n*l-h*i)*m,t[2]=(a*i-n*r)*m,t[3]=u*m,t[4]=(h*e-n*o)*m,t[5]=(n*s-a*e)*m,t[6]=d*m,t[7]=(i*o-l*e)*m,t[8]=(r*e-i*s)*m,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,s,r,a){const o=Math.cos(s),l=Math.sin(s);return this.set(i*o,i*l,-i*(o*r+l*a)+r+t,-n*l,n*o,-n*(-l*r+o*a)+a+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.elements,s=n[0],r=n[3],a=n[6],o=n[1],l=n[4],h=n[7];return n[0]=e*s+i*o,n[3]=e*r+i*l,n[6]=e*a+i*h,n[1]=-i*s+e*o,n[4]=-i*r+e*l,n[7]=-i*a+e*h,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}function Ct(t){if(0===t.length)return-1/0;let e=t[0];for(let i=1,n=t.length;i<n;++i)t[i]>e&&(e=t[i]);return e}Lt.prototype.isMatrix3=!0;const Pt={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Rt(t,e){return new Pt[t](e)}function Ft(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function It(t,e=0){let i=3735928559^e,n=1103547991^e;for(let e,s=0;s<t.length;s++)e=t.charCodeAt(s),i=Math.imul(i^e,2654435761),n=Math.imul(n^e,1597334677);return i=Math.imul(i^i>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),4294967296*(2097151&n)+(i>>>0)}let Dt;class Nt{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Dt&&(Dt=Ft("canvas")),Dt.width=t.width,Dt.height=t.height;const i=Dt.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=Dt}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}}let kt=0;class zt extends pt{constructor(t=zt.DEFAULT_IMAGE,e=zt.DEFAULT_MAPPING,i=1001,n=1001,s=1006,r=1008,a=1023,o=1009,l=1,h=3e3){super(),Object.defineProperty(this,"id",{value:kt++}),this.uuid=yt(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=n,this.magFilter=s,this.minFilter=r,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new Et(0,0),this.repeat=new Et(1,1),this.center=new Et(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Lt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const n=this.image;if(void 0===n.uuid&&(n.uuid=yt()),!e&&void 0===t.images[n.uuid]){let e;if(Array.isArray(n)){e=[];for(let t=0,i=n.length;t<i;t++)n[t].isDataTexture?e.push(Ut(n[t].image)):e.push(Ut(n[t]))}else e=Ut(n);t.images[n.uuid]={uuid:n.uuid,url:e}}i.image=n.uuid}return e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==c)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case v:t.x=t.x-Math.floor(t.x);break;case x:t.x=t.x<0?0:1;break;case y:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case v:t.y=t.y-Math.floor(t.y);break;case x:t.y=t.y<0?0:1;break;case y:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&this.version++}}function Ut(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Nt.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}zt.DEFAULT_IMAGE=void 0,zt.DEFAULT_MAPPING=c,zt.prototype.isTexture=!0;class Ot{constructor(t=0,e=0,i=0,n=1){this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,s=this.w,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n+r[12]*s,this.y=r[1]*e+r[5]*i+r[9]*n+r[13]*s,this.z=r[2]*e+r[6]*i+r[10]*n+r[14]*s,this.w=r[3]*e+r[7]*i+r[11]*n+r[15]*s,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,s;const r=.01,a=.1,o=t.elements,l=o[0],h=o[4],c=o[8],u=o[1],d=o[5],p=o[9],m=o[2],f=o[6],g=o[10];if(Math.abs(h-u)<r&&Math.abs(c-m)<r&&Math.abs(p-f)<r){if(Math.abs(h+u)<a&&Math.abs(c+m)<a&&Math.abs(p+f)<a&&Math.abs(l+d+g-3)<a)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,o=(d+1)/2,v=(g+1)/2,x=(h+u)/4,y=(c+m)/4,b=(p+f)/4;return t>o&&t>v?t<r?(i=0,n=.707106781,s=.707106781):(i=Math.sqrt(t),n=x/i,s=y/i):o>v?o<r?(i=.707106781,n=0,s=.707106781):(n=Math.sqrt(o),i=x/n,s=b/n):v<r?(i=.707106781,n=.707106781,s=0):(s=Math.sqrt(v),i=y/s,n=b/s),this.set(i,n,s,e),this}let v=Math.sqrt((f-p)*(f-p)+(c-m)*(c-m)+(u-h)*(u-h));return Math.abs(v)<.001&&(v=1),this.x=(f-p)/v,this.y=(c-m)/v,this.z=(u-h)/v,this.w=Math.acos((l+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Ot.prototype.isVector4=!0;class Bt extends pt{constructor(t,e,i={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new Ot(0,0,t,e),this.scissorTest=!1,this.viewport=new Ot(0,0,t,e),this.texture=new zt(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:t,height:e,depth:1},this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:M,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}setTexture(t){t.image={width:this.width,height:this.height,depth:this.depth},this.texture=t}setSize(t,e,i=1){this.width===t&&this.height===e&&this.depth===i||(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}Bt.prototype.isWebGLRenderTarget=!0;class Ht extends Bt{constructor(t,e,i){super(t,e);const n=this.texture;this.texture=[];for(let t=0;t<i;t++)this.texture[t]=n.clone()}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let n=0,s=this.texture.length;n<s;n++)this.texture[n].image.width=t,this.texture[n].image.height=e,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this.texture.length=0;for(let e=0,i=t.texture.length;e<i;e++)this.texture[e]=t.texture[e].clone();return this}}Ht.prototype.isWebGLMultipleRenderTargets=!0;class Gt extends Bt{constructor(t,e,i){super(t,e,i),this.samples=4}copy(t){return super.copy.call(this,t),this.samples=t.samples,this}}Gt.prototype.isWebGLMultisampleRenderTarget=!0;class Vt{constructor(t=0,e=0,i=0,n=1){this._x=t,this._y=e,this._z=i,this._w=n}static slerp(t,e,i,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,n)}static slerpFlat(t,e,i,n,s,r,a){let o=i[n+0],l=i[n+1],h=i[n+2],c=i[n+3];const u=s[r+0],d=s[r+1],p=s[r+2],m=s[r+3];if(0===a)return t[e+0]=o,t[e+1]=l,t[e+2]=h,void(t[e+3]=c);if(1===a)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=m);if(c!==m||o!==u||l!==d||h!==p){let t=1-a;const e=o*u+l*d+h*p+c*m,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const s=Math.sqrt(n),r=Math.atan2(s,e*i);t=Math.sin(t*r)/s,a=Math.sin(a*r)/s}const s=a*i;if(o=o*t+u*s,l=l*t+d*s,h=h*t+p*s,c=c*t+m*s,t===1-a){const t=1/Math.sqrt(o*o+l*l+h*h+c*c);o*=t,l*=t,h*=t,c*=t}}t[e]=o,t[e+1]=l,t[e+2]=h,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,n,s,r){const a=i[n],o=i[n+1],l=i[n+2],h=i[n+3],c=s[r],u=s[r+1],d=s[r+2],p=s[r+3];return t[e]=a*p+h*c+o*d-l*u,t[e+1]=o*p+h*u+l*c-a*d,t[e+2]=l*p+h*d+a*u-o*c,t[e+3]=h*p-a*c-o*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,n=t._y,s=t._z,r=t._order,a=Math.cos,o=Math.sin,l=a(i/2),h=a(n/2),c=a(s/2),u=o(i/2),d=o(n/2),p=o(s/2);switch(r){case"XYZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"YXZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"ZXY":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"ZYX":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"YZX":this._x=u*h*c+l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c-u*d*p;break;case"XZY":this._x=u*h*c-l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],s=e[8],r=e[1],a=e[5],o=e[9],l=e[2],h=e[6],c=e[10],u=i+a+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(h-o)*t,this._y=(s-l)*t,this._z=(r-n)*t}else if(i>a&&i>c){const t=2*Math.sqrt(1+i-a-c);this._w=(h-o)/t,this._x=.25*t,this._y=(n+r)/t,this._z=(s+l)/t}else if(a>c){const t=2*Math.sqrt(1+a-i-c);this._w=(s-l)/t,this._x=(n+r)/t,this._y=.25*t,this._z=(o+h)/t}else{const t=2*Math.sqrt(1+c-i-a);this._w=(r-n)/t,this._x=(s+l)/t,this._y=(o+h)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(bt(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,s=t._z,r=t._w,a=e._x,o=e._y,l=e._z,h=e._w;return this._x=i*h+r*a+n*l-s*o,this._y=n*h+r*o+s*a-i*l,this._z=s*h+r*l+i*o-n*a,this._w=r*h-i*a-n*o-s*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,s=this._z,r=this._w;let a=r*t._w+i*t._x+n*t._y+s*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=r,this._x=i,this._y=n,this._z=s,this;const o=1-a*a;if(o<=Number.EPSILON){const t=1-e;return this._w=t*r+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*s+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(o),h=Math.atan2(l,a),c=Math.sin((1-e)*h)/l,u=Math.sin(e*h)/l;return this._w=r*c+this._w*u,this._x=i*c+this._x*u,this._y=n*c+this._y*u,this._z=s*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(s),i*Math.cos(s),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Vt.prototype.isQuaternion=!0;class Wt{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Xt.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Xt.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6]*n,this.y=s[1]*e+s[4]*i+s[7]*n,this.z=s[2]*e+s[5]*i+s[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,s=t.elements,r=1/(s[3]*e+s[7]*i+s[11]*n+s[15]);return this.x=(s[0]*e+s[4]*i+s[8]*n+s[12])*r,this.y=(s[1]*e+s[5]*i+s[9]*n+s[13])*r,this.z=(s[2]*e+s[6]*i+s[10]*n+s[14])*r,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,s=t.x,r=t.y,a=t.z,o=t.w,l=o*e+r*n-a*i,h=o*i+a*e-s*n,c=o*n+s*i-r*e,u=-s*e-r*i-a*n;return this.x=l*o+u*-s+h*-a-c*-r,this.y=h*o+u*-r+c*-s-l*-a,this.z=c*o+u*-a+l*-r-h*-s,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n,this.y=s[1]*e+s[5]*i+s[9]*n,this.z=s[2]*e+s[6]*i+s[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,s=t.z,r=e.x,a=e.y,o=e.z;return this.x=n*o-s*a,this.y=s*r-i*o,this.z=i*a-n*r,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return jt.copy(this).projectOnVector(t),this.sub(jt)}reflect(t){return this.sub(jt.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(bt(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}Wt.prototype.isVector3=!0;const jt=new Wt,Xt=new Vt;class Yt{constructor(t=new Wt(1/0,1/0,1/0),e=new Wt(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,n=1/0,s=-1/0,r=-1/0,a=-1/0;for(let o=0,l=t.length;o<l;o+=3){const l=t[o],h=t[o+1],c=t[o+2];l<e&&(e=l),h<i&&(i=h),c<n&&(n=c),l>s&&(s=l),h>r&&(r=h),c>a&&(a=c)}return this.min.set(e,i,n),this.max.set(s,r,a),this}setFromBufferAttribute(t){let e=1/0,i=1/0,n=1/0,s=-1/0,r=-1/0,a=-1/0;for(let o=0,l=t.count;o<l;o++){const l=t.getX(o),h=t.getY(o),c=t.getZ(o);l<e&&(e=l),h<i&&(i=h),c<n&&(n=c),l>s&&(s=l),h>r&&(r=h),c>a&&(a=c)}return this.min.set(e,i,n),this.max.set(s,r,a),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=Qt.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),Zt.copy(e.boundingBox),Zt.applyMatrix4(t.matrixWorld),this.union(Zt));const i=t.children;for(let t=0,e=i.length;t<e;t++)this.expandByObject(i[t]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Qt),Qt.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ne),se.subVectors(this.max,ne),Jt.subVectors(t.a,ne),Kt.subVectors(t.b,ne),$t.subVectors(t.c,ne),te.subVectors(Kt,Jt),ee.subVectors($t,Kt),ie.subVectors(Jt,$t);let e=[0,-te.z,te.y,0,-ee.z,ee.y,0,-ie.z,ie.y,te.z,0,-te.x,ee.z,0,-ee.x,ie.z,0,-ie.x,-te.y,te.x,0,-ee.y,ee.x,0,-ie.y,ie.x,0];return!!oe(e,Jt,Kt,$t,se)&&(e=[1,0,0,0,1,0,0,0,1],!!oe(e,Jt,Kt,$t,se)&&(re.crossVectors(te,ee),e=[re.x,re.y,re.z],oe(e,Jt,Kt,$t,se)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Qt.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(Qt).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(qt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),qt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),qt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),qt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),qt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),qt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),qt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),qt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(qt)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Yt.prototype.isBox3=!0;const qt=[new Wt,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt],Qt=new Wt,Zt=new Yt,Jt=new Wt,Kt=new Wt,$t=new Wt,te=new Wt,ee=new Wt,ie=new Wt,ne=new Wt,se=new Wt,re=new Wt,ae=new Wt;function oe(t,e,i,n,s){for(let r=0,a=t.length-3;r<=a;r+=3){ae.fromArray(t,r);const a=s.x*Math.abs(ae.x)+s.y*Math.abs(ae.y)+s.z*Math.abs(ae.z),o=e.dot(ae),l=i.dot(ae),h=n.dot(ae);if(Math.max(-Math.max(o,l,h),Math.min(o,l,h))>a)return!1}return!0}const le=new Yt,he=new Wt,ce=new Wt,ue=new Wt;class de{constructor(t=new Wt,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):le.setFromPoints(t).getCenter(i);let n=0;for(let e=0,s=t.length;e<s;e++)n=Math.max(n,i.distanceToSquared(t[e]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){ue.subVectors(t,this.center);const e=ue.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),i=.5*(t-this.radius);this.center.add(ue.multiplyScalar(i/t)),this.radius+=i}return this}union(t){return ce.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(he.copy(t.center).add(ce)),this.expandByPoint(he.copy(t.center).sub(ce)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const pe=new Wt,me=new Wt,fe=new Wt,ge=new Wt,ve=new Wt,xe=new Wt,ye=new Wt;class be{constructor(t=new Wt,e=new Wt(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,pe)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=pe.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(pe.copy(this.direction).multiplyScalar(e).add(this.origin),pe.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){me.copy(t).add(e).multiplyScalar(.5),fe.copy(e).sub(t).normalize(),ge.copy(this.origin).sub(me);const s=.5*t.distanceTo(e),r=-this.direction.dot(fe),a=ge.dot(this.direction),o=-ge.dot(fe),l=ge.lengthSq(),h=Math.abs(1-r*r);let c,u,d,p;if(h>0)if(c=r*o-a,u=r*a-o,p=s*h,c>=0)if(u>=-p)if(u<=p){const t=1/h;c*=t,u*=t,d=c*(c+r*u+2*a)+u*(r*c+u+2*o)+l}else u=s,c=Math.max(0,-(r*u+a)),d=-c*c+u*(u+2*o)+l;else u=-s,c=Math.max(0,-(r*u+a)),d=-c*c+u*(u+2*o)+l;else u<=-p?(c=Math.max(0,-(-r*s+a)),u=c>0?-s:Math.min(Math.max(-s,-o),s),d=-c*c+u*(u+2*o)+l):u<=p?(c=0,u=Math.min(Math.max(-s,-o),s),d=u*(u+2*o)+l):(c=Math.max(0,-(r*s+a)),u=c>0?s:Math.min(Math.max(-s,-o),s),d=-c*c+u*(u+2*o)+l);else u=r>0?-s:s,c=Math.max(0,-(r*u+a)),d=-c*c+u*(u+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(c).add(this.origin),n&&n.copy(fe).multiplyScalar(u).add(me),d}intersectSphere(t,e){pe.subVectors(t.center,this.origin);const i=pe.dot(this.direction),n=pe.dot(pe)-i*i,s=t.radius*t.radius;if(n>s)return null;const r=Math.sqrt(s-n),a=i-r,o=i+r;return a<0&&o<0?null:a<0?this.at(o,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,s,r,a,o;const l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return l>=0?(i=(t.min.x-u.x)*l,n=(t.max.x-u.x)*l):(i=(t.max.x-u.x)*l,n=(t.min.x-u.x)*l),h>=0?(s=(t.min.y-u.y)*h,r=(t.max.y-u.y)*h):(s=(t.max.y-u.y)*h,r=(t.min.y-u.y)*h),i>r||s>n?null:((s>i||i!=i)&&(i=s),(r<n||n!=n)&&(n=r),c>=0?(a=(t.min.z-u.z)*c,o=(t.max.z-u.z)*c):(a=(t.max.z-u.z)*c,o=(t.min.z-u.z)*c),i>o||a>n?null:((a>i||i!=i)&&(i=a),(o<n||n!=n)&&(n=o),n<0?null:this.at(i>=0?i:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,pe)}intersectTriangle(t,e,i,n,s){ve.subVectors(e,t),xe.subVectors(i,t),ye.crossVectors(ve,xe);let r,a=this.direction.dot(ye);if(a>0){if(n)return null;r=1}else{if(!(a<0))return null;r=-1,a=-a}ge.subVectors(this.origin,t);const o=r*this.direction.dot(xe.crossVectors(ge,xe));if(o<0)return null;const l=r*this.direction.dot(ve.cross(ge));if(l<0)return null;if(o+l>a)return null;const h=-r*ge.dot(ye);return h<0?null:this.at(h/a,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class we{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,s,r,a,o,l,h,c,u,d,p,m,f){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=s,g[5]=r,g[9]=a,g[13]=o,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=d,g[7]=p,g[11]=m,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new we).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/_e.setFromMatrixColumn(t,0).length(),s=1/_e.setFromMatrixColumn(t,1).length(),r=1/_e.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*s,e[5]=i[5]*s,e[6]=i[6]*s,e[7]=0,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,n=t.y,s=t.z,r=Math.cos(i),a=Math.sin(i),o=Math.cos(n),l=Math.sin(n),h=Math.cos(s),c=Math.sin(s);if("XYZ"===t.order){const t=r*h,i=r*c,n=a*h,s=a*c;e[0]=o*h,e[4]=-o*c,e[8]=l,e[1]=i+n*l,e[5]=t-s*l,e[9]=-a*o,e[2]=s-t*l,e[6]=n+i*l,e[10]=r*o}else if("YXZ"===t.order){const t=o*h,i=o*c,n=l*h,s=l*c;e[0]=t+s*a,e[4]=n*a-i,e[8]=r*l,e[1]=r*c,e[5]=r*h,e[9]=-a,e[2]=i*a-n,e[6]=s+t*a,e[10]=r*o}else if("ZXY"===t.order){const t=o*h,i=o*c,n=l*h,s=l*c;e[0]=t-s*a,e[4]=-r*c,e[8]=n+i*a,e[1]=i+n*a,e[5]=r*h,e[9]=s-t*a,e[2]=-r*l,e[6]=a,e[10]=r*o}else if("ZYX"===t.order){const t=r*h,i=r*c,n=a*h,s=a*c;e[0]=o*h,e[4]=n*l-i,e[8]=t*l+s,e[1]=o*c,e[5]=s*l+t,e[9]=i*l-n,e[2]=-l,e[6]=a*o,e[10]=r*o}else if("YZX"===t.order){const t=r*o,i=r*l,n=a*o,s=a*l;e[0]=o*h,e[4]=s-t*c,e[8]=n*c+i,e[1]=c,e[5]=r*h,e[9]=-a*h,e[2]=-l*h,e[6]=i*c+n,e[10]=t-s*c}else if("XZY"===t.order){const t=r*o,i=r*l,n=a*o,s=a*l;e[0]=o*h,e[4]=-c,e[8]=l*h,e[1]=t*c+s,e[5]=r*h,e[9]=i*c-n,e[2]=n*c-i,e[6]=a*h,e[10]=s*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Se,t,Te)}lookAt(t,e,i){const n=this.elements;return Le.subVectors(t,e),0===Le.lengthSq()&&(Le.z=1),Le.normalize(),Ae.crossVectors(i,Le),0===Ae.lengthSq()&&(1===Math.abs(i.z)?Le.x+=1e-4:Le.z+=1e-4,Le.normalize(),Ae.crossVectors(i,Le)),Ae.normalize(),Ee.crossVectors(Le,Ae),n[0]=Ae.x,n[4]=Ee.x,n[8]=Le.x,n[1]=Ae.y,n[5]=Ee.y,n[9]=Le.y,n[2]=Ae.z,n[6]=Ee.z,n[10]=Le.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,s=this.elements,r=i[0],a=i[4],o=i[8],l=i[12],h=i[1],c=i[5],u=i[9],d=i[13],p=i[2],m=i[6],f=i[10],g=i[14],v=i[3],x=i[7],y=i[11],b=i[15],w=n[0],_=n[4],M=n[8],S=n[12],T=n[1],A=n[5],E=n[9],L=n[13],C=n[2],P=n[6],R=n[10],F=n[14],I=n[3],D=n[7],N=n[11],k=n[15];return s[0]=r*w+a*T+o*C+l*I,s[4]=r*_+a*A+o*P+l*D,s[8]=r*M+a*E+o*R+l*N,s[12]=r*S+a*L+o*F+l*k,s[1]=h*w+c*T+u*C+d*I,s[5]=h*_+c*A+u*P+d*D,s[9]=h*M+c*E+u*R+d*N,s[13]=h*S+c*L+u*F+d*k,s[2]=p*w+m*T+f*C+g*I,s[6]=p*_+m*A+f*P+g*D,s[10]=p*M+m*E+f*R+g*N,s[14]=p*S+m*L+f*F+g*k,s[3]=v*w+x*T+y*C+b*I,s[7]=v*_+x*A+y*P+b*D,s[11]=v*M+x*E+y*R+b*N,s[15]=v*S+x*L+y*F+b*k,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],s=t[12],r=t[1],a=t[5],o=t[9],l=t[13],h=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+s*o*c-n*l*c-s*a*u+i*l*u+n*a*d-i*o*d)+t[7]*(+e*o*d-e*l*u+s*r*u-n*r*d+n*l*h-s*o*h)+t[11]*(+e*l*c-e*a*d-s*r*c+i*r*d+s*a*h-i*l*h)+t[15]*(-n*a*h-e*o*c+e*a*u+n*r*c-i*r*u+i*o*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=t[9],u=t[10],d=t[11],p=t[12],m=t[13],f=t[14],g=t[15],v=c*f*l-m*u*l+m*o*d-a*f*d-c*o*g+a*u*g,x=p*u*l-h*f*l-p*o*d+r*f*d+h*o*g-r*u*g,y=h*m*l-p*c*l+p*a*d-r*m*d-h*a*g+r*c*g,b=p*c*o-h*m*o-p*a*u+r*m*u+h*a*f-r*c*f,w=e*v+i*x+n*y+s*b;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const _=1/w;return t[0]=v*_,t[1]=(m*u*s-c*f*s-m*n*d+i*f*d+c*n*g-i*u*g)*_,t[2]=(a*f*s-m*o*s+m*n*l-i*f*l-a*n*g+i*o*g)*_,t[3]=(c*o*s-a*u*s-c*n*l+i*u*l+a*n*d-i*o*d)*_,t[4]=x*_,t[5]=(h*f*s-p*u*s+p*n*d-e*f*d-h*n*g+e*u*g)*_,t[6]=(p*o*s-r*f*s-p*n*l+e*f*l+r*n*g-e*o*g)*_,t[7]=(r*u*s-h*o*s+h*n*l-e*u*l-r*n*d+e*o*d)*_,t[8]=y*_,t[9]=(p*c*s-h*m*s-p*i*d+e*m*d+h*i*g-e*c*g)*_,t[10]=(r*m*s-p*a*s+p*i*l-e*m*l-r*i*g+e*a*g)*_,t[11]=(h*a*s-r*c*s-h*i*l+e*c*l+r*i*d-e*a*d)*_,t[12]=b*_,t[13]=(h*m*n-p*c*n+p*i*u-e*m*u-h*i*f+e*c*f)*_,t[14]=(p*a*n-r*m*n-p*i*o+e*m*o+r*i*f-e*a*f)*_,t[15]=(r*c*n-h*a*n+h*i*o-e*c*o-r*i*u+e*a*u)*_,this}scale(t){const e=this.elements,i=t.x,n=t.y,s=t.z;return e[0]*=i,e[4]*=n,e[8]*=s,e[1]*=i,e[5]*=n,e[9]*=s,e[2]*=i,e[6]*=n,e[10]*=s,e[3]*=i,e[7]*=n,e[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),s=1-i,r=t.x,a=t.y,o=t.z,l=s*r,h=s*a;return this.set(l*r+i,l*a-n*o,l*o+n*a,0,l*a+n*o,h*a+i,h*o-n*r,0,l*o-n*a,h*o+n*r,s*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,s,r){return this.set(1,i,s,0,t,1,r,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,s=e._x,r=e._y,a=e._z,o=e._w,l=s+s,h=r+r,c=a+a,u=s*l,d=s*h,p=s*c,m=r*h,f=r*c,g=a*c,v=o*l,x=o*h,y=o*c,b=i.x,w=i.y,_=i.z;return n[0]=(1-(m+g))*b,n[1]=(d+y)*b,n[2]=(p-x)*b,n[3]=0,n[4]=(d-y)*w,n[5]=(1-(u+g))*w,n[6]=(f+v)*w,n[7]=0,n[8]=(p+x)*_,n[9]=(f-v)*_,n[10]=(1-(u+m))*_,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let s=_e.set(n[0],n[1],n[2]).length();const r=_e.set(n[4],n[5],n[6]).length(),a=_e.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],Me.copy(this);const o=1/s,l=1/r,h=1/a;return Me.elements[0]*=o,Me.elements[1]*=o,Me.elements[2]*=o,Me.elements[4]*=l,Me.elements[5]*=l,Me.elements[6]*=l,Me.elements[8]*=h,Me.elements[9]*=h,Me.elements[10]*=h,e.setFromRotationMatrix(Me),i.x=s,i.y=r,i.z=a,this}makePerspective(t,e,i,n,s,r){void 0===r&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,o=2*s/(e-t),l=2*s/(i-n),h=(e+t)/(e-t),c=(i+n)/(i-n),u=-(r+s)/(r-s),d=-2*r*s/(r-s);return a[0]=o,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,n,s,r){const a=this.elements,o=1/(e-t),l=1/(i-n),h=1/(r-s),c=(e+t)*o,u=(i+n)*l,d=(r+s)*h;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}we.prototype.isMatrix4=!0;const _e=new Wt,Me=new we,Se=new Wt(0,0,0),Te=new Wt(1,1,1),Ae=new Wt,Ee=new Wt,Le=new Wt,Ce=new we,Pe=new Vt;class Re{constructor(t=0,e=0,i=0,n=Re.DefaultOrder){this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,s=n[0],r=n[4],a=n[8],o=n[1],l=n[5],h=n[9],c=n[2],u=n[6],d=n[10];switch(e){case"XYZ":this._y=Math.asin(bt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-r,s)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-bt(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-c,s),this._z=0);break;case"ZXY":this._x=Math.asin(bt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-r,l)):(this._y=0,this._z=Math.atan2(o,s));break;case"ZYX":this._y=Math.asin(-bt(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,s)):(this._x=0,this._z=Math.atan2(-r,l));break;case"YZX":this._z=Math.asin(bt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,s)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-bt(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-h,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return Ce.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ce,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Pe.setFromEuler(this),this.setFromQuaternion(Pe,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new Wt(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Re.prototype.isEuler=!0,Re.DefaultOrder="XYZ",Re.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Fe{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}}let Ie=0;const De=new Wt,Ne=new Vt,ke=new we,ze=new Wt,Ue=new Wt,Oe=new Wt,Be=new Vt,He=new Wt(1,0,0),Ge=new Wt(0,1,0),Ve=new Wt(0,0,1),We={type:"added"},je={type:"removed"};class Xe extends pt{constructor(){super(),Object.defineProperty(this,"id",{value:Ie++}),this.uuid=yt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Xe.DefaultUp.clone();const t=new Wt,e=new Re,i=new Vt,n=new Wt(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new we},normalMatrix:{value:new Lt}}),this.matrix=new we,this.matrixWorld=new we,this.matrixAutoUpdate=Xe.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Fe,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Ne.setFromAxisAngle(t,e),this.quaternion.multiply(Ne),this}rotateOnWorldAxis(t,e){return Ne.setFromAxisAngle(t,e),this.quaternion.premultiply(Ne),this}rotateX(t){return this.rotateOnAxis(He,t)}rotateY(t){return this.rotateOnAxis(Ge,t)}rotateZ(t){return this.rotateOnAxis(Ve,t)}translateOnAxis(t,e){return De.copy(t).applyQuaternion(this.quaternion),this.position.add(De.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(He,t)}translateY(t){return this.translateOnAxis(Ge,t)}translateZ(t){return this.translateOnAxis(Ve,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(ke.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?ze.copy(t):ze.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),Ue.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ke.lookAt(Ue,ze,this.up):ke.lookAt(ze,Ue,this.up),this.quaternion.setFromRotationMatrix(ke),n&&(ke.extractRotation(n.matrixWorld),Ne.setFromRotationMatrix(ke),this.quaternion.premultiply(Ne.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(We)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(je)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(je)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),ke.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),ke.multiply(t.parent.matrixWorld)),t.applyMatrix4(ke),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ue,t,Oe),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ue,Be,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function s(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,n=i.length;e<n;e++){const n=i[e];s(t.shapes,n)}else s(t.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(s(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,n=this.material.length;i<n;i++)e.push(s(t.materials,this.material[i]));n.material=e}else n.material=s(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];n.animations.push(s(t.animations,i))}}if(e){const e=r(t.geometries),n=r(t.materials),s=r(t.textures),a=r(t.images),o=r(t.shapes),l=r(t.skeletons),h=r(t.animations);e.length>0&&(i.geometries=e),n.length>0&&(i.materials=n),s.length>0&&(i.textures=s),a.length>0&&(i.images=a),o.length>0&&(i.shapes=o),l.length>0&&(i.skeletons=l),h.length>0&&(i.animations=h)}return i.object=n,i;function r(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}Xe.DefaultUp=new Wt(0,1,0),Xe.DefaultMatrixAutoUpdate=!0,Xe.prototype.isObject3D=!0;const Ye=new Wt,qe=new Wt,Qe=new Wt,Ze=new Wt,Je=new Wt,Ke=new Wt,$e=new Wt,ti=new Wt,ei=new Wt,ii=new Wt;class ni{constructor(t=new Wt,e=new Wt,i=new Wt){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),Ye.subVectors(t,e),n.cross(Ye);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(t,e,i,n,s){Ye.subVectors(n,e),qe.subVectors(i,e),Qe.subVectors(t,e);const r=Ye.dot(Ye),a=Ye.dot(qe),o=Ye.dot(Qe),l=qe.dot(qe),h=qe.dot(Qe),c=r*l-a*a;if(0===c)return s.set(-2,-1,-1);const u=1/c,d=(l*o-a*h)*u,p=(r*h-a*o)*u;return s.set(1-d-p,p,d)}static containsPoint(t,e,i,n){return this.getBarycoord(t,e,i,n,Ze),Ze.x>=0&&Ze.y>=0&&Ze.x+Ze.y<=1}static getUV(t,e,i,n,s,r,a,o){return this.getBarycoord(t,e,i,n,Ze),o.set(0,0),o.addScaledVector(s,Ze.x),o.addScaledVector(r,Ze.y),o.addScaledVector(a,Ze.z),o}static isFrontFacing(t,e,i,n){return Ye.subVectors(i,e),qe.subVectors(t,e),Ye.cross(qe).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Ye.subVectors(this.c,this.b),qe.subVectors(this.a,this.b),.5*Ye.cross(qe).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ni.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return ni.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,s){return ni.getUV(t,this.a,this.b,this.c,e,i,n,s)}containsPoint(t){return ni.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ni.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,s=this.c;let r,a;Je.subVectors(n,i),Ke.subVectors(s,i),ti.subVectors(t,i);const o=Je.dot(ti),l=Ke.dot(ti);if(o<=0&&l<=0)return e.copy(i);ei.subVectors(t,n);const h=Je.dot(ei),c=Ke.dot(ei);if(h>=0&&c<=h)return e.copy(n);const u=o*c-h*l;if(u<=0&&o>=0&&h<=0)return r=o/(o-h),e.copy(i).addScaledVector(Je,r);ii.subVectors(t,s);const d=Je.dot(ii),p=Ke.dot(ii);if(p>=0&&d<=p)return e.copy(s);const m=d*l-o*p;if(m<=0&&l>=0&&p<=0)return a=l/(l-p),e.copy(i).addScaledVector(Ke,a);const f=h*p-d*c;if(f<=0&&c-h>=0&&d-p>=0)return $e.subVectors(s,n),a=(c-h)/(c-h+(d-p)),e.copy(n).addScaledVector($e,a);const g=1/(f+m+u);return r=m*g,a=u*g,e.copy(i).addScaledVector(Je,r).addScaledVector(Ke,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let si=0;class ri extends pt{constructor(){super(),Object.defineProperty(this,"id",{value:si++}),this.uuid=yt(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.format=I,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=r,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ht,this.stencilZFail=ht,this.stencilZPass=ht,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;continue}const n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenTint&&this.sheenTint.isColor&&(i.sheenTint=this.sheenTint.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularTint&&this.specularTint.isColor&&(i.specularTint=this.specularTint.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularTintMap&&this.specularTintMap.isTexture&&(i.specularTintMap=this.specularTintMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationTint&&(i.attenuationTint=this.attenuationTint.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.format!==I&&(i.format=this.format),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e){const e=n(t.textures),s=n(t.images);e.length>0&&(i.textures=e),s.length>0&&(i.images=s)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.format=t.format,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let n=0;n!==t;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}ri.prototype.isMaterial=!0;const ai={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},oi={h:0,s:0,l:0},li={h:0,s:0,l:0};function hi(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function ci(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function ui(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class di{constructor(t,e,i){return void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,i){return this.r=t,this.g=e,this.b=i,this}setHSL(t,e,i){if(t=wt(t,1),e=bt(e,0,1),i=bt(i,0,1),0===e)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,s=2*i-n;this.r=hi(s,n,t+1/3),this.g=hi(s,n,t),this.b=hi(s,n,t-1/3)}return this}setStyle(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const n=i[1],s=i[2];switch(n){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const i=parseFloat(t[1])/360,n=parseInt(t[2],10)/100,s=parseInt(t[3],10)/100;return e(t[4]),this.setHSL(i,n,s)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=i[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=ai[t.toLowerCase()];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,e=2){return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}copyLinearToGamma(t,e=2){const i=e>0?1/e:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=ci(t.r),this.g=ci(t.g),this.b=ci(t.b),this}copyLinearToSRGB(t){return this.r=ui(t.r),this.g=ui(t.g),this.b=ui(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){const e=this.r,i=this.g,n=this.b,s=Math.max(e,i,n),r=Math.min(e,i,n);let a,o;const l=(r+s)/2;if(r===s)a=0,o=0;else{const t=s-r;switch(o=l<=.5?t/(s+r):t/(2-s-r),s){case e:a=(i-n)/t+(i<n?6:0);break;case i:a=(n-e)/t+2;break;case n:a=(e-i)/t+4}a/=6}return t.h=a,t.s=o,t.l=l,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,i){return this.getHSL(oi),oi.h+=t,oi.s+=e,oi.l+=i,this.setHSL(oi.h,oi.s,oi.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(oi),t.getHSL(li);const i=_t(oi.h,li.h,e),n=_t(oi.s,li.s,e),s=_t(oi.l,li.l,e);return this.setHSL(i,n,s),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}di.NAMES=ai,di.prototype.isColor=!0,di.prototype.r=1,di.prototype.g=1,di.prototype.b=1;class pi extends ri{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new di(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}pi.prototype.isMeshBasicMaterial=!0;const mi=new Wt,fi=new Et;class gi{constructor(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.usage=ct,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let i=0;for(let n=0,s=t.length;n<s;n++){let s=t[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),s=new di),e[i++]=s.r,e[i++]=s.g,e[i++]=s.b}return this}copyVector2sArray(t){const e=this.array;let i=0;for(let n=0,s=t.length;n<s;n++){let s=t[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),s=new Et),e[i++]=s.x,e[i++]=s.y}return this}copyVector3sArray(t){const e=this.array;let i=0;for(let n=0,s=t.length;n<s;n++){let s=t[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),s=new Wt),e[i++]=s.x,e[i++]=s.y,e[i++]=s.z}return this}copyVector4sArray(t){const e=this.array;let i=0;for(let n=0,s=t.length;n<s;n++){let s=t[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),s=new Ot),e[i++]=s.x,e[i++]=s.y,e[i++]=s.z,e[i++]=s.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)fi.fromBufferAttribute(this,e),fi.applyMatrix3(t),this.setXY(e,fi.x,fi.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)mi.fromBufferAttribute(this,e),mi.applyMatrix3(t),this.setXYZ(e,mi.x,mi.y,mi.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)mi.x=this.getX(e),mi.y=this.getY(e),mi.z=this.getZ(e),mi.applyMatrix4(t),this.setXYZ(e,mi.x,mi.y,mi.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)mi.x=this.getX(e),mi.y=this.getY(e),mi.z=this.getZ(e),mi.applyNormalMatrix(t),this.setXYZ(e,mi.x,mi.y,mi.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)mi.x=this.getX(e),mi.y=this.getY(e),mi.z=this.getZ(e),mi.transformDirection(t),this.setXYZ(e,mi.x,mi.y,mi.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,s){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==ct&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}gi.prototype.isBufferAttribute=!0;class vi extends gi{constructor(t,e,i){super(new Int8Array(t),e,i)}}class xi extends gi{constructor(t,e,i){super(new Uint8Array(t),e,i)}}class yi extends gi{constructor(t,e,i){super(new Uint8ClampedArray(t),e,i)}}class bi extends gi{constructor(t,e,i){super(new Int16Array(t),e,i)}}class wi extends gi{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class _i extends gi{constructor(t,e,i){super(new Int32Array(t),e,i)}}class Mi extends gi{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class Si extends gi{constructor(t,e,i){super(new Uint16Array(t),e,i)}}Si.prototype.isFloat16BufferAttribute=!0;class Ti extends gi{constructor(t,e,i){super(new Float32Array(t),e,i)}}class Ai extends gi{constructor(t,e,i){super(new Float64Array(t),e,i)}}let Ei=0;const Li=new we,Ci=new Xe,Pi=new Wt,Ri=new Yt,Fi=new Yt,Ii=new Wt;class Di extends pt{constructor(){super(),Object.defineProperty(this,"id",{value:Ei++}),this.uuid=yt(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Ct(t)>65535?Mi:wi)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new Lt).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Li.makeRotationFromQuaternion(t),this.applyMatrix4(Li),this}rotateX(t){return Li.makeRotationX(t),this.applyMatrix4(Li),this}rotateY(t){return Li.makeRotationY(t),this.applyMatrix4(Li),this}rotateZ(t){return Li.makeRotationZ(t),this.applyMatrix4(Li),this}translate(t,e,i){return Li.makeTranslation(t,e,i),this.applyMatrix4(Li),this}scale(t,e,i){return Li.makeScale(t,e,i),this.applyMatrix4(Li),this}lookAt(t){return Ci.lookAt(t),Ci.updateMatrix(),this.applyMatrix4(Ci.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Pi).negate(),this.translate(Pi.x,Pi.y,Pi.z),this}setFromPoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Ti(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Yt);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Wt(-1/0,-1/0,-1/0),new Wt(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];Ri.setFromBufferAttribute(i),this.morphTargetsRelative?(Ii.addVectors(this.boundingBox.min,Ri.min),this.boundingBox.expandByPoint(Ii),Ii.addVectors(this.boundingBox.max,Ri.max),this.boundingBox.expandByPoint(Ii)):(this.boundingBox.expandByPoint(Ri.min),this.boundingBox.expandByPoint(Ri.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new de);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Wt,1/0);if(t){const i=this.boundingSphere.center;if(Ri.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];Fi.setFromBufferAttribute(i),this.morphTargetsRelative?(Ii.addVectors(Ri.min,Fi.min),Ri.expandByPoint(Ii),Ii.addVectors(Ri.max,Fi.max),Ri.expandByPoint(Ii)):(Ri.expandByPoint(Fi.min),Ri.expandByPoint(Fi.max))}Ri.getCenter(i);let n=0;for(let e=0,s=t.count;e<s;e++)Ii.fromBufferAttribute(t,e),n=Math.max(n,i.distanceToSquared(Ii));if(e)for(let s=0,r=e.length;s<r;s++){const r=e[s],a=this.morphTargetsRelative;for(let e=0,s=r.count;e<s;e++)Ii.fromBufferAttribute(r,e),a&&(Pi.fromBufferAttribute(t,e),Ii.add(Pi)),n=Math.max(n,i.distanceToSquared(Ii))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.array,n=e.position.array,s=e.normal.array,r=e.uv.array,a=n.length/3;void 0===e.tangent&&this.setAttribute("tangent",new gi(new Float32Array(4*a),4));const o=e.tangent.array,l=[],h=[];for(let t=0;t<a;t++)l[t]=new Wt,h[t]=new Wt;const c=new Wt,u=new Wt,d=new Wt,p=new Et,m=new Et,f=new Et,g=new Wt,v=new Wt;function x(t,e,i){c.fromArray(n,3*t),u.fromArray(n,3*e),d.fromArray(n,3*i),p.fromArray(r,2*t),m.fromArray(r,2*e),f.fromArray(r,2*i),u.sub(c),d.sub(c),m.sub(p),f.sub(p);const s=1/(m.x*f.y-f.x*m.y);isFinite(s)&&(g.copy(u).multiplyScalar(f.y).addScaledVector(d,-m.y).multiplyScalar(s),v.copy(d).multiplyScalar(m.x).addScaledVector(u,-f.x).multiplyScalar(s),l[t].add(g),l[e].add(g),l[i].add(g),h[t].add(v),h[e].add(v),h[i].add(v))}let y=this.groups;0===y.length&&(y=[{start:0,count:i.length}]);for(let t=0,e=y.length;t<e;++t){const e=y[t],n=e.start;for(let t=n,s=n+e.count;t<s;t+=3)x(i[t+0],i[t+1],i[t+2])}const b=new Wt,w=new Wt,_=new Wt,M=new Wt;function S(t){_.fromArray(s,3*t),M.copy(_);const e=l[t];b.copy(e),b.sub(_.multiplyScalar(_.dot(e))).normalize(),w.crossVectors(M,e);const i=w.dot(h[t])<0?-1:1;o[4*t]=b.x,o[4*t+1]=b.y,o[4*t+2]=b.z,o[4*t+3]=i}for(let t=0,e=y.length;t<e;++t){const e=y[t],n=e.start;for(let t=n,s=n+e.count;t<s;t+=3)S(i[t+0]),S(i[t+1]),S(i[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new gi(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const n=new Wt,s=new Wt,r=new Wt,a=new Wt,o=new Wt,l=new Wt,h=new Wt,c=new Wt;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),m=t.getX(u+2);n.fromBufferAttribute(e,d),s.fromBufferAttribute(e,p),r.fromBufferAttribute(e,m),h.subVectors(r,s),c.subVectors(n,s),h.cross(c),a.fromBufferAttribute(i,d),o.fromBufferAttribute(i,p),l.fromBufferAttribute(i,m),a.add(h),o.add(h),l.add(h),i.setXYZ(d,a.x,a.y,a.z),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(m,l.x,l.y,l.z)}else for(let t=0,a=e.count;t<a;t+=3)n.fromBufferAttribute(e,t+0),s.fromBufferAttribute(e,t+1),r.fromBufferAttribute(e,t+2),h.subVectors(r,s),c.subVectors(n,s),h.cross(c),i.setXYZ(t+0,h.x,h.y,h.z),i.setXYZ(t+1,h.x,h.y,h.z),i.setXYZ(t+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const n in i){if(void 0===t.attributes[n])continue;const s=i[n].array,r=t.attributes[n],a=r.array,o=r.itemSize*e,l=Math.min(a.length,s.length-o);for(let t=0,e=o;t<l;t++,e++)s[e]=a[t]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)Ii.fromBufferAttribute(t,e),Ii.normalize(),t.setXYZ(e,Ii.x,Ii.y,Ii.z)}toNonIndexed(){function t(t,e){const i=t.array,n=t.itemSize,s=t.normalized,r=new i.constructor(e.length*n);let a=0,o=0;for(let s=0,l=e.length;s<l;s++){a=t.isInterleavedBufferAttribute?e[s]*t.data.stride+t.offset:e[s]*n;for(let t=0;t<n;t++)r[o++]=i[a++]}return new gi(r,n,s)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Di,i=this.index.array,n=this.attributes;for(const s in n){const r=t(n[s],i);e.setAttribute(s,r)}const s=this.morphAttributes;for(const n in s){const r=[],a=s[n];for(let e=0,n=a.length;e<n;e++){const n=t(a[e],i);r.push(n)}e.morphAttributes[n]=r}e.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let t=0,i=r.length;t<i;t++){const i=r[t];e.addGroup(i.start,i.count,i.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const e in i){const n=i[e];t.data.attributes[e]=n.toJSON(t.data)}const n={};let s=!1;for(const e in this.morphAttributes){const i=this.morphAttributes[e],r=[];for(let e=0,n=i.length;e<n;e++){const n=i[e];r.push(n.toJSON(t.data))}r.length>0&&(n[e]=r,s=!0)}s&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(t.data.groups=JSON.parse(JSON.stringify(r)));const a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const n=t.attributes;for(const t in n){const i=n[t];this.setAttribute(t,i.clone(e))}const s=t.morphAttributes;for(const t in s){const i=[],n=s[t];for(let t=0,s=n.length;t<s;t++)i.push(n[t].clone(e));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const r=t.groups;for(let t=0,e=r.length;t<e;t++){const e=r[t];this.addGroup(e.start,e.count,e.materialIndex)}const a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=t.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Di.prototype.isBufferGeometry=!0;const Ni=new we,ki=new be,zi=new de,Ui=new Wt,Oi=new Wt,Bi=new Wt,Hi=new Wt,Gi=new Wt,Vi=new Wt,Wi=new Wt,ji=new Wt,Xi=new Wt,Yi=new Et,qi=new Et,Qi=new Et,Zi=new Wt,Ji=new Wt;class Ki extends Xe{constructor(t=new Di,e=new pi){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const i=this.geometry,n=this.material,s=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),zi.copy(i.boundingSphere),zi.applyMatrix4(s),!1===t.ray.intersectsSphere(zi))return;if(Ni.copy(s).invert(),ki.copy(t.ray).applyMatrix4(Ni),null!==i.boundingBox&&!1===ki.intersectsBox(i.boundingBox))return;let r;if(i.isBufferGeometry){const s=i.index,a=i.attributes.position,o=i.morphAttributes.position,l=i.morphTargetsRelative,h=i.attributes.uv,c=i.attributes.uv2,u=i.groups,d=i.drawRange;if(null!==s)if(Array.isArray(n))for(let i=0,p=u.length;i<p;i++){const p=u[i],m=n[p.materialIndex];for(let i=Math.max(p.start,d.start),n=Math.min(s.count,Math.min(p.start+p.count,d.start+d.count));i<n;i+=3){const n=s.getX(i),u=s.getX(i+1),d=s.getX(i+2);r=$i(this,m,t,ki,a,o,l,h,c,n,u,d),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=p.materialIndex,e.push(r))}}else{for(let i=Math.max(0,d.start),u=Math.min(s.count,d.start+d.count);i<u;i+=3){const u=s.getX(i),d=s.getX(i+1),p=s.getX(i+2);r=$i(this,n,t,ki,a,o,l,h,c,u,d,p),r&&(r.faceIndex=Math.floor(i/3),e.push(r))}}else if(void 0!==a)if(Array.isArray(n))for(let i=0,s=u.length;i<s;i++){const s=u[i],p=n[s.materialIndex];for(let i=Math.max(s.start,d.start),n=Math.min(a.count,Math.min(s.start+s.count,d.start+d.count));i<n;i+=3){r=$i(this,p,t,ki,a,o,l,h,c,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=s.materialIndex,e.push(r))}}else{for(let i=Math.max(0,d.start),s=Math.min(a.count,d.start+d.count);i<s;i+=3){r=$i(this,n,t,ki,a,o,l,h,c,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),e.push(r))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function $i(t,e,i,n,s,r,a,o,l,h,c,u){Ui.fromBufferAttribute(s,h),Oi.fromBufferAttribute(s,c),Bi.fromBufferAttribute(s,u);const d=t.morphTargetInfluences;if(r&&d){Wi.set(0,0,0),ji.set(0,0,0),Xi.set(0,0,0);for(let t=0,e=r.length;t<e;t++){const e=d[t],i=r[t];0!==e&&(Hi.fromBufferAttribute(i,h),Gi.fromBufferAttribute(i,c),Vi.fromBufferAttribute(i,u),a?(Wi.addScaledVector(Hi,e),ji.addScaledVector(Gi,e),Xi.addScaledVector(Vi,e)):(Wi.addScaledVector(Hi.sub(Ui),e),ji.addScaledVector(Gi.sub(Oi),e),Xi.addScaledVector(Vi.sub(Bi),e)))}Ui.add(Wi),Oi.add(ji),Bi.add(Xi)}t.isSkinnedMesh&&(t.boneTransform(h,Ui),t.boneTransform(c,Oi),t.boneTransform(u,Bi));const p=function(t,e,i,n,s,r,a,o){let l;if(l=1===e.side?n.intersectTriangle(a,r,s,!0,o):n.intersectTriangle(s,r,a,2!==e.side,o),null===l)return null;Ji.copy(o),Ji.applyMatrix4(t.matrixWorld);const h=i.ray.origin.distanceTo(Ji);return h<i.near||h>i.far?null:{distance:h,point:Ji.clone(),object:t}}(t,e,i,n,Ui,Oi,Bi,Zi);if(p){o&&(Yi.fromBufferAttribute(o,h),qi.fromBufferAttribute(o,c),Qi.fromBufferAttribute(o,u),p.uv=ni.getUV(Zi,Ui,Oi,Bi,Yi,qi,Qi,new Et)),l&&(Yi.fromBufferAttribute(l,h),qi.fromBufferAttribute(l,c),Qi.fromBufferAttribute(l,u),p.uv2=ni.getUV(Zi,Ui,Oi,Bi,Yi,qi,Qi,new Et));const t={a:h,b:c,c:u,normal:new Wt,materialIndex:0};ni.getNormal(Ui,Oi,Bi,t.normal),p.face=t}return p}Ki.prototype.isMesh=!0;class tn extends Di{constructor(t=1,e=1,i=1,n=1,s=1,r=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:s,depthSegments:r};const a=this;n=Math.floor(n),s=Math.floor(s),r=Math.floor(r);const o=[],l=[],h=[],c=[];let u=0,d=0;function p(t,e,i,n,s,r,p,m,f,g,v){const x=r/f,y=p/g,b=r/2,w=p/2,_=m/2,M=f+1,S=g+1;let T=0,A=0;const E=new Wt;for(let r=0;r<S;r++){const a=r*y-w;for(let o=0;o<M;o++){const u=o*x-b;E[t]=u*n,E[e]=a*s,E[i]=_,l.push(E.x,E.y,E.z),E[t]=0,E[e]=0,E[i]=m>0?1:-1,h.push(E.x,E.y,E.z),c.push(o/f),c.push(1-r/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<f;e++){const i=u+e+M*t,n=u+e+M*(t+1),s=u+(e+1)+M*(t+1),r=u+(e+1)+M*t;o.push(i,n,r),o.push(n,s,r),A+=6}a.addGroup(d,A,v),d+=A,u+=T}p("z","y","x",-1,-1,i,e,t,r,s,0),p("z","y","x",1,-1,i,e,-t,r,s,1),p("x","z","y",1,1,t,i,e,n,r,2),p("x","z","y",1,-1,t,i,-e,n,r,3),p("x","y","z",1,-1,t,e,i,n,s,4),p("x","y","z",-1,-1,t,e,-i,n,s,5),this.setIndex(o),this.setAttribute("position",new Ti(l,3)),this.setAttribute("normal",new Ti(h,3)),this.setAttribute("uv",new Ti(c,2))}static fromJSON(t){return new tn(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function en(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const s=t[i][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?e[i][n]=s.clone():Array.isArray(s)?e[i][n]=s.slice():e[i][n]=s}}return e}function nn(t){const e={};for(let i=0;i<t.length;i++){const n=en(t[i]);for(const t in n)e[t]=n[t]}return e}const sn={clone:en,merge:nn};class rn extends ri{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=en(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}rn.prototype.isShaderMaterial=!0;class an extends Xe{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new we,this.projectionMatrix=new we,this.projectionMatrixInverse=new we}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}an.prototype.isCamera=!0;class on extends an{constructor(t=50,e=1,i=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*gt*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*ft*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*gt*Math.atan(Math.tan(.5*ft*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,n,s,r){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*ft*this.fov)/this.zoom,i=2*e,n=this.aspect*i,s=-.5*n;const r=this.view;if(null!==this.view&&this.view.enabled){const t=r.fullWidth,a=r.fullHeight;s+=r.offsetX*n/t,e-=r.offsetY*i/a,n*=r.width/t,i*=r.height/a}const a=this.filmOffset;0!==a&&(s+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}on.prototype.isPerspectiveCamera=!0;const ln=90;class hn extends Xe{constructor(t,e,i){if(super(),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const n=new on(ln,1,t,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new Wt(1,0,0)),this.add(n);const s=new on(ln,1,t,e);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new Wt(-1,0,0)),this.add(s);const r=new on(ln,1,t,e);r.layers=this.layers,r.up.set(0,0,1),r.lookAt(new Wt(0,1,0)),this.add(r);const a=new on(ln,1,t,e);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new Wt(0,-1,0)),this.add(a);const o=new on(ln,1,t,e);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new Wt(0,0,1)),this.add(o);const l=new on(ln,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Wt(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[n,s,r,a,o,l]=this.children,h=t.xr.enabled,c=t.getRenderTarget();t.xr.enabled=!1;const u=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,s),t.setRenderTarget(i,2),t.render(e,r),t.setRenderTarget(i,3),t.render(e,a),t.setRenderTarget(i,4),t.render(e,o),i.texture.generateMipmaps=u,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(c),t.xr.enabled=h}}class cn extends zt{constructor(t,e,i,n,s,r,a,o,l,h){super(t=void 0!==t?t:[],e=void 0!==e?e:u,i,n,s,r,a,o,l,h),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}cn.prototype.isCubeTexture=!0;class un extends Bt{constructor(t,e,i){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=i),super(t,t,e),e=e||{},this.texture=new cn(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:M,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=I,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new tn(5,5,5),s=new rn({name:"CubemapFromEquirect",uniforms:en(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:1,blending:0});s.uniforms.tEquirect.value=e;const r=new Ki(n,s),a=e.minFilter;e.minFilter===T&&(e.minFilter=M);return new hn(1,10,this).update(t,r),e.minFilter=a,r.geometry.dispose(),r.material.dispose(),this}clear(t,e,i,n){const s=t.getRenderTarget();for(let s=0;s<6;s++)t.setRenderTarget(this,s),t.clear(e,i,n);t.setRenderTarget(s)}}un.prototype.isWebGLCubeRenderTarget=!0;const dn=new Wt,pn=new Wt,mn=new Lt;class fn{constructor(t=new Wt(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=dn.subVectors(i,e).cross(pn.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const i=t.delta(dn),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:e.copy(i).multiplyScalar(s).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||mn.getNormalMatrix(t),n=this.coplanarPoint(dn).applyMatrix4(t),s=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}fn.prototype.isPlane=!0;const gn=new de,vn=new Wt;class xn{constructor(t=new fn,e=new fn,i=new fn,n=new fn,s=new fn,r=new fn){this.planes=[t,e,i,n,s,r]}set(t,e,i,n,s,r){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(n),a[4].copy(s),a[5].copy(r),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,n=i[0],s=i[1],r=i[2],a=i[3],o=i[4],l=i[5],h=i[6],c=i[7],u=i[8],d=i[9],p=i[10],m=i[11],f=i[12],g=i[13],v=i[14],x=i[15];return e[0].setComponents(a-n,c-o,m-u,x-f).normalize(),e[1].setComponents(a+n,c+o,m+u,x+f).normalize(),e[2].setComponents(a+s,c+l,m+d,x+g).normalize(),e[3].setComponents(a-s,c-l,m-d,x-g).normalize(),e[4].setComponents(a-r,c-h,m-p,x-v).normalize(),e[5].setComponents(a+r,c+h,m+p,x+v).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),gn.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(gn)}intersectsSprite(t){return gn.center.set(0,0,0),gn.radius=.7071067811865476,gn.applyMatrix4(t.matrixWorld),this.intersectsSphere(gn)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(i)<n)return!1}return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(vn.x=n.normal.x>0?t.max.x:t.min.x,vn.y=n.normal.y>0?t.max.y:t.min.y,vn.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(vn)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function yn(){let t=null,e=!1,i=null,n=null;function s(e,r){i(e,r),n=t.requestAnimationFrame(s)}return{start:function(){!0!==e&&null!==i&&(n=t.requestAnimationFrame(s),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function bn(t,e){const i=e.isWebGL2,n=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),n.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const i=n.get(e);i&&(t.deleteBuffer(i.buffer),n.delete(e))},update:function(e,s){if(e.isGLBufferAttribute){const t=n.get(e);return void((!t||t.version<e.version)&&n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const r=n.get(e);void 0===r?n.set(e,function(e,n){const s=e.array,r=e.usage,a=t.createBuffer();t.bindBuffer(n,a),t.bufferData(n,s,r),e.onUploadCallback();let o=5126;return s instanceof Float32Array?o=5126:s instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):s instanceof Uint16Array?e.isFloat16BufferAttribute?i?o=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):o=5123:s instanceof Int16Array?o=5122:s instanceof Uint32Array?o=5125:s instanceof Int32Array?o=5124:s instanceof Int8Array?o=5120:(s instanceof Uint8Array||s instanceof Uint8ClampedArray)&&(o=5121),{buffer:a,type:o,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version}}(e,s)):r.version<e.version&&(!function(e,n,s){const r=n.array,a=n.updateRange;t.bindBuffer(s,e),-1===a.count?t.bufferSubData(s,0,r):(i?t.bufferSubData(s,a.offset*r.BYTES_PER_ELEMENT,r,a.offset,a.count):t.bufferSubData(s,a.offset*r.BYTES_PER_ELEMENT,r.subarray(a.offset,a.offset+a.count)),a.count=-1)}(r.buffer,e,s),r.version=e.version)}}}class wn extends Di{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const s=t/2,r=e/2,a=Math.floor(i),o=Math.floor(n),l=a+1,h=o+1,c=t/a,u=e/o,d=[],p=[],m=[],f=[];for(let t=0;t<h;t++){const e=t*u-r;for(let i=0;i<l;i++){const n=i*c-s;p.push(n,-e,0),m.push(0,0,1),f.push(i/a),f.push(1-t/o)}}for(let t=0;t<o;t++)for(let e=0;e<a;e++){const i=e+l*t,n=e+l*(t+1),s=e+1+l*(t+1),r=e+1+l*t;d.push(i,n,r),d.push(n,s,r)}this.setIndex(d),this.setAttribute("position",new Ti(p,3)),this.setAttribute("normal",new Ti(m,3)),this.setAttribute("uv",new Ti(f,2))}static fromJSON(t){return new wn(t.width,t.height,t.widthSegments,t.heightSegments)}}const _n={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenTint, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenTint * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularTintFactor = specularTint;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARTINTMAP\n\t\t\tspecularTintFactor *= specularTintMapTexelToLinear( texture2D( specularTintMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularTintFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularTintFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenTint = sheenTint;\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenTint;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenTint, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationTint, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationTint;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularTint;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARTINTMAP\n\t\tuniform sampler2D specularTintMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenTint;\n\tuniform float sheenRoughness;\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Mn={common:{diffuse:{value:new di(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Lt},uv2Transform:{value:new Lt},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Et(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new di(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new di(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Lt}},sprite:{diffuse:{value:new di(16777215)},opacity:{value:1},center:{value:new Et(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Lt}}},Sn={basic:{uniforms:nn([Mn.common,Mn.specularmap,Mn.envmap,Mn.aomap,Mn.lightmap,Mn.fog]),vertexShader:_n.meshbasic_vert,fragmentShader:_n.meshbasic_frag},lambert:{uniforms:nn([Mn.common,Mn.specularmap,Mn.envmap,Mn.aomap,Mn.lightmap,Mn.emissivemap,Mn.fog,Mn.lights,{emissive:{value:new di(0)}}]),vertexShader:_n.meshlambert_vert,fragmentShader:_n.meshlambert_frag},phong:{uniforms:nn([Mn.common,Mn.specularmap,Mn.envmap,Mn.aomap,Mn.lightmap,Mn.emissivemap,Mn.bumpmap,Mn.normalmap,Mn.displacementmap,Mn.fog,Mn.lights,{emissive:{value:new di(0)},specular:{value:new di(1118481)},shininess:{value:30}}]),vertexShader:_n.meshphong_vert,fragmentShader:_n.meshphong_frag},standard:{uniforms:nn([Mn.common,Mn.envmap,Mn.aomap,Mn.lightmap,Mn.emissivemap,Mn.bumpmap,Mn.normalmap,Mn.displacementmap,Mn.roughnessmap,Mn.metalnessmap,Mn.fog,Mn.lights,{emissive:{value:new di(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:_n.meshphysical_vert,fragmentShader:_n.meshphysical_frag},toon:{uniforms:nn([Mn.common,Mn.aomap,Mn.lightmap,Mn.emissivemap,Mn.bumpmap,Mn.normalmap,Mn.displacementmap,Mn.gradientmap,Mn.fog,Mn.lights,{emissive:{value:new di(0)}}]),vertexShader:_n.meshtoon_vert,fragmentShader:_n.meshtoon_frag},matcap:{uniforms:nn([Mn.common,Mn.bumpmap,Mn.normalmap,Mn.displacementmap,Mn.fog,{matcap:{value:null}}]),vertexShader:_n.meshmatcap_vert,fragmentShader:_n.meshmatcap_frag},points:{uniforms:nn([Mn.points,Mn.fog]),vertexShader:_n.points_vert,fragmentShader:_n.points_frag},dashed:{uniforms:nn([Mn.common,Mn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:_n.linedashed_vert,fragmentShader:_n.linedashed_frag},depth:{uniforms:nn([Mn.common,Mn.displacementmap]),vertexShader:_n.depth_vert,fragmentShader:_n.depth_frag},normal:{uniforms:nn([Mn.common,Mn.bumpmap,Mn.normalmap,Mn.displacementmap,{opacity:{value:1}}]),vertexShader:_n.meshnormal_vert,fragmentShader:_n.meshnormal_frag},sprite:{uniforms:nn([Mn.sprite,Mn.fog]),vertexShader:_n.sprite_vert,fragmentShader:_n.sprite_frag},background:{uniforms:{uvTransform:{value:new Lt},t2D:{value:null}},vertexShader:_n.background_vert,fragmentShader:_n.background_frag},cube:{uniforms:nn([Mn.envmap,{opacity:{value:1}}]),vertexShader:_n.cube_vert,fragmentShader:_n.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:_n.equirect_vert,fragmentShader:_n.equirect_frag},distanceRGBA:{uniforms:nn([Mn.common,Mn.displacementmap,{referencePosition:{value:new Wt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:_n.distanceRGBA_vert,fragmentShader:_n.distanceRGBA_frag},shadow:{uniforms:nn([Mn.lights,Mn.fog,{color:{value:new di(0)},opacity:{value:1}}]),vertexShader:_n.shadow_vert,fragmentShader:_n.shadow_frag}};function Tn(t,e,i,n,s){const r=new di(0);let a,o,l=0,h=null,c=0,u=null;function d(t,e){i.buffers.color.setClear(t.r,t.g,t.b,e,s)}return{getClearColor:function(){return r},setClearColor:function(t,e=1){r.set(t),l=e,d(r,l)},getClearAlpha:function(){return l},setClearAlpha:function(t){l=t,d(r,l)},render:function(i,s){let p=!1,m=!0===s.isScene?s.background:null;m&&m.isTexture&&(m=e.get(m));const g=t.xr,v=g.getSession&&g.getSession();v&&"additive"===v.environmentBlendMode&&(m=null),null===m?d(r,l):m&&m.isColor&&(d(m,1),p=!0),(t.autoClear||p)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),m&&(m.isCubeTexture||m.mapping===f)?(void 0===o&&(o=new Ki(new tn(1,1,1),new rn({name:"BackgroundCubeMaterial",uniforms:en(Sn.cube.uniforms),vertexShader:Sn.cube.vertexShader,fragmentShader:Sn.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(o)),o.material.uniforms.envMap.value=m,o.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,h===m&&c===m.version&&u===t.toneMapping||(o.material.needsUpdate=!0,h=m,c=m.version,u=t.toneMapping),i.unshift(o,o.geometry,o.material,0,0,null)):m&&m.isTexture&&(void 0===a&&(a=new Ki(new wn(2,2),new rn({name:"BackgroundMaterial",uniforms:en(Sn.background.uniforms),vertexShader:Sn.background.vertexShader,fragmentShader:Sn.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(a)),a.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),a.material.uniforms.uvTransform.value.copy(m.matrix),h===m&&c===m.version&&u===t.toneMapping||(a.material.needsUpdate=!0,h=m,c=m.version,u=t.toneMapping),i.unshift(a,a.geometry,a.material,0,0,null))}}}function An(t,e,i,n){const s=t.getParameter(34921),r=n.isWebGL2?null:e.get("OES_vertex_array_object"),a=n.isWebGL2||null!==r,o={},l=d(null);let h=l;function c(e){return n.isWebGL2?t.bindVertexArray(e):r.bindVertexArrayOES(e)}function u(e){return n.isWebGL2?t.deleteVertexArray(e):r.deleteVertexArrayOES(e)}function d(t){const e=[],i=[],n=[];for(let t=0;t<s;t++)e[t]=0,i[t]=0,n[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:n,object:t,attributes:{},index:null}}function p(){const t=h.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function m(t){f(t,0)}function f(i,s){const r=h.newAttributes,a=h.enabledAttributes,o=h.attributeDivisors;if(r[i]=1,0===a[i]&&(t.enableVertexAttribArray(i),a[i]=1),o[i]!==s){(n.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,s),o[i]=s}}function g(){const e=h.newAttributes,i=h.enabledAttributes;for(let n=0,s=i.length;n<s;n++)i[n]!==e[n]&&(t.disableVertexAttribArray(n),i[n]=0)}function v(e,i,s,r,a,o){!0!==n.isWebGL2||5124!==s&&5125!==s?t.vertexAttribPointer(e,i,s,r,a,o):t.vertexAttribIPointer(e,i,s,a,o)}function x(){y(),h!==l&&(h=l,c(h.object))}function y(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(s,l,u,x,y){let b=!1;if(a){const e=function(e,i,s){const a=!0===s.wireframe;let l=o[e.id];void 0===l&&(l={},o[e.id]=l);let h=l[i.id];void 0===h&&(h={},l[i.id]=h);let c=h[a];void 0===c&&(c=d(n.isWebGL2?t.createVertexArray():r.createVertexArrayOES()),h[a]=c);return c}(x,u,l);h!==e&&(h=e,c(h.object)),b=function(t,e){const i=h.attributes,n=t.attributes;let s=0;for(const t in n){const e=i[t],r=n[t];if(void 0===e)return!0;if(e.attribute!==r)return!0;if(e.data!==r.data)return!0;s++}return h.attributesNum!==s||h.index!==e}(x,y),b&&function(t,e){const i={},n=t.attributes;let s=0;for(const t in n){const e=n[t],r={};r.attribute=e,e.data&&(r.data=e.data),i[t]=r,s++}h.attributes=i,h.attributesNum=s,h.index=e}(x,y)}else{const t=!0===l.wireframe;h.geometry===x.id&&h.program===u.id&&h.wireframe===t||(h.geometry=x.id,h.program=u.id,h.wireframe=t,b=!0)}!0===s.isInstancedMesh&&(b=!0),null!==y&&i.update(y,34963),b&&(!function(s,r,a,o){if(!1===n.isWebGL2&&(s.isInstancedMesh||o.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;p();const l=o.attributes,h=a.getAttributes(),c=r.defaultAttributeValues;for(const e in h){const n=h[e];if(n.location>=0){let r=l[e];if(void 0===r&&("instanceMatrix"===e&&s.instanceMatrix&&(r=s.instanceMatrix),"instanceColor"===e&&s.instanceColor&&(r=s.instanceColor)),void 0!==r){const e=r.normalized,a=r.itemSize,l=i.get(r);if(void 0===l)continue;const h=l.buffer,c=l.type,u=l.bytesPerElement;if(r.isInterleavedBufferAttribute){const i=r.data,l=i.stride,d=r.offset;if(i&&i.isInstancedInterleavedBuffer){for(let t=0;t<n.locationSize;t++)f(n.location+t,i.meshPerAttribute);!0!==s.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let t=0;t<n.locationSize;t++)m(n.location+t);t.bindBuffer(34962,h);for(let t=0;t<n.locationSize;t++)v(n.location+t,a/n.locationSize,c,e,l*u,(d+a/n.locationSize*t)*u)}else{if(r.isInstancedBufferAttribute){for(let t=0;t<n.locationSize;t++)f(n.location+t,r.meshPerAttribute);!0!==s.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=r.meshPerAttribute*r.count)}else for(let t=0;t<n.locationSize;t++)m(n.location+t);t.bindBuffer(34962,h);for(let t=0;t<n.locationSize;t++)v(n.location+t,a/n.locationSize,c,e,a*u,a/n.locationSize*t*u)}}else if(void 0!==c){const i=c[e];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(n.location,i);break;case 3:t.vertexAttrib3fv(n.location,i);break;case 4:t.vertexAttrib4fv(n.location,i);break;default:t.vertexAttrib1fv(n.location,i)}}}}g()}(s,l,u,x),null!==y&&t.bindBuffer(34963,i.get(y).buffer))},reset:x,resetDefaultState:y,dispose:function(){x();for(const t in o){const e=o[t];for(const t in e){const i=e[t];for(const t in i)u(i[t].object),delete i[t];delete e[t]}delete o[t]}},releaseStatesOfGeometry:function(t){if(void 0===o[t.id])return;const e=o[t.id];for(const t in e){const i=e[t];for(const t in i)u(i[t].object),delete i[t];delete e[t]}delete o[t.id]},releaseStatesOfProgram:function(t){for(const e in o){const i=o[e];if(void 0===i[t.id])continue;const n=i[t.id];for(const t in n)u(n[t].object),delete n[t];delete i[t.id]}},initAttributes:p,enableAttribute:m,disableUnusedAttributes:g}}function En(t,e,i,n){const s=n.isWebGL2;let r;this.setMode=function(t){r=t},this.render=function(e,n){t.drawArrays(r,e,n),i.update(n,r,1)},this.renderInstances=function(n,a,o){if(0===o)return;let l,h;if(s)l=t,h="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[h](r,n,a,o),i.update(a,r,o)}}function Ln(t,e,i){let n;function s(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const r="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let a=void 0!==i.precision?i.precision:"highp";const o=s(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);const l=r||e.has("WEBGL_draw_buffers"),h=!0===i.logarithmicDepthBuffer,c=t.getParameter(34930),u=t.getParameter(35660),d=t.getParameter(3379),p=t.getParameter(34076),m=t.getParameter(34921),f=t.getParameter(36347),g=t.getParameter(36348),v=t.getParameter(36349),x=u>0,y=r||e.has("OES_texture_float");return{isWebGL2:r,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){const i=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:s,precision:a,logarithmicDepthBuffer:h,maxTextures:c,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:f,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:x,floatFragmentTextures:y,floatVertexTextures:x&&y,maxSamples:r?t.getParameter(36183):0}}function Cn(t){const e=this;let i=null,n=0,s=!1,r=!1;const a=new fn,o=new Lt,l={value:null,needsUpdate:!1};function h(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function c(t,i,n,s){const r=null!==t?t.length:0;let h=null;if(0!==r){if(h=l.value,!0!==s||null===h){const e=n+4*r,s=i.matrixWorldInverse;o.getNormalMatrix(s),(null===h||h.length<e)&&(h=new Float32Array(e));for(let e=0,i=n;e!==r;++e,i+=4)a.copy(t[e]).applyMatrix4(s,o),a.normal.toArray(h,i),h[i+3]=a.constant}l.value=h,l.needsUpdate=!0}return e.numPlanes=r,e.numIntersection=0,h}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,r){const a=0!==t.length||e||0!==n||s;return s=e,i=c(t,r,0),n=t.length,a},this.beginShadows=function(){r=!0,c(null)},this.endShadows=function(){r=!1,h()},this.setState=function(e,a,o){const u=e.clippingPlanes,d=e.clipIntersection,p=e.clipShadows,m=t.get(e);if(!s||null===u||0===u.length||r&&!p)r?c(null):h();else{const t=r?0:n,e=4*t;let s=m.clippingState||null;l.value=s,s=c(u,a,e,o);for(let t=0;t!==e;++t)s[t]=i[t];m.clippingState=s,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function Pn(t){let e=new WeakMap;function i(t,e){return e===p?t.mapping=u:e===m&&(t.mapping=d),t}function n(t){const i=t.target;i.removeEventListener("dispose",n);const s=e.get(i);void 0!==s&&(e.delete(i),s.dispose())}return{get:function(s){if(s&&s.isTexture&&!1===s.isRenderTargetTexture){const r=s.mapping;if(r===p||r===m){if(e.has(s)){return i(e.get(s).texture,s.mapping)}{const r=s.image;if(r&&r.height>0){const a=t.getRenderTarget(),o=new un(r.height/2);return o.fromEquirectangularTexture(t,s),e.set(s,o),t.setRenderTarget(a),s.addEventListener("dispose",n),i(o.texture,s.mapping)}return null}}}return s},dispose:function(){e=new WeakMap}}}Sn.physical={uniforms:nn([Sn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Et(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenTint:{value:new di(0)},sheenRoughness:{value:0},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Et},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationTint:{value:new di(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularTint:{value:new di(1,1,1)},specularTintMap:{value:null}}]),vertexShader:_n.meshphysical_vert,fragmentShader:_n.meshphysical_frag};class Rn extends an{constructor(t=-1,e=1,i=1,n=-1,s=.1,r=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=s,this.far=r,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,s,r){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=i-t,r=i+t,a=n+e,o=n-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=t*this.view.offsetX,r=s+t*this.view.width,a-=e*this.view.offsetY,o=a-e*this.view.height}this.projectionMatrix.makeOrthographic(s,r,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}Rn.prototype.isOrthographicCamera=!0;class Fn extends rn{constructor(t){super(t),this.type="RawShaderMaterial"}}Fn.prototype.isRawShaderMaterial=!0;const In=Math.pow(2,8),Dn=[.125,.215,.35,.446,.526,.582],Nn=5+Dn.length,kn=20,zn={[et]:0,[it]:1,[st]:2,[rt]:3,[at]:4,[ot]:5,[nt]:6},Un=new Rn,{_lodPlanes:On,_sizeLods:Bn,_sigmas:Hn}=Qn(),Gn=new di;let Vn=null;const Wn=(1+Math.sqrt(5))/2,jn=1/Wn,Xn=[new Wt(1,1,1),new Wt(-1,1,1),new Wt(1,1,-1),new Wt(-1,1,-1),new Wt(0,Wn,jn),new Wt(0,Wn,-jn),new Wt(jn,0,Wn),new Wt(-jn,0,Wn),new Wt(Wn,jn,0),new Wt(-Wn,jn,0)];class Yn{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function(t){const e=new Float32Array(t),i=new Wt(0,1,0);return new Fn({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i},inputEncoding:{value:zn[3e3]},outputEncoding:{value:zn[3e3]}},vertexShader:ts(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${es()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}(kn),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){Vn=this._renderer.getRenderTarget();const s=this._allocateTargets();return this._sceneToCubeUV(t,i,n,s),e>0&&this._blur(s,0,0,e),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=$n(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=Kn(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<On.length;t++)On[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Vn),t.scissorTest=!1,Jn(t,0,0,t.width,t.height)}_fromTexture(t){Vn=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e}_allocateTargets(t){const e={magFilter:b,minFilter:b,generateMipmaps:!1,type:A,format:D,encoding:qn(t)?t.encoding:st,depthBuffer:!1},i=Zn(e);return i.depthBuffer=!t,this._pingPongRenderTarget=Zn(e),i}_compileMaterial(t){const e=new Ki(On[0],t);this._renderer.compile(e,Un)}_sceneToCubeUV(t,e,i,n){const s=new on(90,1,e,i),r=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,h=o.outputEncoding,c=o.toneMapping;o.getClearColor(Gn),o.toneMapping=0,o.outputEncoding=et,o.autoClear=!1;const u=new pi({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),d=new Ki(new tn,u);let p=!1;const m=t.background;m?m.isColor&&(u.color.copy(m),t.background=null,p=!0):(u.color.copy(Gn),p=!0);for(let e=0;e<6;e++){const i=e%3;0==i?(s.up.set(0,r[e],0),s.lookAt(a[e],0,0)):1==i?(s.up.set(0,0,r[e]),s.lookAt(0,a[e],0)):(s.up.set(0,r[e],0),s.lookAt(0,0,a[e])),Jn(n,i*In,e>2?In:0,In,In),o.setRenderTarget(n),p&&o.render(d,s),o.render(t,s)}d.geometry.dispose(),d.material.dispose(),o.toneMapping=c,o.outputEncoding=h,o.autoClear=l,t.background=m}_setEncoding(t,e){!0===this._renderer.capabilities.isWebGL2&&e.format===I&&e.type===A&&e.encoding===it?t.value=zn[3e3]:t.value=zn[e.encoding]}_textureToCubeUV(t,e){const i=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=$n()):null==this._equirectShader&&(this._equirectShader=Kn());const n=t.isCubeTexture?this._cubemapShader:this._equirectShader,s=new Ki(On[0],n),r=n.uniforms;r.envMap.value=t,t.isCubeTexture||r.texelSize.value.set(1/t.image.width,1/t.image.height),this._setEncoding(r.inputEncoding,t),this._setEncoding(r.outputEncoding,e.texture),Jn(e,0,0,3*In,2*In),i.setRenderTarget(e),i.render(s,Un)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let e=1;e<Nn;e++){const i=Math.sqrt(Hn[e]*Hn[e]-Hn[e-1]*Hn[e-1]),n=Xn[(e-1)%Xn.length];this._blur(t,e-1,e,i,n)}e.autoClear=i}_blur(t,e,i,n,s){const r=this._pingPongRenderTarget;this._halfBlur(t,r,e,i,n,"latitudinal",s),this._halfBlur(r,t,i,i,n,"longitudinal",s)}_halfBlur(t,e,i,n,s,r,a){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==r&&"longitudinal"!==r&&console.error("blur direction must be either latitudinal or longitudinal!");const h=new Ki(On[n],l),c=l.uniforms,u=Bn[i]-1,d=isFinite(s)?Math.PI/(2*u):2*Math.PI/39,p=s/d,m=isFinite(s)?1+Math.floor(3*p):kn;m>kn&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${m} samples when the maximum is set to 20`);const f=[];let g=0;for(let t=0;t<kn;++t){const e=t/p,i=Math.exp(-e*e/2);f.push(i),0==t?g+=i:t<m&&(g+=2*i)}for(let t=0;t<f.length;t++)f[t]=f[t]/g;c.envMap.value=t.texture,c.samples.value=m,c.weights.value=f,c.latitudinal.value="latitudinal"===r,a&&(c.poleAxis.value=a),c.dTheta.value=d,c.mipInt.value=8-i,this._setEncoding(c.inputEncoding,t.texture),this._setEncoding(c.outputEncoding,t.texture);const v=Bn[n];Jn(e,3*Math.max(0,In-2*v),(0===n?0:2*In)+2*v*(n>4?n-8+4:0),3*v,2*v),o.setRenderTarget(e),o.render(h,Un)}}function qn(t){return void 0!==t&&t.type===A&&(t.encoding===et||t.encoding===it||t.encoding===nt)}function Qn(){const t=[],e=[],i=[];let n=8;for(let s=0;s<Nn;s++){const r=Math.pow(2,n);e.push(r);let a=1/r;s>4?a=Dn[s-8+4-1]:0==s&&(a=0),i.push(a);const o=1/(r-1),l=-o/2,h=1+o/2,c=[l,l,h,l,h,h,l,l,h,h,l,h],u=6,d=6,p=3,m=2,f=1,g=new Float32Array(p*d*u),v=new Float32Array(m*d*u),x=new Float32Array(f*d*u);for(let t=0;t<u;t++){const e=t%3*2/3-1,i=t>2?0:-1,n=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];g.set(n,p*d*t),v.set(c,m*d*t);const s=[t,t,t,t,t,t];x.set(s,f*d*t)}const y=new Di;y.setAttribute("position",new gi(g,p)),y.setAttribute("uv",new gi(v,m)),y.setAttribute("faceIndex",new gi(x,f)),t.push(y),n>4&&n--}return{_lodPlanes:t,_sizeLods:e,_sigmas:i}}function Zn(t){const e=new Bt(3*In,3*In,t);return e.texture.mapping=f,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Jn(t,e,i,n,s){t.viewport.set(e,i,n,s),t.scissor.set(e,i,n,s)}function Kn(){const t=new Et(1,1);return new Fn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:t},inputEncoding:{value:zn[3e3]},outputEncoding:{value:zn[3e3]}},vertexShader:ts(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${es()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}function $n(){return new Fn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:zn[3e3]},outputEncoding:{value:zn[3e3]}},vertexShader:ts(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${es()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}function ts(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function es(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}function is(t){let e=new WeakMap,i=null;function n(t){const i=t.target;i.removeEventListener("dispose",n);const s=e.get(i);void 0!==s&&(e.delete(i),s.dispose())}return{get:function(s){if(s&&s.isTexture&&!1===s.isRenderTargetTexture){const r=s.mapping,a=r===p||r===m,o=r===u||r===d;if(a||o){if(e.has(s))return e.get(s).texture;{const r=s.image;if(a&&r&&r.height>0||o&&r&&function(t){let e=0;const i=6;for(let n=0;n<i;n++)void 0!==t[n]&&e++;return e===i}(r)){const r=t.getRenderTarget();null===i&&(i=new Yn(t));const o=a?i.fromEquirectangular(s):i.fromCubemap(s);return e.set(s,o),t.setRenderTarget(r),s.addEventListener("dispose",n),o.texture}return null}}}return s},dispose:function(){e=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function ns(t){const e={};function i(i){if(void 0!==e[i])return e[i];let n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(i)}return e[i]=n,n}return{has:function(t){return null!==i(t)},init:function(t){t.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float")},get:function(t){const e=i(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function ss(t,e,i,n){const s={},r=new WeakMap;function a(t){const o=t.target;null!==o.index&&e.remove(o.index);for(const t in o.attributes)e.remove(o.attributes[t]);o.removeEventListener("dispose",a),delete s[o.id];const l=r.get(o);l&&(e.remove(l),r.delete(o)),n.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,i.memory.geometries--}function o(t){const i=[],n=t.index,s=t.attributes.position;let a=0;if(null!==n){const t=n.array;a=n.version;for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],s=t[e+1],r=t[e+2];i.push(n,s,s,r,r,n)}}else{const t=s.array;a=s.version;for(let e=0,n=t.length/3-1;e<n;e+=3){const t=e+0,n=e+1,s=e+2;i.push(t,n,n,s,s,t)}}const o=new(Ct(i)>65535?Mi:wi)(i,1);o.version=a;const l=r.get(t);l&&e.remove(l),r.set(t,o)}return{get:function(t,e){return!0===s[e.id]||(e.addEventListener("dispose",a),s[e.id]=!0,i.memory.geometries++),e},update:function(t){const i=t.attributes;for(const t in i)e.update(i[t],34962);const n=t.morphAttributes;for(const t in n){const i=n[t];for(let t=0,n=i.length;t<n;t++)e.update(i[t],34962)}},getWireframeAttribute:function(t){const e=r.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&o(t)}else o(t);return r.get(t)}}}function rs(t,e,i,n){const s=n.isWebGL2;let r,a,o;this.setMode=function(t){r=t},this.setIndex=function(t){a=t.type,o=t.bytesPerElement},this.render=function(e,n){t.drawElements(r,n,a,e*o),i.update(n,r,1)},this.renderInstances=function(n,l,h){if(0===h)return;let c,u;if(s)c=t,u="drawElementsInstanced";else if(c=e.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===c)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[u](r,l,a,n*o,h),i.update(l,r,h)}}function as(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,i,n){switch(e.calls++,i){case 4:e.triangles+=n*(t/3);break;case 1:e.lines+=n*(t/2);break;case 3:e.lines+=n*(t-1);break;case 2:e.lines+=n*t;break;case 0:e.points+=n*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}class os extends zt{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=b,this.minFilter=b,this.wrapR=x,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}function ls(t,e){return t[0]-e[0]}function hs(t,e){return Math.abs(e[1])-Math.abs(t[1])}function cs(t,e){let i=1;const n=e.isInterleavedBufferAttribute?e.data.array:e.array;n instanceof Int8Array?i=127:n instanceof Int16Array?i=32767:n instanceof Int32Array?i=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),t.divideScalar(i)}function us(t,e,i){const n={},s=new Float32Array(8),r=new WeakMap,a=new Wt,o=[];for(let t=0;t<8;t++)o[t]=[t,0];return{update:function(l,h,c,u){const d=l.morphTargetInfluences;if(!0===e.isWebGL2){const n=h.morphAttributes.position.length;let s=r.get(h);if(void 0===s||s.count!==n){void 0!==s&&s.texture.dispose();const t=void 0!==h.morphAttributes.normal,i=h.morphAttributes.position,o=h.morphAttributes.normal||[],l=!0===t?2:1;let c=h.attributes.position.count*l,u=1;c>e.maxTextureSize&&(u=Math.ceil(c/e.maxTextureSize),c=e.maxTextureSize);const d=new Float32Array(c*u*4*n),p=new os(d,c,u,n);p.format=I,p.type=C;const m=4*l;for(let e=0;e<n;e++){const n=i[e],s=o[e],r=c*u*4*e;for(let e=0;e<n.count;e++){a.fromBufferAttribute(n,e),!0===n.normalized&&cs(a,n);const i=e*m;d[r+i+0]=a.x,d[r+i+1]=a.y,d[r+i+2]=a.z,d[r+i+3]=0,!0===t&&(a.fromBufferAttribute(s,e),!0===s.normalized&&cs(a,s),d[r+i+4]=a.x,d[r+i+5]=a.y,d[r+i+6]=a.z,d[r+i+7]=0)}}s={count:n,texture:p,size:new Et(c,u)},r.set(h,s)}let o=0;for(let t=0;t<d.length;t++)o+=d[t];const l=h.morphTargetsRelative?1:1-o;u.getUniforms().setValue(t,"morphTargetBaseInfluence",l),u.getUniforms().setValue(t,"morphTargetInfluences",d),u.getUniforms().setValue(t,"morphTargetsTexture",s.texture,i),u.getUniforms().setValue(t,"morphTargetsTextureSize",s.size)}else{const e=void 0===d?0:d.length;let i=n[h.id];if(void 0===i||i.length!==e){i=[];for(let t=0;t<e;t++)i[t]=[t,0];n[h.id]=i}for(let t=0;t<e;t++){const e=i[t];e[0]=t,e[1]=d[t]}i.sort(hs);for(let t=0;t<8;t++)t<e&&i[t][1]?(o[t][0]=i[t][0],o[t][1]=i[t][1]):(o[t][0]=Number.MAX_SAFE_INTEGER,o[t][1]=0);o.sort(ls);const r=h.morphAttributes.position,a=h.morphAttributes.normal;let l=0;for(let t=0;t<8;t++){const e=o[t],i=e[0],n=e[1];i!==Number.MAX_SAFE_INTEGER&&n?(r&&h.getAttribute("morphTarget"+t)!==r[i]&&h.setAttribute("morphTarget"+t,r[i]),a&&h.getAttribute("morphNormal"+t)!==a[i]&&h.setAttribute("morphNormal"+t,a[i]),s[t]=n,l+=n):(r&&!0===h.hasAttribute("morphTarget"+t)&&h.deleteAttribute("morphTarget"+t),a&&!0===h.hasAttribute("morphNormal"+t)&&h.deleteAttribute("morphNormal"+t),s[t]=0)}const c=h.morphTargetsRelative?1:1-l;u.getUniforms().setValue(t,"morphTargetBaseInfluence",c),u.getUniforms().setValue(t,"morphTargetInfluences",s)}}}}function ds(t,e,i,n){let s=new WeakMap;function r(t){const e=t.target;e.removeEventListener("dispose",r),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function(t){const a=n.render.frame,o=t.geometry,l=e.get(t,o);return s.get(l)!==a&&(e.update(l),s.set(l,a)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",r)&&t.addEventListener("dispose",r),i.update(t.instanceMatrix,34962),null!==t.instanceColor&&i.update(t.instanceColor,34962)),l},dispose:function(){s=new WeakMap}}}os.prototype.isDataTexture2DArray=!0;class ps extends zt{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=b,this.minFilter=b,this.wrapR=x,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}ps.prototype.isDataTexture3D=!0;const ms=new zt,fs=new os,gs=new ps,vs=new cn,xs=[],ys=[],bs=new Float32Array(16),ws=new Float32Array(9),_s=new Float32Array(4);function Ms(t,e,i){const n=t[0];if(n<=0||n>0)return t;const s=e*i;let r=xs[s];if(void 0===r&&(r=new Float32Array(s),xs[s]=r),0!==e){n.toArray(r,0);for(let n=1,s=0;n!==e;++n)s+=i,t[n].toArray(r,s)}return r}function Ss(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function Ts(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function As(t,e){let i=ys[e];void 0===i&&(i=new Int32Array(e),ys[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function Es(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function Ls(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Ss(i,e))return;t.uniform2fv(this.addr,e),Ts(i,e)}}function Cs(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(Ss(i,e))return;t.uniform3fv(this.addr,e),Ts(i,e)}}function Ps(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Ss(i,e))return;t.uniform4fv(this.addr,e),Ts(i,e)}}function Rs(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(Ss(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),Ts(i,e)}else{if(Ss(i,n))return;_s.set(n),t.uniformMatrix2fv(this.addr,!1,_s),Ts(i,n)}}function Fs(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(Ss(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),Ts(i,e)}else{if(Ss(i,n))return;ws.set(n),t.uniformMatrix3fv(this.addr,!1,ws),Ts(i,n)}}function Is(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(Ss(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),Ts(i,e)}else{if(Ss(i,n))return;bs.set(n),t.uniformMatrix4fv(this.addr,!1,bs),Ts(i,n)}}function Ds(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function Ns(t,e){const i=this.cache;Ss(i,e)||(t.uniform2iv(this.addr,e),Ts(i,e))}function ks(t,e){const i=this.cache;Ss(i,e)||(t.uniform3iv(this.addr,e),Ts(i,e))}function zs(t,e){const i=this.cache;Ss(i,e)||(t.uniform4iv(this.addr,e),Ts(i,e))}function Us(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function Os(t,e){const i=this.cache;Ss(i,e)||(t.uniform2uiv(this.addr,e),Ts(i,e))}function Bs(t,e){const i=this.cache;Ss(i,e)||(t.uniform3uiv(this.addr,e),Ts(i,e))}function Hs(t,e){const i=this.cache;Ss(i,e)||(t.uniform4uiv(this.addr,e),Ts(i,e))}function Gs(t,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(t.uniform1i(this.addr,s),n[0]=s),i.safeSetTexture2D(e||ms,s)}function Vs(t,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(t.uniform1i(this.addr,s),n[0]=s),i.setTexture3D(e||gs,s)}function Ws(t,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(t.uniform1i(this.addr,s),n[0]=s),i.safeSetTextureCube(e||vs,s)}function js(t,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(t.uniform1i(this.addr,s),n[0]=s),i.setTexture2DArray(e||fs,s)}function Xs(t,e){t.uniform1fv(this.addr,e)}function Ys(t,e){const i=Ms(e,this.size,2);t.uniform2fv(this.addr,i)}function qs(t,e){const i=Ms(e,this.size,3);t.uniform3fv(this.addr,i)}function Qs(t,e){const i=Ms(e,this.size,4);t.uniform4fv(this.addr,i)}function Zs(t,e){const i=Ms(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function Js(t,e){const i=Ms(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function Ks(t,e){const i=Ms(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function $s(t,e){t.uniform1iv(this.addr,e)}function tr(t,e){t.uniform2iv(this.addr,e)}function er(t,e){t.uniform3iv(this.addr,e)}function ir(t,e){t.uniform4iv(this.addr,e)}function nr(t,e){t.uniform1uiv(this.addr,e)}function sr(t,e){t.uniform2uiv(this.addr,e)}function rr(t,e){t.uniform3uiv(this.addr,e)}function ar(t,e){t.uniform4uiv(this.addr,e)}function or(t,e,i){const n=e.length,s=As(i,n);t.uniform1iv(this.addr,s);for(let t=0;t!==n;++t)i.safeSetTexture2D(e[t]||ms,s[t])}function lr(t,e,i){const n=e.length,s=As(i,n);t.uniform1iv(this.addr,s);for(let t=0;t!==n;++t)i.safeSetTextureCube(e[t]||vs,s[t])}function hr(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function(t){switch(t){case 5126:return Es;case 35664:return Ls;case 35665:return Cs;case 35666:return Ps;case 35674:return Rs;case 35675:return Fs;case 35676:return Is;case 5124:case 35670:return Ds;case 35667:case 35671:return Ns;case 35668:case 35672:return ks;case 35669:case 35673:return zs;case 5125:return Us;case 36294:return Os;case 36295:return Bs;case 36296:return Hs;case 35678:case 36198:case 36298:case 36306:case 35682:return Gs;case 35679:case 36299:case 36307:return Vs;case 35680:case 36300:case 36308:case 36293:return Ws;case 36289:case 36303:case 36311:case 36292:return js}}(e.type)}function cr(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Xs;case 35664:return Ys;case 35665:return qs;case 35666:return Qs;case 35674:return Zs;case 35675:return Js;case 35676:return Ks;case 5124:case 35670:return $s;case 35667:case 35671:return tr;case 35668:case 35672:return er;case 35669:case 35673:return ir;case 5125:return nr;case 36294:return sr;case 36295:return rr;case 36296:return ar;case 35678:case 36198:case 36298:case 36306:case 35682:return or;case 35680:case 36300:case 36308:case 36293:return lr}}(e.type)}function ur(t){this.id=t,this.seq=[],this.map={}}cr.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),Ts(e,t)},ur.prototype.setValue=function(t,e,i){const n=this.seq;for(let s=0,r=n.length;s!==r;++s){const r=n[s];r.setValue(t,e[r.id],i)}};const dr=/(\w+)(\])?(\[|\.)?/g;function pr(t,e){t.seq.push(e),t.map[e.id]=e}function mr(t,e,i){const n=t.name,s=n.length;for(dr.lastIndex=0;;){const r=dr.exec(n),a=dr.lastIndex;let o=r[1];const l="]"===r[2],h=r[3];if(l&&(o|=0),void 0===h||"["===h&&a+2===s){pr(i,void 0===h?new hr(o,t,e):new cr(o,t,e));break}{let t=i.map[o];void 0===t&&(t=new ur(o),pr(i,t)),i=t}}}function fr(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,35718);for(let n=0;n<i;++n){const i=t.getActiveUniform(e,n);mr(i,t.getUniformLocation(e,i.name),this)}}function gr(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}fr.prototype.setValue=function(t,e,i,n){const s=this.map[e];void 0!==s&&s.setValue(t,i,n)},fr.prototype.setOptional=function(t,e,i){const n=e[i];void 0!==n&&this.setValue(t,i,n)},fr.upload=function(t,e,i,n){for(let s=0,r=e.length;s!==r;++s){const r=e[s],a=i[r.id];!1!==a.needsUpdate&&r.setValue(t,a.value,n)}},fr.seqWithValue=function(t,e){const i=[];for(let n=0,s=t.length;n!==s;++n){const s=t[n];s.id in e&&i.push(s)}return i};let vr=0;function xr(t){switch(t){case et:return["Linear","( value )"];case it:return["sRGB","( value )"];case st:return["RGBE","( value )"];case rt:return["RGBM","( value, 7.0 )"];case at:return["RGBM","( value, 16.0 )"];case ot:return["RGBD","( value, 256.0 )"];case nt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function yr(t,e,i){const n=t.getShaderParameter(e,35713),s=t.getShaderInfoLog(e).trim();return n&&""===s?"":i.toUpperCase()+"\n\n"+s+"\n\n"+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function br(t,e){const i=xr(e);return"vec4 "+t+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function wr(t,e){const i=xr(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function _r(t,e){let i;switch(e){case 1:i="Linear";break;case 2:i="Reinhard";break;case 3:i="OptimizedCineon";break;case 4:i="ACESFilmic";break;case 5:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Mr(t){return""!==t}function Sr(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Tr(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Ar=/^[ \t]*#include +<([\w\d./]+)>/gm;function Er(t){return t.replace(Ar,Lr)}function Lr(t,e){const i=_n[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return Er(i)}const Cr=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Pr=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Rr(t){return t.replace(Pr,Ir).replace(Cr,Fr)}function Fr(t,e,i,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Ir(t,e,i,n)}function Ir(t,e,i,n){let s="";for(let t=parseInt(e);t<parseInt(i);t++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return s}function Dr(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Nr(t,e,i,n){const s=t.getContext(),r=i.defines;let a=i.vertexShader,o=i.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(i),h=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case u:case d:e="ENVMAP_TYPE_CUBE";break;case f:case g:e="ENVMAP_TYPE_CUBE_UV"}return e}(i),c=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case d:case g:e="ENVMAP_MODE_REFRACTION"}return e}(i),p=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(i),m=t.gammaFactor>0?t.gammaFactor:1,v=i.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Mr).join("\n")}(i),x=function(t){const e=[];for(const i in t){const n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(r),y=s.createProgram();let b,w,_=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(b=[x].filter(Mr).join("\n"),b.length>0&&(b+="\n"),w=[v,x].filter(Mr).join("\n"),w.length>0&&(w+="\n")):(b=[Dr(i),"#define SHADER_NAME "+i.shaderName,x,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+m,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularTintMap?"#define USE_SPECULARTINTMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphTargets&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargets&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Mr).join("\n"),w=[v,Dr(i),"#define SHADER_NAME "+i.shaderName,x,"#define GAMMA_FACTOR "+m,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.envMap?"#define "+c:"",i.envMap?"#define "+p:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularTintMap?"#define USE_SPECULARTINTMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==i.toneMapping?"#define TONE_MAPPING":"",0!==i.toneMapping?_n.tonemapping_pars_fragment:"",0!==i.toneMapping?_r("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.format===F?"#define OPAQUE":"",_n.encodings_pars_fragment,i.map?br("mapTexelToLinear",i.mapEncoding):"",i.matcap?br("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?br("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?br("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.specularTintMap?br("specularTintMapTexelToLinear",i.specularTintMapEncoding):"",i.lightMap?br("lightMapTexelToLinear",i.lightMapEncoding):"",wr("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Mr).join("\n")),a=Er(a),a=Sr(a,i),a=Tr(a,i),o=Er(o),o=Sr(o,i),o=Tr(o,i),a=Rr(a),o=Rr(o),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(_="#version 300 es\n",b=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+b,w=["#define varying in",i.glslVersion===dt?"":"out highp vec4 pc_fragColor;",i.glslVersion===dt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+w);const M=_+w+o,S=gr(s,35633,_+b+a),T=gr(s,35632,M);if(s.attachShader(y,S),s.attachShader(y,T),void 0!==i.index0AttributeName?s.bindAttribLocation(y,0,i.index0AttributeName):!0===i.morphTargets&&s.bindAttribLocation(y,0,"position"),s.linkProgram(y),t.debug.checkShaderErrors){const t=s.getProgramInfoLog(y).trim(),e=s.getShaderInfoLog(S).trim(),i=s.getShaderInfoLog(T).trim();let n=!0,r=!0;if(!1===s.getProgramParameter(y,35714)){n=!1;const e=yr(s,S,"vertex"),i=yr(s,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(y,35715)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+i)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==e&&""!==i||(r=!1);r&&(this.diagnostics={runnable:n,programLog:t,vertexShader:{log:e,prefix:b},fragmentShader:{log:i,prefix:w}})}let A,E;return s.deleteShader(S),s.deleteShader(T),this.getUniforms=function(){return void 0===A&&(A=new fr(s,y)),A},this.getAttributes=function(){return void 0===E&&(E=function(t,e){const i={},n=t.getProgramParameter(e,35721);for(let s=0;s<n;s++){const n=t.getActiveAttrib(e,s),r=n.name;let a=1;35674===n.type&&(a=2),35675===n.type&&(a=3),35676===n.type&&(a=4),i[r]={type:n.type,location:t.getAttribLocation(e,r),locationSize:a}}return i}(s,y)),E},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(y),this.program=void 0},this.name=i.shaderName,this.id=vr++,this.cacheKey=e,this.usedTimes=1,this.program=y,this.vertexShader=S,this.fragmentShader=T,this}function kr(t,e,i,n,s,r,a){const o=[],l=s.isWebGL2,h=s.logarithmicDepthBuffer,c=s.floatVertexTextures,u=s.maxVertexUniforms,d=s.vertexTextures;let p=s.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},v=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","specularIntensityMap","specularTintMap","specularTintMapEncoding","roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","sheen","transmission","transmissionMap","thicknessMap"];function x(t){let e;return t&&t.isTexture?e=t.encoding:t&&t.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=et,l&&t&&t.isTexture&&t.format===I&&t.type===A&&t.encoding===it&&(e=et),e}return{getParameters:function(r,o,v,y,b){const w=y.fog,_=r.isMeshStandardMaterial?y.environment:null,M=(r.isMeshStandardMaterial?i:e).get(r.envMap||_),S=m[r.type],T=b.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(c)return 1024;{const t=u,i=Math.floor((t-20)/4),n=Math.min(i,e.length);return n<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+n+"."),0):n}}(b):0;let A,E;if(null!==r.precision&&(p=s.getMaxPrecision(r.precision),p!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",p,"instead.")),S){const t=Sn[S];A=t.vertexShader,E=t.fragmentShader}else A=r.vertexShader,E=r.fragmentShader;const L=t.getRenderTarget(),C=r.alphaTest>0,P=r.clearcoat>0;return{isWebGL2:l,shaderID:S,shaderName:r.type,vertexShader:A,fragmentShader:E,defines:r.defines,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:p,instancing:!0===b.isInstancedMesh,instancingColor:!0===b.isInstancedMesh&&null!==b.instanceColor,supportsVertexTextures:d,outputEncoding:null!==L?x(L.texture):t.outputEncoding,map:!!r.map,mapEncoding:x(r.map),matcap:!!r.matcap,matcapEncoding:x(r.matcap),envMap:!!M,envMapMode:M&&M.mapping,envMapEncoding:x(M),envMapCubeUV:!!M&&(M.mapping===f||M.mapping===g),lightMap:!!r.lightMap,lightMapEncoding:x(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:x(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:1===r.normalMapType,tangentSpaceNormalMap:0===r.normalMapType,clearcoat:P,clearcoatMap:P&&!!r.clearcoatMap,clearcoatRoughnessMap:P&&!!r.clearcoatRoughnessMap,clearcoatNormalMap:P&&!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,specularIntensityMap:!!r.specularIntensityMap,specularTintMap:!!r.specularTintMap,specularTintMapEncoding:x(r.specularTintMap),alphaMap:!!r.alphaMap,alphaTest:C,gradientMap:!!r.gradientMap,sheen:r.sheen>0,transmission:r.transmission>0,transmissionMap:!!r.transmissionMap,thicknessMap:!!r.thicknessMap,combine:r.combine,vertexTangents:!!r.normalMap&&!!b.geometry&&!!b.geometry.attributes.tangent,vertexColors:r.vertexColors,vertexAlphas:!0===r.vertexColors&&!!b.geometry&&!!b.geometry.attributes.color&&4===b.geometry.attributes.color.itemSize,vertexUvs:!!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatMap||r.clearcoatRoughnessMap||r.clearcoatNormalMap||r.displacementMap||r.transmissionMap||r.thicknessMap||r.specularIntensityMap||r.specularTintMap),uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.transmission>0||r.transmissionMap||r.thicknessMap||r.specularIntensityMap||r.specularTintMap||!r.displacementMap),fog:!!w,useFog:r.fog,fogExp2:w&&w.isFogExp2,flatShading:!!r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===b.isSkinnedMesh&&T>0,maxBones:T,useVertexTexture:c,morphTargets:!!b.geometry&&!!b.geometry.morphAttributes.position,morphNormals:!!b.geometry&&!!b.geometry.morphAttributes.normal,morphTargetsCount:b.geometry&&b.geometry.morphAttributes.position?b.geometry.morphAttributes.position.length:0,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,format:r.format,dithering:r.dithering,shadowMapEnabled:t.shadowMap.enabled&&v.length>0,shadowMapType:t.shadowMap.type,toneMapping:r.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,doubleSided:2===r.side,flipSided:1===r.side,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||n.has("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(It(e.fragmentShader)),i.push(It(e.vertexShader))),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);if(!1===e.isRawShaderMaterial){for(let t=0;t<v.length;t++)i.push(e[v[t]]);i.push(t.outputEncoding),i.push(t.gammaFactor)}return i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){const e=m[t.type];let i;if(e){const t=Sn[e];i=sn.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function(e,i){let n;for(let t=0,e=o.length;t<e;t++){const e=o[t];if(e.cacheKey===i){n=e,++n.usedTimes;break}}return void 0===n&&(n=new Nr(t,i,e,r),o.push(n)),n},releaseProgram:function(t){if(0==--t.usedTimes){const e=o.indexOf(t);o[e]=o[o.length-1],o.pop(),t.destroy()}},programs:o}}function zr(){let t=new WeakMap;return{get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,n){t.get(e)[i]=n},dispose:function(){t=new WeakMap}}}function Ur(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Or(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Br(t){const e=[];let i=0;const n=[],s=[],r=[],a={id:-1};function o(n,s,r,o,l,h){let c=e[i];const u=t.get(r);return void 0===c?(c={id:n.id,object:n,geometry:s,material:r,program:u.program||a,groupOrder:o,renderOrder:n.renderOrder,z:l,group:h},e[i]=c):(c.id=n.id,c.object=n,c.geometry=s,c.material=r,c.program=u.program||a,c.groupOrder=o,c.renderOrder=n.renderOrder,c.z=l,c.group=h),i++,c}return{opaque:n,transmissive:s,transparent:r,init:function(){i=0,n.length=0,s.length=0,r.length=0},push:function(t,e,i,a,l,h){const c=o(t,e,i,a,l,h);i.transmission>0?s.push(c):!0===i.transparent?r.push(c):n.push(c)},unshift:function(t,e,i,a,l,h){const c=o(t,e,i,a,l,h);i.transmission>0?s.unshift(c):!0===i.transparent?r.unshift(c):n.unshift(c)},finish:function(){for(let t=i,n=e.length;t<n;t++){const i=e[t];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(t,e){n.length>1&&n.sort(t||Ur),s.length>1&&s.sort(e||Or),r.length>1&&r.sort(e||Or)}}}function Hr(t){let e=new WeakMap;return{get:function(i,n){let s;return!1===e.has(i)?(s=new Br(t),e.set(i,[s])):n>=e.get(i).length?(s=new Br(t),e.get(i).push(s)):s=e.get(i)[n],s},dispose:function(){e=new WeakMap}}}function Gr(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new Wt,color:new di};break;case"SpotLight":i={position:new Wt,direction:new Wt,color:new di,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Wt,color:new di,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Wt,skyColor:new di,groundColor:new di};break;case"RectAreaLight":i={color:new di,position:new Wt,halfWidth:new Wt,halfHeight:new Wt}}return t[e.id]=i,i}}}let Vr=0;function Wr(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function jr(t,e){const i=new Gr,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Et};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Et,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)s.probe.push(new Wt);const r=new Wt,a=new we,o=new we;return{setup:function(r,a){let o=0,l=0,h=0;for(let t=0;t<9;t++)s.probe[t].set(0,0,0);let c=0,u=0,d=0,p=0,m=0,f=0,g=0,v=0;r.sort(Wr);const x=!0!==a?Math.PI:1;for(let t=0,e=r.length;t<e;t++){const e=r[t],a=e.color,y=e.intensity,b=e.distance,w=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)o+=a.r*y*x,l+=a.g*y*x,h+=a.b*y*x;else if(e.isLightProbe)for(let t=0;t<9;t++)s.probe[t].addScaledVector(e.sh.coefficients[t],y);else if(e.isDirectionalLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*x),e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,s.directionalShadow[c]=i,s.directionalShadowMap[c]=w,s.directionalShadowMatrix[c]=e.shadow.matrix,f++}s.directional[c]=t,c++}else if(e.isSpotLight){const t=i.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(a).multiplyScalar(y*x),t.distance=b,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,s.spotShadow[d]=i,s.spotShadowMap[d]=w,s.spotShadowMatrix[d]=e.shadow.matrix,v++}s.spot[d]=t,d++}else if(e.isRectAreaLight){const t=i.get(e);t.color.copy(a).multiplyScalar(y),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),s.rectArea[p]=t,p++}else if(e.isPointLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*x),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,s.pointShadow[u]=i,s.pointShadowMap[u]=w,s.pointShadowMatrix[u]=e.shadow.matrix,g++}s.point[u]=t,u++}else if(e.isHemisphereLight){const t=i.get(e);t.skyColor.copy(e.color).multiplyScalar(y*x),t.groundColor.copy(e.groundColor).multiplyScalar(y*x),s.hemi[m]=t,m++}}p>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(s.rectAreaLTC1=Mn.LTC_FLOAT_1,s.rectAreaLTC2=Mn.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(s.rectAreaLTC1=Mn.LTC_HALF_1,s.rectAreaLTC2=Mn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=o,s.ambient[1]=l,s.ambient[2]=h;const y=s.hash;y.directionalLength===c&&y.pointLength===u&&y.spotLength===d&&y.rectAreaLength===p&&y.hemiLength===m&&y.numDirectionalShadows===f&&y.numPointShadows===g&&y.numSpotShadows===v||(s.directional.length=c,s.spot.length=d,s.rectArea.length=p,s.point.length=u,s.hemi.length=m,s.directionalShadow.length=f,s.directionalShadowMap.length=f,s.pointShadow.length=g,s.pointShadowMap.length=g,s.spotShadow.length=v,s.spotShadowMap.length=v,s.directionalShadowMatrix.length=f,s.pointShadowMatrix.length=g,s.spotShadowMatrix.length=v,y.directionalLength=c,y.pointLength=u,y.spotLength=d,y.rectAreaLength=p,y.hemiLength=m,y.numDirectionalShadows=f,y.numPointShadows=g,y.numSpotShadows=v,s.version=Vr++)},setupView:function(t,e){let i=0,n=0,l=0,h=0,c=0;const u=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=s.directional[i];t.direction.setFromMatrixPosition(d.matrixWorld),r.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(r),t.direction.transformDirection(u),i++}else if(d.isSpotLight){const t=s.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(d.matrixWorld),r.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(r),t.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const t=s.rectArea[h];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),o.identity(),a.copy(d.matrixWorld),a.premultiply(u),o.extractRotation(a),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),h++}else if(d.isPointLight){const t=s.point[n];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),n++}else if(d.isHemisphereLight){const t=s.hemi[c];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(u),t.direction.normalize(),c++}}},state:s}}function Xr(t,e){const i=new jr(t,e),n=[],s=[];return{init:function(){n.length=0,s.length=0},state:{lightsArray:n,shadowsArray:s,lights:i},setupLights:function(t){i.setup(n,t)},setupLightsView:function(t){i.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){s.push(t)}}}function Yr(t,e){let i=new WeakMap;return{get:function(n,s=0){let r;return!1===i.has(n)?(r=new Xr(t,e),i.set(n,[r])):s>=i.get(n).length?(r=new Xr(t,e),i.get(n).push(r)):r=i.get(n)[s],r},dispose:function(){i=new WeakMap}}}class qr extends ri{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}qr.prototype.isMeshDepthMaterial=!0;class Qr extends ri{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Wt,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}Qr.prototype.isMeshDistanceMaterial=!0;function Zr(t,e,i){let n=new xn;const s=new Et,r=new Et,a=new Ot,o=new qr({depthPacking:lt}),l=new Qr,h={},c=i.maxTextureSize,u={0:1,1:0,2:2},d=new rn({uniforms:{shadow_pass:{value:null},resolution:{value:new Et},radius:{value:4},samples:{value:8}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\nuniform float samples;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const m=new Di;m.setAttribute("position",new gi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const f=new Ki(m,d),g=this;function v(i,n){const s=e.update(f);d.uniforms.shadow_pass.value=i.map.texture,d.uniforms.resolution.value=i.mapSize,d.uniforms.radius.value=i.radius,d.uniforms.samples.value=i.blurSamples,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(n,null,s,d,f,null),p.uniforms.shadow_pass.value=i.mapPass.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,p.uniforms.samples.value=i.blurSamples,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(n,null,s,p,f,null)}function x(e,i,n,s,r,a,c){let d=null;const p=!0===s.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(d=void 0!==p?p:!0===s.isPointLight?l:o,t.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){const t=d.uuid,e=n.uuid;let i=h[t];void 0===i&&(i={},h[t]=i);let s=i[e];void 0===s&&(s=d.clone(),i[e]=s),d=s}return d.visible=n.visible,d.wireframe=n.wireframe,d.side=3===c?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:u[n.side],d.alphaMap=n.alphaMap,d.alphaTest=n.alphaTest,d.clipShadows=n.clipShadows,d.clippingPlanes=n.clippingPlanes,d.clipIntersection=n.clipIntersection,d.displacementMap=n.displacementMap,d.displacementScale=n.displacementScale,d.displacementBias=n.displacementBias,d.wireframeLinewidth=n.wireframeLinewidth,d.linewidth=n.linewidth,!0===s.isPointLight&&!0===d.isMeshDistanceMaterial&&(d.referencePosition.setFromMatrixPosition(s.matrixWorld),d.nearDistance=r,d.farDistance=a),d}function y(i,s,r,a,o){if(!1===i.visible)return;if(i.layers.test(s.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&3===o)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,i.matrixWorld);const n=e.update(i),s=i.material;if(Array.isArray(s)){const e=n.groups;for(let l=0,h=e.length;l<h;l++){const h=e[l],c=s[h.materialIndex];if(c&&c.visible){const e=x(i,0,c,a,r.near,r.far,o);t.renderBufferDirect(r,null,n,e,i,h)}}}else if(s.visible){const e=x(i,0,s,a,r.near,r.far,o);t.renderBufferDirect(r,null,n,e,i,null)}}const l=i.children;for(let t=0,e=l.length;t<e;t++)y(l[t],s,r,a,o)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,i,o){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),h=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,h=e.length;l<h;l++){const h=e[l],u=h.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",h,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;s.copy(u.mapSize);const p=u.getFrameExtents();if(s.multiply(p),r.copy(u.mapSize),(s.x>c||s.y>c)&&(s.x>c&&(r.x=Math.floor(c/p.x),s.x=r.x*p.x,u.mapSize.x=r.x),s.y>c&&(r.y=Math.floor(c/p.y),s.y=r.y*p.y,u.mapSize.y=r.y)),null===u.map&&!u.isPointLightShadow&&3===this.type){const t={minFilter:M,magFilter:M,format:I};u.map=new Bt(s.x,s.y,t),u.map.texture.name=h.name+".shadowMap",u.mapPass=new Bt(s.x,s.y,t),u.camera.updateProjectionMatrix()}if(null===u.map){const t={minFilter:b,magFilter:b,format:I};u.map=new Bt(s.x,s.y,t),u.map.texture.name=h.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const m=u.getViewportCount();for(let t=0;t<m;t++){const e=u.getViewport(t);a.set(r.x*e.x,r.y*e.y,r.x*e.z,r.y*e.w),d.viewport(a),u.updateMatrices(h,t),n=u.getFrustum(),y(i,o,u.camera,h,this.type)}u.isPointLightShadow||3!==this.type||v(u,o),u.needsUpdate=!1}g.needsUpdate=!1,t.setRenderTarget(l,h,u)}}function Jr(t,e,i){const n=i.isWebGL2;const s=new function(){let e=!1;const i=new Ot;let n=null;const s=new Ot(0,0,0,0);return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,r,a,o){!0===o&&(e*=a,n*=a,r*=a),i.set(e,n,r,a),!1===s.equals(i)&&(t.clearColor(e,n,r,a),s.copy(i))},reset:function(){e=!1,n=null,s.set(-1,0,0,0)}}},o=new function(){let e=!1,i=null,n=null,s=null;return{setTest:function(t){t?H(2929):G(2929)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);n=e}},setLocked:function(t){e=t},setClear:function(e){s!==e&&(t.clearDepth(e),s=e)},reset:function(){e=!1,i=null,n=null,s=null}}},c=new function(){let e=!1,i=null,n=null,s=null,r=null,a=null,o=null,l=null,h=null;return{setTest:function(t){e||(t?H(2960):G(2960))},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,a){n===e&&s===i&&r===a||(t.stencilFunc(e,i,a),n=e,s=i,r=a)},setOp:function(e,i,n){a===e&&o===i&&l===n||(t.stencilOp(e,i,n),a=e,o=i,l=n)},setLocked:function(t){e=t},setClear:function(e){h!==e&&(t.clearStencil(e),h=e)},reset:function(){e=!1,i=null,n=null,s=null,r=null,a=null,o=null,l=null,h=null}}};let u={},d=null,p={},m=null,f=!1,g=null,v=null,x=null,y=null,b=null,w=null,_=null,M=!1,S=null,T=null,A=null,E=null,L=null;const C=t.getParameter(35661);let P=!1,R=0;const F=t.getParameter(7938);-1!==F.indexOf("WebGL")?(R=parseFloat(/^WebGL (\d)/.exec(F)[1]),P=R>=1):-1!==F.indexOf("OpenGL ES")&&(R=parseFloat(/^OpenGL ES (\d)/.exec(F)[1]),P=R>=2);let I=null,D={};const N=t.getParameter(3088),k=t.getParameter(2978),z=(new Ot).fromArray(N),U=(new Ot).fromArray(k);function O(e,i,n){const s=new Uint8Array(4),r=t.createTexture();t.bindTexture(e,r),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<n;e++)t.texImage2D(i+e,0,6408,1,1,0,6408,5121,s);return r}const B={};function H(e){!0!==u[e]&&(t.enable(e),u[e]=!0)}function G(e){!1!==u[e]&&(t.disable(e),u[e]=!1)}B[3553]=O(3553,3553,1),B[34067]=O(34067,34069,6),s.setClear(0,0,0,1),o.setClear(1),c.setClear(0),H(2929),o.setFunc(3),X(!1),Y(1),H(2884),j(0);const V={[r]:32774,101:32778,102:32779};if(n)V[103]=32775,V[104]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(V[103]=t.MIN_EXT,V[104]=t.MAX_EXT)}const W={[a]:0,201:1,202:768,204:770,210:776,[h]:774,[l]:772,203:769,205:771,209:775,207:773};function j(e,i,n,s,a,o,l,h){if(0!==e){if(!1===f&&(H(3042),f=!0),5===e)a=a||i,o=o||n,l=l||s,i===v&&a===b||(t.blendEquationSeparate(V[i],V[a]),v=i,b=a),n===x&&s===y&&o===w&&l===_||(t.blendFuncSeparate(W[n],W[s],W[o],W[l]),x=n,y=s,w=o,_=l),g=e,M=null;else if(e!==g||h!==M){if(v===r&&b===r||(t.blendEquation(32774),v=r,b=r),h)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,0,769,771);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFunc(0,769);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}x=null,y=null,w=null,_=null,g=e,M=h}}else!0===f&&(G(3042),f=!1)}function X(e){S!==e&&(e?t.frontFace(2304):t.frontFace(2305),S=e)}function Y(e){0!==e?(H(2884),e!==T&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):G(2884),T=e}function q(e,i,n){e?(H(32823),E===i&&L===n||(t.polygonOffset(i,n),E=i,L=n)):G(32823)}function Q(e){void 0===e&&(e=33984+C-1),I!==e&&(t.activeTexture(e),I=e)}return{buffers:{color:s,depth:o,stencil:c},enable:H,disable:G,bindFramebuffer:function(e,i){return null===i&&null!==d&&(i=d),p[e]!==i&&(t.bindFramebuffer(e,i),p[e]=i,n&&(36009===e&&(p[36160]=i),36160===e&&(p[36009]=i)),!0)},bindXRFramebuffer:function(e){e!==d&&(t.bindFramebuffer(36160,e),d=e)},useProgram:function(e){return m!==e&&(t.useProgram(e),m=e,!0)},setBlending:j,setMaterial:function(t,e){2===t.side?G(2884):H(2884);let i=1===t.side;e&&(i=!i),X(i),1===t.blending&&!1===t.transparent?j(0):j(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),o.setFunc(t.depthFunc),o.setTest(t.depthTest),o.setMask(t.depthWrite),s.setMask(t.colorWrite);const n=t.stencilWrite;c.setTest(n),n&&(c.setMask(t.stencilWriteMask),c.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),c.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),q(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?H(32926):G(32926)},setFlipSided:X,setCullFace:Y,setLineWidth:function(e){e!==A&&(P&&t.lineWidth(e),A=e)},setPolygonOffset:q,setScissorTest:function(t){t?H(3089):G(3089)},activeTexture:Q,bindTexture:function(e,i){null===I&&Q();let n=D[I];void 0===n&&(n={type:void 0,texture:void 0},D[I]=n),n.type===e&&n.texture===i||(t.bindTexture(e,i||B[e]),n.type=e,n.texture=i)},unbindTexture:function(){const e=D[I];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===z.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),z.copy(e))},viewport:function(e){!1===U.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),U.copy(e))},reset:function(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===n&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),u={},I=null,D={},d=null,p={},m=null,f=!1,g=null,v=null,x=null,y=null,b=null,w=null,_=null,M=!1,S=null,T=null,A=null,E=null,L=null,z.set(0,0,t.canvas.width,t.canvas.height),U.set(0,0,t.canvas.width,t.canvas.height),s.reset(),o.reset(),c.reset()}}}function Kr(t,e,i,n,s,r,a){const o=s.isWebGL2,l=s.maxTextures,h=s.maxCubemapSize,c=s.maxTextureSize,u=s.maxSamples,d=new WeakMap;let p,m=!1;try{m="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function f(t,e){return m?new OffscreenCanvas(t,e):Ft("canvas")}function g(t,e,i,n){let s=1;if((t.width>n||t.height>n)&&(s=n/Math.max(t.width,t.height)),s<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const n=e?Tt:Math.floor,r=n(s*t.width),a=n(s*t.height);void 0===p&&(p=f(r,a));const o=i?f(r,a):p;o.width=r,o.height=a;return o.getContext("2d").drawImage(t,0,0,r,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+r+"x"+a+")."),o}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function A(t){return Mt(t.width)&&Mt(t.height)}function D(t,e){return t.generateMipmaps&&e&&t.minFilter!==b&&t.minFilter!==M}function z(e,i,s,r,a=1){t.generateMipmap(e);n.get(i).__maxMipLevel=Math.log2(Math.max(s,r,a))}function U(i,n,s,r){if(!1===o)return n;if(null!==i){if(void 0!==t[i])return t[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let a=n;return 6403===n&&(5126===s&&(a=33326),5131===s&&(a=33325),5121===s&&(a=33321)),6407===n&&(5126===s&&(a=34837),5131===s&&(a=34843),5121===s&&(a=32849)),6408===n&&(5126===s&&(a=34836),5131===s&&(a=34842),5121===s&&(a=r===it?35907:32856)),33325!==a&&33326!==a&&34842!==a&&34836!==a||e.get("EXT_color_buffer_float"),a}function O(t){return t===b||t===w||t===_?9728:9729}function B(e){const i=e.target;i.removeEventListener("dispose",B),function(e){const i=n.get(e);if(void 0===i.__webglInit)return;t.deleteTexture(i.__webglTexture),n.remove(e)}(i),i.isVideoTexture&&d.delete(i),a.memory.textures--}function H(e){const i=e.target;i.removeEventListener("dispose",H),function(e){const i=e.texture,s=n.get(e),r=n.get(i);if(!e)return;void 0!==r.__webglTexture&&(t.deleteTexture(r.__webglTexture),a.memory.textures--);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(s.__webglFramebuffer[e]),s.__webglDepthbuffer&&t.deleteRenderbuffer(s.__webglDepthbuffer[e]);else t.deleteFramebuffer(s.__webglFramebuffer),s.__webglDepthbuffer&&t.deleteRenderbuffer(s.__webglDepthbuffer),s.__webglMultisampledFramebuffer&&t.deleteFramebuffer(s.__webglMultisampledFramebuffer),s.__webglColorRenderbuffer&&t.deleteRenderbuffer(s.__webglColorRenderbuffer),s.__webglDepthRenderbuffer&&t.deleteRenderbuffer(s.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,s=i.length;e<s;e++){const s=n.get(i[e]);s.__webglTexture&&(t.deleteTexture(s.__webglTexture),a.memory.textures--),n.remove(i[e])}n.remove(i),n.remove(e)}(i)}let G=0;function V(t,e){const s=n.get(t);if(t.isVideoTexture&&function(t){const e=a.render.frame;d.get(t)!==e&&(d.set(t,e),t.update())}(t),t.version>0&&s.__version!==t.version){const i=t.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void Q(s,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+e),i.bindTexture(3553,s.__webglTexture)}function W(e,s){const a=n.get(e);e.version>0&&a.__version!==e.version?function(e,n,s){if(6!==n.image.length)return;q(e,n),i.activeTexture(33984+s),i.bindTexture(34067,e.__webglTexture),t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment),t.pixelStorei(37443,0);const a=n&&(n.isCompressedTexture||n.image[0].isCompressedTexture),l=n.image[0]&&n.image[0].isDataTexture,c=[];for(let t=0;t<6;t++)c[t]=a||l?l?n.image[t].image:n.image[t]:g(n.image[t],!1,!0,h);const u=c[0],d=A(u)||o,p=r.convert(n.format),m=r.convert(n.type),f=U(n.internalFormat,p,m,n.encoding);let v;if(Y(34067,n,d),a){for(let t=0;t<6;t++){v=c[t].mipmaps;for(let e=0;e<v.length;e++){const s=v[e];n.format!==I&&n.format!==F?null!==p?i.compressedTexImage2D(34069+t,e,f,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+t,e,f,s.width,s.height,0,p,m,s.data)}}e.__maxMipLevel=v.length-1}else{v=n.mipmaps;for(let t=0;t<6;t++)if(l){i.texImage2D(34069+t,0,f,c[t].width,c[t].height,0,p,m,c[t].data);for(let e=0;e<v.length;e++){const n=v[e].image[t].image;i.texImage2D(34069+t,e+1,f,n.width,n.height,0,p,m,n.data)}}else{i.texImage2D(34069+t,0,f,p,m,c[t]);for(let e=0;e<v.length;e++){const n=v[e];i.texImage2D(34069+t,e+1,f,p,m,n.image[t])}}e.__maxMipLevel=v.length}D(n,d)&&z(34067,n,u.width,u.height);e.__version=n.version,n.onUpdate&&n.onUpdate(n)}(a,e,s):(i.activeTexture(33984+s),i.bindTexture(34067,a.__webglTexture))}const j={[v]:10497,[x]:33071,[y]:33648},X={[b]:9728,[w]:9984,[_]:9986,[M]:9729,[S]:9985,[T]:9987};function Y(i,r,a){if(a?(t.texParameteri(i,10242,j[r.wrapS]),t.texParameteri(i,10243,j[r.wrapT]),32879!==i&&35866!==i||t.texParameteri(i,32882,j[r.wrapR]),t.texParameteri(i,10240,X[r.magFilter]),t.texParameteri(i,10241,X[r.minFilter])):(t.texParameteri(i,10242,33071),t.texParameteri(i,10243,33071),32879!==i&&35866!==i||t.texParameteri(i,32882,33071),r.wrapS===x&&r.wrapT===x||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(i,10240,O(r.magFilter)),t.texParameteri(i,10241,O(r.minFilter)),r.minFilter!==b&&r.minFilter!==M&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const a=e.get("EXT_texture_filter_anisotropic");if(r.type===C&&!1===e.has("OES_texture_float_linear"))return;if(!1===o&&r.type===P&&!1===e.has("OES_texture_half_float_linear"))return;(r.anisotropy>1||n.get(r).__currentAnisotropy)&&(t.texParameterf(i,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r.anisotropy,s.getMaxAnisotropy())),n.get(r).__currentAnisotropy=r.anisotropy)}}function q(e,i){void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",B),e.__webglTexture=t.createTexture(),a.memory.textures++)}function Q(e,n,s){let a=3553;n.isDataTexture2DArray&&(a=35866),n.isDataTexture3D&&(a=32879),q(e,n),i.activeTexture(33984+s),i.bindTexture(a,e.__webglTexture),t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment),t.pixelStorei(37443,0);const l=function(t){return!o&&(t.wrapS!==x||t.wrapT!==x||t.minFilter!==b&&t.minFilter!==M)}(n)&&!1===A(n.image),h=g(n.image,l,!1,c),u=A(h)||o,d=r.convert(n.format);let p,m=r.convert(n.type),f=U(n.internalFormat,d,m,n.encoding);Y(a,n,u);const v=n.mipmaps;if(n.isDepthTexture)f=6402,o?f=n.type===C?36012:n.type===L?33190:n.type===R?35056:33189:n.type===C&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===N&&6402===f&&n.type!==E&&n.type!==L&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=E,m=r.convert(n.type)),n.format===k&&6402===f&&(f=34041,n.type!==R&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=R,m=r.convert(n.type))),i.texImage2D(3553,0,f,h.width,h.height,0,d,m,null);else if(n.isDataTexture)if(v.length>0&&u){for(let t=0,e=v.length;t<e;t++)p=v[t],i.texImage2D(3553,t,f,p.width,p.height,0,d,m,p.data);n.generateMipmaps=!1,e.__maxMipLevel=v.length-1}else i.texImage2D(3553,0,f,h.width,h.height,0,d,m,h.data),e.__maxMipLevel=0;else if(n.isCompressedTexture){for(let t=0,e=v.length;t<e;t++)p=v[t],n.format!==I&&n.format!==F?null!==d?i.compressedTexImage2D(3553,t,f,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,t,f,p.width,p.height,0,d,m,p.data);e.__maxMipLevel=v.length-1}else if(n.isDataTexture2DArray)i.texImage3D(35866,0,f,h.width,h.height,h.depth,0,d,m,h.data),e.__maxMipLevel=0;else if(n.isDataTexture3D)i.texImage3D(32879,0,f,h.width,h.height,h.depth,0,d,m,h.data),e.__maxMipLevel=0;else if(v.length>0&&u){for(let t=0,e=v.length;t<e;t++)p=v[t],i.texImage2D(3553,t,f,d,m,p);n.generateMipmaps=!1,e.__maxMipLevel=v.length-1}else i.texImage2D(3553,0,f,d,m,h),e.__maxMipLevel=0;D(n,u)&&z(a,n,h.width,h.height),e.__version=n.version,n.onUpdate&&n.onUpdate(n)}function Z(e,s,a,o,l){const h=r.convert(a.format),c=r.convert(a.type),u=U(a.internalFormat,h,c,a.encoding);32879===l||35866===l?i.texImage3D(l,0,u,s.width,s.height,s.depth,0,h,c,null):i.texImage2D(l,0,u,s.width,s.height,0,h,c,null),i.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,o,l,n.get(a).__webglTexture,0),i.bindFramebuffer(36160,null)}function J(e,i,n){if(t.bindRenderbuffer(36161,e),i.depthBuffer&&!i.stencilBuffer){let s=33189;if(n){const e=i.depthTexture;e&&e.isDepthTexture&&(e.type===C?s=36012:e.type===L&&(s=33190));const n=$(i);t.renderbufferStorageMultisample(36161,n,s,i.width,i.height)}else t.renderbufferStorage(36161,s,i.width,i.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(i.depthBuffer&&i.stencilBuffer){if(n){const e=$(i);t.renderbufferStorageMultisample(36161,e,35056,i.width,i.height)}else t.renderbufferStorage(36161,34041,i.width,i.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=!0===i.isWebGLMultipleRenderTargets?i.texture[0]:i.texture,s=r.convert(e.format),a=r.convert(e.type),o=U(e.internalFormat,s,a,e.encoding);if(n){const e=$(i);t.renderbufferStorageMultisample(36161,e,o,i.width,i.height)}else t.renderbufferStorage(36161,o,i.width,i.height)}t.bindRenderbuffer(36161,null)}function K(e){const s=n.get(e),r=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,s){if(s&&s.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,e),!s.depthTexture||!s.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(s.depthTexture).__webglTexture&&s.depthTexture.image.width===s.width&&s.depthTexture.image.height===s.height||(s.depthTexture.image.width=s.width,s.depthTexture.image.height=s.height,s.depthTexture.needsUpdate=!0),V(s.depthTexture,0);const r=n.get(s.depthTexture).__webglTexture;if(s.depthTexture.format===N)t.framebufferTexture2D(36160,36096,3553,r,0);else{if(s.depthTexture.format!==k)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,r,0)}}(s.__webglFramebuffer,e)}else if(r){s.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(36160,s.__webglFramebuffer[n]),s.__webglDepthbuffer[n]=t.createRenderbuffer(),J(s.__webglDepthbuffer[n],e,!1)}else i.bindFramebuffer(36160,s.__webglFramebuffer),s.__webglDepthbuffer=t.createRenderbuffer(),J(s.__webglDepthbuffer,e,!1);i.bindFramebuffer(36160,null)}function $(t){return o&&t.isWebGLMultisampleRenderTarget?Math.min(u,t.samples):0}let tt=!1,et=!1;this.allocateTextureUnit=function(){const t=G;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),G+=1,t},this.resetTextureUnits=function(){G=0},this.setTexture2D=V,this.setTexture2DArray=function(t,e){const s=n.get(t);t.version>0&&s.__version!==t.version?Q(s,t,e):(i.activeTexture(33984+e),i.bindTexture(35866,s.__webglTexture))},this.setTexture3D=function(t,e){const s=n.get(t);t.version>0&&s.__version!==t.version?Q(s,t,e):(i.activeTexture(33984+e),i.bindTexture(32879,s.__webglTexture))},this.setTextureCube=W,this.setupRenderTarget=function(e){const l=e.texture,h=n.get(e),c=n.get(l);e.addEventListener("dispose",H),!0!==e.isWebGLMultipleRenderTargets&&(c.__webglTexture=t.createTexture(),c.__version=l.version,a.memory.textures++);const u=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=!0===e.isWebGLMultisampleRenderTarget,m=l.isDataTexture3D||l.isDataTexture2DArray,f=A(e)||o;if(!o||l.format!==F||l.type!==C&&l.type!==P||(l.format=I,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),u){h.__webglFramebuffer=[];for(let e=0;e<6;e++)h.__webglFramebuffer[e]=t.createFramebuffer()}else if(h.__webglFramebuffer=t.createFramebuffer(),d)if(s.drawBuffers){const i=e.texture;for(let e=0,s=i.length;e<s;e++){const s=n.get(i[e]);void 0===s.__webglTexture&&(s.__webglTexture=t.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(p)if(o){h.__webglMultisampledFramebuffer=t.createFramebuffer(),h.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,h.__webglColorRenderbuffer);const n=r.convert(l.format),s=r.convert(l.type),a=U(l.internalFormat,n,s,l.encoding),o=$(e);t.renderbufferStorageMultisample(36161,o,a,e.width,e.height),i.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,h.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(h.__webglDepthRenderbuffer=t.createRenderbuffer(),J(h.__webglDepthRenderbuffer,e,!0)),i.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(u){i.bindTexture(34067,c.__webglTexture),Y(34067,l,f);for(let t=0;t<6;t++)Z(h.__webglFramebuffer[t],e,l,36064,34069+t);D(l,f)&&z(34067,l,e.width,e.height),i.unbindTexture()}else if(d){const t=e.texture;for(let s=0,r=t.length;s<r;s++){const r=t[s],a=n.get(r);i.bindTexture(3553,a.__webglTexture),Y(3553,r,f),Z(h.__webglFramebuffer,e,r,36064+s,3553),D(r,f)&&z(3553,r,e.width,e.height)}i.unbindTexture()}else{let t=3553;if(m)if(o){t=l.isDataTexture3D?32879:35866}else console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.");i.bindTexture(t,c.__webglTexture),Y(t,l,f),Z(h.__webglFramebuffer,e,l,36064,t),D(l,f)&&z(t,l,e.width,e.height,e.depth),i.unbindTexture()}e.depthBuffer&&K(e)},this.updateRenderTargetMipmap=function(t){const e=A(t)||o,s=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let r=0,a=s.length;r<a;r++){const a=s[r];if(D(a,e)){const e=t.isWebGLCubeRenderTarget?34067:3553,s=n.get(a).__webglTexture;i.bindTexture(e,s),z(e,a,t.width,t.height),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(o){const s=e.width,r=e.height;let a=16384;e.depthBuffer&&(a|=256),e.stencilBuffer&&(a|=1024);const o=n.get(e);i.bindFramebuffer(36008,o.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,o.__webglFramebuffer),t.blitFramebuffer(0,0,s,r,0,0,s,r,a,9728),i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,o.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===tt&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),tt=!0),t=t.texture),V(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===et&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),et=!0),t=t.texture),W(t,e)}}function $r(t,e,i){const n=i.isWebGL2;return{convert:function(t){let i;if(t===A)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1019===t)return 33635;if(1010===t)return 5120;if(1011===t)return 5122;if(t===E)return 5123;if(1013===t)return 5124;if(t===L)return 5125;if(t===C)return 5126;if(t===P)return n?5131:(i=e.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(1021===t)return 6406;if(t===F)return 6407;if(t===I)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(t===N)return 6402;if(t===k)return 34041;if(1028===t)return 6403;if(1029===t)return 36244;if(1030===t)return 33319;if(1031===t)return 33320;if(1032===t)return 36248;if(1033===t)return 36249;if(t===z||t===U||t===O||t===B){if(i=e.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(t===z)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===U)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===O)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===B)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===H||t===G||t===V||t===W){if(i=e.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(t===H)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===G)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===V)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===W)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===t)return i=e.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===j||t===X)&&(i=e.get("WEBGL_compressed_texture_etc"),null!==i)){if(t===j)return i.COMPRESSED_RGB8_ETC2;if(t===X)return i.COMPRESSED_RGBA8_ETC2_EAC}return 37808===t||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t||37840===t||37841===t||37842===t||37843===t||37844===t||37845===t||37846===t||37847===t||37848===t||37849===t||37850===t||37851===t||37852===t||37853===t?(i=e.get("WEBGL_compressed_texture_astc"),null!==i?t:null):36492===t?(i=e.get("EXT_texture_compression_bptc"),null!==i?t:null):t===R?n?34042:(i=e.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class ta extends on{constructor(t=[]){super(),this.cameras=t}}ta.prototype.isArrayCamera=!0;class ea extends Xe{constructor(){super(),this.type="Group"}}ea.prototype.isGroup=!0;const ia={type:"move"};class na{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new ea,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new ea,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Wt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Wt),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new ea,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Wt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Wt),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let n=null,s=null,r=null;const a=this._targetRay,o=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==a&&(n=e.getPose(t.targetRaySpace,i),null!==n&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(ia))),l&&t.hand){r=!0;for(const n of t.hand.values()){const t=e.getJointPose(n,i);if(void 0===l.joints[n.jointName]){const t=new ea;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[n.jointName]=t,l.add(t)}const s=l.joints[n.jointName];null!==t&&(s.matrix.fromArray(t.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.jointRadius=t.radius),s.visible=null!==t}const n=l.joints["index-finger-tip"],s=l.joints["thumb-tip"],a=n.position.distanceTo(s.position),o=.02,h=.005;l.inputState.pinching&&a>o+h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&a<=o-h&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==o&&t.gripSpace&&(s=e.getPose(t.gripSpace,i),null!==s&&(o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),s.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(s.linearVelocity)):o.hasLinearVelocity=!1,s.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(s.angularVelocity)):o.hasAngularVelocity=!1));return null!==a&&(a.visible=null!==n),null!==o&&(o.visible=null!==s),null!==l&&(l.visible=null!==r),this}}class sa extends pt{constructor(t,e){super();const i=this,n=t.state;let s=null,r=1,a=null,o="local-floor",l=null,h=null,c=null,u=null,d=null,p=!1,m=null,f=null,g=null,v=null,x=null,y=null;const b=[],w=new Map,_=new on;_.layers.enable(1),_.viewport=new Ot;const M=new on;M.layers.enable(2),M.viewport=new Ot;const S=[_,M],T=new ta;T.layers.enable(1),T.layers.enable(2);let A=null,E=null;function L(t){const e=w.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function C(){w.forEach((function(t,e){t.disconnect(e)})),w.clear(),A=null,E=null,n.bindXRFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),c&&e.deleteFramebuffer(c),m&&e.deleteFramebuffer(m),f&&e.deleteRenderbuffer(f),g&&e.deleteRenderbuffer(g),c=null,m=null,f=null,g=null,d=null,u=null,h=null,s=null,N.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function P(t){const e=s.inputSources;for(let t=0;t<b.length;t++)w.set(e[t],b[t]);for(let e=0;e<t.removed.length;e++){const i=t.removed[e],n=w.get(i);n&&(n.dispatchEvent({type:"disconnected",data:i}),w.delete(i))}for(let e=0;e<t.added.length;e++){const i=t.added[e],n=w.get(i);n&&n.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=b[t];return void 0===e&&(e=new na,b[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=b[t];return void 0===e&&(e=new na,b[t]=e),e.getGripSpace()},this.getHand=function(t){let e=b[t];return void 0===e&&(e=new na,b[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return h},this.getFrame=function(){return v},this.getSession=function(){return s},this.setSession=async function(t){if(s=t,null!==s){s.addEventListener("select",L),s.addEventListener("selectstart",L),s.addEventListener("selectend",L),s.addEventListener("squeeze",L),s.addEventListener("squeezestart",L),s.addEventListener("squeezeend",L),s.addEventListener("end",C),s.addEventListener("inputsourceschange",P);const t=e.getContextAttributes();if(!0!==t.xrCompatible&&await e.makeXRCompatible(),void 0===s.renderState.layers){const i={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(s,e,i),s.updateRenderState({baseLayer:d})}else if(e instanceof WebGLRenderingContext){const i={antialias:!0,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(s,e,i),s.updateRenderState({layers:[d]})}else{p=t.antialias;let i=null;t.depth&&(y=256,t.stencil&&(y|=1024),x=t.stencil?33306:36096,i=t.stencil?35056:33190);const a={colorFormat:t.alpha?32856:32849,depthFormat:i,scaleFactor:r};h=new XRWebGLBinding(s,e),u=h.createProjectionLayer(a),c=e.createFramebuffer(),s.updateRenderState({layers:[u]}),p&&(m=e.createFramebuffer(),f=e.createRenderbuffer(),e.bindRenderbuffer(36161,f),e.renderbufferStorageMultisample(36161,4,32856,u.textureWidth,u.textureHeight),n.bindFramebuffer(36160,m),e.framebufferRenderbuffer(36160,36064,36161,f),e.bindRenderbuffer(36161,null),null!==i&&(g=e.createRenderbuffer(),e.bindRenderbuffer(36161,g),e.renderbufferStorageMultisample(36161,4,i,u.textureWidth,u.textureHeight),e.framebufferRenderbuffer(36160,x,36161,g),e.bindRenderbuffer(36161,null)),n.bindFramebuffer(36160,null))}a=await s.requestReferenceSpace(o),N.setContext(s),N.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const R=new Wt,F=new Wt;function I(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===s)return;T.near=M.near=_.near=t.near,T.far=M.far=_.far=t.far,A===T.near&&E===T.far||(s.updateRenderState({depthNear:T.near,depthFar:T.far}),A=T.near,E=T.far);const e=t.parent,i=T.cameras;I(T,e);for(let t=0;t<i.length;t++)I(i[t],e);T.matrixWorld.decompose(T.position,T.quaternion,T.scale),t.position.copy(T.position),t.quaternion.copy(T.quaternion),t.scale.copy(T.scale),t.matrix.copy(T.matrix),t.matrixWorld.copy(T.matrixWorld);const n=t.children;for(let t=0,e=n.length;t<e;t++)n[t].updateMatrixWorld(!0);2===i.length?function(t,e,i){R.setFromMatrixPosition(e.matrixWorld),F.setFromMatrixPosition(i.matrixWorld);const n=R.distanceTo(F),s=e.projectionMatrix.elements,r=i.projectionMatrix.elements,a=s[14]/(s[10]-1),o=s[14]/(s[10]+1),l=(s[9]+1)/s[5],h=(s[9]-1)/s[5],c=(s[8]-1)/s[0],u=(r[8]+1)/r[0],d=a*c,p=a*u,m=n/(-c+u),f=m*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(f),t.translateZ(m),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=a+m,v=o+m,x=d-f,y=p+(n-f),b=l*o/v*g,w=h*o/v*g;t.projectionMatrix.makePerspective(x,y,b,w,g,v)}(T,_,M):T.projectionMatrix.copy(_.projectionMatrix)},this.getCamera=function(){return T},this.getFoveation=function(){return null!==u?u.fixedFoveation:null!==d?d.fixedFoveation:void 0},this.setFoveation=function(t){null!==u&&(u.fixedFoveation=t),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=t)};let D=null;const N=new yn;N.setAnimationLoop((function(t,i){if(l=i.getViewerPose(a),v=i,null!==l){const t=l.views;null!==d&&n.bindXRFramebuffer(d.framebuffer);let i=!1;t.length!==T.cameras.length&&(T.cameras.length=0,i=!0);for(let s=0;s<t.length;s++){const r=t[s];let a=null;if(null!==d)a=d.getViewport(r);else{const t=h.getViewSubImage(u,r);n.bindXRFramebuffer(c),void 0!==t.depthStencilTexture&&e.framebufferTexture2D(36160,x,3553,t.depthStencilTexture,0),e.framebufferTexture2D(36160,36064,3553,t.colorTexture,0),a=t.viewport}const o=S[s];o.matrix.fromArray(r.transform.matrix),o.projectionMatrix.fromArray(r.projectionMatrix),o.viewport.set(a.x,a.y,a.width,a.height),0===s&&T.matrix.copy(o.matrix),!0===i&&T.cameras.push(o)}p&&(n.bindXRFramebuffer(m),null!==y&&e.clear(y))}const r=s.inputSources;for(let t=0;t<b.length;t++){const e=b[t],n=r[t];e.update(n,i,a)}if(D&&D(t,i),p){const t=u.textureWidth,i=u.textureHeight;n.bindFramebuffer(36008,m),n.bindFramebuffer(36009,c),e.invalidateFramebuffer(36008,[x]),e.invalidateFramebuffer(36009,[x]),e.blitFramebuffer(0,0,t,i,0,0,t,i,16384,9728),e.invalidateFramebuffer(36008,[36064]),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),n.bindFramebuffer(36160,m)}v=null})),this.setAnimationLoop=function(t){D=t},this.dispose=function(){}}}function ra(t){function e(e,i){e.opacity.value=i.opacity,i.color&&e.diffuse.value.copy(i.color),i.emissive&&e.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(e.map.value=i.map),i.alphaMap&&(e.alphaMap.value=i.alphaMap),i.specularMap&&(e.specularMap.value=i.specularMap),i.alphaTest>0&&(e.alphaTest.value=i.alphaTest);const n=t.get(i).envMap;if(n){e.envMap.value=n,e.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,e.reflectivity.value=i.reflectivity,e.ior.value=i.ior,e.refractionRatio.value=i.refractionRatio;const s=t.get(n).__maxMipLevel;void 0!==s&&(e.maxMipLevel.value=s)}let s,r;i.lightMap&&(e.lightMap.value=i.lightMap,e.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(e.aoMap.value=i.aoMap,e.aoMapIntensity.value=i.aoMapIntensity),i.map?s=i.map:i.specularMap?s=i.specularMap:i.displacementMap?s=i.displacementMap:i.normalMap?s=i.normalMap:i.bumpMap?s=i.bumpMap:i.roughnessMap?s=i.roughnessMap:i.metalnessMap?s=i.metalnessMap:i.alphaMap?s=i.alphaMap:i.emissiveMap?s=i.emissiveMap:i.clearcoatMap?s=i.clearcoatMap:i.clearcoatNormalMap?s=i.clearcoatNormalMap:i.clearcoatRoughnessMap?s=i.clearcoatRoughnessMap:i.specularIntensityMap?s=i.specularIntensityMap:i.specularTintMap?s=i.specularTintMap:i.transmissionMap?s=i.transmissionMap:i.thicknessMap&&(s=i.thicknessMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uvTransform.value.copy(s.matrix)),i.aoMap?r=i.aoMap:i.lightMap&&(r=i.lightMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uv2Transform.value.copy(r.matrix))}function i(e,i){e.roughness.value=i.roughness,e.metalness.value=i.metalness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(e.emissiveMap.value=i.emissiveMap),i.bumpMap&&(e.bumpMap.value=i.bumpMap,e.bumpScale.value=i.bumpScale,1===i.side&&(e.bumpScale.value*=-1)),i.normalMap&&(e.normalMap.value=i.normalMap,e.normalScale.value.copy(i.normalScale),1===i.side&&e.normalScale.value.negate()),i.displacementMap&&(e.displacementMap.value=i.displacementMap,e.displacementScale.value=i.displacementScale,e.displacementBias.value=i.displacementBias);t.get(i).envMap&&(e.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,n,s,r,a){n.isMeshBasicMaterial?e(t,n):n.isMeshLambertMaterial?(e(t,n),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,n)):n.isMeshToonMaterial?(e(t,n),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshPhongMaterial?(e(t,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshStandardMaterial?(e(t,n),n.isMeshPhysicalMaterial?function(t,e,n){i(t,e),t.ior.value=e.ior,e.sheen>0&&(t.sheenTint.value.copy(e.sheenTint).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness);e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate()));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=n.texture,t.transmissionSamplerSize.value.set(n.width,n.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationTint.value.copy(e.attenuationTint));t.specularIntensity.value=e.specularIntensity,t.specularTint.value.copy(e.specularTint),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap);e.specularTintMap&&(t.specularTintMap.value=e.specularTintMap)}(t,n,a):i(t,n)):n.isMeshMatcapMaterial?(e(t,n),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDepthMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDistanceMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,n)):n.isMeshNormalMaterial?(e(t,n),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,n),n.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,n)):n.isPointsMaterial?function(t,e,i,n){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*n,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let s;e.map?s=e.map:e.alphaMap&&(s=e.alphaMap);void 0!==s&&(!0===s.matrixAutoUpdate&&s.updateMatrix(),t.uvTransform.value.copy(s.matrix))}(t,n,s,r):n.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let i;e.map?i=e.map:e.alphaMap&&(i=e.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,n):n.isShadowMaterial?(t.color.value.copy(n.color),t.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function aa(t={}){const e=void 0!==t.canvas?t.canvas:function(){const t=Ft("canvas");return t.style.display="block",t}(),i=void 0!==t.context?t.context:null,n=void 0!==t.alpha&&t.alpha,s=void 0===t.depth||t.depth,r=void 0===t.stencil||t.stencil,a=void 0!==t.antialias&&t.antialias,o=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,h=void 0!==t.powerPreference?t.powerPreference:"default",c=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let u=null,d=null;const p=[],m=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=et,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const f=this;let g=!1,v=0,y=0,w=null,_=-1,M=null;const S=new Ot,E=new Ot;let L=null,R=e.width,F=e.height,D=1,N=null,k=null;const z=new Ot(0,0,R,F),U=new Ot(0,0,R,F);let O=!1;const B=[],H=new xn;let G=!1,V=!1,W=null;const j=new we,X=new Wt,Y={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function q(){return null===w?D:1}let Q,Z,J,K,$,tt,it,nt,st,rt,at,ot,lt,ht,ct,ut,dt,pt,mt,ft,gt,vt,xt,yt=i;function bt(t,i){for(let n=0;n<t.length;n++){const s=t[n],r=e.getContext(s,i);if(null!==r)return r}return null}try{const t={alpha:n,depth:s,stencil:r,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:c};if(e.addEventListener("webglcontextlost",Mt,!1),e.addEventListener("webglcontextrestored",St,!1),null===yt){const e=["webgl2","webgl","experimental-webgl"];if(!0===f.isWebGL1Renderer&&e.shift(),yt=bt(e,t),null===yt)throw bt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===yt.getShaderPrecisionFormat&&(yt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function wt(){Q=new ns(yt),Z=new Ln(yt,Q,t),Q.init(Z),vt=new $r(yt,Q,Z),J=new Jr(yt,Q,Z),B[0]=1029,K=new as(yt),$=new zr,tt=new Kr(yt,Q,J,$,Z,vt,K),it=new Pn(f),nt=new is(f),st=new bn(yt,Z),xt=new An(yt,Q,st,Z),rt=new ss(yt,st,K,xt),at=new ds(yt,rt,st,K),mt=new us(yt,Z,tt),ut=new Cn($),ot=new kr(f,it,nt,Q,Z,xt,ut),lt=new ra($),ht=new Hr($),ct=new Yr(Q,Z),pt=new Tn(f,it,J,at,o),dt=new Zr(f,at,Z),ft=new En(yt,Q,K,Z),gt=new rs(yt,Q,K,Z),K.programs=ot.programs,f.capabilities=Z,f.extensions=Q,f.properties=$,f.renderLists=ht,f.shadowMap=dt,f.state=J,f.info=K}wt();const _t=new sa(f,yt);function Mt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function St(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const t=K.autoReset,e=dt.enabled,i=dt.autoUpdate,n=dt.needsUpdate,s=dt.type;wt(),K.autoReset=t,dt.enabled=e,dt.autoUpdate=i,dt.needsUpdate=n,dt.type=s}function Tt(t){const e=t.target;e.removeEventListener("dispose",Tt),function(t){(function(t){const e=$.get(t).programs;void 0!==e&&e.forEach((function(t){ot.releaseProgram(t)}))})(t),$.remove(t)}(e)}this.xr=_t,this.getContext=function(){return yt},this.getContextAttributes=function(){return yt.getContextAttributes()},this.forceContextLoss=function(){const t=Q.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=Q.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return D},this.setPixelRatio=function(t){void 0!==t&&(D=t,this.setSize(R,F,!1))},this.getSize=function(t){return t.set(R,F)},this.setSize=function(t,i,n){_t.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(R=t,F=i,e.width=Math.floor(t*D),e.height=Math.floor(i*D),!1!==n&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return t.set(R*D,F*D).floor()},this.setDrawingBufferSize=function(t,i,n){R=t,F=i,D=n,e.width=Math.floor(t*n),e.height=Math.floor(i*n),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return t.copy(S)},this.getViewport=function(t){return t.copy(z)},this.setViewport=function(t,e,i,n){t.isVector4?z.set(t.x,t.y,t.z,t.w):z.set(t,e,i,n),J.viewport(S.copy(z).multiplyScalar(D).floor())},this.getScissor=function(t){return t.copy(U)},this.setScissor=function(t,e,i,n){t.isVector4?U.set(t.x,t.y,t.z,t.w):U.set(t,e,i,n),J.scissor(E.copy(U).multiplyScalar(D).floor())},this.getScissorTest=function(){return O},this.setScissorTest=function(t){J.setScissorTest(O=t)},this.setOpaqueSort=function(t){N=t},this.setTransparentSort=function(t){k=t},this.getClearColor=function(t){return t.copy(pt.getClearColor())},this.setClearColor=function(){pt.setClearColor.apply(pt,arguments)},this.getClearAlpha=function(){return pt.getClearAlpha()},this.setClearAlpha=function(){pt.setClearAlpha.apply(pt,arguments)},this.clear=function(t,e,i){let n=0;(void 0===t||t)&&(n|=16384),(void 0===e||e)&&(n|=256),(void 0===i||i)&&(n|=1024),yt.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Mt,!1),e.removeEventListener("webglcontextrestored",St,!1),ht.dispose(),ct.dispose(),$.dispose(),it.dispose(),nt.dispose(),at.dispose(),xt.dispose(),_t.dispose(),_t.removeEventListener("sessionstart",Et),_t.removeEventListener("sessionend",Lt),W&&(W.dispose(),W=null),Ct.stop()},this.renderBufferDirect=function(t,e,i,n,s,r){null===e&&(e=Y);const a=s.isMesh&&s.matrixWorld.determinant()<0,o=function(t,e,i,n,s){!0!==e.isScene&&(e=Y);tt.resetTextureUnits();const r=e.fog,a=n.isMeshStandardMaterial?e.environment:null,o=null===w?f.outputEncoding:w.texture.encoding,l=(n.isMeshStandardMaterial?nt:it).get(n.envMap||a),h=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,c=!!n.normalMap&&!!i.attributes.tangent,u=!!i.morphAttributes.position,p=!!i.morphAttributes.normal,m=i.morphAttributes.position?i.morphAttributes.position.length:0,g=$.get(n),v=d.state.lights;if(!0===G&&(!0===V||t!==M)){const e=t===M&&n.id===_;ut.setState(n,t,e)}let x=!1;n.version===g.__version?g.needsLights&&g.lightsStateVersion!==v.state.version||g.outputEncoding!==o||s.isInstancedMesh&&!1===g.instancing?x=!0:s.isInstancedMesh||!0!==g.instancing?s.isSkinnedMesh&&!1===g.skinning?x=!0:s.isSkinnedMesh||!0!==g.skinning?g.envMap!==l||n.fog&&g.fog!==r?x=!0:void 0===g.numClippingPlanes||g.numClippingPlanes===ut.numPlanes&&g.numIntersection===ut.numIntersection?(g.vertexAlphas!==h||g.vertexTangents!==c||g.morphTargets!==u||g.morphNormals!==p||!0===Z.isWebGL2&&g.morphTargetsCount!==m)&&(x=!0):x=!0:x=!0:x=!0:(x=!0,g.__version=n.version);let y=g.currentProgram;!0===x&&(y=Nt(n,e,s));let b=!1,S=!1,T=!1;const A=y.getUniforms(),E=g.uniforms;J.useProgram(y.program)&&(b=!0,S=!0,T=!0);n.id!==_&&(_=n.id,S=!0);if(b||M!==t){if(A.setValue(yt,"projectionMatrix",t.projectionMatrix),Z.logarithmicDepthBuffer&&A.setValue(yt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),M!==t&&(M=t,S=!0,T=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=A.map.cameraPosition;void 0!==e&&e.setValue(yt,X.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&A.setValue(yt,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||s.isSkinnedMesh)&&A.setValue(yt,"viewMatrix",t.matrixWorldInverse)}if(s.isSkinnedMesh){A.setOptional(yt,s,"bindMatrix"),A.setOptional(yt,s,"bindMatrixInverse");const t=s.skeleton;t&&(Z.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),A.setValue(yt,"boneTexture",t.boneTexture,tt),A.setValue(yt,"boneTextureSize",t.boneTextureSize)):A.setOptional(yt,t,"boneMatrices"))}!i||void 0===i.morphAttributes.position&&void 0===i.morphAttributes.normal||mt.update(s,i,n,y);(S||g.receiveShadow!==s.receiveShadow)&&(g.receiveShadow=s.receiveShadow,A.setValue(yt,"receiveShadow",s.receiveShadow));S&&(A.setValue(yt,"toneMappingExposure",f.toneMappingExposure),g.needsLights&&function(t,e){t.ambientLightColor.needsUpdate=e,t.lightProbe.needsUpdate=e,t.directionalLights.needsUpdate=e,t.directionalLightShadows.needsUpdate=e,t.pointLights.needsUpdate=e,t.pointLightShadows.needsUpdate=e,t.spotLights.needsUpdate=e,t.spotLightShadows.needsUpdate=e,t.rectAreaLights.needsUpdate=e,t.hemisphereLights.needsUpdate=e}(E,T),r&&n.fog&&lt.refreshFogUniforms(E,r),lt.refreshMaterialUniforms(E,n,D,F,W),fr.upload(yt,g.uniformsList,E,tt));n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(fr.upload(yt,g.uniformsList,E,tt),n.uniformsNeedUpdate=!1);n.isSpriteMaterial&&A.setValue(yt,"center",s.center);return A.setValue(yt,"modelViewMatrix",s.modelViewMatrix),A.setValue(yt,"normalMatrix",s.normalMatrix),A.setValue(yt,"modelMatrix",s.matrixWorld),y}(t,e,i,n,s);J.setMaterial(n,a);let l=i.index;const h=i.attributes.position;if(null===l){if(void 0===h||0===h.count)return}else if(0===l.count)return;let c,u=1;!0===n.wireframe&&(l=rt.getWireframeAttribute(i),u=2),xt.setup(s,n,o,i,l);let p=ft;null!==l&&(c=st.get(l),p=gt,p.setIndex(c));const m=null!==l?l.count:h.count,g=i.drawRange.start*u,v=i.drawRange.count*u,x=null!==r?r.start*u:0,y=null!==r?r.count*u:1/0,b=Math.max(g,x),S=Math.min(m,g+v,x+y)-1,T=Math.max(0,S-b+1);if(0!==T){if(s.isMesh)!0===n.wireframe?(J.setLineWidth(n.wireframeLinewidth*q()),p.setMode(1)):p.setMode(4);else if(s.isLine){let t=n.linewidth;void 0===t&&(t=1),J.setLineWidth(t*q()),s.isLineSegments?p.setMode(1):s.isLineLoop?p.setMode(2):p.setMode(3)}else s.isPoints?p.setMode(0):s.isSprite&&p.setMode(4);if(s.isInstancedMesh)p.renderInstances(b,T,s.count);else if(i.isInstancedBufferGeometry){const t=Math.min(i.instanceCount,i._maxInstanceCount);p.renderInstances(b,T,t)}else p.render(b,T)}},this.compile=function(t,e){d=ct.get(t),d.init(),m.push(d),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(d.pushLight(t),t.castShadow&&d.pushShadow(t))})),d.setupLights(f.physicallyCorrectLights),t.traverse((function(e){const i=e.material;if(i)if(Array.isArray(i))for(let n=0;n<i.length;n++){Nt(i[n],t,e)}else Nt(i,t,e)})),m.pop(),d=null};let At=null;function Et(){Ct.stop()}function Lt(){Ct.start()}const Ct=new yn;function Pt(t,e,i,n){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||H.intersectsSprite(t)){n&&X.setFromMatrixPosition(t.matrixWorld).applyMatrix4(j);const e=at.update(t),s=t.material;s.visible&&u.push(t,e,s,i,X.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==K.render.frame&&(t.skeleton.update(),t.skeleton.frame=K.render.frame),!t.frustumCulled||H.intersectsObject(t))){n&&X.setFromMatrixPosition(t.matrixWorld).applyMatrix4(j);const e=at.update(t),s=t.material;if(Array.isArray(s)){const n=e.groups;for(let r=0,a=n.length;r<a;r++){const a=n[r],o=s[a.materialIndex];o&&o.visible&&u.push(t,e,o,i,X.z,a)}}else s.visible&&u.push(t,e,s,i,X.z,null)}const s=t.children;for(let t=0,r=s.length;t<r;t++)Pt(s[t],e,i,n)}function Rt(t,e,i,n){const s=t.opaque,r=t.transmissive,o=t.transparent;d.setupLightsView(i),r.length>0&&function(t,e,i){if(null===W){const t=!0===a&&!0===Z.isWebGL2;W=new(t?Gt:Bt)(1024,1024,{generateMipmaps:!0,type:null!==vt.convert(P)?P:A,minFilter:T,magFilter:b,wrapS:x,wrapT:x})}const n=f.getRenderTarget();f.setRenderTarget(W),f.clear();const s=f.toneMapping;f.toneMapping=0,It(t,e,i),f.toneMapping=s,tt.updateMultisampleRenderTarget(W),tt.updateRenderTargetMipmap(W),f.setRenderTarget(n)}(s,e,i),n&&J.viewport(S.copy(n)),s.length>0&&It(s,e,i),r.length>0&&It(r,e,i),o.length>0&&It(o,e,i)}function It(t,e,i){const n=!0===e.isScene?e.overrideMaterial:null;for(let s=0,r=t.length;s<r;s++){const r=t[s],a=r.object,o=r.geometry,l=null===n?r.material:n,h=r.group;a.layers.test(i.layers)&&Dt(a,e,i,o,l,h)}}function Dt(t,e,i,n,s,r){t.onBeforeRender(f,e,i,n,s,r),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),s.onBeforeRender(f,e,i,n,t,r),!0===s.transparent&&2===s.side?(s.side=1,s.needsUpdate=!0,f.renderBufferDirect(i,e,n,s,t,r),s.side=0,s.needsUpdate=!0,f.renderBufferDirect(i,e,n,s,t,r),s.side=2):f.renderBufferDirect(i,e,n,s,t,r),t.onAfterRender(f,e,i,n,s,r)}function Nt(t,e,i){!0!==e.isScene&&(e=Y);const n=$.get(t),s=d.state.lights,r=d.state.shadowsArray,a=s.state.version,o=ot.getParameters(t,s.state,r,e,i),l=ot.getProgramCacheKey(o);let h=n.programs;n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=(t.isMeshStandardMaterial?nt:it).get(t.envMap||n.environment),void 0===h&&(t.addEventListener("dispose",Tt),h=new Map,n.programs=h);let c=h.get(l);if(void 0!==c){if(n.currentProgram===c&&n.lightsStateVersion===a)return kt(t,o),c}else o.uniforms=ot.getUniforms(t),t.onBuild(i,o,f),t.onBeforeCompile(o,f),c=ot.acquireProgram(o,l),h.set(l,c),n.uniforms=o.uniforms;const u=n.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=ut.uniform),kt(t,o),n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=a,n.needsLights&&(u.ambientLightColor.value=s.state.ambient,u.lightProbe.value=s.state.probe,u.directionalLights.value=s.state.directional,u.directionalLightShadows.value=s.state.directionalShadow,u.spotLights.value=s.state.spot,u.spotLightShadows.value=s.state.spotShadow,u.rectAreaLights.value=s.state.rectArea,u.ltc_1.value=s.state.rectAreaLTC1,u.ltc_2.value=s.state.rectAreaLTC2,u.pointLights.value=s.state.point,u.pointLightShadows.value=s.state.pointShadow,u.hemisphereLights.value=s.state.hemi,u.directionalShadowMap.value=s.state.directionalShadowMap,u.directionalShadowMatrix.value=s.state.directionalShadowMatrix,u.spotShadowMap.value=s.state.spotShadowMap,u.spotShadowMatrix.value=s.state.spotShadowMatrix,u.pointShadowMap.value=s.state.pointShadowMap,u.pointShadowMatrix.value=s.state.pointShadowMatrix);const p=c.getUniforms(),m=fr.seqWithValue(p.seq,u);return n.currentProgram=c,n.uniformsList=m,c}function kt(t,e){const i=$.get(t);i.outputEncoding=e.outputEncoding,i.instancing=e.instancing,i.skinning=e.skinning,i.morphTargets=e.morphTargets,i.morphNormals=e.morphNormals,i.morphTargetsCount=e.morphTargetsCount,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents}Ct.setAnimationLoop((function(t){At&&At(t)})),"undefined"!=typeof window&&Ct.setContext(window),this.setAnimationLoop=function(t){At=t,_t.setAnimationLoop(t),null===t?Ct.stop():Ct.start()},_t.addEventListener("sessionstart",Et),_t.addEventListener("sessionend",Lt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===_t.enabled&&!0===_t.isPresenting&&(!0===_t.cameraAutoUpdate&&_t.updateCamera(e),e=_t.getCamera()),!0===t.isScene&&t.onBeforeRender(f,t,e,w),d=ct.get(t,m.length),d.init(),m.push(d),j.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),H.setFromProjectionMatrix(j),V=this.localClippingEnabled,G=ut.init(this.clippingPlanes,V,e),u=ht.get(t,p.length),u.init(),p.push(u),Pt(t,e,0,f.sortObjects),u.finish(),!0===f.sortObjects&&u.sort(N,k),!0===G&&ut.beginShadows();const i=d.state.shadowsArray;if(dt.render(i,t,e),!0===G&&ut.endShadows(),!0===this.info.autoReset&&this.info.reset(),pt.render(u,t),d.setupLights(f.physicallyCorrectLights),e.isArrayCamera){const i=e.cameras;for(let e=0,n=i.length;e<n;e++){const n=i[e];Rt(u,t,n,n.viewport)}}else Rt(u,t,e);null!==w&&(tt.updateMultisampleRenderTarget(w),tt.updateRenderTargetMipmap(w)),!0===t.isScene&&t.onAfterRender(f,t,e),J.buffers.depth.setTest(!0),J.buffers.depth.setMask(!0),J.buffers.color.setMask(!0),J.setPolygonOffset(!1),xt.resetDefaultState(),_=-1,M=null,m.pop(),d=m.length>0?m[m.length-1]:null,p.pop(),u=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return w},this.setRenderTarget=function(t,e=0,i=0){w=t,v=e,y=i,t&&void 0===$.get(t).__webglFramebuffer&&tt.setupRenderTarget(t);let n=null,s=!1,r=!1;if(t){const i=t.texture;(i.isDataTexture3D||i.isDataTexture2DArray)&&(r=!0);const a=$.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(n=a[e],s=!0):n=t.isWebGLMultisampleRenderTarget?$.get(t).__webglMultisampledFramebuffer:a,S.copy(t.viewport),E.copy(t.scissor),L=t.scissorTest}else S.copy(z).multiplyScalar(D).floor(),E.copy(U).multiplyScalar(D).floor(),L=O;if(J.bindFramebuffer(36160,n)&&Z.drawBuffers){let e=!1;if(t)if(t.isWebGLMultipleRenderTargets){const i=t.texture;if(B.length!==i.length||36064!==B[0]){for(let t=0,e=i.length;t<e;t++)B[t]=36064+t;B.length=i.length,e=!0}}else 1===B.length&&36064===B[0]||(B[0]=36064,B.length=1,e=!0);else 1===B.length&&1029===B[0]||(B[0]=1029,B.length=1,e=!0);e&&(Z.isWebGL2?yt.drawBuffers(B):Q.get("WEBGL_draw_buffers").drawBuffersWEBGL(B))}if(J.viewport(S),J.scissor(E),J.setScissorTest(L),s){const n=$.get(t.texture);yt.framebufferTexture2D(36160,36064,34069+e,n.__webglTexture,i)}else if(r){const n=$.get(t.texture),s=e||0;yt.framebufferTextureLayer(36160,36064,n.__webglTexture,i||0,s)}_=-1},this.readRenderTargetPixels=function(t,e,i,n,s,r,a){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=$.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){J.bindFramebuffer(36160,o);try{const a=t.texture,o=a.format,l=a.type;if(o!==I&&vt.convert(o)!==yt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const h=l===P&&(Q.has("EXT_color_buffer_half_float")||Z.isWebGL2&&Q.has("EXT_color_buffer_float"));if(!(l===A||vt.convert(l)===yt.getParameter(35738)||l===C&&(Z.isWebGL2||Q.has("OES_texture_float")||Q.has("WEBGL_color_buffer_float"))||h))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===yt.checkFramebufferStatus(36160)?e>=0&&e<=t.width-n&&i>=0&&i<=t.height-s&&yt.readPixels(e,i,n,s,vt.convert(o),vt.convert(l),r):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const t=null!==w?$.get(w).__webglFramebuffer:null;J.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e,i=0){const n=Math.pow(2,-i),s=Math.floor(e.image.width*n),r=Math.floor(e.image.height*n);let a=vt.convert(e.format);Z.isWebGL2&&(6407===a&&(a=32849),6408===a&&(a=32856)),tt.setTexture2D(e,0),yt.copyTexImage2D(3553,i,a,t.x,t.y,s,r,0),J.unbindTexture()},this.copyTextureToTexture=function(t,e,i,n=0){const s=e.image.width,r=e.image.height,a=vt.convert(i.format),o=vt.convert(i.type);tt.setTexture2D(i,0),yt.pixelStorei(37440,i.flipY),yt.pixelStorei(37441,i.premultiplyAlpha),yt.pixelStorei(3317,i.unpackAlignment),e.isDataTexture?yt.texSubImage2D(3553,n,t.x,t.y,s,r,a,o,e.image.data):e.isCompressedTexture?yt.compressedTexSubImage2D(3553,n,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):yt.texSubImage2D(3553,n,t.x,t.y,a,o,e.image),0===n&&i.generateMipmaps&&yt.generateMipmap(3553),J.unbindTexture()},this.copyTextureToTexture3D=function(t,e,i,n,s=0){if(f.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const r=t.max.x-t.min.x+1,a=t.max.y-t.min.y+1,o=t.max.z-t.min.z+1,l=vt.convert(n.format),h=vt.convert(n.type);let c;if(n.isDataTexture3D)tt.setTexture3D(n,0),c=32879;else{if(!n.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");tt.setTexture2DArray(n,0),c=35866}yt.pixelStorei(37440,n.flipY),yt.pixelStorei(37441,n.premultiplyAlpha),yt.pixelStorei(3317,n.unpackAlignment);const u=yt.getParameter(3314),d=yt.getParameter(32878),p=yt.getParameter(3316),m=yt.getParameter(3315),g=yt.getParameter(32877),v=i.isCompressedTexture?i.mipmaps[0]:i.image;yt.pixelStorei(3314,v.width),yt.pixelStorei(32878,v.height),yt.pixelStorei(3316,t.min.x),yt.pixelStorei(3315,t.min.y),yt.pixelStorei(32877,t.min.z),i.isDataTexture||i.isDataTexture3D?yt.texSubImage3D(c,s,e.x,e.y,e.z,r,a,o,l,h,v.data):i.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),yt.compressedTexSubImage3D(c,s,e.x,e.y,e.z,r,a,o,l,v.data)):yt.texSubImage3D(c,s,e.x,e.y,e.z,r,a,o,l,h,v),yt.pixelStorei(3314,u),yt.pixelStorei(32878,d),yt.pixelStorei(3316,p),yt.pixelStorei(3315,m),yt.pixelStorei(32877,g),0===s&&n.generateMipmaps&&yt.generateMipmap(c),J.unbindTexture()},this.initTexture=function(t){tt.setTexture2D(t,0),J.unbindTexture()},this.resetState=function(){v=0,y=0,w=null,J.reset(),xt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class oa extends aa{}oa.prototype.isWebGL1Renderer=!0;class la{constructor(t,e=25e-5){this.name="",this.color=new di(t),this.density=e}clone(){return new la(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}la.prototype.isFogExp2=!0;class ha{constructor(t,e=1,i=1e3){this.name="",this.color=new di(t),this.near=e,this.far=i}clone(){return new ha(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}ha.prototype.isFog=!0;class ca extends Xe{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}ca.prototype.isScene=!0;class ua{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=ct,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=yt()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,s=this.stride;n<s;n++)this.array[t+n]=e.array[i+n];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=yt()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=yt()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}ua.prototype.isInterleavedBuffer=!0;const da=new Wt;class pa{constructor(t,e,i,n=!1){this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)da.x=this.getX(e),da.y=this.getY(e),da.z=this.getZ(e),da.applyMatrix4(t),this.setXYZ(e,da.x,da.y,da.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)da.x=this.getX(e),da.y=this.getY(e),da.z=this.getZ(e),da.applyNormalMatrix(t),this.setXYZ(e,da.x,da.y,da.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)da.x=this.getX(e),da.y=this.getY(e),da.z=this.getZ(e),da.transformDirection(t),this.setXYZ(e,da.x,da.y,da.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,s){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=s,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new gi(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new pa(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}pa.prototype.isInterleavedBufferAttribute=!0;class ma extends ri{constructor(t){super(),this.type="SpriteMaterial",this.color=new di(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}let fa;ma.prototype.isSpriteMaterial=!0;const ga=new Wt,va=new Wt,xa=new Wt,ya=new Et,ba=new Et,wa=new we,_a=new Wt,Ma=new Wt,Sa=new Wt,Ta=new Et,Aa=new Et,Ea=new Et;class La extends Xe{constructor(t){if(super(),this.type="Sprite",void 0===fa){fa=new Di;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new ua(t,5);fa.setIndex([0,1,2,0,2,3]),fa.setAttribute("position",new pa(e,3,0,!1)),fa.setAttribute("uv",new pa(e,2,3,!1))}this.geometry=fa,this.material=void 0!==t?t:new ma,this.center=new Et(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),va.setFromMatrixScale(this.matrixWorld),wa.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),xa.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&va.multiplyScalar(-xa.z);const i=this.material.rotation;let n,s;0!==i&&(s=Math.cos(i),n=Math.sin(i));const r=this.center;Ca(_a.set(-.5,-.5,0),xa,r,va,n,s),Ca(Ma.set(.5,-.5,0),xa,r,va,n,s),Ca(Sa.set(.5,.5,0),xa,r,va,n,s),Ta.set(0,0),Aa.set(1,0),Ea.set(1,1);let a=t.ray.intersectTriangle(_a,Ma,Sa,!1,ga);if(null===a&&(Ca(Ma.set(-.5,.5,0),xa,r,va,n,s),Aa.set(0,1),a=t.ray.intersectTriangle(_a,Sa,Ma,!1,ga),null===a))return;const o=t.ray.origin.distanceTo(ga);o<t.near||o>t.far||e.push({distance:o,point:ga.clone(),uv:ni.getUV(ga,_a,Ma,Sa,Ta,Aa,Ea,new Et),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function Ca(t,e,i,n,s,r){ya.subVectors(t,i).addScalar(.5).multiply(n),void 0!==s?(ba.x=r*ya.x-s*ya.y,ba.y=s*ya.x+r*ya.y):ba.copy(ya),t.copy(e),t.x+=ba.x,t.y+=ba.y,t.applyMatrix4(wa)}La.prototype.isSprite=!0;const Pa=new Wt,Ra=new Wt;class Fa extends Xe{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let t=0,i=e.length;t<i;t++){const i=e[t];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0){e=Math.abs(e);const i=this.levels;let n;for(n=0;n<i.length&&!(e<i[n].distance);n++);return i.splice(n,0,{distance:e,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let i,n;for(i=1,n=e.length;i<n&&!(t<e[i].distance);i++);return e[i-1].object}return null}raycast(t,e){if(this.levels.length>0){Pa.setFromMatrixPosition(this.matrixWorld);const i=t.ray.origin.distanceTo(Pa);this.getObjectForDistance(i).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){Pa.setFromMatrixPosition(t.matrixWorld),Ra.setFromMatrixPosition(this.matrixWorld);const i=Pa.distanceTo(Ra)/t.zoom;let n,s;for(e[0].object.visible=!0,n=1,s=e.length;n<s&&i>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(this._currentLevel=n-1;n<s;n++)e[n].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const i=this.levels;for(let t=0,n=i.length;t<n;t++){const n=i[t];e.object.levels.push({object:n.object.uuid,distance:n.distance})}return e}}const Ia=new Wt,Da=new Ot,Na=new Ot,ka=new Wt,za=new we;class Ua extends Ki{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new we,this.bindMatrixInverse=new we}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Ot,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.w=e.getW(i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const i=this.skeleton,n=this.geometry;Da.fromBufferAttribute(n.attributes.skinIndex,t),Na.fromBufferAttribute(n.attributes.skinWeight,t),Ia.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const n=Na.getComponent(t);if(0!==n){const s=Da.getComponent(t);za.multiplyMatrices(i.bones[s].matrixWorld,i.boneInverses[s]),e.addScaledVector(ka.copy(Ia).applyMatrix4(za),n)}}return e.applyMatrix4(this.bindMatrixInverse)}}Ua.prototype.isSkinnedMesh=!0;class Oa extends Xe{constructor(){super(),this.type="Bone"}}Oa.prototype.isBone=!0;class Ba extends zt{constructor(t=null,e=1,i=1,n,s,r,a,o,l=1003,h=1003,c,u){super(null,r,a,o,l,h,n,s,c,u),this.image={data:t,width:e,height:i},this.magFilter=l,this.minFilter=h,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Ba.prototype.isDataTexture=!0;const Ha=new we,Ga=new we;class Va{constructor(t=[],e=[]){this.uuid=yt(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new we)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new we;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,s=t.length;n<s;n++){const s=t[n]?t[n].matrixWorld:Ga;Ha.multiplyMatrices(s,e[n]),Ha.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new Va(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=St(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new Ba(e,t,t,I,C);return this.boneMatrices=e,this.boneTexture=i,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const i=this.bones[e];if(i.name===t)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,n=t.bones.length;i<n;i++){const n=t.bones[i];let s=e[n];void 0===s&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),s=new Oa),this.bones.push(s),this.boneInverses.push((new we).fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let n=0,s=e.length;n<s;n++){const s=e[n];t.bones.push(s.uuid);const r=i[n];t.boneInverses.push(r.toArray())}return t}}class Wa extends gi{constructor(t,e,i,n=1){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,i),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}Wa.prototype.isInstancedBufferAttribute=!0;const ja=new we,Xa=new we,Ya=[],qa=new Ki;class Qa extends Ki{constructor(t,e,i){super(t,e),this.instanceMatrix=new Wa(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const i=this.matrixWorld,n=this.count;if(qa.geometry=this.geometry,qa.material=this.material,void 0!==qa.material)for(let s=0;s<n;s++){this.getMatrixAt(s,ja),Xa.multiplyMatrices(i,ja),qa.matrixWorld=Xa,qa.raycast(t,Ya);for(let t=0,i=Ya.length;t<i;t++){const i=Ya[t];i.instanceId=s,i.object=this,e.push(i)}Ya.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new Wa(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Qa.prototype.isInstancedMesh=!0;class Za extends ri{constructor(t){super(),this.type="LineBasicMaterial",this.color=new di(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}}Za.prototype.isLineBasicMaterial=!0;const Ja=new Wt,Ka=new Wt,$a=new we,to=new be,eo=new de;class io extends Xe{constructor(t=new Di,e=new Za){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,n=e.count;t<n;t++)Ja.fromBufferAttribute(e,t-1),Ka.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=Ja.distanceTo(Ka);t.setAttribute("lineDistance",new Ti(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,s=t.params.Line.threshold,r=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),eo.copy(i.boundingSphere),eo.applyMatrix4(n),eo.radius+=s,!1===t.ray.intersectsSphere(eo))return;$a.copy(n).invert(),to.copy(t.ray).applyMatrix4($a);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new Wt,h=new Wt,c=new Wt,u=new Wt,d=this.isLineSegments?2:1;if(i.isBufferGeometry){const n=i.index,s=i.attributes.position;if(null!==n){for(let i=Math.max(0,r.start),a=Math.min(n.count,r.start+r.count)-1;i<a;i+=d){const r=n.getX(i),a=n.getX(i+1);l.fromBufferAttribute(s,r),h.fromBufferAttribute(s,a);if(to.distanceSqToSegment(l,h,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);const d=t.ray.origin.distanceTo(u);d<t.near||d>t.far||e.push({distance:d,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(let i=Math.max(0,r.start),n=Math.min(s.count,r.start+r.count)-1;i<n;i+=d){l.fromBufferAttribute(s,i),h.fromBufferAttribute(s,i+1);if(to.distanceSqToSegment(l,h,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);const n=t.ray.origin.distanceTo(u);n<t.near||n>t.far||e.push({distance:n,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}io.prototype.isLine=!0;const no=new Wt,so=new Wt;class ro extends io{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,n=e.count;t<n;t+=2)no.fromBufferAttribute(e,t),so.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+no.distanceTo(so);t.setAttribute("lineDistance",new Ti(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}ro.prototype.isLineSegments=!0;class ao extends io{constructor(t,e){super(t,e),this.type="LineLoop"}}ao.prototype.isLineLoop=!0;class oo extends ri{constructor(t){super(),this.type="PointsMaterial",this.color=new di(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}}oo.prototype.isPointsMaterial=!0;const lo=new we,ho=new be,co=new de,uo=new Wt;class po extends Xe{constructor(t=new Di,e=new oo){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,s=t.params.Points.threshold,r=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),co.copy(i.boundingSphere),co.applyMatrix4(n),co.radius+=s,!1===t.ray.intersectsSphere(co))return;lo.copy(n).invert(),ho.copy(t.ray).applyMatrix4(lo);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a;if(i.isBufferGeometry){const s=i.index,a=i.attributes.position;if(null!==s){for(let i=Math.max(0,r.start),l=Math.min(s.count,r.start+r.count);i<l;i++){const r=s.getX(i);uo.fromBufferAttribute(a,r),mo(uo,r,o,n,t,e,this)}}else{for(let i=Math.max(0,r.start),s=Math.min(a.count,r.start+r.count);i<s;i++)uo.fromBufferAttribute(a,i),mo(uo,i,o,n,t,e,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function mo(t,e,i,n,s,r,a){const o=ho.distanceSqToPoint(t);if(o<i){const i=new Wt;ho.closestPointToPoint(t,i),i.applyMatrix4(n);const l=s.ray.origin.distanceTo(i);if(l<s.near||l>s.far)return;r.push({distance:l,distanceToRay:Math.sqrt(o),point:i,index:e,face:null,object:a})}}po.prototype.isPoints=!0;class fo extends zt{constructor(t,e,i,n,s,r,a,o,l){super(t,e,i,n,s,r,a,o,l),this.format=void 0!==a?a:F,this.minFilter=void 0!==r?r:M,this.magFilter=void 0!==s?s:M,this.generateMipmaps=!1;const h=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){h.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}fo.prototype.isVideoTexture=!0;class go extends zt{constructor(t,e,i,n,s,r,a,o,l,h,c,u){super(null,r,a,o,l,h,n,s,c,u),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}go.prototype.isCompressedTexture=!0;class vo extends zt{constructor(t,e,i,n,s,r,a,o,l){super(t,e,i,n,s,r,a,o,l),this.needsUpdate=!0}}vo.prototype.isCanvasTexture=!0;class xo extends zt{constructor(t,e,i,n,s,r,a,o,l,h){if((h=void 0!==h?h:N)!==N&&h!==k)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&h===N&&(i=E),void 0===i&&h===k&&(i=R),super(null,n,s,r,a,o,h,i,l),this.image={width:t,height:e},this.magFilter=void 0!==a?a:b,this.minFilter=void 0!==o?o:b,this.flipY=!1,this.generateMipmaps=!1}}xo.prototype.isDepthTexture=!0;class yo extends Di{constructor(t=1,e=8,i=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},e=Math.max(3,e);const s=[],r=[],a=[],o=[],l=new Wt,h=new Et;r.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(let s=0,c=3;s<=e;s++,c+=3){const u=i+s/e*n;l.x=t*Math.cos(u),l.y=t*Math.sin(u),r.push(l.x,l.y,l.z),a.push(0,0,1),h.x=(r[c]/t+1)/2,h.y=(r[c+1]/t+1)/2,o.push(h.x,h.y)}for(let t=1;t<=e;t++)s.push(t,t+1,0);this.setIndex(s),this.setAttribute("position",new Ti(r,3)),this.setAttribute("normal",new Ti(a,3)),this.setAttribute("uv",new Ti(o,2))}static fromJSON(t){return new yo(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class bo extends Di{constructor(t=1,e=1,i=1,n=8,s=1,r=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:s,openEnded:r,thetaStart:a,thetaLength:o};const l=this;n=Math.floor(n),s=Math.floor(s);const h=[],c=[],u=[],d=[];let p=0;const m=[],f=i/2;let g=0;function v(i){const s=p,r=new Et,m=new Wt;let v=0;const x=!0===i?t:e,y=!0===i?1:-1;for(let t=1;t<=n;t++)c.push(0,f*y,0),u.push(0,y,0),d.push(.5,.5),p++;const b=p;for(let t=0;t<=n;t++){const e=t/n*o+a,i=Math.cos(e),s=Math.sin(e);m.x=x*s,m.y=f*y,m.z=x*i,c.push(m.x,m.y,m.z),u.push(0,y,0),r.x=.5*i+.5,r.y=.5*s*y+.5,d.push(r.x,r.y),p++}for(let t=0;t<n;t++){const e=s+t,n=b+t;!0===i?h.push(n,n+1,e):h.push(n+1,n,e),v+=3}l.addGroup(g,v,!0===i?1:2),g+=v}!function(){const r=new Wt,v=new Wt;let x=0;const y=(e-t)/i;for(let l=0;l<=s;l++){const h=[],g=l/s,x=g*(e-t)+t;for(let t=0;t<=n;t++){const e=t/n,s=e*o+a,l=Math.sin(s),m=Math.cos(s);v.x=x*l,v.y=-g*i+f,v.z=x*m,c.push(v.x,v.y,v.z),r.set(l,y,m).normalize(),u.push(r.x,r.y,r.z),d.push(e,1-g),h.push(p++)}m.push(h)}for(let t=0;t<n;t++)for(let e=0;e<s;e++){const i=m[e][t],n=m[e+1][t],s=m[e+1][t+1],r=m[e][t+1];h.push(i,n,r),h.push(n,s,r),x+=6}l.addGroup(g,x,0),g+=x}(),!1===r&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(h),this.setAttribute("position",new Ti(c,3)),this.setAttribute("normal",new Ti(u,3)),this.setAttribute("uv",new Ti(d,2))}static fromJSON(t){return new bo(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class wo extends bo{constructor(t=1,e=1,i=8,n=1,s=!1,r=0,a=2*Math.PI){super(0,t,e,i,n,s,r,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:s,thetaStart:r,thetaLength:a}}static fromJSON(t){return new wo(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class _o extends Di{constructor(t=[],e=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n};const s=[],r=[];function a(t,e,i,n){const s=n+1,r=[];for(let n=0;n<=s;n++){r[n]=[];const a=t.clone().lerp(i,n/s),o=e.clone().lerp(i,n/s),l=s-n;for(let t=0;t<=l;t++)r[n][t]=0===t&&n===s?a:a.clone().lerp(o,t/l)}for(let t=0;t<s;t++)for(let e=0;e<2*(s-t)-1;e++){const i=Math.floor(e/2);e%2==0?(o(r[t][i+1]),o(r[t+1][i]),o(r[t][i])):(o(r[t][i+1]),o(r[t+1][i+1]),o(r[t+1][i]))}}function o(t){s.push(t.x,t.y,t.z)}function l(e,i){const n=3*e;i.x=t[n+0],i.y=t[n+1],i.z=t[n+2]}function h(t,e,i,n){n<0&&1===t.x&&(r[e]=t.x-1),0===i.x&&0===i.z&&(r[e]=n/2/Math.PI+.5)}function c(t){return Math.atan2(t.z,-t.x)}!function(t){const i=new Wt,n=new Wt,s=new Wt;for(let r=0;r<e.length;r+=3)l(e[r+0],i),l(e[r+1],n),l(e[r+2],s),a(i,n,s,t)}(n),function(t){const e=new Wt;for(let i=0;i<s.length;i+=3)e.x=s[i+0],e.y=s[i+1],e.z=s[i+2],e.normalize().multiplyScalar(t),s[i+0]=e.x,s[i+1]=e.y,s[i+2]=e.z}(i),function(){const t=new Wt;for(let i=0;i<s.length;i+=3){t.x=s[i+0],t.y=s[i+1],t.z=s[i+2];const n=c(t)/2/Math.PI+.5,a=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);r.push(n,1-a)}var e;(function(){const t=new Wt,e=new Wt,i=new Wt,n=new Wt,a=new Et,o=new Et,l=new Et;for(let u=0,d=0;u<s.length;u+=9,d+=6){t.set(s[u+0],s[u+1],s[u+2]),e.set(s[u+3],s[u+4],s[u+5]),i.set(s[u+6],s[u+7],s[u+8]),a.set(r[d+0],r[d+1]),o.set(r[d+2],r[d+3]),l.set(r[d+4],r[d+5]),n.copy(t).add(e).add(i).divideScalar(3);const p=c(n);h(a,d+0,t,p),h(o,d+2,e,p),h(l,d+4,i,p)}})(),function(){for(let t=0;t<r.length;t+=6){const e=r[t+0],i=r[t+2],n=r[t+4],s=Math.max(e,i,n),a=Math.min(e,i,n);s>.9&&a<.1&&(e<.2&&(r[t+0]+=1),i<.2&&(r[t+2]+=1),n<.2&&(r[t+4]+=1))}}()}(),this.setAttribute("position",new Ti(s,3)),this.setAttribute("normal",new Ti(s.slice(),3)),this.setAttribute("uv",new Ti(r,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(t){return new _o(t.vertices,t.indices,t.radius,t.details)}}class Mo extends _o{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Mo(t.radius,t.detail)}}const So=new Wt,To=new Wt,Ao=new Wt,Eo=new ni;class Lo extends Di{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const i=4,n=Math.pow(10,i),s=Math.cos(ft*e),r=t.getIndex(),a=t.getAttribute("position"),o=r?r.count:a.count,l=[0,0,0],h=["a","b","c"],c=new Array(3),u={},d=[];for(let t=0;t<o;t+=3){r?(l[0]=r.getX(t),l[1]=r.getX(t+1),l[2]=r.getX(t+2)):(l[0]=t,l[1]=t+1,l[2]=t+2);const{a:e,b:i,c:o}=Eo;if(e.fromBufferAttribute(a,l[0]),i.fromBufferAttribute(a,l[1]),o.fromBufferAttribute(a,l[2]),Eo.getNormal(Ao),c[0]=`${Math.round(e.x*n)},${Math.round(e.y*n)},${Math.round(e.z*n)}`,c[1]=`${Math.round(i.x*n)},${Math.round(i.y*n)},${Math.round(i.z*n)}`,c[2]=`${Math.round(o.x*n)},${Math.round(o.y*n)},${Math.round(o.z*n)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let t=0;t<3;t++){const e=(t+1)%3,i=c[t],n=c[e],r=Eo[h[t]],a=Eo[h[e]],o=`${i}_${n}`,p=`${n}_${i}`;p in u&&u[p]?(Ao.dot(u[p].normal)<=s&&(d.push(r.x,r.y,r.z),d.push(a.x,a.y,a.z)),u[p]=null):o in u||(u[o]={index0:l[t],index1:l[e],normal:Ao.clone()})}}for(const t in u)if(u[t]){const{index0:e,index1:i}=u[t];So.fromBufferAttribute(a,e),To.fromBufferAttribute(a,i),d.push(So.x,So.y,So.z),d.push(To.x,To.y,To.z)}this.setAttribute("position",new Ti(d,3))}}}class Co{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),s=0;e.push(0);for(let r=1;r<=t;r++)i=this.getPoint(r/t),s+=i.distanceTo(n),e.push(s),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const i=this.getLengths();let n=0;const s=i.length;let r;r=e||t*i[s-1];let a,o=0,l=s-1;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),a=i[n]-r,a<0)o=n+1;else{if(!(a>0)){l=n;break}l=n-1}if(n=l,i[n]===r)return n/(s-1);const h=i[n];return(n+(r-h)/(i[n+1]-h))/(s-1)}getTangent(t,e){const i=1e-4;let n=t-i,s=t+i;n<0&&(n=0),s>1&&(s=1);const r=this.getPoint(n),a=this.getPoint(s),o=e||(r.isVector2?new Et:new Wt);return o.copy(a).sub(r).normalize(),o}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){const i=new Wt,n=[],s=[],r=[],a=new Wt,o=new we;for(let e=0;e<=t;e++){const i=e/t;n[e]=this.getTangentAt(i,new Wt)}s[0]=new Wt,r[0]=new Wt;let l=Number.MAX_VALUE;const h=Math.abs(n[0].x),c=Math.abs(n[0].y),u=Math.abs(n[0].z);h<=l&&(l=h,i.set(1,0,0)),c<=l&&(l=c,i.set(0,1,0)),u<=l&&i.set(0,0,1),a.crossVectors(n[0],i).normalize(),s[0].crossVectors(n[0],a),r[0].crossVectors(n[0],s[0]);for(let e=1;e<=t;e++){if(s[e]=s[e-1].clone(),r[e]=r[e-1].clone(),a.crossVectors(n[e-1],n[e]),a.length()>Number.EPSILON){a.normalize();const t=Math.acos(bt(n[e-1].dot(n[e]),-1,1));s[e].applyMatrix4(o.makeRotationAxis(a,t))}r[e].crossVectors(n[e],s[e])}if(!0===e){let e=Math.acos(bt(s[0].dot(s[t]),-1,1));e/=t,n[0].dot(a.crossVectors(s[0],s[t]))>0&&(e=-e);for(let i=1;i<=t;i++)s[i].applyMatrix4(o.makeRotationAxis(n[i],e*i)),r[i].crossVectors(n[i],s[i])}return{tangents:n,normals:s,binormals:r}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Po extends Co{constructor(t=0,e=0,i=1,n=1,s=0,r=2*Math.PI,a=!1,o=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=s,this.aEndAngle=r,this.aClockwise=a,this.aRotation=o}getPoint(t,e){const i=e||new Et,n=2*Math.PI;let s=this.aEndAngle-this.aStartAngle;const r=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(s=r?0:n),!0!==this.aClockwise||r||(s===n?s=-n:s-=n);const a=this.aStartAngle+t*s;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=o-this.aX,n=l-this.aY;o=i*t-n*e+this.aX,l=i*e+n*t+this.aY}return i.set(o,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}Po.prototype.isEllipseCurve=!0;class Ro extends Po{constructor(t,e,i,n,s,r){super(t,e,i,i,n,s,r),this.type="ArcCurve"}}function Fo(){let t=0,e=0,i=0,n=0;function s(s,r,a,o){t=s,e=a,i=-3*s+3*r-2*a-o,n=2*s-2*r+a+o}return{initCatmullRom:function(t,e,i,n,r){s(e,i,r*(i-t),r*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,r,a,o){let l=(e-t)/r-(i-t)/(r+a)+(i-e)/a,h=(i-e)/a-(n-e)/(a+o)+(n-i)/o;l*=a,h*=a,s(e,i,l,h)},calc:function(s){const r=s*s;return t+e*s+i*r+n*(r*s)}}}Ro.prototype.isArcCurve=!0;const Io=new Wt,Do=new Fo,No=new Fo,ko=new Fo;class zo extends Co{constructor(t=[],e=!1,i="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=n}getPoint(t,e=new Wt){const i=e,n=this.points,s=n.length,r=(s-(this.closed?0:1))*t;let a,o,l=Math.floor(r),h=r-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/s)+1)*s:0===h&&l===s-1&&(l=s-2,h=1),this.closed||l>0?a=n[(l-1)%s]:(Io.subVectors(n[0],n[1]).add(n[0]),a=Io);const c=n[l%s],u=n[(l+1)%s];if(this.closed||l+2<s?o=n[(l+2)%s]:(Io.subVectors(n[s-1],n[s-2]).add(n[s-1]),o=Io),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(c),t),i=Math.pow(c.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(o),t);i<1e-4&&(i=1),e<1e-4&&(e=i),n<1e-4&&(n=i),Do.initNonuniformCatmullRom(a.x,c.x,u.x,o.x,e,i,n),No.initNonuniformCatmullRom(a.y,c.y,u.y,o.y,e,i,n),ko.initNonuniformCatmullRom(a.z,c.z,u.z,o.z,e,i,n)}else"catmullrom"===this.curveType&&(Do.initCatmullRom(a.x,c.x,u.x,o.x,this.tension),No.initCatmullRom(a.y,c.y,u.y,o.y,this.tension),ko.initCatmullRom(a.z,c.z,u.z,o.z,this.tension));return i.set(Do.calc(h),No.calc(h),ko.calc(h)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new Wt).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function Uo(t,e,i,n,s){const r=.5*(n-e),a=.5*(s-i),o=t*t;return(2*i-2*n+r+a)*(t*o)+(-3*i+3*n-2*r-a)*o+r*t+i}function Oo(t,e,i,n){return function(t,e){const i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,n)}function Bo(t,e,i,n,s){return function(t,e){const i=1-t;return i*i*i*e}(t,e)+function(t,e){const i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,s)}zo.prototype.isCatmullRomCurve3=!0;class Ho extends Co{constructor(t=new Et,e=new Et,i=new Et,n=new Et){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new Et){const i=e,n=this.v0,s=this.v1,r=this.v2,a=this.v3;return i.set(Bo(t,n.x,s.x,r.x,a.x),Bo(t,n.y,s.y,r.y,a.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Ho.prototype.isCubicBezierCurve=!0;class Go extends Co{constructor(t=new Wt,e=new Wt,i=new Wt,n=new Wt){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new Wt){const i=e,n=this.v0,s=this.v1,r=this.v2,a=this.v3;return i.set(Bo(t,n.x,s.x,r.x,a.x),Bo(t,n.y,s.y,r.y,a.y),Bo(t,n.z,s.z,r.z,a.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Go.prototype.isCubicBezierCurve3=!0;class Vo extends Co{constructor(t=new Et,e=new Et){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Et){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const i=e||new Et;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Vo.prototype.isLineCurve=!0;class Wo extends Co{constructor(t=new Wt,e=new Wt){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new Wt){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class jo extends Co{constructor(t=new Et,e=new Et,i=new Et){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new Et){const i=e,n=this.v0,s=this.v1,r=this.v2;return i.set(Oo(t,n.x,s.x,r.x),Oo(t,n.y,s.y,r.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}jo.prototype.isQuadraticBezierCurve=!0;class Xo extends Co{constructor(t=new Wt,e=new Wt,i=new Wt){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new Wt){const i=e,n=this.v0,s=this.v1,r=this.v2;return i.set(Oo(t,n.x,s.x,r.x),Oo(t,n.y,s.y,r.y),Oo(t,n.z,s.z,r.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Xo.prototype.isQuadraticBezierCurve3=!0;class Yo extends Co{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new Et){const i=e,n=this.points,s=(n.length-1)*t,r=Math.floor(s),a=s-r,o=n[0===r?r:r-1],l=n[r],h=n[r>n.length-2?n.length-1:r+1],c=n[r>n.length-3?n.length-1:r+2];return i.set(Uo(a,o.x,l.x,h.x,c.x),Uo(a,o.y,l.y,h.y,c.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new Et).fromArray(i))}return this}}Yo.prototype.isSplineCurve=!0;var qo=Object.freeze({__proto__:null,ArcCurve:Ro,CatmullRomCurve3:zo,CubicBezierCurve:Ho,CubicBezierCurve3:Go,EllipseCurve:Po,LineCurve:Vo,LineCurve3:Wo,QuadraticBezierCurve:jo,QuadraticBezierCurve3:Xo,SplineCurve:Yo});class Qo extends Co{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Vo(e,t))}getPoint(t,e){const i=t*this.getLength(),n=this.getCurveLengths();let s=0;for(;s<n.length;){if(n[s]>=i){const t=n[s]-i,r=this.curves[s],a=r.getLength(),o=0===a?0:1-t/a;return r.getPointAt(o,e)}s++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let i;for(let n=0,s=this.curves;n<s.length;n++){const r=s[n],a=r&&r.isEllipseCurve?2*t:r&&(r.isLineCurve||r.isLineCurve3)?1:r&&r.isSplineCurve?t*r.points.length:t,o=r.getPoints(a);for(let t=0;t<o.length;t++){const n=o[t];i&&i.equals(n)||(e.push(n),i=n)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push((new qo[i.type]).fromJSON(i))}return this}}class Zo extends Qo{constructor(t){super(),this.type="Path",this.currentPoint=new Et,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const i=new Vo(this.currentPoint.clone(),new Et(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,n){const s=new jo(this.currentPoint.clone(),new Et(t,e),new Et(i,n));return this.curves.push(s),this.currentPoint.set(i,n),this}bezierCurveTo(t,e,i,n,s,r){const a=new Ho(this.currentPoint.clone(),new Et(t,e),new Et(i,n),new Et(s,r));return this.curves.push(a),this.currentPoint.set(s,r),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),i=new Yo(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,n,s,r){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+a,e+o,i,n,s,r),this}absarc(t,e,i,n,s,r){return this.absellipse(t,e,i,i,n,s,r),this}ellipse(t,e,i,n,s,r,a,o){const l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(t+l,e+h,i,n,s,r,a,o),this}absellipse(t,e,i,n,s,r,a,o){const l=new Po(t,e,i,n,s,r,a,o);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Jo extends Zo{constructor(t){super(t),this.uuid=yt(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push((new Zo).fromJSON(i))}return this}}const Ko=function(t,e,i=2){const n=e&&e.length,s=n?e[0]*i:t.length;let r=$o(t,0,s,i,!0);const a=[];if(!r||r.next===r.prev)return a;let o,l,h,c,u,d,p;if(n&&(r=function(t,e,i,n){const s=[];let r,a,o,l,h;for(r=0,a=e.length;r<a;r++)o=e[r]*n,l=r<a-1?e[r+1]*n:t.length,h=$o(t,o,l,n,!1),h===h.next&&(h.steiner=!0),s.push(cl(h));for(s.sort(al),r=0;r<s.length;r++)ol(s[r],i),i=tl(i,i.next);return i}(t,e,r,i)),t.length>80*i){o=h=t[0],l=c=t[1];for(let e=i;e<s;e+=i)u=t[e],d=t[e+1],u<o&&(o=u),d<l&&(l=d),u>h&&(h=u),d>c&&(c=d);p=Math.max(h-o,c-l),p=0!==p?1/p:0}return el(r,a,i,o,l,p),a};function $o(t,e,i,n,s){let r,a;if(s===function(t,e,i,n){let s=0;for(let r=e,a=i-n;r<i;r+=n)s+=(t[a]-t[r])*(t[r+1]+t[a+1]),a=r;return s}(t,e,i,n)>0)for(r=e;r<i;r+=n)a=bl(r,t[r],t[r+1],a);else for(r=i-n;r>=e;r-=n)a=bl(r,t[r],t[r+1],a);return a&&ml(a,a.next)&&(wl(a),a=a.next),a}function tl(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!ml(n,n.next)&&0!==pl(n.prev,n,n.next))n=n.next;else{if(wl(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function el(t,e,i,n,s,r,a){if(!t)return;!a&&r&&function(t,e,i,n){let s=t;do{null===s.z&&(s.z=hl(s.x,s.y,e,i,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,function(t){let e,i,n,s,r,a,o,l,h=1;do{for(i=t,t=null,r=null,a=0;i;){for(a++,n=i,o=0,e=0;e<h&&(o++,n=n.nextZ,n);e++);for(l=h;o>0||l>0&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(s=i,i=i.nextZ,o--):(s=n,n=n.nextZ,l--),r?r.nextZ=s:t=s,s.prevZ=r,r=s;i=n}r.nextZ=null,h*=2}while(a>1)}(s)}(t,n,s,r);let o,l,h=t;for(;t.prev!==t.next;)if(o=t.prev,l=t.next,r?nl(t,n,s,r):il(t))e.push(o.i/i),e.push(t.i/i),e.push(l.i/i),wl(t),t=l.next,h=l.next;else if((t=l)===h){a?1===a?el(t=sl(tl(t),e,i),e,i,n,s,r,2):2===a&&rl(t,e,i,n,s,r):el(tl(t),e,i,n,s,r,1);break}}function il(t){const e=t.prev,i=t,n=t.next;if(pl(e,i,n)>=0)return!1;let s=t.next.next;for(;s!==t.prev;){if(ul(e.x,e.y,i.x,i.y,n.x,n.y,s.x,s.y)&&pl(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function nl(t,e,i,n){const s=t.prev,r=t,a=t.next;if(pl(s,r,a)>=0)return!1;const o=s.x<r.x?s.x<a.x?s.x:a.x:r.x<a.x?r.x:a.x,l=s.y<r.y?s.y<a.y?s.y:a.y:r.y<a.y?r.y:a.y,h=s.x>r.x?s.x>a.x?s.x:a.x:r.x>a.x?r.x:a.x,c=s.y>r.y?s.y>a.y?s.y:a.y:r.y>a.y?r.y:a.y,u=hl(o,l,e,i,n),d=hl(h,c,e,i,n);let p=t.prevZ,m=t.nextZ;for(;p&&p.z>=u&&m&&m.z<=d;){if(p!==t.prev&&p!==t.next&&ul(s.x,s.y,r.x,r.y,a.x,a.y,p.x,p.y)&&pl(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==t.prev&&m!==t.next&&ul(s.x,s.y,r.x,r.y,a.x,a.y,m.x,m.y)&&pl(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&ul(s.x,s.y,r.x,r.y,a.x,a.y,p.x,p.y)&&pl(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=d;){if(m!==t.prev&&m!==t.next&&ul(s.x,s.y,r.x,r.y,a.x,a.y,m.x,m.y)&&pl(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function sl(t,e,i){let n=t;do{const s=n.prev,r=n.next.next;!ml(s,r)&&fl(s,n,n.next,r)&&xl(s,r)&&xl(r,s)&&(e.push(s.i/i),e.push(n.i/i),e.push(r.i/i),wl(n),wl(n.next),n=t=r),n=n.next}while(n!==t);return tl(n)}function rl(t,e,i,n,s,r){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&dl(a,t)){let o=yl(a,t);return a=tl(a,a.next),o=tl(o,o.next),el(a,e,i,n,s,r),void el(o,e,i,n,s,r)}t=t.next}a=a.next}while(a!==t)}function al(t,e){return t.x-e.x}function ol(t,e){if(e=function(t,e){let i=e;const n=t.x,s=t.y;let r,a=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){const t=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=n&&t>a){if(a=t,t===n){if(s===i.y)return i;if(s===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!r)return null;if(n===a)return r;const o=r,l=r.x,h=r.y;let c,u=1/0;i=r;do{n>=i.x&&i.x>=l&&n!==i.x&&ul(s<h?n:a,s,l,h,s<h?a:n,s,i.x,i.y)&&(c=Math.abs(s-i.y)/(n-i.x),xl(i,t)&&(c<u||c===u&&(i.x>r.x||i.x===r.x&&ll(r,i)))&&(r=i,u=c)),i=i.next}while(i!==o);return r}(t,e)){const i=yl(e,t);tl(e,e.next),tl(i,i.next)}}function ll(t,e){return pl(t.prev,t,e.prev)<0&&pl(e.next,t,t.next)<0}function hl(t,e,i,n,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*s)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*s)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function cl(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function ul(t,e,i,n,s,r,a,o){return(s-a)*(e-o)-(t-a)*(r-o)>=0&&(t-a)*(n-o)-(i-a)*(e-o)>=0&&(i-a)*(r-o)-(s-a)*(n-o)>=0}function dl(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&fl(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(xl(t,e)&&xl(e,t)&&function(t,e){let i=t,n=!1;const s=(t.x+e.x)/2,r=(t.y+e.y)/2;do{i.y>r!=i.next.y>r&&i.next.y!==i.y&&s<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(pl(t.prev,t,e.prev)||pl(t,e.prev,e))||ml(t,e)&&pl(t.prev,t,t.next)>0&&pl(e.prev,e,e.next)>0)}function pl(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function ml(t,e){return t.x===e.x&&t.y===e.y}function fl(t,e,i,n){const s=vl(pl(t,e,i)),r=vl(pl(t,e,n)),a=vl(pl(i,n,t)),o=vl(pl(i,n,e));return s!==r&&a!==o||(!(0!==s||!gl(t,i,e))||(!(0!==r||!gl(t,n,e))||(!(0!==a||!gl(i,t,n))||!(0!==o||!gl(i,e,n)))))}function gl(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function vl(t){return t>0?1:t<0?-1:0}function xl(t,e){return pl(t.prev,t,t.next)<0?pl(t,e,t.next)>=0&&pl(t,t.prev,e)>=0:pl(t,e,t.prev)<0||pl(t,t.next,e)<0}function yl(t,e){const i=new _l(t.i,t.x,t.y),n=new _l(e.i,e.x,e.y),s=t.next,r=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function bl(t,e,i,n){const s=new _l(t,e,i);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function wl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function _l(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Ml{static area(t){const e=t.length;let i=0;for(let n=e-1,s=0;s<e;n=s++)i+=t[n].x*t[s].y-t[s].x*t[n].y;return.5*i}static isClockWise(t){return Ml.area(t)<0}static triangulateShape(t,e){const i=[],n=[],s=[];Sl(t),Tl(i,t);let r=t.length;e.forEach(Sl);for(let t=0;t<e.length;t++)n.push(r),r+=e[t].length,Tl(i,e[t]);const a=Ko(i,n);for(let t=0;t<a.length;t+=3)s.push(a.slice(t,t+3));return s}}function Sl(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Tl(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class Al extends Di{constructor(t=new Jo([new Et(.5,.5),new Et(-.5,.5),new Et(-.5,-.5),new Et(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const i=this,n=[],s=[];for(let e=0,i=t.length;e<i;e++){r(t[e])}function r(t){const r=[],a=void 0!==e.curveSegments?e.curveSegments:12,o=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:1,h=void 0===e.bevelEnabled||e.bevelEnabled,c=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:c-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const m=e.extrudePath,f=void 0!==e.UVGenerator?e.UVGenerator:El;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let g,v,x,y,b,w=!1;m&&(g=m.getSpacedPoints(o),w=!0,h=!1,v=m.computeFrenetFrames(o,!1),x=new Wt,y=new Wt,b=new Wt),h||(p=0,c=0,u=0,d=0);const _=t.extractPoints(a);let M=_.shape;const S=_.holes;if(!Ml.isClockWise(M)){M=M.reverse();for(let t=0,e=S.length;t<e;t++){const e=S[t];Ml.isClockWise(e)&&(S[t]=e.reverse())}}const T=Ml.triangulateShape(M,S),A=M;for(let t=0,e=S.length;t<e;t++){const e=S[t];M=M.concat(e)}function E(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}const L=M.length,C=T.length;function P(t,e,i){let n,s,r;const a=t.x-e.x,o=t.y-e.y,l=i.x-t.x,h=i.y-t.y,c=a*a+o*o,u=a*h-o*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(c),d=Math.sqrt(l*l+h*h),p=e.x-o/u,m=e.y+a/u,f=((i.x-h/d-p)*h-(i.y+l/d-m)*l)/(a*h-o*l);n=p+a*f-t.x,s=m+o*f-t.y;const g=n*n+s*s;if(g<=2)return new Et(n,s);r=Math.sqrt(g/2)}else{let t=!1;a>Number.EPSILON?l>Number.EPSILON&&(t=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(o)===Math.sign(h)&&(t=!0),t?(n=-o,s=a,r=Math.sqrt(c)):(n=a,s=o,r=Math.sqrt(c/2))}return new Et(n/r,s/r)}const R=[];for(let t=0,e=A.length,i=e-1,n=t+1;t<e;t++,i++,n++)i===e&&(i=0),n===e&&(n=0),R[t]=P(A[t],A[i],A[n]);const F=[];let I,D=R.concat();for(let t=0,e=S.length;t<e;t++){const e=S[t];I=[];for(let t=0,i=e.length,n=i-1,s=t+1;t<i;t++,n++,s++)n===i&&(n=0),s===i&&(s=0),I[t]=P(e[t],e[n],e[s]);F.push(I),D=D.concat(I)}for(let t=0;t<p;t++){const e=t/p,i=c*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=A.length;t<e;t++){const e=E(A[t],R[t],n);z(e.x,e.y,-i)}for(let t=0,e=S.length;t<e;t++){const e=S[t];I=F[t];for(let t=0,s=e.length;t<s;t++){const s=E(e[t],I[t],n);z(s.x,s.y,-i)}}}const N=u+d;for(let t=0;t<L;t++){const e=h?E(M[t],D[t],N):M[t];w?(y.copy(v.normals[0]).multiplyScalar(e.x),x.copy(v.binormals[0]).multiplyScalar(e.y),b.copy(g[0]).add(y).add(x),z(b.x,b.y,b.z)):z(e.x,e.y,0)}for(let t=1;t<=o;t++)for(let e=0;e<L;e++){const i=h?E(M[e],D[e],N):M[e];w?(y.copy(v.normals[t]).multiplyScalar(i.x),x.copy(v.binormals[t]).multiplyScalar(i.y),b.copy(g[t]).add(y).add(x),z(b.x,b.y,b.z)):z(i.x,i.y,l/o*t)}for(let t=p-1;t>=0;t--){const e=t/p,i=c*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=A.length;t<e;t++){const e=E(A[t],R[t],n);z(e.x,e.y,l+i)}for(let t=0,e=S.length;t<e;t++){const e=S[t];I=F[t];for(let t=0,s=e.length;t<s;t++){const s=E(e[t],I[t],n);w?z(s.x,s.y+g[o-1].y,g[o-1].x+i):z(s.x,s.y,l+i)}}}function k(t,e){let i=t.length;for(;--i>=0;){const n=i;let s=i-1;s<0&&(s=t.length-1);for(let t=0,i=o+2*p;t<i;t++){const i=L*t,r=L*(t+1);O(e+n+i,e+s+i,e+s+r,e+n+r)}}}function z(t,e,i){r.push(t),r.push(e),r.push(i)}function U(t,e,s){B(t),B(e),B(s);const r=n.length/3,a=f.generateTopUV(i,n,r-3,r-2,r-1);H(a[0]),H(a[1]),H(a[2])}function O(t,e,s,r){B(t),B(e),B(r),B(e),B(s),B(r);const a=n.length/3,o=f.generateSideWallUV(i,n,a-6,a-3,a-2,a-1);H(o[0]),H(o[1]),H(o[3]),H(o[1]),H(o[2]),H(o[3])}function B(t){n.push(r[3*t+0]),n.push(r[3*t+1]),n.push(r[3*t+2])}function H(t){s.push(t.x),s.push(t.y)}!function(){const t=n.length/3;if(h){let t=0,e=L*t;for(let t=0;t<C;t++){const i=T[t];U(i[2]+e,i[1]+e,i[0]+e)}t=o+2*p,e=L*t;for(let t=0;t<C;t++){const i=T[t];U(i[0]+e,i[1]+e,i[2]+e)}}else{for(let t=0;t<C;t++){const e=T[t];U(e[2],e[1],e[0])}for(let t=0;t<C;t++){const e=T[t];U(e[0]+L*o,e[1]+L*o,e[2]+L*o)}}i.addGroup(t,n.length/3-t,0)}(),function(){const t=n.length/3;let e=0;k(A,e),e+=A.length;for(let t=0,i=S.length;t<i;t++){const i=S[t];k(i,e),e+=i.length}i.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new Ti(n,3)),this.setAttribute("uv",new Ti(s,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,i){if(i.shapes=[],Array.isArray(t))for(let e=0,n=t.length;e<n;e++){const n=t[e];i.shapes.push(n.uuid)}else i.shapes.push(t.uuid);void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const i=[];for(let n=0,s=t.shapes.length;n<s;n++){const s=e[t.shapes[n]];i.push(s)}const n=t.options.extrudePath;return void 0!==n&&(t.options.extrudePath=(new qo[n.type]).fromJSON(n)),new Al(i,t.options)}}const El={generateTopUV:function(t,e,i,n,s){const r=e[3*i],a=e[3*i+1],o=e[3*n],l=e[3*n+1],h=e[3*s],c=e[3*s+1];return[new Et(r,a),new Et(o,l),new Et(h,c)]},generateSideWallUV:function(t,e,i,n,s,r){const a=e[3*i],o=e[3*i+1],l=e[3*i+2],h=e[3*n],c=e[3*n+1],u=e[3*n+2],d=e[3*s],p=e[3*s+1],m=e[3*s+2],f=e[3*r],g=e[3*r+1],v=e[3*r+2];return Math.abs(o-c)<Math.abs(a-h)?[new Et(a,1-l),new Et(h,1-u),new Et(d,1-m),new Et(f,1-v)]:[new Et(o,1-l),new Et(c,1-u),new Et(p,1-m),new Et(g,1-v)]}};class Ll extends _o{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Ll(t.radius,t.detail)}}class Cl extends Di{constructor(t=[new Et(0,.5),new Et(.5,0),new Et(0,-.5)],e=12,i=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},e=Math.floor(e),n=bt(n,0,2*Math.PI);const s=[],r=[],a=[],o=1/e,l=new Wt,h=new Et;for(let s=0;s<=e;s++){const c=i+s*o*n,u=Math.sin(c),d=Math.cos(c);for(let i=0;i<=t.length-1;i++)l.x=t[i].x*u,l.y=t[i].y,l.z=t[i].x*d,r.push(l.x,l.y,l.z),h.x=s/e,h.y=i/(t.length-1),a.push(h.x,h.y)}for(let i=0;i<e;i++)for(let e=0;e<t.length-1;e++){const n=e+i*t.length,r=n,a=n+t.length,o=n+t.length+1,l=n+1;s.push(r,a,l),s.push(a,o,l)}if(this.setIndex(s),this.setAttribute("position",new Ti(r,3)),this.setAttribute("uv",new Ti(a,2)),this.computeVertexNormals(),n===2*Math.PI){const i=this.attributes.normal.array,n=new Wt,s=new Wt,r=new Wt,a=e*t.length*3;for(let e=0,o=0;e<t.length;e++,o+=3)n.x=i[o+0],n.y=i[o+1],n.z=i[o+2],s.x=i[a+o+0],s.y=i[a+o+1],s.z=i[a+o+2],r.addVectors(n,s).normalize(),i[o+0]=i[a+o+0]=r.x,i[o+1]=i[a+o+1]=r.y,i[o+2]=i[a+o+2]=r.z}}static fromJSON(t){return new Cl(t.points,t.segments,t.phiStart,t.phiLength)}}class Pl extends _o{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Pl(t.radius,t.detail)}}class Rl extends Di{constructor(t=.5,e=1,i=8,n=1,s=0,r=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:s,thetaLength:r},i=Math.max(3,i);const a=[],o=[],l=[],h=[];let c=t;const u=(e-t)/(n=Math.max(1,n)),d=new Wt,p=new Et;for(let t=0;t<=n;t++){for(let t=0;t<=i;t++){const n=s+t/i*r;d.x=c*Math.cos(n),d.y=c*Math.sin(n),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,h.push(p.x,p.y)}c+=u}for(let t=0;t<n;t++){const e=t*(i+1);for(let t=0;t<i;t++){const n=t+e,s=n,r=n+i+1,o=n+i+2,l=n+1;a.push(s,r,l),a.push(r,o,l)}}this.setIndex(a),this.setAttribute("position",new Ti(o,3)),this.setAttribute("normal",new Ti(l,3)),this.setAttribute("uv",new Ti(h,2))}static fromJSON(t){return new Rl(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class Fl extends Di{constructor(t=new Jo([new Et(0,.5),new Et(-.5,-.5),new Et(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const i=[],n=[],s=[],r=[];let a=0,o=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(a,o,e),a+=o,o=0;function l(t){const a=n.length/3,l=t.extractPoints(e);let h=l.shape;const c=l.holes;!1===Ml.isClockWise(h)&&(h=h.reverse());for(let t=0,e=c.length;t<e;t++){const e=c[t];!0===Ml.isClockWise(e)&&(c[t]=e.reverse())}const u=Ml.triangulateShape(h,c);for(let t=0,e=c.length;t<e;t++){const e=c[t];h=h.concat(e)}for(let t=0,e=h.length;t<e;t++){const e=h[t];n.push(e.x,e.y,0),s.push(0,0,1),r.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],n=e[0]+a,s=e[1]+a,r=e[2]+a;i.push(n,s,r),o+=3}}this.setIndex(i),this.setAttribute("position",new Ti(n,3)),this.setAttribute("normal",new Ti(s,3)),this.setAttribute("uv",new Ti(r,2))}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,n=t.length;i<n;i++){const n=t[i];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const i=[];for(let n=0,s=t.shapes.length;n<s;n++){const s=e[t.shapes[n]];i.push(s)}return new Fl(i,t.curveSegments)}}class Il extends Di{constructor(t=1,e=32,i=16,n=0,s=2*Math.PI,r=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:s,thetaStart:r,thetaLength:a},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));const o=Math.min(r+a,Math.PI);let l=0;const h=[],c=new Wt,u=new Wt,d=[],p=[],m=[],f=[];for(let d=0;d<=i;d++){const g=[],v=d/i;let x=0;0==d&&0==r?x=.5/e:d==i&&o==Math.PI&&(x=-.5/e);for(let i=0;i<=e;i++){const o=i/e;c.x=-t*Math.cos(n+o*s)*Math.sin(r+v*a),c.y=t*Math.cos(r+v*a),c.z=t*Math.sin(n+o*s)*Math.sin(r+v*a),p.push(c.x,c.y,c.z),u.copy(c).normalize(),m.push(u.x,u.y,u.z),f.push(o+x,1-v),g.push(l++)}h.push(g)}for(let t=0;t<i;t++)for(let n=0;n<e;n++){const e=h[t][n+1],s=h[t][n],a=h[t+1][n],l=h[t+1][n+1];(0!==t||r>0)&&d.push(e,s,l),(t!==i-1||o<Math.PI)&&d.push(s,a,l)}this.setIndex(d),this.setAttribute("position",new Ti(p,3)),this.setAttribute("normal",new Ti(m,3)),this.setAttribute("uv",new Ti(f,2))}static fromJSON(t){return new Il(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Dl extends _o{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Dl(t.radius,t.detail)}}class Nl extends Di{constructor(t=1,e=.4,i=8,n=6,s=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:s},i=Math.floor(i),n=Math.floor(n);const r=[],a=[],o=[],l=[],h=new Wt,c=new Wt,u=new Wt;for(let r=0;r<=i;r++)for(let d=0;d<=n;d++){const p=d/n*s,m=r/i*Math.PI*2;c.x=(t+e*Math.cos(m))*Math.cos(p),c.y=(t+e*Math.cos(m))*Math.sin(p),c.z=e*Math.sin(m),a.push(c.x,c.y,c.z),h.x=t*Math.cos(p),h.y=t*Math.sin(p),u.subVectors(c,h).normalize(),o.push(u.x,u.y,u.z),l.push(d/n),l.push(r/i)}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*t+e-1,s=(n+1)*(t-1)+e-1,a=(n+1)*(t-1)+e,o=(n+1)*t+e;r.push(i,s,o),r.push(s,a,o)}this.setIndex(r),this.setAttribute("position",new Ti(a,3)),this.setAttribute("normal",new Ti(o,3)),this.setAttribute("uv",new Ti(l,2))}static fromJSON(t){return new Nl(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class kl extends Di{constructor(t=1,e=.4,i=64,n=8,s=2,r=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:s,q:r},i=Math.floor(i),n=Math.floor(n);const a=[],o=[],l=[],h=[],c=new Wt,u=new Wt,d=new Wt,p=new Wt,m=new Wt,f=new Wt,g=new Wt;for(let a=0;a<=i;++a){const x=a/i*s*Math.PI*2;v(x,s,r,t,d),v(x+.01,s,r,t,p),f.subVectors(p,d),g.addVectors(p,d),m.crossVectors(f,g),g.crossVectors(m,f),m.normalize(),g.normalize();for(let t=0;t<=n;++t){const s=t/n*Math.PI*2,r=-e*Math.cos(s),p=e*Math.sin(s);c.x=d.x+(r*g.x+p*m.x),c.y=d.y+(r*g.y+p*m.y),c.z=d.z+(r*g.z+p*m.z),o.push(c.x,c.y,c.z),u.subVectors(c,d).normalize(),l.push(u.x,u.y,u.z),h.push(a/i),h.push(t/n)}}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*(t-1)+(e-1),s=(n+1)*t+(e-1),r=(n+1)*t+e,o=(n+1)*(t-1)+e;a.push(i,s,o),a.push(s,r,o)}function v(t,e,i,n,s){const r=Math.cos(t),a=Math.sin(t),o=i/e*t,l=Math.cos(o);s.x=n*(2+l)*.5*r,s.y=n*(2+l)*a*.5,s.z=n*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new Ti(o,3)),this.setAttribute("normal",new Ti(l,3)),this.setAttribute("uv",new Ti(h,2))}static fromJSON(t){return new kl(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class zl extends Di{constructor(t=new Xo(new Wt(-1,-1,0),new Wt(-1,1,0),new Wt(1,1,0)),e=64,i=1,n=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:s};const r=t.computeFrenetFrames(e,s);this.tangents=r.tangents,this.normals=r.normals,this.binormals=r.binormals;const a=new Wt,o=new Wt,l=new Et;let h=new Wt;const c=[],u=[],d=[],p=[];function m(s){h=t.getPointAt(s/e,h);const l=r.normals[s],d=r.binormals[s];for(let t=0;t<=n;t++){const e=t/n*Math.PI*2,s=Math.sin(e),r=-Math.cos(e);o.x=r*l.x+s*d.x,o.y=r*l.y+s*d.y,o.z=r*l.z+s*d.z,o.normalize(),u.push(o.x,o.y,o.z),a.x=h.x+i*o.x,a.y=h.y+i*o.y,a.z=h.z+i*o.z,c.push(a.x,a.y,a.z)}}!function(){for(let t=0;t<e;t++)m(t);m(!1===s?e:0),function(){for(let t=0;t<=e;t++)for(let i=0;i<=n;i++)l.x=t/e,l.y=i/n,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=n;e++){const i=(n+1)*(t-1)+(e-1),s=(n+1)*t+(e-1),r=(n+1)*t+e,a=(n+1)*(t-1)+e;p.push(i,s,a),p.push(s,r,a)}}()}(),this.setIndex(p),this.setAttribute("position",new Ti(c,3)),this.setAttribute("normal",new Ti(u,3)),this.setAttribute("uv",new Ti(d,2))}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new zl((new qo[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class Ul extends Di{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],i=new Set,n=new Wt,s=new Wt;if(null!==t.index){const r=t.attributes.position,a=t.index;let o=t.groups;0===o.length&&(o=[{start:0,count:a.count,materialIndex:0}]);for(let t=0,l=o.length;t<l;++t){const l=o[t],h=l.start;for(let t=h,o=h+l.count;t<o;t+=3)for(let o=0;o<3;o++){const l=a.getX(t+o),h=a.getX(t+(o+1)%3);n.fromBufferAttribute(r,l),s.fromBufferAttribute(r,h),!0===Ol(n,s,i)&&(e.push(n.x,n.y,n.z),e.push(s.x,s.y,s.z))}}}else{const r=t.attributes.position;for(let t=0,a=r.count/3;t<a;t++)for(let a=0;a<3;a++){const o=3*t+a,l=3*t+(a+1)%3;n.fromBufferAttribute(r,o),s.fromBufferAttribute(r,l),!0===Ol(n,s,i)&&(e.push(n.x,n.y,n.z),e.push(s.x,s.y,s.z))}}this.setAttribute("position",new Ti(e,3))}}}function Ol(t,e,i){const n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,s=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==i.has(n)&&!0!==i.has(s)&&(i.add(n,s),!0)}var Bl=Object.freeze({__proto__:null,BoxGeometry:tn,BoxBufferGeometry:tn,CircleGeometry:yo,CircleBufferGeometry:yo,ConeGeometry:wo,ConeBufferGeometry:wo,CylinderGeometry:bo,CylinderBufferGeometry:bo,DodecahedronGeometry:Mo,DodecahedronBufferGeometry:Mo,EdgesGeometry:Lo,ExtrudeGeometry:Al,ExtrudeBufferGeometry:Al,IcosahedronGeometry:Ll,IcosahedronBufferGeometry:Ll,LatheGeometry:Cl,LatheBufferGeometry:Cl,OctahedronGeometry:Pl,OctahedronBufferGeometry:Pl,PlaneGeometry:wn,PlaneBufferGeometry:wn,PolyhedronGeometry:_o,PolyhedronBufferGeometry:_o,RingGeometry:Rl,RingBufferGeometry:Rl,ShapeGeometry:Fl,ShapeBufferGeometry:Fl,SphereGeometry:Il,SphereBufferGeometry:Il,TetrahedronGeometry:Dl,TetrahedronBufferGeometry:Dl,TorusGeometry:Nl,TorusBufferGeometry:Nl,TorusKnotGeometry:kl,TorusKnotBufferGeometry:kl,TubeGeometry:zl,TubeBufferGeometry:zl,WireframeGeometry:Ul});class Hl extends ri{constructor(t){super(),this.type="ShadowMaterial",this.color=new di(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}Hl.prototype.isShadowMaterial=!0;class Gl extends ri{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new di(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new di(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Et(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}Gl.prototype.isMeshStandardMaterial=!0;class Vl extends Gl{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Et(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return bt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenTint=new di(0),this.sheenRoughness=1,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationTint=new di(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularTint=new di(1,1,1),this.specularTintMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenTint.copy(t.sheenTint),this.sheenRoughness=t.sheenRoughness,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationTint.copy(t.attenuationTint),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularTint.copy(t.specularTint),this.specularTintMap=t.specularTintMap,this}}Vl.prototype.isMeshPhysicalMaterial=!0;class Wl extends ri{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new di(16777215),this.specular=new di(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new di(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Et(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}Wl.prototype.isMeshPhongMaterial=!0;class jl extends ri{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new di(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new di(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Et(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}jl.prototype.isMeshToonMaterial=!0;class Xl extends ri{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Et(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}Xl.prototype.isMeshNormalMaterial=!0;class Yl extends ri{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new di(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new di(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}Yl.prototype.isMeshLambertMaterial=!0;class ql extends ri{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new di(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Et(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}}ql.prototype.isMeshMatcapMaterial=!0;class Ql extends Za{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}Ql.prototype.isLineDashedMaterial=!0;var Zl=Object.freeze({__proto__:null,ShadowMaterial:Hl,SpriteMaterial:ma,RawShaderMaterial:Fn,ShaderMaterial:rn,PointsMaterial:oo,MeshPhysicalMaterial:Vl,MeshStandardMaterial:Gl,MeshPhongMaterial:Wl,MeshToonMaterial:jl,MeshNormalMaterial:Xl,MeshLambertMaterial:Yl,MeshDepthMaterial:qr,MeshDistanceMaterial:Qr,MeshBasicMaterial:pi,MeshMatcapMaterial:ql,LineDashedMaterial:Ql,LineBasicMaterial:Za,Material:ri});const Jl={arraySlice:function(t,e,i){return Jl.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,i=new Array(e);for(let t=0;t!==e;++t)i[t]=t;return i.sort((function(e,i){return t[e]-t[i]})),i},sortedArray:function(t,e,i){const n=t.length,s=new t.constructor(n);for(let r=0,a=0;a!==n;++r){const n=i[r]*e;for(let i=0;i!==e;++i)s[a++]=t[n+i]}return s},flattenJSON:function(t,e,i,n){let s=1,r=t[0];for(;void 0!==r&&void 0===r[n];)r=t[s++];if(void 0===r)return;let a=r[n];if(void 0!==a)if(Array.isArray(a))do{a=r[n],void 0!==a&&(e.push(r.time),i.push.apply(i,a)),r=t[s++]}while(void 0!==r);else if(void 0!==a.toArray)do{a=r[n],void 0!==a&&(e.push(r.time),a.toArray(i,i.length)),r=t[s++]}while(void 0!==r);else do{a=r[n],void 0!==a&&(e.push(r.time),i.push(a)),r=t[s++]}while(void 0!==r)},subclip:function(t,e,i,n,s=30){const r=t.clone();r.name=e;const a=[];for(let t=0;t<r.tracks.length;++t){const e=r.tracks[t],o=e.getValueSize(),l=[],h=[];for(let t=0;t<e.times.length;++t){const r=e.times[t]*s;if(!(r<i||r>=n)){l.push(e.times[t]);for(let i=0;i<o;++i)h.push(e.values[t*o+i])}}0!==l.length&&(e.times=Jl.convertArray(l,e.times.constructor),e.values=Jl.convertArray(h,e.values.constructor),a.push(e))}r.tracks=a;let o=1/0;for(let t=0;t<r.tracks.length;++t)o>r.tracks[t].times[0]&&(o=r.tracks[t].times[0]);for(let t=0;t<r.tracks.length;++t)r.tracks[t].shift(-1*o);return r.resetDuration(),r},makeClipAdditive:function(t,e=0,i=t,n=30){n<=0&&(n=30);const s=i.tracks.length,r=e/n;for(let e=0;e<s;++e){const n=i.tracks[e],s=n.ValueTypeName;if("bool"===s||"string"===s)continue;const a=t.tracks.find((function(t){return t.name===n.name&&t.ValueTypeName===s}));if(void 0===a)continue;let o=0;const l=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let h=0;const c=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=c/3);const u=n.times.length-1;let d;if(r<=n.times[0]){const t=o,e=l-o;d=Jl.arraySlice(n.values,t,e)}else if(r>=n.times[u]){const t=u*l+o,e=t+l-o;d=Jl.arraySlice(n.values,t,e)}else{const t=n.createInterpolant(),e=o,i=l-o;t.evaluate(r),d=Jl.arraySlice(t.resultBuffer,e,i)}if("quaternion"===s){(new Vt).fromArray(d).normalize().conjugate().toArray(d)}const p=a.times.length;for(let t=0;t<p;++t){const e=t*c+h;if("quaternion"===s)Vt.multiplyQuaternionsFlat(a.values,e,d,0,a.values,e);else{const t=c-2*h;for(let i=0;i<t;++i)a.values[e+i]-=d[i]}}}return t.blendMode=tt,t}};class Kl{constructor(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,n=e[i],s=e[i-1];t:{e:{let r;i:{n:if(!(t<n)){for(let r=i+2;;){if(void 0===n){if(t<s)break n;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,s)}if(i===r)break;if(s=n,n=e[++i],t<n)break e}r=e.length;break i}if(t>=s)break t;{const a=e[1];t<a&&(i=2,s=a);for(let r=i-2;;){if(void 0===s)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===r)break;if(n=s,s=e[--i-1],t>=s)break e}r=i,i=0}}for(;i<r;){const n=i+r>>>1;t<e[n]?r=n:i=n+1}if(n=e[i],s=e[i-1],void 0===s)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,s,t)}this._cachedIndex=i,this.intervalChanged_(i,s,n)}return this.interpolate_(i,s,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=t*n;for(let t=0;t!==n;++t)e[t]=i[s+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Kl.prototype.beforeStart_=Kl.prototype.copySampleValue_,Kl.prototype.afterEnd_=Kl.prototype.copySampleValue_;class $l extends Kl{constructor(t,e,i,n){super(t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Z,endingEnd:Z}}intervalChanged_(t,e,i){const n=this.parameterPositions;let s=t-2,r=t+1,a=n[s],o=n[r];if(void 0===a)switch(this.getSettings_().endingStart){case J:s=t,a=2*e-i;break;case K:s=n.length-2,a=e+n[s]-n[s+1];break;default:s=t,a=i}if(void 0===o)switch(this.getSettings_().endingEnd){case J:r=t,o=2*i-e;break;case K:r=1,o=i+n[1]-n[0];break;default:r=t-1,o=e}const l=.5*(i-e),h=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(o-i),this._offsetPrev=s*h,this._offsetNext=r*h}interpolate_(t,e,i,n){const s=this.resultBuffer,r=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,h=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-e)/(n-e),m=p*p,f=m*p,g=-u*f+2*u*m-u*p,v=(1+u)*f+(-1.5-2*u)*m+(-.5+u)*p+1,x=(-1-d)*f+(1.5+d)*m+.5*p,y=d*f-d*m;for(let t=0;t!==a;++t)s[t]=g*r[h+t]+v*r[l+t]+x*r[o+t]+y*r[c+t];return s}}class th extends Kl{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const s=this.resultBuffer,r=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,h=(i-e)/(n-e),c=1-h;for(let t=0;t!==a;++t)s[t]=r[l+t]*c+r[o+t]*h;return s}}class eh extends Kl{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class ih{constructor(t,e,i,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Jl.convertArray(e,this.TimeBufferType),this.values=Jl.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:Jl.convertArray(t.times,Array),values:Jl.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(i.interpolation=e)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new eh(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new th(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new $l(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Y:e=this.InterpolantFactoryMethodDiscrete;break;case q:e=this.InterpolantFactoryMethodLinear;break;case Q:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Y;case this.InterpolantFactoryMethodLinear:return q;case this.InterpolantFactoryMethodSmooth:return Q}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this}trim(t,e){const i=this.times,n=i.length;let s=0,r=n-1;for(;s!==n&&i[s]<t;)++s;for(;-1!==r&&i[r]>e;)--r;if(++r,0!==s||r!==n){s>=r&&(r=Math.max(r,1),s=r-1);const t=this.getValueSize();this.times=Jl.arraySlice(i,s,r),this.values=Jl.arraySlice(this.values,s*t,r*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,n=this.values,s=i.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let r=null;for(let e=0;e!==s;e++){const n=i[e];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,n),t=!1;break}if(null!==r&&r>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,n,r),t=!1;break}r=n}if(void 0!==n&&Jl.isTypedArray(n))for(let e=0,i=n.length;e!==i;++e){const i=n[e];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,i),t=!1;break}}return t}optimize(){const t=Jl.arraySlice(this.times),e=Jl.arraySlice(this.values),i=this.getValueSize(),n=this.getInterpolation()===Q,s=t.length-1;let r=1;for(let a=1;a<s;++a){let s=!1;const o=t[a];if(o!==t[a+1]&&(1!==a||o!==t[0]))if(n)s=!0;else{const t=a*i,n=t-i,r=t+i;for(let a=0;a!==i;++a){const i=e[t+a];if(i!==e[n+a]||i!==e[r+a]){s=!0;break}}}if(s){if(a!==r){t[r]=t[a];const n=a*i,s=r*i;for(let t=0;t!==i;++t)e[s+t]=e[n+t]}++r}}if(s>0){t[r]=t[s];for(let t=s*i,n=r*i,a=0;a!==i;++a)e[n+a]=e[t+a];++r}return r!==t.length?(this.times=Jl.arraySlice(t,0,r),this.values=Jl.arraySlice(e,0,r*i)):(this.times=t,this.values=e),this}clone(){const t=Jl.arraySlice(this.times,0),e=Jl.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}ih.prototype.TimeBufferType=Float32Array,ih.prototype.ValueBufferType=Float32Array,ih.prototype.DefaultInterpolation=q;class nh extends ih{}nh.prototype.ValueTypeName="bool",nh.prototype.ValueBufferType=Array,nh.prototype.DefaultInterpolation=Y,nh.prototype.InterpolantFactoryMethodLinear=void 0,nh.prototype.InterpolantFactoryMethodSmooth=void 0;class sh extends ih{}sh.prototype.ValueTypeName="color";class rh extends ih{}rh.prototype.ValueTypeName="number";class ah extends Kl{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const s=this.resultBuffer,r=this.sampleValues,a=this.valueSize,o=(i-e)/(n-e);let l=t*a;for(let t=l+a;l!==t;l+=4)Vt.slerpFlat(s,0,r,l-a,r,l,o);return s}}class oh extends ih{InterpolantFactoryMethodLinear(t){return new ah(this.times,this.values,this.getValueSize(),t)}}oh.prototype.ValueTypeName="quaternion",oh.prototype.DefaultInterpolation=q,oh.prototype.InterpolantFactoryMethodSmooth=void 0;class lh extends ih{}lh.prototype.ValueTypeName="string",lh.prototype.ValueBufferType=Array,lh.prototype.DefaultInterpolation=Y,lh.prototype.InterpolantFactoryMethodLinear=void 0,lh.prototype.InterpolantFactoryMethodSmooth=void 0;class hh extends ih{}hh.prototype.ValueTypeName="vector";class ch{constructor(t,e=-1,i,n=2500){this.name=t,this.tracks=i,this.duration=e,this.blendMode=n,this.uuid=yt(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,n=1/(t.fps||1);for(let t=0,s=i.length;t!==s;++t)e.push(uh(i[t]).scale(n));const s=new this(t.name,t.duration,e,t.blendMode);return s.uuid=t.uuid,s}static toJSON(t){const e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,n=i.length;t!==n;++t)e.push(ih.toJSON(i[t]));return n}static CreateFromMorphTargetSequence(t,e,i,n){const s=e.length,r=[];for(let t=0;t<s;t++){let a=[],o=[];a.push((t+s-1)%s,t,(t+1)%s),o.push(0,1,0);const l=Jl.getKeyframeOrder(a);a=Jl.sortedArray(a,1,l),o=Jl.sortedArray(o,1,l),n||0!==a[0]||(a.push(s),o.push(o[0])),r.push(new rh(".morphTargetInfluences["+e[t].name+"]",a,o).scale(1/i))}return new this(t,-1,r)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const n={},s=/^([\w-]*?)([\d]+)$/;for(let e=0,i=t.length;e<i;e++){const i=t[e],r=i.name.match(s);if(r&&r.length>1){const t=r[1];let e=n[t];e||(n[t]=e=[]),e.push(i)}}const r=[];for(const t in n)r.push(this.CreateFromMorphTargetSequence(t,n[t],e,i));return r}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(t,e,i,n,s){if(0!==i.length){const r=[],a=[];Jl.flattenJSON(i,r,a,n),0!==r.length&&s.push(new t(e,r,a))}},n=[],s=t.name||"default",r=t.fps||30,a=t.blendMode;let o=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const s=l[t].keys;if(s&&0!==s.length)if(s[0].morphTargets){const t={};let e;for(e=0;e<s.length;e++)if(s[e].morphTargets)for(let i=0;i<s[e].morphTargets.length;i++)t[s[e].morphTargets[i]]=-1;for(const i in t){const t=[],r=[];for(let n=0;n!==s[e].morphTargets.length;++n){const n=s[e];t.push(n.time),r.push(n.morphTarget===i?1:0)}n.push(new rh(".morphTargetInfluence["+i+"]",t,r))}o=t.length*(r||1)}else{const r=".bones["+e[t].name+"]";i(hh,r+".position",s,"pos",n),i(oh,r+".quaternion",s,"rot",n),i(hh,r+".scale",s,"scl",n)}}if(0===n.length)return null;return new this(s,o,n,a)}resetDuration(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function uh(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return rh;case"vector":case"vector2":case"vector3":case"vector4":return hh;case"color":return sh;case"quaternion":return oh;case"bool":case"boolean":return nh;case"string":return lh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],i=[];Jl.flattenJSON(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const dh={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class ph{constructor(t,e,i){const n=this;let s,r=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){o++,!1===r&&void 0!==n.onStart&&n.onStart(t,a,o),r=!0},this.itemEnd=function(t){a++,void 0!==n.onProgress&&n.onProgress(t,a,o),a===o&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=l.length;e<i;e+=2){const i=l[e],n=l[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return n}return null}}}const mh=new ph;class fh{constructor(t){this.manager=void 0!==t?t:mh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise((function(n,s){i.load(t,n,e,s)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const gh={};class vh extends fh{constructor(t){super(t)}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const s=dh.get(t);if(void 0!==s)return this.manager.itemStart(t),setTimeout((()=>{e&&e(s),this.manager.itemEnd(t)}),0),s;if(void 0!==gh[t])return void gh[t].push({onLoad:e,onProgress:i,onError:n});gh[t]=[],gh[t].push({onLoad:e,onProgress:i,onError:n});const r=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});fetch(r).then((e=>{if(200===e.status||0===e.status){0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");const i=gh[t],n=e.body.getReader(),s=e.headers.get("Content-Length"),r=s?parseInt(s):0,a=0!==r;let o=0;return new ReadableStream({start(t){!function e(){n.read().then((({done:n,value:s})=>{if(n)t.close();else{o+=s.byteLength;const n=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:r});for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onProgress&&e.onProgress(n)}t.enqueue(s),e()}}))}()}})}throw Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`)})).then((t=>{const e=new Response(t);switch(this.responseType){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((t=>(new DOMParser).parseFromString(t,this.mimeType)));case"json":return e.json();default:return e.text()}})).then((e=>{dh.add(t,e);const i=gh[t];delete gh[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onLoad&&n.onLoad(e)}this.manager.itemEnd(t)})).catch((e=>{const i=gh[t];delete gh[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}this.manager.itemError(t),this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class xh extends fh{constructor(t){super(t)}load(t,e,i,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,r=dh.get(t);if(void 0!==r)return s.manager.itemStart(t),setTimeout((function(){e&&e(r),s.manager.itemEnd(t)}),0),r;const a=Ft("img");function o(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1),dh.add(t,this),e&&e(this),s.manager.itemEnd(t)}function l(e){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1),n&&n(e),s.manager.itemError(t),s.manager.itemEnd(t)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(t),a.src=t,a}}class yh extends fh{constructor(t){super(t)}load(t,e,i,n){const s=new cn,r=new xh(this.manager);r.setCrossOrigin(this.crossOrigin),r.setPath(this.path);let a=0;function o(i){r.load(t[i],(function(t){s.images[i]=t,a++,6===a&&(s.needsUpdate=!0,e&&e(s))}),void 0,n)}for(let e=0;e<t.length;++e)o(e);return s}}class bh extends fh{constructor(t){super(t)}load(t,e,i,n){const s=this,r=new Ba,a=new vh(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(s.withCredentials),a.load(t,(function(t){const i=s.parse(t);i&&(void 0!==i.image?r.image=i.image:void 0!==i.data&&(r.image.width=i.width,r.image.height=i.height,r.image.data=i.data),r.wrapS=void 0!==i.wrapS?i.wrapS:x,r.wrapT=void 0!==i.wrapT?i.wrapT:x,r.magFilter=void 0!==i.magFilter?i.magFilter:M,r.minFilter=void 0!==i.minFilter?i.minFilter:M,r.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.encoding&&(r.encoding=i.encoding),void 0!==i.flipY&&(r.flipY=i.flipY),void 0!==i.format&&(r.format=i.format),void 0!==i.type&&(r.type=i.type),void 0!==i.mipmaps&&(r.mipmaps=i.mipmaps,r.minFilter=T),1===i.mipmapCount&&(r.minFilter=M),void 0!==i.generateMipmaps&&(r.generateMipmaps=i.generateMipmaps),r.needsUpdate=!0,e&&e(r,i))}),i,n),r}}class wh extends fh{constructor(t){super(t)}load(t,e,i,n){const s=new zt,r=new xh(this.manager);return r.setCrossOrigin(this.crossOrigin),r.setPath(this.path),r.load(t,(function(t){s.image=t,s.needsUpdate=!0,void 0!==e&&e(s)}),i,n),s}}class _h extends Xe{constructor(t,e=1){super(),this.type="Light",this.color=new di(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}_h.prototype.isLight=!0;class Mh extends _h{constructor(t,e,i){super(t,i),this.type="HemisphereLight",this.position.copy(Xe.DefaultUp),this.updateMatrix(),this.groundColor=new di(e)}copy(t){return _h.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}Mh.prototype.isHemisphereLight=!0;const Sh=new we,Th=new Wt,Ah=new Wt;class Eh{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Et(512,512),this.map=null,this.mapPass=null,this.matrix=new we,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new xn,this._frameExtents=new Et(1,1),this._viewportCount=1,this._viewports=[new Ot(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;Th.setFromMatrixPosition(t.matrixWorld),e.position.copy(Th),Ah.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Ah),e.updateMatrixWorld(),Sh.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Sh),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(e.projectionMatrix),i.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Lh extends Eh{constructor(){super(new on(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,i=2*gt*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=t.distance||e.far;i===e.fov&&n===e.aspect&&s===e.far||(e.fov=i,e.aspect=n,e.far=s,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}Lh.prototype.isSpotLightShadow=!0;class Ch extends _h{constructor(t,e,i=0,n=Math.PI/3,s=0,r=1){super(t,e),this.type="SpotLight",this.position.copy(Xe.DefaultUp),this.updateMatrix(),this.target=new Xe,this.distance=i,this.angle=n,this.penumbra=s,this.decay=r,this.shadow=new Lh}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Ch.prototype.isSpotLight=!0;const Ph=new we,Rh=new Wt,Fh=new Wt;class Ih extends Eh{constructor(){super(new on(90,1,.5,500)),this._frameExtents=new Et(4,2),this._viewportCount=6,this._viewports=[new Ot(2,1,1,1),new Ot(0,1,1,1),new Ot(3,1,1,1),new Ot(1,1,1,1),new Ot(3,0,1,1),new Ot(1,0,1,1)],this._cubeDirections=[new Wt(1,0,0),new Wt(-1,0,0),new Wt(0,0,1),new Wt(0,0,-1),new Wt(0,1,0),new Wt(0,-1,0)],this._cubeUps=[new Wt(0,1,0),new Wt(0,1,0),new Wt(0,1,0),new Wt(0,1,0),new Wt(0,0,1),new Wt(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,n=this.matrix,s=t.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),Rh.setFromMatrixPosition(t.matrixWorld),i.position.copy(Rh),Fh.copy(i.position),Fh.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(Fh),i.updateMatrixWorld(),n.makeTranslation(-Rh.x,-Rh.y,-Rh.z),Ph.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ph)}}Ih.prototype.isPointLightShadow=!0;class Dh extends _h{constructor(t,e,i=0,n=1){super(t,e),this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new Ih}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}Dh.prototype.isPointLight=!0;class Nh extends Eh{constructor(){super(new Rn(-5,5,5,-5,.5,500))}}Nh.prototype.isDirectionalLightShadow=!0;class kh extends _h{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(Xe.DefaultUp),this.updateMatrix(),this.target=new Xe,this.shadow=new Nh}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}kh.prototype.isDirectionalLight=!0;class zh extends _h{constructor(t,e){super(t,e),this.type="AmbientLight"}}zh.prototype.isAmbientLight=!0;class Uh extends _h{constructor(t,e,i=10,n=10){super(t,e),this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}Uh.prototype.isRectAreaLight=!0;class Oh{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Wt)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const i=t.x,n=t.y,s=t.z,r=this.coefficients;return e.copy(r[0]).multiplyScalar(.282095),e.addScaledVector(r[1],.488603*n),e.addScaledVector(r[2],.488603*s),e.addScaledVector(r[3],.488603*i),e.addScaledVector(r[4],i*n*1.092548),e.addScaledVector(r[5],n*s*1.092548),e.addScaledVector(r[6],.315392*(3*s*s-1)),e.addScaledVector(r[7],i*s*1.092548),e.addScaledVector(r[8],.546274*(i*i-n*n)),e}getIrradianceAt(t,e){const i=t.x,n=t.y,s=t.z,r=this.coefficients;return e.copy(r[0]).multiplyScalar(.886227),e.addScaledVector(r[1],1.023328*n),e.addScaledVector(r[2],1.023328*s),e.addScaledVector(r[3],1.023328*i),e.addScaledVector(r[4],.858086*i*n),e.addScaledVector(r[5],.858086*n*s),e.addScaledVector(r[6],.743125*s*s-.247708),e.addScaledVector(r[7],.858086*i*s),e.addScaledVector(r[8],.429043*(i*i-n*n)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(t,e+3*n);return this}toArray(t=[],e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(t,e+3*n);return t}static getBasisAt(t,e){const i=t.x,n=t.y,s=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*s,e[3]=.488603*i,e[4]=1.092548*i*n,e[5]=1.092548*n*s,e[6]=.315392*(3*s*s-1),e[7]=1.092548*i*s,e[8]=.546274*(i*i-n*n)}}Oh.prototype.isSphericalHarmonics3=!0;class Bh extends _h{constructor(t=new Oh,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}Bh.prototype.isLightProbe=!0;class Hh extends fh{constructor(t){super(t),this.textures={}}load(t,e,i,n){const s=this,r=new vh(s.manager);r.setPath(s.path),r.setRequestHeader(s.requestHeader),r.setWithCredentials(s.withCredentials),r.load(t,(function(i){try{e(s.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),s.manager.itemError(t)}}),i,n)}parse(t){const e=this.textures;function i(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const n=new Zl[t.type];if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&void 0!==n.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.sheen&&(n.sheen=t.sheen),void 0!==t.sheenTint&&(n.sheenTint=(new di).setHex(t.sheenTint)),void 0!==t.sheenRoughness&&(n.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==n.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==n.specular&&n.specular.setHex(t.specular),void 0!==t.specularIntensity&&(n.specularIntensity=t.specularIntensity),void 0!==t.specularTint&&void 0!==n.specularTint&&n.specularTint.setHex(t.specularTint),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearcoat&&(n.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(n.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.transmission&&(n.transmission=t.transmission),void 0!==t.thickness&&(n.thickness=t.thickness),void 0!==t.attenuationDistance&&(n.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationTint&&void 0!==n.attenuationTint&&n.attenuationTint.setHex(t.attenuationTint),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.combine&&(n.combine=t.combine),void 0!==t.side&&(n.side=t.side),void 0!==t.shadowSide&&(n.shadowSide=t.shadowSide),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.format&&(n.format=t.format),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(n.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(n.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(n.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(n.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(n.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(n.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(n.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(n.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.alphaToCoverage&&(n.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(n.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.toneMapped&&(n.toneMapped=t.toneMapped),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?n.vertexColors=t.vertexColors>0:n.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const s=t.uniforms[e];switch(n.uniforms[e]={},s.type){case"t":n.uniforms[e].value=i(s.value);break;case"c":n.uniforms[e].value=(new di).setHex(s.value);break;case"v2":n.uniforms[e].value=(new Et).fromArray(s.value);break;case"v3":n.uniforms[e].value=(new Wt).fromArray(s.value);break;case"v4":n.uniforms[e].value=(new Ot).fromArray(s.value);break;case"m3":n.uniforms[e].value=(new Lt).fromArray(s.value);break;case"m4":n.uniforms[e].value=(new we).fromArray(s.value);break;default:n.uniforms[e].value=s.value}}if(void 0!==t.defines&&(n.defines=t.defines),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)n.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=i(t.map)),void 0!==t.matcap&&(n.matcap=i(t.matcap)),void 0!==t.alphaMap&&(n.alphaMap=i(t.alphaMap)),void 0!==t.bumpMap&&(n.bumpMap=i(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=i(t.normalMap)),void 0!==t.normalMapType&&(n.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),n.normalScale=(new Et).fromArray(e)}return void 0!==t.displacementMap&&(n.displacementMap=i(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=i(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=i(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=i(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=i(t.specularMap)),void 0!==t.specularIntensityMap&&(n.specularIntensityMap=i(t.specularIntensityMap)),void 0!==t.specularTintMap&&(n.specularTintMap=i(t.specularTintMap)),void 0!==t.envMap&&(n.envMap=i(t.envMap)),void 0!==t.envMapIntensity&&(n.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(n.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(n.lightMap=i(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=i(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=i(t.gradientMap)),void 0!==t.clearcoatMap&&(n.clearcoatMap=i(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=i(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(n.clearcoatNormalMap=i(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Et).fromArray(t.clearcoatNormalScale)),void 0!==t.transmissionMap&&(n.transmissionMap=i(t.transmissionMap)),void 0!==t.thicknessMap&&(n.thicknessMap=i(t.thicknessMap)),n}setTextures(t){return this.textures=t,this}}class Gh{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,n=t.length;i<n;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}}class Vh extends Di{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}Vh.prototype.isInstancedBufferGeometry=!0;class Wh extends fh{constructor(t){super(t)}load(t,e,i,n){const s=this,r=new vh(s.manager);r.setPath(s.path),r.setRequestHeader(s.requestHeader),r.setWithCredentials(s.withCredentials),r.load(t,(function(i){try{e(s.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),s.manager.itemError(t)}}),i,n)}parse(t){const e={},i={};function n(t,n){if(void 0!==e[n])return e[n];const s=t.interleavedBuffers[n],r=function(t,e){if(void 0!==i[e])return i[e];const n=t.arrayBuffers[e],s=new Uint32Array(n).buffer;return i[e]=s,s}(t,s.buffer),a=Rt(s.type,r),o=new ua(a,s.stride);return o.uuid=s.uuid,e[n]=o,o}const s=t.isInstancedBufferGeometry?new Vh:new Di,r=t.data.index;if(void 0!==r){const t=Rt(r.type,r.array);s.setIndex(new gi(t,1))}const a=t.data.attributes;for(const e in a){const i=a[e];let r;if(i.isInterleavedBufferAttribute){const e=n(t.data,i.data);r=new pa(e,i.itemSize,i.offset,i.normalized)}else{const t=Rt(i.type,i.array);r=new(i.isInstancedBufferAttribute?Wa:gi)(t,i.itemSize,i.normalized)}void 0!==i.name&&(r.name=i.name),void 0!==i.usage&&r.setUsage(i.usage),void 0!==i.updateRange&&(r.updateRange.offset=i.updateRange.offset,r.updateRange.count=i.updateRange.count),s.setAttribute(e,r)}const o=t.data.morphAttributes;if(o)for(const e in o){const i=o[e],r=[];for(let e=0,s=i.length;e<s;e++){const s=i[e];let a;if(s.isInterleavedBufferAttribute){const e=n(t.data,s.data);a=new pa(e,s.itemSize,s.offset,s.normalized)}else{const t=Rt(s.type,s.array);a=new gi(t,s.itemSize,s.normalized)}void 0!==s.name&&(a.name=s.name),r.push(a)}s.morphAttributes[e]=r}t.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let t=0,e=l.length;t!==e;++t){const e=l[t];s.addGroup(e.start,e.count,e.materialIndex)}const h=t.data.boundingSphere;if(void 0!==h){const t=new Wt;void 0!==h.center&&t.fromArray(h.center),s.boundingSphere=new de(t,h.radius)}return t.name&&(s.name=t.name),t.userData&&(s.userData=t.userData),s}}const jh={UVMapping:c,CubeReflectionMapping:u,CubeRefractionMapping:d,EquirectangularReflectionMapping:p,EquirectangularRefractionMapping:m,CubeUVReflectionMapping:f,CubeUVRefractionMapping:g},Xh={RepeatWrapping:v,ClampToEdgeWrapping:x,MirroredRepeatWrapping:y},Yh={NearestFilter:b,NearestMipmapNearestFilter:w,NearestMipmapLinearFilter:_,LinearFilter:M,LinearMipmapNearestFilter:S,LinearMipmapLinearFilter:T};class qh extends fh{constructor(t){super(t),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,r=dh.get(t);if(void 0!==r)return s.manager.itemStart(t),setTimeout((function(){e&&e(r),s.manager.itemEnd(t)}),0),r;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(t,a).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(s.options,{colorSpaceConversion:"none"}))})).then((function(i){dh.add(t,i),e&&e(i),s.manager.itemEnd(t)})).catch((function(e){n&&n(e),s.manager.itemError(t),s.manager.itemEnd(t)})),s.manager.itemStart(t)}}let Qh;qh.prototype.isImageBitmapLoader=!0;const Zh={getContext:function(){return void 0===Qh&&(Qh=new(window.AudioContext||window.webkitAudioContext)),Qh},setContext:function(t){Qh=t}};class Jh extends fh{constructor(t){super(t)}load(t,e,i,n){const s=this,r=new vh(this.manager);r.setResponseType("arraybuffer"),r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(t,(function(i){try{const t=i.slice(0);Zh.getContext().decodeAudioData(t,(function(t){e(t)}))}catch(e){n?n(e):console.error(e),s.manager.itemError(t)}}),i,n)}}class Kh extends Bh{constructor(t,e,i=1){super(void 0,i);const n=(new di).set(t),s=(new di).set(e),r=new Wt(n.r,n.g,n.b),a=new Wt(s.r,s.g,s.b),o=Math.sqrt(Math.PI),l=o*Math.sqrt(.75);this.sh.coefficients[0].copy(r).add(a).multiplyScalar(o),this.sh.coefficients[1].copy(r).sub(a).multiplyScalar(l)}}Kh.prototype.isHemisphereLightProbe=!0;class $h extends Bh{constructor(t,e=1){super(void 0,e);const i=(new di).set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}$h.prototype.isAmbientLightProbe=!0;const tc=new we,ec=new we;class ic{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=nc(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=nc();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function nc(){return("undefined"==typeof performance?Date:performance).now()}const sc=new Wt,rc=new Vt,ac=new Wt,oc=new Wt;class lc extends Xe{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const hc=new Wt,cc=new Vt,uc=new Wt,dc=new Wt;class pc{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let i=0;i<e.length;i++)t+=e[i];return t/e.length}}class mc{constructor(t,e,i){let n,s,r;switch(this.binding=t,this.valueSize=i,e){case"quaternion":n=this._slerp,s=this._slerpAdditive,r=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,r=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,s=this._lerpAdditive,r=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=r,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,n=this.valueSize,s=t*n+n;let r=this.cumulativeWeight;if(0===r){for(let t=0;t!==n;++t)i[s+t]=i[t];r=e}else{r+=e;const t=e/r;this._mixBufferRegion(i,s,0,t,n)}this.cumulativeWeight=r}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,n=t*e+e,s=this.cumulativeWeight,r=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const t=e*this._origIndex;this._mixBufferRegion(i,n,t,1-s,e)}r>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*e,1,e);for(let t=e,s=e+e;t!==s;++t)if(i[t]!==i[t+e]){a.setValue(i,n);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,n=i*this._origIndex;t.getValue(e,n);for(let t=i,s=n;t!==s;++t)e[t]=e[n+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,n,s){if(n>=.5)for(let n=0;n!==s;++n)t[e+n]=t[i+n]}_slerp(t,e,i,n){Vt.slerpFlat(t,e,t,e,t,i,n)}_slerpAdditive(t,e,i,n,s){const r=this._workIndex*s;Vt.multiplyQuaternionsFlat(t,r,t,e,t,i),Vt.slerpFlat(t,e,t,e,t,r,n)}_lerp(t,e,i,n,s){const r=1-n;for(let a=0;a!==s;++a){const s=e+a;t[s]=t[s]*r+t[i+a]*n}}_lerpAdditive(t,e,i,n,s){for(let r=0;r!==s;++r){const s=e+r;t[s]=t[s]+t[i+r]*n}}}const fc="\\[\\]\\.:\\/",gc=new RegExp("[\\[\\]\\.:\\/]","g"),vc="[^\\[\\]\\.:\\/]",xc="[^"+fc.replace("\\.","")+"]",yc=/((?:WC+[\/:])*)/.source.replace("WC",vc),bc=/(WCOD+)?/.source.replace("WCOD",xc),wc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",vc),_c=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",vc),Mc=new RegExp("^"+yc+bc+wc+_c+"$"),Sc=["material","materials","bones"];class Tc{constructor(t,e,i){this.path=e,this.parsedPath=i||Tc.parseTrackName(e),this.node=Tc.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new Tc.Composite(t,e,i):new Tc(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(gc,"")}static parseTrackName(t){const e=Mc.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const t=i.nodeName.substring(n+1);-1!==Sc.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){const i=function(t){for(let n=0;n<t.length;n++){const s=t[n];if(s.name===e||s.uuid===e)return s;const r=i(s.children);if(r)return r}return null},n=i(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)t[e++]=i[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,n=e.propertyName;let s=e.propertyIndex;if(t||(t=Tc.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===n){n=e;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==n){if(void 0===t[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[n]}}const r=t[n];if(void 0===r){const i=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",t)}let a=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==s){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[s]&&(s=t.morphTargetDictionary[s])}o=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=s}else void 0!==r.fromArray&&void 0!==r.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(o=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=n;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Tc.Composite=class{constructor(t,e,i){const n=i||Tc.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=i.length;n!==s;++n)i[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},Tc.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Tc.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Tc.prototype.GetterByBindingType=[Tc.prototype._getValue_direct,Tc.prototype._getValue_array,Tc.prototype._getValue_arrayElement,Tc.prototype._getValue_toArray],Tc.prototype.SetterByBindingTypeAndVersioning=[[Tc.prototype._setValue_direct,Tc.prototype._setValue_direct_setNeedsUpdate,Tc.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Tc.prototype._setValue_array,Tc.prototype._setValue_array_setNeedsUpdate,Tc.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Tc.prototype._setValue_arrayElement,Tc.prototype._setValue_arrayElement_setNeedsUpdate,Tc.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Tc.prototype._setValue_fromArray,Tc.prototype._setValue_fromArray_setNeedsUpdate,Tc.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Ac{constructor(){this.uuid=yt(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,i=arguments.length;e!==i;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,i=this._paths,n=this._parsedPaths,s=this._bindings,r=s.length;let a,o=t.length,l=this.nCachedObjects_;for(let h=0,c=arguments.length;h!==c;++h){const c=arguments[h],u=c.uuid;let d=e[u];if(void 0===d){d=o++,e[u]=d,t.push(c);for(let t=0,e=r;t!==e;++t)s[t].push(new Tc(c,i[t],n[t]))}else if(d<l){a=t[d];const o=--l,h=t[o];e[h.uuid]=d,t[d]=h,e[u]=o,t[o]=c;for(let t=0,e=r;t!==e;++t){const e=s[t],r=e[o];let a=e[d];e[d]=r,void 0===a&&(a=new Tc(c,i[t],n[t])),e[o]=a}}else t[d]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,n=i.length;let s=this.nCachedObjects_;for(let r=0,a=arguments.length;r!==a;++r){const a=arguments[r],o=a.uuid,l=e[o];if(void 0!==l&&l>=s){const r=s++,h=t[r];e[h.uuid]=l,t[l]=h,e[o]=r,t[r]=a;for(let t=0,e=n;t!==e;++t){const e=i[t],n=e[r],s=e[l];e[l]=n,e[r]=s}}}this.nCachedObjects_=s}uncache(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,n=i.length;let s=this.nCachedObjects_,r=t.length;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a].uuid,l=e[o];if(void 0!==l)if(delete e[o],l<s){const a=--s,o=t[a],h=--r,c=t[h];e[o.uuid]=l,t[l]=o,e[c.uuid]=a,t[a]=c,t.pop();for(let t=0,e=n;t!==e;++t){const e=i[t],n=e[a],s=e[h];e[l]=n,e[a]=s,e.pop()}}else{const s=--r,a=t[s];s>0&&(e[a.uuid]=l),t[l]=a,t.pop();for(let t=0,e=n;t!==e;++t){const e=i[t];e[l]=e[s],e.pop()}}}this.nCachedObjects_=s}subscribe_(t,e){const i=this._bindingsIndicesByPath;let n=i[t];const s=this._bindings;if(void 0!==n)return s[n];const r=this._paths,a=this._parsedPaths,o=this._objects,l=o.length,h=this.nCachedObjects_,c=new Array(l);n=s.length,i[t]=n,r.push(t),a.push(e),s.push(c);for(let i=h,n=o.length;i!==n;++i){const n=o[i];c[i]=new Tc(n,t,e)}return c}unsubscribe_(t){const e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){const n=this._paths,s=this._parsedPaths,r=this._bindings,a=r.length-1,o=r[a];e[t[a]]=i,r[i]=o,r.pop(),s[i]=s[a],s.pop(),n[i]=n[a],n.pop()}}}Ac.prototype.isAnimationObjectGroup=!0;class Ec{constructor(t,e,i=null,n=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=n;const s=e.tracks,r=s.length,a=new Array(r),o={endingStart:Z,endingEnd:Z};for(let t=0;t!==r;++t){const e=s[t].createInterpolant(null);a[t]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const i=this._clip.duration,n=t._clip.duration,s=n/i,r=i/n;t.warp(1,s,e),this.warp(r,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const n=this._mixer,s=n.time,r=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=s,o[1]=s+i,l[0]=t/r,l[1]=e/r,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(!this.enabled)return void this._updateWeight(t);const s=this._startTime;if(null!==s){const n=(t-s)*i;if(n<0||0===i)return;this._startTime=null,e=i*n}e*=this._updateTimeScale(t);const r=this._updateTime(e),a=this._updateWeight(t);if(a>0){const t=this._interpolants,e=this._propertyBindings;switch(this.blendMode){case tt:for(let i=0,n=t.length;i!==n;++i)t[i].evaluate(r),e[i].accumulateAdditive(a);break;case $:default:for(let i=0,s=t.length;i!==s;++i)t[i].evaluate(r),e[i].accumulate(n,a)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let n=this.time+t,s=this._loopCount;const r=2202===i;if(0===t)return-1===s?n:r&&1==(1&s)?e-n:n;if(2200===i){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else{if(!(n<0)){this.time=n;break t}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===s&&(t>=0?(s=0,this._setEndings(!0,0===this.repetitions,r)):this._setEndings(0===this.repetitions,!0,r)),n>=e||n<0){const i=Math.floor(n/e);n-=e*i,s+=Math.abs(i);const a=this.repetitions-s;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===a){const e=t<0;this._setEndings(e,!e,r)}else this._setEndings(!1,!1,r);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(r&&1==(1&s))return e-n}return n}_setEndings(t,e,i){const n=this._interpolantSettings;i?(n.endingStart=J,n.endingEnd=J):(n.endingStart=t?this.zeroSlopeAtStart?J:Z:K,n.endingEnd=e?this.zeroSlopeAtEnd?J:Z:K)}_scheduleFading(t,e,i){const n=this._mixer,s=n.time;let r=this._weightInterpolant;null===r&&(r=n._lendControlInterpolant(),this._weightInterpolant=r);const a=r.parameterPositions,o=r.sampleValues;return a[0]=s,o[0]=e,a[1]=s+t,o[1]=i,this}}class Lc extends pt{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,n=t._clip.tracks,s=n.length,r=t._propertyBindings,a=t._interpolants,o=i.uuid,l=this._bindingsByRootAndName;let h=l[o];void 0===h&&(h={},l[o]=h);for(let t=0;t!==s;++t){const s=n[t],l=s.name;let c=h[l];if(void 0!==c)r[t]=c;else{if(c=r[t],void 0!==c){null===c._cacheIndex&&(++c.referenceCount,this._addInactiveBinding(c,o,l));continue}const n=e&&e._propertyBindings[t].binding.parsedPath;c=new mc(Tc.create(i,l,n),s.ValueTypeName,s.getValueSize()),++c.referenceCount,this._addInactiveBinding(c,o,l),r[t]=c}a[t].resultBuffer=c.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,i){const n=this._actions,s=this._actionsByClip;let r=s[e];if(void 0===r)r={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,s[e]=r;else{const e=r.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=n.length,n.push(t),r.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;const s=t._clip.uuid,r=this._actionsByClip,a=r[s],o=a.knownActions,l=o[o.length-1],h=t._byClipCacheIndex;l._byClipCacheIndex=h,o[h]=l,o.pop(),t._byClipCacheIndex=null;delete a.actionByRoot[(t._localRoot||this._root).uuid],0===o.length&&delete r[s],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_addInactiveBinding(t,e,i){const n=this._bindingsByRootAndName,s=this._bindings;let r=n[e];void 0===r&&(r={},n[e]=r),r[i]=t,t._cacheIndex=s.length,s.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,n=i.rootNode.uuid,s=i.path,r=this._bindingsByRootAndName,a=r[n],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete a[s],0===Object.keys(a).length&&delete r[n]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&(i=new th(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,s=e[n];t.__cacheIndex=n,e[n]=t,s.__cacheIndex=i,e[i]=s}clipAction(t,e,i){const n=e||this._root,s=n.uuid;let r="string"==typeof t?ch.findByName(n,t):t;const a=null!==r?r.uuid:t,o=this._actionsByClip[a];let l=null;if(void 0===i&&(i=null!==r?r.blendMode:$),void 0!==o){const t=o.actionByRoot[s];if(void 0!==t&&t.blendMode===i)return t;l=o.knownActions[0],null===r&&(r=l._clip)}if(null===r)return null;const h=new Ec(this,r,e,i);return this._bindAction(h,l),this._addInactiveAction(h,a,s),h}existingAction(t,e){const i=e||this._root,n=i.uuid,s="string"==typeof t?ch.findByName(i,t):t,r=s?s.uuid:t,a=this._actionsByClip[r];return void 0!==a&&a.actionByRoot[n]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,n=this.time+=t,s=Math.sign(t),r=this._accuIndex^=1;for(let a=0;a!==i;++a){e[a]._update(n,t,s,r)}const a=this._bindings,o=this._nActiveBindings;for(let t=0;t!==o;++t)a[t].apply(r);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,n=this._actionsByClip,s=n[i];if(void 0!==s){const t=s.knownActions;for(let i=0,n=t.length;i!==n;++i){const n=t[i];this._deactivateAction(n);const s=n._cacheIndex,r=e[e.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,r._cacheIndex=s,e[s]=r,e.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const t in i){const n=i[t].actionByRoot[e];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[e];if(void 0!==n)for(const t in n){const e=n[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}Lc.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Cc{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new Cc(void 0===this.value.clone?this.value:this.value.clone())}}class Pc extends ua{constructor(t,e,i=1){super(t,e),this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}Pc.prototype.isInstancedInterleavedBuffer=!0;class Rc{constructor(t,e,i,n,s){this.buffer=t,this.type=e,this.itemSize=i,this.elementSize=n,this.count=s,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}Rc.prototype.isGLBufferAttribute=!0;class Fc{constructor(t,e,i=0,n=1/0){this.ray=new be(t,e),this.near=i,this.far=n,this.camera=null,this.layers=new Fe,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,i=[]){return Dc(t,this,i,e),i.sort(Ic),i}intersectObjects(t,e=!0,i=[]){for(let n=0,s=t.length;n<s;n++)Dc(t[n],this,i,e);return i.sort(Ic),i}}function Ic(t,e){return t.distance-e.distance}function Dc(t,e,i,n){if(t.layers.test(e.layers)&&t.raycast(e,i),!0===n){const n=t.children;for(let t=0,s=n.length;t<s;t++)Dc(n[t],e,i,!0)}}class Nc{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(bt(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}const kc=new Et;class zc{constructor(t=new Et(1/0,1/0),e=new Et(-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=kc.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return kc.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}zc.prototype.isBox2=!0;const Uc=new Wt,Oc=new Wt;class Bc{constructor(t=new Wt,e=new Wt){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Uc.subVectors(t,this.start),Oc.subVectors(this.end,this.start);const i=Oc.dot(Oc);let n=Oc.dot(Uc)/i;return e&&(n=bt(n,0,1)),n}closestPointToPoint(t,e,i){const n=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Hc=new Wt;const Gc=new Wt,Vc=new we,Wc=new we;class jc extends ro{constructor(t){const e=Xc(t),i=new Di,n=[],s=[],r=new di(0,0,1),a=new di(0,1,0);for(let t=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),s.push(r.r,r.g,r.b),s.push(a.r,a.g,a.b))}i.setAttribute("position",new Ti(n,3)),i.setAttribute("color",new Ti(s,3));super(i,new Za({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,i=this.geometry,n=i.getAttribute("position");Wc.copy(this.root.matrixWorld).invert();for(let t=0,i=0;t<e.length;t++){const s=e[t];s.parent&&s.parent.isBone&&(Vc.multiplyMatrices(Wc,s.matrixWorld),Gc.setFromMatrixPosition(Vc),n.setXYZ(i,Gc.x,Gc.y,Gc.z),Vc.multiplyMatrices(Wc,s.parent.matrixWorld),Gc.setFromMatrixPosition(Vc),n.setXYZ(i+1,Gc.x,Gc.y,Gc.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}function Xc(t){const e=[];t&&t.isBone&&e.push(t);for(let i=0;i<t.children.length;i++)e.push.apply(e,Xc(t.children[i]));return e}const Yc=new Wt,qc=new di,Qc=new di;class Zc extends ro{constructor(t=10,e=10,i=4473924,n=8947848){i=new di(i),n=new di(n);const s=e/2,r=t/e,a=t/2,o=[],l=[];for(let t=0,h=0,c=-a;t<=e;t++,c+=r){o.push(-a,0,c,a,0,c),o.push(c,0,-a,c,0,a);const e=t===s?i:n;e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3}const h=new Di;h.setAttribute("position",new Ti(o,3)),h.setAttribute("color",new Ti(l,3));super(h,new Za({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const Jc=new Wt,Kc=new Wt,$c=new Wt;const tu=new Wt,eu=new an;function iu(t,e,i,n,s,r,a){tu.set(s,r,a).unproject(n);const o=e[t];if(void 0!==o){const t=i.getAttribute("position");for(let e=0,i=o.length;e<i;e++)t.setXYZ(o[e],tu.x,tu.y,tu.z)}}const nu=new Yt;class su extends ro{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),s=new Di;s.setIndex(new gi(i,1)),s.setAttribute("position",new gi(n,3)),super(s,new Za({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&nu.setFromObject(this.object),nu.isEmpty())return;const e=nu.min,i=nu.max,n=this.geometry.attributes.position,s=n.array;s[0]=i.x,s[1]=i.y,s[2]=i.z,s[3]=e.x,s[4]=i.y,s[5]=i.z,s[6]=e.x,s[7]=e.y,s[8]=i.z,s[9]=i.x,s[10]=e.y,s[11]=i.z,s[12]=i.x,s[13]=i.y,s[14]=e.z,s[15]=e.x,s[16]=i.y,s[17]=e.z,s[18]=e.x,s[19]=e.y,s[20]=e.z,s[21]=i.x,s[22]=e.y,s[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return ro.prototype.copy.call(this,t),this.object=t.object,this}}class ru extends ro{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Di;n.setIndex(new gi(i,1)),n.setAttribute("position",new Ti([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new Za({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}}const au=new Wt;let ou,lu;class hu extends ro{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new Di;i.setAttribute("position",new Ti(e,3)),i.setAttribute("color",new Ti([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(i,new Za({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,i){const n=new di,s=this.geometry.attributes.color.array;return n.set(t),n.toArray(s,0),n.toArray(s,3),n.set(e),n.toArray(s,6),n.toArray(s,9),n.set(i),n.toArray(s,12),n.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const cu=new Float32Array(1),uu=new Int32Array(cu.buffer);class du{static toHalfFloat(t){t>65504&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),t=65504),cu[0]=t;const e=uu[0];let i=e>>16&32768,n=e>>12&2047;const s=e>>23&255;return s<103?i:s>142?(i|=31744,i|=(255==s?0:1)&&8388607&e,i):s<113?(n|=2048,i|=(n>>114-s)+(n>>113-s&1),i):(i|=s-112<<10|n>>1,i+=1&n,i)}}Co.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Co.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Zo.prototype.fromPoints=function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)},Zc.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},jc.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},fh.prototype.extractUrlBase=function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Gh.extractUrlBase(t)},fh.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},zc.prototype.center=function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},zc.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},zc.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},zc.prototype.size=function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)},Yt.prototype.center=function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Yt.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Yt.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Yt.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},Yt.prototype.size=function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)},de.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},xn.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Bc.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Lt.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},Lt.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},Lt.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Lt.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},Lt.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Lt.prototype.getInverse=function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},we.prototype.extractPosition=function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},we.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},we.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Wt).setFromMatrixColumn(this,3)},we.prototype.setRotationFromQuaternion=function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},we.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},we.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},we.prototype.multiplyVector4=function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},we.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},we.prototype.rotateAxis=function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},we.prototype.crossVector=function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},we.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},we.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},we.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},we.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},we.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},we.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},we.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},we.prototype.makeFrustum=function(t,e,i,n,s,r){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,i,s,r)},we.prototype.getInverse=function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},fn.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Vt.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Vt.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},be.prototype.isIntersectionBox=function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},be.prototype.isIntersectionPlane=function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},be.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},ni.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},ni.prototype.barycoordFromPoint=function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},ni.prototype.midpoint=function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},ni.prototypenormal=function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},ni.prototype.plane=function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)},ni.barycoordFromPoint=function(t,e,i,n,s){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),ni.getBarycoord(t,e,i,n,s)},ni.normal=function(t,e,i,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),ni.getNormal(t,e,i,n)},Jo.prototype.extractAllPoints=function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},Jo.prototype.extrude=function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Al(this,t)},Jo.prototype.makeGeometry=function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Fl(this,t)},Et.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},Et.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Et.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Wt.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Wt.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Wt.prototype.getPositionFromMatrix=function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},Wt.prototype.getScaleFromMatrix=function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},Wt.prototype.getColumnFromMatrix=function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},Wt.prototype.applyProjection=function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},Wt.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},Wt.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Wt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ot.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},Ot.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Xe.prototype.getChildByName=function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},Xe.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Xe.prototype.translate=function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},Xe.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Xe.prototype.applyMatrix=function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(Xe.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Ki.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Ki.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Ua.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},on.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(_h.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(gi.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===ut},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(ut)}}}),gi.prototype.setDynamic=function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?ut:ct),this},gi.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},gi.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Di.prototype.addIndex=function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},Di.prototype.addAttribute=function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new gi(arguments[1],arguments[2])))},Di.prototype.addDrawCall=function(t,e,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},Di.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Di.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Di.prototype.removeAttribute=function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},Di.prototype.applyMatrix=function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(Di.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),ua.prototype.setDynamic=function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?ut:ct),this},ua.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Al.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Al.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Al.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},ca.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Cc.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(ri.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new di}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(rn.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),aa.prototype.clearTarget=function(t,e,i,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,i,n)},aa.prototype.animate=function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},aa.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},aa.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},aa.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},aa.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},aa.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},aa.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},aa.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},aa.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},aa.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},aa.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},aa.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},aa.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},aa.prototype.enableScissorTest=function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},aa.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},aa.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},aa.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},aa.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},aa.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},aa.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},aa.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},aa.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},aa.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},aa.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(aa.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?it:et}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Zr.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Bt.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),lc.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new Jh).load(t,(function(t){e.setBuffer(t)})),this},pc.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},hn.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},hn.prototype.clear=function(t,e,i,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,i,n)},Nt.crossOrigin=void 0,Nt.loadTexture=function(t,e,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const s=new wh;s.setCrossOrigin(this.crossOrigin);const r=s.load(t,i,void 0,n);return e&&(r.mapping=e),r},Nt.loadTextureCube=function(t,e,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const s=new yh;s.setCrossOrigin(this.crossOrigin);const r=s.load(t,i,void 0,n);return e&&(r.mapping=e),r},Nt.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Nt.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const pu={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:i}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=i);var mu=Object.freeze({__proto__:null,ACESFilmicToneMapping:4,AddEquation:r,AddOperation:2,AdditiveAnimationBlendMode:tt,AdditiveBlending:2,AlphaFormat:1021,AlwaysDepth:1,AlwaysStencilFunc:519,AmbientLight:zh,AmbientLightProbe:$h,AnimationClip:ch,AnimationLoader:class extends fh{constructor(t){super(t)}load(t,e,i,n){const s=this,r=new vh(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(t,(function(i){try{e(s.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),s.manager.itemError(t)}}),i,n)}parse(t){const e=[];for(let i=0;i<t.length;i++){const n=ch.parse(t[i]);e.push(n)}return e}},AnimationMixer:Lc,AnimationObjectGroup:Ac,AnimationUtils:Jl,ArcCurve:Ro,ArrayCamera:ta,ArrowHelper:class extends Xe{constructor(t=new Wt(0,0,1),e=new Wt(0,0,0),i=1,n=16776960,s=.2*i,r=.2*s){super(),this.type="ArrowHelper",void 0===ou&&(ou=new Di,ou.setAttribute("position",new Ti([0,0,0,0,1,0],3)),lu=new bo(0,.5,1,5,1),lu.translate(0,-.5,0)),this.position.copy(e),this.line=new io(ou,new Za({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ki(lu,new pi({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,s,r)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{au.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(au,e)}}setLength(t,e=.2*t,i=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}},Audio:lc,AudioAnalyser:pc,AudioContext:Zh,AudioListener:class extends Xe{constructor(){super(),this.type="AudioListener",this.context=Zh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new ic}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(sc,rc,ac),oc.set(0,0,-1).applyQuaternion(rc),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(sc.x,t),e.positionY.linearRampToValueAtTime(sc.y,t),e.positionZ.linearRampToValueAtTime(sc.z,t),e.forwardX.linearRampToValueAtTime(oc.x,t),e.forwardY.linearRampToValueAtTime(oc.y,t),e.forwardZ.linearRampToValueAtTime(oc.z,t),e.upX.linearRampToValueAtTime(i.x,t),e.upY.linearRampToValueAtTime(i.y,t),e.upZ.linearRampToValueAtTime(i.z,t)}else e.setPosition(sc.x,sc.y,sc.z),e.setOrientation(oc.x,oc.y,oc.z,i.x,i.y,i.z)}},AudioLoader:Jh,AxesHelper:hu,AxisHelper:function(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new hu(t)},BackSide:1,BasicDepthPacking:3200,BasicShadowMap:0,BinaryTextureLoader:function(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new bh(t)},Bone:Oa,BooleanKeyframeTrack:nh,BoundingBoxHelper:function(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new su(t,e)},Box2:zc,Box3:Yt,Box3Helper:ru,BoxBufferGeometry:tn,BoxGeometry:tn,BoxHelper:su,BufferAttribute:gi,BufferGeometry:Di,BufferGeometryLoader:Wh,ByteType:1010,Cache:dh,Camera:an,CameraHelper:class extends ro{constructor(t){const e=new Di,i=new Za({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],s=[],r={},a=new di(16755200),o=new di(16711680),l=new di(43775),h=new di(16777215),c=new di(3355443);function u(t,e,i){d(t,i),d(e,i)}function d(t,e){n.push(0,0,0),s.push(e.r,e.g,e.b),void 0===r[t]&&(r[t]=[]),r[t].push(n.length/3-1)}u("n1","n2",a),u("n2","n4",a),u("n4","n3",a),u("n3","n1",a),u("f1","f2",a),u("f2","f4",a),u("f4","f3",a),u("f3","f1",a),u("n1","f1",a),u("n2","f2",a),u("n3","f3",a),u("n4","f4",a),u("p","n1",o),u("p","n2",o),u("p","n3",o),u("p","n4",o),u("u1","u2",l),u("u2","u3",l),u("u3","u1",l),u("c","t",h),u("p","c",c),u("cn1","cn2",c),u("cn3","cn4",c),u("cf1","cf2",c),u("cf3","cf4",c),e.setAttribute("position",new Ti(n,3)),e.setAttribute("color",new Ti(s,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=r,this.update()}update(){const t=this.geometry,e=this.pointMap;eu.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),iu("c",e,t,eu,0,0,-1),iu("t",e,t,eu,0,0,1),iu("n1",e,t,eu,-1,-1,-1),iu("n2",e,t,eu,1,-1,-1),iu("n3",e,t,eu,-1,1,-1),iu("n4",e,t,eu,1,1,-1),iu("f1",e,t,eu,-1,-1,1),iu("f2",e,t,eu,1,-1,1),iu("f3",e,t,eu,-1,1,1),iu("f4",e,t,eu,1,1,1),iu("u1",e,t,eu,.7,1.1,-1),iu("u2",e,t,eu,-.7,1.1,-1),iu("u3",e,t,eu,0,2,-1),iu("cf1",e,t,eu,-1,0,1),iu("cf2",e,t,eu,1,0,1),iu("cf3",e,t,eu,0,-1,1),iu("cf4",e,t,eu,0,1,1),iu("cn1",e,t,eu,-1,0,-1),iu("cn2",e,t,eu,1,0,-1),iu("cn3",e,t,eu,0,-1,-1),iu("cn4",e,t,eu,0,1,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},CanvasRenderer:function(){console.error("THREE.CanvasRenderer has been removed")},CanvasTexture:vo,CatmullRomCurve3:zo,CineonToneMapping:3,CircleBufferGeometry:yo,CircleGeometry:yo,ClampToEdgeWrapping:x,Clock:ic,Color:di,ColorKeyframeTrack:sh,CompressedTexture:go,CompressedTextureLoader:class extends fh{constructor(t){super(t)}load(t,e,i,n){const s=this,r=[],a=new go,o=new vh(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(s.withCredentials);let l=0;function h(h){o.load(t[h],(function(t){const i=s.parse(t,!0);r[h]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},l+=1,6===l&&(1===i.mipmapCount&&(a.minFilter=M),a.image=r,a.format=i.format,a.needsUpdate=!0,e&&e(a))}),i,n)}if(Array.isArray(t))for(let e=0,i=t.length;e<i;++e)h(e);else o.load(t,(function(t){const i=s.parse(t,!0);if(i.isCubemap){const t=i.mipmaps.length/i.mipmapCount;for(let e=0;e<t;e++){r[e]={mipmaps:[]};for(let t=0;t<i.mipmapCount;t++)r[e].mipmaps.push(i.mipmaps[e*i.mipmapCount+t]),r[e].format=i.format,r[e].width=i.width,r[e].height=i.height}a.image=r}else a.image.width=i.width,a.image.height=i.height,a.mipmaps=i.mipmaps;1===i.mipmapCount&&(a.minFilter=M),a.format=i.format,a.needsUpdate=!0,e&&e(a)}),i,n);return a}},ConeBufferGeometry:wo,ConeGeometry:wo,CubeCamera:hn,CubeReflectionMapping:u,CubeRefractionMapping:d,CubeTexture:cn,CubeTextureLoader:yh,CubeUVReflectionMapping:f,CubeUVRefractionMapping:g,CubicBezierCurve:Ho,CubicBezierCurve3:Go,CubicInterpolant:$l,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,CullFaceNone:0,Curve:Co,CurvePath:Qo,CustomBlending:5,CustomToneMapping:5,CylinderBufferGeometry:bo,CylinderGeometry:bo,Cylindrical:class{constructor(t=1,e=0,i=0){return this.radius=t,this.theta=e,this.y=i,this}set(t,e,i){return this.radius=t,this.theta=e,this.y=i,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+i*i),this.theta=Math.atan2(t,i),this.y=e,this}clone(){return(new this.constructor).copy(this)}},DataTexture:Ba,DataTexture2DArray:os,DataTexture3D:ps,DataTextureLoader:bh,DataUtils:du,DecrementStencilOp:7683,DecrementWrapStencilOp:34056,DefaultLoadingManager:mh,DepthFormat:N,DepthStencilFormat:k,DepthTexture:xo,DirectionalLight:kh,DirectionalLightHelper:class extends Xe{constructor(t,e,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===e&&(e=1);let n=new Di;n.setAttribute("position",new Ti([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const s=new Za({fog:!1,toneMapped:!1});this.lightPlane=new io(n,s),this.add(this.lightPlane),n=new Di,n.setAttribute("position",new Ti([0,0,0,0,0,1],3)),this.targetLine=new io(n,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Jc.setFromMatrixPosition(this.light.matrixWorld),Kc.setFromMatrixPosition(this.light.target.matrixWorld),$c.subVectors(Kc,Jc),this.lightPlane.lookAt(Kc),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Kc),this.targetLine.scale.z=$c.length()}},DiscreteInterpolant:eh,DodecahedronBufferGeometry:Mo,DodecahedronGeometry:Mo,DoubleSide:2,DstAlphaFactor:l,DstColorFactor:h,DynamicBufferAttribute:function(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new gi(t,e).setUsage(ut)},DynamicCopyUsage:35050,DynamicDrawUsage:ut,DynamicReadUsage:35049,EdgesGeometry:Lo,EdgesHelper:function(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new ro(new Lo(t.geometry),new Za({color:void 0!==e?e:16777215}))},EllipseCurve:Po,EqualDepth:4,EqualStencilFunc:514,EquirectangularReflectionMapping:p,EquirectangularRefractionMapping:m,Euler:Re,EventDispatcher:pt,ExtrudeBufferGeometry:Al,ExtrudeGeometry:Al,FaceColors:1,FileLoader:vh,FlatShading:1,Float16BufferAttribute:Si,Float32Attribute:function(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Ti(t,e)},Float32BufferAttribute:Ti,Float64Attribute:function(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Ai(t,e)},Float64BufferAttribute:Ai,FloatType:C,Fog:ha,FogExp2:la,Font:function(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")},FontLoader:function(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")},FrontSide:0,Frustum:xn,GLBufferAttribute:Rc,GLSL1:"100",GLSL3:dt,GammaEncoding:nt,GreaterDepth:6,GreaterEqualDepth:5,GreaterEqualStencilFunc:518,GreaterStencilFunc:516,GridHelper:Zc,Group:ea,HalfFloatType:P,HemisphereLight:Mh,HemisphereLightHelper:class extends Xe{constructor(t,e,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const n=new Pl(e);n.rotateY(.5*Math.PI),this.material=new pi({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const s=n.getAttribute("position"),r=new Float32Array(3*s.count);n.setAttribute("color",new gi(r,3)),this.add(new Ki(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");qc.copy(this.light.color),Qc.copy(this.light.groundColor);for(let t=0,i=e.count;t<i;t++){const n=t<i/2?qc:Qc;e.setXYZ(t,n.r,n.g,n.b)}e.needsUpdate=!0}t.lookAt(Yc.setFromMatrixPosition(this.light.matrixWorld).negate())}},HemisphereLightProbe:Kh,IcosahedronBufferGeometry:Ll,IcosahedronGeometry:Ll,ImageBitmapLoader:qh,ImageLoader:xh,ImageUtils:Nt,ImmediateRenderObject:function(){console.error("THREE.ImmediateRenderObject has been removed.")},IncrementStencilOp:7682,IncrementWrapStencilOp:34055,InstancedBufferAttribute:Wa,InstancedBufferGeometry:Vh,InstancedInterleavedBuffer:Pc,InstancedMesh:Qa,Int16Attribute:function(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new bi(t,e)},Int16BufferAttribute:bi,Int32Attribute:function(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new _i(t,e)},Int32BufferAttribute:_i,Int8Attribute:function(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new vi(t,e)},Int8BufferAttribute:vi,IntType:1013,InterleavedBuffer:ua,InterleavedBufferAttribute:pa,Interpolant:Kl,InterpolateDiscrete:Y,InterpolateLinear:q,InterpolateSmooth:Q,InvertStencilOp:5386,JSONLoader:function(){console.error("THREE.JSONLoader has been removed.")},KeepStencilOp:ht,KeyframeTrack:ih,LOD:Fa,LatheBufferGeometry:Cl,LatheGeometry:Cl,Layers:Fe,LensFlare:function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},LessDepth:2,LessEqualDepth:3,LessEqualStencilFunc:515,LessStencilFunc:513,Light:_h,LightProbe:Bh,Line:io,Line3:Bc,LineBasicMaterial:Za,LineCurve:Vo,LineCurve3:Wo,LineDashedMaterial:Ql,LineLoop:ao,LinePieces:1,LineSegments:ro,LineStrip:0,LinearEncoding:et,LinearFilter:M,LinearInterpolant:th,LinearMipMapLinearFilter:1008,LinearMipMapNearestFilter:1007,LinearMipmapLinearFilter:T,LinearMipmapNearestFilter:S,LinearToneMapping:1,Loader:fh,LoaderUtils:Gh,LoadingManager:ph,LogLuvEncoding:3003,LoopOnce:2200,LoopPingPong:2202,LoopRepeat:2201,LuminanceAlphaFormat:1025,LuminanceFormat:1024,MOUSE:n,Material:ri,MaterialLoader:Hh,Math:At,MathUtils:At,Matrix3:Lt,Matrix4:we,MaxEquation:104,Mesh:Ki,MeshBasicMaterial:pi,MeshDepthMaterial:qr,MeshDistanceMaterial:Qr,MeshFaceMaterial:function(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t},MeshLambertMaterial:Yl,MeshMatcapMaterial:ql,MeshNormalMaterial:Xl,MeshPhongMaterial:Wl,MeshPhysicalMaterial:Vl,MeshStandardMaterial:Gl,MeshToonMaterial:jl,MinEquation:103,MirroredRepeatWrapping:y,MixOperation:1,MultiMaterial:function(t=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t},MultiplyBlending:4,MultiplyOperation:0,NearestFilter:b,NearestMipMapLinearFilter:1005,NearestMipMapNearestFilter:1004,NearestMipmapLinearFilter:_,NearestMipmapNearestFilter:w,NeverDepth:0,NeverStencilFunc:512,NoBlending:0,NoColors:0,NoToneMapping:0,NormalAnimationBlendMode:$,NormalBlending:1,NotEqualDepth:7,NotEqualStencilFunc:517,NumberKeyframeTrack:rh,Object3D:Xe,ObjectLoader:class extends fh{constructor(t){super(t)}load(t,e,i,n){const s=this,r=""===this.path?Gh.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||r;const a=new vh(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(i){let r=null;try{r=JSON.parse(i)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const a=r.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?s.parse(r,e):console.error("THREE.ObjectLoader: Can't load "+t)}),i,n)}async loadAsync(t,e){const i=""===this.path?Gh.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||i;const n=new vh(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);const s=await n.loadAsync(t,e),r=JSON.parse(s),a=r.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(r)}parse(t,e){const i=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),s=this.parseGeometries(t.geometries,n),r=this.parseImages(t.images,(function(){void 0!==e&&e(l)})),a=this.parseTextures(t.textures,r),o=this.parseMaterials(t.materials,a),l=this.parseObject(t.object,s,o,a,i),h=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,h),void 0!==e){let t=!1;for(const e in r)if(r[e]instanceof HTMLImageElement){t=!0;break}!1===t&&e(l)}return l}async parseAsync(t){const e=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,i),s=await this.parseImagesAsync(t.images),r=this.parseTextures(t.textures,s),a=this.parseMaterials(t.materials,r),o=this.parseObject(t.object,n,a,r,e),l=this.parseSkeletons(t.skeletons,o);return this.bindSkeletons(o,l),o}parseShapes(t){const e={};if(void 0!==t)for(let i=0,n=t.length;i<n;i++){const n=(new Jo).fromJSON(t[i]);e[n.uuid]=n}return e}parseSkeletons(t,e){const i={},n={};if(e.traverse((function(t){t.isBone&&(n[t.uuid]=t)})),void 0!==t)for(let e=0,s=t.length;e<s;e++){const s=(new Va).fromJSON(t[e],n);i[s.uuid]=s}return i}parseGeometries(t,e){const i={};if(void 0!==t){const n=new Wh;for(let s=0,r=t.length;s<r;s++){let r;const a=t[s];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":r=n.parse(a);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:a.type in Bl?r=Bl[a.type].fromJSON(a,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}r.uuid=a.uuid,void 0!==a.name&&(r.name=a.name),!0===r.isBufferGeometry&&void 0!==a.userData&&(r.userData=a.userData),i[a.uuid]=r}}return i}parseMaterials(t,e){const i={},n={};if(void 0!==t){const s=new Hh;s.setTextures(e);for(let e=0,r=t.length;e<r;e++){const r=t[e];if("MultiMaterial"===r.type){const t=[];for(let e=0;e<r.materials.length;e++){const n=r.materials[e];void 0===i[n.uuid]&&(i[n.uuid]=s.parse(n)),t.push(i[n.uuid])}n[r.uuid]=t}else void 0===i[r.uuid]&&(i[r.uuid]=s.parse(r)),n[r.uuid]=i[r.uuid]}}return n}parseAnimations(t){const e={};if(void 0!==t)for(let i=0;i<t.length;i++){const n=t[i],s=ch.parse(n);e[s.uuid]=s}return e}parseImages(t,e){const i=this,n={};let s;function r(t){if("string"==typeof t){const e=t;return function(t){return i.manager.itemStart(t),s.load(t,(function(){i.manager.itemEnd(t)}),void 0,(function(){i.manager.itemError(t),i.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:i.resourcePath+e)}return t.data?{data:Rt(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const i=new ph(e);s=new xh(i),s.setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const i=t[e],s=i.url;if(Array.isArray(s)){n[i.uuid]=[];for(let t=0,e=s.length;t<e;t++){const e=r(s[t]);null!==e&&(e instanceof HTMLImageElement?n[i.uuid].push(e):n[i.uuid].push(new Ba(e.data,e.width,e.height)))}}else{const t=r(i.url);null!==t&&(n[i.uuid]=t)}}}return n}async parseImagesAsync(t){const e=this,i={};let n;async function s(t){if("string"==typeof t){const i=t,s=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(i)?i:e.resourcePath+i;return await n.loadAsync(s)}return t.data?{data:Rt(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){n=new xh(this.manager),n.setCrossOrigin(this.crossOrigin);for(let e=0,n=t.length;e<n;e++){const n=t[e],r=n.url;if(Array.isArray(r)){i[n.uuid]=[];for(let t=0,e=r.length;t<e;t++){const e=r[t],a=await s(e);null!==a&&(a instanceof HTMLImageElement?i[n.uuid].push(a):i[n.uuid].push(new Ba(a.data,a.width,a.height)))}}else{const t=await s(n.url);null!==t&&(i[n.uuid]=t)}}}return i}parseTextures(t,e){function i(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const n={};if(void 0!==t)for(let s=0,r=t.length;s<r;s++){const r=t[s];let a;void 0===r.image&&console.warn('THREE.ObjectLoader: No "image" specified for',r.uuid),void 0===e[r.image]&&console.warn("THREE.ObjectLoader: Undefined image",r.image);const o=e[r.image];Array.isArray(o)?(a=new cn(o),6===o.length&&(a.needsUpdate=!0)):(a=o&&o.data?new Ba(o.data,o.width,o.height):new zt(o),o&&(a.needsUpdate=!0)),a.uuid=r.uuid,void 0!==r.name&&(a.name=r.name),void 0!==r.mapping&&(a.mapping=i(r.mapping,jh)),void 0!==r.offset&&a.offset.fromArray(r.offset),void 0!==r.repeat&&a.repeat.fromArray(r.repeat),void 0!==r.center&&a.center.fromArray(r.center),void 0!==r.rotation&&(a.rotation=r.rotation),void 0!==r.wrap&&(a.wrapS=i(r.wrap[0],Xh),a.wrapT=i(r.wrap[1],Xh)),void 0!==r.format&&(a.format=r.format),void 0!==r.type&&(a.type=r.type),void 0!==r.encoding&&(a.encoding=r.encoding),void 0!==r.minFilter&&(a.minFilter=i(r.minFilter,Yh)),void 0!==r.magFilter&&(a.magFilter=i(r.magFilter,Yh)),void 0!==r.anisotropy&&(a.anisotropy=r.anisotropy),void 0!==r.flipY&&(a.flipY=r.flipY),void 0!==r.premultiplyAlpha&&(a.premultiplyAlpha=r.premultiplyAlpha),void 0!==r.unpackAlignment&&(a.unpackAlignment=r.unpackAlignment),n[r.uuid]=a}return n}parseObject(t,e,i,n,s){let r,a,o;function l(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function h(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let n=0,s=t.length;n<s;n++){const s=t[n];void 0===i[s]&&console.warn("THREE.ObjectLoader: Undefined material",s),e.push(i[s])}return e}return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),i[t]}}function c(t){return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),n[t]}switch(t.type){case"Scene":r=new ca,void 0!==t.background&&(Number.isInteger(t.background)?r.background=new di(t.background):r.background=c(t.background)),void 0!==t.environment&&(r.environment=c(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?r.fog=new ha(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(r.fog=new la(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":r=new on(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(r.focus=t.focus),void 0!==t.zoom&&(r.zoom=t.zoom),void 0!==t.filmGauge&&(r.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(r.filmOffset=t.filmOffset),void 0!==t.view&&(r.view=Object.assign({},t.view));break;case"OrthographicCamera":r=new Rn(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(r.zoom=t.zoom),void 0!==t.view&&(r.view=Object.assign({},t.view));break;case"AmbientLight":r=new zh(t.color,t.intensity);break;case"DirectionalLight":r=new kh(t.color,t.intensity);break;case"PointLight":r=new Dh(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":r=new Uh(t.color,t.intensity,t.width,t.height);break;case"SpotLight":r=new Ch(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":r=new Mh(t.color,t.groundColor,t.intensity);break;case"LightProbe":r=(new Bh).fromJSON(t);break;case"SkinnedMesh":a=l(t.geometry),o=h(t.material),r=new Ua(a,o),void 0!==t.bindMode&&(r.bindMode=t.bindMode),void 0!==t.bindMatrix&&r.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(r.skeleton=t.skeleton);break;case"Mesh":a=l(t.geometry),o=h(t.material),r=new Ki(a,o);break;case"InstancedMesh":a=l(t.geometry),o=h(t.material);const e=t.count,i=t.instanceMatrix,n=t.instanceColor;r=new Qa(a,o,e),r.instanceMatrix=new Wa(new Float32Array(i.array),16),void 0!==n&&(r.instanceColor=new Wa(new Float32Array(n.array),n.itemSize));break;case"LOD":r=new Fa;break;case"Line":r=new io(l(t.geometry),h(t.material));break;case"LineLoop":r=new ao(l(t.geometry),h(t.material));break;case"LineSegments":r=new ro(l(t.geometry),h(t.material));break;case"PointCloud":case"Points":r=new po(l(t.geometry),h(t.material));break;case"Sprite":r=new La(h(t.material));break;case"Group":r=new ea;break;case"Bone":r=new Oa;break;default:r=new Xe}if(r.uuid=t.uuid,void 0!==t.name&&(r.name=t.name),void 0!==t.matrix?(r.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(r.matrixAutoUpdate=t.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==t.position&&r.position.fromArray(t.position),void 0!==t.rotation&&r.rotation.fromArray(t.rotation),void 0!==t.quaternion&&r.quaternion.fromArray(t.quaternion),void 0!==t.scale&&r.scale.fromArray(t.scale)),void 0!==t.castShadow&&(r.castShadow=t.castShadow),void 0!==t.receiveShadow&&(r.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(r.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(r.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(r.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&r.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(r.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.frustumCulled&&(r.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(r.renderOrder=t.renderOrder),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.layers&&(r.layers.mask=t.layers),void 0!==t.children){const a=t.children;for(let t=0;t<a.length;t++)r.add(this.parseObject(a[t],e,i,n,s))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const i=e[t];r.animations.push(s[i])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(r.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const i=e[t],n=r.getObjectByProperty("uuid",i.object);void 0!==n&&r.addLevel(n,i.distance)}}return r}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const i=e[t.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(i,t.bindMatrix)}}))}setTexturePath(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}},ObjectSpaceNormalMap:1,OctahedronBufferGeometry:Pl,OctahedronGeometry:Pl,OneFactor:201,OneMinusDstAlphaFactor:207,OneMinusDstColorFactor:209,OneMinusSrcAlphaFactor:205,OneMinusSrcColorFactor:203,OrthographicCamera:Rn,PCFShadowMap:1,PCFSoftShadowMap:2,PMREMGenerator:Yn,ParametricGeometry:function(){return console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new Di},Particle:function(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new La(t)},ParticleBasicMaterial:function(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new oo(t)},ParticleSystem:function(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new po(t,e)},ParticleSystemMaterial:function(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new oo(t)},Path:Zo,PerspectiveCamera:on,Plane:fn,PlaneBufferGeometry:wn,PlaneGeometry:wn,PlaneHelper:class extends io{constructor(t,e=1,i=16776960){const n=i,s=new Di;s.setAttribute("position",new Ti([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),s.computeBoundingSphere(),super(s,new Za({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const r=new Di;r.setAttribute("position",new Ti([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),r.computeBoundingSphere(),this.add(new Ki(r,new pi({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?1:0,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}},PointCloud:function(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new po(t,e)},PointCloudMaterial:function(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new oo(t)},PointLight:Dh,PointLightHelper:class extends Ki{constructor(t,e,i){super(new Il(e,4,2),new pi({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},Points:po,PointsMaterial:oo,PolarGridHelper:class extends ro{constructor(t=10,e=16,i=8,n=64,s=4473924,r=8947848){s=new di(s),r=new di(r);const a=[],o=[];for(let i=0;i<=e;i++){const n=i/e*(2*Math.PI),l=Math.sin(n)*t,h=Math.cos(n)*t;a.push(0,0,0),a.push(l,0,h);const c=1&i?s:r;o.push(c.r,c.g,c.b),o.push(c.r,c.g,c.b)}for(let e=0;e<=i;e++){const l=1&e?s:r,h=t-t/i*e;for(let t=0;t<n;t++){let e=t/n*(2*Math.PI),i=Math.sin(e)*h,s=Math.cos(e)*h;a.push(i,0,s),o.push(l.r,l.g,l.b),e=(t+1)/n*(2*Math.PI),i=Math.sin(e)*h,s=Math.cos(e)*h,a.push(i,0,s),o.push(l.r,l.g,l.b)}}const l=new Di;l.setAttribute("position",new Ti(a,3)),l.setAttribute("color",new Ti(o,3));super(l,new Za({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},PolyhedronBufferGeometry:_o,PolyhedronGeometry:_o,PositionalAudio:class extends lc{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,i){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=i,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(hc,cc,uc),dc.set(0,0,1).applyQuaternion(cc);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(hc.x,t),e.positionY.linearRampToValueAtTime(hc.y,t),e.positionZ.linearRampToValueAtTime(hc.z,t),e.orientationX.linearRampToValueAtTime(dc.x,t),e.orientationY.linearRampToValueAtTime(dc.y,t),e.orientationZ.linearRampToValueAtTime(dc.z,t)}else e.setPosition(hc.x,hc.y,hc.z),e.setOrientation(dc.x,dc.y,dc.z)}},PropertyBinding:Tc,PropertyMixer:mc,QuadraticBezierCurve:jo,QuadraticBezierCurve3:Xo,Quaternion:Vt,QuaternionKeyframeTrack:oh,QuaternionLinearInterpolant:ah,REVISION:i,RGBADepthPacking:lt,RGBAFormat:I,RGBAIntegerFormat:1033,RGBA_ASTC_10x10_Format:37819,RGBA_ASTC_10x5_Format:37816,RGBA_ASTC_10x6_Format:37817,RGBA_ASTC_10x8_Format:37818,RGBA_ASTC_12x10_Format:37820,RGBA_ASTC_12x12_Format:37821,RGBA_ASTC_4x4_Format:37808,RGBA_ASTC_5x4_Format:37809,RGBA_ASTC_5x5_Format:37810,RGBA_ASTC_6x5_Format:37811,RGBA_ASTC_6x6_Format:37812,RGBA_ASTC_8x5_Format:37813,RGBA_ASTC_8x6_Format:37814,RGBA_ASTC_8x8_Format:37815,RGBA_BPTC_Format:36492,RGBA_ETC2_EAC_Format:X,RGBA_PVRTC_2BPPV1_Format:W,RGBA_PVRTC_4BPPV1_Format:V,RGBA_S3TC_DXT1_Format:U,RGBA_S3TC_DXT3_Format:O,RGBA_S3TC_DXT5_Format:B,RGBDEncoding:ot,RGBEEncoding:st,RGBEFormat:D,RGBFormat:F,RGBIntegerFormat:1032,RGBM16Encoding:at,RGBM7Encoding:rt,RGB_ETC1_Format:36196,RGB_ETC2_Format:j,RGB_PVRTC_2BPPV1_Format:G,RGB_PVRTC_4BPPV1_Format:H,RGB_S3TC_DXT1_Format:z,RGFormat:1030,RGIntegerFormat:1031,RawShaderMaterial:Fn,Ray:be,Raycaster:Fc,RectAreaLight:Uh,RedFormat:1028,RedIntegerFormat:1029,ReinhardToneMapping:2,RepeatWrapping:v,ReplaceStencilOp:7681,ReverseSubtractEquation:102,RingBufferGeometry:Rl,RingGeometry:Rl,SRGB8_ALPHA8_ASTC_10x10_Format:37851,SRGB8_ALPHA8_ASTC_10x5_Format:37848,SRGB8_ALPHA8_ASTC_10x6_Format:37849,SRGB8_ALPHA8_ASTC_10x8_Format:37850,SRGB8_ALPHA8_ASTC_12x10_Format:37852,SRGB8_ALPHA8_ASTC_12x12_Format:37853,SRGB8_ALPHA8_ASTC_4x4_Format:37840,SRGB8_ALPHA8_ASTC_5x4_Format:37841,SRGB8_ALPHA8_ASTC_5x5_Format:37842,SRGB8_ALPHA8_ASTC_6x5_Format:37843,SRGB8_ALPHA8_ASTC_6x6_Format:37844,SRGB8_ALPHA8_ASTC_8x5_Format:37845,SRGB8_ALPHA8_ASTC_8x6_Format:37846,SRGB8_ALPHA8_ASTC_8x8_Format:37847,Scene:ca,SceneUtils:pu,ShaderChunk:_n,ShaderLib:Sn,ShaderMaterial:rn,ShadowMaterial:Hl,Shape:Jo,ShapeBufferGeometry:Fl,ShapeGeometry:Fl,ShapePath:class{constructor(){this.type="ShapePath",this.color=new di,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new Zo,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,i,n){return this.currentPath.quadraticCurveTo(t,e,i,n),this}bezierCurveTo(t,e,i,n,s,r){return this.currentPath.bezierCurveTo(t,e,i,n,s,r),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t,e){function i(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i],s=new Jo;s.curves=n.curves,e.push(s)}return e}function n(t,e){const i=e.length;let n=!1;for(let s=i-1,r=0;r<i;s=r++){let i=e[s],a=e[r],o=a.x-i.x,l=a.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=e[r],o=-o,a=e[s],l=-l),t.y<i.y||t.y>a.y)continue;if(t.y===i.y){if(t.x===i.x)return!0}else{const e=l*(t.x-i.x)-o*(t.y-i.y);if(0===e)return!0;if(e<0)continue;n=!n}}else{if(t.y!==i.y)continue;if(a.x<=t.x&&t.x<=i.x||i.x<=t.x&&t.x<=a.x)return!0}}return n}const s=Ml.isClockWise,r=this.subPaths;if(0===r.length)return[];if(!0===e)return i(r);let a,o,l;const h=[];if(1===r.length)return o=r[0],l=new Jo,l.curves=o.curves,h.push(l),h;let c=!s(r[0].getPoints());c=t?!c:c;const u=[],d=[];let p,m,f=[],g=0;d[g]=void 0,f[g]=[];for(let e=0,i=r.length;e<i;e++)o=r[e],p=o.getPoints(),a=s(p),a=t?!a:a,a?(!c&&d[g]&&g++,d[g]={s:new Jo,p:p},d[g].s.curves=o.curves,c&&g++,f[g]=[]):f[g].push({h:o,p:p[0]});if(!d[0])return i(r);if(d.length>1){let t=!1;const e=[];for(let t=0,e=d.length;t<e;t++)u[t]=[];for(let i=0,s=d.length;i<s;i++){const s=f[i];for(let r=0;r<s.length;r++){const a=s[r];let o=!0;for(let s=0;s<d.length;s++)n(a.p,d[s].p)&&(i!==s&&e.push({froms:i,tos:s,hole:r}),o?(o=!1,u[s].push(a)):t=!0);o&&u[i].push(a)}}e.length>0&&(t||(f=u))}for(let t=0,e=d.length;t<e;t++){l=d[t].s,h.push(l),m=f[t];for(let t=0,e=m.length;t<e;t++)l.holes.push(m[t].h)}return h}},ShapeUtils:Ml,ShortType:1011,Skeleton:Va,SkeletonHelper:jc,SkinnedMesh:Ua,SmoothShading:2,Sphere:de,SphereBufferGeometry:Il,SphereGeometry:Il,Spherical:Nc,SphericalHarmonics3:Oh,SplineCurve:Yo,SpotLight:Ch,SpotLightHelper:class extends Xe{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const i=new Di,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,i=32;t<i;t++,e++){const s=t/i*Math.PI*2,r=e/i*Math.PI*2;n.push(Math.cos(s),Math.sin(s),1,Math.cos(r),Math.sin(r),1)}i.setAttribute("position",new Ti(n,3));const s=new Za({fog:!1,toneMapped:!1});this.cone=new ro(i,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Hc.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Hc),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Sprite:La,SpriteMaterial:ma,SrcAlphaFactor:204,SrcAlphaSaturateFactor:210,SrcColorFactor:202,StaticCopyUsage:35046,StaticDrawUsage:ct,StaticReadUsage:35045,StereoCamera:class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new on,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new on,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;const i=t.projectionMatrix.clone(),n=e.eyeSep/2,s=n*e.near/e.focus,r=e.near*Math.tan(ft*e.fov*.5)/e.zoom;let a,o;ec.elements[12]=-n,tc.elements[12]=n,a=-r*e.aspect+s,o=r*e.aspect+s,i.elements[0]=2*e.near/(o-a),i.elements[8]=(o+a)/(o-a),this.cameraL.projectionMatrix.copy(i),a=-r*e.aspect-s,o=r*e.aspect-s,i.elements[0]=2*e.near/(o-a),i.elements[8]=(o+a)/(o-a),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(ec),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(tc)}},StreamCopyUsage:35042,StreamDrawUsage:35040,StreamReadUsage:35041,StringKeyframeTrack:lh,SubtractEquation:101,SubtractiveBlending:3,TOUCH:s,TangentSpaceNormalMap:0,TetrahedronBufferGeometry:Dl,TetrahedronGeometry:Dl,TextGeometry:function(){return console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),new Di},Texture:zt,TextureLoader:wh,TorusBufferGeometry:Nl,TorusGeometry:Nl,TorusKnotBufferGeometry:kl,TorusKnotGeometry:kl,Triangle:ni,TriangleFanDrawMode:2,TriangleStripDrawMode:1,TrianglesDrawMode:0,TubeBufferGeometry:zl,TubeGeometry:zl,UVMapping:c,Uint16Attribute:function(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new wi(t,e)},Uint16BufferAttribute:wi,Uint32Attribute:function(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Mi(t,e)},Uint32BufferAttribute:Mi,Uint8Attribute:function(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new xi(t,e)},Uint8BufferAttribute:xi,Uint8ClampedAttribute:function(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new yi(t,e)},Uint8ClampedBufferAttribute:yi,Uniform:Cc,UniformsLib:Mn,UniformsUtils:sn,UnsignedByteType:A,UnsignedInt248Type:R,UnsignedIntType:L,UnsignedShort4444Type:1017,UnsignedShort5551Type:1018,UnsignedShort565Type:1019,UnsignedShortType:E,VSMShadowMap:3,Vector2:Et,Vector3:Wt,Vector4:Ot,VectorKeyframeTrack:hh,Vertex:function(t,e,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Wt(t,e,i)},VertexColors:2,VideoTexture:fo,WebGL1Renderer:oa,WebGLCubeRenderTarget:un,WebGLMultipleRenderTargets:Ht,WebGLMultisampleRenderTarget:Gt,WebGLRenderTarget:Bt,WebGLRenderTargetCube:function(t,e,i){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new un(t,i)},WebGLRenderer:aa,WebGLUtils:$r,WireframeGeometry:Ul,WireframeHelper:function(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new ro(new Ul(t.geometry),new Za({color:void 0!==e?e:16777215}))},WrapAroundEnding:K,XHRLoader:function(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new vh(t)},ZeroCurvatureEnding:Z,ZeroFactor:a,ZeroSlopeEnding:J,ZeroStencilOp:0,sRGBEncoding:it}),fu={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-fu.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*fu.Bounce.In(2*t):.5*fu.Bounce.Out(2*t-1)+.5}}},gu="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},vu=function(){function t(){this._tweens={},this._tweensAddedDuringUpdate={}}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},t.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},t.prototype.update=function(t,e){void 0===t&&(t=gu()),void 0===e&&(e=!1);var i=Object.keys(this._tweens);if(0===i.length)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<i.length;n++){var s=this._tweens[i[n]],r=!e;s&&!1===s.update(t,r)&&!e&&delete this._tweens[i[n]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},t}(),xu={Linear:function(t,e){var i=t.length-1,n=i*e,s=Math.floor(n),r=xu.Utils.Linear;return e<0?r(t[0],t[1],n):e>1?r(t[i],t[i-1],i-n):r(t[s],t[s+1>i?i:s+1],n-s)},Bezier:function(t,e){for(var i=0,n=t.length-1,s=Math.pow,r=xu.Utils.Bernstein,a=0;a<=n;a++)i+=s(1-e,n-a)*s(e,a)*t[a]*r(n,a);return i},CatmullRom:function(t,e){var i=t.length-1,n=i*e,s=Math.floor(n),r=xu.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(s=Math.floor(n=i*(1+e))),r(t[(s-1+i)%i],t[s],t[(s+1)%i],t[(s+2)%i],n-s)):e<0?t[0]-(r(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[i]-(r(t[i],t[i],t[i-1],t[i-1],n-i)-t[i]):r(t[s?s-1:0],t[s],t[i<s+1?i:s+1],t[i<s+2?i:s+2],n-s)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=xu.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){var t=[1];return function(e){var i=1;if(t[e])return t[e];for(var n=e;n>1;n--)i*=n;return t[e]=i,i}}(),CatmullRom:function(t,e,i,n,s){var r=.5*(i-t),a=.5*(n-e),o=s*s;return(2*e-2*i+r+a)*(s*o)+(-3*e+3*i-2*r-a)*o+r*s+e}}},yu=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),bu=new vu,wu=function(){function t(t,e){void 0===e&&(e=bu),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=fu.Linear.None,this._interpolationFunction=xu.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=yu.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.to=function(t,e){return this._valuesEnd=Object.create(t),void 0!==e&&(this._duration=e),this},t.prototype.duration=function(t){return this._duration=t,this},t.prototype.start=function(t){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var e in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==t?"string"==typeof t?gu()+parseFloat(t):t:gu(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},t.prototype._setupProperties=function(t,e,i,n){for(var s in i){var r=t[s],a=Array.isArray(r),o=a?"array":typeof r,l=!a&&Array.isArray(i[s]);if("undefined"!==o&&"function"!==o){if(l){var h=i[s];if(0===h.length)continue;h=h.map(this._handleRelativeValue.bind(this,r)),i[s]=[r].concat(h)}if("object"!==o&&!a||!r||l)void 0===e[s]&&(e[s]=r),a||(e[s]*=1),n[s]=l?i[s].slice().reverse():e[s]||0;else{for(var c in e[s]=a?[]:{},r)e[s][c]=r[c];n[s]=a?[]:{},this._setupProperties(r,e[s],i[s],n[s])}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},t.prototype.pause=function(t){return void 0===t&&(t=gu()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this)),this},t.prototype.resume=function(t){return void 0===t&&(t=gu()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return this._group=t,this},t.prototype.delay=function(t){return this._delayTime=t,this},t.prototype.repeat=function(t){return this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return this._yoyo=t,this},t.prototype.easing=function(t){return this._easingFunction=t,this},t.prototype.interpolation=function(t){return this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(t,e){if(void 0===t&&(t=gu()),void 0===e&&(e=!0),this._isPaused)return!0;var i,n,s=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>s)return!1;e&&this.start(t)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),n=(t-this._startTime)/this._duration,n=0===this._duration||n>1?1:n;var r=this._easingFunction(n);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,r),this._onUpdateCallback&&this._onUpdateCallback(this._object,n),1===n){if(this._repeat>0){for(i in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[i]||(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,o=this._chainedTweens.length;a<o;a++)this._chainedTweens[a].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,i,n){for(var s in i)if(void 0!==e[s]){var r=e[s]||0,a=i[s],o=Array.isArray(t[s]),l=Array.isArray(a);!o&&l?t[s]=this._interpolationFunction(a,n):"object"==typeof a&&a?this._updateProperties(t[s],r,a,n):"number"==typeof(a=this._handleRelativeValue(r,a))&&(t[s]=r+(a-r)*n)}},t.prototype._handleRelativeValue=function(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],i=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof i?this._valuesStartRepeat[t]+parseFloat(i):this._valuesEnd[t],this._valuesEnd[t]=e},t}(),_u=bu;_u.getAll.bind(_u),_u.removeAll.bind(_u),_u.add.bind(_u);var Mu=_u.remove.bind(_u),Su=_u.update.bind(_u);const Tu={frag:document.createDocumentFragment(),colorRing:null,joystick_0:null,joystick_1:null,circular:null,knob:null,svgns:"http://www.w3.org/2000/svg",links:"http://www.w3.org/1999/xlink",htmls:"http://www.w3.org/1999/xhtml",DOM_SIZE:["height","width","top","left","bottom","right","margin-left","margin-right","margin-top","margin-bottom"],SVG_TYPE_D:["pattern","defs","transform","stop","animate","radialGradient","linearGradient","animateMotion","use","filter","feColorMatrix"],SVG_TYPE_G:["svg","rect","circle","path","polygon","text","g","line","foreignObject"],PI:Math.PI,TwoPI:2*Math.PI,pi90:.5*Math.PI,pi60:Math.PI/3,torad:Math.PI/180,todeg:180/Math.PI,clamp:function(t,e,i){return(t=t<e?e:t)>i?i:t},size:{w:240,h:20,p:30,s:8},colors:{text:"#dcdcdc",textOver:"#FFFFFF",txtselectbg:"none",content:"none",background:"rgba(50,50,50,0.5)",backgroundOver:"rgba(50,50,50,0.5)",inputBorder:"#454545",inputHolder:"#808080",inputBorderSelect:"#005AAA",inputBg:"rgba(0,0,0,0.1)",inputOver:"rgba(0,0,0,0.2)",border:"#454545",borderOver:"#5050AA",borderSelect:"#308AFF",button:"#3c3c3c",boolbg:"#181818",boolon:"#C0C0C0",select:"#308AFF",moving:"#03afff",down:"#024699",over:"#024699",over2:"#1c1c1c",action:"#FF3300",stroke:"rgba(11,11,11,0.5)",scroll:"#333333",scrollback:"rgba(0,0,0,0.2)",scrollbackover:"rgba(0,0,0,0.3)",hide:"rgba(0,0,0,0)",groupBorder:"#3e3e3e",buttonBorder:"#4a4a4a",fontFamily:"Consolas,monaco,monospace",fontShadow:"none",fontSize:12,radius:4},css:{basic:"position:absolute; pointer-events:none; box-sizing:border-box; margin:0; padding:0; overflow:hidden; -o-user-select:none; -ms-user-select:none; -khtml-user-select:none; -webkit-user-select:none; -moz-user-select:none;",button:"display:flex; justify-content:center; align-items:center; text-align:center;"},svgs:{group:"M 7 7 L 7 8 8 8 8 7 7 7 M 5 7 L 5 8 6 8 6 7 5 7 M 3 7 L 3 8 4 8 4 7 3 7 M 7 5 L 7 6 8 6 8 5 7 5 M 6 6 L 6 5 5 5 5 6 6 6 M 7 3 L 7 4 8 4 8 3 7 3 M 6 4 L 6 3 5 3 5 4 6 4 M 3 5 L 3 6 4 6 4 5 3 5 M 3 3 L 3 4 4 4 4 3 3 3 Z",arrow:"M 3 8 L 8 5 3 2 3 8 Z",arrowDown:"M 5 8 L 8 3 2 3 5 8 Z",arrowUp:"M 5 2 L 2 7 8 7 5 2 Z",solid:"M 13 10 L 13 1 4 1 1 4 1 13 10 13 13 10 M 11 3 L 11 9 9 11 3 11 3 5 5 3 11 3 Z",body:"M 13 10 L 13 1 4 1 1 4 1 13 10 13 13 10 M 11 3 L 11 9 9 11 3 11 3 5 5 3 11 3 M 5 4 L 4 5 4 10 9 10 10 9 10 4 5 4 Z",vehicle:"M 13 6 L 11 1 3 1 1 6 1 13 3 13 3 11 11 11 11 13 13 13 13 6 M 2.4 6 L 4 2 10 2 11.6 6 2.4 6 M 12 8 L 12 10 10 10 10 8 12 8 M 4 8 L 4 10 2 10 2 8 4 8 Z",articulation:"M 13 9 L 12 9 9 2 9 1 5 1 5 2 2 9 1 9 1 13 5 13 5 9 4 9 6 5 8 5 10 9 9 9 9 13 13 13 13 9 Z",character:"M 13 4 L 12 3 9 4 5 4 2 3 1 4 5 6 5 8 4 13 6 13 7 9 8 13 10 13 9 8 9 6 13 4 M 6 1 L 6 3 8 3 8 1 6 1 Z",terrain:"M 13 8 L 12 7 Q 9.06 -3.67 5.95 4.85 4.04 3.27 2 7 L 1 8 7 13 13 8 M 3 8 Q 3.78 5.420 5.4 6.6 5.20 7.25 5 8 L 7 8 Q 8.39 -0.16 11 8 L 7 11 3 8 Z",joint:"M 7.7 7.7 Q 8 7.45 8 7 8 6.6 7.7 6.3 7.45 6 7 6 6.6 6 6.3 6.3 6 6.6 6 7 6 7.45 6.3 7.7 6.6 8 7 8 7.45 8 7.7 7.7 M 3.35 8.65 L 1 11 3 13 5.35 10.65 Q 6.1 11 7 11 8.28 11 9.25 10.25 L 7.8 8.8 Q 7.45 9 7 9 6.15 9 5.55 8.4 5 7.85 5 7 5 6.54 5.15 6.15 L 3.7 4.7 Q 3 5.712 3 7 3 7.9 3.35 8.65 M 10.25 9.25 Q 11 8.28 11 7 11 6.1 10.65 5.35 L 13 3 11 1 8.65 3.35 Q 7.9 3 7 3 5.7 3 4.7 3.7 L 6.15 5.15 Q 6.54 5 7 5 7.85 5 8.4 5.55 9 6.15 9 7 9 7.45 8.8 7.8 L 10.25 9.25 Z",ray:"M 9 11 L 5 11 5 12 9 12 9 11 M 12 5 L 11 5 11 9 12 9 12 5 M 11.5 10 Q 10.9 10 10.45 10.45 10 10.9 10 11.5 10 12.2 10.45 12.55 10.9 13 11.5 13 12.2 13 12.55 12.55 13 12.2 13 11.5 13 10.9 12.55 10.45 12.2 10 11.5 10 M 9 10 L 10 9 2 1 1 2 9 10 Z",collision:"M 11 12 L 13 10 10 7 13 4 11 2 7.5 5.5 9 7 7.5 8.5 11 12 M 3 2 L 1 4 4 7 1 10 3 12 8 7 3 2 Z",map:"M 13 1 L 1 1 1 13 13 13 13 1 M 12 2 L 12 7 7 7 7 12 2 12 2 7 7 7 7 2 12 2 Z",material:"M 13 1 L 1 1 1 13 13 13 13 1 M 12 2 L 12 7 7 7 7 12 2 12 2 7 7 7 7 2 12 2 Z",texture:"M 13 4 L 13 1 1 1 1 4 5 4 5 13 9 13 9 4 13 4 Z",object:"M 10 1 L 7 4 4 1 1 1 1 13 4 13 4 5 7 8 10 5 10 13 13 13 13 1 10 1 Z",none:"M 9 5 L 5 5 5 9 9 9 9 5 Z",cursor:"M 4 7 L 1 10 1 12 2 13 4 13 7 10 9 14 14 0 0 5 4 7 Z"},setStyle:function(t){for(var e in t)Tu.colors[e]&&(Tu.colors[e]=t[e]);Tu.setText()},setText:function(t,e,i,n){let s=Tu.colors;void 0!==i&&(s.fontFamily=i),void 0!==e&&(s.text=e),void 0!==t&&(s.fontSize=t),Tu.css.txt=Tu.css.basic+"font-family:"+s.fontFamily+"; font-size:"+s.fontSize+"px; color:"+s.text+"; padding:2px 10px; left:0; top:2px; height:16px; width:100px; overflow:hidden; white-space: nowrap;",void 0!==n&&(Tu.css.txt+=" text-shadow:"+n+"; "),"none"!==s.fontShadow&&(Tu.css.txt+=" text-shadow: 1px 1px 1px "+s.fontShadow+";"),Tu.css.txtselect=Tu.css.txt+"display:flex; justify-content:left; align-items:center; text-align:left;padding:2px 5px; border:1px dashed "+s.border+"; background:"+s.txtselectbg+";",Tu.css.item=Tu.css.txt+"position:relative; background:rgba(0,0,0,0.2); margin-bottom:1px;"},cloneColor:function(){return Object.assign({},Tu.colors)},cloneCss:function(){return Object.assign({},Tu.css)},clone:function(t){return t.cloneNode(!0)},setSvg:function(t,e,i,n,s){-1===n?t.setAttributeNS(null,e,i):void 0!==s?t.childNodes[n||0].childNodes[s||0].setAttributeNS(null,e,i):t.childNodes[n||0].setAttributeNS(null,e,i)},setCss:function(t,e){for(let i in e)-1!==Tu.DOM_SIZE.indexOf(i)?t.style[i]=e[i]+"px":t.style[i]=e[i]},set:function(t,e){for(let i in e)"txt"===i&&(t.textContent=e[i]),"link"===i?t.setAttributeNS(Tu.links,"xlink:href",e[i]):t.setAttributeNS(null,i,e[i])},get:function(t,e){if(void 0===e)return t;if(!isNaN(e))return t.childNodes[e];if(e instanceof Array){if(2===e.length)return t.childNodes[e[0]].childNodes[e[1]];if(3===e.length)return t.childNodes[e[0]].childNodes[e[1]].childNodes[e[2]]}},dom:function(t,e,i,n,s){return t=t||"div",-1!==Tu.SVG_TYPE_D.indexOf(t)||-1!==Tu.SVG_TYPE_G.indexOf(t)?"svg"===t?(n=document.createElementNS(Tu.svgns,"svg"),Tu.set(n,i)):(void 0===n&&(n=document.createElementNS(Tu.svgns,"svg")),Tu.addAttributes(n,t,i,s)):n=void 0===n?document.createElementNS(Tu.htmls,t):n.appendChild(document.createElementNS(Tu.htmls,t)),e&&(n.style.cssText=e),void 0===s?n:n.childNodes[s||0]},addAttributes:function(t,e,i,n){let s=document.createElementNS(Tu.svgns,e);return Tu.set(s,i),Tu.get(t,n).appendChild(s),-1!==Tu.SVG_TYPE_G.indexOf(e)&&(s.style.pointerEvents="none"),s},clear:function(t){for(Tu.purge(t);t.firstChild;)t.firstChild.firstChild&&Tu.clear(t.firstChild),t.removeChild(t.firstChild)},purge:function(t){let e,i,n=t.attributes;if(n)for(e=n.length;e--;)i=n[e].name,"function"==typeof t[i]&&(t[i]=null);if(n=t.childNodes,n)for(e=n.length;e--;)Tu.purge(t.childNodes[e])},addSVGGlowEffect:function(){if(null!==document.getElementById("UILGlow"))return;let t=Tu.initUILEffects(),e=Tu.addAttributes(t,"filter",{id:"UILGlow",x:"-20%",y:"-20%",width:"140%",height:"140%"});Tu.addAttributes(e,"feGaussianBlur",{in:"SourceGraphic",stdDeviation:"3",result:"uilBlur"});let i=Tu.addAttributes(e,"feMerge",{});for(let t=0;t<=3;t++)Tu.addAttributes(i,"feMergeNode",{in:"uilBlur"});Tu.addAttributes(i,"feMergeNode",{in:"SourceGraphic"})},initUILEffects:function(){let t=document.getElementById("UILSVGEffects");return null===t&&(t=Tu.dom("svg",void 0,{id:"UILSVGEffects",width:"0",height:"0"}),document.body.appendChild(t)),t},ColorLuma:function(t,e){"n"===t&&(t="#000"),(t=String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;let i,n,s="#";for(n=0;n<3;n++)i=parseInt(t.substr(2*n,2),16),i=Math.round(Math.min(Math.max(0,i+i*e),255)).toString(16),s+=("00"+i).substr(i.length);return s},findDeepInver:function(t){return.3*t[0]+.59*t[1]+.11*t[2]<=.6},lerpColor:function(t,e,i){let n={};for(let s=0;s<3;s++)n[s]=t[s]+(e[s]-t[s])*i;return n},hexToHtml:function(t){return"#"+("000000"+(t=void 0===t?0:t).toString(16)).substr(-6)},htmlToHex:function(t){return t.toUpperCase().replace("#","0x")},u255:function(t,e){return parseInt(t.substring(e,e+2),16)/255},u16:function(t,e){return parseInt(t.substring(e,e+1),16)/15},unpack:function(t){return 7==t.length?[Tu.u255(t,1),Tu.u255(t,3),Tu.u255(t,5)]:4==t.length?[Tu.u16(t,1),Tu.u16(t,2),Tu.u16(t,3)]:void 0},p255:function(t){let e=Math.round(255*t).toString(16);return e.length<2&&(e="0"+e),e},pack:function(t){return"#"+Tu.p255(t[0])+Tu.p255(t[1])+Tu.p255(t[2])},htmlRgb:function(t){return"rgb("+Math.round(255*t[0])+","+Math.round(255*t[1])+","+Math.round(255*t[2])+")"},pad:function(t){return 1==t.length&&(t="0"+t),t},rgbToHex:function(t){let e=Math.round(255*t[0]).toString(16),i=Math.round(255*t[1]).toString(16),n=Math.round(255*t[2]).toString(16);return"#"+Tu.pad(e)+Tu.pad(i)+Tu.pad(n)},hueToRgb:function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t},rgbToHsl:function(t){let e=t[0],i=t[1],n=t[2],s=Math.min(e,i,n),r=Math.max(e,i,n),a=r-s,o=0,l=0,h=(s+r)/2;return h>0&&h<1&&(l=a/(h<.5?2*h:2-2*h)),a>0&&(r==e&&r!=i&&(o+=(i-n)/a),r==i&&r!=n&&(o+=2+(n-e)/a),r==n&&r!=e&&(o+=4+(e-i)/a),o/=6),[o,l,h]},hslToRgb:function(t){let e,i,n=t[0],s=t[1],r=t[2];return 0===s?[r,r,r]:(i=r<=.5?r*(s+1):r+s-r*s,e=2*r-i,[Tu.hueToRgb(e,i,n+.33333),Tu.hueToRgb(e,i,n),Tu.hueToRgb(e,i,n-.33333)])},makeGradiant:function(t,e,i,n){Tu.dom(t,null,e,i,0);let s,r=i.childNodes[0].childNodes.length-1;for(let t=0;t<n.length;t++)s=n[t],Tu.dom("stop",null,{offset:s[0]+"%","stop-color":s[1],"stop-opacity":s[2]},i,[0,r])},makeKnob:function(t){let e=Tu.dom("svg",Tu.css.basic,{viewBox:"0 0 128 128",width:128,height:128,preserveAspectRatio:"none"});Tu.dom("circle","",{cx:64,cy:64,r:34,fill:Tu.colors.button,stroke:"rgba(0,0,0,0.3)","stroke-width":8},e),Tu.dom("path","",{d:"",stroke:Tu.colors.text,"stroke-width":4,fill:"none","stroke-linecap":"round"},e),Tu.dom("circle","",{cx:64,cy:64,r:41,stroke:"rgba(0,0,0,0.1)","stroke-width":7,fill:"none"},e),Tu.dom("path","",{d:"",stroke:"rgba(255,255,255,0.3)","stroke-width":2,fill:"none","stroke-linecap":"round","stroke-opacity":.5},e),Tu.knob=e},makeCircular:function(t){let e=Tu.dom("svg",Tu.css.basic,{viewBox:"0 0 128 128",width:128,height:128,preserveAspectRatio:"none"});Tu.dom("circle","",{cx:64,cy:64,r:40,stroke:"rgba(0,0,0,0.1)","stroke-width":10,fill:"none"},e),Tu.dom("path","",{d:"",stroke:Tu.colors.text,"stroke-width":7,fill:"none","stroke-linecap":"butt"},e),Tu.circular=e},makeJoystick:function(t){let e,i=Math.floor(49),n=Math.floor(.6*i),s=Tu.dom("svg",Tu.css.basic,{viewBox:"0 0 128 128",width:128,height:128,preserveAspectRatio:"none"});if(Tu.dom("defs",null,{},s),Tu.dom("g",null,{},s),0===t){e=[[40,"rgb(0,0,0)",.3],[80,"rgb(0,0,0)",0],[90,"rgb(50,50,50)",.4],[100,"rgb(50,50,50)",0]],Tu.makeGradiant("radialGradient",{id:"grad",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},s,e),e=[[60,"rgb(0,0,0)",.5],[100,"rgb(0,0,0)",0]],Tu.makeGradiant("radialGradient",{id:"gradS",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},s,e);let t=["rgb(40,40,40)","rgb(48,48,48)","rgb(30,30,30)"],r=["rgb(1,90,197)","rgb(3,95,207)","rgb(0,65,167)"];e=[[30,t[0],1],[60,t[1],1],[80,t[1],1],[100,t[2],1]],Tu.makeGradiant("radialGradient",{id:"gradIn",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},s,e),e=[[30,r[0],1],[60,r[1],1],[80,r[1],1],[100,r[2],1]],Tu.makeGradiant("radialGradient",{id:"gradIn2",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},s,e),Tu.dom("circle","",{cx:64,cy:64,r:i,fill:"url(#grad)"},s),Tu.dom("circle","",{cx:69,cy:74,r:n+10,fill:"url(#gradS)"},s),Tu.dom("circle","",{cx:64,cy:64,r:n,fill:"url(#gradIn)"},s),Tu.joystick_0=s}else e=[[69,"rgb(0,0,0)",0],[70,"rgb(0,0,0)",.3],[100,"rgb(0,0,0)",0]],Tu.makeGradiant("radialGradient",{id:"gradX",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},s,e),Tu.dom("circle","",{cx:64,cy:64,r:i,fill:"none",stroke:"rgba(100,100,100,0.25)","stroke-width":"4"},s),Tu.dom("circle","",{cx:64,cy:64,r:n+14,fill:"url(#gradX)"},s),Tu.dom("circle","",{cx:64,cy:64,r:n,fill:"none",stroke:"rgb(100,100,100)","stroke-width":"4"},s),Tu.joystick_1=s},makeColorRing:function(){let t=Tu.dom("svg",Tu.css.basic,{viewBox:"0 0 256 256",width:256,height:256,preserveAspectRatio:"none"});Tu.dom("defs",null,{},t),Tu.dom("g",null,{},t);let e,i,n,s,r,a,o,l,h,c=8/113/24*Math.PI,u=0,d=[];for(a=0;a<=24;++a){if(n=a/24,s=n*Tu.TwoPI,e=.5*(u+s),i=1/Math.cos(.5*(s-u)),r=[Math.sin(u),-Math.cos(u),Math.sin(e)*i,-Math.cos(e)*i,Math.sin(s),-Math.cos(s)],d[1]=Tu.rgbToHex(Tu.hslToRgb([n,1,.5])),a>0){for(o=6;o--;)r[o]=(113*r[o]+128).toFixed(2);l=" M"+r[0]+" "+r[1]+" Q"+r[2]+" "+r[3]+" "+r[4]+" "+r[5],h=[[0,d[0],1],[100,d[1],1]],Tu.makeGradiant("linearGradient",{id:"G"+a,x1:r[0],y1:r[1],x2:r[4],y2:r[5],gradientUnits:"userSpaceOnUse"},t,h),Tu.dom("path","",{d:l,"stroke-width":30,stroke:"url(#G"+a+")","stroke-linecap":"butt"},t,1)}u=s-c,d[0]=d[1]}h=[[0,"#FFFFFF",1],[50,"#FFFFFF",0],[50,"#000000",0],[100,"#000000",1]],Tu.makeGradiant("linearGradient",{id:"GL0",x1:0,y1:128-84.9,x2:0,y2:212.9,gradientUnits:"userSpaceOnUse"},t,h),h=[[0,"#7f7f7f",1],[50,"#7f7f7f",.5],[100,"#7f7f7f",0]],Tu.makeGradiant("linearGradient",{id:"GL1",x1:78.95,y1:0,x2:226,y2:0,gradientUnits:"userSpaceOnUse"},t,h),Tu.dom("g",null,{"transform-origin":"128px 128px",transform:"rotate(0)"},t),Tu.dom("polygon","",{points:"78.95 43.1 78.95 212.85 226 128",fill:"red"},t,2),Tu.dom("polygon","",{points:"78.95 43.1 78.95 212.85 226 128",fill:"url(#GL1)","stroke-width":1,stroke:"url(#GL1)"},t,2),Tu.dom("polygon","",{points:"78.95 43.1 78.95 212.85 226 128",fill:"url(#GL0)","stroke-width":1,stroke:"url(#GL0)"},t,2),Tu.dom("path","",{d:"M 255.75 136.5 Q 256 132.3 256 128 256 123.7 255.75 119.5 L 241 128 255.75 136.5 Z",fill:"none","stroke-width":2,stroke:"#000"},t,2),Tu.dom("circle","",{cx:128,cy:128,r:6,"stroke-width":2,stroke:"#000",fill:"none"},t),Tu.colorRing=t},icon:function(t,e,i){i=i||40,e=e||"#DEDEDE";let n=["<svg xmlns='"+Tu.svgns+"' version='1.1' xmlns:xlink='"+Tu.htmls+"' style='pointer-events:none;' preserveAspectRatio='xMinYMax meet' x='0px' y='0px' width='"+i+"px' height='"+i+"px' viewBox='0 0 256 256'><g>"];switch(t){case"logo":n[1]="<path id='logoin' fill='"+e+"' stroke='none' d='"+Tu.logoFill_d+"'/>";break;case"save":n[1]="<path stroke='"+e+"' stroke-width='4' stroke-linejoin='round' stroke-linecap='round' fill='none' d='M 26.125 17 L 20 22.95 14.05 17 M 20 9.95 L 20 22.95'/><path stroke='"+e,n[1]+="' stroke-width='2.5' stroke-linejoin='round' stroke-linecap='round' fill='none' d='M 32.6 23 L 32.6 25.5 Q 32.6 28.5 29.6 28.5 L 10.6 28.5 Q 7.6 28.5 7.6 25.5 L 7.6 23'/>"}return n[2]="</g></svg>",n.join("\n")},logoFill_d:["M 171 150.75 L 171 33.25 155.5 33.25 155.5 150.75 Q 155.5 162.2 147.45 170.2 139.45 178.25 128 178.25 116.6 178.25 108.55 170.2 100.5 162.2 100.5 150.75 ","L 100.5 33.25 85 33.25 85 150.75 Q 85 168.65 97.55 181.15 110.15 193.75 128 193.75 145.9 193.75 158.4 181.15 171 168.65 171 150.75 ","M 200 33.25 L 184 33.25 184 150.8 Q 184 174.1 167.6 190.4 151.3 206.8 128 206.8 104.75 206.8 88.3 190.4 72 174.1 72 150.8 L 72 33.25 56 33.25 56 150.75 ","Q 56 180.55 77.05 201.6 98.2 222.75 128 222.75 157.8 222.75 178.9 201.6 200 180.55 200 150.75 L 200 33.25 Z"].join("\n")};Tu.setText();const Au=Tu,Eu={ui:[],ID:null,lock:!1,wlock:!1,current:-1,needReZone:!0,isEventsInit:!1,prevDefault:["contextmenu","mousedown","mousemove","mouseup"],pointerEvent:["pointerdown","pointermove","pointerup"],xmlserializer:new XMLSerializer,tmpTime:null,tmpImage:null,oldCursor:"auto",input:null,parent:null,firstImput:!0,hiddenImput:null,hiddenSizer:null,hasFocus:!1,startInput:!1,inputRange:[0,0],cursorId:0,str:"",pos:0,startX:-1,moveX:-1,debugInput:!1,isLoop:!1,listens:[],e:{type:null,clientX:0,clientY:0,keyCode:NaN,key:null,delta:0},isMobile:!1,add:function(t){Eu.ui.push(t),Eu.getZone(t),Eu.isEventsInit||Eu.initEvents()},testMobile:function(){let t=navigator.userAgent;return!!(t.match(/Android/i)||t.match(/webOS/i)||t.match(/iPhone/i)||t.match(/iPad/i)||t.match(/iPod/i)||t.match(/BlackBerry/i)||t.match(/Windows Phone/i))},remove:function(t){let e=Eu.ui.indexOf(t);-1!==e&&(Eu.removeListen(t),Eu.ui.splice(e,1)),0===Eu.ui.length&&Eu.removeEvents()},initEvents:function(){if(Eu.isEventsInit)return;let t=document.body;Eu.isMobile=Eu.testMobile(),Eu.isMobile?(t.addEventListener("touchstart",Eu,!1),t.addEventListener("touchend",Eu,!1),t.addEventListener("touchmove",Eu,!1)):(t.addEventListener("contextmenu",Eu,!1),t.addEventListener("wheel",Eu,!1),document.addEventListener("click",Eu,!1),t.addEventListener("pointerdown",Eu,!1),document.addEventListener("pointermove",Eu,!1),document.addEventListener("pointerup",Eu,!1)),window.addEventListener("keydown",Eu,!1),window.addEventListener("keyup",Eu,!1),window.addEventListener("resize",Eu.resize,!1),Eu.isEventsInit=!0},removeEvents:function(){if(!Eu.isEventsInit)return;let t=document.body;Eu.isMobile?(t.removeEventListener("touchstart",Eu,!1),t.removeEventListener("touchend",Eu,!1),t.removeEventListener("touchmove",Eu,!1)):(t.removeEventListener("contextmenu",Eu,!1),t.removeEventListener("wheel",Eu,!1),document.removeEventListener("click",Eu,!1),t.removeEventListener("pointerdown",Eu,!1),document.removeEventListener("pointermove",Eu,!1),document.removeEventListener("pointerup",Eu,!1)),window.removeEventListener("keydown",Eu),window.removeEventListener("keyup",Eu),window.removeEventListener("resize",Eu.resize),Eu.isEventsInit=!1},resize:function(){Eu.needReZone=!0;let t,e=Eu.ui.length;for(;e--;)t=Eu.ui[e],t.isGui&&!t.isCanvasOnly&&t.autoResize&&t.setHeight()},out:function(){console.log("im am out"),Eu.clearOldID()},in:function(){console.log("im am in")},handleEvent:function(t){if(-1!==t.type.indexOf(Eu.prevDefault)&&t.preventDefault(),-1!==t.type.indexOf(Eu.pointerEvent)&&("mouse"!==t.pointerType||"pen"!==t.pointerType))return;if("contextmenu"===t.type)return;Eu.findZone();let e=Eu.e;"keydown"===t.type&&Eu.keydown(t),"keyup"===t.type&&Eu.keyup(t),"wheel"===t.type?e.delta=t.deltaY>0?1:-1:e.delta=0,e.clientX=t.clientX||0,e.clientY=t.clientY||0,e.type=t.type,Eu.isMobile&&(t.touches&&t.touches.length>0&&(e.clientX=t.touches[0].clientX||0,e.clientY=t.touches[0].clientY||0),"touchstart"===t.type&&(e.type="mousedown"),"touchend"===t.type&&(e.type="mouseup"),"touchmove"===t.type&&(e.type="mousemove")),"pointerdown"===t.type&&(e.type="mousedown"),"pointerup"===t.type&&(e.type="mouseup"),"pointermove"===t.type&&(e.type="mousemove"),"mousedown"===e.type&&(Eu.lock=!0),"mouseup"===e.type&&(Eu.lock=!1),Eu.isMobile&&"mousedown"===e.type&&Eu.findID(e),"mousemove"!==e.type||Eu.lock||Eu.findID(e),null!==Eu.ID&&(Eu.ID.isCanvasOnly&&(e.clientX=Eu.ID.mouse.x,e.clientY=Eu.ID.mouse.y),Eu.ID.handleEvent(e)),Eu.isMobile&&"mouseup"===e.type&&Eu.clearOldID()},findID:function(t){let e,i,n,s=Eu.ui.length,r=-1;for(;s--;)if(e=Eu.ui[s],e.isCanvasOnly?(i=e.mouse.x,n=e.mouse.y):(i=t.clientX,n=t.clientY),Eu.onZone(e,i,n)){r=s,r!==Eu.current&&(Eu.clearOldID(),Eu.current=r,Eu.ID=e);break}-1===r&&Eu.clearOldID()},clearOldID:function(){Eu.ID&&(Eu.current=-1,Eu.ID.reset(),Eu.ID=null,Eu.cursor())},calcUis:function(t,e,i){let n,s,r=t.length,a=0,o=0;for(s=0;s<r;s++)n=t[s],n.zone.w=n.w,n.zone.h=n.h,n.autoWidth?(n.zone.x=e.x,n.zone.y=i,i+=n.h+1):(0===a&&(i+=n.h+1),n.zone.x=e.x+a,n.zone.y=0===a?i-n.h:o,o=n.zone.y,a+=n.w,a+n.w>e.w&&(a=0)),n.isGroup&&n.calcUis()},findTarget:function(t,e){let i=t.length;for(;i--;)if(Eu.onZone(t[i],e.clientX,e.clientY))return i;return-1},findZone:function(t){if(Eu.needReZone||t){for(var e,i=Eu.ui.length;i--;)e=Eu.ui[i],Eu.getZone(e),e.isGui&&e.calcUis();Eu.needReZone=!1}},onZone:function(t,e,i){if(void 0===e||void 0===i)return!1;let n=t.zone,s=e-n.x,r=i-n.y,a=s>=0&&r>=0&&s<=n.w&&r<=n.h;return a?t.local.set(s,r):t.local.neg(),a},getZone:function(t){if(t.isCanvasOnly)return;let e=t.getDom().getBoundingClientRect();t.zone={x:e.left,y:e.top,w:e.width,h:e.height}},cursor:function(t){(t=t||"auto")!==Eu.oldCursor&&(document.body.style.cursor=t,Eu.oldCursor=t)},toCanvas:function(t,e,i,n){if(n&&null!==Eu.tmpTime&&(clearTimeout(Eu.tmpTime),Eu.tmpTime=null),null!==Eu.tmpTime)return;Eu.lock&&(Eu.tmpTime=setTimeout((function(){Eu.tmpTime=null}),10));let s=!1;e===t.canvas.width&&i===t.canvas.height||(s=!0),null===Eu.tmpImage&&(Eu.tmpImage=new Image);let r=Eu.tmpImage,a=Eu.xmlserializer.serializeToString(t.content),o='<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+i+'"><foreignObject style="pointer-events: none; left:0;" width="100%" height="100%">'+a+"</foreignObject></svg>";r.onload=function(){let n=t.canvas.getContext("2d");s?(t.canvas.width=e,t.canvas.height=i):n.clearRect(0,0,e,i),n.drawImage(this,0,0),t.onDraw()},r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(o),r.crossOrigin=""},setHidden:function(){if(null===Eu.hiddenImput){let t=Eu.debugInput?"":"opacity:0; zIndex:0;",e=Eu.parent.css.txt+"padding:0; width:auto; height:auto; text-shadow:none;";e+="left:10px; top:auto; border:none; color:#FFF; background:#000;"+t,Eu.hiddenImput=document.createElement("input"),Eu.hiddenImput.type="text",Eu.hiddenImput.style.cssText=e+"bottom:30px;"+(Eu.debugInput?"":"transform:scale(0);"),Eu.hiddenSizer=document.createElement("div"),Eu.hiddenSizer.style.cssText=e+"bottom:60px;",document.body.appendChild(Eu.hiddenImput),document.body.appendChild(Eu.hiddenSizer)}Eu.hiddenImput.style.width=Eu.input.clientWidth+"px",Eu.hiddenImput.value=Eu.str,Eu.hiddenSizer.innerHTML=Eu.str,Eu.hasFocus=!0},clearHidden:function(t){null!==Eu.hiddenImput&&(Eu.hasFocus=!1)},clickPos:function(t){let e=Eu.str.length,i=0,n=0;for(;e--&&(i+=Eu.textWidth(Eu.str[n]),!(i>=t));)n++;return n},upInput:function(t,e){if(null===Eu.parent)return!1;let i=!1;if(e){let e=Eu.clickPos(t);Eu.moveX=e,-1===Eu.startX?(Eu.startX=e,Eu.cursorId=e,Eu.inputRange=[Eu.startX,Eu.startX]):Eu.moveX!==Eu.startX&&(Eu.startX>Eu.moveX?Eu.inputRange=[Eu.moveX,Eu.startX]:Eu.inputRange=[Eu.startX,Eu.moveX]),i=!0}else-1!==Eu.startX&&(Eu.hasFocus=!0,Eu.hiddenImput.focus(),Eu.hiddenImput.selectionStart=Eu.inputRange[0],Eu.hiddenImput.selectionEnd=Eu.inputRange[1],Eu.startX=-1,i=!0);return i&&Eu.selectParent(),i},selectParent:function(){var t=Eu.textWidth(Eu.str.substring(0,Eu.cursorId)),e=Eu.textWidth(Eu.str.substring(0,Eu.inputRange[0])),i=Eu.textWidth(Eu.str.substring(Eu.inputRange[0],Eu.inputRange[1]));Eu.parent.select(t,e,i)},textWidth:function(t){return null===Eu.hiddenSizer?0:(t=t.replace(/ /g,"&nbsp;"),Eu.hiddenSizer.innerHTML=t,Eu.hiddenSizer.clientWidth)},clearInput:function(){null!==Eu.parent&&(Eu.firstImput||Eu.parent.validate(!0),Eu.clearHidden(),Eu.parent.unselect(),Eu.input.style.background=Eu.parent.colors.inputBg,Eu.input.style.borderColor=Eu.parent.colors.inputBorder,Eu.parent.isEdit=!1,Eu.input=null,Eu.parent=null,Eu.str="",Eu.firstImput=!0)},setInput:function(t,e){Eu.clearInput(),Eu.input=t,Eu.parent=e,Eu.input.style.background=Eu.parent.colors.inputOver,Eu.input.style.borderColor=Eu.parent.colors.inputBorderSelect,Eu.str=Eu.input.textContent,Eu.setHidden()},keydown:function(t){if(null===Eu.parent)return;let e=t.which;t.shiftKey,Eu.firstImput=!1,Eu.hasFocus&&(window.focus(),Eu.hiddenImput.focus()),Eu.parent.isEdit=!0,13===e?Eu.clearInput():Eu.input.isNum?t.keyCode>47&&t.keyCode<58||t.keyCode>95&&t.keyCode<106||190===t.keyCode||110===t.keyCode||8===t.keyCode||109===t.keyCode?Eu.hiddenImput.readOnly=!1:Eu.hiddenImput.readOnly=!0:Eu.hiddenImput.readOnly=!1},keyup:function(t){null!==Eu.parent&&(Eu.str=Eu.hiddenImput.value,Eu.parent.allEqual?Eu.parent.sameStr(Eu.str):Eu.input.textContent=Eu.str,Eu.cursorId=Eu.hiddenImput.selectionStart,Eu.inputRange=[Eu.hiddenImput.selectionStart,Eu.hiddenImput.selectionEnd],Eu.selectParent(),Eu.parent.validate())},loop:function(){Eu.isLoop&&requestAnimationFrame(Eu.loop),Eu.update()},update:function(){let t=Eu.listens.length;for(;t--;)Eu.listens[t].listening()},removeListen:function(t){let e=Eu.listens.indexOf(t);-1!==e&&Eu.listens.splice(e,1),0===Eu.listens.length&&(Eu.isLoop=!1)},addListen:function(t){return-1===Eu.listens.indexOf(t)&&(Eu.listens.push(t),Eu.isLoop||(Eu.isLoop=!0,Eu.loop()),!0)}},Lu=Eu;class Cu{constructor(t=0,e=0){this.x=t,this.y=e}set(t,e){return this.x=t,this.y=e,this}divide(t){return this.x/=t.x,this.y/=t.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divideScalar(t){return this.multiplyScalar(1/t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}angle(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t}addScalar(t){return this.x+=t,this.y+=t,this}negate(){return this.x*=-1,this.y*=-1,this}neg(){return this.x=-1,this.y=-1,this}isZero(){return 0===this.x&&0===this.y}copy(t){return this.x=t.x,this.y=t.y,this}equals(t){return t.x===this.x&&t.y===this.y}nearEquals(t,e){return t.x.toFixed(e)===this.x.toFixed(e)&&t.y.toFixed(e)===this.y.toFixed(e)}lerp(t,e){return null===t?(this.x-=this.x*e,this.y-=this.y*e):(this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e),this}}class Pu{constructor(t={}){if(this.main=t.main||null,this.isUI=t.isUI||!1,this.group=null,this.isListen=!1,this.ontop=!!t.ontop&&t.ontop,this.css=this.main?this.main.css:Au.css,this.colors=this.main?this.main.colors:Au.colors,this.defaultBorderColor=this.colors.border,this.svgs=Au.svgs,this.isSpace=t.isSpace||!1,this.zone={x:0,y:0,w:0,h:0},this.local=(new Cu).neg(),this.isCanvasOnly=!1,this.isSelect=!1,this.p=void 0!==t.p?t.p:Au.size.p,this.w=this.isUI?this.main.size.w:Au.size.w,void 0!==t.w&&(this.w=t.w),this.h=this.isUI?this.main.size.h:Au.size.h,void 0!==t.h&&(this.h=t.h),this.isSpace||(this.h=this.h<11?11:this.h),this.autoWidth=t.auto||!0,this.isOpen=!1,this.radius=t.radius||this.colors.radius,this.isNumber=!1,this.noNeg=t.noNeg||!1,this.allEqual=t.allEqual||!1,this.mono=!1,this.isEdit=!1,this.simple=t.simple||!1,this.simple&&(this.sa=0),this.setSize(this.w),void 0!==t.sa&&(this.sa=t.sa),void 0!==t.sb&&(this.sb=t.sb),this.simple&&(this.sb=this.w-this.sa),this.sc=void 0===t.sc?47:t.sc,this.objectLink=null,this.isSend=!1,this.val=null,this.bg=this.colors.background,this.bgOver=this.colors.backgroundOver,void 0!==t.bg&&(this.bg=t.bg,this.bgOver=t.bg),void 0!==t.bgOver&&(this.bgOver=t.bgOver),this.titleColor=t.titleColor||this.colors.text,this.fontColor=t.fontColor||this.colors.text,this.fontSelect=t.fontSelect||this.colors.textOver,void 0!==t.color&&(this.fontColor=t.color),this.colorPlus=Au.ColorLuma(this.fontColor,.3),this.txt=t.name||"",this.name=t.rename||this.txt,this.target=t.target||null,this.callback=void 0===t.callback?null:t.callback,this.endCallback=null,null===this.callback&&this.isUI&&null!==this.main.callback&&(this.callback=this.main.callback),this.c=[],this.s=[],this.c[0]=Au.dom("div",this.css.basic+"position:relative; height:20px; float:left; overflow:hidden;"),this.s[0]=this.c[0].style,this.isUI&&(this.s[0].marginBottom="1px"),this.simple||(this.c[1]=Au.dom("div",this.css.txt),this.s[1]=this.c[1].style,this.c[1].textContent=this.name,this.s[1].color=this.titleColor),t.pos){this.s[0].position="absolute";for(let e in t.pos)this.s[0][e]=t.pos[e];this.mono=!0}t.css&&(this.s[0].cssText=t.css)}init(){this.zone.h=this.h;let t=this.s,e=this.c;t[0].height=this.h+"px",this.isUI&&(t[0].background=this.bg),void 0!==e[1]&&this.autoWidth&&(t[1]=e[1].style,t[1].height=this.h-4+"px",t[1].lineHeight=this.h-8+"px");let i=Au.frag;for(let n=1,s=e.length;n!==s;n++)void 0!==e[n]&&(i.appendChild(e[n]),t[n]=e[n].style);let n=null!==this.target?this.target:this.isUI?this.main.inner:document.body;this.ontop?n.insertAdjacentElement("afterbegin",e[0]):n.appendChild(e[0]),e[0].appendChild(i),this.rSize(),this.isUI||(this.c[0].style.pointerEvents="auto",Lu.add(this))}dom(t,e,i,n,s){return Au.dom(t,e,i,n,s)}setSvg(t,e,i,n,s){Au.setSvg(t,e,i,n,s)}setCss(t,e){Au.setCss(t,e)}clamp(t,e,i){return Au.clamp(t,e,i)}getColorRing(){return Au.colorRing||Au.makeColorRing(),Au.clone(Au.colorRing)}getJoystick(t){return Au["joystick_"+t]||Au.makeJoystick(t),Au.clone(Au["joystick_"+t])}getCircular(t){return Au.circular||Au.makeCircular(t),Au.clone(Au.circular)}getKnob(t){return Au.knob||Au.makeKnob(t),Au.clone(Au.knob)}cursor(t){Lu.cursor(t)}update(){}reset(){}getDom(){return this.c[0]}uiout(){this.isSpace||this.s&&(this.s[0].background=this.bg)}uiover(){this.isSpace||this.s&&(this.s[0].background=this.bgOver)}rename(t){void 0!==this.c[1]&&(this.c[1].textContent=t)}listen(){return this.isListen=Lu.addListen(this),this}listening(){null!==this.objectLink&&(this.isSend||this.isEdit||this.setValue(this.objectLink[this.val]))}setValue(t){this.isNumber?this.value=this.numValue(t):this.value=t,this.update()}onChange(t){if(!this.isSpace)return this.callback=t||null,this}onFinishChange(t){if(!this.isSpace)return this.callback=null,this.endCallback=t,this}send(t){(t=t||this.value)instanceof Array&&1===t.length&&(t=t[0]),this.isSend=!0,null!==this.objectLink&&(this.objectLink[this.val]=t),this.callback&&this.callback(t,this.val),this.isSend=!1}sendEnd(t){(t=t||this.value)instanceof Array&&1===t.length&&(t=t[0]),this.endCallback&&this.endCallback(t),null!==this.objectLink&&(this.objectLink[this.val]=t)}clear(t){this.isListen&&Lu.removeListen(this),Au.clear(this.c[0]),t||(null!==this.target?null!==this.group?this.group.clearOne(this):this.target.removeChild(this.c[0]):this.isUI?this.main.clearOne(this):document.body.removeChild(this.c[0]),this.isUI||Lu.remove(this)),this.c=null,this.s=null,this.callback=null,this.target=null,this.isListen=!1}setSize(t){if(this.autoWidth)if(this.w=t,this.simple)this.sb=this.w-this.sa;else{let t=this.w*(this.p/100);this.sa=Math.floor(t+10),this.sb=Math.floor(this.w-t-20)}}rSize(){this.autoWidth&&(this.s[0].width=this.w+"px",this.simple||(this.s[1].width=this.sa+"px"))}setTypeNumber(t){let e;switch(this.isNumber=!0,this.value=0,void 0!==t.value&&("string"==typeof t.value?this.value=1*t.value:this.value=t.value),this.min=void 0===t.min?-1/0:t.min,this.max=void 0===t.max?1/0:t.max,this.precision=void 0===t.precision?2:t.precision,this.precision){case 0:e=1;break;case 1:e=.1;break;case 2:e=.01;break;case 3:e=.001;break;case 4:e=1e-4;break;case 5:e=1e-5}this.step=void 0===t.step?e:t.step,this.range=this.max-this.min,this.value=this.numValue(this.value)}numValue(t){return this.noNeg&&(t=Math.abs(t)),1*Math.min(this.max,Math.max(this.min,t)).toFixed(this.precision)}handleEvent(t){if(!this.isSpace)return this[t.type](t)}wheel(t){return!1}mousedown(t){return!1}mousemove(t){return!1}mouseup(t){return!1}keydown(t){return!1}click(t){return!1}keyup(t){return!1}setReferency(t,e){this.objectLink=t,this.val=e}display(t){t=t||!1,this.s[0].display=t?"block":"none"}open(){this.isOpen||(this.isOpen=!0)}close(){this.isOpen&&(this.isOpen=!1)}needZone(){Lu.needReZone=!0}rezone(){Lu.needReZone=!0}select(){}unselect(){}setInput(t){Lu.setInput(t,this)}upInput(t,e){return Lu.upInput(t,e)}selected(t){this.isSelect=t||!1}}class Ru extends Pu{constructor(t={}){if(super(t),this.value=t.value||!1,this.model=void 0!==t.mode?t.mode:0,this.onName=t.rename||this.txt,t.onName&&(t.onname=t.onName),t.onname&&(this.onName=t.onname),this.buttonColor=t.bColor||this.colors.button,this.inh=t.inh||Math.floor(.8*this.h),this.inw=t.inw||36,0===this.model){let t=Math.floor(.5*this.h)-.5*(this.inh-2);this.c[2]=this.dom("div",this.css.basic+"background:"+this.colors.boolbg+"; height:"+(this.inh-2)+"px; width:"+this.inw+"px; top:"+t+"px; border-radius:10px; border:2px solid "+this.boolbg),this.c[3]=this.dom("div",this.css.basic+"height:"+(this.inh-6)+"px; width:16px; top:"+(t+2)+"px; border-radius:10px; background:"+this.buttonColor+";")}else this.p=0,this.c[1].textContent="",this.c[2]=this.dom("div",this.css.txt+this.css.button+"top:1px; background:"+this.colors.button+"; height:"+(this.h-2)+"px; border:"+this.colors.buttonBorder+"; border-radius:"+this.radius+"px;");this.stat=-1,this.mode(this.value?2:1),this.init(),this.update()}mousedown(t){return this.value=!this.value,this.update(),this.send(),this.mousemove(t)}mousemove(t){return this.cursor("pointer"),this.mode(this.value?4:3)}reset(){return this.cursor(),this.mode(this.value?2:1)}mode(t){let e=!1;if(this.stat!==t){if(0!==this.model){let e=this.c[2].style;switch(t){case 1:this.stat=1,e.color=this.fontColor,e.background=this.colors.button;break;case 2:this.stat=2,e.color=this.fontSelect,e.background=this.colors.select;break;case 3:this.stat=3,e.color=this.fontSelect,e.background=this.colors.over2;break;case 4:this.stat=4,e.color=this.fontSelect,e.background=this.colors.over}this.c[2].innerHTML=this.value?this.onName:this.name}else this.c[2].style.background=this.value?this.colors.boolon:this.colors.boolbg,this.c[2].style.borderColor=this.value?this.colors.boolon:this.colors.boolbg,this.c[3].style.marginLeft=this.value?"17px":"2px",this.c[1].textContent=this.value?this.onName:this.name;e=!0}return e}update(){}rSize(){super.rSize();let t=this.s,e=this.w-10-this.inw;0===this.model?(t[2].left=e+"px",t[3].left=e+"px"):(t[2].left=this.sa+"px",t[2].width=this.w-20+"px")}}class Fu extends Pu{constructor(t={}){super(t),this.value=!1,this.values=t.value||this.txt,this.onName=t.onName||"",this.on=!1,"string"==typeof this.values&&(this.values=[this.values]),this.isDown=!1,this.isLink=t.link||!1,this.cc=[this.colors.button,this.colors.select,this.colors.down],void 0!==t.cBg&&(this.cc[0]=t.cBg),void 0!==t.bColor&&(this.cc[0]=t.bColor),void 0!==t.cSelect&&(this.cc[1]=t.cSelect),void 0!==t.cDown&&(this.cc[2]=t.cDown),this.isLoadButton=t.loader||!1,this.isDragButton=t.drag||!1,this.isDragButton&&(this.isLoadButton=!0),this.lng=this.values.length,this.tmp=[],this.stat=[];for(let t=0;t<this.lng;t++)this.c[t+2]=this.dom("div",this.css.txt+this.css.button+"top:1px; background:"+this.cc[0]+"; height:"+(this.h-2)+"px; border:"+this.colors.buttonBorder+"; border-radius:"+this.radius+"px;"),this.c[t+2].style.color=this.fontColor,this.c[t+2].innerHTML=this.values[t],this.stat[t]=1;void 0!==this.c[1]&&(this.c[1].textContent=""),this.isLoadButton&&this.initLoader(),this.isDragButton&&(this.lng++,this.initDrager()),""!==this.onName&&(this.values[0]=this.on),this.init()}onOff(){this.on=!this.on,this.c[2].innerHTML=this.on?this.onName:this.txt}testZone(t){let e=this.local;if(-1===e.x&&-1===e.y)return"";let i=this.lng,n=this.tmp;for(;i--;)if(e.x>n[i][0]&&e.x<n[i][2])return i+2;return""}click(t){if(""!==this.onName&&this.onOff(),this.isLink){let e=this.testZone(t);return!!e&&(this.value=this.values[e-2],this.send(),this.reset())}}mouseup(t){return!!this.isDown&&(this.value=!1,this.isDown=!1,this.mousemove(t))}mousedown(t){if(this.isLink)return!1;let e=this.testZone(t);return!!e&&(this.isDown=!0,this.value=this.values[e-2],this.isLoadButton||this.send(),this.mousemove(t))}mousemove(t){let e=!1,i=this.testZone(t);return""!==i?(this.cursor("pointer"),e=this.modes(this.isDown?3:2,i)):e=this.reset(),e}modes(t,e){let i,n=!1;for(let s=0;s<this.lng;s++)i=s===e-2?this.mode(t,s+2):this.mode(1,s+2),i&&(n=!0);return n}mode(t,e){let i=!1,n=e-2;if(this.stat[n]!==t){switch(t){case 1:this.stat[n]=1,this.s[n+2].color=this.fontColor,this.s[n+2].background=this.cc[0];break;case 2:this.stat[n]=2,this.s[n+2].color=this.fontSelect,this.s[n+2].background=this.cc[1];break;case 3:this.stat[n]=3,this.s[n+2].color=this.fontSelect,this.s[n+2].background=this.cc[2]}i=!0}return i}reset(){return this.cursor(),this.modes(1,2)}dragover(t){t.preventDefault(),this.s[4].borderColor=this.colors.select,this.s[4].color=this.colors.select}dragend(t){t.preventDefault(),this.s[4].borderColor=this.fontColor,this.s[4].color=this.fontColor}drop(t){t.preventDefault(),this.dragend(t),this.fileSelect(t.dataTransfer.files[0])}initDrager(){this.c[4]=this.dom("div",this.css.txt+" text-align:center; line-height:"+(this.h-8)+"px; border:1px dashed "+this.fontColor+"; top:2px;  height:"+(this.h-4)+"px; border-radius:"+this.radius+"px; pointer-events:auto;"),this.c[4].textContent="DRAG",this.c[4].addEventListener("dragover",function(t){this.dragover(t)}.bind(this),!1),this.c[4].addEventListener("dragend",function(t){this.dragend(t)}.bind(this),!1),this.c[4].addEventListener("dragleave",function(t){this.dragend(t)}.bind(this),!1),this.c[4].addEventListener("drop",function(t){this.drop(t)}.bind(this),!1)}initLoader(){this.c[3]=this.dom("input",this.css.basic+"top:0px; opacity:0; height:"+this.h+"px; pointer-events:auto; cursor:pointer;"),this.c[3].name="loader",this.c[3].type="file",this.c[3].addEventListener("change",function(t){this.fileSelect(t.target.files[0])}.bind(this),!1)}fileSelect(t){if(void 0===t)return;let e=new FileReader,i=t.name,n=i.substring(i.lastIndexOf(".")+1,i.length);-1!==["png","jpg","mp4","webm","ogg"].indexOf(n)?e.readAsDataURL(t):-1!==["sea","z","hex","bvh","BVH","glb"].indexOf(n)?e.readAsArrayBuffer(t):e.readAsText(t),e.onload=function(t){this.callback&&this.callback(t.target.result,i,n)}.bind(this)}label(t,e){e=e||2,this.c[e].textContent=t}icon(t,e,i){i=i||2,this.s[i].padding=(e||0)+"px 0px",this.c[i].innerHTML=t}rSize(){super.rSize();let t=this.s,e=this.sb,i=this.sa,n=this.lng,s=Math.floor((e-3*(n-1))/n);for(;n--;)this.tmp[n]=[Math.floor(i+s*n+3*n),s],this.tmp[n][2]=this.tmp[n][0]+this.tmp[n][1],t[n+2].left=this.tmp[n][0]+"px",t[n+2].width=this.tmp[n][1]+"px";this.isDragButton&&(t[4].left=i+s+3+"px",t[4].width=s+"px"),this.isLoadButton&&(t[3].left=i+"px",t[3].width=s+"px")}}class Iu extends Pu{constructor(t={}){super(t),this.isCyclic=t.cyclic||!1,this.model=t.stype||0,void 0!==t.mode&&(this.model=t.mode),this.autoWidth=!1,this.buttonColor=this.colors.button,this.setTypeNumber(t),this.radius=.5*this.w,this.twoPi=2*Math.PI,this.pi90=.5*Math.PI,this.offset=new Cu,this.h=t.h||this.w+10,this.top=0,this.c[0].style.width=this.w+"px",void 0!==this.c[1]&&(this.c[1].style.width=this.w+"px",this.c[1].style.textAlign="center",this.top=10,this.h+=10),this.percent=0,this.cmode=0,this.c[2]=this.dom("div",this.css.txt+"text-align:center; top:"+(this.h-20)+"px; width:"+this.w+"px; color:"+this.fontColor),this.c[3]=this.getCircular(),this.setSvg(this.c[3],"d",this.makePath(),1),this.setSvg(this.c[3],"stroke",this.fontColor,1),this.setSvg(this.c[3],"viewBox","0 0 "+this.w+" "+this.w),this.setCss(this.c[3],{width:this.w,height:this.w,left:0,top:this.top}),this.init(),this.update()}mode(t){if(this.cmode===t)return!1;switch(t){case 0:if(this.s[2].color=this.fontColor,this.setSvg(this.c[3],"stroke","rgba(0,0,0,0.1)",0),this.model>0){let t=Au.pack(Au.lerpColor(Au.unpack(Au.ColorLuma(this.fontColor,-.75)),Au.unpack(this.fontColor),this.percent));this.setSvg(this.c[3],"stroke",t,1)}else this.setSvg(this.c[3],"stroke",this.fontColor,1);break;case 1:if(this.s[2].color=this.colorPlus,this.setSvg(this.c[3],"stroke","rgba(0,0,0,0.3)",0),this.model>0){let t=Au.pack(Au.lerpColor(Au.unpack(Au.ColorLuma(this.fontColor,-.75)),Au.unpack(this.fontColor),this.percent));this.setSvg(this.c[3],"stroke",t,1)}else this.setSvg(this.c[3],"stroke",this.colorPlus,1)}return this.cmode=t,!0}reset(){this.isDown=!1}testZone(t){let e=this.local;return-1===e.x&&-1===e.y?"":e.y<=this.c[1].offsetHeight?"title":e.y>this.h-this.c[2].offsetHeight?"text":"circular"}mouseup(t){return this.isDown=!1,this.sendEnd(),this.mode(0)}mousedown(t){return this.isDown=!0,this.old=this.value,this.oldr=null,this.mousemove(t),this.mode(1)}mousemove(t){if(this.isDown){var e=this.offset;if(e.x=this.radius-(t.clientX-this.zone.x),e.y=this.radius-(t.clientY-this.zone.y-this.top),this.r=e.angle()-this.pi90,this.r=(this.r%this.twoPi+this.twoPi)%this.twoPi,null!==this.oldr){var i=this.r-this.oldr;this.r=Math.abs(i)>Math.PI?this.oldr:this.r,i>6&&(this.r=0),i<-6&&(this.r=this.twoPi)}var n=1/this.twoPi,s=this.r*n,r=this.range*s+this.min-this.old;(r>=this.step||r<=this.step)&&(r=~~(r/this.step),this.value=this.numValue(this.old+r*this.step),this.update(!0),this.old=this.value,this.oldr=this.r)}}wheel(t){if("circular"===this.testZone(t)){let e=this.value-this.step*t.delta;return e>this.max?e=this.isCyclic?this.min:this.max:e<this.min&&(e=this.isCyclic?this.max:this.min),this.setValue(e),this.old=e,this.update(!0),!0}return!1}makePath(){var t=this.percent*this.twoPi-.001,e=40+40*Math.sin(t)+24,i=40-40*Math.cos(t)+24;return"M 64,24 A 40,40 0 "+(t>Math.PI?1:0)+" 1 "+e+","+i}update(t){if(this.c[2].textContent=this.value,this.percent=(this.value-this.min)/this.range,this.setSvg(this.c[3],"d",this.makePath(),1),this.model>0){let t=Au.pack(Au.lerpColor(Au.unpack(Au.ColorLuma(this.fontColor,-.75)),Au.unpack(this.fontColor),this.percent));this.setSvg(this.c[3],"stroke",t,1)}t&&this.send()}}class Du extends Pu{constructor(t={}){super(t),this.ctype=t.ctype||"hex",this.wfixe=256,this.cw=this.sb>256?256:this.sb,null!=t.cw&&(this.cw=t.cw),this.side=t.side||"down",this.up="down"===this.side?0:1,this.baseH=this.h,this.offset=new Cu,this.decal=new Cu,this.pp=new Cu,this.c[2]=this.dom("div",this.css.txt+"height:"+(this.h-4)+"px;border-radius:"+this.radius+"px; line-height:"+(this.h-8)+"px;"),this.s[2]=this.c[2].style,this.s[2].textShadow="none",this.up&&(this.s[2].top="auto",this.s[2].bottom="2px"),this.c[3]=this.getColorRing(),this.c[3].style.visibility="hidden",this.hsl=null,this.value="#ffffff",void 0!==t.value&&(t.value instanceof Array?this.value=Au.rgbToHex(t.value):isNaN(t.value)?this.value=t.value:this.value=Au.hexToHtml(t.value)),this.bcolor=null,this.isDown=!1,this.fistDown=!1,this.tr=98,this.tsl=Math.sqrt(3)*this.tr,this.hue=0,this.d=256,this.setColor(this.value),this.init(),void 0!==t.open&&this.open()}testZone(t,e){let i=this.local;return-1===i.x&&-1===i.y?"":this.up&&this.isOpen?i.y>this.wfixe?"title":"color":i.y<this.baseH+2?"title":this.isOpen?"color":void 0}mouseup(t){this.isDown=!1,this.d=256}mousedown(t){let e=this.testZone(t.clientX,t.clientY);if("title"===e)return this.isOpen?this.close():this.open(),!0;"color"===e&&(this.isDown=!0,this.fistDown=!0,this.mousemove(t))}mousemove(t){let e,i,n,s,r,a,o,l,h,c=this.testZone(t.clientX,t.clientY),u=Au;if("title"===c&&this.cursor("pointer"),"color"===c&&(e=this.offset,e.x=t.clientX-(this.zone.x+this.decal.x+this.mid),e.y=t.clientY-(this.zone.y+this.decal.y+this.mid),i=e.length()*this.ratio,h=e.angle(),h<0&&(h+=2*u.PI),i<128?this.cursor("crosshair"):this.isDown||this.cursor(),this.isDown&&(this.fistDown&&(this.d=i,this.fistDown=!1),this.d<128)))if(this.d>this.tr)n=(h+u.pi90)/u.TwoPI,this.hue=(n+1)%1,this.setHSL([(n+1)%1,this.hsl[1],this.hsl[2]]);else{o=e.x*this.ratio,l=e.y*this.ratio;let t=this.hue*u.TwoPI+u.PI;t<0&&(t+=2*u.PI),a=Math.atan2(-l,o),a<0&&(a+=2*u.PI);let i=(a+u.pi90+u.TwoPI+t)%u.TwoPI,n=i%(2/3*u.PI)-u.pi60,h=.5*this.tr,c=Math.tan(n)*h,d=Math.sqrt(o*o+l*l),p=Math.sqrt(h*h+c*c);if(d>p){let e=Math.tan(n)*d,s=Math.atan(e/p);s>u.pi60?s=u.pi60:s<-u.pi60&&(s=-u.pi60),a+=s-n,i=(a+u.pi90+u.TwoPI+t)%u.TwoPI,n=i%(2/3*u.PI)-u.pi60,c=Math.tan(n)*h,d=p=Math.sqrt(h*h+c*c)}r=Math.sin(i)*d/this.tsl+.5;let m=1-2*Math.abs(r-.5);s=(Math.cos(i)*d+this.tr/2)/(1.5*this.tr)/m,s=u.clamp(s,0,1),this.setHSL([this.hsl[0],s,r])}}setHeight(){this.h=this.isOpen?this.wfixe+this.baseH+5:this.baseH,this.s[0].height=this.h+"px",this.zone.h=this.h}parentHeight(t){null!==this.group?this.group.calc(t):this.isUI&&this.main.calc(t)}open(){super.open(),this.setHeight(),this.up&&(this.zone.y-=this.wfixe+5);let t=this.h-this.baseH;this.s[3].visibility="visible",this.parentHeight(t)}close(){super.close(),this.up&&(this.zone.y+=this.wfixe+5);let t=this.h-this.baseH;this.setHeight(),this.s[3].visibility="hidden",this.parentHeight(-t)}update(t){let e=Au.rgbToHex(Au.hslToRgb([this.hsl[0],1,.5]));this.moveMarkers(),this.value=this.bcolor,this.setSvg(this.c[3],"fill",e,2,0),this.s[2].background=this.bcolor,this.c[2].textContent=Au.htmlToHex(this.bcolor),this.invert=Au.findDeepInver(this.rgb),this.s[2].color=this.invert?"#fff":"#000",t&&("array"===this.ctype&&this.send(this.rgb),"rgb"===this.ctype&&this.send(Au.htmlRgb(this.rgb)),"hex"===this.ctype&&this.send(Au.htmlToHex(this.value)),"html"===this.ctype&&this.send())}setColor(t){let e=Au.unpack(t);return this.bcolor!=t&&e&&(this.bcolor=t,this.rgb=e,this.hsl=Au.rgbToHsl(this.rgb),this.hue=this.hsl[0],this.update()),this}setHSL(t){return this.hsl=t,this.rgb=Au.hslToRgb(t),this.bcolor=Au.rgbToHex(this.rgb),this.update(!0),this}moveMarkers(){let t=this.pp,e=Au;this.invert;let i=this.hsl[0]*e.TwoPI,n=2/3*e.PI,s=this.tr,r=this.hsl[0],a=this.hsl[1],o=this.hsl[2],l=(i-e.pi90)*e.todeg;r=-i+e.pi90;let h=Math.cos(r)*s,c=-Math.sin(r)*s,u=Math.cos(r-n)*s,d=-Math.sin(r-n)*s,p=Math.cos(r+n)*s,m=-Math.sin(r+n)*s,f=(u+p)/2,g=(d+m)/2;i=(1-2*Math.abs(o-.5))*a;let v=u+(p-u)*o+(h-f)*i,x=d+(m-d)*o+(c-g)*i;t.set(v,x).addScalar(128),this.setSvg(this.c[3],"transform","rotate("+l+" )",2),this.setSvg(this.c[3],"cx",t.x,3),this.setSvg(this.c[3],"cy",t.y,3),this.setSvg(this.c[3],"stroke",this.invert?"#fff":"#000",2,3),this.setSvg(this.c[3],"stroke",this.invert?"#fff":"#000",3),this.setSvg(this.c[3],"fill",this.bcolor,3)}rSize(){super.rSize();let t=this.s;t[2].width=this.sb+"px",t[2].left=this.sa+"px",this.rSizeColor(this.cw),this.decal.x=Math.floor(.5*(this.w-this.wfixe)),t[3].left=this.decal.x+"px"}rSizeColor(t){if(t===this.wfixe)return;this.wfixe=t;let e=this.s;this.decal.y="up"===this.side?2:this.baseH+2,this.mid=Math.floor(.5*this.wfixe),this.setSvg(this.c[3],"viewBox","0 0 "+this.wfixe+" "+this.wfixe),e[3].width=this.wfixe+"px",e[3].height=this.wfixe+"px",e[3].top=this.decal.y+"px",this.ratio=256/this.wfixe,this.square=1/(this.wfixe/256*60),this.setHeight()}}class Nu extends Pu{constructor(t={}){super(t),this.round=Math.round,this.baseH=this.h,this.hplus=t.hplus||50,this.res=t.res||40,this.l=1,this.precision=t.precision||0,this.custom=t.custom||!1,this.names=t.names||["FPS","MS"];let e=t.cc||["220,220,220","255,255,0"];this.adding=t.adding||!1,this.range=t.range||[165,100,100],this.alpha=t.alpha||.25,this.values=[],this.points=[],this.textDisplay=[],this.custom||(this.now=self.performance&&self.performance.now?self.performance.now.bind(performance):Date.now,this.startTime=0,this.prevTime=0,this.frames=0,this.ms=0,this.fps=0,this.mem=0,this.mm=0,this.isMem=!(!self.performance||!self.performance.memory),this.isMem&&(this.names.push("MEM"),e.push("0,255,255")),this.txt=t.name||"Fps");let i=Math.floor(.5*this.h)-6;this.c[1].textContent=this.txt,this.c[0].style.cursor="pointer",this.c[0].style.pointerEvents="auto";let n="display:none; left:10px; top:"+this.h+"px; height:"+(this.hplus-8)+"px; box-sizing:border-box; background: rgba(0, 0, 0, 0.2); border:"+("none"!==this.colors.groupBorder?this.colors.groupBorder+";":"1px solid rgba(255, 255, 255, 0.2);");0!==this.radius&&(n+="border-radius:"+this.radius+"px;"),this.c[2]=this.dom("path",this.css.basic+n,{}),this.c[2].setAttribute("viewBox","0 0 "+this.res+" 50"),this.c[2].setAttribute("height","100%"),this.c[2].setAttribute("width","100%"),this.c[2].setAttribute("preserveAspectRatio","none"),this.c[3]=this.dom("path",this.css.basic+"position:absolute; width:10px; height:10px; left:4px; top:"+i+"px;",{d:this.svgs.arrow,fill:this.fontColor,stroke:"none"}),this.c[4]=this.dom("div",this.css.txt+"position:absolute; left:10px; top:"+(this.h+2)+"px; display:none; width:100%; text-align:center;"),t.bottomLine&&(this.c[4]=this.dom("div",this.css.basic+"width:100%; bottom:0px; height:1px; background: rgba(255, 255, 255, 0.2);")),this.isShow=!1;let s=this.s;s[1].marginLeft="10px",s[1].lineHeight=this.h-4,s[1].color=this.fontColor,s[1].fontWeight="bold",0!==this.radius&&(s[0].borderRadius=this.radius+"px"),s[0].border=this.colors.groupBorder;let r=0;for(r=0;r<this.names.length;r++){let t=[],i=this.res+1;for(;i--;)t.push(50);this.range[r]=1/this.range[r]*49,this.points.push(t),this.values.push(0),this.textDisplay.push("<span style='color:rgb("+e[r]+")'> "+this.names[r]+" ")}for(r=this.names.length;r--;)this.dom("path",null,{fill:"rgba("+e[r]+","+this.alpha+")","stroke-width":1,stroke:"rgba("+e[r]+",1)","vector-effect":"non-scaling-stroke"},this.c[2]);this.init()}mousedown(t){this.isShow?this.close():this.open()}tick(t){this.values=t,this.isShow&&(this.drawGraph(),this.upText())}makePath(t){let e="";e+="M -1 50";for(let i=0;i<this.res+1;i++)e+=" L "+i+" "+t[i];return e+=" L "+(this.res+1)+" 50",e}upText(t){let e=t||this.values,i="";for(let t=0,n=this.names.length;t<n;t++)i+=this.textDisplay[t]+e[t].toFixed(this.precision)+"</span>";this.c[4].innerHTML=i}drawGraph(){let t,e=this.c[2],i=this.names.length,n=0,s=0;for(;i--;)t=this.adding?(this.values[s]+n)*this.range[s]:this.values[s]*this.range[s],this.points[s].shift(),this.points[s].push(50-t),this.setSvg(e,"d",this.makePath(this.points[s]),i+1),n+=this.values[s],s++}open(){super.open(),this.h=this.hplus+this.baseH,this.setSvg(this.c[3],"d",this.svgs.arrowDown),null!==this.group?this.group.calc(this.hplus):this.isUI&&this.main.calc(this.hplus),this.s[0].height=this.h+"px",this.s[2].display="block",this.s[4].display="block",this.isShow=!0,this.custom||Lu.addListen(this)}close(){super.close(),this.h=this.baseH,this.setSvg(this.c[3],"d",this.svgs.arrow),null!==this.group?this.group.calc(-this.hplus):this.isUI&&this.main.calc(-this.hplus),this.s[0].height=this.h+"px",this.s[2].display="none",this.s[4].display="none",this.isShow=!1,this.custom||Lu.removeListen(this),this.c[4].innerHTML=""}begin(){this.startTime=this.now()}end(){let t=this.now();if(this.ms=t-this.startTime,this.frames++,t>this.prevTime+1e3&&(this.fps=this.round(1e3*this.frames/(t-this.prevTime)),this.prevTime=t,this.frames=0,this.isMem)){let t=performance.memory.usedJSHeapSize,e=performance.memory.jsHeapSizeLimit;this.mem=this.round(954e-9*t),this.mm=t/e}return this.values=[this.fps,this.ms,this.mm],this.drawGraph(),this.upText([this.fps,this.ms,this.mem]),t}listening(){this.custom||(this.startTime=this.end())}rSize(){let t=this.s,e=this.w;t[0].width=e+"px",t[1].width=e+"px",t[2].left="10px",t[2].width=e-20+"px",t[4].width=e-20+"px"}}class ku extends Pu{constructor(t={}){super(t),this.value=void 0!==t.value?t.value:[0,0,0],this.lng=this.value.length,this.precision=void 0!==t.precision?t.precision:2,this.multiplicator=t.multiplicator||1,this.neg=t.neg||!1,this.line=void 0===t.line||t.line,this.autoWidth=void 0===t.autoWidth||t.autoWidth,this.isNumber=!1,this.isDown=!1,this.h=t.h||138,this.rh=this.h-10,this.top=0,this.c[0].style.width=this.w+"px",void 0!==this.c[1]&&(this.c[1].style.width=this.w+"px",this.top=10,this.h+=10),this.gh=this.rh-28,this.gw=this.w-28,this.c[2]=this.dom("div",this.css.txt+"text-align:center; top:"+(this.h-20)+"px; width:"+this.w+"px; color:"+this.fontColor),this.c[2].textContent=this.value;let e=this.dom("svg",this.css.basic,{viewBox:"0 0 "+this.w+" "+this.rh,width:this.w,height:this.rh,preserveAspectRatio:"none"});this.setCss(e,{width:this.w,height:this.rh,left:0,top:this.top}),this.dom("path","",{d:"",stroke:this.colors.text,"stroke-width":2,fill:"none","stroke-linecap":"butt"},e),this.dom("rect","",{x:10,y:10,width:this.gw+8,height:this.gh+8,stroke:"rgba(0,0,0,0.3)","stroke-width":1,fill:"none"},e),this.iw=(this.gw-4*(this.lng-1))/this.lng;let i=[];this.cMode=[],this.v=[];for(let t=0;t<this.lng;t++)i[t]=[14+t*this.iw+4*t,this.iw],i[t][2]=i[t][0]+i[t][1],this.cMode[t]=0,this.neg?this.v[t]=.5*(1+this.value[t]/this.multiplicator):this.v[t]=this.value[t]/this.multiplicator,this.dom("rect","",{x:i[t][0],y:14,width:i[t][1],height:1,fill:this.fontColor,"fill-opacity":.3},e);this.tmp=i,this.c[3]=e,this.init(),void 0!==this.c[1]&&(this.c[1].style.top="0px",this.c[1].style.height="20px",this.s[1].lineHeight="15px"),this.update(!1)}setValue(t){this.value=t,this.lng=this.value.length;for(var e=0;e<this.lng;e++)this.neg?this.v[e]=.5*(1+t[e]/this.multiplicator):this.v[e]=t[e]/this.multiplicator;this.update()}updateSVG(){this.line&&this.setSvg(this.c[3],"d",this.makePath(),0);for(let t=0;t<this.lng;t++)this.setSvg(this.c[3],"height",this.v[t]*this.gh,t+2),this.setSvg(this.c[3],"y",this.gh-this.v[t]*this.gh+14,t+2),this.neg?this.value[t]=1*((2*this.v[t]-1)*this.multiplicator).toFixed(this.precision):this.value[t]=1*(this.v[t]*this.multiplicator).toFixed(this.precision);this.c[2].textContent=this.value}testZone(t){let e=this.local;if(-1===e.x&&-1===e.y)return"";let i=this.lng,n=this.tmp;if(e.y>this.top&&e.y<this.h-20)for(;i--;)if(e.x>n[i][0]&&e.x<n[i][2])return i;return""}mode(t,e){if(t===this.cMode[e])return!1;let i;switch(t){case 0:i=.3;break;case 1:i=.6;break;case 2:i=1}return this.reset(),this.setSvg(this.c[3],"fill-opacity",i,e+2),this.cMode[e]=t,!0}reset(){let t=!1,e=this.lng;for(;e--;)0!==this.cMode[e]&&(this.cMode[e]=0,this.setSvg(this.c[3],"fill-opacity",.3,e+2),t=!0);return t}mouseup(t){if(this.isDown=!1,-1!==this.current)return this.reset()}mousedown(t){return this.isDown=!0,this.mousemove(t)}mousemove(t){let e=!1,i=this.testZone(t);return""===i?e=this.reset():(e=this.mode(this.isDown?2:1,i),this.isDown&&(this.v[i]=this.clamp(1-(t.clientY-this.zone.y-this.top-10)/this.gh,0,1),this.update(!0))),e}update(t){this.updateSVG(),t&&this.send()}makePath(){let t,e,i,n,s,r,a="";for(let o=0;o<this.lng;o++)t=this.gh-this.v[o]*this.gh+14,e=14+o*this.iw+4*o,n=e+.5*this.iw,i=e+this.iw,a+=0===o?"M "+e+" "+t+" T "+n+" "+t:" C "+s+" "+r+","+e+" "+t+","+n+" "+t,o===this.lng-1&&(a+=" T "+i+" "+t),s=i,r=t;return a}rSize(){super.rSize();let t=this.s;void 0!==this.c[1]&&(t[1].width=this.w+"px"),t[2].width=this.w+"px",t[3].width=this.w+"px";let e=(this.w-28-4*(this.lng-1))/this.lng,i=[];for(let t=0;t<this.lng;t++)i[t]=[14+t*e+4*t,e],i[t][2]=i[t][0]+i[t][1];this.tmp=i}}class zu extends Pu{constructor(t={}){super(t),this.ADD=t.add,this.uis=[],this.isEmpty=!0,this.autoHeight=!0,this.current=-1,this.target=null,this.decal=0,this.baseH=this.h;let e=Math.floor(.5*this.h)-6;this.isLine=void 0!==t.line&&t.line,this.c[2]=this.dom("div",this.css.basic+"width:100%; left:0; height:auto; overflow:hidden; top:"+this.h+"px"),this.c[3]=this.dom("path",this.css.basic+"position:absolute; width:10px; height:10px; left:0; top:"+e+"px;",{d:this.svgs.group,fill:this.fontColor,stroke:"none"}),this.c[4]=this.dom("path",this.css.basic+"position:absolute; width:10px; height:10px; left:4px; top:"+e+"px;",{d:this.svgs.arrow,fill:this.fontColor,stroke:"none"}),this.isLine&&(this.c[5]=this.dom("div",this.css.basic+"background:rgba(255, 255, 255, 0.2); width:100%; left:0; height:1px; bottom:0px"));let i=this.s;i[0].height=this.h+"px",i[1].height=this.h+"px",this.c[1].name="group",i[1].marginLeft="10px",i[1].lineHeight=this.h-4,i[1].color=this.fontColor,i[1].fontWeight="bold",0!==this.radius&&(i[0].borderRadius=this.radius+"px"),i[0].border=this.colors.groupBorder,this.init(),this.setBG(this.bg),void 0!==t.open&&this.open()}testZone(t){let e=this.local;if(-1===e.x&&-1===e.y)return"";let i="";return e.y<this.baseH?i="title":this.isOpen&&(i="content"),i}clearTarget(){return-1!==this.current&&(this.target.uiout(),this.target.reset(),this.current=-1,this.target=null,this.cursor(),!0)}reset(){this.clearTarget()}handleEvent(t){let e=t.type,i=!1,n=!1,s=this.testZone(t);if(s){switch(s){case"content":this.cursor(),Lu.isMobile&&"mousedown"===e&&this.getNext(t,i),this.target&&(n=this.target.handleEvent(t)),Lu.lock||this.getNext(t,i);break;case"title":this.cursor("pointer"),"mousedown"===e&&(this.isOpen?this.close():this.open())}return this.isDown&&(i=!0),n&&(i=!0),i}}getNext(t,e){let i=Lu.findTarget(this.uis,t);i!==this.current&&(this.clearTarget(),this.current=i),-1!==i&&(this.target=this.uis[this.current],this.target.uiover())}calcH(){let t,e,i=this.uis.length,n=0,s=0,r=0;for(t=0;t<i;t++)e=this.uis[t],e.autoWidth?n+=e.h+1:(0===s?n+=e.h+1:r<e.h&&(n+=e.h-r),r=e.h,s+=e.w,s+e.w>this.w&&(s=0));return n}calcUis(){this.isOpen&&Lu.calcUis(this.uis,this.zone,this.zone.y+this.baseH)}setBG(t){this.s[0].background=t;let e=this.uis.length;for(;e--;)this.uis[e].setBG(t)}add(){let t=arguments;"object"==typeof t[1]?(t[1].isUI=this.isUI,t[1].target=this.c[2],t[1].main=this.main):"string"==typeof arguments[1]&&(void 0===t[2]?[].push.call(t,{isUI:!0,target:this.c[2],main:this.main}):(t[2].isUI=!0,t[2].target=this.c[2],t[2].main=this.main));let e=this.ADD.apply(this,t);return this.uis.push(e),e.group=this,this.isEmpty=!1,e}remove(t){t.clear&&t.clear()}empty(){this.close();let t,e=this.uis.length;for(;e--;)t=this.uis.pop(),this.c[2].removeChild(t.c[0]),t.clear(!0);this.isEmpty=!0,this.h=this.baseH}clearOne(t){let e=this.uis.indexOf(t);-1!==e&&(this.calc(-(this.uis[e].h+1)),this.c[2].removeChild(this.uis[e].c[0]),this.uis.splice(e,1),0===this.uis.length&&(this.isEmpty=!0,this.close()))}parentHeight(t){null!==this.group?this.group.calc(t):this.isUI&&this.main.calc(t)}open(){super.open(),this.setSvg(this.c[4],"d",this.svgs.arrowDown),this.rSizeContent();let t=this.h-this.baseH;this.parentHeight(t)}close(){super.close();let t=this.h-this.baseH;this.setSvg(this.c[4],"d",this.svgs.arrow),this.h=this.baseH,this.s[0].height=this.h+"px",this.parentHeight(-t)}clear(){this.empty(),this.isUI&&this.main.calc(-(this.h+1)),Pu.prototype.clear.call(this)}clearGroup(){this.empty()}calc(t){this.isOpen&&(void 0!==t?(this.h+=t,this.isUI&&this.main.calc(t)):this.h=this.calcH()+this.baseH,this.s[0].height=this.h+"px")}rSizeContent(){let t=this.uis.length;for(;t--;)this.uis[t].setSize(this.w),this.uis[t].rSize();this.calc()}rSize(){super.rSize();let t=this.s;t[3].left=this.sa+this.sb-17+"px",t[1].width=this.w+"px",t[2].width=this.w+"px",this.isOpen&&this.rSizeContent()}}zu.prototype.isGroup=!0;class Uu extends Pu{constructor(t={}){super(t),this.autoWidth=!1,this.value=[0,0],this.joyType="analogique",this.model=void 0!==t.mode?t.mode:0,this.precision=t.precision||2,this.multiplicator=t.multiplicator||1,this.pos=new Cu,this.tmp=new Cu,this.interval=null,this.radius=.5*this.w,this.distance=.25*this.radius,this.h=t.h||this.w+10,this.top=0,this.c[0].style.width=this.w+"px",void 0!==this.c[1]&&(this.c[1].style.width=this.w+"px",this.c[1].style.textAlign="center",this.top=10,this.h+=10),this.c[2]=this.dom("div",this.css.txt+"text-align:center; top:"+(this.h-20)+"px; width:"+this.w+"px; color:"+this.fontColor),this.c[2].textContent=this.value,this.c[3]=this.getJoystick(this.model),this.setSvg(this.c[3],"viewBox","0 0 "+this.w+" "+this.w),this.setCss(this.c[3],{width:this.w,height:this.w,left:0,top:this.top}),this.ratio=128/this.w,this.init(),this.update(!1)}mode(t){switch(t){case 0:0===this.model?(this.setSvg(this.c[3],"fill","url(#gradIn)",4),this.setSvg(this.c[3],"stroke","#000",4)):(this.setSvg(this.c[3],"stroke","rgba(100,100,100,0.25)",2),this.setSvg(this.c[3],"stroke","#666",4),this.setSvg(this.c[3],"fill","none",4));break;case 1:0===this.model?(this.setSvg(this.c[3],"fill","url(#gradIn2)",4),this.setSvg(this.c[3],"stroke","rgba(0,0,0,0)",4)):(this.setSvg(this.c[3],"stroke","rgba(48,138,255,0.25)",2),this.setSvg(this.c[3],"stroke",this.colors.select,4),this.setSvg(this.c[3],"fill","rgba(48,138,255,0.25)",4))}}addInterval(){null!==this.interval&&this.stopInterval(),this.pos.isZero()||(this.interval=setInterval(function(){this.update()}.bind(this),10))}stopInterval(){null!==this.interval&&(clearInterval(this.interval),this.interval=null)}reset(){this.addInterval(),this.mode(0)}mouseup(t){this.addInterval(),this.isDown=!1}mousedown(t){this.isDown=!0,this.mousemove(t),this.mode(2)}mousemove(t){if(this.mode(1),this.isDown){if(this.tmp.x=this.radius-(t.clientX-this.zone.x),this.tmp.y=this.radius-(t.clientY-this.zone.y-this.top),this.tmp.length()>this.distance){let t=Math.atan2(this.tmp.x,this.tmp.y);this.tmp.x=Math.sin(t)*this.distance,this.tmp.y=Math.cos(t)*this.distance}this.pos.copy(this.tmp).divideScalar(this.distance).negate(),this.update()}}setValue(t){void 0===t&&(t=[0,0]),this.pos.set(t[0]||0,t[1]||0),this.updateSVG()}update(t){void 0===t&&(t=!0),null!==this.interval&&(this.isDown||(this.pos.lerp(null,.3),this.pos.x=Math.abs(this.pos.x)<.01?0:this.pos.x,this.pos.y=Math.abs(this.pos.y)<.01?0:this.pos.y,this.isUI&&this.main.isCanvas&&this.main.draw())),this.updateSVG(),t&&this.send(),this.pos.isZero()&&this.stopInterval()}updateSVG(){let t=this.radius- -this.pos.x*this.distance,e=this.radius- -this.pos.y*this.distance;if(0===this.model){let i=t+5*this.pos.x+5,n=e+5*this.pos.y+10;this.setSvg(this.c[3],"cx",i*this.ratio,3),this.setSvg(this.c[3],"cy",n*this.ratio,3)}else this.setSvg(this.c[3],"cx",t*this.ratio,3),this.setSvg(this.c[3],"cy",e*this.ratio,3);this.setSvg(this.c[3],"cx",t*this.ratio,4),this.setSvg(this.c[3],"cy",e*this.ratio,4),this.value[0]=1*(this.pos.x*this.multiplicator).toFixed(this.precision),this.value[1]=1*(this.pos.y*this.multiplicator).toFixed(this.precision),this.c[2].textContent=this.value}clear(){this.stopInterval(),super.clear()}}class Ou extends Pu{constructor(t={}){super(t),this.isCyclic=t.cyclic||!1,this.model=t.stype||0,void 0!==t.mode&&(this.model=t.mode),this.autoWidth=!1,this.buttonColor=this.colors.button,this.setTypeNumber(t),this.mPI=.8*Math.PI,this.toDeg=180/Math.PI,this.cirRange=2*this.mPI,this.offset=new Cu,this.radius=.5*this.w,this.h=t.h||this.w+10,this.top=0,this.c[0].style.width=this.w+"px",void 0!==this.c[1]&&(this.c[1].style.width=this.w+"px",this.c[1].style.textAlign="center",this.top=10,this.h+=10),this.percent=0,this.cmode=0,this.c[2]=this.dom("div",this.css.txt+"text-align:center; top:"+(this.h-20)+"px; width:"+this.w+"px; color:"+this.fontColor),this.c[3]=this.getKnob(),this.setSvg(this.c[3],"stroke",this.fontColor,1),this.setSvg(this.c[3],"stroke",this.fontColor,3),this.setSvg(this.c[3],"d",this.makeGrad(),3),this.setSvg(this.c[3],"viewBox","0 0 "+this.ww+" "+this.ww),this.setCss(this.c[3],{width:this.w,height:this.w,left:0,top:this.top}),this.model>0&&(Au.dom("path","",{d:"",stroke:this.fontColor,"stroke-width":2,fill:"none","stroke-linecap":"round"},this.c[3]),2==this.model&&(Au.addSVGGlowEffect(),this.setSvg(this.c[3],"style",'filter: url("#UILGlow");',4))),this.r=0,this.init(),this.update()}mode(t){if(this.cmode===t)return!1;switch(t){case 0:this.s[2].color=this.fontColor,this.setSvg(this.c[3],"fill",this.colors.button,0),this.setSvg(this.c[3],"stroke",this.fontColor,1);break;case 1:this.s[2].color=this.colorPlus,this.setSvg(this.c[3],"fill",this.colors.select,0),this.setSvg(this.c[3],"stroke",this.colorPlus,1)}return this.cmode=t,!0}testZone(t){let e=this.local;return-1===e.x&&-1===e.y?"":e.y<=this.c[1].offsetHeight?"title":e.y>this.h-this.c[2].offsetHeight?"text":"knob"}mouseup(t){return this.isDown=!1,this.sendEnd(),this.mode(0)}mousedown(t){return this.isDown=!0,this.old=this.value,this.oldr=null,this.mousemove(t),this.mode(1)}mousemove(t){if(!this.isDown)return;let e=this.offset;e.x=this.radius-(t.clientX-this.zone.x),e.y=this.radius-(t.clientY-this.zone.y-this.top),this.r=-Math.atan2(e.x,e.y),null!==this.oldr&&(this.r=Math.abs(this.r-this.oldr)>Math.PI?this.oldr:this.r),this.r=this.r>this.mPI?this.mPI:this.r,this.r=this.r<-this.mPI?-this.mPI:this.r;let i=1/this.cirRange,n=(this.r+this.mPI)*i,s=this.range*n+this.min-this.old;(s>=this.step||s<=this.step)&&(s=Math.floor(s/this.step),this.value=this.numValue(this.old+s*this.step),this.update(!0),this.old=this.value,this.oldr=this.r)}wheel(t){if("knob"===this.testZone(t)){let e=this.value-this.step*t.delta;return e>this.max?e=this.isCyclic?this.min:this.max:e<this.min&&(e=this.isCyclic?this.max:this.min),this.setValue(e),this.old=e,this.update(!0),!0}return!1}makeGrad(){let t,e,i,n,s,r,a,o="",l=Math.PI+this.mPI,h=Math.PI-this.mPI;this.step>5?(e=this.range/this.step,t=(l-h)/e):(t=(l-h)/64*2,e=32);for(let h=0;h<=e;++h)i=l-t*h,n=64+44*Math.sin(i),s=64+44*Math.cos(i),r=64+40*Math.sin(i),a=64+40*Math.cos(i),o+="M"+n+" "+s+" L"+r+" "+a+" ";return o}update(t){this.c[2].textContent=this.value,this.percent=(this.value-this.min)/this.range;let e=Math.PI+this.mPI,i=this.percent*this.cirRange-this.mPI,n=Math.sin(i),s=Math.cos(i),r=25*n+64,a=-25*s+64,o=20*n+64,l=-20*s+64;if(this.setSvg(this.c[3],"d","M "+r+" "+a+" L "+o+" "+l,1),this.model>0){let t=36*Math.sin(e)+64,r=36*Math.cos(e)+64,a=36*n+64,o=-36*s+64,l=i<=Math.PI-this.mPI?0:1;this.setSvg(this.c[3],"d","M "+t+","+r+" A 36,36 1 "+l+" 1 "+a+","+o,4);let h=Au.pack(Au.lerpColor(Au.unpack(Au.ColorLuma(this.fontColor,-.75)),Au.unpack(this.fontColor),this.percent));this.setSvg(this.c[3],"stroke",h,4)}t&&this.send()}}class Bu extends Pu{constructor(t={}){super(t),this.path=t.path||"",this.format=t.format||"",this.imageSize=t.imageSize||[20,20],this.isWithImage=""!==this.path,this.preLoadComplete=!1,this.tmpImage={},this.tmpUrl=[];let e=t.align||"center";this.sMode=0,this.tMode=0,this.listOnly=t.listOnly||!1,""===this.txt&&(this.p=0),this.buttonColor=t.bColor||this.colors.button;let i=Math.floor(.5*this.h)-5;this.c[2]=this.dom("div",this.css.basic+"top:0; display:none;"),this.c[3]=this.dom("div",this.css.txt+"text-align:"+e+"; line-height:"+(this.h-4)+"px; top:1px; background:"+this.buttonColor+"; height:"+(this.h-2)+"px; border-radius:"+this.radius+"px;"),this.c[4]=this.dom("path",this.css.basic+"position:absolute; width:10px; height:10px; top:"+i+"px;",{d:this.svgs.arrow,fill:this.fontColor,stroke:"none"}),this.scroller=this.dom("div",this.css.basic+"right:5px;  width:10px; background:#666; display:none;"),this.c[3].style.color=this.fontColor,this.list=t.list||[],this.items=[],this.prevName="",this.baseH=this.h,this.itemHeight=t.itemHeight||this.h-3,this.full=t.full||!1,this.py=0,this.ww=this.sb,this.scroll=!1,this.isDown=!1,this.current=null,this.side=t.side||"down",this.up="down"===this.side?0:1,this.up?(this.c[2].style.top="auto",this.c[3].style.top="auto",this.c[4].style.top="auto",this.c[2].style.bottom=this.h-2+"px",this.c[3].style.bottom="1px",this.c[4].style.bottom=i+"px"):this.c[2].style.top=this.baseH+"px",this.listIn=this.dom("div",this.css.basic+"left:0; top:0; width:100%; background:rgba(0,0,0,0.2);"),this.listIn.name="list",this.topList=0,this.c[2].appendChild(this.listIn),this.c[2].appendChild(this.scroller),void 0!==t.value?isNaN(t.value)?this.value=t.value:this.value=this.list[t.value]:this.value=this.list[0],this.isOpenOnStart=t.open||!1,this.listOnly&&(this.baseH=5,this.c[3].style.display="none",this.c[4].style.display="none",this.c[2].style.top=this.baseH+"px",this.isOpenOnStart=!0),this.isWithImage&&this.preloadImage(),this.setList(this.list),this.init(),this.isOpenOnStart&&this.open(!0)}preloadImage(){this.preLoadComplete=!1,this.tmpImage={};for(let t=0;t<this.list.length;t++)this.tmpUrl.push(this.list[t]);this.loadOne()}nextImg(){this.tmpUrl.shift(),0===this.tmpUrl.length?(this.preLoadComplete=!0,this.addImages()):this.loadOne()}loadOne(){let t=this,e=this.tmpUrl[0],i=document.createElement("img");i.style.cssText="position:absolute; width:"+t.imageSize[0]+"px; height:"+t.imageSize[1]+"px",i.setAttribute("src",this.path+e+this.format),i.addEventListener("load",(function(){t.imageSize[2]=i.width,t.imageSize[3]=i.height,t.tmpImage[e]=i,t.nextImg()}))}testZone(t){let e=this.local;if(-1===e.x&&-1===e.y)return"";if(this.up&&this.isOpen){if(e.y>this.h-this.baseH)return"title";if(this.scroll&&e.x>this.sa+this.sb-20)return"scroll";if(e.x>this.sa)return this.testItems(e.y-this.baseH)}else{if(e.y<this.baseH+2)return"title";if(this.isOpen){if(this.scroll&&e.x>this.sa+this.sb-20)return"scroll";if(e.x>this.sa)return this.testItems(e.y-this.baseH)}}return""}testItems(t){let e,i,n,s="",r=this.items.length;for(;r--;)if(e=this.items[r],i=e.posy+this.topList,n=e.posy+this.itemHeight+1+this.topList,t>=i&&t<=n)return s="item"+r,this.unSelected(),this.current=e,this.selected(),s;return s}unSelected(){this.current&&(this.current.style.background="rgba(0,0,0,0.2)",this.current.style.color=this.fontColor,this.current=null)}selected(){this.current.style.background=this.colors.select,this.current.style.color="#FFF"}mouseup(t){this.isDown=!1}mousedown(t){let e=this.testZone(t);return!!e&&("scroll"===e?(this.isDown=!0,this.mousemove(t)):"title"===e?(this.modeTitle(2),this.listOnly||(this.isOpen?this.close():this.open())):this.current&&(this.value=this.list[this.current.id],this.send(),this.listOnly||(this.close(),this.setTopItem())),!0)}mousemove(t){let e=!1,i=this.testZone(t);if(!i)return e;if("title"===i)this.unSelected(),this.modeTitle(1),this.cursor("pointer");else if("scroll"===i){if(this.cursor("s-resize"),this.modeScroll(1),this.isDown){this.modeScroll(2);let e=this.zone.y+this.baseH-2;this.update(t.clientY-e-.5*this.sh)}}else this.modeTitle(0),this.modeScroll(0),this.cursor("pointer");return i!==this.prevName&&(e=!0),this.prevName=i,e}wheel(t){return"title"!==this.testZone(t)&&(this.py+=10*t.delta,this.update(this.py),!0)}reset(){this.prevName="",this.unSelected(),this.modeTitle(0),this.modeScroll(0)}modeScroll(t){if(t!==this.sMode){switch(t){case 0:this.scroller.style.background=this.buttonColor;break;case 1:this.scroller.style.background=this.colors.select;break;case 2:this.scroller.style.background=this.colors.down}this.sMode=t}}modeTitle(t){if(t===this.tMode)return;let e=this.s;switch(t){case 0:e[3].color=this.fontColor,e[3].background=this.buttonColor;break;case 1:e[3].color="#FFF",e[3].background=this.colors.select;break;case 2:e[3].color=this.fontColor,e[3].background=this.colors.down}this.tMode=t}clearList(){for(;this.listIn.children.length;)this.listIn.removeChild(this.listIn.lastChild);this.items=[]}setList(t){let e,i;this.clearList(),this.list=t,this.length=this.list.length,this.maxItem=this.full?this.length:5,this.maxItem=this.length<this.maxItem?this.length:this.maxItem,this.maxHeight=this.maxItem*(this.itemHeight+1)+2,this.max=this.length*(this.itemHeight+1)+2,this.ratio=this.maxHeight/this.max,this.sh=this.maxHeight*this.ratio,this.range=this.maxHeight-this.sh,this.c[2].style.height=this.maxHeight+"px",this.scroller.style.height=this.sh+"px",this.max>this.maxHeight&&(this.ww=this.sb-20,this.scroll=!0);for(let t=0;t<this.length;t++)i=this.list[t],e=this.dom("div",this.css.item+"width:"+this.ww+"px; height:"+this.itemHeight+"px; line-height:"+(this.itemHeight-5)+"px; color:"+this.fontColor+";"),e.name="item"+t,e.id=t,e.posy=(this.itemHeight+1)*t,this.listIn.appendChild(e),this.items.push(e),this.isWithImage||(e.textContent=i);this.setTopItem()}addImages(){let t=this.list.length;for(let e=0;e<t;e++)this.items[e].appendChild(this.tmpImage[this.list[e]]);this.setTopItem()}setValue(t){isNaN(t)?this.value=t:this.value=this.list[t],this.setTopItem()}setTopItem(){if(this.isWithImage){if(!this.preLoadComplete)return;this.c[3].children.length||(this.canvas=document.createElement("canvas"),this.canvas.width=this.imageSize[0],this.canvas.height=this.imageSize[1],this.canvas.style.cssText="position:absolute; top:0px; left:0px;",this.ctx=this.canvas.getContext("2d"),this.c[3].appendChild(this.canvas)),this.tmpImage[this.value],this.ctx.drawImage(this.tmpImage[this.value],0,0,this.imageSize[2],this.imageSize[3],0,0,this.imageSize[0],this.imageSize[1])}else this.c[3].textContent=this.value}update(t){this.scroll&&(t=(t=t<0?0:t)>this.range?this.range:t,this.topList=-Math.floor(t/this.ratio),this.listIn.style.top=this.topList+"px",this.scroller.style.top=Math.floor(t)+"px",this.py=t)}parentHeight(t){null!==this.group?this.group.calc(t):this.isUI&&this.main.calc(t)}open(t){super.open(),this.update(0),this.h=this.maxHeight+this.baseH+5,this.scroll?this.scroller.style.display="block":(this.topList=0,this.h=this.baseH+5+this.max,this.scroller.style.display="none"),this.s[0].height=this.h+"px",this.s[2].display="block",this.up?(this.zone.y-=this.h-(this.baseH-10),this.setSvg(this.c[4],"d",this.svgs.arrowUp)):this.setSvg(this.c[4],"d",this.svgs.arrowDown),this.rSizeContent();let e=this.h-this.baseH;this.zone.h=this.h,t||this.parentHeight(e)}close(){super.close(),this.up&&(this.zone.y+=this.h-(this.baseH-10));let t=this.h-this.baseH;this.h=this.baseH,this.s[0].height=this.h+"px",this.s[2].display="none",this.setSvg(this.c[4],"d",this.svgs.arrow),this.zone.h=this.h,this.parentHeight(-t)}text(t){this.c[3].textContent=t}rSizeContent(){let t=this.length;for(;t--;)this.listIn.children[t].style.width=this.ww+"px"}rSize(){Pu.prototype.rSize.call(this);let t=this.s,e=this.sb,i=this.sa;void 0!==t[2]&&(t[2].width=e+"px",t[2].left=i+"px",t[3].width=e+"px",t[3].left=i+"px",t[4].left=i+e-17+"px",this.ww=e,this.max>this.maxHeight&&(this.ww=e-20),this.isOpen&&this.rSizeContent())}}class Hu extends Pu{constructor(t={}){super(t),this.setTypeNumber(t),this.allway=t.allway||!1,this.isDown=!1,this.value=[0],this.multy=1,this.invmulty=1,this.isSingle=!0,this.isAngle=!1,this.isVector=!1,t.isAngle&&(this.isAngle=!0,this.multy=Au.torad,this.invmulty=Au.todeg),this.isDrag=t.drag||!1,void 0!==t.value&&(isNaN(t.value)?t.value instanceof Array?(this.value=t.value,this.isSingle=!1):t.value instanceof Object&&(this.value=[],void 0!==t.value.x&&(this.value[0]=t.value.x),void 0!==t.value.y&&(this.value[1]=t.value.y),void 0!==t.value.z&&(this.value[2]=t.value.z),void 0!==t.value.w&&(this.value[3]=t.value.w),this.isVector=!0,this.isSingle=!1):this.value=[t.value]),this.lng=this.value.length,this.tmp=[],this.current=-1,this.prev={x:0,y:0,d:0,v:0},this.c[2]=this.dom("div",this.css.basic+" background:"+this.colors.select+"; top:4px; width:0px; height:"+(this.h-8)+"px;"),this.cMode=[];let e=this.lng;for(;e--;)this.isAngle&&(this.value[e]=(180*this.value[e]/Math.PI).toFixed(this.precision)),this.c[3+e]=this.dom("div",this.css.txtselect+" height:"+(this.h-4)+"px; background:"+this.colors.inputBg+"; borderColor:"+this.colors.inputBorder+"; border-radius:"+this.radius+"px;"),t.center&&(this.c[2+e].style.textAlign="center"),this.c[3+e].textContent=this.value[e],this.c[3+e].style.color=this.fontColor,this.c[3+e].isNum=!0,this.cMode[e]=0;this.cursorId=3+this.lng,this.c[this.cursorId]=this.dom("div",this.css.basic+"top:4px; height:"+(this.h-8)+"px; width:0px; background:"+this.fontColor+";"),this.init()}testZone(t){let e=this.local;if(-1===e.x&&-1===e.y)return"";let i=this.lng,n=this.tmp;for(;i--;)if(e.x>n[i][0]&&e.x<n[i][2])return i;return""}mousedown(t){let e=this.testZone(t);return!this.isDown&&(this.isDown=!0,""!==e&&(this.current=e,this.prev={x:t.clientX,y:t.clientY,d:0,v:this.isSingle?parseFloat(this.value):parseFloat(this.value[this.current])},this.setInput(this.c[3+this.current])),this.mousemove(t))}mouseup(t){return!!this.isDown&&(this.isDown=!1,this.prev={x:0,y:0,d:0,v:0},this.mousemove(t))}mousemove(t){let e=!1,i=0;if(""===this.testZone(t)?this.cursor():this.isDrag?this.cursor(-1!==this.current?"move":"pointer"):this.cursor("text"),!this.isDrag)return this.isDown&&(i=t.clientX-this.zone.x-3),-1!==this.current&&(i-=this.tmp[this.current][0]),this.upInput(i,this.isDown);if(-1!==this.current){this.prev.d+=t.clientX-this.prev.x-(t.clientY-this.prev.y);let i=this.prev.v+this.prev.d*this.step;this.value[this.current]=this.numValue(i),this.c[3+this.current].textContent=this.value[this.current],this.validate(),this.prev.x=t.clientX,this.prev.y=t.clientY,e=!0}return e}reset(){return!1}setValue(t){this.isVector?(void 0!==t.x&&(this.value[0]=t.x),void 0!==t.y&&(this.value[1]=t.y),void 0!==t.z&&(this.value[2]=t.z),void 0!==t.w&&(this.value[3]=t.w)):this.isSingle?this.value=[t]:this.value=t,this.update()}sameStr(t){let e=this.value.length;for(;e--;)this.c[3+e].textContent=t}update(t){let e=this.value.length;for(;e--;)this.value[e]=this.numValue(this.value[e]*this.invmulty),this.c[3+e].textContent=this.value[e];t&&this.send()}send(t){t=t||this.value,this.isSend=!0,null!==this.objectLink&&(this.isVector?this.objectLink[this.val].fromArray(t):this.objectLink[this.val]=t),this.callback&&this.callback(t,this.val),this.isSend=!1}select(t,e,i){let n=this.s,s=-1!==this.current?this.tmp[this.current][0]+5:0;n[this.cursorId].width="1px",n[this.cursorId].left=s+t+"px",n[2].left=s+e+"px",n[2].width=i+"px"}unselect(){let t=this.s;t&&(t[2].width="0px",t[this.cursorId].width="0px")}validate(t){let e=[],i=this.lng;for(this.allway&&(t=!0);i--;){if(isNaN(this.c[3+i].textContent))this.c[3+i].textContent=this.value[i];else{let t=this.numValue(this.c[3+i].textContent);this.c[3+i].textContent=t,this.value[i]=t}e[i]=this.value[i]*this.multy}t&&(this.isSingle?this.send(e[0]):this.send(e))}rSize(){super.rSize();let t=Math.floor((this.sb+5)/this.lng)-5,e=this.s,i=this.lng;for(;i--;)this.tmp[i]=[Math.floor(this.sa+t*i+5*i),t],this.tmp[i][2]=this.tmp[i][0]+this.tmp[i][1],e[3+i].left=this.tmp[i][0]+"px",e[3+i].width=this.tmp[i][1]+"px"}}class Gu extends Pu{constructor(t={}){if(super(t),this.setTypeNumber(t),this.model=t.stype||0,void 0!==t.mode&&(this.model=t.mode),this.buttonColor=t.bColor||this.colors.button,this.defaultBorderColor=this.colors.hide,this.isDown=!1,this.isOver=!1,this.allway=t.allway||!1,this.isDeg=t.isDeg||!1,this.isCyclic=t.cyclic||!1,this.firstImput=!1,this.c[2]=this.dom("div",this.css.txtselect+"border:none; width:47px; color:"+this.fontColor),this.c[3]=this.dom("div",this.css.basic+" top:0; height:"+this.h+"px;"),this.c[4]=this.dom("div",this.css.basic+"background:"+this.colors.scrollback+"; top:2px; height:"+(this.h-4)+"px;"),this.c[5]=this.dom("div",this.css.basic+"left:4px; top:5px; height:"+(this.h-10)+"px; background:"+this.fontColor+";"),this.c[2].isNum=!0,this.c[2].style.height=this.h-2+"px",this.c[2].style.lineHeight=this.h-10+"px",0!==this.model){let t=4,e=8,i=this.h-4,n=20;2===this.model&&(t=4,e=8,n=2,i=.5*(this.h-4)),3===this.model&&(this.c[5].style.visible="none"),this.c[4].style.borderRadius=t+"px",this.c[4].style.height=e+"px",this.c[4].style.top=.5*this.h-t+"px",this.c[5].style.borderRadius=.5*t+"px",this.c[5].style.height=t+"px",this.c[5].style.top=.5*this.h-.5*t+"px",this.c[6]=this.dom("div",this.css.basic+"border-radius:"+n+"px; margin-left:"+.5*-i+"px; border:1px solid "+this.colors.border+"; background:"+this.buttonColor+"; left:4px; top:2px; height:"+(this.h-4)+"px; width:"+i+"px;")}this.init()}testZone(t){let e=this.local;return-1===e.x&&-1===e.y?"":e.x>=this.txl?"text":e.x>=this.sa?"scroll":""}mouseup(t){this.isDown&&(this.isDown=!1)}mousedown(t){let e=this.testZone(t);return!!e&&("scroll"===e&&(this.isDown=!0,this.old=this.value,this.mousemove(t)),!0)}mousemove(t){let e=!1;if("scroll"===this.testZone(t)?(this.mode(1),this.cursor("w-resize")):this.cursor(),this.isDown){let i=(t.clientX-(this.zone.x+this.sa)-3)/this.ww*this.range+this.min-this.old;(i>=this.step||i<=this.step)&&(i=Math.floor(i/this.step),this.value=this.numValue(this.old+i*this.step),this.update(!0),this.old=this.value),e=!0}return e}wheel(t){if("scroll"===this.testZone(t)){let e=this.value-this.step*t.delta;return e>this.max?e=this.isCyclic?this.min:this.max:e<this.min&&(e=this.isCyclic?this.max:this.min),this.setValue(e),this.old=e,this.update(!0),!0}return!1}validate(){let t=this.c[2].textContent;isNaN(t)?this.c[2].textContent=this.value+(this.isDeg?"":""):(this.value=this.numValue(t),this.update(!0))}reset(){this.isDown=!1,this.mode(0)}mode(t){let e=this.s;switch(t){case 0:e[2].color=this.fontColor,e[4].background=this.colors.scrollback,e[5].background=this.fontColor;break;case 1:e[2].color=this.colorPlus,e[4].background=this.colors.scrollbackover,e[5].background=this.colorPlus}}update(t){let e=Math.floor(this.ww*((this.value-this.min)/this.range));3!==this.model&&(this.s[5].width=e+"px"),this.s[6]&&(this.s[6].left=this.sa+e+3+"px"),this.c[2].textContent=this.value+(this.isDeg?"":""),t&&this.send()}rSize(){super.rSize();let t=this.sb-this.sc;this.ww=t-6;let e=this.sc;!this.isUI&&this.simple||(e=this.sc+10),this.txl=this.w-e+2;let i=this.s;i[2].width=this.sc-6+"px",i[2].left=this.txl+4+"px",i[3].left=this.sa+"px",i[3].width=t+"px",i[4].left=this.sa+"px",i[4].width=t+"px",i[5].left=this.sa+3+"px",this.update()}}class Vu extends Pu{constructor(t={}){super(t),this.cmode=0,this.value=t.value||"",this.placeHolder=t.placeHolder||"",this.allway=t.allway||!1,this.editable=void 0===t.edit||t.edit,this.isDown=!1,this.c[2]=this.dom("div",this.css.basic+" background:"+this.colors.select+"; top:4px; width:0px; height:"+(this.h-8)+"px;"),this.c[3]=this.dom("div",this.css.txtselect+"height:"+(this.h-4)+"px; background:"+this.colors.inputBg+"; borderColor:"+this.colors.inputBorder+"; border-radius:"+this.radius+"px;"),this.c[3].textContent=this.value,this.c[4]=this.dom("div",this.css.basic+"top:4px; height:"+(this.h-8)+"px; width:0px; background:"+this.fontColor+";"),this.c[5]=this.dom("div",this.css.txtselect+"height:"+(this.h-4)+"px; justify-content: center; font-style: italic; color:"+this.colors.inputHolder+";"),""===this.value&&(this.c[5].textContent=this.placeHolder),this.init()}testZone(t){let e=this.local;return-1===e.x&&-1===e.y?"":e.x>=this.sa?"text":""}mouseup(t){if(this.editable)return!!this.isDown&&(this.isDown=!1,this.mousemove(t))}mousedown(t){if(!this.editable)return;let e=this.testZone(t);return!this.isDown&&(this.isDown=!0,"text"===e&&this.setInput(this.c[3]),this.mousemove(t))}mousemove(t){if(!this.editable)return;let e=0;return"text"===this.testZone(t)?this.cursor("text"):this.cursor(),this.isDown&&(e=t.clientX-this.zone.x),this.upInput(e-this.sa-3,this.isDown)}update(){this.c[3].textContent=this.value}render(t,e,i){this.s[4].width="1px",this.s[4].left=this.sa+t+5+"px",this.s[2].left=this.sa+e+5+"px",this.s[2].width=i+"px"}reset(){this.cursor()}select(t,e,i){let n=this.s,s=this.sa+5;n[4].width="1px",n[4].left=s+t+"px",n[2].left=s+e+"px",n[2].width=i+"px"}unselect(){let t=this.s;t&&(t[2].width="0px",t[4].width="0px")}validate(t){this.allway&&(t=!0),this.value=this.c[3].textContent,""!==this.value?this.c[5].textContent="":this.c[5].textContent=this.placeHolder,t&&this.send()}rSize(){super.rSize();let t=this.s;t[3].left=this.sa+"px",t[3].width=this.sb+"px",t[5].left=this.sa+"px",t[5].width=this.sb+"px"}}class Wu extends Pu{constructor(t={}){super(t);let e=t.prefix||"";this.c[2]=this.dom("div",this.css.txt+"text-align:right; width:60px; line-height:"+(this.h-8)+"px; color:"+this.fontColor),31===this.h&&(this.s[0].height=this.h+"px",this.s[1].top="8px",this.c[2].style.top="8px");let i=this.s;i[1].textAlign=t.align||"left",i[1].fontWeight=t.fontWeight||"bold",this.c[1].textContent=this.txt.substring(0,1).toUpperCase()+this.txt.substring(1).replace("-"," "),this.c[2].textContent=e,this.init()}text(t){this.c[1].textContent=t}text2(t){this.c[2].textContent=t}rSize(){super.rSize(),this.s[1].width=this.w+"px",this.s[2].left=this.w+"px"}}class ju extends Pu{constructor(t={}){super(t),this.value=t.value||"",this.isDown=!1,this.onActif=t.onActif||function(){},this.buttonColor=t.bColor||this.colors.button,this.buttonOver=t.bOver||this.colors.over,this.buttonDown=t.bDown||this.colors.select,this.buttonAction=t.bAction||this.colors.action,t.prefix,this.c[2]=this.dom("div",this.css.txt+this.css.button+" top:1px; background:"+this.buttonColor+"; height:"+(this.h-2)+"px; border:"+this.colors.buttonBorder+"; border-radius:15px; width:30px; left:10px;"),this.c[2].style.color=this.fontColor,this.c[3]=this.dom("div",this.css.txtselect+"height:"+(this.h-4)+"px; background:"+this.colors.inputBg+"; borderColor:"+this.colors.inputBorder+"; border-radius:"+this.radius+"px;"),this.c[3].textContent=this.value;let e=Math.floor(.5*this.h)-7;this.c[4]=this.dom("path",this.css.basic+"position:absolute; width:14px; height:14px; left:5px; top:"+e+"px;",{d:this.svgs.cursor,fill:this.fontColor,stroke:"none"}),this.stat=1,this.isActif=!1,this.init()}testZone(t){let e=this.local;return-1===e.x&&-1===e.y?"":e.x>this.sa&&e.x<this.sa+30?"over":"0"}mouseup(t){return!!this.isDown&&(this.isDown=!1,this.mousemove(t))}mousedown(t){return!!this.testZone(t)&&(this.isDown=!0,this.mousemove(t))}mousemove(t){let e=!1;return"over"===this.testZone(t)?(this.cursor("pointer"),e=this.mode(this.isDown?3:2)):e=this.reset(),e}apply(t){(t=t||"")!==this.value&&(this.value=t,this.c[3].textContent=this.value,this.send()),this.mode(1)}update(){this.mode(3)}mode(t){let e=!1;if(this.stat!==t){switch(1===t&&(this.isActif=!1),3===t&&(this.isActif?this.isActif=!1:(this.isActif=!0,t=4,this.onActif(this))),2===t&&this.isActif&&(t=4),t){case 1:this.stat=1,this.s[2].color=this.fontColor,this.s[2].background=this.buttonColor;break;case 2:this.stat=2,this.s[2].color=this.fontSelect,this.s[2].background=this.buttonOver;break;case 3:this.stat=3,this.s[2].color=this.fontSelect,this.s[2].background=this.buttonDown;break;case 4:this.stat=4,this.s[2].color=this.fontSelect,this.s[2].background=this.buttonAction}e=!0}return e}reset(){return this.cursor(),this.mode(this.isActif?4:1)}text(t){this.c[3].textContent=t}rSize(){super.rSize();let t=this.s;t[2].left=this.sa+"px",t[3].left=this.sa+40+"px",t[3].width=this.sb-40+"px",t[4].left=this.sa+8+"px"}}class Xu extends Pu{constructor(t={}){let e;super(t),this.values=t.values,"string"==typeof this.values&&(this.values=[this.values]),this.value=t.value||null,this.isSelectable=!0,void 0!==t.selectable&&(this.isSelectable=t.selectable),this.isDown=!1,this.buttonColor=t.bColor||this.colors.button,this.buttonOver=t.bOver||this.colors.over,this.buttonDown=t.bDown||this.colors.select,this.lng=this.values.length,this.tmp=[],this.stat=[];for(let t=0;t<this.lng;t++)e=!1,this.values[t]===this.value&&this.isSelectable&&(e=!0),this.c[t+2]=this.dom("div",this.css.txt+this.css.button+" top:1px; height:"+(this.h-2)+"px; border:"+this.colors.buttonBorder+"; border-radius:"+this.radius+"px;"),this.c[t+2].style.background=e?this.buttonDown:this.buttonColor,this.c[t+2].style.color=e?this.fontSelect:this.fontColor,this.c[t+2].innerHTML=this.values[t],this.stat[t]=e?3:1;this.init()}testZone(t){let e=this.local;if(-1===e.x&&-1===e.y)return"";let i=this.lng,n=this.tmp;for(;i--;)if(e.x>n[i][0]&&e.x<n[i][2])return i;return-1}mouseup(t){return!!this.isDown&&(this.isDown=!1,this.mousemove(t))}mousedown(t){let e=this.testZone(t);return!(e<0)&&(this.isDown=!0,this.value=this.values[e],this.send(),this.mousemove(t))}mousemove(t){let e=!1,i=this.testZone(t);return-1!==i?(this.cursor("pointer"),e=this.modes(this.isDown?3:2,i)):e=this.reset(),e}modes(t,e){let i,n=!1,s=this.lng;for(;s--;)i=s===e?this.mode(t,s):this.isSelectable&&this.values[s]===this.value?this.mode(3,s):this.mode(1,s),i&&(n=!0);return n}mode(t,e){let i=!1,n=e+2;if(this.stat[e]!==t){switch(t){case 1:this.stat[e]=1,this.s[n].color=this.fontColor,this.s[n].background=this.buttonColor;break;case 2:this.stat[e]=2,this.s[n].color=this.fontSelect,this.s[n].background=this.buttonOver;break;case 3:this.stat[e]=3,this.s[n].color=this.fontSelect,this.s[n].background=this.buttonDown}i=!0}return i}reset(){return this.cursor(),this.modes(1,-1)}label(t,e){e=e||2,this.c[e].textContent=t}icon(t,e,i){i=i||2,this.s[i].padding=(e||0)+"px 0px",this.c[i].innerHTML=t}rSize(){super.rSize();let t=this.s,e=this.sb,i=this.sa,n=this.lng,s=Math.floor((e-3*(n-1))/n);for(;n--;)this.tmp[n]=[Math.floor(i+s*n+3*n),s],this.tmp[n][2]=this.tmp[n][0]+this.tmp[n][1],t[n+2].left=this.tmp[n][0]+"px",t[n+2].width=this.tmp[n][1]+"px"}}class Yu extends Pu{constructor(t={}){t.simple=!0,t.isSpace=!0,super(t),this.init()}}class qu extends Pu{constructor(t={}){super(t),this.p=100,this.value=this.txt,this.status=1,this.itype=t.itype||"none",this.val=this.itype,this.graph=this.svgs[this.itype];let e=Math.floor(.5*this.h)-7;this.c[2]=this.dom("path",this.css.basic+"position:absolute; width:14px; height:14px; left:5px; top:"+e+"px;",{d:this.graph,fill:this.fontColor,stroke:"none"}),this.s[1].marginLeft="20px",this.init()}mousemove(t){this.cursor("pointer")}mousedown(t){return this.isUI&&this.main.resetItem(),this.selected(!0),this.send(),!0}uiout(){this.isSelect?this.mode(3):this.mode(1)}uiover(){this.isSelect?this.mode(4):this.mode(2)}update(){}mode(t){let e=!1;if(this.status!==t){switch(this.status=t,t){case 1:this.status=1,this.s[1].color=this.fontColor,this.s[0].background="none";break;case 2:this.status=2,this.s[1].color=this.fontColor,this.s[0].background=this.bgOver;break;case 3:this.status=3,this.s[1].color="#FFF",this.s[0].background=this.colors.select;break;case 4:this.status=4,this.s[1].color="#FFF",this.s[0].background=this.colors.down}e=!0}return e}reset(){this.cursor()}selected(t){this.isSelect&&this.mode(1),this.isSelect=t||!1,this.isSelect&&this.mode(3)}}class Qu extends Pu{constructor(t={}){super(t),this.values=t.values||[],"string"==typeof this.values&&(this.values=[this.values]),this.value=t.value||null,this.isSelectable=t.selectable||!1,this.isDown=!1,this.buttonColor=t.bColor||this.colors.button,this.buttonOver=t.bOver||this.colors.over,this.buttonDown=t.bDown||this.colors.select,this.spaces=t.spaces||[5,3],this.bsize=t.bsize||[90,20],t.h&&(this.bsize[1]=t.h),this.bsizeMax=this.bsize[0],this.lng=this.values.length,this.tmp=[],this.stat=[],this.grid=[2,Math.round(.5*this.lng)],this.h=this.grid[1]*(this.bsize[1]+this.spaces[1])+this.spaces[1],this.c[1].textContent="",this.c[2]=this.dom("table",this.css.basic+"width:100%; top:"+(this.spaces[1]-2)+"px; height:auto; border-collapse:separate; border:none; border-spacing: "+(this.spaces[0]-2)+"px "+(this.spaces[1]-2)+"px;");let e,i,n,s,r=0;this.buttons=[],this.stat=[],this.tmpX=[],this.tmpY=[];for(let t=0;t<this.grid[1];t++){n=this.c[2].insertRow(),n.style.cssText="pointer-events:none;";for(let t=0;t<this.grid[0];t++)i=n.insertCell(),i.style.cssText="pointer-events:none;",this.values[r]?(s=!1,this.values[r]===this.value&&this.isSelectable&&(s=!0),e=document.createElement("div"),e.style.cssText=this.css.txt+this.css.button+"position:static; width:"+this.bsize[0]+"px; height:"+this.bsize[1]+"px; border:"+this.colors.buttonBorder+"; left:auto; right:auto; border-radius:"+this.radius+"px;",e.style.background=s?this.buttonDown:this.buttonColor,e.style.color=s?this.fontSelect:this.fontColor,e.innerHTML=this.values[r],i.appendChild(e),this.buttons.push(e),this.stat.push(1)):(e=document.createElement("div"),e.style.cssText=this.css.txt+"position:static; width:"+this.bsize[0]+"px; height:"+this.bsize[1]+"px; text-align:center;  left:auto; right:auto; background:none;",i.appendChild(e)),e.style.cssText+=0===t?"float:right;":"float:left;",r++}this.init()}testZone(t){let e=this.local;if(-1===e.x&&-1===e.y)return-1;let i=this.tmpX,n=this.tmpY,s=-1,r=-1,a=-1,o=this.grid[0];for(;o--;)e.x>i[o][0]&&e.x<i[o][1]&&(r=o);for(o=this.grid[1];o--;)e.y>n[o][0]&&e.y<n[o][1]&&(a=o);return-1!==r&&-1!==a&&(s=r+2*a,s>this.lng-1&&(s=-1)),s}mouseup(t){return!!this.isDown&&(this.isDown=!1,this.mousemove(t))}mousedown(t){let e=this.testZone(t);return!(e<0)&&(this.isDown=!0,this.value=this.values[e],this.send(),this.mousemove(t))}mousemove(t){let e=!1,i=this.testZone(t);return-1!==i?(this.cursor("pointer"),e=this.modes(this.isDown?3:2,i)):e=this.reset(),e}modes(t,e){let i,n=!1,s=this.lng;for(;s--;)i=s===e?this.mode(t,s):this.isSelectable&&this.values[s]===this.value?this.mode(3,s):this.mode(1,s),i&&(n=!0);return n}mode(t,e){let i=!1;if(this.stat[e]!==t){switch(t){case 1:this.stat[e]=1,this.buttons[e].style.color=this.fontColor,this.buttons[e].style.background=this.buttonColor;break;case 2:this.stat[e]=2,this.buttons[e].style.color=this.fontSelect,this.buttons[e].style.background=this.buttonOver;break;case 3:this.stat[e]=3,this.buttons[e].style.color=this.fontSelect,this.buttons[e].style.background=this.buttonDown}i=!0}return i}reset(){return this.cursor(),this.modes(1,-1)}label(t,e){this.buttons[e].textContent=t}icon(t,e,i){this.buttons[i].style.padding=(e||0)+"px 0px",this.buttons[i].innerHTML=t}testW(){let t=!1;if(3*this.spaces[0]+2*this.bsizeMax>this.w?(this.bsize[0]=.5*(this.w-3*this.spaces[0]),t=!0):this.bsize[0]!==this.bsizeMax&&(this.bsize[0]=this.bsizeMax,t=!0),!t)return;let e=this.buttons.length;for(;e--;)this.buttons[e].style.width=this.bsize[0]+"px"}rSize(){let t;super.rSize(),this.testW(),this.tmpX=[],this.tmpY=[];for(let e=0;e<this.grid[0];e++)0===e?(t=.5*this.w-.5*this.spaces[0],this.tmpX.push([t-this.bsize[0],t])):(t=.5*this.w+.5*this.spaces[0],this.tmpX.push([t,t+this.bsize[0]]));t=this.spaces[1];for(let e=0;e<this.grid[1];e++)this.tmpY.push([t,t+this.bsize[1]]),t+=this.bsize[1]+this.spaces[1]}}class Zu extends Pu{constructor(t={}){super(t),this.autoWidth=!1,this.margin=15,this.pos=new Cu,this.model=t.stype||0,void 0!==t.mode&&(this.model=t.mode),this.precision=void 0===t.precision?2:t.precision,this.bounds={},this.bounds.x1=t.x1||-1,this.bounds.x2=t.x2||1,this.bounds.y1=t.y1||-1,this.bounds.y2=t.y2||1,this.lerpX=this.lerp(this.margin,this.w-this.margin,this.bounds.x1,this.bounds.x2),this.lerpY=this.lerp(this.margin,this.w-this.margin,this.bounds.y1,this.bounds.y2),this.alerpX=this.lerp(this.bounds.x1,this.bounds.x2,this.margin,this.w-this.margin),this.alerpY=this.lerp(this.bounds.y1,this.bounds.y2,this.margin,this.w-this.margin),this.value=[];let e=Array.isArray(t.value)&&2==t.value.length?t.value:[0,0];this.setValue(e),this.h=t.h||this.w+10,this.top=0,this.c[0].style.width=this.w+"px",void 0!==this.c[1]&&(this.c[1].style.width=this.w+"px",this.c[1].style.textAlign="center",this.top=10,this.h+=10),this.c[2]=this.dom("div",this.css.txt+"text-align:center; top:"+(this.h-20)+"px; width:"+this.w+"px; color:"+this.fontColor),this.c[2].textContent=this.value;let i=Au.dom("svg",Au.css.basic,{viewBox:"0 0 "+this.w+" "+this.w,width:this.w,height:this.w,preserveAspectRatio:"none"});Au.dom("rect","",{x:this.margin-5,y:this.margin-5,width:this.w-2*(this.margin-5),height:this.w-2*(this.margin-5),rx:5,ty:5,stroke:"rgba(0,0,0,0.25)","stroke-width":0,fill:"rgba(0,0,0,0.1)"},i),Au.dom("rect","",{x:this.margin,y:this.margin,width:this.w-2*this.margin,height:this.w-2*this.margin,stroke:"rgba(0,0,0,0.25)","stroke-width":0,fill:"rgba(0,0,0,0.1)"},i),this.c[3]=i,this.setSvg(this.c[3],"viewBox","0 0 "+this.w+" "+this.w),this.setCss(this.c[3],{left:0,top:this.top}),Au.dom("line","",{x1:this.margin,y1:this.w/2,x2:this.w-this.margin,y2:this.w/2,stroke:"#1C1C1C","stroke-width":1},this.c[3]),Au.dom("line","",{x1:this.w/2,y1:this.margin,x2:this.w/2,y2:this.w-this.margin,stroke:"#1C1C1C","stroke-width":1},this.c[3]),Au.dom("circle","",{cx:this.w/2,cy:this.w/2,r:5,stroke:"rgba(0,0,0,0.25)","stroke-width":0,fill:this.fontColor},this.c[3]),this.init(),this.update(!1)}testZone(t){let e=this.local;return-1===e.x&&-1===e.y?"":e.x>=this.margin&&e.x<=this.w-this.margin&&e.y>=this.top+this.margin&&e.y<=this.top+this.w-this.margin?"pad":""}mouseup(t){this.isDown=!1}mousedown(t){"pad"===this.testZone(t)&&(this.isDown=!0,this.mousemove(t))}mousemove(t){if(!this.isDown)return;let e=t.clientX-this.zone.x,i=t.clientY-this.zone.y-this.top;e<this.margin&&(e=this.margin),e>this.w-this.margin&&(e=this.w-this.margin),i<this.margin&&(i=this.margin),i>this.w-this.margin&&(i=this.w-this.margin),this.setPos([e,i]),this.update()}update(t){void 0===t&&(t=!0),this.c[2].textContent=this.value,this.updateSVG(),t&&this.send()}updateSVG(){1==this.model&&(this.setSvg(this.c[3],"y1",this.pos.y,2),this.setSvg(this.c[3],"y2",this.pos.y,2),this.setSvg(this.c[3],"x1",this.pos.x,3),this.setSvg(this.c[3],"x2",this.pos.x,3)),this.setSvg(this.c[3],"cx",this.pos.x,4),this.setSvg(this.c[3],"cy",this.pos.y,4)}setPos(t){void 0===t&&(t=[this.w/2,this.w/2]),this.pos.set(t[0],t[1]),this.value[0]=this.lerpX(t[0]).toFixed(this.precision),this.value[1]=this.lerpY(t[1]).toFixed(this.precision)}setValue(t,e=!1){void 0===t&&(t=[0,0]),t[0]<this.bounds.x1&&(t[0]=this.bounds.x1),t[0]>this.bounds.x2&&(t[0]=this.bounds.x2),t[1]<this.bounds.y1&&(t[1]=this.bounds.y1),t[1]>this.bounds.y2&&(t[1]=this.bounds.y2),this.value[0]=t[0],this.value[1]=t[1],this.pos.set(this.alerpX(t[0]),this.alerpY(t[1])),e&&this.update()}lerp(t,e,i,n,s=!0){let r=(n-i)/(e-t);return s?n=>((n<t?t:n>e?e:n)-t)*r+i:e=>(e-t)*r+i}}const Ju=function(){let t,e,i=arguments,n=!1,s=null;"string"==typeof i[0]?(t=i[0],e=i[1]||{}):"object"==typeof i[0]&&(n=!0,void 0===i[2]&&[].push.call(i,{}),t=i[2].type?i[2].type:"slide",e=i[2],e.name=i[1],e.value=i[0][i[1]]);let r=t.toLowerCase();switch("group"===r&&(e.add=Ju),r){case"bool":s=new Ru(e);break;case"button":s=new Fu(e);break;case"circular":s=new Iu(e);break;case"color":s=new Du(e);break;case"fps":s=new Nu(e);break;case"graph":s=new ku(e);break;case"group":s=new zu(e);break;case"joystick":s=new Uu(e);break;case"knob":s=new Ou(e);break;case"list":s=new Bu(e);break;case"numeric":case"number":s=new Hu(e);break;case"slide":s=new Gu(e);break;case"textInput":case"string":s=new Vu(e);break;case"title":s=new Wu(e);break;case"select":s=new ju(e);break;case"selector":s=new Xu(e);break;case"empty":case"space":s=new Yu(e);break;case"item":s=new qu(e);break;case"grid":s=new Qu(e);break;case"pad2d":s=new Zu(e)}if(null!==s)return n&&s.setReferency(i[0],i[1]),s};class Ku{constructor(t={}){this.canvas=null,this.isEmpty=!0,this.colors=Au.cloneColor(),this.css=Au.cloneCss(),t.config&&this.setConfig(t.config),this.bg=t.bg||this.colors.background,void 0!==t.transparent&&(this.colors.background="none",this.colors.backgroundOver="none"),this.isReset=!0,this.tmpAdd=null,this.tmpH=0,this.isCanvas=t.isCanvas||!1,this.isCanvasOnly=!1,this.cssGui=void 0!==t.css?t.css:"",this.callback=void 0===t.callback?null:t.callback,this.forceHeight=t.maxHeight||0,this.lockHeight=t.lockHeight||!1,this.isItemMode=void 0!==t.itemMode&&t.itemMode,this.cn="",this.size=Au.size,void 0!==t.p&&(this.size.p=t.p),void 0!==t.w&&(this.size.w=t.w),void 0!==t.h&&(this.size.h=t.h),void 0!==t.s&&(this.size.s=t.s),this.size.h=this.size.h<11?11:this.size.h,this.local=(new Cu).neg(),this.zone={x:0,y:0,w:this.size.w,h:0},this.mouse=(new Cu).neg(),this.h=0,this.prevY=-1,this.sw=0,this.isWithClose=void 0===t.close||t.close,this.bh=this.isWithClose?this.size.h:0,this.autoResize=void 0===t.autoResize||t.autoResize,this.isCenter=t.center||!1,this.isOpen=void 0===t.open||t.open,this.isDown=!1,this.isScroll=!1,this.uis=[],this.current=-1,this.target=null,this.decal=0,this.ratio=1,this.oy=0,this.isNewTarget=!1,this.content=Au.dom("div",this.css.basic+" width:0px; height:auto; top:0px; background:"+this.colors.content+"; "+this.cssGui),this.innerContent=Au.dom("div",this.css.basic+"width:100%; top:0; left:0; height:auto; overflow:hidden;"),this.content.appendChild(this.innerContent),this.inner=Au.dom("div",this.css.basic+"width:100%; left:0; "),this.innerContent.appendChild(this.inner),this.scrollBG=Au.dom("div",this.css.basic+"right:0; top:0; width:"+(this.size.s-1)+"px; height:10px; display:none; background:"+this.bg+";"),this.content.appendChild(this.scrollBG),this.scroll=Au.dom("div",this.css.basic+"background:"+this.colors.scroll+"; right:2px; top:0; width:"+(this.size.s-4)+"px; height:10px;"),this.scrollBG.appendChild(this.scroll),this.bottomText=t.bottomText||["open","close"];let e=t.radius||this.colors.radius;this.bottom=Au.dom("div",this.css.txt+"width:100%; top:auto; bottom:0; left:0; border-bottom-right-radius:"+e+"px;  border-bottom-left-radius:"+e+"px; text-align:center; height:"+this.bh+"px; line-height:"+(this.bh-5)+"px;"),this.content.appendChild(this.bottom),this.bottom.textContent=this.isOpen?this.bottomText[1]:this.bottomText[0],this.bottom.style.background=this.bg,this.parent=void 0!==t.parent?t.parent:null,this.parent=void 0!==t.target?t.target:this.parent,null!==this.parent||this.isCanvas||(this.parent=document.body,this.isCenter||(this.content.style.right="10px")),null!==this.parent&&this.parent.appendChild(this.content),this.isCanvas&&null===this.parent&&(this.isCanvasOnly=!0),this.isCanvasOnly||(this.content.style.pointerEvents="auto"),this.setWidth(),this.isCanvas&&this.makeCanvas(),Lu.add(this)}setTop(t,e){this.content.style.top=t+"px",void 0!==e&&(this.forceHeight=e),this.setHeight(),Lu.needReZone=!0}dispose(){this.clear(),null!==this.parent&&this.parent.removeChild(this.content),Lu.remove(this)}onDraw(){}makeCanvas(){this.canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.canvas.width=this.zone.w,this.canvas.height=this.forceHeight?this.forceHeight:this.zone.h}draw(t){if(null===this.canvas)return;let e=this.zone.w,i=this.forceHeight?this.forceHeight:this.zone.h;Lu.toCanvas(this,e,i,t)}getDom(){return this.content}setMouse(t){this.mouse.set(t.x,t.y)}setConfig(t){this.setColors(t),this.setText(t.fontSize,t.text,t.font,t.shadow)}setColors(t){for(let e in t)this.colors[e]&&(this.colors[e]=t[e])}setText(t,e,i,n){Au.setText(t,e,i,n,this.colors,this.css)}hide(t){this.content.style.display=t?"none":"block"}onChange(t){return this.callback=t||null,this}mode(t){let e=!1;if(t!==this.cn){switch(this.cn=t,t){case"def":this.scroll.style.background=this.colors.scroll,this.bottom.style.background=this.colors.background,this.bottom.style.color=this.colors.text;break;case"scrollOver":this.scroll.style.background=this.colors.select;break;case"scrollDown":this.scroll.style.background=this.colors.down;break;case"bottomOver":this.bottom.style.background=this.colors.backgroundOver,this.bottom.style.color="#FFF"}e=!0}return e}clearTarget(){return-1!==this.current&&(this.target.uiout(),this.target.reset(),this.target=null,this.current=-1,Lu.cursor(),!0)}testZone(t){let e=this.local;if(-1===e.x&&-1===e.y)return"";this.isReset=!1;let i="",n=this.isScroll?this.zone.w-this.size.s:this.zone.w;return i=e.y>this.zone.h-this.bh&&e.y<this.zone.h?"bottom":e.x>n?"scroll":"content",i}handleEvent(t){let e=t.type,i=!1,n=!1,s=this.testZone(t);if("mouseup"===e&&this.isDown&&(this.isDown=!1),"mousedown"!==e||this.isDown||(this.isDown=!0),this.isDown&&this.isNewTarget&&(Lu.clearInput(),this.isNewTarget=!1),s){switch(s){case"content":t.clientY=this.isScroll?t.clientY+this.decal:t.clientY,Lu.isMobile&&"mousedown"===e&&this.getNext(t,i),this.target&&(n=this.target.handleEvent(t)),"mousemove"===e&&(i=this.mode("def")),"wheel"===e&&!n&&this.isScroll&&(i=this.onWheel(t)),Lu.lock||this.getNext(t,i);break;case"bottom":this.clearTarget(),"mousemove"===e&&(i=this.mode("bottomOver")),"mousedown"===e&&(this.isOpen=!this.isOpen,this.bottom.textContent=this.isOpen?this.bottomText[1]:this.bottomText[0],this.setHeight(),this.mode("def"),i=!0);break;case"scroll":this.clearTarget(),"mousemove"===e&&(i=this.mode("scrollOver")),"mousedown"===e&&(i=this.mode("scrollDown")),"wheel"===e&&(i=this.onWheel(t)),this.isDown&&this.update(t.clientY-this.zone.y-.5*this.sh)}this.isDown&&(i=!0),n&&(i=!0),"keyup"===e&&(i=!0),"keydown"===e&&(i=!0),i&&this.draw()}}getNext(t,e){let i=Lu.findTarget(this.uis,t);i!==this.current&&(this.clearTarget(),this.current=i,this.isNewTarget=!0),-1!==i&&(this.target=this.uis[this.current],this.target.uiover())}onWheel(t){return this.oy+=20*t.delta,this.update(this.oy),!0}reset(t){if(this.isReset)return;this.mouse.neg(),this.isDown=!1;let e=this.mode("def"),i=this.clearTarget();(e||i)&&this.draw(!0),this.isReset=!0}add(){let t=arguments,e=!1;"object"==typeof t[1]?(t[1].isUI=!0,t[1].main=this,e=!!t[1].ontop&&t[1].ontop):"string"==typeof t[1]&&(void 0===t[2]?[].push.call(t,{isUI:!0,main:this}):(t[2].isUI=!0,t[2].main=this,e=!!t[1].ontop&&t[1].ontop));let i=Ju.apply(this,t);if(null!==i){if(e?this.uis.unshift(i):this.uis.push(i),i.autoWidth)this.prevY=0,this.calc(i.h+1);else{let t=i.c[0].getBoundingClientRect().top;this.prevY!==t&&(this.calc(i.h+1),this.prevY=t)}return this.isEmpty=!1,i}}applyCalc(){this.calc(this.tmpH),this.tmpAdd=null}calcUis(){Lu.calcUis(this.uis,this.zone,this.zone.y)}remove(t){t.clear&&t.clear()}clearOne(t){let e=this.uis.indexOf(t);-1!==e&&(this.calc(-(this.uis[e].h+1)),this.inner.removeChild(this.uis[e].c[0]),this.uis.splice(e,1))}empty(){let t,e=this.uis.length;for(;e--;)t=this.uis.pop(),this.inner.removeChild(t.c[0]),t.clear(!0);this.isEmpty=!0,this.calc(-this.h)}clear(){this.empty()}resetItem(){if(!this.isItemMode)return;let t=this.uis.length;for(;t--;)this.uis[t].selected()}setItem(t){if(!this.isItemMode)return;if(t=t||"",this.resetItem(),!t)return void this.update(0);let e=this.uis.length;for(;e--;)this.uis[e].value===t&&(this.uis[e].selected(!0),this.isScroll&&this.update(e*(this.uis[e].h+1)*this.ratio))}upScroll(t){this.sw=t?this.size.s:0,this.oy=t?this.oy:0,this.scrollBG.style.display=t?"block":"none",t&&(this.total=this.h,this.maxView=this.maxHeight,this.ratio=this.maxView/this.total,this.sh=this.maxView*this.ratio,this.range=this.maxView-this.sh,this.oy=Au.clamp(this.oy,0,this.range),this.scrollBG.style.height=this.maxView+"px",this.scroll.style.height=this.sh+"px"),this.setItemWidth(this.zone.w-this.sw),this.update(this.oy)}update(t){t=Au.clamp(t,0,this.range),this.decal=Math.floor(t/this.ratio),this.inner.style.top=-this.decal+"px",this.scroll.style.top=Math.floor(t)+"px",this.oy=t}calc(t){this.h+=t,clearTimeout(this.tmp),this.tmp=setTimeout(this.setHeight.bind(this),10)}setHeight(){if(this.tmp&&clearTimeout(this.tmp),this.zone.h=this.bh,this.isScroll=!1,this.isOpen){let t=this.forceHeight?this.forceHeight+this.zone.y:window.innerHeight;this.maxHeight=t-this.zone.y-this.bh,this.h-this.maxHeight>1?(this.isScroll=!0,this.zone.h=this.maxHeight+this.bh):this.zone.h=this.h+this.bh}this.upScroll(this.isScroll),this.innerContent.style.height=this.zone.h-this.bh+"px",this.content.style.height=this.zone.h+"px",this.bottom.style.top=this.zone.h-this.bh+"px",this.forceHeight&&this.lockHeight&&(this.content.style.height=this.forceHeight+"px"),this.isOpen&&this.calcUis(),this.isCanvas&&this.draw(!0)}rezone(){Lu.needReZone=!0}setWidth(t){t&&(this.zone.w=t),this.content.style.width=this.zone.w+"px",this.isCenter&&(this.content.style.marginLeft=-Math.floor(.5*this.zone.w)+"px"),this.setItemWidth(this.zone.w-this.sw),this.setHeight(),this.isCanvasOnly||(Lu.needReZone=!0)}setItemWidth(t){let e=this.uis.length;for(;e--;)this.uis[e].setSize(t),this.uis[e].rSize()}}Ku.prototype.isGui=!0;const $u={type:"change"},td={type:"start"},ed={type:"end"};class id extends pt{constructor(t,e){super(),void 0===e&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Wt,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:n.ROTATE,MIDDLE:n.DOLLY,RIGHT:n.PAN},this.touches={ONE:s.ROTATE,TWO:s.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getSpherical=function(){return l},this.getState=function(){return a},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",j),this._domElementKeyEvents=t},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent($u),i.update(),a=r.NONE},this.update=function(){const e=new Wt,n=(new Vt).setFromUnitVectors(t.up,new Wt(0,1,0)),s=n.clone().invert(),p=new Wt,m=new Vt,f=2*Math.PI;return function(){const t=i.object.position;e.copy(t).sub(i.target),e.applyQuaternion(n),l.setFromVector3(e),i.autoRotate&&a===r.NONE&&T(2*Math.PI/60/60*i.autoRotateSpeed),i.enableDamping?(l.theta+=h.theta*i.dampingFactor,l.phi+=h.phi*i.dampingFactor):(l.theta+=h.theta,l.phi+=h.phi);let g=i.minAzimuthAngle,v=i.maxAzimuthAngle;return isFinite(g)&&isFinite(v)&&(g<-Math.PI?g+=f:g>Math.PI&&(g-=f),v<-Math.PI?v+=f:v>Math.PI&&(v-=f),l.theta=g<=v?Math.max(g,Math.min(v,l.theta)):l.theta>(g+v)/2?Math.max(g,l.theta):Math.min(v,l.theta)),l.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,l.phi)),l.makeSafe(),l.radius*=c,l.radius=Math.max(i.minDistance,Math.min(i.maxDistance,l.radius)),!0===i.enableDamping?i.target.addScaledVector(u,i.dampingFactor):i.target.add(u),e.setFromSpherical(l),e.applyQuaternion(s),t.copy(i.target).add(e),i.object.lookAt(i.target),!0===i.enableDamping?(h.theta*=1-i.dampingFactor,h.phi*=1-i.dampingFactor,u.multiplyScalar(1-i.dampingFactor)):(h.set(0,0,0),u.set(0,0,0)),c=1,!!(d||p.distanceToSquared(i.object.position)>o||8*(1-m.dot(i.object.quaternion))>o)&&(i.dispatchEvent($u),p.copy(i.object.position),m.copy(i.object.quaternion),d=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",X),i.domElement.removeEventListener("pointerdown",B),i.domElement.removeEventListener("pointercancel",V),i.domElement.removeEventListener("wheel",W),i.domElement.ownerDocument.removeEventListener("pointermove",H),i.domElement.ownerDocument.removeEventListener("pointerup",G),null!==i._domElementKeyEvents&&i._domElementKeyEvents.removeEventListener("keydown",j)};const i=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let a=r.NONE;const o=1e-6,l=new Nc,h=new Nc;let c=1;const u=new Wt;let d=!1;const p=new Et,m=new Et,f=new Et,g=new Et,v=new Et,x=new Et,y=new Et,b=new Et,w=new Et,_=[],M={};function S(){return Math.pow(.95,i.zoomSpeed)}function T(t){h.theta-=t}function A(t){h.phi-=t}const E=function(){const t=new Wt;return function(e,i){t.setFromMatrixColumn(i,0),t.multiplyScalar(-e),u.add(t)}}(),L=function(){const t=new Wt;return function(e,n){!0===i.screenSpacePanning?t.setFromMatrixColumn(n,1):(t.setFromMatrixColumn(n,0),t.crossVectors(i.object.up,t)),t.multiplyScalar(e),u.add(t)}}(),C=function(){const t=new Wt;return function(e,n){const s=i.domElement;if(i.object.isPerspectiveCamera){const r=i.object.position;t.copy(r).sub(i.target);let a=t.length();a*=Math.tan(i.object.fov/2*Math.PI/180),E(2*e*a/s.clientHeight,i.object.matrix),L(2*n*a/s.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(E(e*(i.object.right-i.object.left)/i.object.zoom/s.clientWidth,i.object.matrix),L(n*(i.object.top-i.object.bottom)/i.object.zoom/s.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function P(t){i.object.isPerspectiveCamera?c/=t:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*t)),i.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function R(t){i.object.isPerspectiveCamera?c*=t:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/t)),i.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function F(t){p.set(t.clientX,t.clientY)}function I(t){g.set(t.clientX,t.clientY)}function D(){if(1===_.length)p.set(_[0].pageX,_[0].pageY);else{const t=.5*(_[0].pageX+_[1].pageX),e=.5*(_[0].pageY+_[1].pageY);p.set(t,e)}}function N(){if(1===_.length)g.set(_[0].pageX,_[0].pageY);else{const t=.5*(_[0].pageX+_[1].pageX),e=.5*(_[0].pageY+_[1].pageY);g.set(t,e)}}function k(){const t=_[0].pageX-_[1].pageX,e=_[0].pageY-_[1].pageY,i=Math.sqrt(t*t+e*e);y.set(0,i)}function z(t){if(1==_.length)m.set(t.pageX,t.pageY);else{const e=Q(t),i=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);m.set(i,n)}f.subVectors(m,p).multiplyScalar(i.rotateSpeed);const e=i.domElement;T(2*Math.PI*f.x/e.clientHeight),A(2*Math.PI*f.y/e.clientHeight),p.copy(m)}function U(t){if(1===_.length)v.set(t.pageX,t.pageY);else{const e=Q(t),i=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);v.set(i,n)}x.subVectors(v,g).multiplyScalar(i.panSpeed),C(x.x,x.y),g.copy(v)}function O(t){const e=Q(t),n=t.pageX-e.x,s=t.pageY-e.y,r=Math.sqrt(n*n+s*s);b.set(0,r),w.set(0,Math.pow(b.y/y.y,i.zoomSpeed)),P(w.y),y.copy(b)}function B(t){!1!==i.enabled&&(0===_.length&&(i.domElement.setPointerCapture(t.pointerId),i.domElement.ownerDocument.addEventListener("pointermove",H),i.domElement.ownerDocument.addEventListener("pointerup",G)),function(t){_.push(t)}(t),"touch"===t.pointerType?function(t){switch(q(t),_.length){case 1:switch(i.touches.ONE){case s.ROTATE:if(!1===i.enableRotate)return;D(),a=r.TOUCH_ROTATE;break;case s.PAN:if(!1===i.enablePan)return;N(),a=r.TOUCH_PAN;break;default:a=r.NONE}break;case 2:switch(i.touches.TWO){case s.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&k(),i.enablePan&&N(),a=r.TOUCH_DOLLY_PAN;break;case s.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&k(),i.enableRotate&&D(),a=r.TOUCH_DOLLY_ROTATE;break;default:a=r.NONE}break;default:a=r.NONE}a!==r.NONE&&i.dispatchEvent(td)}(t):function(t){let e;switch(t.button){case 0:e=i.mouseButtons.LEFT;break;case 1:e=i.mouseButtons.MIDDLE;break;case 2:e=i.mouseButtons.RIGHT;break;default:e=-1}switch(e){case n.DOLLY:if(!1===i.enableZoom)return;!function(t){y.set(t.clientX,t.clientY)}(t),a=r.DOLLY;break;case n.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===i.enablePan)return;I(t),a=r.PAN}else{if(!1===i.enableRotate)return;F(t),a=r.ROTATE}break;case n.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===i.enableRotate)return;F(t),a=r.ROTATE}else{if(!1===i.enablePan)return;I(t),a=r.PAN}break;default:a=r.NONE}a!==r.NONE&&i.dispatchEvent(td)}(t))}function H(t){!1!==i.enabled&&("touch"===t.pointerType?function(t){switch(q(t),a){case r.TOUCH_ROTATE:if(!1===i.enableRotate)return;z(t),i.update();break;case r.TOUCH_PAN:if(!1===i.enablePan)return;U(t),i.update();break;case r.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(t){i.enableZoom&&O(t),i.enablePan&&U(t)}(t),i.update();break;case r.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(t){i.enableZoom&&O(t),i.enableRotate&&z(t)}(t),i.update();break;default:a=r.NONE}}(t):function(t){if(!1===i.enabled)return;switch(a){case r.ROTATE:if(!1===i.enableRotate)return;!function(t){m.set(t.clientX,t.clientY),f.subVectors(m,p).multiplyScalar(i.rotateSpeed);const e=i.domElement;T(2*Math.PI*f.x/e.clientHeight),A(2*Math.PI*f.y/e.clientHeight),p.copy(m),i.update()}(t);break;case r.DOLLY:if(!1===i.enableZoom)return;!function(t){b.set(t.clientX,t.clientY),w.subVectors(b,y),w.y>0?P(S()):w.y<0&&R(S()),y.copy(b),i.update()}(t);break;case r.PAN:if(!1===i.enablePan)return;!function(t){v.set(t.clientX,t.clientY),x.subVectors(v,g).multiplyScalar(i.panSpeed),C(x.x,x.y),g.copy(v),i.update()}(t)}}(t))}function G(t){!1!==i.enabled&&(t.pointerType,i.dispatchEvent(ed),a=r.NONE,Y(t),0===_.length&&(i.domElement.releasePointerCapture(t.pointerId),i.domElement.ownerDocument.removeEventListener("pointermove",H),i.domElement.ownerDocument.removeEventListener("pointerup",G)))}function V(t){Y(t)}function W(t){!1!==i.enabled&&!1!==i.enableZoom&&a===r.NONE&&(t.preventDefault(),i.dispatchEvent(td),function(t){t.deltaY<0?R(S()):t.deltaY>0&&P(S()),i.update()}(t),i.dispatchEvent(ed))}function j(t){!1!==i.enabled&&!1!==i.enablePan&&function(t){let e=!1;switch(t.code){case i.keys.UP:C(0,i.keyPanSpeed),e=!0;break;case i.keys.BOTTOM:C(0,-i.keyPanSpeed),e=!0;break;case i.keys.LEFT:C(i.keyPanSpeed,0),e=!0;break;case i.keys.RIGHT:C(-i.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),i.update())}(t)}function X(t){!1!==i.enabled&&t.preventDefault()}function Y(t){delete M[t.pointerId];for(let e=0;e<_.length;e++)if(_[e].pointerId==t.pointerId)return void _.splice(e,1)}function q(t){let e=M[t.pointerId];void 0===e&&(e=new Et,M[t.pointerId]=e),e.set(t.pageX,t.pageY)}function Q(t){const e=t.pointerId===_[0].pointerId?_[1]:_[0];return M[e.pointerId]}i.domElement.addEventListener("contextmenu",X),i.domElement.addEventListener("pointerdown",B),i.domElement.addEventListener("pointercancel",V),i.domElement.addEventListener("wheel",W,{passive:!1}),this.update()}}let nd=!0;const sd={renderMode:{value:2},depthPacking:{value:1},time:{value:0},Shadow:{value:.25},ShadowLuma:{value:0},ShadowContrast:{value:1},ShadowGamma:{value:.25},lightSizeUV:{value:1.3},nearPlane:{value:9.5},rings:{value:11},nSample:{value:17}};class rd{static setGl2(t){nd=t}static getGl2(t){return nd}static init(t={}){let e;this.up(t),t.shadowPCSS&&(e=_n.shadowmap_pars_fragment,e=e.replace("#ifdef USE_SHADOWMAP",ad),e=e.replace("#if defined( SHADOWMAP_TYPE_PCF )","\n                return PCSS( shadowMap, shadowCoord );\n                #if defined( SHADOWMAP_TYPE_PCF )\n            "),_n.shadowmap_pars_fragment=e),e=_n.common,e=e.replace("#define EPSILON 1e-6","\n        \t#define EPSILON 1e-6\n        \tuniform float Shadow;\n            uniform float ShadowLuma;\n            uniform float ShadowContrast;\n            uniform float ShadowGamma;\n\n            uniform int renderMode;\n            uniform int depthPacking;\n\n            varying vec2 vZW;\n\n            float shadowValue = 1.0;\n            float shadowTmp = 1.0;\n            vec3 shadowColor = vec3(1.0);\n\n            /*\n            float color_distance( vec3 a, vec3 b){\n                vec3 s = vec3( a - b );\n                float dist = sqrt( s.r * s.r + s.g * s.g + s.b * s.b );\n                return clamp(dist, 0.0, 1.0);\n            }\n\n            vec3 rgb2hsv(vec3 c){\n                vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n                vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n                vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n                float d = q.x - min(q.w, q.y);\n                float e = 1.0e-10;\n                return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n            }\n\n            vec3 hsv2rgb(vec3 c){\n                vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n                vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n                return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n            }\n\n\n            \n            vec3 brightnessContrastCorrection(vec3 value, float brightness, float contrast){\n                return (value - 0.5) * contrast + 0.5 + brightness;\n            }\n\n            vec3 GammaCorrection(vec3 value, float param){\n                return vec3(pow(abs(value.r), param),pow(abs(value.g), param),pow(abs(value.b), param));\n            }\n            */\n\n        "),_n.common=e,e=_n.fog_vertex,e=e.replace("#ifdef USE_FOG","\n            vZW = gl_Position.zw;\n            #ifdef USE_FOG\n        "),_n.fog_vertex=e,e=_n.lights_fragment_begin,e=e.replace("directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;","\n        \tshadowTmp = 1.0;\n        \tshadowTmp *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n        \t//directLight.color *= shadowTmp;\n            shadowValue *= shadowTmp;\n        "),e=e.replace("directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;","\n            shadowTmp = 1.0;\n        \tshadowTmp *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n        \t//directLight.color *= shadowTmp;\n            shadowValue *= shadowTmp;\n        "),e=e.replace("directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","\n            shadowTmp = 1.0;\n            shadowTmp *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n            //directLight.color *= shadowTmp;\n            shadowValue *= shadowTmp;\n        "),_n.lights_fragment_begin=e,e=_n.output_fragment,e=e.replace("gl_FragColor = vec4( outgoingLight, diffuseColor.a );","\n\n            gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n        \t#if defined( USE_SHADOWMAP )\n\n            shadowValue = (shadowValue - 0.5) * ShadowContrast + 0.5 + ShadowLuma;\n            shadowValue = pow(abs(shadowValue), ShadowGamma );\n            shadowValue = clamp( shadowValue, 0.0, 1.0 );\n\n            shadowColor = vec3( shadowValue );\n\n\n\n\n            /*\n            vec3 invColor = vec3(1.0 - gl_FragColor.rgb);\n            vec3 cc = rgb2hsv( invColor );\n            cc.r += 0.1; // teint\n            cc.g *= 1.0; // saturation\n            cc.b *= 0.5; // luma\n            invColor = hsv2rgb( cc );\n\n            shadowColor = shadowColor + invColor;\n            shadowColor = clamp( shadowColor, 0.0, 1.0 );\n            */\n\n\n            //float match = 1.0 - color_distance(fragment.rgb, old);\n            //fragment.rgb -= match * old;\n            //fragment.rgb += match * new;\n\n            //float match = 1.0 - color_distance(shadowColor, vec3(0.0));\n            //shadowColor -= match * vec3(0.0);\n            //shadowColor += match * invColor;\n\n            //shadowColor -= shadowValue * vec3(0.0);\n            //shadowColor += shadowValue * invColor;\n\n\n            //vec3 shadowColor = gl_FragColor.rgb;\n            //shadowColor -= match * shadowColor;\n            //shadowColor.rgb += match * invColor;;\n\n\n            //shadowColor = invColor;\n\n\n\n            gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * shadowColor, (1.0-shadowValue) * Shadow );\n\n        \t#endif\n            \n        "),_n.output_fragment=e,e=THREE.ShaderChunk.dithering_fragment,e=e.replace("#endif","\n\n            #endif\n\n            #ifdef STANDARD\n\n            if( renderMode == 1 ){ \n                float fz = 0.5 * vZW[0] / vZW[1] + 0.5;\n                gl_FragColor = depthPacking == 1 ? packDepthToRGBA( fz ) : vec4( vec3( 1.0 - fz ), opacity );// depth render\n            }\n            if( renderMode == 2 ) gl_FragColor = vec4(  packNormalToRGB( normal ), opacity );// normal render\n            if( renderMode == 3 ) gl_FragColor = vec4(  shadowColor, opacity );// normal render\n\n            #else\n\n            if( renderMode != 0 ) discard;\n\n            #endif\n\n        "),THREE.ShaderChunk.dithering_fragment=e}static add(t){t.shadowSide=2,t.format=it,t.onBeforeCompile=function(t){rd.modify(t)}}static setDefines(t){}static modify(t){for(let e in sd)t.uniforms[e]=sd[e]}static up(t){for(let e in t)sd[e]&&(sd[e].value.isColor?sd[e].value.setHex(t[e]):sd[e].value=t[e])}}const ad="\n#ifdef USE_SHADOWMAP\n\nuniform float lightSizeUV;\nuniform float nearPlane;\nuniform float rings;\nuniform int nSample;\n\n//#define LIGHT_WORLD_SIZE 0.005\n//#define LIGHT_FRUSTUM_WIDTH 3.75\n//#define LIGHT_SIZE_UV (LIGHT_WORLD_SIZE / LIGHT_FRUSTUM_WIDTH)\n//#define NEAR_PLANE 9.5\n\n#define NUM_SAMPLES 17\n\nvec2 poissonDisk[32];\n\nvoid initPoissonSamples( const in vec2 randomSeed ) {\n\n    int numSample = nSample;\n\n    float ANGLE_STEP = PI2 * rings / float( numSample );\n    float INV_NUM_SAMPLES = 1.0 / float( numSample );\n\n    // jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/\n    float angle = rand( randomSeed ) * PI2;\n    float radius = INV_NUM_SAMPLES;\n    float radiusStep = radius;\n\n    for( int i = 0; i < numSample; i ++ ) {\n        poissonDisk[i] = vec2( cos( angle ), sin( angle ) ) * pow( radius, 0.75 );\n        radius += radiusStep;\n        angle += ANGLE_STEP;\n    }\n}\n\nfloat penumbraSize( const in float zReceiver, const in float zBlocker ) { // Parallel plane estimation\n    return (zReceiver - zBlocker) / zBlocker;\n}\n\nfloat findBlocker( sampler2D shadowMap, const in vec2 uv, const in float zReceiver, float ls ) {\n\n    // This uses similar triangles to compute what\n    // area of the shadow map we should search\n    float searchRadius = ls * ( zReceiver - nearPlane ) / zReceiver;\n    float blockerDepthSum = 0.0;\n    int numBlockers = 0;\n    int numSample = nSample;\n    float shadowMapDepth = 0.0;\n\n    for( int i = 0; i < numSample; i++ ) {\n        shadowMapDepth = unpackRGBAToDepth(texture2D(shadowMap, uv + poissonDisk[i] * searchRadius));\n        if ( shadowMapDepth < zReceiver ) {\n            blockerDepthSum += shadowMapDepth;\n            numBlockers ++;\n        }\n    }\n\n    if( numBlockers == 0 ) return -1.0;\n\n    return blockerDepthSum / float( numBlockers );\n\n}\n\nfloat PCF_Filter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius ) {\n    /*int numSample = nSample;\n    float sum = 0.0;\n    float depth;\n    #pragma unroll_loop_start\n    for( int i = 0; i < 17; i ++ ) {\n        depth = unpackRGBAToDepth( texture2D( shadowMap, uv + poissonDisk[ i ] * filterRadius ) );\n        if( zReceiver <= depth ) sum += 1.0;\n    }\n    #pragma unroll_loop_end\n    #pragma unroll_loop_start\n    for( int i = 0; i < 17; i ++ ) {\n        depth = unpackRGBAToDepth( texture2D( shadowMap, uv + -poissonDisk[ i ].yx * filterRadius ) );\n        if( zReceiver <= depth ) sum += 1.0;\n    }\n    #pragma unroll_loop_end\n    return sum / ( 2.0 * float( 17 ) );*/\n\n    int numSample = nSample;\n    float sum = 0.0;\n    float top = 0.0;\n    float low = 0.0;\n    #pragma unroll_loop_start\n    for( int i = 0; i < 17; i ++ ) {\n        top = unpackRGBAToDepth( texture2D( shadowMap, uv + poissonDisk[ i ] * filterRadius ) );\n        low = unpackRGBAToDepth( texture2D( shadowMap, uv + -poissonDisk[ i ].yx * filterRadius ) );\n        if( zReceiver <= top ) sum += 1.0;\n        if( zReceiver <= low ) sum += 1.0;\n    }\n    #pragma unroll_loop_end\n    return sum / ( 2.0 * float( 17 ) );\n}\n\nfloat PCSS ( sampler2D shadowMap, vec4 coords ) {\n\n    vec2 uv = coords.xy;\n    float zReceiver = coords.z; // Assumed to be eye-space z in this code\n    //float lightSizeUV = LIGHT_WORLD_SIZE / LIGHT_FRUSTUM_WIDTH;\n\n    float ls = lightSizeUV * 0.001;\n\n    initPoissonSamples( uv );\n    // STEP 1: blocker search\n    float avgBlockerDepth = findBlocker( shadowMap, uv, zReceiver, ls );\n\n    //There are no occluders so early out (this saves filtering)\n    if( avgBlockerDepth == -1.0 ) return 1.0;\n\n    // STEP 2: penumbra size\n    float penumbraRatio = penumbraSize( zReceiver, avgBlockerDepth );\n    float filterRadius = penumbraRatio * ls * nearPlane / zReceiver;\n\n    // STEP 3: filtering\n    //return avgBlockerDepth;\n    return PCF_Filter( shadowMap, uv, zReceiver, filterRadius );\n}\n";class od extends bh{constructor(t){super(t),this.type=P}parse(t){const e=function(t,e){switch(t){case 1:console.error("THREE.RGBELoader Read Error: "+(e||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(e||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(e||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(e||""))}return-1},i=function(t,e,i){e=e||1024;let n=t.pos,s=-1,r=0,a="",o=String.fromCharCode.apply(null,new Uint16Array(t.subarray(n,n+128)));for(;0>(s=o.indexOf("\n"))&&r<e&&n<t.byteLength;)a+=o,r+=o.length,n+=128,o+=String.fromCharCode.apply(null,new Uint16Array(t.subarray(n,n+128)));return-1<s&&(!1!==i&&(t.pos+=r+s+1),a+o.slice(0,s))},n=function(t,e,i,n){const s=t[e+3],r=Math.pow(2,s-128)/255;i[n+0]=t[e+0]*r,i[n+1]=t[e+1]*r,i[n+2]=t[e+2]*r},s=function(t,e,i,n){const s=t[e+3],r=Math.pow(2,s-128)/255;i[n+0]=du.toHalfFloat(t[e+0]*r),i[n+1]=du.toHalfFloat(t[e+1]*r),i[n+2]=du.toHalfFloat(t[e+2]*r)},r=new Uint8Array(t);r.pos=0;const a=function(t){const n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*FORMAT=(\S+)\s*$/,a=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,o={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,h;if(t.pos>=t.byteLength||!(l=i(t)))return e(1,"no header found");if(!(h=l.match(/^#\?(\S+)/)))return e(3,"bad initial token");for(o.valid|=1,o.programtype=h[1],o.string+=l+"\n";l=i(t),!1!==l;)if(o.string+=l+"\n","#"!==l.charAt(0)){if((h=l.match(n))&&(o.gamma=parseFloat(h[1],10)),(h=l.match(s))&&(o.exposure=parseFloat(h[1],10)),(h=l.match(r))&&(o.valid|=2,o.format=h[1]),(h=l.match(a))&&(o.valid|=4,o.height=parseInt(h[1],10),o.width=parseInt(h[2],10)),2&o.valid&&4&o.valid)break}else o.comments+=l+"\n";return 2&o.valid?4&o.valid?o:e(3,"missing image size specifier"):e(3,"missing format specifier")}(r);if(-1!==a){const t=a.width,i=a.height,o=function(t,i,n){const s=i;if(s<8||s>32767||2!==t[0]||2!==t[1]||128&t[2])return new Uint8Array(t);if(s!==(t[2]<<8|t[3]))return e(3,"wrong scanline width");const r=new Uint8Array(4*i*n);if(!r.length)return e(4,"unable to allocate buffer space");let a=0,o=0;const l=4*s,h=new Uint8Array(4),c=new Uint8Array(l);let u=n;for(;u>0&&o<t.byteLength;){if(o+4>t.byteLength)return e(1);if(h[0]=t[o++],h[1]=t[o++],h[2]=t[o++],h[3]=t[o++],2!=h[0]||2!=h[1]||(h[2]<<8|h[3])!=s)return e(3,"bad rgbe scanline format");let i,n=0;for(;n<l&&o<t.byteLength;){i=t[o++];const s=i>128;if(s&&(i-=128),0===i||n+i>l)return e(3,"bad scanline data");if(s){const e=t[o++];for(let t=0;t<i;t++)c[n++]=e}else c.set(t.subarray(o,o+i),n),n+=i,o+=i}const d=s;for(let t=0;t<d;t++){let e=0;r[a]=c[t+e],e+=s,r[a+1]=c[t+e],e+=s,r[a+2]=c[t+e],e+=s,r[a+3]=c[t+e],a+=4}u--}return r}(r.subarray(r.pos),t,i);if(-1!==o){let e,r,l,h;switch(this.type){case A:e=o,r=D,l=A;break;case C:h=o.length/4*3;const t=new Float32Array(h);for(let e=0;e<h;e++)n(o,4*e,t,3*e);e=t,r=F,l=C;break;case P:h=o.length/4*3;const i=new Uint16Array(h);for(let t=0;t<h;t++)s(o,4*t,i,3*t);e=i,r=F,l=P;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:t,height:i,data:e,header:a.string,gamma:a.gamma,exposure:a.exposure,format:r,type:l}}}return null}setDataType(t){return this.type=t,this}load(t,e,i,n){return super.load(t,(function(t,i){switch(t.type){case A:t.encoding=st,t.minFilter=b,t.magFilter=b,t.generateMipmaps=!1,t.flipY=!0;break;case C:case P:t.encoding=et,t.minFilter=M,t.magFilter=M,t.generateMipmaps=!1,t.flipY=!0}e&&e(t,i)}),i,n)}}let ld=null,hd={},cd=new di,ud=null,dd=null,pd=null,md=null;const fd=new Nc,gd=new Nc;class vd{static get(){return ld}static getData(){return hd}static setBackgroud(t){dd.background=void 0!==t?cd.setHex(t):ld}static load(t,e,i,n,s,r,a){hd={pos:new Wt(0,1,0),sun:new di(16777215),fog:new di(0),envmap:null},i&&(pd=i),n&&(dd=n),s&&(ud=s),r&&(md=r),a=void 0===a||a;let o=new Yn(pd);o.compileEquirectangularShader(),(new od).setDataType(A).load(t,(function(t){ld=o.fromEquirectangular(t).texture,a&&vd.autoSun(t.image,"hdr"),dd&&(dd.background=ld,dd.environment=ld),ud&&a&&(ud.position.setFromSpherical(fd).multiplyScalar(ud.distance||20),ud.color.copy(hd.sun),ud.target.position.set(0,0,0),ud.updateMatrixWorld(),ud.helper&&ud.helper.update(),md&&(md.position.setFromSpherical(gd).multiplyScalar(md.distance||20),md.color.copy(hd.fog),md.target.position.set(0,0,0),md.updateMatrixWorld(),md.helper&&md.helper.update())),t.dispose(),o.dispose(),e&&e()}))}static autoSun(t,e,i){let n=t.data,s=n.length/4,r=t.width,a=t.height,o=null;if(i){let i=document.createElement("canvas");i.style.cssText="position:absolute; left:10px; top:10px; width:50%; height:50%;",document.body.appendChild(i),i.width=r,i.height=a;let n=i.getContext("2d");"hdr"!==e?(n.drawImage(t,0,0),t.data=n.getImageData(0,0,r,a).data):o=n.createImageData(i.width,i.height)}let l,h,c,u,d,p,m,f,g,v=new Uint8ClampedArray(4),x=1/2.7,y=.5*Math.pow(2,1),b=0,w=s,_=1/255,M=0,S=0,T=0;for(w=0;w<s;w++)h=4*w,f=w%r,g=Math.floor((w-f)/r),"hdr"===e?(p=y*Math.pow(2,n[h+3]-120),c=2*Math.pow(n[h]*p,x),u=2*Math.pow(n[h+1]*p,x),d=2*Math.pow(n[h+2]*p,x)):(c=n[h],u=n[h+1],d=n[h+2],p=n[h+3]),m=c+u+d,g===.5*a&&(M+=c,S+=u,T+=d),m>b&&(v[0]=c,v[1]=u,v[2]=d,v[3]=255,l=w,b=m),i&&(o.data[h]=c,o.data[h+1]=u,o.data[h+2]=d,o.data[h+3]=255);i&&ctx.putImageData(o,0,0),"hdr"!==e&&(t.data=null),f=l%r,g=Math.floor((l-f)/r);let A=(new Wt).setFromSphericalCoords(1,g/a*Math.PI,-f/r*(2*Math.PI)-.5*Math.PI),E=new di(v[0]*_,v[1]*_,v[1]*_);fd.set(1,g/a*Math.PI,-f/r*(2*Math.PI)-.5*Math.PI),gd.copy(fd),gd.theta+=.2*Math.PI,gd.phi-=.5*Math.PI;let L=new di,C=new di(M/r*_,S/r*_,T/r*_).getHSL(L);"hdr"===e?C.setHSL(L.h,1.66*L.s,1.88*L.l):C.setHSL(L.h,.99*L.s,1.1*L.l),hd.pos=A,hd.sun=E,hd.fog=C}}var xd={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\t\t}"};class yd{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const bd=new Rn(-1,1,1,-1,0,1),wd=new Di;wd.setAttribute("position",new Ti([-1,3,0,-1,-1,0,3,-1,0],3)),wd.setAttribute("uv",new Ti([0,2,0,0,2,0],2));class _d{constructor(t){this._mesh=new Ki(wd,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,bd)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}class Md extends yd{constructor(t,e){super(),this.textureID=void 0!==e?e:"tDiffuse",t instanceof rn?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=sn.clone(t.uniforms),this.material=new rn({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new _d(this.material)}render(t,e,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}}class Sd extends yd{constructor(t,e){super(),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(t,e,i){const n=t.getContext(),s=t.state;let r,a;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0),this.inverse?(r=0,a=1):(r=1,a=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),s.buffers.stencil.setFunc(n.ALWAYS,r,4294967295),s.buffers.stencil.setClear(a),s.buffers.stencil.setLocked(!0),t.setRenderTarget(i),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(n.EQUAL,1,4294967295),s.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),s.buffers.stencil.setLocked(!0)}}class Td extends yd{constructor(){super(),this.needsSwap=!1}render(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}new Rn(-1,1,1,-1,0,1);const Ad=new Di;Ad.setAttribute("position",new Ti([-1,3,0,-1,-1,0,3,-1,0],3)),Ad.setAttribute("uv",new Ti([0,2,0,0,2,0],2));class Ed extends yd{constructor(t,e,i,n,s){super(),this.scene=t,this.camera=e,this.overrideMaterial=i,this.clearColor=n,this.clearAlpha=void 0!==s?s:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new di}render(t,e,i){const n=t.autoClear;let s,r;t.autoClear=!1,void 0!==this.overrideMaterial&&(r=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(t.getClearColor(this._oldClearColor),s=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:i),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(this._oldClearColor,s),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=r),t.autoClear=n}}const Ld={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new di(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tvec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n\t\t\tfloat v = dot( texel.xyz, luma );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"};class Cd extends yd{constructor(t,e,i,n,s,r){super(),this.Env=r||null,this.strength=void 0!==e?e:1,this.radius=i,this.threshold=n,this.resolution=void 0!==t?new Et(t.x,t.y):new Et(256,256),this.noBackground=s||!1,this.clearColor=new di(0,0,0);const a={minFilter:M,magFilter:M,format:I};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let o=Math.round(this.resolution.x/2),l=Math.round(this.resolution.y/2);this.renderTargetBright=new Bt(o,l,a),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let t=0;t<this.nMips;t++){const e=new Bt(o,l,a);e.texture.name="UnrealBloomPass.h"+t,e.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(e);const i=new Bt(o,l,a);i.texture.name="UnrealBloomPass.v"+t,i.texture.generateMipmaps=!1,this.renderTargetsVertical.push(i),o=Math.round(o/2),l=Math.round(l/2)}void 0===Ld&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");const h=Ld;this.highPassUniforms=sn.clone(h.uniforms),this.highPassUniforms.luminosityThreshold.value=n,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new rn({uniforms:this.highPassUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,defines:{}}),this.separableBlurMaterials=[];const c=[3,5,7,9,11];o=Math.round(this.resolution.x/2),l=Math.round(this.resolution.y/2);for(let t=0;t<this.nMips;t++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(c[t])),this.separableBlurMaterials[t].uniforms.texSize.value=new Et(o,l),o=Math.round(o/2),l=Math.round(l/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=e,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new Wt(1,1,1),new Wt(1,1,1),new Wt(1,1,1),new Wt(1,1,1),new Wt(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===xd&&console.error("THREE.UnrealBloomPass relies on CopyShader");const u=xd;this.copyUniforms=sn.clone(u.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new rn({uniforms:this.copyUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:2,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new di,this.oldClearAlpha=1,this.basic=new pi,this.fsQuad=new _d(null)}dispose(){for(let t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(let t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose()}setSize(t,e){let i=Math.round(t/2),n=Math.round(e/2);this.renderTargetBright.setSize(i,n);for(let t=0;t<this.nMips;t++)this.renderTargetsHorizontal[t].setSize(i,n),this.renderTargetsVertical[t].setSize(i,n),this.separableBlurMaterials[t].uniforms.texSize.value=new Et(i,n),i=Math.round(i/2),n=Math.round(n/2)}render(t,e,i,n,s){this.Env&&this.Env.setBackgroud(1118481),t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const r=t.autoClear;t.autoClear=!1,t.setClearColor(this.clearColor,0),s&&t.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=i.texture,t.setRenderTarget(null),t.clear(),this.fsQuad.render(t)),this.highPassUniforms.tDiffuse.value=i.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),this.fsQuad.render(t);let a=this.renderTargetBright;for(let e=0;e<this.nMips;e++)this.fsQuad.material=this.separableBlurMaterials[e],this.separableBlurMaterials[e].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[e].uniforms.direction.value=Cd.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[e]),t.clear(),this.fsQuad.render(t),this.separableBlurMaterials[e].uniforms.colorTexture.value=this.renderTargetsHorizontal[e].texture,this.separableBlurMaterials[e].uniforms.direction.value=Cd.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[e]),t.clear(),this.fsQuad.render(t),a=this.renderTargetsVertical[e];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,s&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(i),this.fsQuad.render(t)),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=r,this.Env&&this.Env.setBackgroud()}getSeperableBlurMaterial(t){return new rn({defines:{KERNEL_RADIUS:t,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new Et(.5,.5)},direction:{value:new Et(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec2 direction;\n\n\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tfloat fSigma = float(SIGMA);\n\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}getCompositeMaterial(t){return new rn({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform sampler2D dirtTexture;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}Cd.BlurDirectionX=new Et(1,0),Cd.BlurDirectionY=new Et(0,1);const Pd={defines:{USE_3DTEXTURE:1},uniforms:{lut3d:{value:null},lut:{value:null},lutSize:{value:0},tDiffuse:{value:null},intensity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}\n\n\t",fragmentShader:"\n\n\t\tuniform float lutSize;\n\t\t#if USE_3DTEXTURE\n\t\tprecision highp sampler3D;\n\t\tuniform sampler3D lut3d;\n\t\t#else\n\t\tuniform sampler2D lut;\n\n\t\tvec3 lutLookup( sampler2D tex, float size, vec3 rgb ) {\n\n\t\t\tfloat sliceHeight = 1.0 / size;\n\t\t\tfloat yPixelHeight = 1.0 / ( size * size );\n\n\t\t\t// Get the slices on either side of the sample\n\t\t\tfloat slice = rgb.b * size;\n\t\t\tfloat interp = fract( slice );\n\t\t\tfloat slice0 = slice - interp;\n\t\t\tfloat centeredInterp = interp - 0.5;\n\n\t\t\tfloat slice1 = slice0 + sign( centeredInterp );\n\n\t\t\t// Pull y sample in by half a pixel in each direction to avoid color\n\t\t\t// bleeding from adjacent slices.\n\t\t\tfloat greenOffset = clamp( rgb.g * sliceHeight, yPixelHeight * 0.5, sliceHeight - yPixelHeight * 0.5 );\n\n\t\t\tvec2 uv0 = vec2(\n\t\t\t\trgb.r,\n\t\t\t\tslice0 * sliceHeight + greenOffset\n\t\t\t);\n\t\t\tvec2 uv1 = vec2(\n\t\t\t\trgb.r,\n\t\t\t\tslice1 * sliceHeight + greenOffset\n\t\t\t);\n\n\t\t\tvec3 sample0 = texture2D( tex, uv0 ).rgb;\n\t\t\tvec3 sample1 = texture2D( tex, uv1 ).rgb;\n\n\t\t\treturn mix( sample0, sample1, abs( centeredInterp ) );\n\n\t\t}\n\t\t#endif\n\n\t\tvarying vec2 vUv;\n\t\tuniform float intensity;\n\t\tuniform sampler2D tDiffuse;\n\t\tvoid main() {\n\n\t\t\tvec4 val = texture2D( tDiffuse, vUv );\n\t\t\tvec4 lutVal;\n\n\t\t\t// pull the sample in by half a pixel so the sample begins\n\t\t\t// at the center of the edge pixels.\n\t\t\tfloat pixelWidth = 1.0 / lutSize;\n\t\t\tfloat halfPixelWidth = 0.5 / lutSize;\n\t\t\tvec3 uvw = vec3( halfPixelWidth ) + val.rgb * ( 1.0 - pixelWidth );\n\n\t\t\t#if USE_3DTEXTURE\n\n\t\t\tlutVal = vec4( texture( lut3d, uvw ).rgb, val.a );\n\n\t\t\t#else\n\n\t\t\tlutVal = vec4( lutLookup( lut, lutSize, uvw ), val.a );\n\n\t\t\t#endif\n\n\t\t\tgl_FragColor = vec4( mix( val, lutVal, intensity ) );\n\n\t\t}\n\n\t"};class Rd extends Md{set lut(t){const e=this.material;if(t!==this.lut&&(e.uniforms.lut3d.value=null,e.uniforms.lut.value=null,t)){const i=t.isDataTexture3D?1:0;i!==e.defines.USE_3DTEXTURE&&(e.defines.USE_3DTEXTURE=i,e.needsUpdate=!0),e.uniforms.lutSize.value=t.image.width,t.isDataTexture3D?e.uniforms.lut3d.value=t:e.uniforms.lut.value=t}}get lut(){return this.material.uniforms.lut.value||this.material.uniforms.lut3d.value}set intensity(t){this.material.uniforms.intensity.value=t}get intensity(){return this.material.uniforms.intensity.value}constructor(t={}){super(Pd),this.lut=t.lut||null,this.intensity="intensity"in t?t.intensity:1}}class Fd{constructor(t=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let e=0;e<256;e++)this.p[e]=Math.floor(256*t.random());this.perm=[];for(let t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(t,e,i){return t[0]*e+t[1]*i}dot3(t,e,i,n){return t[0]*e+t[1]*i+t[2]*n}dot4(t,e,i,n,s){return t[0]*e+t[1]*i+t[2]*n+t[3]*s}noise(t,e){let i,n,s;const r=(t+e)*(.5*(Math.sqrt(3)-1)),a=Math.floor(t+r),o=Math.floor(e+r),l=(3-Math.sqrt(3))/6,h=(a+o)*l,c=t-(a-h),u=e-(o-h);let d,p;c>u?(d=1,p=0):(d=0,p=1);const m=c-d+l,f=u-p+l,g=c-1+2*l,v=u-1+2*l,x=255&a,y=255&o,b=this.perm[x+this.perm[y]]%12,w=this.perm[x+d+this.perm[y+p]]%12,_=this.perm[x+1+this.perm[y+1]]%12;let M=.5-c*c-u*u;M<0?i=0:(M*=M,i=M*M*this.dot(this.grad3[b],c,u));let S=.5-m*m-f*f;S<0?n=0:(S*=S,n=S*S*this.dot(this.grad3[w],m,f));let T=.5-g*g-v*v;return T<0?s=0:(T*=T,s=T*T*this.dot(this.grad3[_],g,v)),70*(i+n+s)}noise3d(t,e,i){let n,s,r,a;const o=(t+e+i)*(1/3),l=Math.floor(t+o),h=Math.floor(e+o),c=Math.floor(i+o),u=1/6,d=(l+h+c)*u,p=t-(l-d),m=e-(h-d),f=i-(c-d);let g,v,x,y,b,w;p>=m?m>=f?(g=1,v=0,x=0,y=1,b=1,w=0):p>=f?(g=1,v=0,x=0,y=1,b=0,w=1):(g=0,v=0,x=1,y=1,b=0,w=1):m<f?(g=0,v=0,x=1,y=0,b=1,w=1):p<f?(g=0,v=1,x=0,y=0,b=1,w=1):(g=0,v=1,x=0,y=1,b=1,w=0);const _=p-g+u,M=m-v+u,S=f-x+u,T=p-y+2*u,A=m-b+2*u,E=f-w+2*u,L=p-1+.5,C=m-1+.5,P=f-1+.5,R=255&l,F=255&h,I=255&c,D=this.perm[R+this.perm[F+this.perm[I]]]%12,N=this.perm[R+g+this.perm[F+v+this.perm[I+x]]]%12,k=this.perm[R+y+this.perm[F+b+this.perm[I+w]]]%12,z=this.perm[R+1+this.perm[F+1+this.perm[I+1]]]%12;let U=.6-p*p-m*m-f*f;U<0?n=0:(U*=U,n=U*U*this.dot3(this.grad3[D],p,m,f));let O=.6-_*_-M*M-S*S;O<0?s=0:(O*=O,s=O*O*this.dot3(this.grad3[N],_,M,S));let B=.6-T*T-A*A-E*E;B<0?r=0:(B*=B,r=B*B*this.dot3(this.grad3[k],T,A,E));let H=.6-L*L-C*C-P*P;return H<0?a=0:(H*=H,a=H*H*this.dot3(this.grad3[z],L,C,P)),32*(n+s+r+a)}noise4d(t,e,i,n){const s=this.grad4,r=this.simplex,a=this.perm,o=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;let h,c,u,d,p;const m=(t+e+i+n)*o,f=Math.floor(t+m),g=Math.floor(e+m),v=Math.floor(i+m),x=Math.floor(n+m),y=(f+g+v+x)*l,b=t-(f-y),w=e-(g-y),_=i-(v-y),M=n-(x-y),S=(b>w?32:0)+(b>_?16:0)+(w>_?8:0)+(b>M?4:0)+(w>M?2:0)+(_>M?1:0),T=r[S][0]>=3?1:0,A=r[S][1]>=3?1:0,E=r[S][2]>=3?1:0,L=r[S][3]>=3?1:0,C=r[S][0]>=2?1:0,P=r[S][1]>=2?1:0,R=r[S][2]>=2?1:0,F=r[S][3]>=2?1:0,I=r[S][0]>=1?1:0,D=r[S][1]>=1?1:0,N=r[S][2]>=1?1:0,k=r[S][3]>=1?1:0,z=b-T+l,U=w-A+l,O=_-E+l,B=M-L+l,H=b-C+2*l,G=w-P+2*l,V=_-R+2*l,W=M-F+2*l,j=b-I+3*l,X=w-D+3*l,Y=_-N+3*l,q=M-k+3*l,Q=b-1+4*l,Z=w-1+4*l,J=_-1+4*l,K=M-1+4*l,$=255&f,tt=255&g,et=255&v,it=255&x,nt=a[$+a[tt+a[et+a[it]]]]%32,st=a[$+T+a[tt+A+a[et+E+a[it+L]]]]%32,rt=a[$+C+a[tt+P+a[et+R+a[it+F]]]]%32,at=a[$+I+a[tt+D+a[et+N+a[it+k]]]]%32,ot=a[$+1+a[tt+1+a[et+1+a[it+1]]]]%32;let lt=.6-b*b-w*w-_*_-M*M;lt<0?h=0:(lt*=lt,h=lt*lt*this.dot4(s[nt],b,w,_,M));let ht=.6-z*z-U*U-O*O-B*B;ht<0?c=0:(ht*=ht,c=ht*ht*this.dot4(s[st],z,U,O,B));let ct=.6-H*H-G*G-V*V-W*W;ct<0?u=0:(ct*=ct,u=ct*ct*this.dot4(s[rt],H,G,V,W));let ut=.6-j*j-X*X-Y*Y-q*q;ut<0?d=0:(ut*=ut,d=ut*ut*this.dot4(s[at],j,X,Y,q));let dt=.6-Q*Q-Z*Z-J*J-K*K;return dt<0?p=0:(dt*=dt,p=dt*dt*this.dot4(s[ot],Q,Z,J,K)),27*(h+c+u+d+p)}}const Id={defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new Et},cameraProjectionMatrix:{value:new we},cameraInverseProjectionMatrix:{value:new we},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tNormal;\n\t\tuniform sampler2D tDepth;\n\t\tuniform sampler2D tNoise;\n\n\t\tuniform vec3 kernel[ KERNEL_SIZE ];\n\n\t\tuniform vec2 resolution;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform mat4 cameraProjectionMatrix;\n\t\tuniform mat4 cameraInverseProjectionMatrix;\n\n\t\tuniform float kernelRadius;\n\t\tuniform float minDistance; // avoid artifacts caused by neighbour fragments with minimal depth difference\n\t\tuniform float maxDistance; // avoid the influence of fragments which are too far away\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t}\n\n\t\tfloat getLinearDepth( const in vec2 screenPosition ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;\n\t\t\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n\t\t\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tvec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {\n\n\t\t\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];\n\n\t\t\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );\n\n\t\t\tclipPosition *= clipW; // unprojection.\n\n\t\t\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;\n\n\t\t}\n\n\t\tvec3 getViewNormal( const in vec2 screenPosition ) {\n\n\t\t\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = getDepth( vUv );\n\t\t\tfloat viewZ = getViewZ( depth );\n\n\t\t\tvec3 viewPosition = getViewPosition( vUv, depth, viewZ );\n\t\t\tvec3 viewNormal = getViewNormal( vUv );\n\n\t\t\tvec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );\n\t\t\tvec3 random = texture2D( tNoise, vUv * noiseScale ).xyz;\n\n\t\t\t// compute matrix used to reorient a kernel vector\n\n\t\t\tvec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );\n\t\t\tvec3 bitangent = cross( viewNormal, tangent );\n\t\t\tmat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );\n\n\t\t float occlusion = 0.0;\n\n\t\t for ( int i = 0; i < KERNEL_SIZE; i ++ ) {\n\n\t\t\t\tvec3 sampleVector = kernelMatrix * kernel[ i ]; // reorient sample vector in view space\n\t\t\t\tvec3 samplePoint = viewPosition + ( sampleVector * kernelRadius ); // calculate sample point\n\n\t\t\t\tvec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 ); // project point and calculate NDC\n\t\t\t\tsamplePointNDC /= samplePointNDC.w;\n\n\t\t\t\tvec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5; // compute uv coordinates\n\n\t\t\t\tfloat realDepth = getLinearDepth( samplePointUv ); // get linear depth from depth texture\n\t\t\t\tfloat sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar ); // compute linear depth of the sample view Z value\n\t\t\t\tfloat delta = sampleDepth - realDepth;\n\n\t\t\t\tif ( delta > minDistance && delta < maxDistance ) { // if fragment is before sample point, increase occlusion\n\n\t\t\t\t\tocclusion += 1.0;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tocclusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );\n\n\t\t\tgl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );\n\n\t\t}"},Dd={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:"varying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"uniform sampler2D tDepth;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tfloat getLinearDepth( const in vec2 screenPosition ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;\n\t\t\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n\t\t\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = getLinearDepth( vUv );\n\t\t\tgl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );\n\n\t\t}"},Nd={uniforms:{tDiffuse:{value:null},resolution:{value:new Et}},vertexShader:"varying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"uniform sampler2D tDiffuse;\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec2 texelSize = ( 1.0 / resolution );\n\t\t\tfloat result = 0.0;\n\n\t\t\tfor ( int i = - 2; i <= 2; i ++ ) {\n\n\t\t\t\tfor ( int j = - 2; j <= 2; j ++ ) {\n\n\t\t\t\t\tvec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;\n\t\t\t\t\tresult += texture2D( tDiffuse, vUv + offset ).r;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tgl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );\n\n\t\t}"};class kd extends yd{constructor(t,e,i,n,s){super(),this.width=void 0!==i?i:512,this.height=void 0!==n?n:512,this.clear=!0,this.camera=e,this.scene=t,this.kernelRadius=8,this.kernelSize=32,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this._visibilityCache=new Map,this.isSharedTarget=s||!1,this.generateSampleKernel(),this.generateRandomKernelRotations();const o=new xo;o.type=E,this.beautyRenderTarget=new Bt(this.width,this.height,{minFilter:M,magFilter:M,format:I}),this.normalRenderTarget=new Bt(this.width,this.height,{minFilter:b,magFilter:b,format:I,depthTexture:o}),this.depthRenderTarget=this.normalRenderTarget.clone(),this.ssaoRenderTarget=new Bt(this.width,this.height,{minFilter:M,magFilter:M,format:I}),this.blurRenderTarget=this.ssaoRenderTarget.clone(),void 0===Id&&console.error("THREE.SSAOPass: The pass relies on SSAOShader."),this.ssaoMaterial=new rn({defines:Object.assign({},Id.defines),uniforms:sn.clone(Id.uniforms),vertexShader:Id.vertexShader,fragmentShader:Id.fragmentShader,blending:0}),this.ssaoMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.isSharedTarget?this.depthRenderTarget.texture:this.normalRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new Xl,this.normalMaterial.blending=0,this.blurMaterial=new rn({defines:Object.assign({},Nd.defines),uniforms:sn.clone(Nd.uniforms),vertexShader:Nd.vertexShader,fragmentShader:Nd.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new rn({defines:Object.assign({},Dd.defines),uniforms:sn.clone(Dd.uniforms),vertexShader:Dd.vertexShader,fragmentShader:Dd.fragmentShader,blending:0}),this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new rn({uniforms:sn.clone(xd.uniforms),vertexShader:xd.vertexShader,fragmentShader:xd.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:h,blendDst:a,blendEquation:r,blendSrcAlpha:l,blendDstAlpha:a,blendEquationAlpha:r}),this.fsQuad=new _d(null),this.originalClearColor=new di}dispose(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(t,e){switch(this.isSharedTarget?(this.ssaoMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.depthRenderTarget.texture):(t.setRenderTarget(this.beautyRenderTarget),t.clear(),t.render(this.scene,this.camera),this.overrideVisibility(),this.renderOverride(t,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility()),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(t,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(t,this.blurMaterial,this.blurRenderTarget),this.output){case kd.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case kd.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case kd.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case kd.OUTPUT.Depth:this.renderPass(t,this.depthRenderMaterial,this.renderToScreen?null:e);break;case kd.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case kd.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=5,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;default:console.warn("THREE.SSAOPass: Unknown output type.")}}renderPass(t,e,i,n,s){t.getClearColor(this.originalClearColor);const r=t.getClearAlpha(),a=t.autoClear;t.setRenderTarget(i),t.autoClear=!1,null!=n&&(t.setClearColor(n),t.setClearAlpha(s||0),t.clear()),this.fsQuad.material=e,this.fsQuad.render(t),t.autoClear=a,t.setClearColor(this.originalClearColor),t.setClearAlpha(r)}renderOverride(t,e,i,n,s){t.getClearColor(this.originalClearColor);const r=t.getClearAlpha(),a=t.autoClear;t.setRenderTarget(i),t.autoClear=!1,n=e.clearColor||n,s=e.clearAlpha||s,null!=n&&(t.setClearColor(n),t.setClearAlpha(s||0),t.clear()),this.scene.overrideMaterial=e,t.render(this.scene,this.camera),this.scene.overrideMaterial=null,t.autoClear=a,t.setClearColor(this.originalClearColor),t.setClearAlpha(r)}setSize(t,e){this.width=t,this.height=e,this.beautyRenderTarget.setSize(t,e),this.ssaoRenderTarget.setSize(t,e),this.normalRenderTarget.setSize(t,e),this.blurRenderTarget.setSize(t,e),this.ssaoMaterial.uniforms.resolution.value.set(t,e),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(t,e)}generateSampleKernel(){const t=this.kernelSize,e=this.kernel;for(let i=0;i<t;i++){const n=new Wt;n.x=2*Math.random()-1,n.y=2*Math.random()-1,n.z=Math.random(),n.normalize();let s=i/t;s=At.lerp(.1,1,s*s),n.multiplyScalar(s),e.push(n)}}generateRandomKernelRotations(){void 0===Fd&&console.error("THREE.SSAOPass: The pass relies on SimplexNoise.");const t=new Fd,e=new Float32Array(64);for(let i=0;i<16;i++){const n=4*i,s=2*Math.random()-1,r=2*Math.random()-1,a=0,o=t.noise3d(s,r,a);e[n]=o,e[n+1]=o,e[n+2]=o,e[n+3]=1}this.noiseTexture=new Ba(e,4,4,I,C),this.noiseTexture.wrapS=v,this.noiseTexture.wrapT=v}overrideVisibility(){const t=this.scene,e=this._visibilityCache;t.traverse((function(t){e.set(t,t.visible),(t.isPoints||t.isLine)&&(t.visible=!1)}))}restoreVisibility(){const t=this.scene,e=this._visibilityCache;t.traverse((function(t){const i=e.get(t);t.visible=i})),e.clear()}setBeautyTarget(t){this.beautyRenderTarget=t}setNormalTarget(t){this.normalRenderTarget=t}setDepthTarget(t){this.depthRenderTarget=t}}kd.OUTPUT={Default:0,SSAO:1,Blur:2,Beauty:3,Depth:4,Normal:5};const zd={defines:{NUM_SAMPLES:7,NUM_RINGS:4,NORMAL_TEXTURE:0,DIFFUSE_TEXTURE:0,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},tDiffuse:{value:null},tNormal:{value:null},size:{value:new Et(512,512)},cameraNear:{value:1},cameraFar:{value:100},cameraProjectionMatrix:{value:new we},cameraInverseProjectionMatrix:{value:new we},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\n\t\tvarying vec2 vUv;\n\n\t\t#if DIFFUSE_TEXTURE == 1\n\t\tuniform sampler2D tDiffuse;\n\t\t#endif\n\n\t\tuniform sampler2D tDepth;\n\n\t\t#if NORMAL_TEXTURE == 1\n\t\tuniform sampler2D tNormal;\n\t\t#endif\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform mat4 cameraProjectionMatrix;\n\t\tuniform mat4 cameraInverseProjectionMatrix;\n\n\t\tuniform float scale;\n\t\tuniform float intensity;\n\t\tuniform float bias;\n\t\tuniform float kernelRadius;\n\t\tuniform float minResolution;\n\t\tuniform vec2 size;\n\t\tuniform float randomSeed;\n\n\t\t// RGBA depth\n\n\t\t#include <packing>\n\n\t\tvec4 getDefaultColor( const in vec2 screenPosition ) {\n\t\t\t#if DIFFUSE_TEXTURE == 1\n\t\t\treturn texture2D( tDiffuse, vUv );\n\t\t\t#else\n\t\t\treturn vec4( 1.0 );\n\t\t\t#endif\n\t\t}\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\t\t\t#if DEPTH_PACKING == 1\n\t\t\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );\n\t\t\t#else\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\t\t\t#endif\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#else\n\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#endif\n\t\t}\n\n\t\tvec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {\n\t\t\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];\n\t\t\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );\n\t\t\tclipPosition *= clipW; // unprojection.\n\n\t\t\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;\n\t\t}\n\n\t\tvec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {\n\t\t\t#if NORMAL_TEXTURE == 1\n\t\t\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );\n\t\t\t#else\n\t\t\treturn normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );\n\t\t\t#endif\n\t\t}\n\n\t\tfloat scaleDividedByCameraFar;\n\t\tfloat minResolutionMultipliedByCameraFar;\n\n\t\tfloat getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {\n\t\t\tvec3 viewDelta = sampleViewPosition - centerViewPosition;\n\t\t\tfloat viewDistance = length( viewDelta );\n\t\t\tfloat scaledScreenDistance = scaleDividedByCameraFar * viewDistance;\n\n\t\t\treturn max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );\n\t\t}\n\n\t\t// moving costly divides into consts\n\t\tconst float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );\n\t\tconst float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );\n\n\t\tfloat getAmbientOcclusion( const in vec3 centerViewPosition ) {\n\t\t\t// precompute some variables require in getOcclusion.\n\t\t\tscaleDividedByCameraFar = scale / cameraFar;\n\t\t\tminResolutionMultipliedByCameraFar = minResolution * cameraFar;\n\t\t\tvec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );\n\n\t\t\t// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/\n\t\t\tfloat angle = rand( vUv + randomSeed ) * PI2;\n\t\t\tvec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;\n\t\t\tvec2 radiusStep = radius;\n\n\t\t\tfloat occlusionSum = 0.0;\n\t\t\tfloat weightSum = 0.0;\n\n\t\t\tfor( int i = 0; i < NUM_SAMPLES; i ++ ) {\n\t\t\t\tvec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;\n\t\t\t\tradius += radiusStep;\n\t\t\t\tangle += ANGLE_STEP;\n\n\t\t\t\tfloat sampleDepth = getDepth( sampleUv );\n\t\t\t\tif( sampleDepth >= ( 1.0 - EPSILON ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tfloat sampleViewZ = getViewZ( sampleDepth );\n\t\t\t\tvec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );\n\t\t\t\tocclusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );\n\t\t\t\tweightSum += 1.0;\n\t\t\t}\n\n\t\t\tif( weightSum == 0.0 ) discard;\n\n\t\t\treturn occlusionSum * ( intensity / weightSum );\n\t\t}\n\n\t\tvoid main() {\n\t\t\tfloat centerDepth = getDepth( vUv );\n\t\t\tif( centerDepth >= ( 1.0 - EPSILON ) ) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tfloat centerViewZ = getViewZ( centerDepth );\n\t\t\tvec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );\n\n\t\t\tfloat ambientOcclusion = getAmbientOcclusion( viewPosition );\n\n\t\t\tgl_FragColor = getDefaultColor( vUv );\n\t\t\tgl_FragColor.xyz *=  1.0 - ambientOcclusion;\n\t\t}"},Ud={defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new Et(512,512)},sampleUvOffsets:{value:[new Et(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:"\n\n\t\t#include <common>\n\n\t\tuniform vec2 size;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec2 vInvSize;\n\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tvInvSize = 1.0 / size;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\t\t#include <packing>\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tDepth;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform float depthCutoff;\n\n\t\tuniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];\n\t\tuniform float sampleWeights[ KERNEL_RADIUS + 1 ];\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec2 vInvSize;\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\t\t\t#if DEPTH_PACKING == 1\n\t\t\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );\n\t\t\t#else\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\t\t\t#endif\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#else\n\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#endif\n\t\t}\n\n\t\tvoid main() {\n\t\t\tfloat depth = getDepth( vUv );\n\t\t\tif( depth >= ( 1.0 - EPSILON ) ) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tfloat centerViewZ = -getViewZ( depth );\n\t\t\tbool rBreak = false, lBreak = false;\n\n\t\t\tfloat weightSum = sampleWeights[0];\n\t\t\tvec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;\n\n\t\t\tfor( int i = 1; i <= KERNEL_RADIUS; i ++ ) {\n\n\t\t\t\tfloat sampleWeight = sampleWeights[i];\n\t\t\t\tvec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;\n\n\t\t\t\tvec2 sampleUv = vUv + sampleUvOffset;\n\t\t\t\tfloat viewZ = -getViewZ( getDepth( sampleUv ) );\n\n\t\t\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;\n\n\t\t\t\tif( ! rBreak ) {\n\t\t\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;\n\t\t\t\t\tweightSum += sampleWeight;\n\t\t\t\t}\n\n\t\t\t\tsampleUv = vUv - sampleUvOffset;\n\t\t\t\tviewZ = -getViewZ( getDepth( sampleUv ) );\n\n\t\t\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;\n\n\t\t\t\tif( ! lBreak ) {\n\t\t\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;\n\t\t\t\t\tweightSum += sampleWeight;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tgl_FragColor = diffuseSum / weightSum;\n\t\t}"},Od={createSampleWeights:function(t,e){const i=[];for(let n=0;n<=t;n++)i.push(Bd(n,e));return i},createSampleOffsets:function(t,e){const i=[];for(let n=0;n<=t;n++)i.push(e.clone().multiplyScalar(n));return i},configure:function(t,e,i,n){t.defines.KERNEL_RADIUS=e,t.uniforms.sampleUvOffsets.value=Od.createSampleOffsets(e,n),t.uniforms.sampleWeights.value=Od.createSampleWeights(e,i),t.needsUpdate=!0}};function Bd(t,e){return Math.exp(-t*t/(e*e*2))/(Math.sqrt(2*Math.PI)*e)}const Hd={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );\n\t\t\tgl_FragColor = vec4( vec3( depth ), opacity );\n\n\t\t}"};class Gd extends yd{constructor(t,e,i=!1,n=!1,s=new Et(256,256)){let o;super(),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.isDirectDepth=!1,this.isDirectNormal=!1,this.supportsDepthTextureExtension=i,this.supportsNormalTexture=n,this.originalClearColor=new di,this._oldClearColor=new di,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=new Et(s.x,s.y),this.saoRenderTarget=new Bt(this.resolution.x,this.resolution.y,{minFilter:M,magFilter:M,format:I}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone(),this.beautyRenderTarget=this.saoRenderTarget.clone(),this.normalRenderTarget=new Bt(this.resolution.x,this.resolution.y,{minFilter:b,magFilter:b,format:I}),this.depthRenderTarget=this.normalRenderTarget.clone(),this.supportsDepthTextureExtension&&(o=new xo,o.type=E,this.beautyRenderTarget.depthTexture=o,this.beautyRenderTarget.depthBuffer=!0),this.depthMaterial=new qr,this.depthMaterial.depthPacking=lt,this.depthMaterial.blending=0,this.normalMaterial=new Xl,this.normalMaterial.blending=0,void 0===zd&&console.error("THREE.SAOPass relies on SAOShader"),this.saoMaterial=new rn({defines:Object.assign({},zd.defines),fragmentShader:zd.fragmentShader,vertexShader:zd.vertexShader,uniforms:sn.clone(zd.uniforms)}),this.saoMaterial.extensions.derivatives=!0,this.saoMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.saoMaterial.defines.NORMAL_TEXTURE=this.supportsNormalTexture?1:0,this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?o:this.depthRenderTarget.texture,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=0,void 0===Ud&&console.error("THREE.SAOPass relies on DepthLimitedBlurShader"),this.vBlurMaterial=new rn({uniforms:sn.clone(Ud.uniforms),defines:Object.assign({},Ud.defines),vertexShader:Ud.vertexShader,fragmentShader:Ud.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?o:this.depthRenderTarget.texture,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=0,this.hBlurMaterial=new rn({uniforms:sn.clone(Ud.uniforms),defines:Object.assign({},Ud.defines),vertexShader:Ud.vertexShader,fragmentShader:Ud.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?o:this.depthRenderTarget.texture,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=0,void 0===xd&&console.error("THREE.SAOPass relies on CopyShader"),this.materialCopy=new rn({uniforms:sn.clone(xd.uniforms),vertexShader:xd.vertexShader,fragmentShader:xd.fragmentShader,blending:0}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=5,this.materialCopy.blendSrc=h,this.materialCopy.blendDst=a,this.materialCopy.blendEquation=r,this.materialCopy.blendSrcAlpha=l,this.materialCopy.blendDstAlpha=a,this.materialCopy.blendEquationAlpha=r,void 0===Hd&&console.error("THREE.SAOPass relies on UnpackDepthRGBAShader"),this.depthCopy=new rn({uniforms:sn.clone(Hd.uniforms),vertexShader:Hd.vertexShader,fragmentShader:Hd.fragmentShader,blending:0}),this.fsQuad=new _d(null)}render(t,e,i){if(this.renderToScreen&&(this.materialCopy.blending=0,this.materialCopy.uniforms.tDiffuse.value=i.texture,this.materialCopy.needsUpdate=!0,this.renderPass(t,this.materialCopy,null)),1===this.params.output)return;t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const n=t.autoClear;t.autoClear=!1,t.setRenderTarget(this.depthRenderTarget),t.clear(),this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;const s=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=s,this.hBlurMaterial.uniforms.depthCutoff.value=s,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),this.prevStdDev===this.params.saoBlurStdDev&&this.prevNumSamples===this.params.saoBlurRadius||(Od.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Et(0,1)),Od.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Et(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),this.isDirectDepth||(t.setClearColor(0),t.setRenderTarget(this.beautyRenderTarget),t.clear(),t.render(this.scene,this.camera),this.supportsDepthTextureExtension||this.renderOverride(t,this.depthMaterial,this.depthRenderTarget,0,1)),this.supportsNormalTexture&&(this.isDirectNormal||this.renderOverride(t,this.normalMaterial,this.normalRenderTarget,7829503,1)),this.renderPass(t,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(t,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(t,this.hBlurMaterial,this.saoRenderTarget,16777215,1));let r=this.materialCopy;3===this.params.output?this.supportsDepthTextureExtension?(this.materialCopy.uniforms.tDiffuse.value=this.beautyRenderTarget.depthTexture,this.materialCopy.needsUpdate=!0):(this.depthCopy.uniforms.tDiffuse.value=this.depthRenderTarget.texture,this.depthCopy.needsUpdate=!0,r=this.depthCopy):4===this.params.output?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),0===this.params.output?r.blending=5:r.blending=0,this.renderPass(t,r,this.renderToScreen?null:i),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=n}renderPass(t,e,i,n,s){t.getClearColor(this.originalClearColor);const r=t.getClearAlpha(),a=t.autoClear;t.setRenderTarget(i),t.autoClear=!1,null!=n&&(t.setClearColor(n),t.setClearAlpha(s||0),t.clear()),this.fsQuad.material=e,this.fsQuad.render(t),t.autoClear=a,t.setClearColor(this.originalClearColor),t.setClearAlpha(r)}renderOverride(t,e,i,n,s){t.getClearColor(this.originalClearColor);const r=t.getClearAlpha(),a=t.autoClear;t.setRenderTarget(i),t.autoClear=!1,n=e.clearColor||n,s=e.clearAlpha||s,null!=n&&(t.setClearColor(n),t.setClearAlpha(s||0),t.clear()),this.scene.overrideMaterial=e,t.render(this.scene,this.camera),this.scene.overrideMaterial=null,t.autoClear=a,t.setClearColor(this.originalClearColor),t.setClearAlpha(r)}setSize(t,e){this.beautyRenderTarget.setSize(t,e),this.saoRenderTarget.setSize(t,e),this.blurIntermediateRenderTarget.setSize(t,e),this.normalRenderTarget.setSize(t,e),this.depthRenderTarget.setSize(t,e),this.saoMaterial.uniforms.size.value.set(t,e),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(t,e),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(t,e),this.hBlurMaterial.needsUpdate=!0}setNormalTarget(t){this.isDirectNormal=!0,this.normalRenderTarget=t,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture}setDepthTarget(t){this.supportsDepthTextureExtension||(this.isDirectDepth=!0,this.depthRenderTarget=t,this.saoMaterial.uniforms.tDepth.value=this.depthRenderTarget.texture)}}Gd.OUTPUT={Beauty:1,Default:0,SAO:2,Depth:3,Normal:4};const Vd={uniforms:{tDiffuse:{value:null},resolution:{value:new Et(1/1024,1/512)}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:'\n\n\t\tprecision highp float;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\n\t\t#define FXAA_PC 1\n\t\t#define FXAA_GLSL_100 1\n\t\t#define FXAA_QUALITY_PRESET 12\n\n\t\t#define FXAA_GREEN_AS_LUMA 1\n\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_PC_CONSOLE\n\t\t\t\t//\n\t\t\t\t// The console algorithm for PC is included\n\t\t\t\t// for developers targeting really low spec machines.\n\t\t\t\t// Likely better to just run FXAA_PC, and use a really low preset.\n\t\t\t\t//\n\t\t\t\t#define FXAA_PC_CONSOLE 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GLSL_120\n\t\t\t\t#define FXAA_GLSL_120 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GLSL_130\n\t\t\t\t#define FXAA_GLSL_130 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_3\n\t\t\t\t#define FXAA_HLSL_3 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_4\n\t\t\t\t#define FXAA_HLSL_4 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_5\n\t\t\t\t#define FXAA_HLSL_5 0\n\t\t#endif\n\t\t/*==========================================================================*/\n\t\t#ifndef FXAA_GREEN_AS_LUMA\n\t\t\t\t//\n\t\t\t\t// For those using non-linear color,\n\t\t\t\t// and either not able to get luma in alpha, or not wanting to,\n\t\t\t\t// this enables FXAA to run using green as a proxy for luma.\n\t\t\t\t// So with this enabled, no need to pack luma in alpha.\n\t\t\t\t//\n\t\t\t\t// This will turn off AA on anything which lacks some amount of green.\n\t\t\t\t// Pure red and blue or combination of only R and B, will get no AA.\n\t\t\t\t//\n\t\t\t\t// Might want to lower the settings for both,\n\t\t\t\t//\t\tfxaaConsoleEdgeThresholdMin\n\t\t\t\t//\t\tfxaaQualityEdgeThresholdMin\n\t\t\t\t// In order to insure AA does not get turned off on colors\n\t\t\t\t// which contain a minor amount of green.\n\t\t\t\t//\n\t\t\t\t// 1 = On.\n\t\t\t\t// 0 = Off.\n\t\t\t\t//\n\t\t\t\t#define FXAA_GREEN_AS_LUMA 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_EARLY_EXIT\n\t\t\t\t//\n\t\t\t\t// Controls algorithm\'s early exit path.\n\t\t\t\t// On PS3 turning this ON adds 2 cycles to the shader.\n\t\t\t\t// On 360 turning this OFF adds 10ths of a millisecond to the shader.\n\t\t\t\t// Turning this off on console will result in a more blurry image.\n\t\t\t\t// So this defaults to on.\n\t\t\t\t//\n\t\t\t\t// 1 = On.\n\t\t\t\t// 0 = Off.\n\t\t\t\t//\n\t\t\t\t#define FXAA_EARLY_EXIT 1\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_DISCARD\n\t\t\t\t//\n\t\t\t\t// Only valid for PC OpenGL currently.\n\t\t\t\t// Probably will not work when FXAA_GREEN_AS_LUMA = 1.\n\t\t\t\t//\n\t\t\t\t// 1 = Use discard on pixels which don\'t need AA.\n\t\t\t\t//\t\t For APIs which enable concurrent TEX+ROP from same surface.\n\t\t\t\t// 0 = Return unchanged color on pixels which don\'t need AA.\n\t\t\t\t//\n\t\t\t\t#define FXAA_DISCARD 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_FAST_PIXEL_OFFSET\n\t\t\t\t//\n\t\t\t\t// Used for GLSL 120 only.\n\t\t\t\t//\n\t\t\t\t// 1 = GL API supports fast pixel offsets\n\t\t\t\t// 0 = do not use fast pixel offsets\n\t\t\t\t//\n\t\t\t\t#ifdef GL_EXT_gpu_shader4\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_NV_gpu_shader5\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_ARB_gpu_shader5\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifndef FXAA_FAST_PIXEL_OFFSET\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 0\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GATHER4_ALPHA\n\t\t\t\t//\n\t\t\t\t// 1 = API supports gather4 on alpha channel.\n\t\t\t\t// 0 = API does not support gather4 on alpha channel.\n\t\t\t\t//\n\t\t\t\t#if (FXAA_HLSL_5 == 1)\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_ARB_gpu_shader5\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_NV_gpu_shader5\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifndef FXAA_GATHER4_ALPHA\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 0\n\t\t\t\t#endif\n\t\t#endif\n\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tFXAA QUALITY - TUNING KNOBS\n\t\t------------------------------------------------------------------------------\n\t\tNOTE the other tuning knobs are now in the shader function inputs!\n\t\t============================================================================*/\n\t\t#ifndef FXAA_QUALITY_PRESET\n\t\t\t\t//\n\t\t\t\t// Choose the quality preset.\n\t\t\t\t// This needs to be compiled into the shader as it effects code.\n\t\t\t\t// Best option to include multiple presets is to\n\t\t\t\t// in each shader define the preset, then include this file.\n\t\t\t\t//\n\t\t\t\t// OPTIONS\n\t\t\t\t// -----------------------------------------------------------------------\n\t\t\t\t// 10 to 15 - default medium dither (10=fastest, 15=highest quality)\n\t\t\t\t// 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\n\t\t\t\t// 39\t\t\t - no dither, very expensive\n\t\t\t\t//\n\t\t\t\t// NOTES\n\t\t\t\t// -----------------------------------------------------------------------\n\t\t\t\t// 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\n\t\t\t\t// 13 = about same speed as FXAA 3.9 and better than 12\n\t\t\t\t// 23 = closest to FXAA 3.9 visually and performance wise\n\t\t\t\t//\t_ = the lowest digit is directly related to performance\n\t\t\t\t// _\t= the highest digit is directly related to style\n\t\t\t\t//\n\t\t\t\t#define FXAA_QUALITY_PRESET 12\n\t\t#endif\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - PRESETS\n\n\t\t============================================================================*/\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - MEDIUM DITHER PRESETS\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 10)\n\t\t\t\t#define FXAA_QUALITY_PS 3\n\t\t\t\t#define FXAA_QUALITY_P0 1.5\n\t\t\t\t#define FXAA_QUALITY_P1 3.0\n\t\t\t\t#define FXAA_QUALITY_P2 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 11)\n\t\t\t\t#define FXAA_QUALITY_PS 4\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 3.0\n\t\t\t\t#define FXAA_QUALITY_P3 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 12)\n\t\t\t\t#define FXAA_QUALITY_PS 5\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 4.0\n\t\t\t\t#define FXAA_QUALITY_P4 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 13)\n\t\t\t\t#define FXAA_QUALITY_PS 6\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 4.0\n\t\t\t\t#define FXAA_QUALITY_P5 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 14)\n\t\t\t\t#define FXAA_QUALITY_PS 7\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 4.0\n\t\t\t\t#define FXAA_QUALITY_P6 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 15)\n\t\t\t\t#define FXAA_QUALITY_PS 8\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 4.0\n\t\t\t\t#define FXAA_QUALITY_P7 12.0\n\t\t#endif\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - LOW DITHER PRESETS\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 20)\n\t\t\t\t#define FXAA_QUALITY_PS 3\n\t\t\t\t#define FXAA_QUALITY_P0 1.5\n\t\t\t\t#define FXAA_QUALITY_P1 2.0\n\t\t\t\t#define FXAA_QUALITY_P2 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 21)\n\t\t\t\t#define FXAA_QUALITY_PS 4\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 22)\n\t\t\t\t#define FXAA_QUALITY_PS 5\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 23)\n\t\t\t\t#define FXAA_QUALITY_PS 6\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 24)\n\t\t\t\t#define FXAA_QUALITY_PS 7\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 3.0\n\t\t\t\t#define FXAA_QUALITY_P6 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 25)\n\t\t\t\t#define FXAA_QUALITY_PS 8\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 4.0\n\t\t\t\t#define FXAA_QUALITY_P7 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 26)\n\t\t\t\t#define FXAA_QUALITY_PS 9\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 4.0\n\t\t\t\t#define FXAA_QUALITY_P8 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 27)\n\t\t\t\t#define FXAA_QUALITY_PS 10\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 4.0\n\t\t\t\t#define FXAA_QUALITY_P9 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 28)\n\t\t\t\t#define FXAA_QUALITY_PS 11\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 4.0\n\t\t\t\t#define FXAA_QUALITY_P10 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 29)\n\t\t\t\t#define FXAA_QUALITY_PS 12\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 2.0\n\t\t\t\t#define FXAA_QUALITY_P10 4.0\n\t\t\t\t#define FXAA_QUALITY_P11 8.0\n\t\t#endif\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - EXTREME QUALITY\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 39)\n\t\t\t\t#define FXAA_QUALITY_PS 12\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.0\n\t\t\t\t#define FXAA_QUALITY_P2 1.0\n\t\t\t\t#define FXAA_QUALITY_P3 1.0\n\t\t\t\t#define FXAA_QUALITY_P4 1.0\n\t\t\t\t#define FXAA_QUALITY_P5 1.5\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 2.0\n\t\t\t\t#define FXAA_QUALITY_P10 4.0\n\t\t\t\t#define FXAA_QUALITY_P11 8.0\n\t\t#endif\n\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAPI PORTING\n\n\t\t============================================================================*/\n\t\t#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)\n\t\t\t\t#define FxaaBool bool\n\t\t\t\t#define FxaaDiscard discard\n\t\t\t\t#define FxaaFloat float\n\t\t\t\t#define FxaaFloat2 vec2\n\t\t\t\t#define FxaaFloat3 vec3\n\t\t\t\t#define FxaaFloat4 vec4\n\t\t\t\t#define FxaaHalf float\n\t\t\t\t#define FxaaHalf2 vec2\n\t\t\t\t#define FxaaHalf3 vec3\n\t\t\t\t#define FxaaHalf4 vec4\n\t\t\t\t#define FxaaInt2 ivec2\n\t\t\t\t#define FxaaSat(x) clamp(x, 0.0, 1.0)\n\t\t\t\t#define FxaaTex sampler2D\n\t\t#else\n\t\t\t\t#define FxaaBool bool\n\t\t\t\t#define FxaaDiscard clip(-1)\n\t\t\t\t#define FxaaFloat float\n\t\t\t\t#define FxaaFloat2 float2\n\t\t\t\t#define FxaaFloat3 float3\n\t\t\t\t#define FxaaFloat4 float4\n\t\t\t\t#define FxaaHalf half\n\t\t\t\t#define FxaaHalf2 half2\n\t\t\t\t#define FxaaHalf3 half3\n\t\t\t\t#define FxaaHalf4 half4\n\t\t\t\t#define FxaaSat(x) saturate(x)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t#define FxaaTexTop(t, p) texture2D(t, p, 0.0)\n\t\t\t#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_120 == 1)\n\t\t\t\t// Requires,\n\t\t\t\t//\t#version 120\n\t\t\t\t// And at least,\n\t\t\t\t//\t#extension GL_EXT_gpu_shader4 : enable\n\t\t\t\t//\t(or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)\n\t\t\t\t#define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\n\t\t\t\t#if (FXAA_FAST_PIXEL_OFFSET == 1)\n\t\t\t\t\t\t#define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)\n\t\t\t\t#else\n\t\t\t\t\t\t#define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\n\t\t\t\t#endif\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t// use #extension GL_ARB_gpu_shader5 : enable\n\t\t\t\t\t\t#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n\t\t\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n\t\t\t\t\t\t#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n\t\t\t\t\t\t#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_130 == 1)\n\t\t\t\t// Requires "#version 130" or better\n\t\t\t\t#define FxaaTexTop(t, p) textureLod(t, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t// use #extension GL_ARB_gpu_shader5 : enable\n\t\t\t\t\t\t#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n\t\t\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n\t\t\t\t\t\t#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n\t\t\t\t\t\t#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_3 == 1)\n\t\t\t\t#define FxaaInt2 float2\n\t\t\t\t#define FxaaTex sampler2D\n\t\t\t\t#define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))\n\t\t\t\t#define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_4 == 1)\n\t\t\t\t#define FxaaInt2 int2\n\t\t\t\tstruct FxaaTex { SamplerState smpl; Texture2D tex; };\n\t\t\t\t#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_5 == 1)\n\t\t\t\t#define FxaaInt2 int2\n\t\t\t\tstruct FxaaTex { SamplerState smpl; Texture2D tex; };\n\t\t\t\t#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n\t\t\t\t#define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)\n\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)\n\t\t\t\t#define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)\n\t\t\t\t#define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)\n\t\t#endif\n\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t GREEN AS LUMA OPTION SUPPORT FUNCTION\n\t\t============================================================================*/\n\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\tFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }\n\t\t#else\n\t\t\t\tFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\n\t\t#endif\n\n\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t FXAA3 QUALITY - PC\n\n\t\t============================================================================*/\n\t\t#if (FXAA_PC == 1)\n\t\t/*--------------------------------------------------------------------------*/\n\t\tFxaaFloat4 FxaaPixelShader(\n\t\t\t\t//\n\t\t\t\t// Use noperspective interpolation here (turn off perspective interpolation).\n\t\t\t\t// {xy} = center of pixel\n\t\t\t\tFxaaFloat2 pos,\n\t\t\t\t//\n\t\t\t\t// Used only for FXAA Console, and not used on the 360 version.\n\t\t\t\t// Use noperspective interpolation here (turn off perspective interpolation).\n\t\t\t\t// {xy_} = upper left of pixel\n\t\t\t\t// {_zw} = lower right of pixel\n\t\t\t\tFxaaFloat4 fxaaConsolePosPos,\n\t\t\t\t//\n\t\t\t\t// Input color texture.\n\t\t\t\t// {rgb_} = color in linear or perceptual color space\n\t\t\t\t// if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t//\t\t {__a} = luma in perceptual color space (not linear)\n\t\t\t\tFxaaTex tex,\n\t\t\t\t//\n\t\t\t\t// Only used on the optimized 360 version of FXAA Console.\n\t\t\t\t// For everything but 360, just use the same input here as for "tex".\n\t\t\t\t// For 360, same texture, just alias with a 2nd sampler.\n\t\t\t\t// This sampler needs to have an exponent bias of -1.\n\t\t\t\tFxaaTex fxaaConsole360TexExpBiasNegOne,\n\t\t\t\t//\n\t\t\t\t// Only used on the optimized 360 version of FXAA Console.\n\t\t\t\t// For everything but 360, just use the same input here as for "tex".\n\t\t\t\t// For 360, same texture, just alias with a 3nd sampler.\n\t\t\t\t// This sampler needs to have an exponent bias of -2.\n\t\t\t\tFxaaTex fxaaConsole360TexExpBiasNegTwo,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x_} = 1.0/screenWidthInPixels\n\t\t\t\t// {_y} = 1.0/screenHeightInPixels\n\t\t\t\tFxaaFloat2 fxaaQualityRcpFrame,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// This effects sub-pixel AA quality and inversely sharpness.\n\t\t\t\t//\t Where N ranges between,\n\t\t\t\t//\t\t N = 0.50 (default)\n\t\t\t\t//\t\t N = 0.33 (sharper)\n\t\t\t\t// {x__} = -N/screenWidthInPixels\n\t\t\t\t// {_y_} = -N/screenHeightInPixels\n\t\t\t\t// {_z_} =\tN/screenWidthInPixels\n\t\t\t\t// {__w} =\tN/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsoleRcpFrameOpt,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// Not used on 360, but used on PS3 and PC.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x__} = -2.0/screenWidthInPixels\n\t\t\t\t// {_y_} = -2.0/screenHeightInPixels\n\t\t\t\t// {_z_} =\t2.0/screenWidthInPixels\n\t\t\t\t// {__w} =\t2.0/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsoleRcpFrameOpt2,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// Only used on 360 in place of fxaaConsoleRcpFrameOpt2.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x__} =\t8.0/screenWidthInPixels\n\t\t\t\t// {_y_} =\t8.0/screenHeightInPixels\n\t\t\t\t// {_z_} = -4.0/screenWidthInPixels\n\t\t\t\t// {__w} = -4.0/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsole360RcpFrameOpt2,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_SUBPIX define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Choose the amount of sub-pixel aliasing removal.\n\t\t\t\t// This can effect sharpness.\n\t\t\t\t//\t 1.00 - upper limit (softer)\n\t\t\t\t//\t 0.75 - default amount of filtering\n\t\t\t\t//\t 0.50 - lower limit (sharper, less sub-pixel aliasing removal)\n\t\t\t\t//\t 0.25 - almost off\n\t\t\t\t//\t 0.00 - completely off\n\t\t\t\tFxaaFloat fxaaQualitySubpix,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// The minimum amount of local contrast required to apply algorithm.\n\t\t\t\t//\t 0.333 - too little (faster)\n\t\t\t\t//\t 0.250 - low quality\n\t\t\t\t//\t 0.166 - default\n\t\t\t\t//\t 0.125 - high quality\n\t\t\t\t//\t 0.063 - overkill (slower)\n\t\t\t\tFxaaFloat fxaaQualityEdgeThreshold,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Trims the algorithm from processing darks.\n\t\t\t\t//\t 0.0833 - upper limit (default, the start of visible unfiltered edges)\n\t\t\t\t//\t 0.0625 - high quality (faster)\n\t\t\t\t//\t 0.0312 - visible limit (slower)\n\t\t\t\t// Special notes when using FXAA_GREEN_AS_LUMA,\n\t\t\t\t//\t Likely want to set this to zero.\n\t\t\t\t//\t As colors that are mostly not-green\n\t\t\t\t//\t will appear very dark in the green channel!\n\t\t\t\t//\t Tune by looking at mostly non-green content,\n\t\t\t\t//\t then start at zero and increase until aliasing is a problem.\n\t\t\t\tFxaaFloat fxaaQualityEdgeThresholdMin,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// This does not effect PS3, as this needs to be compiled in.\n\t\t\t\t//\t Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.\n\t\t\t\t//\t Due to the PS3 being ALU bound,\n\t\t\t\t//\t there are only three safe values here: 2 and 4 and 8.\n\t\t\t\t//\t These options use the shaders ability to a free *|/ by 2|4|8.\n\t\t\t\t// For all other platforms can be a non-power of two.\n\t\t\t\t//\t 8.0 is sharper (default!!!)\n\t\t\t\t//\t 4.0 is softer\n\t\t\t\t//\t 2.0 is really soft (good only for vector graphics inputs)\n\t\t\t\tFxaaFloat fxaaConsoleEdgeSharpness,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// This does not effect PS3, as this needs to be compiled in.\n\t\t\t\t//\t Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.\n\t\t\t\t//\t Due to the PS3 being ALU bound,\n\t\t\t\t//\t there are only two safe values here: 1/4 and 1/8.\n\t\t\t\t//\t These options use the shaders ability to a free *|/ by 2|4|8.\n\t\t\t\t// The console setting has a different mapping than the quality setting.\n\t\t\t\t// Other platforms can use other values.\n\t\t\t\t//\t 0.125 leaves less aliasing, but is softer (default!!!)\n\t\t\t\t//\t 0.25 leaves more aliasing, and is sharper\n\t\t\t\tFxaaFloat fxaaConsoleEdgeThreshold,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Trims the algorithm from processing darks.\n\t\t\t\t// The console setting has a different mapping than the quality setting.\n\t\t\t\t// This only applies when FXAA_EARLY_EXIT is 1.\n\t\t\t\t// This does not apply to PS3,\n\t\t\t\t// PS3 was simplified to avoid more shader instructions.\n\t\t\t\t//\t 0.06 - faster but more aliasing in darks\n\t\t\t\t//\t 0.05 - default\n\t\t\t\t//\t 0.04 - slower and less aliasing in darks\n\t\t\t\t// Special notes when using FXAA_GREEN_AS_LUMA,\n\t\t\t\t//\t Likely want to set this to zero.\n\t\t\t\t//\t As colors that are mostly not-green\n\t\t\t\t//\t will appear very dark in the green channel!\n\t\t\t\t//\t Tune by looking at mostly non-green content,\n\t\t\t\t//\t then start at zero and increase until aliasing is a problem.\n\t\t\t\tFxaaFloat fxaaConsoleEdgeThresholdMin,\n\t\t\t\t//\n\t\t\t\t// Extra constants for 360 FXAA Console only.\n\t\t\t\t// Use zeros or anything else for other platforms.\n\t\t\t\t// These must be in physical constant registers and NOT immediates.\n\t\t\t\t// Immediates will result in compiler un-optimizing.\n\t\t\t\t// {xyzw} = float4(1.0, -1.0, 0.25, -0.25)\n\t\t\t\tFxaaFloat4 fxaaConsole360ConstDir\n\t\t) {\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posM;\n\t\t\t\tposM.x = pos.x;\n\t\t\t\tposM.y = pos.y;\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t#if (FXAA_DISCARD == 0)\n\t\t\t\t\t\t\t\tFxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n\t\t\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\t\t\t#define lumaM rgbyM.w\n\t\t\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t\t\t#define lumaM rgbyM.y\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\t\t\t#define lumaM luma4A.w\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#define lumaE luma4A.z\n\t\t\t\t\t\t#define lumaS luma4A.x\n\t\t\t\t\t\t#define lumaSE luma4A.y\n\t\t\t\t\t\t#define lumaNW luma4B.w\n\t\t\t\t\t\t#define lumaN luma4B.z\n\t\t\t\t\t\t#define lumaW luma4B.x\n\t\t\t\t#else\n\t\t\t\t\t\tFxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\t#define lumaM rgbyM.w\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t#define lumaM rgbyM.y\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t\t\t\t\tFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#endif\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat maxSM = max(lumaS, lumaM);\n\t\t\t\tFxaaFloat minSM = min(lumaS, lumaM);\n\t\t\t\tFxaaFloat maxESM = max(lumaE, maxSM);\n\t\t\t\tFxaaFloat minESM = min(lumaE, minSM);\n\t\t\t\tFxaaFloat maxWN = max(lumaN, lumaW);\n\t\t\t\tFxaaFloat minWN = min(lumaN, lumaW);\n\t\t\t\tFxaaFloat rangeMax = max(maxWN, maxESM);\n\t\t\t\tFxaaFloat rangeMin = min(minWN, minESM);\n\t\t\t\tFxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n\t\t\t\tFxaaFloat range = rangeMax - rangeMin;\n\t\t\t\tFxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n\t\t\t\tFxaaBool earlyExit = range < rangeMaxClamped;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(earlyExit)\n\t\t\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\t\t\tFxaaDiscard;\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\treturn rgbyM;\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 0)\n\t\t\t\t\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t\t\t\t\tFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#endif\n\t\t\t\t#else\n\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNS = lumaN + lumaS;\n\t\t\t\tFxaaFloat lumaWE = lumaW + lumaE;\n\t\t\t\tFxaaFloat subpixRcpRange = 1.0/range;\n\t\t\t\tFxaaFloat subpixNSWE = lumaNS + lumaWE;\n\t\t\t\tFxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n\t\t\t\tFxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNESE = lumaNE + lumaSE;\n\t\t\t\tFxaaFloat lumaNWNE = lumaNW + lumaNE;\n\t\t\t\tFxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n\t\t\t\tFxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNWSW = lumaNW + lumaSW;\n\t\t\t\tFxaaFloat lumaSWSE = lumaSW + lumaSE;\n\t\t\t\tFxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n\t\t\t\tFxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n\t\t\t\tFxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n\t\t\t\tFxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n\t\t\t\tFxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\n\t\t\t\tFxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\n\t\t\t\tFxaaFloat lengthSign = fxaaQualityRcpFrame.x;\n\t\t\t\tFxaaBool horzSpan = edgeHorz >= edgeVert;\n\t\t\t\tFxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(!horzSpan) lumaN = lumaW;\n\t\t\t\tif(!horzSpan) lumaS = lumaE;\n\t\t\t\tif(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n\t\t\t\tFxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat gradientN = lumaN - lumaM;\n\t\t\t\tFxaaFloat gradientS = lumaS - lumaM;\n\t\t\t\tFxaaFloat lumaNN = lumaN + lumaM;\n\t\t\t\tFxaaFloat lumaSS = lumaS + lumaM;\n\t\t\t\tFxaaBool pairN = abs(gradientN) >= abs(gradientS);\n\t\t\t\tFxaaFloat gradient = max(abs(gradientN), abs(gradientS));\n\t\t\t\tif(pairN) lengthSign = -lengthSign;\n\t\t\t\tFxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posB;\n\t\t\t\tposB.x = posM.x;\n\t\t\t\tposB.y = posM.y;\n\t\t\t\tFxaaFloat2 offNP;\n\t\t\t\toffNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n\t\t\t\toffNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n\t\t\t\tif(!horzSpan) posB.x += lengthSign * 0.5;\n\t\t\t\tif( horzSpan) posB.y += lengthSign * 0.5;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posN;\n\t\t\t\tposN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\n\t\t\t\tposN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\n\t\t\t\tFxaaFloat2 posP;\n\t\t\t\tposP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\n\t\t\t\tposP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\n\t\t\t\tFxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\n\t\t\t\tFxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\n\t\t\t\tFxaaFloat subpixE = subpixC * subpixC;\n\t\t\t\tFxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(!pairN) lumaNN = lumaSS;\n\t\t\t\tFxaaFloat gradientScaled = gradient * 1.0/4.0;\n\t\t\t\tFxaaFloat lumaMM = lumaM - lumaNN * 0.5;\n\t\t\t\tFxaaFloat subpixF = subpixD * subpixE;\n\t\t\t\tFxaaBool lumaMLTZero = lumaMM < 0.0;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tlumaEndN -= lumaNN * 0.5;\n\t\t\t\tlumaEndP -= lumaNN * 0.5;\n\t\t\t\tFxaaBool doneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\tFxaaBool doneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\n\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\n\t\t\t\tFxaaBool doneNP = (!doneN) || (!doneP);\n\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\n\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(doneNP) {\n\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\n\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\n\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\n\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 3)\n\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 4)\n\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 5)\n\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 6)\n\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 7)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t#if (FXAA_QUALITY_PS > 8)\n\t\t\t\tif(doneNP) {\n\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\n\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\n\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\n\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 9)\n\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 10)\n\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 11)\n\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 12)\n\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t}\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t}\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat dstN = posM.x - posN.x;\n\t\t\t\tFxaaFloat dstP = posP.x - posM.x;\n\t\t\t\tif(!horzSpan) dstN = posM.y - posN.y;\n\t\t\t\tif(!horzSpan) dstP = posP.y - posM.y;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n\t\t\t\tFxaaFloat spanLength = (dstP + dstN);\n\t\t\t\tFxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n\t\t\t\tFxaaFloat spanLengthRcp = 1.0/spanLength;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaBool directionN = dstN < dstP;\n\t\t\t\tFxaaFloat dst = min(dstN, dstP);\n\t\t\t\tFxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\n\t\t\t\tFxaaFloat subpixG = subpixF * subpixF;\n\t\t\t\tFxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n\t\t\t\tFxaaFloat subpixH = subpixG * fxaaQualitySubpix;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n\t\t\t\tFxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n\t\t\t\tif(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n\t\t\t\tif( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\treturn FxaaTexTop(tex, posM);\n\t\t\t\t#else\n\t\t\t\t\t\treturn FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n\t\t\t\t#endif\n\t\t}\n\t\t/*==========================================================================*/\n\t\t#endif\n\n\t\tvoid main() {\n\t\t\tgl_FragColor = FxaaPixelShader(\n\t\t\t\tvUv,\n\t\t\t\tvec4(0.0),\n\t\t\t\ttDiffuse,\n\t\t\t\ttDiffuse,\n\t\t\t\ttDiffuse,\n\t\t\t\tresolution,\n\t\t\t\tvec4(0.0),\n\t\t\t\tvec4(0.0),\n\t\t\t\tvec4(0.0),\n\t\t\t\t0.75,\n\t\t\t\t0.166,\n\t\t\t\t0.0833,\n\t\t\t\t0.0,\n\t\t\t\t0.0,\n\t\t\t\t0.0,\n\t\t\t\tvec4(0.0)\n\t\t\t);\n\n\t\t\t// TODO avoid querying texture twice for same texel\n\t\t\tgl_FragColor.a = texture2D(tDiffuse, vUv).a;\n\t\t}'};new Et;const Wd={uniforms:{tDiffuse:{value:null},strength:{value:0},height:{value:1},aspectRatio:{value:1},cylindricalRatio:{value:1}},vertexShader:"\n\n\t\tuniform float strength;          // s: 0 = perspective, 1 = stereographic\n        uniform float height;            // h: tan(verticalFOVInRadians / 2)\n        uniform float aspectRatio;       // a: screenWidth / screenHeight\n        uniform float cylindricalRatio;  // c: cylindrical distortion ratio. 1 = spherical\n\n        varying vec3 vUV;                // output to interpolate over screen\n        varying vec2 vUVDot;             // output to interpolate over screen\n\n        void main() {\n\n            gl_Position = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));\n\n            float scaledHeight = strength * height;\n            float cylAspectRatio = aspectRatio * cylindricalRatio;\n            float aspectDiagSq = aspectRatio * aspectRatio + 1.0;\n            float diagSq = scaledHeight * scaledHeight * aspectDiagSq;\n            vec2 signedUV = (2.0 * uv + vec2(-1.0, -1.0));\n\n            float z = 0.5 * sqrt(diagSq + 1.0) + 0.5;\n            float ny = (z - 1.0) / (cylAspectRatio * cylAspectRatio + 1.0);\n\n            vUVDot = sqrt(ny) * vec2(cylAspectRatio, 1.0) * signedUV;\n            vUV = vec3(0.5, 0.5, 1.0) * z + vec3(-0.5, -0.5, 0.0);\n            vUV.xy += uv;\n            \n        }",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;      // sampler of rendered scene?s render target\n        varying vec3 vUV;                // interpolated vertex output data\n        varying vec2 vUVDot;             // interpolated vertex output data\n\n        void main() {\n            vec3 uv = dot(vUVDot, vUVDot) * vec3(-0.5, -0.5, -1.0) + vUV;\n            gl_FragColor = texture2DProj(tDiffuse, uv);\n        }"};class jd extends fh{load(t,e,i,n){const s=new vh(this.manager);s.setPath(this.path),s.setResponseType("text"),s.load(t,(i=>{try{e(this.parse(i))}catch(e){n?n(e):console.error(e),this.manager.itemError(t)}}),i,n)}parse(t){t=t.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let e=null,i=null;const n=new Wt(0,0,0),s=new Wt(1,1,1),r=t.split(/[\n\r]+/g);let a=null,o=0;for(let t=0,l=r.length;t<l;t++){const l=r[t].trim(),h=l.split(/\s/g);switch(h[0]){case"TITLE":e=l.substring(7,l.length-1);break;case"LUT_3D_SIZE":const t=h[1];i=parseFloat(t),a=new Uint8Array(i*i*i*3);break;case"DOMAIN_MIN":n.x=parseFloat(h[1]),n.y=parseFloat(h[2]),n.z=parseFloat(h[3]);break;case"DOMAIN_MAX":s.x=parseFloat(h[1]),s.y=parseFloat(h[2]),s.z=parseFloat(h[3]);break;default:const r=parseFloat(h[0]),c=parseFloat(h[1]),u=parseFloat(h[2]);if(r>1||r<0||c>1||c<0||u>1||u<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");a[o+0]=255*r,a[o+1]=255*c,a[o+2]=255*u,o+=3}}const l=new Ba;l.image.data=a,l.image.width=i,l.image.height=i*i,l.format=F,l.type=A,l.magFilter=M,l.minFilter=M,l.wrapS=x,l.wrapT=x,l.generateMipmaps=!1;const h=new ps;return h.image.data=a,h.image.width=i,h.image.height=i,h.image.depth=i,h.format=F,h.type=A,h.magFilter=M,h.minFilter=M,h.wrapS=x,h.wrapT=x,h.wrapR=x,h.generateMipmaps=!1,{title:e,size:i,domainMin:n,domainMax:s,texture:l,texture3D:h}}}class Xd extends class{constructor(t,e){if(this.renderer=t,void 0===e){const i={minFilter:M,magFilter:M,format:I},n=t.getSize(new Et);this._pixelRatio=t.getPixelRatio(),this._width=n.width,this._height=n.height,(e=new Bt(this._width*this._pixelRatio,this._height*this._pixelRatio,i)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===xd&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===Md&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new Md(xd),this.clock=new ic}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(t){const e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}render(t){void 0===t&&(t=this.clock.getDelta());const e=this.renderer.getRenderTarget();let i=!1;for(let e=0,n=this.passes.length;e<n;e++){const n=this.passes[e];if(!1!==n.enabled){if(n.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(e),n.render(this.renderer,this.writeBuffer,this.readBuffer,t,i),n.needsSwap){if(i){const e=this.renderer.getContext(),i=this.renderer.state.buffers.stencil;i.setFunc(e.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),i.setFunc(e.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==Sd&&(n instanceof Sd?i=!0:n instanceof Td&&(i=!1))}}this.renderer.setRenderTarget(e)}reset(t){if(void 0===t){const e=this.renderer.getSize(new Et);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,e){this._width=t,this._height=e;const i=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(i,n),this.renderTarget2.setSize(i,n);for(let t=0;t<this.passes.length;t++)this.passes[t].setSize(i,n)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}}{constructor(t,e,i,n,s){let r=t.capabilities.isWebGL2,a=t.getPixelRatio();const o=new(r?Gt:Bt)(s.w*a,s.h*a,{minFilter:M,magFilter:M,format:I});o.samples&&(o.samples=4),super(t,o),this.renderTarget=o,this.normalTarget=o.clone(),this.depthTarget=o.clone(),this.normalTarget.texture.minFilter=b,this.normalTarget.texture.magFilter=b,this.v=new Wt,this.torad=Math.PI/180,this.todeg=180/Math.PI,this.isGl2=r,this._pixelRatio=a,this.scene=e,this.camera=i,this.controls=n,this.size=s,this._width=s.w,this._height=s.h,this.enabled=!1,this.options={focus:20,aperture:5,maxblur:1,threshold:.85,strength:1.5,bloomRadius:.4,saoBias:.5,saoIntensity:.06,saoScale:40,saoKernelRadius:50,saoMinResolution:0,kernelRadius:.1,minDistance:1e-4,maxDistance:2},this.pass={},this.pass.render=new Ed(e,i),this.addPass(this.pass.render),this.pass.sao=new Gd(e,i,this.isGl2,!0),this.pass.sao.params={output:0,saoBias:this.options.saoBias,saoIntensity:this.options.saoIntensity,saoScale:this.options.saoScale,saoKernelRadius:this.options.saoKernelRadius,saoMinResolution:this.options.saoMinResolution,saoBlur:!0,saoBlurRadius:4,saoBlurStdDev:2,saoBlurDepthCutoff:.01},this.pass.sao.setNormalTarget(this.normalTarget),this.isGl2||this.pass.sao.setDepthTarget(this.depthTarget),this.addPass(this.pass.sao),this.pass.sao.enabled=!0,this.lutMap={},this.pass.lut=new Rd,this.loadLut("premium"),this.addPass(this.pass.lut),this.pass.lut.enabled=!1,this.pass.distortion=new Md(Wd),this.setDistortion(),this.addPass(this.pass.distortion),this.pass.distortion.enabled=!1,this.pass.bloom=new Cd(new Et(s.w,s.h),1.5,.4,.85,!0,vd),this.addPass(this.pass.bloom),this.pass.bloom.enabled=!0,this.isGl2||(this.pass.fxaa=new Md(Vd),this.pass.fxaa.setSize=function(t,e){this.uniforms.resolution.value.set(1/t,1/e)},this.addPass(this.pass.fxaa)),this.update()}renderNormal(){rd.up({renderMode:2}),vd.setBackgroud(7829503),this.renderer.setRenderTarget(this.normalTarget),this.renderer.render(this.scene,this.camera)}renderDepth(){rd.up({renderMode:1}),vd.setBackgroud(0),this.renderer.setRenderTarget(this.depthTarget),this.renderer.render(this.scene,this.camera)}renderBeauty(){rd.up({renderMode:0}),vd.setBackgroud(),this.renderer.setRenderTarget(null)}setDistortion(){let t=Math.tan(100*this.torad*.5)/this.camera.aspect;this.pass.distortion.uniforms.strength.value=.5,this.pass.distortion.uniforms.height.value=t,this.pass.distortion.uniforms.aspectRatio.value=this.camera.ratio,this.pass.distortion.uniforms.cylindricalRatio.value=2}update(){this.pass.bloom&&(this.pass.bloom.threshold=this.options.threshold,this.pass.bloom.strength=this.options.strength,this.pass.bloom.bloomRadius=this.options.bloomRadius),this.pass.sao&&(this.pass.sao.params.saoBias=this.options.saoBias,this.pass.sao.params.saoIntensity=this.options.saoIntensity,this.pass.sao.params.saoScale=this.options.saoScale,this.pass.sao.params.saoKernelRadius=this.options.saoKernelRadius,this.pass.sao.params.saoMinResolution=this.options.saoMinResolution)}loadLut(t){(new jd).load("assets/luts/"+t+".cube",function(e){let i=t.substring(t.lastIndexOf("/")+1,t.lastIndexOf("."));this.lutMap[i]=e,this.setLut(i)}.bind(this))}setLut(t){this.pass.lut.lut=this.isGl2?this.lutMap[t].texture:this.lutMap[t].texture3D}resize(t){this.enabled&&(this.size=t,this.setSize(this.size.w,this.size.h))}render(t){(this.pass.sao.isDirectNormal||this.pass.sao.isDirectDepth)&&(this.renderNormal(),this.renderBeauty()),super.render(t)}}var Yd={torad:Math.PI/180,todeg:180/Math.PI,Pi:Math.PI,TwoPI:2*Math.PI,PI90:.5*Math.PI,PI45:.25*Math.PI,PI270:.5*Math.PI*3,inv255:.003921569,golden:1.618033,epsilon:Math.pow(2,-52),tmpQ:new Vt,tmpE:new Re,tmpM:new we,tmpM2:new we,tmpV:new Wt,tmpV1:new Wt,tmpV2:new Wt,int:function(t){return Math.floor(t)},lerp:function(t,e,i){return(1-i)*t+i*e},lerpAr:function(t,e,i,n){for(var s=t.length;s--;)t[s]=Yd.lerp(e[s],i[s],n)},randSpread:function(t){return t*(.5-Math.random())},rand:function(t,e){return t+Math.random()*(e-t)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},toFixed:function(t,e){return 1*t.toFixed(e)},map:function(t,e,i,n,s){return(t-e)*(s-n)/(i-e)+n},randomSign:function(){return Math.random()<.5?-1:1},smoothLerp:function(t,e,i,n,s){return i-(i-e)/(s*n)+(t-e+(i-e)/(s*n))*Math.exp(-s*n)},smoothLerpV:function(t,e,i,n,s){return{x:Yd.smoothLerp(t.x,e.x,i.x,n,s),y:Yd.smoothLerp(t.y,e.y,i.y,n,s),z:Yd.smoothLerp(t.z,e.z,i.z,n,s)}},minValue:function(t){var e=t[0];for(let i=1,n=t.length;i<n;i++)t[i]<e&&(e=t[i]);return e},clamp:function(t,e,i){return t=(t=t<e?e:t)>i?i:t},nearEquals:function(t,e,i){return Math.abs(t-e)<=i},addArray:function(t,e){for(var i=[],n=t.length;n--;)i[n]=t[n]+e[n];return i},scaleArray:function(t,e){for(var i=t.length;i--;)t[i]*=e;return t},autoSize:function(t){let e=void 0===t.size?[1,1,1]:t.size;1===e.length&&(e[1]=e[0]);let i=void 0===t.type?"box":t.type,n=void 0===t.radius?e[0]:t.radius,s=void 0===t.height?e[1]:t.height;return"sphere"===i&&(e=[n,n,n]),"cylinder"!==i&&"wheel"!==i&&"capsule"!==i||(e=[n,s,n]),"cone"!==i&&"pyramid"!==i||(e=[n,s,0]),2===e.length&&(e[2]=e[0]),e},correctSize:function(t){return 1===t.length&&(t[1]=t[0]),2===t.length&&(t[2]=t[0]),t},fromTransformToQ:function(t,e,i){return i=i||!1,Yd.tmpM.compose(Yd.tmpV.fromArray(t),Yd.tmpQ.fromArray(e),{x:1,y:1,z:1}),Yd.tmpM.decompose(Yd.tmpV,Yd.tmpQ,{x:1,y:1,z:1}),i&&Yd.tmpQ.invert(),Yd.tmpQ.toArray()},fromTransform:function(t,e,i,n,s){return s=s||!1,n=n||[0,0,0,1],Yd.tmpM.compose(Yd.tmpV.fromArray(t),Yd.tmpQ.fromArray(e),{x:1,y:1,z:1}),Yd.tmpM2.compose(Yd.tmpV.fromArray(i),Yd.tmpQ.fromArray(n),{x:1,y:1,z:1}),s?(Yd.tmpM.invert(),Yd.tmpM.multiply(Yd.tmpM2)):Yd.tmpM.multiply(Yd.tmpM2),Yd.tmpM.decompose(Yd.tmpV,Yd.tmpQ,{x:1,y:1,z:1}),Yd.tmpV.toArray()},arCopy:function(t,e){for(var i=0;i<e.length;i++)t[i]=e[i]},axisToQuatArray:function(t,e){return e=e||!1,Yd.tmpQ.setFromAxisAngle(Yd.tmpV.fromArray(t,1),e?t[0]*Yd.torad:t[0]).normalize().toArray()},toQuatArray:function(t){return Yd.tmpQ.setFromEuler(Yd.tmpE.fromArray(Yd.vectorad(t))).toArray()},vectorad:function(t){let e=3,i=[];for(;e--;)i[e]=t[e]*Yd.torad;return i[3]=t[3],i},unwrapDeg:function(t){return(t%=360)>180&&(t-=360),t<-180&&(t+=360),t},unwrapRad:function(t){return(t%=Yd.TwoPI)>Yd.Pi&&(t-=Yd.TwoPI),t<-Yd.Pi&&(t+=Yd.TwoPI),t},directionVector:function(t,e){var i=e.x-t.x;e.y,t.y;var n=e.z-t.z;return Yd.tmpV.set(i,0,n).normalize().toArray()},distanceVector:function(t,e){var i=e.x-t.x,n=e.y-t.y,s=e.z-t.z;return Math.sqrt(i*i+n*n+s*s)},rgbToHex:function(t){return"0x"+("000000"+(255*t[0]<<16^255*t[1]<<8^255*t[2]<<0).toString(16)).slice(-6)},hexToRgb:function(t){return[((t=Math.floor(t))>>16&255)/255,(t>>8&255)/255,(255&t)/255]},htmlToHex:function(t){return t.toUpperCase().replace("#","0x")},hexToHtml:function(t){return"#"+("000000"+(t=void 0===t?0:t).toString(16)).substr(-6)},rgbToHtml:function(t){return"#"+("000000"+(255*t[0]<<16^255*t[1]<<8^255*t[2]<<0).toString(16)).slice(-6)},perlin:null,noise:function(t,e){null===Yd.perlin&&(Yd.perlin=new qd);var i,n,s=(e=e||{}).level||[1,.2,.05],r=e.frequency||[.016,.05,.2],a=0,o=0;for(i=0;i<s.length;i++)n=r[i],a+=s[i]*(.5+.5*Yd.perlin.noise3d(t.x*n,t.y*n,t.z*n)),o+=s[i];return a/=o},radArray(t){for(var e=[],i=0;i<3;i++)e[i]=t[i]*Yd.torad;return e},degArray(t){for(var e=[],i=0;i<3;i++)e[i]=t[i]*Yd.todeg;return e},angleDistance(t,e){var i=(t-e+180)%360-180;return i<-180?i+360:i}},qd=function(t){null==t&&(t=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var e=0;e<256;e++)this.p[e]=Math.floor(256*t.random());this.perm=[];for(e=0;e<512;e++)this.perm[e]=this.p[255&e];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};qd.prototype.dot=function(t,e,i){return t[0]*e+t[1]*i},qd.prototype.dot3=function(t,e,i,n){return t[0]*e+t[1]*i+t[2]*n},qd.prototype.dot4=function(t,e,i,n,s){return t[0]*e+t[1]*i+t[2]*n+t[3]*s},qd.prototype.noise=function(t,e){var i,n,s=(t+e)*(.5*(Math.sqrt(3)-1)),r=Math.floor(t+s),a=Math.floor(e+s),o=(3-Math.sqrt(3))/6,l=(r+a)*o,h=t-(r-l),c=e-(a-l);h>c?(i=1,n=0):(i=0,n=1);var u=h-i+o,d=c-n+o,p=h-1+2*o,m=c-1+2*o,f=255&r,g=255&a,v=this.perm[f+this.perm[g]]%12,x=this.perm[f+i+this.perm[g+n]]%12,y=this.perm[f+1+this.perm[g+1]]%12,b=.5-h*h-c*c,w=.5-u*u-d*d,_=.5-p*p-m*m;return 70*((b<0?0:(b*=b)*b*this.dot(this.grad3[v],h,c))+(w<0?0:(w*=w)*w*this.dot(this.grad3[x],u,d))+(_<0?0:(_*=_)*_*this.dot(this.grad3[y],p,m)))},qd.prototype.noise3d=function(t,e,i){var n,s,r,a,o,l,h=(t+e+i)*(1/3),c=Math.floor(t+h),u=Math.floor(e+h),d=Math.floor(i+h),p=1/6,m=(c+u+d)*p,f=t-(c-m),g=e-(u-m),v=i-(d-m);f>=g?g>=v?(n=1,s=0,r=0,a=1,o=1,l=0):f>=v?(n=1,s=0,r=0,a=1,o=0,l=1):(n=0,s=0,r=1,a=1,o=0,l=1):g<v?(n=0,s=0,r=1,a=0,o=1,l=1):f<v?(n=0,s=1,r=0,a=0,o=1,l=1):(n=0,s=1,r=0,a=1,o=1,l=0);var x=f-n+p,y=g-s+p,b=v-r+p,w=f-a+2*p,_=g-o+2*p,M=v-l+2*p,S=f-1+.5,T=g-1+.5,A=v-1+.5,E=255&c,L=255&u,C=255&d,P=this.perm[E+this.perm[L+this.perm[C]]]%12,R=this.perm[E+n+this.perm[L+s+this.perm[C+r]]]%12,F=this.perm[E+a+this.perm[L+o+this.perm[C+l]]]%12,I=this.perm[E+1+this.perm[L+1+this.perm[C+1]]]%12,D=.6-f*f-g*g-v*v,N=.6-x*x-y*y-b*b,k=.6-w*w-_*_-M*M,z=.6-S*S-T*T-A*A;return 32*((D<0?0:(D*=D)*D*this.dot3(this.grad3[P],f,g,v))+(N<0?0:(N*=N)*N*this.dot3(this.grad3[R],x,y,b))+(k<0?0:(k*=k)*k*this.dot3(this.grad3[F],w,_,M))+(z<0?0:(z*=z)*z*this.dot3(this.grad3[I],S,T,A)))},qd.prototype.noise4d=function(t,e,i,n){var s,r,a,o,l,h,c,u,d,p,m,f,g=this.grad4,v=this.simplex,x=this.perm,y=(Math.sqrt(5)-1)/4,b=(5-Math.sqrt(5))/20,w=(t+e+i+n)*y,_=Math.floor(t+w),M=Math.floor(e+w),S=Math.floor(i+w),T=Math.floor(n+w),A=(_+M+S+T)*b,E=t-(_-A),L=e-(M-A),C=i-(S-A),P=n-(T-A),R=(E>L?32:0)+(E>C?16:0)+(L>C?8:0)+(E>P?4:0)+(L>P?2:0)+(C>P?1:0),F=E-(s=v[R][0]>=3?1:0)+b,I=L-(r=v[R][1]>=3?1:0)+b,D=C-(a=v[R][2]>=3?1:0)+b,N=P-(o=v[R][3]>=3?1:0)+b,k=E-(l=v[R][0]>=2?1:0)+2*b,z=L-(h=v[R][1]>=2?1:0)+2*b,U=C-(c=v[R][2]>=2?1:0)+2*b,O=P-(u=v[R][3]>=2?1:0)+2*b,B=E-(d=v[R][0]>=1?1:0)+3*b,H=L-(p=v[R][1]>=1?1:0)+3*b,G=C-(m=v[R][2]>=1?1:0)+3*b,V=P-(f=v[R][3]>=1?1:0)+3*b,W=E-1+4*b,j=L-1+4*b,X=C-1+4*b,Y=P-1+4*b,q=255&_,Q=255&M,Z=255&S,J=255&T,K=x[q+x[Q+x[Z+x[J]]]]%32,$=x[q+s+x[Q+r+x[Z+a+x[J+o]]]]%32,tt=x[q+l+x[Q+h+x[Z+c+x[J+u]]]]%32,et=x[q+d+x[Q+p+x[Z+m+x[J+f]]]]%32,it=x[q+1+x[Q+1+x[Z+1+x[J+1]]]]%32,nt=.6-E*E-L*L-C*C-P*P,st=.6-F*F-I*I-D*D-N*N,rt=.6-k*k-z*z-U*U-O*O,at=.6-B*B-H*H-G*G-V*V,ot=.6-W*W-j*j-X*X-Y*Y;return 27*((nt<0?0:(nt*=nt)*nt*this.dot4(g[K],E,L,C,P))+(st<0?0:(st*=st)*st*this.dot4(g[$],F,I,D,N))+(rt<0?0:(rt*=rt)*rt*this.dot4(g[tt],k,z,U,O))+(at<0?0:(at*=at)*at*this.dot4(g[et],B,H,G,V))+(ot<0?0:(ot*=ot)*ot*this.dot4(g[it],W,j,X,Y)))};class Qd extends id{constructor(t,e,i){super(t,e),this.followTarget=null,this.camTween=[],this.isDecal=!1,this.isInDecal=!1,this.tmpP=new Wt,this.tmpQ=new Vt,this.cam={stiffness:.15,stiffnessTarget:1,theta:180,phi:20,distance:10,maxDistance:10,height:.6,v:new Wt,d:new Wt,tmp:new Wt,oldp:new Wt,oldq:new Vt,offset:new Wt,position:new Wt,decal:new Wt,multy:1,clipper:!0,forceFree:!1,simple:!1},this.reverse=!1,this.followGroup=i,this.tmpMatrix=new we,this.tmpE=new Re,this.tmpV=new Wt,this.info=this.getInfo(),this.isFree=!0,this.rayClipper=null,this.tmpV1=new Wt}upExtra(t){this.cam.distance*=t}startFollow(t,e){void 0!==e.d&&(e.distance=e.d),void 0!==e.h&&(e.theta=e.h),void 0!==e.v&&(e.phi=e.v);let i=this.cam;if(i.simple=void 0!==e.simple&&e.simple,i.stiffness=void 0!==e.stiffness?e.stiffness:.15,i.stiffnessTarget=void 0!==e.stiffnessTarget?e.stiffnessTarget:1,i.height=void 0!==e.height?e.height:.6,i.d.set(0,this.cam.height,0),i.theta=void 0!==e.theta?e.theta:180,i.phi=void 0!==e.phi?e.phi:20,i.distance=void 0!==e.distance?e.distance:10,i.maxDistance=i.distance,i.rotation=void 0===e.rotation||e.rotation,i.offset.set(0,0,0),i.decal.fromArray(void 0!==e.decal?e.decal:[0,0,0]),void 0!==e.dx&&(i.decal.x=e.dx),void 0!==e.dy&&(i.decal.y=e.dy),void 0!==e.dz&&(i.decal.z=e.dz),i.clipper=e.clipper||!1,i.exr=e.exr||0,i.forceFree=e.forceFree||!1,e.direct)return void this.initFollow(t,e);let n=this.getTargetStart(t);e.target=n.p,e.theta=Yd.unwrapDeg(e.theta+n.r);var s=e.callback;e.callback=function(){s&&s(),this.initFollow(t,e)}.bind(this),this.moveCam(e)}getTargetStart(t){t.updateMatrix(),this.tmpMatrix.makeRotationFromQuaternion(t.quaternion);let e=this.cam,i=Math.atan2(this.tmpMatrix.elements[8],this.tmpMatrix.elements[10]);return 0===e.decal.x&&0===e.decal.z||e.offset.copy(e.position).add(e.decal).applyAxisAngle({x:0,y:1,z:0},i),{p:e.tmp.copy(t.position).add(e.offset).add(e.d).toArray(),r:i*Yd.todeg}}initFollow(t,e){this.cam.oldp.copy(t.position),this.cam.oldq.copy(t.quaternion),this.stopMoveCam(),this.followTarget=t}onRayClipper(t){t.hit?this.cam.distance=Yd.clamp(t.distance,this.minDistance,this.cam.maxDistance):this.cam.distance<this.cam.maxDistance&&(this.cam.distance+=this.cam.maxDistance/16),this.maxDistance=this.cam.distance}resetAll(){this.stopMoveCam(),this.resetFov(),this.resetFollow(),this.setLimite(),this.reverse=!1}setLimite(t){t=t||{},this.minPolarAngle=void 0!==t.minV?(90-t.minV)*Yd.torad:0,this.maxPolarAngle=void 0!==t.maxV?(90-t.maxV)*Yd.torad:Math.PI,this.minAzimuthAngle=void 0!==t.minH?t.minH*Yd.torad:-1/0,this.maxAzimuthAngle=void 0!==t.maxH?t.maxH*Yd.torad:1/0,this.minDistance=void 0!==t.minD?t.minD:.01,this.maxDistance=void 0!==t.maxD?t.maxD:1/0}resetFov(){this.object.fov=50,this.object.zoom=1,this.object.updateProjectionMatrix()}resetFollow(){this.followGroup.position.set(0,0,0),this.followTarget=null,this.enabled=!0}follow(t){if(this.followTarget){var e=this.cam,i=this.object,n=this.target,s=this.getSpherical(),r=this.getState();if(this.tmpP.copy(this.followTarget.position),this.tmpQ.copy(this.followTarget.quaternion),e.simple)return n.copy(this.tmpP),i.position.setFromSpherical(s).add(n),i.lookAt(n),void this.updateFollowGroup();this.isFree=!1;var a=this.tmpP,o=this.tmpQ;this.tmpMatrix.makeRotationFromQuaternion(o);var l=Math.atan2(this.tmpMatrix.elements[8],this.tmpMatrix.elements[10]),h=a.distanceTo(e.oldp),c=o.x-e.oldq.x,u=o.y-e.oldq.y,d=o.z-e.oldq.z,p=o.w-e.oldq.w,m=Math.sqrt(c*c+u*u+d*d+p*p),f=e.theta*Yd.torad+l,g=(90-e.phi)*Yd.torad,v=e.distance;this.enabled?0===r||3===r||h<.01&&m<.001?this.isFree=!0:e.forceFree||s.set(v,g,f):s.set(v,g,f),this.tmpV.copy(e.decal).applyAxisAngle({x:1,y:0,z:0},g-Yd.PI90),e.offset.copy(e.position).add(this.tmpV).applyAxisAngle({x:0,y:1,z:0},l),e.v.copy(a).add(e.offset).add(e.d),e.tmp.setFromSpherical(s).add(e.v),this.reverse?(1!==e.stiffnessTarget?i.position.lerp(e.v,e.stiffnessTarget):i.position.copy(e.v),this.isDecal?n.copy(e.tmp):n.lerp(e.tmp,e.stiffness)):(this.isDecal?i.position.copy(e.tmp):i.position.lerp(e.tmp,e.stiffness),1!==e.stiffnessTarget?n.lerp(e.v,e.stiffnessTarget):n.copy(e.v)),i.lookAt(n),this.updateFollowGroup(),e.oldp.copy(a),e.oldq.copy(o),this.isInDecal&&(this.isDecal=!1,this.isInDecal=!1),this.isDecal&&(this.isInDecal=!0),this.cam.clipper&&(this.rayClipper.start.copy(a).add(e.offset).add(e.d),this.tmpV1.set(0,0,-1).applyQuaternion(i.quaternion).normalize().multiplyScalar(e.maxDistance),this.rayClipper.end.copy(this.rayClipper.start).sub(this.tmpV1))}}updateFollowGroup(){this.followGroup.position.set(this.target.x,0,this.target.z)}getInfo(){this.update();var t=this.target,e=this.object,i=this.getSpherical();return{x:t.x,y:t.y,z:t.z,distance:i.radius,phi:Yd.unwrapDeg(90-Math.floor(i.phi*Yd.todeg)),theta:Yd.unwrapDeg(Math.floor(i.theta*Yd.todeg)),fov:e.fov,zoom:e.zoom}}stopMoveCam(){for(var t=this.camTween.length;t--;)Mu(this.camTween[t]),this.camTween[t]=null;this.camTween=[],this.info=this.getInfo()}moveCam(t){this.followTarget&&this.resetFollow();var e=this;this.info=this.getInfo();var i={};void 0!==(t=t||{}).phi&&(i.phi=t.phi),void 0!==t.theta&&(i.theta=t.theta),void 0!==t.distance&&(i.distance=t.distance),void 0!==t.v&&(i.phi=t.v),void 0!==t.h&&(i.theta=t.h),void 0!==t.d&&(i.distance=t.d),void 0!==t.fov&&(i.fov=t.fov),void 0!==t.zoom&&(i.zoom=t.zoom),t.target&&(i.x=t.target[0],i.y=t.target[1],i.z=t.target[2]);var n=void 0===t.shortest||t.shortest;if(void 0!==i.theta&&n){var s=this.getSpherical().theta*Yd.todeg;i.theta=s+Yd.angleDistance(i.theta,s)}var r=void 0!==t.time?t.time:0,a=void 0!==t.tween?t.tween:fu.Quadratic.Out,o=void 0!==t.delay?t.delay:0;this.enabled=!1;var l=[];for(var h in i)l[h]=this.info[h];var c=t.callback||function(){};if(0===r){for(var h in i)l[h]=i[h];return this.stopMoveCam(),this.orbit(l),this.enabled=!0,void c()}var u=new wu(l).to(i,r).delay(o).easing(a).onUpdate((function(t){e.orbit(t)})).onComplete((function(){e.enabled=!0,c()})).start();this.camTween.push(u)}zommer(t,e,i){this.stopMoveCam();var n=this.cam,s=this.object,r={zoom:t.zoom,fov:t.fov,distance:t.distance,dx:void 0!==t.dx?t.dx:n.decal.x,dy:void 0!==t.dy?t.dy:n.decal.y,dz:void 0!==t.dz?t.dz:n.decal.z,exr:void 0!==t.exr?t.exr:n.exr,multy:void 0!==t.multy?t.multy:n.multy},a=new wu({zoom:s.zoom,fov:s.fov,distance:n.distance,dx:n.decal.x,dy:n.decal.y,dz:n.decal.z,exr:n.exr,multy:n.multy}).to(r,e||300).onUpdate((function(t){s.fov=t.fov,s.zoom=t.zoom,n.distance=t.distance,n.decal.x=t.dx,n.decal.y=t.dy,n.decal.z=t.dz,n.exr=t.exr,n.multy=t.multy,s.updateProjectionMatrix()})).onComplete((function(){i&&i()})).start();this.camTween.push(a)}orbit(t){var e=this.info;for(var i in t)e[i]=t[i];var n=this.object,s=this.target,r=this.getSpherical(),a=!1;n.fov!==e.fov&&(n.fov=e.fov,a=!0),n.zoom!==e.zoom&&(n.zoom=e.zoom,a=!0),a&&n.updateProjectionMatrix(),r.set(e.distance,(90-e.phi)*Yd.torad,e.theta*Yd.torad),r.makeSafe(),this.reverse?(n.position.set(e.x,e.y,e.z),s.setFromSpherical(r).add(n.position),n.lookAt(s)):(s.set(e.x,e.y,e.z),n.position.setFromSpherical(r).add(s),n.lookAt(s))}getDirection(){return Yd.tmpV.subVectors(this.target,this.object.position).normalize().toArray()}}class Zd extends fh{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new ep(t)})),this.register((function(t){return new ap(t)})),this.register((function(t){return new op(t)})),this.register((function(t){return new ip(t)})),this.register((function(t){return new np(t)})),this.register((function(t){return new sp(t)})),this.register((function(t){return new rp(t)})),this.register((function(t){return new $d(t)})),this.register((function(t){return new lp(t)}))}load(t,e,i,n){const s=this;let r;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:Gh.extractUrlBase(t),this.manager.itemStart(t);const a=function(e){n?n(e):console.error(e),s.manager.itemError(t),s.manager.itemEnd(t)},o=new vh(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(i){try{s.parse(i,r,(function(i){e(i),s.manager.itemEnd(t)}),a)}catch(t){a(t)}}),i,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,n){let s;const r={},a={};if("string"==typeof t)s=t;else{if(Gh.decodeText(new Uint8Array(t,0,4))===hp){try{r[Kd.KHR_BINARY_GLTF]=new dp(t)}catch(t){return void(n&&n(t))}s=r[Kd.KHR_BINARY_GLTF].content}else s=Gh.decodeText(new Uint8Array(t))}const o=JSON.parse(s);if(void 0===o.asset||o.asset.version[0]<2)return void(n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new jp(o,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let t=0;t<this.pluginCallbacks.length;t++){const e=this.pluginCallbacks[t](l);a[e.name]=e,r[e.name]=!0}if(o.extensionsUsed)for(let t=0;t<o.extensionsUsed.length;++t){const e=o.extensionsUsed[t],i=o.extensionsRequired||[];switch(e){case Kd.KHR_MATERIALS_UNLIT:r[e]=new tp;break;case Kd.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:r[e]=new gp;break;case Kd.KHR_DRACO_MESH_COMPRESSION:r[e]=new pp(o,this.dracoLoader);break;case Kd.KHR_TEXTURE_TRANSFORM:r[e]=new mp;break;case Kd.KHR_MESH_QUANTIZATION:r[e]=new vp;break;default:i.indexOf(e)>=0&&void 0===a[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(r),l.setPlugins(a),l.parse(i,n)}}function Jd(){let t={};return{get:function(e){return t[e]},add:function(e,i){t[e]=i},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const Kd={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class $d{constructor(t){this.parser=t,this.name=Kd.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let i=0,n=e.length;i<n;i++){const n=e[i];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&t._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(t){const e=this.parser,i="light:"+t;let n=e.cache.get(i);if(n)return n;const s=e.json,r=((s.extensions&&s.extensions[this.name]||{}).lights||[])[t];let a;const o=new di(16777215);void 0!==r.color&&o.fromArray(r.color);const l=void 0!==r.range?r.range:0;switch(r.type){case"directional":a=new kh(o),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new Dh(o),a.distance=l;break;case"spot":a=new Ch(o),a.distance=l,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,a.angle=r.spot.outerConeAngle,a.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return a.position.set(0,0,0),a.decay=2,void 0!==r.intensity&&(a.intensity=r.intensity),a.name=e.createUniqueName(r.name||"light_"+t),n=Promise.resolve(a),e.cache.add(i,n),n}createNodeAttachment(t){const e=this,i=this.parser,n=i.json.nodes[t],s=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===s?null:this._loadLight(s).then((function(t){return i._getNodeRef(e.cache,s,t)}))}}class tp{constructor(){this.name=Kd.KHR_MATERIALS_UNLIT}getMaterialType(){return pi}extendParams(t,e,i){const n=[];t.color=new di(1,1,1),t.opacity=1;const s=e.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;t.color.fromArray(e),t.opacity=e[3]}void 0!==s.baseColorTexture&&n.push(i.assignTexture(t,"map",s.baseColorTexture))}return Promise.all(n)}}class ep{constructor(t){this.parser=t,this.name=Kd.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Vl:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];if(void 0!==r.clearcoatFactor&&(e.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&s.push(i.assignTexture(e,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(e.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&s.push(i.assignTexture(e,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(s.push(i.assignTexture(e,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){const t=r.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Et(t,t)}return Promise.all(s)}}class ip{constructor(t){this.parser=t,this.name=Kd.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Vl:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return void 0!==r.transmissionFactor&&(e.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&s.push(i.assignTexture(e,"transmissionMap",r.transmissionTexture)),Promise.all(s)}}class np{constructor(t){this.parser=t,this.name=Kd.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Vl:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];e.thickness=void 0!==r.thicknessFactor?r.thicknessFactor:0,void 0!==r.thicknessTexture&&s.push(i.assignTexture(e,"thicknessMap",r.thicknessTexture)),e.attenuationDistance=r.attenuationDistance||0;const a=r.attenuationColor||[1,1,1];return e.attenuationTint=new di(a[0],a[1],a[2]),Promise.all(s)}}class sp{constructor(t){this.parser=t,this.name=Kd.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Vl:null}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name];return e.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class rp{constructor(t){this.parser=t,this.name=Kd.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Vl:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];e.specularIntensity=void 0!==r.specularFactor?r.specularFactor:1,void 0!==r.specularTexture&&s.push(i.assignTexture(e,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return e.specularTint=new di(a[0],a[1],a[2]),void 0!==r.specularColorTexture&&s.push(i.assignTexture(e,"specularTintMap",r.specularColorTexture).then((function(t){t.encoding=it}))),Promise.all(s)}}class ap{constructor(t){this.parser=t,this.name=Kd.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,i=e.json,n=i.textures[t];if(!n.extensions||!n.extensions[this.name])return null;const s=n.extensions[this.name],r=i.images[s.source],a=e.options.ktx2Loader;if(!a){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,r,a)}}class op{constructor(t){this.parser=t,this.name=Kd.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,n=i.json,s=n.textures[t];if(!s.extensions||!s.extensions[e])return null;const r=s.extensions[e],a=n.images[r.source];let o=i.textureLoader;if(a.uri){const t=i.options.manager.getHandler(a.uri);null!==t&&(o=t)}return this.detectSupport().then((function(s){if(s)return i.loadTextureImage(t,a,o);if(n.extensionsRequired&&n.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}class lp{constructor(t){this.name=Kd.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,i=e.bufferViews[t];if(i.extensions&&i.extensions[this.name]){const t=i.extensions[this.name],n=this.parser.getDependency("buffer",t.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([n,s.ready]).then((function(e){const i=t.byteOffset||0,n=t.byteLength||0,r=t.count,a=t.byteStride,o=new ArrayBuffer(r*a),l=new Uint8Array(e[0],i,n);return s.decodeGltfBuffer(new Uint8Array(o),r,a,l,t.mode,t.filter),o}))}return null}}const hp="glTF",cp=1313821514,up=5130562;class dp{constructor(t){this.name=Kd.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,12);if(this.header={magic:Gh.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==hp)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,n=new DataView(t,12);let s=0;for(;s<i;){const e=n.getUint32(s,!0);s+=4;const i=n.getUint32(s,!0);if(s+=4,i===cp){const i=new Uint8Array(t,12+s,e);this.content=Gh.decodeText(i)}else if(i===up){const i=12+s;this.body=t.slice(i,i+e)}s+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class pp{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Kd.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const i=this.json,n=this.dracoLoader,s=t.extensions[this.name].bufferView,r=t.extensions[this.name].attributes,a={},o={},l={};for(const t in r){const e=Fp[t]||t.toLowerCase();a[e]=r[t]}for(const e in t.attributes){const n=Fp[e]||e.toLowerCase();if(void 0!==r[e]){const s=i.accessors[t.attributes[e]],r=Lp[s.componentType];l[n]=r,o[n]=!0===s.normalized}}return e.getDependency("bufferView",s).then((function(t){return new Promise((function(e){n.decodeDracoFile(t,(function(t){for(const e in t.attributes){const i=t.attributes[e],n=o[e];void 0!==n&&(i.normalized=n)}e(t)}),a,l)}))}))}}class mp{constructor(){this.name=Kd.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===e.offset&&void 0===e.rotation&&void 0===e.scale||(t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class fp extends Gl{constructor(t){super(),this.isGLTFSpecularGlossinessMaterial=!0;const e=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),i=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),r=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),a={specular:{value:(new di).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(t){for(const e in a)t.uniforms[e]=a[e];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",r)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(t){a.specular.value=t}},specularMap:{get:function(){return a.specularMap.value},set:function(t){a.specularMap.value=t,t?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(t){a.glossiness.value=t}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(t){a.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class gp{constructor(){this.name=Kd.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return fp}extendParams(t,e,i){const n=e.extensions[this.name];t.color=new di(1,1,1),t.opacity=1;const s=[];if(Array.isArray(n.diffuseFactor)){const e=n.diffuseFactor;t.color.fromArray(e),t.opacity=e[3]}if(void 0!==n.diffuseTexture&&s.push(i.assignTexture(t,"map",n.diffuseTexture)),t.emissive=new di(0,0,0),t.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,t.specular=new di(1,1,1),Array.isArray(n.specularFactor)&&t.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){const e=n.specularGlossinessTexture;s.push(i.assignTexture(t,"glossinessMap",e)),s.push(i.assignTexture(t,"specularMap",e))}return Promise.all(s)}createMaterial(t){const e=new fp(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=0,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}}class vp{constructor(){this.name=Kd.KHR_MESH_QUANTIZATION}}class xp extends Kl{constructor(t,e,i,n){super(t,e,i,n)}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=t*n*3+n;for(let t=0;t!==n;t++)e[t]=i[s+t];return e}}xp.prototype.beforeStart_=xp.prototype.copySampleValue_,xp.prototype.afterEnd_=xp.prototype.copySampleValue_,xp.prototype.interpolate_=function(t,e,i,n){const s=this.resultBuffer,r=this.sampleValues,a=this.valueSize,o=2*a,l=3*a,h=n-e,c=(i-e)/h,u=c*c,d=u*c,p=t*l,m=p-l,f=-2*d+3*u,g=d-u,v=1-f,x=g-u+c;for(let t=0;t!==a;t++){const e=r[m+t+a],i=r[m+t+o]*h,n=r[p+t+a],l=r[p+t]*h;s[t]=v*e+x*i+f*n+g*l}return s};const yp=new Vt;class bp extends xp{interpolate_(t,e,i,n){const s=super.interpolate_(t,e,i,n);return yp.fromArray(s).normalize().toArray(s),s}}const wp=0,_p=1,Mp=2,Sp=3,Tp=4,Ap=5,Ep=6,Lp={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Cp={9728:b,9729:M,9984:w,9985:S,9986:_,9987:T},Pp={33071:x,33648:y,10497:v},Rp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Fp={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ip={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Dp={CUBICSPLINE:void 0,LINEAR:q,STEP:Y},Np="OPAQUE",kp="MASK",zp="BLEND";function Up(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}function Op(t,e,i){for(const n in i.extensions)void 0===t[n]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=i.extensions[n])}function Bp(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Hp(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let i=0,n=e.weights.length;i<n;i++)t.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(t.morphTargetInfluences.length===i.length){t.morphTargetDictionary={};for(let e=0,n=i.length;e<n;e++)t.morphTargetDictionary[i[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Gp(t){const e=t.extensions&&t.extensions[Kd.KHR_DRACO_MESH_COMPRESSION];let i;return i=e?"draco:"+e.bufferView+":"+e.indices+":"+Vp(e.attributes):t.indices+":"+Vp(t.attributes)+":"+t.mode,i}function Vp(t){let e="";const i=Object.keys(t).sort();for(let n=0,s=i.length;n<s;n++)e+=i[n]+":"+t[i[n]]+";";return e}function Wp(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class jp{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new Jd,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new qh(this.options.manager):this.textureLoader=new wh(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new vh(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const i=this,n=this.json,s=this.extensions;this.cache.removeAll(),this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all(this._invokeAll((function(t){return t.beforeRoot&&t.beforeRoot()}))).then((function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])})).then((function(e){const r={scene:e[0][n.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:n.asset,parser:i,userData:{}};Op(s,r,n),Bp(r,n),Promise.all(i._invokeAll((function(t){return t.afterRoot&&t.afterRoot(r)}))).then((function(){t(r)}))})).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let i=0,n=e.length;i<n;i++){const n=e[i].joints;for(let e=0,i=n.length;e<i;e++)t[n[e]].isBone=!0}for(let e=0,n=t.length;e<n;e++){const n=t[e];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(i[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,i){if(t.refs[e]<=1)return i;const n=i.clone(),s=(t,e)=>{const i=this.associations.get(t);null!=i&&this.associations.set(e,i);for(const[i,n]of t.children.entries())s(n,e.children[i])};return s(i,n),n.name+="_instance_"+t.uses[e]++,n}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const n=t(e[i]);if(n)return n}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let n=0;n<e.length;n++){const s=t(e[n]);s&&i.push(s)}return i}getDependency(t,e){const i=t+":"+e;let n=this.cache.get(i);if(!n){switch(t){case"scene":n=this.loadScene(e);break;case"node":n=this.loadNode(e);break;case"mesh":n=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":n=this.loadAccessor(e);break;case"bufferView":n=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":n=this.loadBuffer(e);break;case"material":n=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":n=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":n=this.loadSkin(e);break;case"animation":n=this.loadAnimation(e);break;case"camera":n=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(i,n)}return n}getDependencies(t){let e=this.cache.get(t);if(!e){const i=this,n=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(n.map((function(e,n){return i.getDependency(t,n)}))),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],i=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[Kd.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(t,s){i.load(Up(e.uri,n.path),t,void 0,(function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){const i=e.byteLength||0,n=e.byteOffset||0;return t.slice(n,n+i)}))}loadAccessor(t){const e=this,i=this.json,n=this.json.accessors[t];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);const s=[];return void 0!==n.bufferView?s.push(this.getDependency("bufferView",n.bufferView)):s.push(null),void 0!==n.sparse&&(s.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(s).then((function(t){const s=t[0],r=Rp[n.type],a=Lp[n.componentType],o=a.BYTES_PER_ELEMENT,l=o*r,h=n.byteOffset||0,c=void 0!==n.bufferView?i.bufferViews[n.bufferView].byteStride:void 0,u=!0===n.normalized;let d,p;if(c&&c!==l){const t=Math.floor(h/c),i="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+t+":"+n.count;let l=e.cache.get(i);l||(d=new a(s,t*c,n.count*c/o),l=new ua(d,c/o),e.cache.add(i,l)),p=new pa(l,r,h%c/o,u)}else d=null===s?new a(n.count*r):new a(s,h,n.count*r),p=new gi(d,r,u);if(void 0!==n.sparse){const e=Rp.SCALAR,i=Lp[n.sparse.indices.componentType],o=n.sparse.indices.byteOffset||0,l=n.sparse.values.byteOffset||0,h=new i(t[1],o,n.sparse.count*e),c=new a(t[2],l,n.sparse.count*r);null!==s&&(p=new gi(p.array.slice(),p.itemSize,p.normalized));for(let t=0,e=h.length;t<e;t++){const e=h[t];if(p.setX(e,c[t*r]),r>=2&&p.setY(e,c[t*r+1]),r>=3&&p.setZ(e,c[t*r+2]),r>=4&&p.setW(e,c[t*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(t){const e=this.json,i=this.options,n=e.textures[t],s=e.images[n.source];let r=this.textureLoader;if(s.uri){const t=i.manager.getHandler(s.uri);null!==t&&(r=t)}return this.loadTextureImage(t,s,r)}loadTextureImage(t,e,i){const n=this,s=this.json,r=this.options,a=s.textures[t],o=(e.uri||e.bufferView)+":"+a.sampler;if(this.textureCache[o])return this.textureCache[o];const l=self.URL||self.webkitURL;let h=e.uri||"",c=!1;if(void 0!==e.bufferView)h=n.getDependency("bufferView",e.bufferView).then((function(t){c=!0;const i=new Blob([t],{type:e.mimeType});return h=l.createObjectURL(i),h}));else if(void 0===e.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const u=Promise.resolve(h).then((function(t){return new Promise((function(e,n){let s=e;!0===i.isImageBitmapLoader&&(s=function(t){const i=new zt(t);i.needsUpdate=!0,e(i)}),i.load(Up(t,r.path),s,void 0,n)}))})).then((function(e){!0===c&&l.revokeObjectURL(h),e.flipY=!1,a.name&&(e.name=a.name);const i=(s.samplers||{})[a.sampler]||{};return e.magFilter=Cp[i.magFilter]||M,e.minFilter=Cp[i.minFilter]||T,e.wrapS=Pp[i.wrapS]||v,e.wrapT=Pp[i.wrapT]||v,n.associations.set(e,{textures:t}),e})).catch((function(){return console.error("THREE.GLTFLoader: Couldn't load texture",h),null}));return this.textureCache[o]=u,u}assignTexture(t,e,i){const n=this;return this.getDependency("texture",i.index).then((function(s){if(void 0===i.texCoord||0==i.texCoord||"aoMap"===e&&1==i.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+e+" not yet supported."),n.extensions[Kd.KHR_TEXTURE_TRANSFORM]){const t=void 0!==i.extensions?i.extensions[Kd.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const e=n.associations.get(s);s=n.extensions[Kd.KHR_TEXTURE_TRANSFORM].extendTexture(s,t),n.associations.set(s,e)}}return t[e]=s,s}))}assignFinalMaterial(t){const e=t.geometry;let i=t.material;const n=void 0===e.attributes.tangent,s=void 0!==e.attributes.color,r=void 0===e.attributes.normal;if(t.isPoints){const t="PointsMaterial:"+i.uuid;let e=this.cache.get(t);e||(e=new oo,ri.prototype.copy.call(e,i),e.color.copy(i.color),e.map=i.map,e.sizeAttenuation=!1,this.cache.add(t,e)),i=e}else if(t.isLine){const t="LineBasicMaterial:"+i.uuid;let e=this.cache.get(t);e||(e=new Za,ri.prototype.copy.call(e,i),e.color.copy(i.color),this.cache.add(t,e)),i=e}if(n||s||r){let t="ClonedMaterial:"+i.uuid+":";i.isGLTFSpecularGlossinessMaterial&&(t+="specular-glossiness:"),n&&(t+="derivative-tangents:"),s&&(t+="vertex-colors:"),r&&(t+="flat-shading:");let e=this.cache.get(t);e||(e=i.clone(),s&&(e.vertexColors=!0),r&&(e.flatShading=!0),n&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(i))),i=e}i.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),t.material=i}getMaterialType(){return Gl}loadMaterial(t){const e=this,i=this.json,n=this.extensions,s=i.materials[t];let r;const a={},o=s.extensions||{},l=[];if(o[Kd.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const t=n[Kd.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=t.getMaterialType(),l.push(t.extendParams(a,s,e))}else if(o[Kd.KHR_MATERIALS_UNLIT]){const t=n[Kd.KHR_MATERIALS_UNLIT];r=t.getMaterialType(),l.push(t.extendParams(a,s,e))}else{const i=s.pbrMetallicRoughness||{};if(a.color=new di(1,1,1),a.opacity=1,Array.isArray(i.baseColorFactor)){const t=i.baseColorFactor;a.color.fromArray(t),a.opacity=t[3]}void 0!==i.baseColorTexture&&l.push(e.assignTexture(a,"map",i.baseColorTexture)),a.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,a.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(l.push(e.assignTexture(a,"metalnessMap",i.metallicRoughnessTexture)),l.push(e.assignTexture(a,"roughnessMap",i.metallicRoughnessTexture))),r=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),l.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,a)}))))}!0===s.doubleSided&&(a.side=2);const h=s.alphaMode||Np;if(h===zp?(a.transparent=!0,a.depthWrite=!1):(a.format=F,a.transparent=!1,h===kp&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&r!==pi&&(l.push(e.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new Et(1,1),void 0!==s.normalTexture.scale)){const t=s.normalTexture.scale;a.normalScale.set(t,t)}return void 0!==s.occlusionTexture&&r!==pi&&(l.push(e.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&r!==pi&&(a.emissive=(new di).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&r!==pi&&l.push(e.assignTexture(a,"emissiveMap",s.emissiveTexture)),Promise.all(l).then((function(){let i;return i=r===fp?n[Kd.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new r(a),s.name&&(i.name=s.name),i.map&&(i.map.encoding=it),i.emissiveMap&&(i.emissiveMap.encoding=it),Bp(i,s),e.associations.set(i,{materials:t}),s.extensions&&Op(n,i,s),i}))}createUniqueName(t){const e=Tc.sanitizeNodeName(t||"");let i=e;for(let t=1;this.nodeNamesUsed[i];++t)i=e+"_"+t;return this.nodeNamesUsed[i]=!0,i}loadGeometries(t){const e=this,i=this.extensions,n=this.primitiveCache;function s(t){return i[Kd.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(i){return Yp(i,t,e)}))}const r=[];for(let i=0,a=t.length;i<a;i++){const a=t[i],o=Gp(a),l=n[o];if(l)r.push(l.promise);else{let t;t=a.extensions&&a.extensions[Kd.KHR_DRACO_MESH_COMPRESSION]?s(a):Yp(new Di,a,e),n[o]={primitive:a,promise:t},r.push(t)}}return Promise.all(r)}loadMesh(t){const e=this,i=this.json,n=this.extensions,s=i.meshes[t],r=s.primitives,a=[];for(let t=0,e=r.length;t<e;t++){const e=void 0===r[t].material?(void 0===(o=this.cache).DefaultMaterial&&(o.DefaultMaterial=new Gl({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),o.DefaultMaterial):this.getDependency("material",r[t].material);a.push(e)}var o;return a.push(e.loadGeometries(r)),Promise.all(a).then((function(i){const a=i.slice(0,i.length-1),o=i[i.length-1],l=[];for(let i=0,h=o.length;i<h;i++){const h=o[i],c=r[i];let u;const d=a[i];if(c.mode===Tp||c.mode===Ap||c.mode===Ep||void 0===c.mode)u=!0===s.isSkinnedMesh?new Ua(h,d):new Ki(h,d),!0!==u.isSkinnedMesh||u.geometry.attributes.skinWeight.normalized||u.normalizeSkinWeights(),c.mode===Ap?u.geometry=qp(u.geometry,1):c.mode===Ep&&(u.geometry=qp(u.geometry,2));else if(c.mode===_p)u=new ro(h,d);else if(c.mode===Sp)u=new io(h,d);else if(c.mode===Mp)u=new ao(h,d);else{if(c.mode!==wp)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);u=new po(h,d)}Object.keys(u.geometry.morphAttributes).length>0&&Hp(u,s),u.name=e.createUniqueName(s.name||"mesh_"+t),Bp(u,s),c.extensions&&Op(n,u,c),e.assignFinalMaterial(u),l.push(u)}for(let i=0,n=l.length;i<n;i++)e.associations.set(l[i],{meshes:t,primitives:i});if(1===l.length)return l[0];const h=new ea;e.associations.set(h,{meshes:t});for(let t=0,e=l.length;t<e;t++)h.add(l[t]);return h}))}loadCamera(t){let e;const i=this.json.cameras[t],n=i[i.type];if(n)return"perspective"===i.type?e=new on(At.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===i.type&&(e=new Rn(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),Bp(e,i),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(t){const e=this.json.skins[t],i={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(i):this.getDependency("accessor",e.inverseBindMatrices).then((function(t){return i.inverseBindMatrices=t,i}))}loadAnimation(t){const e=this.json.animations[t],i=[],n=[],s=[],r=[],a=[];for(let t=0,o=e.channels.length;t<o;t++){const o=e.channels[t],l=e.samplers[o.sampler],h=o.target,c=void 0!==h.node?h.node:h.id,u=void 0!==e.parameters?e.parameters[l.input]:l.input,d=void 0!==e.parameters?e.parameters[l.output]:l.output;i.push(this.getDependency("node",c)),n.push(this.getDependency("accessor",u)),s.push(this.getDependency("accessor",d)),r.push(l),a.push(h)}return Promise.all([Promise.all(i),Promise.all(n),Promise.all(s),Promise.all(r),Promise.all(a)]).then((function(i){const n=i[0],s=i[1],r=i[2],a=i[3],o=i[4],l=[];for(let t=0,e=n.length;t<e;t++){const e=n[t],i=s[t],h=r[t],c=a[t],u=o[t];if(void 0===e)continue;let d;switch(e.updateMatrix(),e.matrixAutoUpdate=!0,Ip[u.path]){case Ip.weights:d=rh;break;case Ip.rotation:d=oh;break;case Ip.position:case Ip.scale:default:d=hh}const p=e.name?e.name:e.uuid,m=void 0!==c.interpolation?Dp[c.interpolation]:q,f=[];Ip[u.path]===Ip.weights?e.traverse((function(t){!0===t.isMesh&&t.morphTargetInfluences&&f.push(t.name?t.name:t.uuid)})):f.push(p);let g=h.array;if(h.normalized){const t=Wp(g.constructor),e=new Float32Array(g.length);for(let i=0,n=g.length;i<n;i++)e[i]=g[i]*t;g=e}for(let t=0,e=f.length;t<e;t++){const e=new d(f[t]+"."+Ip[u.path],i.array,g,m);"CUBICSPLINE"===c.interpolation&&(e.createInterpolant=function(t){return new(this instanceof oh?bp:xp)(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(e)}}const h=e.name?e.name:"animation_"+t;return new ch(h,void 0,l)}))}createNodeMesh(t){const e=this.json,i=this,n=e.nodes[t];return void 0===n.mesh?null:i.getDependency("mesh",n.mesh).then((function(t){const e=i._getNodeRef(i.meshCache,n.mesh,t);return void 0!==n.weights&&e.traverse((function(t){if(t.isMesh)for(let e=0,i=n.weights.length;e<i;e++)t.morphTargetInfluences[e]=n.weights[e]})),e}))}loadNode(t){const e=this.json,i=this.extensions,n=this,s=e.nodes[t],r=s.name?n.createUniqueName(s.name):"";return function(){const e=[],i=n._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)}));return i&&e.push(i),void 0!==s.camera&&e.push(n.getDependency("camera",s.camera).then((function(t){return n._getNodeRef(n.cameraCache,s.camera,t)}))),n._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){e.push(t)})),Promise.all(e)}().then((function(e){let a;if(a=!0===s.isBone?new Oa:e.length>1?new ea:1===e.length?e[0]:new Xe,a!==e[0])for(let t=0,i=e.length;t<i;t++)a.add(e[t]);if(s.name&&(a.userData.name=s.name,a.name=r),Bp(a,s),s.extensions&&Op(i,a,s),void 0!==s.matrix){const t=new we;t.fromArray(s.matrix),a.applyMatrix4(t)}else void 0!==s.translation&&a.position.fromArray(s.translation),void 0!==s.rotation&&a.quaternion.fromArray(s.rotation),void 0!==s.scale&&a.scale.fromArray(s.scale);return n.associations.has(a)||n.associations.set(a,{}),n.associations.get(a).nodes=t,a}))}loadScene(t){const e=this.json,i=this.extensions,n=this.json.scenes[t],s=this,r=new ea;n.name&&(r.name=s.createUniqueName(n.name)),Bp(r,n),n.extensions&&Op(i,r,n);const a=n.nodes||[],o=[];for(let t=0,i=a.length;t<i;t++)o.push(Xp(a[t],r,e,s));return Promise.all(o).then((function(){return s.associations=(t=>{const e=new Map;for(const[t,i]of s.associations)(t instanceof ri||t instanceof zt)&&e.set(t,i);return t.traverse((t=>{const i=s.associations.get(t);null!=i&&e.set(t,i)})),e})(r),r}))}}function Xp(t,e,i,n){const s=i.nodes[t];return n.getDependency("node",t).then((function(t){if(void 0===s.skin)return t;let e;return n.getDependency("skin",s.skin).then((function(t){e=t;const i=[];for(let t=0,s=e.joints.length;t<s;t++)i.push(n.getDependency("node",e.joints[t]));return Promise.all(i)})).then((function(i){return t.traverse((function(t){if(!t.isMesh)return;const n=[],s=[];for(let t=0,r=i.length;t<r;t++){const r=i[t];if(r){n.push(r);const i=new we;void 0!==e.inverseBindMatrices&&i.fromArray(e.inverseBindMatrices.array,16*t),s.push(i)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[t])}t.bind(new Va(n,s),t.matrixWorld)})),t}))})).then((function(t){e.add(t);const r=[];if(s.children){const e=s.children;for(let s=0,a=e.length;s<a;s++){const a=e[s];r.push(Xp(a,t,i,n))}}return Promise.all(r)}))}function Yp(t,e,i){const n=e.attributes,s=[];function r(e,n){return i.getDependency("accessor",e).then((function(e){t.setAttribute(n,e)}))}for(const e in n){const i=Fp[e]||e.toLowerCase();i in t.attributes||s.push(r(n[e],i))}if(void 0!==e.indices&&!t.index){const n=i.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));s.push(n)}return Bp(t,e),function(t,e,i){const n=e.attributes,s=new Yt;if(void 0===n.POSITION)return;{const t=i.json.accessors[n.POSITION],e=t.min,r=t.max;if(void 0===e||void 0===r)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(s.set(new Wt(e[0],e[1],e[2]),new Wt(r[0],r[1],r[2])),t.normalized){const e=Wp(Lp[t.componentType]);s.min.multiplyScalar(e),s.max.multiplyScalar(e)}}const r=e.targets;if(void 0!==r){const t=new Wt,e=new Wt;for(let n=0,s=r.length;n<s;n++){const s=r[n];if(void 0!==s.POSITION){const n=i.json.accessors[s.POSITION],r=n.min,a=n.max;if(void 0!==r&&void 0!==a){if(e.setX(Math.max(Math.abs(r[0]),Math.abs(a[0]))),e.setY(Math.max(Math.abs(r[1]),Math.abs(a[1]))),e.setZ(Math.max(Math.abs(r[2]),Math.abs(a[2]))),n.normalized){const t=Wp(Lp[n.componentType]);e.multiplyScalar(t)}t.max(e)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(t)}t.boundingBox=s;const a=new de;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,t.boundingSphere=a}(t,e,i),Promise.all(s).then((function(){return void 0!==e.targets?function(t,e,i){let n=!1,s=!1;for(let t=0,i=e.length;t<i;t++){const i=e[t];if(void 0!==i.POSITION&&(n=!0),void 0!==i.NORMAL&&(s=!0),n&&s)break}if(!n&&!s)return Promise.resolve(t);const r=[],a=[];for(let o=0,l=e.length;o<l;o++){const l=e[o];if(n){const e=void 0!==l.POSITION?i.getDependency("accessor",l.POSITION):t.attributes.position;r.push(e)}if(s){const e=void 0!==l.NORMAL?i.getDependency("accessor",l.NORMAL):t.attributes.normal;a.push(e)}}return Promise.all([Promise.all(r),Promise.all(a)]).then((function(e){const i=e[0],r=e[1];return n&&(t.morphAttributes.position=i),s&&(t.morphAttributes.normal=r),t.morphTargetsRelative=!0,t}))}(t,e.targets,i):t}))}function qp(t,e){let i=t.getIndex();if(null===i){const e=[],n=t.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<n.count;t++)e.push(t);t.setIndex(e),i=t.getIndex()}const n=i.count-2,s=[];if(2===e)for(let t=1;t<=n;t++)s.push(i.getX(0)),s.push(i.getX(t)),s.push(i.getX(t+1));else for(let t=0;t<n;t++)t%2==0?(s.push(i.getX(t)),s.push(i.getX(t+1)),s.push(i.getX(t+2))):(s.push(i.getX(t+2)),s.push(i.getX(t+1)),s.push(i.getX(t)));s.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=t.clone();return r.setIndex(s),r}const Qp=new WeakMap;class Zp extends fh{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,e,i,n){const s=new vh(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(t=>{const i={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(t,i).then(e).catch(n)}),i,n)}decodeDracoFile(t,e,i,n){const s={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i};this.decodeGeometry(t,s).then(e)}decodeGeometry(t,e){for(const t in e.attributeTypes){const i=e.attributeTypes[t];void 0!==i.BYTES_PER_ELEMENT&&(e.attributeTypes[t]=i.name)}const i=JSON.stringify(e);if(Qp.has(t)){const e=Qp.get(t);if(e.key===i)return e.promise;if(0===t.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const s=this.workerNextTaskID++,r=t.byteLength,a=this._getWorker(s,r).then((i=>(n=i,new Promise(((i,r)=>{n._callbacks[s]={resolve:i,reject:r},n.postMessage({type:"decode",id:s,taskConfig:e,buffer:t},[t])}))))).then((t=>this._createGeometry(t.geometry)));return a.catch((()=>!0)).then((()=>{n&&s&&this._releaseTask(n,s)})),Qp.set(t,{key:i,promise:a}),a}_createGeometry(t){const e=new Di;t.index&&e.setIndex(new gi(t.index.array,1));for(let i=0;i<t.attributes.length;i++){const n=t.attributes[i],s=n.name,r=n.array,a=n.itemSize;e.setAttribute(s,new gi(r,a))}return e}_loadLibrary(t,e){const i=new vh(this.manager);return i.setPath(this.decoderPath),i.setResponseType(e),i.setWithCredentials(this.withCredentials),new Promise(((e,n)=>{i.load(t,e,void 0,n)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then((e=>{const i=e[0];t||(this.decoderConfig.wasmBinary=e[1]);const n=Jp.toString(),s=["/* draco decoder */",i,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([s]))})),this.decoderPending}_getWorker(t,e){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const t=new Worker(this.workerSourceURL);t._callbacks={},t._taskCosts={},t._taskLoad=0,t.postMessage({type:"init",decoderConfig:this.decoderConfig}),t.onmessage=function(e){const i=e.data;switch(i.type){case"decode":t._callbacks[i.id].resolve(i);break;case"error":t._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(t)}else this.workerPool.sort((function(t,e){return t._taskLoad>e._taskLoad?-1:1}));const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[t]=e,i._taskLoad+=e,i}))}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map((t=>t._taskLoad)))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}}function Jp(){let t,e;function i(t,e,i,n,s,r){const a=r.num_components(),o=i.num_points()*a,l=o*s.BYTES_PER_ELEMENT,h=function(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32}}(t,s),c=t._malloc(l);e.GetAttributeDataArrayForAllPoints(i,r,h,l,c);const u=new s(t.HEAPF32.buffer,c,o).slice();return t._free(c),{name:n,array:u,itemSize:a}}onmessage=function(n){const s=n.data;switch(s.type){case"init":t=s.decoderConfig,e=new Promise((function(e){t.onModuleLoaded=function(t){e({draco:t})},DracoDecoderModule(t)}));break;case"decode":const n=s.buffer,r=s.taskConfig;e.then((t=>{const e=t.draco,a=new e.Decoder,o=new e.DecoderBuffer;o.Init(new Int8Array(n),n.byteLength);try{const t=function(t,e,n,s){const r=s.attributeIDs,a=s.attributeTypes;let o,l;const h=e.GetEncodedGeometryType(n);if(h===t.TRIANGULAR_MESH)o=new t.Mesh,l=e.DecodeBufferToMesh(n,o);else{if(h!==t.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new t.PointCloud,l=e.DecodeBufferToPointCloud(n,o)}if(!l.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const c={index:null,attributes:[]};for(const n in r){const l=self[a[n]];let h,u;if(s.useUniqueIDs)u=r[n],h=e.GetAttributeByUniqueId(o,u);else{if(u=e.GetAttributeId(o,t[r[n]]),-1===u)continue;h=e.GetAttribute(o,u)}c.attributes.push(i(t,e,o,n,l,h))}h===t.TRIANGULAR_MESH&&(c.index=function(t,e,i){const n=3*i.num_faces(),s=4*n,r=t._malloc(s);e.GetTrianglesUInt32Array(i,s,r);const a=new Uint32Array(t.HEAPF32.buffer,r,n).slice();return t._free(r),{array:a,itemSize:1}}(t,e,o));return t.destroy(o),c}(e,a,o,r),n=t.attributes.map((t=>t.array.buffer));t.index&&n.push(t.index.array.buffer),self.postMessage({type:"decode",id:s.id,geometry:t},n)}catch(t){console.error(t),self.postMessage({type:"error",id:s.id,error:t.message})}finally{e.destroy(o),e.destroy(a)}}))}}}var Kp=function(){var t,e=0x10000000000000000,i=4294967295,n=2147483647,s=2147483648,r=16777216;function a(t){var e=[];return e[t-1]=void 0,e}function o(t,e){return h(t[0]+e[0],t[1]+e[1])}function l(t,e){var i,n;return t[0]==e[0]&&t[1]==e[1]?0:(i=0>t[1],n=0>e[1],i&&!n?-1:!i&&n?1:function(t,e){return h(t[0]-e[0],t[1]-e[1])}(t,e)[1]<0?-1:1)}function h(t,n){var s,r;for(t%=e,n=(n%=e)-(s=n%U)+(r=Math.floor(t/U)*U),t=t-r+s;0>t;)t+=U,n-=U;for(;t>i;)t-=U,n+=U;for(n%=e;n>0x7fffffff00000000;)n-=e;for(;-e>n;)n+=e;return[t,n]}function c(t){return t>=0?[t,0]:[t+U,-U]}function u(t){return t[0]>=s?~~Math.max(Math.min(t[0]-U,n),-s):~~Math.max(Math.min(t[0],n),-s)}function d(t){return t.cb>=t.O?-1:255&t.ab[t.cb++]}function p(t){var e=t.ab;return e.length=t.O,e}function m(t,e,n){var s,r,a,o,l="",h=[];for(r=0;5>r;++r){if(-1==(a=d(e)))throw Error("truncated input");h[r]=a<<24>>24}if(!function(t,e){var i,n,s,r,a,o,l;if(5>e.length)return 0;for(l=255&e[0],s=l%9,r=(o=~~(l/9))%5,a=~~(o/5),i=0,n=0;4>n;++n)i+=(255&e[1+n])<<8*n;return i>99999999||!function(t,e,i,n){if(e>8||i>4||n>4)return 0;A(t.k,i,e);var s=1<<n;return _(t.C,s),_(t.o,s),t.P=s-1,1}(t,s,r,a)?0:function(t,e){return 0>e?0:(t.z!=e&&(t.z=e,t.m=Math.max(t.z,1),g(t.b,Math.max(t.m,4096))),1)}(t,i)}(s=w({}),h))throw Error("corrupted input");for(r=0;64>r;r+=8){if(-1==(a=d(e)))throw Error("truncated input");1==(a=a.toString(16)).length&&(a="0"+a),l=a+""+l}/^0+$|^f+$/i.test(l)?t.N=O:(o=parseInt(l,16),t.N=o>i?O:c(o)),t.Q=function(t,e,i,n){return t.a.K=e,y(t.b),t.b.V=i,function(t){t.b.w=0,t.b.D=0,F(t.q),F(t.n),F(t.E),F(t.s),F(t.u),F(t.r),F(t.J),function(t){var e,i;for(i=1<<t.g+t.y,e=0;i>e;++e)F(t.F[e].v)}(t.k);for(var e=0;4>e;++e)F(t.j[e].B);T(t.C),T(t.o),F(t.t.B),function(t){t.p=0,t.i=-1;for(var e=0;5>e;++e)t.p=t.p<<8|d(t.K)}(t.a)}(t),t.f=0,t.l=0,t.T=0,t.R=0,t._=0,t.U=n,t.d=B,t.I=0,function(t,e){return t.h=e,t.bb=null,t.X=1,t}({},t)}(s,e,n,t.N)}function f(t,e){return t.S=function(t){return t.ab=a(32),t.O=0,t}({}),m(t,function(t,e){return t.ab=e,t.cb=0,t.O=e.length,t}({},e),t.S),t}function g(t,e){(null==t.x||t.c!=e)&&(t.x=a(e)),t.c=e,t.D=0,t.w=0}function v(t){var e=t.D-t.w;e&&(function(t,e,i,n){(function(t,e,i,n,s){for(var r=0;s>r;++r)i[n+r]=t[e+r]})(e,i,t.ab,t.O,n),t.O+=n}(t.V,t.x,t.w,e),t.D>=t.c&&(t.D=0),t.w=t.D)}function x(t,e){var i=t.D-e-1;return 0>i&&(i+=t.c),t.x[i]}function y(t){v(t),t.V=null}function b(t){if(!t.X)throw Error("bad state");if(t.bb)throw Error("No encoding");return function(t){var e=function(t){var e,i,n,s,r,a;if(a=u(t.d)&t.P,P(t.a,t.q,(t.f<<4)+a)){if(P(t.a,t.E,t.f))n=0,P(t.a,t.s,t.f)?(P(t.a,t.u,t.f)?(P(t.a,t.r,t.f)?(i=t._,t._=t.R):i=t.R,t.R=t.T):i=t.T,t.T=t.l,t.l=i):P(t.a,t.n,(t.f<<4)+a)||(t.f=7>t.f?9:11,n=1),n||(n=M(t.o,t.a,a)+2,t.f=7>t.f?8:11);else if(t._=t.R,t.R=t.T,t.T=t.l,n=2+M(t.C,t.a,a),t.f=7>t.f?7:10,(r=C(t.j[function(t){return 4>(t-=2)?t:3}(n)],t.a))>=4){if(s=(r>>1)-1,t.l=(2|1&r)<<s,14>r)t.l+=function(t,e,i,n){var s,r,a=1,o=0;for(r=0;n>r;++r)s=P(i,t,e+a),a<<=1,a+=s,o|=s<<r;return o}(t.J,t.l-r-1,t.a,s);else if(t.l+=R(t.a,s-4)<<4,t.l+=function(t,e){var i,n,s=1,r=0;for(n=0;t.A>n;++n)i=P(e,t.B,s),s<<=1,s+=i,r|=i<<n;return r}(t.t,t.a),0>t.l)return-1==t.l?1:-1}else t.l=r;if(l(c(t.l),t.d)>=0||t.l>=t.m)return-1;(function(t,e,i){var n=t.D-e-1;for(0>n&&(n+=t.c);0!=i;--i)n>=t.c&&(n=0),t.x[t.D++]=t.x[n++],t.D>=t.c&&v(t)})(t.b,t.l,n),t.d=o(t.d,c(n)),t.I=x(t.b,0)}else e=function(t,e,i){return t.F[((e&t.Y)<<t.g)+((255&i)>>>8-t.g)]}(t.k,u(t.d),t.I),t.I=7>t.f?function(t,e){var i=1;do{i=i<<1|P(e,t.v,i)}while(256>i);return i<<24>>24}(e,t.a):function(t,e,i){var n,s,r=1;do{if(s=i>>7&1,i<<=1,n=P(e,t.v,(1+s<<8)+r),r=r<<1|n,s!=n){for(;256>r;)r=r<<1|P(e,t.v,r);break}}while(256>r);return r<<24>>24}(e,t.a,x(t.b,t.l)),function(t,e){t.x[t.D++]=e,t.D>=t.c&&v(t)}(t.b,t.I),t.f=function(t){return 4>t?0:10>t?t-3:t-6}(t.f),t.d=o(t.d,H);return 0}(t.h);if(-1==e)throw Error("corrupted input");t.$=O,t.Z=t.h.d,(e||l(t.h.U,B)>=0&&l(t.h.d,t.h.U)>=0)&&(v(t.h.b),y(t.h.b),t.h.a.K=null,t.X=0)}(t),t.X}function w(t){t.b={},t.a={},t.q=a(192),t.E=a(12),t.s=a(12),t.u=a(12),t.r=a(12),t.n=a(192),t.j=a(4),t.J=a(114),t.t=L({},4),t.C=S({}),t.o=S({}),t.k={};for(var e=0;4>e;++e)t.j[e]=L({},6);return t}function _(t,e){for(;e>t.e;++t.e)t.G[t.e]=L({},3),t.H[t.e]=L({},3)}function M(t,e,i){return P(e,t.M,0)?8+(P(e,t.M,1)?8+C(t.L,e):C(t.H[i],e)):C(t.G[i],e)}function S(t){return t.M=a(2),t.G=a(16),t.H=a(16),t.L=L({},8),t.e=0,t}function T(t){F(t.M);for(var e=0;t.e>e;++e)F(t.G[e].B),F(t.H[e].B);F(t.L.B)}function A(t,e,i){var n,s;if(null==t.F||t.g!=i||t.y!=e)for(t.y=e,t.Y=(1<<e)-1,t.g=i,s=1<<t.g+t.y,t.F=a(s),n=0;s>n;++n)t.F[n]=E({})}function E(t){return t.v=a(768),t}function L(t,e){return t.A=e,t.B=a(1<<e),t}function C(t,e){var i,n=1;for(i=t.A;0!=i;--i)n=(n<<1)+P(e,t.B,n);return n-(1<<t.A)}function P(t,e,i){var n,a=e[i];return n=(t.i>>>11)*a,(-s^n)>(-s^t.p)?(t.i=n,e[i]=a+(2048-a>>>5)<<16>>16,-r&t.i||(t.p=t.p<<8|d(t.K),t.i<<=8),0):(t.i-=n,t.p-=n,e[i]=a-(a>>>5)<<16>>16,-r&t.i||(t.p=t.p<<8|d(t.K),t.i<<=8),1)}function R(t,e){var i,n,s=0;for(i=e;0!=i;--i)t.i>>>=1,n=t.p-t.i>>>31,t.p-=t.i&n-1,s=s<<1|1-n,-r&t.i||(t.p=t.p<<8|d(t.K),t.i<<=8);return s}function F(t){for(var e=t.length-1;e>=0;--e)t[e]=1024}function I(t){for(var e,i,n,s=0,r=0,a=t.length,o=[],l=[];a>s;++s,++r){if(128&(e=255&t[s]))if(192==(224&e)){if(s+1>=a)return t;if(128!=(192&(i=255&t[++s])))return t;l[r]=(31&e)<<6|63&i}else{if(224!=(240&e))return t;if(s+2>=a)return t;if(128!=(192&(i=255&t[++s])))return t;if(128!=(192&(n=255&t[++s])))return t;l[r]=(15&e)<<12|(63&i)<<6|63&n}else{if(!e)return t;l[r]=e}16383==r&&(o.push(String.fromCharCode.apply(String,l)),r=-1)}return r>0&&(l.length=r,o.push(String.fromCharCode.apply(String,l))),o.join("")}function D(t){return t[1]+t[0]}var N=2,k=3,z="function"==typeof setImmediate?setImmediate:setTimeout,U=4294967296,O=[i,-U],B=[0,0],H=[1,0];return{decompress:function(e,i,n){var s,r,a,o,l={},h=void 0===i&&void 0===n;if("function"!=typeof i&&(r=i,i=n=0),n=n||function(e){return void 0!==r?function(e,i){t({action:k,cbn:i,result:e})}(a?e:-1,r):void 0},i=i||function(e,i){return void 0!==r?t({action:N,cbn:r,result:e,error:i}):void 0},h){for(l.d=f({},e);b(l.d.Q););return I(p(l.d.S))}try{l.d=f({},e),o=D(l.d.N),a=o>-1,n(0)}catch(t){return i(null,t)}z((function t(){try{for(var e,r=0,h=(new Date).getTime();b(l.d.Q);)if(++r%1e3==0&&(new Date).getTime()-h>200)return a&&(s=D(l.d.Q.h.d)/o,n(s)),z(t,0),0;n(1),e=I(p(l.d.S)),z(i.bind(null,e),0)}catch(t){i(null,t)}}),0)}}}(),$p=function(){var t,e,i=window.URL||window.webkitURL,n={},s={},r=null,a=null;return $p={parse:function(e,i){t=i||function(){},Kp.decompress(new Uint8Array(e),(function(e){t(e)}))},load:function(i,n,s){if(t=n||function(){},a=void 0!==s?s:[],("string"==typeof(r=void 0!==i?i:[])||r instanceof String)&&(r=[r]),r.length!==a.length)for(var o=a.length;o<r.length;o++)a[o]=0;r.length&&(e=(new Date).getTime(),this.loadOne())},loadOne:function(){var t=this,e=r[0],i=a[0],n=e.substring(e.lastIndexOf("/")+1,e.lastIndexOf(".")),s=new XMLHttpRequest;s.responseType="arraybuffer",s.open("GET",e,!0),s.onreadystatechange=function(){2===s.readyState||3===s.readyState||4===s.readyState&&(200===s.status||0===s.status?t.decompact(s.response,n,i):console.error("Couldn't load ["+n+"] ["+s.status+"]"))},s.send(null)},decompact:function(t,e,i){var n=this;Kp.decompress(new Uint8Array(t),(function(t){n.add(t,e,i)}))},convert_formated_hex_to_bytes:function(t){var e,i,n,s=0,r=[];if(""===t.trim())return[];if(/[^0-9a-fA-F\s]/.test(t))return!1;for(i=(e=t.split(/([0-9a-fA-F]+)/g)).length,n=0;n<i;++n)""!==e[n].trim()&&(r[s++]=parseInt(e[n],16));return r},get:function(t){return s[t]&&setTimeout(function(){this.revoke(t)}.bind(this),100),n[t]},revoke:function(t){s[t]&&(i.revokeObjectURL(s[t]),delete s[t])},add:function(t,e,r){switch(r){case 0:var a=document.createElement("script");a.type="text/javascript",a.charset="utf-8",a.text=t,document.getElementsByTagName("head")[0].appendChild(a);break;case 1:s[e]=new Blob([t],{type:"application/javascript"}),n[e]=i.createObjectURL(s[e]);break;case 2:n[e]=t}this.next()},getTime:function(){return e},next:function(){r.shift(),a.shift(),0===r.length?(e=this.format_time((new Date).getTime()-e),t(n)):this.loadOne()},format_time:function(t){return t>1e3?t/1e3+" sec":t+" ms"}}}();const tm={},em={},im={};let nm=null,sm=0,rm=null,am=null,om=null,lm=[],hm=!1;class cm{static setExtraMaterial(t){return nm=t}static getScript(t,e={}){return this.get(t+"_js",e)}static getCompactScript(t){let e=document.createElement("script");e.type="text/javascript",e.charset="utf-8",e.text=this.get(t),document.getElementsByTagName("head")[0].appendChild(e)}static get(t,e={}){return tm[t]||console.error("data of "+t+" not find in pool !! "),tm[t]}static getSound(t,e={}){if(!tm["S_"+t])return console.error("sound of "+t+" not find in pool !! "),null;return tm["S_"+t]}static getGeo(t){return em[t]||("sphere"===t&&(em[t]=new Il(1,16,12)),"box"===t&&(em[t]=new tn(1,1,1)),"plane"===t&&(em[t]=new wn(1,1))),em[t]}static directTexture(t,e={}){null===rm&&(rm=new wh);let i=t.substring(t.lastIndexOf("/")+1,t.lastIndexOf("."));return tm["T_"+i]?this.getMap(i,e):rm.load(t,function(t){return tm["T_"+i]=t,this.getMap(i,e)}.bind(this))}static getMap(t,e={}){if(!tm["T_"+t])return console.error("texture of "+t+" not find in pool !! "),null;let i=tm["T_"+t];return e.encoding&&(i.encoding=it),i.flipY=void 0!==e.flip&&e.flip,void 0!==e.anisotropy&&(i.anisotropy=e.anisotropy),void 0!==e.generateMipmaps&&(i.generateMipmaps=e.generateMipmaps),e.repeat&&(i.repeat.fromArray(e.repeat),i.wrapS=v,i.wrapT=v),e.filter&&"near"===e.filter&&(i.minFilter=b,i.magFilter=b),e.callback&&e.callback(),i}static getMaterial(t){return im[t]||null}static setMaterial(t){let e=t.name;return e||(e="material_noName_"+sm++),im[e]||(im[e]=t),im[e]}static load(t,e){let i=[],n=e||function(){},s=("undefined"==typeof performance?Date:performance).now();"string"==typeof t||t instanceof String?i.push(t):i=i.concat(t),lm.push({urls:i,callback:n,start:s}),hm||cm.loadOne()}static loadOne(){hm=!0;let t=lm[0].urls[0],e=t.substring(t.lastIndexOf("/")+1,t.lastIndexOf(".")),i=t.substring(t.lastIndexOf(".")+1).toLowerCase();cm.exist(e,i)?cm.next():cm.loading(t,e,i)}static exist(t,e){let i="";switch(e){case"mp3":case"wav":case"ogg":i="S_";break;case"jpg":case"png":i="T_"}return!!tm[i+t]}static next(){lm[0].urls.shift(),0===lm[0].urls.length?(Math.floor(("undefined"==typeof performance?Date:performance).now()-lm[0].start),lm[0].callback(),lm.shift(),lm.length>0?cm.loadOne():hm=!1):cm.loadOne()}static loading(t,e,i){switch(i){case"glb":case"gltf":cm.load_GLTF(t,e);break;case"jpg":case"png":cm.load_MAP(t,e);break;case"fbx":cm.load_FBX(t,e);break;default:cm.loadingExtand(t,e,i)}}static loadingExtand(t,e,i){switch(null===om&&(om=new XMLHttpRequest),om.open("GET",t,!0),om.overrideMimeType("json"===i?"application/json":"text/xml"),i){case"hex":case"wasm":case"mp3":case"wav":case"ogg":om.responseType="arraybuffer";break;case"bvh":case"glsl":case"js":om.responseType="text"}om.onreadystatechange=function(){4===om.readyState&&(200===om.status||0===om.status?cm.load_direct(om.response,e,i):console.error("Couldn't load ["+e+"] ["+om.status+"]"))},om.send(null)}static load_direct(t,e,i){switch(i){case"mp3":case"wav":case"ogg":Zh.getContext().decodeAudioData(t.slice(0),(function(t){cm.set("S_"+e,t)}),(function(t){console.error("decodeAudioData error",t)}));break;case"hex":$p.parse(t,(function(t){cm.set(e,t)}));break;case"json":cm.set(e,JSON.parse(t));break;case"wasm":cm.set(e,new Uint8Array(t));break;case"js":cm.set(e+"_js",t);break;default:cm.set(e,t)}}static set(t,e){tm[t]=e,cm.next()}static load_MAP(t,e){null===rm&&(rm=new wh),rm.load(t,(function(t){cm.set("T_"+e,t)}))}static load_GLTF(t,e){if(null===am){am=new Zd;let t,e,i=(new Zp).setDecoderPath("build/draco/");navigator.userAgentData?e="wasm":(t=navigator.userAgent.toLowerCase(),e=-1!==t.indexOf("safari")&&-1===t.indexOf("chrome")?"js":"wasm"),i.setDecoderConfig({type:e}),am.setDRACOLoader(i)}am.load(t,(function(t){null!==nm&&t.scene.traverse((function(t){t.isMesh&&nm(t.material)})),cm.set(e,t.scene)}))}static symetric(t,e=!0){t.isMesh&&(t=t.geometry);let i=t.attributes.uv.array,n=.5*i.length;for(;n--;)i[2*n]<0&&(i[2*n]*=-1);t.attributes.uv.needsUpdate=!0,e&&t.setAttribute("uv2",t.attributes.uv)}static getMesh(t){"string"==typeof t&&(t=tm[t]);let e={};return t.traverse((function(t){t.isMesh&&(e[t.name]=t)})),e}static getGroup(t){"string"==typeof t&&(t=tm[t]);let e={};return t.traverse((function(t){t.isGroup&&(e[t.name]=t)})),e}static autoMorph(t,e){let i,n,s,r,a,o,l=cm.getMesh(t);for(let t in l)if(i=l[t],n=i.name,-1!==n.search("__morph__")&&(r=l[n.substring(0,n.indexOf("__"))],s=n.substring(n.lastIndexOf("__")+2),r))if(r.userData.morph||(r.userData.morph={},r.material.morphTargets=!0),o=r.geometry,o.attributes.position.count===i.geometry.attributes.position.count){if(o.morphAttributes.position||(o.morphAttributes.position=[]),a=o.morphAttributes.position.length,o.morphAttributes.position.push(i.geometry.attributes.position),e)for(let t in i.geometry.attributes)"position"!==t&&o.attributes[t]&&(o.morphAttributes[t]||(o.morphAttributes[t]=[]),o.morphAttributes[t][a]=i.geometry.attributes[t]);i.parent.remove(i),i.material.dispose(),i.geometry.dispose(),r.updateMorphTargets(),r.userData.morph[s]=a}else console.warn("this morph target is not good : ",s)}}let um,dm,pm,mm,fm,gm,vm,xm,ym=Au.dom,bm=Au.makeGradiant,wm=!1,_m=!1,Mm=null,Sm=null,Tm=null,Am=!1,Em="#020206";const Lm={f:0,z:0,w:0,h:0,ratio:1};let Cm={};class Pm{static init(t,e,i,n){wm||(gm=t,Cm=e,um=n||document.body,dm=document.createElement("div"),dm.style.cssText="-o-user-select:none; -ms-user-select:none; -khtml-user-select:none; -webkit-user-select:none; -moz-user-select: none; pointer-events:none; position:absolute; margin:0; padding:0; top:0; left:0; width:100%; height:100%; display:block; font-family: Tahoma;",um.appendChild(dm),mm=document.createElement("div"),mm.style.cssText=" color: #fff; font-size:16px; text-align:center; position:absolute; margin:0; padding:0; top:50%; left:50%; width:512px; height:20px; margin-left:-256px; margin-top:-38px; display:block; pointer-events:none; text-shadow: 1px 1px #000000;",mm.textContent=i||"load...",dm.appendChild(mm),fm=document.createElement("div"),fm.style.cssText="position:absolute; top:50%; left:50%; width:50px; height:50px; margin-left:-25px; margin-top:-25px; display:block; ",dm.appendChild(fm),this.loadSvg("./assets/textures/loader.svg",fm),wm=!0)}static snipperMode(t){_m=t}static loadSvg(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.overrideMimeType("image/svg+xml"),i.onload=function(t){200==this.status&&e.appendChild(i.responseXML.documentElement)},i.send("")}static log(t=""){null!==Tm&&(Tm.innerHTML=t)}static setFps(t){null!==Mm&&(Mm.innerHTML=t)}static setStats(t){if(null===Sm)return;for(let e in t.memory)t.memory[e]="drawingbuffer"===e||"total"===e?Math.round(1e-6*t.memory[e])+" MB":Math.round(.001*t.memory[e])+" KB";let e=JSON.stringify(t,null,2);e=e.replace(/[",.*+?^${}()|[\]\\]/g,""),Sm.textContent=e}static endLoading(){dm.removeChild(fm),dm.removeChild(mm),Mm=document.createElement("div"),Mm.style.cssText="position: absolute; bottom:3px; left:10px; font-size:14px; font-family:Tahoma; color:#111;",dm.appendChild(Mm),Tm=document.createElement("div"),Tm.style.cssText="position: absolute; bottom:20px; left:10px; font-size:14px; font-family:Tahoma; color:#111;  width:400px; vertical-align:bottom;",dm.appendChild(Tm),Sm=document.createElement("div"),Sm.style.cssText="position: absolute; top:3px; left:10px; font-size:14px; font-family:Tahoma; color:#111;  width:200px; white-space: pre;",dm.appendChild(Sm)}static count(t,e){return e&&(t.n--,t.t--),undefined.textContent=t.n+" / "+t.t,0===t.n?"reload":0===t.t?"empty":"fire"}static dispose(){if(wm){for(;dm.firstChild;)dm.removeChild(dm.lastChild);um.removeChild(dm),wm=!1}}static addBorder(){let t=[[68,Em,0],[75,Em,.08],[93,Em,.4],[100,Em,.6]];pm=ym("svg","position:absolute; margin:0; padding:0; top:0; left:0; width:100%; height:100%; display:block; pointer-events:none;",{viewBox:"0 0 512 512",width:512,height:512,preserveAspectRatio:"none"}),ym("defs","",{},pm),bm("radialGradient",{id:"grad",cx:0,cy:0,r:338,fx:0,fy:0,gradientTransform:"matrix( 0, 1, -1, 0, 256, 256 )",gradientUnits:"userSpaceOnUse"},pm,t),ym("rect","",{x:0,y:0,width:512,height:512,fill:"url(#grad)"},pm),dm.appendChild(pm)}static init3dHub(){xm=new rn({uniforms:{renderMode:{value:0},ratio:{value:1},radius:{value:2},step:{value:new Ot(.6,.7,1.25,1.5)}},vertexShader:"\n            varying vec2 vUv;\n\n            void main() {\n                vUv = uv;\n                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n            }\n            ",fragmentShader:"\n\n            uniform int renderMode;\n\n            uniform float ratio;\n            uniform float radius;\n            uniform vec4 step;\n            varying vec2 vUv;\n            void main() {\n                vec2 c = vec2(0.5, 0.5);\n                vec2 pos = (vUv - 0.5) * vec2(ratio, 1) + 0.5;\n      \n                float dist = length( pos - c ) * radius;\n\n                vec4 cOne = vec4(0.0, 0.0, 0.0, 0.0);\n                vec4 cTwo = vec4(0.0, 0.0, 0.0, 0.0);\n                vec4 cTree = vec4(0.0, 0.0, 0.0, 0.25);\n                vec4 cFour = vec4(0.0, 0.0, 0.0, 0.95);\n\n                vec4 color = mix( cOne, cTwo, smoothstep( step.x, step.y, dist ));\n                color = mix( color, cTree, smoothstep(step.y, step.z, dist ));\n                color = mix( color, cFour, smoothstep(step.z, step.w, dist ));\n\n                if( renderMode == 0 ) gl_FragColor = color;\n                else discard;\n\n            }\n            ",transparent:!0,depthWrite:!1,depthTest:!1,toneMapped:!1}),vm=new Ki(new wn(1,1,2,2),xm),vm.frustumCulled=!1,gm.add(vm),vm.renderOrder=1e6,Am=!0,this.update()}static setRenderMode(t){Am&&(xm.uniforms.renderMode.value=t)}static hide(t){vm.visible=t}static setFocus(t){}static update(t,e){t&&(Cm=t);let i=Cm;e=e||"";let n=gm.fov,s=gm.zoom,r=0,a=1;if(i.w!==Lm.w||i.h!==Lm.h||n!==Lm.f||s!==Lm.z){if(this.resize(i,n,s),!Am)return;_m&&"fps"===e?(a=(s-1.2)/12.8,xm.uniforms.ratio.value=Yd.lerp(1,Lm.ratio,a),xm.uniforms.radius.value=Yd.lerp(2,3,a)):(r="tps"===e?s-.6:s-1.2,r*=.25,xm.uniforms.step.value.x=.6-r,xm.uniforms.step.value.y=.7-r,xm.uniforms.step.value.z=1.25-.5*r)}}static resize(t,e,i){if(Mm&&(Mm.style.left=t.left+10+"px"),Sm&&(Sm.style.left=t.left+10+"px"),Tm&&(Tm.style.left=t.left+10+"px"),!Am)return;let n=e*Yd.torad,s=t.h/(2*Math.tan(.5*n));vm.scale.set(t.w,t.h,0).multiplyScalar(.001),vm.position.z=.001*-s*i,Lm.f=e,Lm.z=i,Lm.w=t.w,Lm.h=t.h,Lm.ratio=t.w/t.h}}class Rm extends Ki{constructor(t={}){super(void 0!==t.geometry?t.geometry:new wn(1,1,1,1)),this.settings={size:[200,200],gAlpha:!0,opacity:1},this.scale.set(200,200,1),this.rotateX(-Math.PI/2),this.castShadow=!1,this.receiveShadow=!0,this.type="Reflector",this.isShow=!0;var e=this;t=t||{},this.map=t.map||null,this.color=t.color||5263440,this.reflect=void 0!==t.reflect?t.reflect:.35,this.opacity=void 0!==t.opacity?t.opacity:1,this.isWater=void 0!==t.water&&t.water,this.uv=t.uv||1,this.normalScale=t.normalScale||1,this.encoding=t.encoding||!1,this.textureSize=t.textureSize||512,this.renderTarget=null;var i=t.clipBias||0,n=new fn,s=new Wt,r=new Wt,a=new Wt,o=new we,l=new Wt(0,0,-1),h=new Ot,c=new Wt,u=new Wt,d=new Ot,p=new we,m=new on;this.material=new Gl({name:"floor",color:this.color,map:this.map,roughness:.25,metalness:1,opacity:1,transparent:!0,depthWrite:!1,premultipliedAlpha:!0}),this.groundAlpha(),this.renderOrder=1,this.isWater&&this.setWater(),this.material.userData={reflectif:{value:this.reflect},mirrorMap:{value:null}},this.setTarget();var f=this;this.material.onBeforeCompile=function(t){var e=t.uniforms;e.mirrorMap=this.userData.mirrorMap,e.textureMatrix={value:p},e.reflectif=this.userData.reflectif,t.uniforms=e;var i=t.vertexShader;i=(i=i.replace("varying vec3 vViewPosition;",["varying vec3 vViewPosition;","varying vec4 vUvR;","uniform mat4 textureMatrix;"].join("\n"))).replace("vViewPosition = - mvPosition.xyz;",["vViewPosition = - mvPosition.xyz;","vUvR = textureMatrix * vec4( position, 1.0 );"].join("\n")),t.vertexShader=i;var n=t.fragmentShader;n=(n=(n=(n=(n=(n=(n=(n=(n=n.replace("uniform vec3 diffuse;",["uniform vec3 diffuse;","varying vec4 vUvR;","uniform float reflectif;","uniform sampler2D mirrorMap;"].join("\n"))).replace("#include <map_fragment>",Fm)).replace("#include <aomap_pars_fragment>","")).replace("#include <aomap_fragment>","")).replace("#include <emissivemap_fragment>","")).replace("#include <clearcoat_normal_fragment_begin>","")).replace("#include <clearcoat_normal_fragment_maps>","")).replace("#include <clearcoat_pars_fragment>","")).replace("#include <bumpmap_pars_fragment>",""),t.fragmentShader=n,rd.modify(t)},rd.setDefines(this.material),this.onBeforeRender=function(t,g,v){if(this.isShow&&(f.isWater&&(f.material.normalMap.offset.x+=5e-4,f.material.normalMap.offset.y+=25e-5),r.setFromMatrixPosition(e.matrixWorld),a.setFromMatrixPosition(v.matrixWorld),o.extractRotation(e.matrixWorld),s.set(0,0,1),s.applyMatrix4(o),c.subVectors(r,a),!(c.dot(s)>0))){c.reflect(s).negate(),c.add(r),o.extractRotation(v.matrixWorld),l.set(0,0,-1),l.applyMatrix4(o),l.add(a),u.subVectors(r,l),u.reflect(s).negate(),u.add(r),m.position.copy(c),m.up.set(0,1,0),m.up.applyMatrix4(o),m.up.reflect(s),m.lookAt(u),m.far=v.far,m.updateMatrixWorld(),m.projectionMatrix.copy(v.projectionMatrix),p.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),p.multiply(m.projectionMatrix),p.multiply(m.matrixWorldInverse),p.multiply(e.matrixWorld),n.setFromNormalAndCoplanarPoint(s,r),n.applyMatrix4(m.matrixWorldInverse),h.set(n.normal.x,n.normal.y,n.normal.z,n.constant);var x=m.projectionMatrix;d.x=(Math.sign(h.x)+x.elements[8])/x.elements[0],d.y=(Math.sign(h.y)+x.elements[9])/x.elements[5],d.z=-1,d.w=(1+x.elements[10])/x.elements[14],h.multiplyScalar(2/h.dot(d)),x.elements[2]=h.x,x.elements[6]=h.y,x.elements[10]=h.z+1-i,x.elements[14]=h.w,e.renderTarget.texture.encoding=t.outputEncoding,e.visible=!1;var y=t.getRenderTarget(),b=t.xr.enabled,w=t.shadowMap.autoUpdate;t.xr.enabled=!1,t.shadowMap.autoUpdate=!1,t.setRenderTarget(e.renderTarget),t.state.buffers.depth.setMask(!0),!1===t.autoClear&&t.clear(),t.render(g,m),t.xr.enabled=b,t.shadowMap.autoUpdate=w,t.setRenderTarget(y);var _=v.viewport;void 0!==_&&t.state.viewport(_),e.visible=!0}}}getRenderTarget(){return this.renderTarget}setTarget(){this.renderTarget&&this.renderTarget.dispose();var t={minFilter:M,magFilter:M,format:F,stencilBuffer:!1,encoding:this.encoding?it:et,generateMipmaps:!0};this.renderTarget=new Bt(this.textureSize,this.textureSize,t),this.material.userData.mirrorMap.value=this.renderTarget.texture}setAlphaMap(t=!0){t!==this.settings.gAlpha&&(this.settings.gAlpha=t,this.material.alphaMap=t?this.alphaMap:null,t&&(this.material.alphaMap.needsUpdate=!0),this.material.needsUpdate=!0)}setSize(t=[200,200]){t!==this.settings.size&&(this.settings.size=t,this.scale.set(t[0],t[1],1))}setColor(t){this.color=void 0!==t?t:11039282,this.material.color.setHex(this.color)}setMapRepeat(t){this.map&&this.map.repeat.set(t,t)}setMap(t){this.map=t,this.material.map=this.map,this.material.needsUpdate=!0}setWater(t,e,i){if(void 0!==t&&(this.isWater=t),this.isWater){void 0!==e||this.uv;var n=void 0!==i?i:this.normalScale;this.material.normalMap=null,this.material.normalScale.set(n,n),this.material.roughness=.1,this.material.metalness=.6,this.material.side=2}else this.material.normalMap=null,this.material.roughness=.9,this.material.metalness=.1,this.material.side=0}setOpacity(t=1){t!==this.settings.opacity&&(this.settings.opacity=t,this.material.opacity=this.settings.opacity)}setReflect(t){this.reflect=void 0!==t?t:.35,this.material.userData.reflectif.value=this.reflect}show(t){this.isShow=t,this.visible=t}groundAlpha(){let t=document.createElement("canvas");t.width=t.height=512;let e=t.getContext("2d"),i=e.createRadialGradient(256,256,60,256,256,250);i.addColorStop(0,"white"),i.addColorStop(.2,"white"),i.addColorStop(1,"black"),e.fillStyle=i,e.fillRect(0,0,512,512);var n=new Image(512,512);n.src=t.toDataURL("image/png"),this.alphaMap=new zt(n),this.material.alphaMap=this.alphaMap;let s=this;n.onload=function(){null!==s.material.alphaMap&&(s.material.alphaMap.needsUpdate=!0)}}}const Fm="\n\n//vec2 distortion = vec2(0.0);\n//vec4 reflector =vec4(0.0);\n\n//vec3 vn = vec3(0.0);\n\n//#ifdef OBJECTSPACE_NORMALMAP\n\n\t//vn = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\t//vn = normalize( normalMatrix * vn );\n\t//distortion = vn.xz * ( 0.001 + 1.0 / 1.0 ) * 20.0;\n\n\t//reflector = texture2D( alphaMap, vUvR.xy / vUvR.w + distortion );\n\n//#endif\n \n//vec4 reflector = texture2DProj( alphaMap, vUvR );\nvec4 reflector = texture2DProj( mirrorMap, vUvR );\n\n#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor = mapTexelToLinear( texelColor );\n\n\ttexelColor.rgb = mix( texelColor.rgb, reflector.rgb, reflectif );\n\t//texelColor.rgb *= mix( vec3(1.0), reflector.rgb, reflectif );\n\tdiffuseColor *= texelColor;\n\t\n#else\n\ndiffuseColor.rgb *= mix( vec3(1.0), reflector.rgb, reflectif );\n\n#endif\n\n";class Im{static computeTangents(t){t.computeTangents(),console.warn("THREE.BufferGeometryUtils: .computeTangents() has been removed. Use BufferGeometry.computeTangents() instead.")}static mergeBufferGeometries(t,e=!1){const i=null!==t[0].index,n=new Set(Object.keys(t[0].attributes)),s=new Set(Object.keys(t[0].morphAttributes)),r={},a={},o=t[0].morphTargetsRelative,l=new Di;let h=0;for(let c=0;c<t.length;++c){const u=t[c];let d=0;if(i!==(null!==u.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const t in u.attributes){if(!n.has(t))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+'. All geometries must have compatible attributes; make sure "'+t+'" attribute exists among all geometries, or in none of them.'),null;void 0===r[t]&&(r[t]=[]),r[t].push(u.attributes[t]),d++}if(d!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". Make sure all geometries have the same number of attributes."),null;if(o!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const t in u.morphAttributes){if(!s.has(t))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===a[t]&&(a[t]=[]),a[t].push(u.morphAttributes[t])}if(l.userData.mergedUserData=l.userData.mergedUserData||[],l.userData.mergedUserData.push(u.userData),e){let t;if(i)t=u.index.count;else{if(void 0===u.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". The geometry must have either an index or a position attribute"),null;t=u.attributes.position.count}l.addGroup(h,t,c),h+=t}}if(i){let e=0;const i=[];for(let n=0;n<t.length;++n){const s=t[n].index;for(let t=0;t<s.count;++t)i.push(s.getX(t)+e);e+=t[n].attributes.position.count}l.setIndex(i)}for(const t in r){const e=this.mergeBufferAttributes(r[t]);if(!e)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+t+" attribute."),null;l.setAttribute(t,e)}for(const t in a){const e=a[t][0].length;if(0===e)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[t]=[];for(let i=0;i<e;++i){const e=[];for(let n=0;n<a[t].length;++n)e.push(a[t][n][i]);const n=this.mergeBufferAttributes(e);if(!n)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+t+" morphAttribute."),null;l.morphAttributes[t].push(n)}}return l}static mergeBufferAttributes(t){let e,i,n,s=0;for(let r=0;r<t.length;++r){const a=t[r];if(a.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===e&&(e=a.array.constructor),e!==a.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===i&&(i=a.itemSize),i!==a.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===n&&(n=a.normalized),n!==a.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;s+=a.array.length}const r=new e(s);let a=0;for(let e=0;e<t.length;++e)r.set(t[e].array,a),a+=t[e].array.length;return new gi(r,i,n)}static interleaveAttributes(t){let e,i=0,n=0;for(let s=0,r=t.length;s<r;++s){const r=t[s];if(void 0===e&&(e=r.array.constructor),e!==r.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;i+=r.array.length,n+=r.itemSize}const s=new ua(new e(i),n);let r=0;const a=[],o=["getX","getY","getZ","getW"],l=["setX","setY","setZ","setW"];for(let e=0,i=t.length;e<i;e++){const i=t[e],n=i.itemSize,h=i.count,c=new pa(s,n,r,i.normalized);a.push(c),r+=n;for(let t=0;t<h;t++)for(let e=0;e<n;e++)c[l[e]](t,i[o[e]](t))}return a}static estimateBytesUsed(t){let e=0;for(const i in t.attributes){const n=t.getAttribute(i);e+=n.count*n.itemSize*n.array.BYTES_PER_ELEMENT}const i=t.getIndex();return e+=i?i.count*i.itemSize*i.array.BYTES_PER_ELEMENT:0,e}static mergeVertices(t,e=1e-4){e=Math.max(e,Number.EPSILON);const i={},n=t.getIndex(),s=t.getAttribute("position"),r=n?n.count:s.count;let a=0;const o=Object.keys(t.attributes),l={},h={},c=[],u=["getX","getY","getZ","getW"];for(let e=0,i=o.length;e<i;e++){const i=o[e];l[i]=[];const n=t.morphAttributes[i];n&&(h[i]=new Array(n.length).fill().map((()=>[])))}const d=Math.log10(1/e),p=Math.pow(10,d);for(let e=0;e<r;e++){const s=n?n.getX(e):e;let r="";for(let e=0,i=o.length;e<i;e++){const i=o[e],n=t.getAttribute(i),a=n.itemSize;for(let t=0;t<a;t++)r+=~~(n[u[t]](s)*p)+","}if(r in i)c.push(i[r]);else{for(let e=0,i=o.length;e<i;e++){const i=o[e],n=t.getAttribute(i),r=t.morphAttributes[i],a=n.itemSize,c=l[i],d=h[i];for(let t=0;t<a;t++){const e=u[t];if(c.push(n[e](s)),r)for(let t=0,i=r.length;t<i;t++)d[t].push(r[t][e](s))}}i[r]=a,c.push(a),a++}}const m=t.clone();for(let e=0,i=o.length;e<i;e++){const i=o[e],n=t.getAttribute(i),s=new n.array.constructor(l[i]),r=new gi(s,n.itemSize,n.normalized);if(m.setAttribute(i,r),i in h)for(let e=0;e<h[i].length;e++){const n=t.morphAttributes[i][e],s=new n.array.constructor(h[i][e]),r=new gi(s,n.itemSize,n.normalized);m.morphAttributes[i][e]=r}}return m.setIndex(c),m}static toTrianglesDrawMode(t,e){if(0===e)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(2===e||1===e){let i=t.getIndex();if(null===i){const e=[],n=t.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<n.count;t++)e.push(t);t.setIndex(e),i=t.getIndex()}const n=i.count-2,s=[];if(2===e)for(let t=1;t<=n;t++)s.push(i.getX(0)),s.push(i.getX(t)),s.push(i.getX(t+1));else for(let t=0;t<n;t++)t%2==0?(s.push(i.getX(t)),s.push(i.getX(t+1)),s.push(i.getX(t+2))):(s.push(i.getX(t+2)),s.push(i.getX(t+1)),s.push(i.getX(t)));s.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=t.clone();return r.setIndex(s),r.clearGroups(),r}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}static computeMorphedAttributes(t){if(!0!==t.geometry.isBufferGeometry)return console.error("THREE.BufferGeometryUtils: Geometry is not of type BufferGeometry."),null;const e=new Wt,i=new Wt,n=new Wt,s=new Wt,r=new Wt,a=new Wt,o=new Wt,l=new Wt,h=new Wt;function c(t,c,u,d,p,m,f,g,v){e.fromBufferAttribute(u,m),i.fromBufferAttribute(u,f),n.fromBufferAttribute(u,g);const x=t.morphTargetInfluences;if(c.morphTargets&&d&&x){o.set(0,0,0),l.set(0,0,0),h.set(0,0,0);for(let t=0,c=d.length;t<c;t++){const c=x[t],u=d[t];0!==c&&(s.fromBufferAttribute(u,m),r.fromBufferAttribute(u,f),a.fromBufferAttribute(u,g),p?(o.addScaledVector(s,c),l.addScaledVector(r,c),h.addScaledVector(a,c)):(o.addScaledVector(s.sub(e),c),l.addScaledVector(r.sub(i),c),h.addScaledVector(a.sub(n),c)))}e.add(o),i.add(l),n.add(h)}t.isSkinnedMesh&&(t.boneTransform(m,e),t.boneTransform(f,i),t.boneTransform(g,n)),v[3*m+0]=e.x,v[3*m+1]=e.y,v[3*m+2]=e.z,v[3*f+0]=i.x,v[3*f+1]=i.y,v[3*f+2]=i.z,v[3*g+0]=n.x,v[3*g+1]=n.y,v[3*g+2]=n.z}const u=t.geometry,d=t.material;let p,m,f;const g=u.index,v=u.attributes.position,x=u.morphAttributes.position,y=u.morphTargetsRelative,b=u.attributes.normal,w=u.morphAttributes.position,_=u.groups,M=u.drawRange;let S,T,A,E,L,C,P,R;const F=new Float32Array(v.count*v.itemSize),I=new Float32Array(b.count*b.itemSize);if(null!==g)if(Array.isArray(d))for(S=0,A=_.length;S<A;S++)for(L=_[S],C=d[L.materialIndex],P=Math.max(L.start,M.start),R=Math.min(L.start+L.count,M.start+M.count),T=P,E=R;T<E;T+=3)p=g.getX(T),m=g.getX(T+1),f=g.getX(T+2),c(t,C,v,x,y,p,m,f,F),c(t,C,b,w,y,p,m,f,I);else for(P=Math.max(0,M.start),R=Math.min(g.count,M.start+M.count),S=P,A=R;S<A;S+=3)p=g.getX(S),m=g.getX(S+1),f=g.getX(S+2),c(t,d,v,x,y,p,m,f,F),c(t,d,b,w,y,p,m,f,I);else if(void 0!==v)if(Array.isArray(d))for(S=0,A=_.length;S<A;S++)for(L=_[S],C=d[L.materialIndex],P=Math.max(L.start,M.start),R=Math.min(L.start+L.count,M.start+M.count),T=P,E=R;T<E;T+=3)p=T,m=T+1,f=T+2,c(t,C,v,x,y,p,m,f,F),c(t,C,b,w,y,p,m,f,I);else for(P=Math.max(0,M.start),R=Math.min(v.count,M.start+M.count),S=P,A=R;S<A;S+=3)p=S,m=S+1,f=S+2,c(t,d,v,x,y,p,m,f,F),c(t,d,b,w,y,p,m,f,I);return{positionAttribute:v,normalAttribute:b,morphedPositionAttribute:new Ti(F,3),morphedNormalAttribute:new Ti(I,3)}}}const Dm={baseRemplace:"\n        uniform vec3 diffuse; \n        uniform vec4 clevels;\n\n        uniform sampler2D normalMap1;\n        uniform sampler2D normalMap2;\n\n        uniform sampler2D roughnessMap1;\n        uniform sampler2D roughnessMap2;\n\n        uniform float aoMapIntensity;\n        uniform sampler2D map1;\n        uniform sampler2D map2;\n\n        vec4 MappingMix( float slope, vec4 level, vec4 rocks, vec4 grasss, vec4 sands ){\n            vec4 cc = rocks;\n            if (slope < level.y) cc = grasss;\n            if (slope < level.z) cc = sands;\n            if (( slope < level.x ) && (slope >= level.y)) cc = mix( grasss , rocks, (slope - level.y) * (1. / (level.x - level.y)));\n            if (( slope < level.y ) && (slope >= level.z)) cc = mix( sands , grasss, (slope - level.z) * (1. / (level.y - level.z)));\n            return cc;\n        }\n    ",rough:"\n        float roughnessFactor = roughness;\n        float metalnessFactor = metalness;\n        #ifdef USE_ROUGHNESSMAP\n\n            vec4 sandR = texture2D( roughnessMap, vUv );\n            vec4 grassR = texture2D( roughnessMap1, vUv );\n            vec4 rockR = texture2D( roughnessMap2, vUv );\n\n            vec4 baseColorR = MappingMix( vColor.r, clevels, rockR, grassR, sandR );\n            // reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n            float ambientOcclusion =( baseColorR.r - 1.0 ) * aoMapIntensity + 1.0;\n            roughnessFactor *= baseColorR.g;\n            metalnessFactor *= baseColorR.b;\n        #endif\n    ",ao:"\n        reflectedLight.indirectDiffuse *= ambientOcclusion;\n        #if defined( USE_ENVMAP ) && defined( STANDARD )\n            float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n            reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n        #endif\n    ",map:"\n        #ifdef USE_MAP\n            vec4 sand = texture2D( map, vUv );\n            vec4 grass = texture2D( map1, vUv );\n            vec4 rock = texture2D( map2, vUv );\n\n            vec4 baseColor = MappingMix(vColor.r, clevels, rock, grass, sand);\n            diffuseColor *= mapTexelToLinear( baseColor );\n\n        #endif\n    ",normal:"\n        #ifdef USE_NORMALMAP\n            vec4 sandN =  texture2D( normalMap, vUv );\n            vec4 grassN = texture2D( normalMap1, vUv );\n            vec4 rockN = texture2D( normalMap2, vUv );\n\n            vec3 extraNormal = MappingMix(vColor.r, clevels, rockN, grassN, sandN).xyz * 2.0 - 1.0;\n            extraNormal.xy *= normalScale;\n            normal = perturbNormal2Arb( -vViewPosition, normal, extraNormal, faceDirection );\n        #endif\n    ",alphamap:"\n        #ifdef USE_ALPHAMAP\n            diffuseColor.a = opacity +( texture2D( alphaMap, vUv ).g * opacity) * (1.0-opacity);\n        #endif\n    "};const Nm="\n\nmat4 inverse(mat4 m) {\n\n    float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n    b00 = a00 * a11 - a01 * a10,\n    b01 = a00 * a12 - a02 * a10,\n    b02 = a00 * a13 - a03 * a10,\n    b03 = a01 * a12 - a02 * a11,\n    b04 = a01 * a13 - a03 * a11,\n    b05 = a02 * a13 - a03 * a12,\n    b06 = a20 * a31 - a21 * a30,\n    b07 = a20 * a32 - a22 * a30,\n    b08 = a20 * a33 - a23 * a30,\n    b09 = a21 * a32 - a22 * a31,\n    b10 = a21 * a33 - a23 * a31,\n    b11 = a22 * a33 - a23 * a32,\n\n  det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4( a11 * b11 - a12 * b10 + a13 * b09, a02 * b10 - a01 * b11 - a03 * b09, a31 * b05 - a32 * b04 + a33 * b03, a22 * b04 - a21 * b05 - a23 * b03, a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07, a32 * b02 - a30 * b05 - a33 * b01, a20 * b05 - a22 * b02 + a23 * b01, a10 * b10 - a11 * b08 + a13 * b06, a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00, a21 * b02 - a20 * b04 - a23 * b00, a11 * b07 - a10 * b09 - a12 * b06, a00 * b09 - a01 * b07 + a02 * b06, a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n",km="\nvarying vec3 vViewPosition;\n\nvarying mat4 invMat;\nvarying mat4 modelMatrixOn;\n\nvarying vec3 oP; // surface position in object space\nvarying vec3 oE; // position of the eye in object space\nvarying vec3 oI; // incident ray direction in object space\nvarying vec3 oN; // surface normal\n\n",zm="\n#include <fog_vertex>\n\nmat4 modelViewMatrixInverse = inverse( modelViewMatrix );\n\n// surface position in object space\noP = position;\n\n// position of the eye in object space\noE = modelViewMatrixInverse[3].xyz;\n\n// incident ray direction in object space\noI = oP - oE;\n\n// surface normal\noN = normalize( vec3( normal ) );\n\n",Um="\n\nvarying vec3 oP; // surface position in object space\nvarying vec3 oE; // position of the eye in object space\nvarying vec3 oI; // incident ray direction in object space\nvarying vec3 oN; // surface normal\n\nuniform sampler2D insideMap;\nuniform vec3 wallFreq;\nuniform float wallsBias;\n\nuniform float time;\nuniform float lightning;\nuniform bool isNoise;\nuniform bool isNoSection;\n\nfloat randomized( vec2 co ){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec2 tileUV( vec2 uv, vec2 pos, vec2 ntile ){\n\n\tpos.y = ntile.y-pos.y-1.0;\n\tvec2 div = 1.0/ntile;\n\tvec2 v = vec2(uv*div)+(pos*div);\n\treturn v;\n\t\n}\n\nvoid main() {\n\n",Om="\n\n#ifdef USE_MAP\n\n\t//vec4 texelColor = texture2D( map, vUv );\n\n\t//texelColor = mapTexelToLinear( texelColor );\n\t//diffuseColor *= texelColor;\n\n\nvec3 wallFrequencies = wallFreq - wallsBias;\n\n// calculate wall locations\nvec3 wallFrame = floor( oP * wallFrequencies);\nvec3 walls = ( wallFrame + step( vec3( 0.0 ), oI )) / wallFrequencies;\n\n// how much of the ray is needed to get from the oE to each of the walls\n\nvec3 rayFractions = ( walls - oE ) / oI;\n\n// texture-coordinates of intersections\nvec2 uvXY = fract((oE + rayFractions.z * oI).xy * wallFrequencies.xy);\nvec2 uvXZ = fract((oE + rayFractions.y * oI).xz * wallFrequencies.xz);\nvec2 uvZY = fract((oE + rayFractions.x * oI).zy * wallFrequencies.zy);\n\nvec2 nuv = vec2( 2.0, 4.0 );\n\n// floor / ceiling  \n\nvec4 tmp_color_1 = texture2D( insideMap, tileUV( uvXZ, vec2(1.0,0.0), nuv ) );// floor\nvec4 tmp_color_2 = texture2D( insideMap, tileUV( uvXZ, vec2(0.0,0.0), nuv ) );// ceilling\nvec4 verticalColour = mix( tmp_color_1, tmp_color_2, step(0.0, oI.y));\n\ntmp_color_1 = texture2D( insideMap, tileUV( uvXY, vec2(0.0,2.0), nuv ) ); // back\ntmp_color_2 = texture2D( insideMap, tileUV( uvXY, vec2(1.0,2.0), nuv ) ); // front\nvec4 wallXYColour = mix( tmp_color_1, tmp_color_2, step(oI.z, 0.0));\n\ntmp_color_1 = texture2D( insideMap, tileUV( uvZY, vec2(0.0,3.0), nuv ) ); // left\ntmp_color_2 = texture2D( insideMap, tileUV( uvZY, vec2(1.0,3.0), nuv ) ); // right\nvec4 wallZYColour = mix( tmp_color_1, tmp_color_2, step(oI.x, 0.0) );\n\n// add some noise\n\nvec4 noiseColor = vec4( 0.0 );\n\nif( isNoise ){\n\tfloat t = time*0.00000001;\n\tnoiseColor.xyz = vec3( vec3( randomized(wallFrame.xy+t) ) + vec3( randomized(wallFrame.zy) ) + vec3( randomized(wallFrame.xz+t)) ) / 3.0;\n\twallXYColour *= noiseColor;\n    wallZYColour *= noiseColor;\n    verticalColour *= noiseColor;\n}\n\n// intersect walls\n\nvec4 insideColor = vec4(0.0);\nif( isNoSection ){\n\t//insideColor = ( wallXYColour + wallZYColour + verticalColour ) / 3.0;\n\t///insideColor.a = alph;\n\n\tinsideColor = mix( wallXYColour, wallZYColour, step(wallXYColour.a, wallZYColour.a) );\n\tinsideColor = mix( insideColor, verticalColour, step(insideColor.a, verticalColour.a)  );\n\t//insideColor = verticalColour;\n\t//insideColor = mix( insideColor, verticalColour, insideColor.a );\n\n} else {\n\n    float xVSz = step( rayFractions.x, rayFractions.z );\n\tinsideColor = mix( wallXYColour, wallZYColour, xVSz );\n\n\tfloat rayFraction_xVSz = mix( rayFractions.z, rayFractions.x, xVSz );\n\tfloat xzVSy = step( rayFraction_xVSz, rayFractions.y );\n\tinsideColor = mix( verticalColour, insideColor, xzVSy );\n\n}\n\n\n\n// exterior\n\nvec2 nuvo = vec2( 2.0, 4.0 );// texture reapeat\n\nvec4 Ftop = texture2D( map, tileUV( fract( oP.xz * wallFrequencies.xz ) , vec2(1.0,2.0), nuv ) );\nvec4 Fleft = texture2D( map, tileUV( fract( oP.zy * wallFrequencies.zy ) , vec2(1.0,1.0), nuv ) );\nvec4 Ffront = texture2D( map, tileUV( fract( oP.xy * wallFrequencies.xy ) , vec2(0.0,0.0), nuv ) );\n\nfloat n = abs(oN.z) > abs(oN.x) ? 1.0 : 0.0;\nfloat ny = abs(oN.y) > ( abs(oN.x) + abs(oN.z) * 0.5 ) ? 1.0 : 0.0;\n\nvec4 outsideColor =  mix( Fleft, Ffront, n );\n//outsideColor =  mix( outsideColor, Ftop, ny );\n\n\n//vec4 building_color = mapTexelToLinear(vec4( mix( insideColor, outsideColor, outsideColor.a ).xyz, 1.0));\nvec4 building_color = mapTexelToLinear( mix( insideColor, outsideColor, outsideColor.a ));\n\n//if(building_color.a < 0.01) discard;\n\ndiffuseColor *= building_color;\n\n#endif\n\n\n",Bm="\nvec4 emissiveColor = vec4( mix( insideColor, vec4(0.0, 0.0, 0.0, 1.0), outsideColor.a ).xyz, 1.0);\n//emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor.rgb );\ntotalEmissiveRadiance = emissiveColor.xyz*lightning*noiseColor.xyz;\n",Hm="\n#ifdef USE_NORMALMAP\n\nvec3 nWallFrequencies = wallFreq - wallsBias;\nvec2 nuvn = vec2( 2.0, 4.0 );\nvec3 Ntop = texture2D( normalMap, tileUV( fract( oP.xz * nWallFrequencies.xz ) , vec2(1.0,2.0), nuvn ) ).rgb;\nvec3 Nleft = texture2D( normalMap, tileUV( fract( oP.zy * nWallFrequencies.zy ) , vec2(1.0,1.0), nuvn ) ).rgb;\nvec3 Nfront = texture2D( normalMap, tileUV( fract( oP.xy * nWallFrequencies.xy ) , vec2(0.0,0.0), nuvn ) ).rgb;\n\nfloat nn = abs(oN.z) > abs(oN.x) ? 1.0 : 0.0;\nfloat nny = abs(oN.y) > ( abs(oN.x) + abs(oN.z) * 0.5 ) ? 1.0 : 0.0;\n\nvec3 tmpNormal =  mix( Nleft, Nfront, nn );\n//tmpNormal =  mix( tmpNormal, Ntop, nny );\ntmpNormal = tmpNormal * 2.0 - 1.0;\n\n\nvec3 eye_pos = -vViewPosition;\nvec3 surf_norm = normal;\n\nvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\nvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\nvec2 st0 = dFdx( vUv.st );\nvec2 st1 = dFdy( vUv.st );\n\nfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\nvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\nvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\nvec3 N = normalize( surf_norm );\nmat3 tsn = mat3( S, T, N );\n\nvec3 mapN = tmpNormal;//texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\nmapN.xy *= normalScale;\nmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\nnormal = normalize( tsn * mapN );\n\n#endif\n";const Gm="\n\nmat4 inverse(mat4 m) {\n\n    float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n    b00 = a00 * a11 - a01 * a10,\n    b01 = a00 * a12 - a02 * a10,\n    b02 = a00 * a13 - a03 * a10,\n    b03 = a01 * a12 - a02 * a11,\n    b04 = a01 * a13 - a03 * a11,\n    b05 = a02 * a13 - a03 * a12,\n    b06 = a20 * a31 - a21 * a30,\n    b07 = a20 * a32 - a22 * a30,\n    b08 = a20 * a33 - a23 * a30,\n    b09 = a21 * a32 - a22 * a31,\n    b10 = a21 * a33 - a23 * a31,\n    b11 = a22 * a33 - a23 * a32,\n\n  det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4( a11 * b11 - a12 * b10 + a13 * b09, a02 * b10 - a01 * b11 - a03 * b09, a31 * b05 - a32 * b04 + a33 * b03, a22 * b04 - a21 * b05 - a23 * b03, a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07, a32 * b02 - a30 * b05 - a33 * b01, a20 * b05 - a22 * b02 + a23 * b01, a10 * b10 - a11 * b08 + a13 * b06, a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00, a21 * b02 - a20 * b04 - a23 * b00, a11 * b07 - a10 * b09 - a12 * b06, a00 * b09 - a01 * b07 + a02 * b06, a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n",Vm="\nvarying vec3 vViewPosition;\n\nvarying mat4 invMat;\nvarying mat4 modelMatrixOn;\n\nvarying vec3 worldNormal;\nvarying vec3 vecPos;\n//varying vec3 vEye;\nvarying vec3 vI;\n",Wm="\n#include <fog_vertex>\n\nmodelMatrixOn = modelMatrix;\ninvMat = inverse( modelMatrix );\nvecPos = worldPosition.xyz;//(modelMatrix * vec4(position, 1.0 )).xyz;\n//worldNormal = (modelMatrix * vec4(normal,0.0)).xyz;\nworldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n//vEye = normalize(-cameraPosition);\nvI = normalize( worldPosition.xyz - cameraPosition );//vecPos - cameraPosition;\n\n",jm="\n\nfloat vReflectionFactor = mFresnelBias + mFresnelScale * pow( abs((1.0 + dot( normalize( vI ), vNormal ))), mFresnelPower );\n\nvec3 refractedColor = traceRayTest( vecPos, vI, normalize( worldNormal ) );\n\nvec3 finalColor = mix( refractedColor, refractedColor*outgoingLight, clamp( vReflectionFactor, 0.0, 1.0 ) );\n//vec3 finalColor = refractedColor * outgoingLight;\ngl_FragColor = vec4( finalColor, diffuseColor.a);\n//reflectedColor.rgb = textureCube( envMap, vec3( -vReflect.x, vReflect.yz ) ).rgb;\n\n",Xm="\n\n#define RAY_BOUNCES 5\n\nvarying mat4 invMat;\nvarying mat4 modelMatrixOn;\nvarying vec3 worldNormal;\nvarying vec3 vecPos;\n//varying vec3 vEye;\nvarying vec3 vI;\n\nuniform samplerCube normalCube;\nuniform bool bDebugBounces;\n\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\n\nuniform float refraction;\nuniform float aberration;\n\nuniform float normalOffset;\nuniform float squashFactor;\nuniform float distanceOffset;\nuniform float geometryFactor;\n\nuniform vec3 absorbption;\nuniform vec3 correction;\nuniform vec3 boost;\n\nuniform float radius;\nuniform vec3 centreOffset;\n\nvec3 BRDF_Specular_GGX_EnvironmentTest( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n    float dotNV = abs( dot( normal, viewDir ) );\n    const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n    const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n    vec4 r = roughness * c0 + c1; \n    float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n    vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n    return specularColor * AB.x + AB.y;\n}\n\nvec4 SampleSpecularReflectionTest( vec4 specularColor, vec3 direction ) {\n    direction.x *= -1.0;\n    direction.z *= -1.0;\n    //vec4 sampleColorRGB = envMapIntensity * envMapTexelToLinear(textureCubeUV( envMap, direction, 0.0 ));\n    vec4 sampleColorRGB = envMapIntensity * textureCubeUV( envMap, direction, 0.0 );\n    //sampleColorRGB = 1.0 * envMapTexelToLinear( sampleColorRGB );\n   // sampleColorRGB = vec4(1.0);\n   // if(sampleColorRGB.r + sampleColorRGB.g + sampleColorRGB.b < 0.5 ) sampleColorRGB = vec4(1.0);\n    sampleColorRGB = clamp( sampleColorRGB, 0.0, 1.0);\n    return sampleColorRGB;\n}\n\nvec4 SampleSpecularContributionTest( vec4 specularColor, vec3 direction ) { \n    direction = normalize(direction);\n    direction.x *= -1.0; \n    direction.z *= -1.0;\n    //vec4 sampleColorRGB = envMapIntensity * envMapTexelToLinear( textureCubeUV( envMap, direction, 0.0 ));\n    vec4 sampleColorRGB = envMapIntensity * textureCubeUV( envMap, direction, 0.0 );\n\n    //sampleColorRGB.a = 1.0;\n\n    sampleColorRGB = clamp( sampleColorRGB, 0.0, 1.0);\n    return sampleColorRGB;\n}\n\nvec3 intersectSphereTest( vec3 origin, vec3 direction ) {\n    origin -= centreOffset;\n    direction.y /= squashFactor;\n    float A = dot(direction, direction);\n    float B = 2.0*dot(origin, direction);\n    float C = dot(origin, origin) - radius * radius;\n    float disc = B*B - 4.0 * A * C;\n    if(disc > 0.0){ \n        disc = sqrt(disc);\n        float t1 = (-B + disc)*geometryFactor/A;\n        float t2 = (-B - disc)*geometryFactor/A;\n        float t = (t1 > t2) ? t1 : t2;\n        direction.y *= squashFactor;\n        return vec3(origin + centreOffset + direction * t);\n     }\n     return vec3(0.0); \n}\n\nvec3 debugBounces( int count ) { \n    vec3 color = vec3(1.,1.,1.);\n    if(count == 1) color = vec3(0.0,1.0,0.0);\n    else if(count == 2) color = vec3(0.0,0.0,1.0);\n    else if(count == 3) color = vec3(1.0,1.0,0.0);\n    else if(count == 4) color = vec3(0.0,1.0,1.0);\n    else color = vec3(0.0,1.0,0.0); \n    if(count == 0) color = vec3(1.0,0.0,0.0);\n    return color;\n}\n\nvec3 traceRayTest( vec3 origin, vec3 direction, vec3 normal ) { \n\n    mat4 invModelMat = invMat;\n\n    vec3 outColor = vec3(0.0); \n    // Reflect/Refract ray entering the diamond \n    const float n1 = 1.0; \n    const float epsilon = 1e-8;\n    float f0 = (2.4- n1)/(2.4 + n1);\n    f0 *= f0;\n    vec3 attenuationFactor = vec3(1.0);\n    vec3 newDirection = refract( direction, normal, n1/refraction ); \n    vec3 reflectedDirection = reflect(direction, normal);\n    vec3 brdfReflected = BRDF_Specular_GGX_EnvironmentTest(reflectedDirection, normal, vec3(f0), 0.0);\n    vec3 brdfRefracted = BRDF_Specular_GGX_EnvironmentTest(newDirection, -normal, vec3(f0), 0.0);\n    attenuationFactor *= ( vec3(1.0) - brdfRefracted);\n    outColor += SampleSpecularReflectionTest(vec4(1.0), reflectedDirection ).rgb * brdfReflected;\n    int count = 0;\n\n    newDirection = (invModelMat * vec4(newDirection, 0.0)).xyz; \n    newDirection = normalize(newDirection);\n    origin = (invModelMat * vec4(origin, 1.0)).xyz;\n\n    // ray bounces \n    for( int i=0; i<RAY_BOUNCES; i++) { \n\n        vec3 intersectedPos = intersectSphereTest(origin + vec3(epsilon), newDirection);\n        vec3 dist = intersectedPos - origin;\n        vec3 d = normalize(intersectedPos - centreOffset);\n        vec3 mappedNormal = textureCube( normalCube, d ).xyz;\n\n        //vec3 mappedNormal = normalize( vNormal ) * -1.0;\n\n\n        mappedNormal = 2. * mappedNormal - 1.0;\n        //mappedNormal.y += normalOffset;\n        mappedNormal = normalize(mappedNormal);\n        dist = (modelMatrixOn * vec4(dist, 1.)).xyz;\n        float r = sqrt(dot(dist, dist));\n        attenuationFactor *= exp(-r*absorbption);\n        // refract the ray at first intersection \n        vec3 oldOrigin = origin;\n        origin = intersectedPos - normalize(intersectedPos - centreOffset) * distanceOffset;\n        vec3 oldDir = newDirection;\n        newDirection = refract(newDirection, mappedNormal, refraction/n1);\n         \n        if( dot(newDirection, newDirection) == 0.0) { // Total Internal Reflection. Continue inside the diamond\n            newDirection = reflect(oldDir, mappedNormal);\n             //If the ray got trapped even after max iterations, simply sample along the outgoing refraction!\n            if( i == RAY_BOUNCES-1 ) {\n                vec3 brdfReflected = BRDF_Specular_GGX_EnvironmentTest(-oldDir, mappedNormal, vec3(f0), 0.0);\n                vec3 d1 = (modelMatrixOn * vec4(oldDir, 0.0)).xyz;\n                outColor += SampleSpecularContributionTest( vec4(1.0), d1 ).rgb * correction * attenuationFactor  * boost * (vec3(1.0) - brdfReflected);\n                //outColor = vec3(1.,0.,0.);\n                //if(d1.y > 0.95) outColor += d1.y * vec3(1.,0.,0) * attenuationFactor * (vec3(1.0) - brdfReflected) * boost;\n            } \n        \n        } else { // Add the contribution from outgoing ray, and continue the reflected ray inside the diamond \n           vec3 brdfRefracted = BRDF_Specular_GGX_EnvironmentTest(newDirection, -mappedNormal, vec3(f0), 0.0);\n           // outgoing(refracted) ray's contribution\n           vec3 d1 = (modelMatrixOn * vec4(newDirection, 0.0)).xyz;\n           vec3 colorG = SampleSpecularContributionTest(vec4(1.0), d1 ).rgb * ( vec3(1.0) - brdfRefracted);\n           vec3 dir1 = refract(oldDir, mappedNormal, (refraction+aberration)/n1);\n           vec3 dir2 = refract(oldDir, mappedNormal, (refraction-aberration)/n1);\n           vec3 d2 = (modelMatrixOn * vec4(dir1, 0.0)).xyz;\n           vec3 d3 = (modelMatrixOn * vec4(dir2, 0.0)).xyz;\n           vec3 colorR = SampleSpecularContributionTest(vec4(1.0), d2 ).rgb * ( vec3(1.0) - brdfRefracted);\n           vec3 colorB = SampleSpecularContributionTest(vec4(1.0), d3 ).rgb * ( vec3(1.0) - brdfRefracted);\n           outColor += vec3(colorR.r, colorG.g, colorB.b) * correction * attenuationFactor * boost;\n           //outColor = oldDir;\n           //new reflected ray inside the diamond\n           newDirection = reflect(oldDir, mappedNormal);\n           vec3 brdfReflected = BRDF_Specular_GGX_EnvironmentTest(newDirection, mappedNormal, vec3(f0), 0.0);\n           attenuationFactor *= brdfReflected * boost;\n           count++;\n        } \n    }\n    if(bDebugBounces) outColor = debugBounces(count); \n    //outColor = (textureCube( tCubeMapNormals, direction )).rgb;\n    //outColor = texture2D( sphereMap, vUv ).rgb\n\n    return outColor;\n    \n}\n\nvoid main() {\n\n",Ym=new ni,qm=new Wt;class Qm{constructor(t){let e=t.geometry;if(!e.isBufferGeometry||3!==e.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");e.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),e=e.toNonIndexed()),this.geometry=e,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(t){return this.weightAttribute=t?this.geometry.getAttribute(t):null,this}build(){const t=this.positionAttribute,e=this.weightAttribute,i=new Float32Array(t.count/3);for(let n=0;n<t.count;n+=3){let s=1;e&&(s=e.getX(n)+e.getX(n+1)+e.getX(n+2)),Ym.a.fromBufferAttribute(t,n),Ym.b.fromBufferAttribute(t,n+1),Ym.c.fromBufferAttribute(t,n+2),s*=Ym.getArea(),i[n/3]=s}this.distribution=new Float32Array(t.count/3);let n=0;for(let t=0;t<i.length;t++)n+=i[t],this.distribution[t]=n;return this}setRandomGenerator(t){return this.randomFunction=t,this}sample(t,e,i){const n=this.distribution[this.distribution.length-1],s=this.binarySearch(this.randomFunction()*n);return this.sampleFace(s,t,e,i)}binarySearch(t){const e=this.distribution;let i=0,n=e.length-1,s=-1;for(;i<=n;){const r=Math.ceil((i+n)/2);if(0===r||e[r-1]<=t&&e[r]>t){s=r;break}t<e[r]?n=r-1:i=r+1}return s}sampleFace(t,e,i,n){let s=this.randomFunction(),r=this.randomFunction();return s+r>1&&(s=1-s,r=1-r),Ym.a.fromBufferAttribute(this.positionAttribute,3*t),Ym.b.fromBufferAttribute(this.positionAttribute,3*t+1),Ym.c.fromBufferAttribute(this.positionAttribute,3*t+2),e.set(0,0,0).addScaledVector(Ym.a,s).addScaledVector(Ym.b,r).addScaledVector(Ym.c,1-(s+r)),void 0!==i&&Ym.getNormal(i),void 0!==n&&void 0!==this.colorAttribute&&(Ym.a.fromBufferAttribute(this.colorAttribute,3*t),Ym.b.fromBufferAttribute(this.colorAttribute,3*t+1),Ym.c.fromBufferAttribute(this.colorAttribute,3*t+2),qm.set(0,0,0).addScaledVector(Ym.a,s).addScaledVector(Ym.b,r).addScaledVector(Ym.c,1-(s+r)),n.r=qm.x,n.g=qm.y,n.b=qm.z),this}}const Zm="\n#include <clipping_planes_pars_vertex>\n\nattribute float sizer;\nattribute float alphas;\nattribute float angles;\n\nvarying float aaa;\nvarying float ang;\n",Jm="\n#include <fog_vertex>\n\naaa = alphas;\nang = angles;\n\ngl_PointSize *= sizer;\n\n",Km="\n#include <clipping_planes_pars_fragment>\n\nvarying float aaa;\nvarying float ang;\n\nvec2 rotUV(vec2 uv, float angle){\n    float s = sin(angle);\n    float c = cos(angle);\n    mat2 r = mat2( c, -s, s, c);\n    r *= 0.5; r += 0.5; r = r * 2.0 - 1.0;\n    uv -= 0.5; uv = uv * r; uv += 0.5;\n    return uv;\n}\n",$m="\n\ngl_FragColor.a *= aaa;\n\n//gl_FragColor = vec4( outgoingLight, diffuseColor.a * aaa  );\n//gl_FragColor = vec4( outgoingLight, aaa );\n\n",tf="\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\n#endif\n\n#ifdef USE_MAP\n\n\tvec4 mapTexel = texture2D( map, rotUV( uv, ang ) );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n\n#endif\n";var ef="rgba(39, 40, 34, 1)";var nf="\n  .codeflask {\n    -o-user-select:none; -ms-user-select:none; -khtml-user-select:none; -webkit-user-select:none; -moz-user-select: none;\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n  }\n\n  .codeflask, .codeflask * {\n    box-sizing: border-box;\n  }\n\n  .codeflask__pre {\n    -o-user-select:none; -ms-user-select:none; -khtml-user-select:none; -webkit-user-select:none; -moz-user-select: none; pointer-events:none;\n    z-index: 3;\n    overflow: hidden;\n    //background:green;\n  }\n\n  .codeflask__textarea {\n\n    background: none;\n    //background:red;\n    border: none;\n    color: "+(function(t,e){return"undefined"!=typeof CSS?CSS.supports(t,e):"undefined"!=typeof document&&function(t){return(t=t.split("-").filter((function(t){return!!t})).map((function(t){return t[0].toUpperCase()+t.substr(1)})).join(""))[0].toLowerCase()+t.substr(1)}(t)in document.body.style}("caret-color","#F00")?ef:"#ccc")+";\n    z-index: 1;\n    resize: none;\n    font-family: "+"Consolas;\n    //-webkit-appearance: pre;\n    caret-color: #fff;\n    z-index: 2;\n    width: 100%;\n    height: 100%;\n  }\n\n  .codeflask--has-line-numbers .codeflask__textarea {\n    width: calc(100% - "+"40px);\n  }\n\n  .codeflask__code {\n    //padding: 10px;\n    //background:yellow;\n    display: block;\n    font-family: "+"Consolas;\n    overflow: hidden;\n  }\n\n  .codeflask__flatten {\n\n    //background:grey;\n    padding: 10px;\n    font-size: 12px;\n    line-height: "+"15px;\n    white-space: pre;\n    position: absolute;\n    top: 0;\n    left: 0;\n    overflow: auto;\n    margin: 0 !important;\n    outline: none;\n    text-align: left;\n    cursor:auto;\n  }\n\n  .codeflask--has-line-numbers .codeflask__flatten {\n    width: calc(100% - "+"40px);\n    left: "+"40px;\n  }\n\n  .codeflask__line-highlight {\n    position: absolute;\n    top: 10px;\n    left: 0;\n    width: 100%;\n    height: "+"15px;\n    background: rgba(0,0,0,0.1);\n    z-index: 1;\n  }\n\n  .codeflask__lines {\n    padding: 10px 4px;\n    font-size: 12px;\n    line-height: "+"15px;\n    font-family: 'Cousine', monospace;\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: "+"40px;\n    height: 100%;\n    text-align: right;\n    color: #90918b;\n    z-index: 2;\n  }\n\n  .codeflask__lines__line {\n    display: block;\n  }\n\n  .codeflask.codeflask--has-line-numbers {\n    padding-left: "+"40px;\n  }\n\n  .codeflask.codeflask--has-line-numbers:before {\n    content: '';\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: "+"40px;\n    height: 100%;\n    /*background: "+ef+";*/\n    z-index: 1;\n  }\n";function sf(t,e,i){var n=e||"codeflask-style",s=i||document.head;if(!t)return!1;if(document.getElementById(n))return!0;var r=document.createElement("style");return r.innerHTML=t,r.id=n,s.appendChild(r),!0}var rf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function af(t){return String(t).replace(/[&<>"'`=/]/g,(function(t){return rf[t]}))}var of="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var lf=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t){var e=function(t){var e=/\blang(?:uage)?-([\w-]+)\b/i,i=0,n={manual:t.Prism&&t.Prism.manual,disableWorkerMessageHandler:t.Prism&&t.Prism.disableWorkerMessageHandler,util:{encode:function t(e){return e instanceof s?new s(e.type,t(e.content),e.alias):Array.isArray(e)?e.map(t):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(t){return Object.prototype.toString.call(t).slice(8,-1)},objId:function(t){return t.__id||Object.defineProperty(t,"__id",{value:++i}),t.__id},clone:function t(e,i){var s,r;switch(i=i||{},n.util.type(e)){case"Object":if(r=n.util.objId(e),i[r])return i[r];for(var a in s={},i[r]=s,e)e.hasOwnProperty(a)&&(s[a]=t(e[a],i));return s;case"Array":return r=n.util.objId(e),i[r]?i[r]:(s=[],i[r]=s,e.forEach((function(e,n){s[n]=t(e,i)})),s);default:return e}},getLanguage:function(t){for(;t&&!e.test(t.className);)t=t.parentElement;return t?(t.className.match(e)||[,"none"])[1].toLowerCase():"none"},currentScript:function(){if("undefined"==typeof document)return null;if("currentScript"in document)return document.currentScript;try{throw new Error}catch(n){var t=(/at [^(\r\n]*\((.*):.+:.+\)$/i.exec(n.stack)||[])[1];if(t){var e=document.getElementsByTagName("script");for(var i in e)if(e[i].src==t)return e[i]}return null}},isActive:function(t,e,i){for(var n="no-"+e;t;){var s=t.classList;if(s.contains(e))return!0;if(s.contains(n))return!1;t=t.parentElement}return!!i}},languages:{extend:function(t,e){var i=n.util.clone(n.languages[t]);for(var s in e)i[s]=e[s];return i},insertBefore:function(t,e,i,s){var r=(s=s||n.languages)[t],a={};for(var o in r)if(r.hasOwnProperty(o)){if(o==e)for(var l in i)i.hasOwnProperty(l)&&(a[l]=i[l]);i.hasOwnProperty(o)||(a[o]=r[o])}var h=s[t];return s[t]=a,n.languages.DFS(n.languages,(function(e,i){i===h&&e!=t&&(this[e]=a)})),a},DFS:function t(e,i,s,r){r=r||{};var a=n.util.objId;for(var o in e)if(e.hasOwnProperty(o)){i.call(e,o,e[o],s||o);var l=e[o],h=n.util.type(l);"Object"!==h||r[a(l)]?"Array"!==h||r[a(l)]||(r[a(l)]=!0,t(l,i,o,r)):(r[a(l)]=!0,t(l,i,null,r))}}},plugins:{},highlightAll:function(t,e){n.highlightAllUnder(document,t,e)},highlightAllUnder:function(t,e,i){var s={callback:i,container:t,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};n.hooks.run("before-highlightall",s),s.elements=Array.prototype.slice.apply(s.container.querySelectorAll(s.selector)),n.hooks.run("before-all-elements-highlight",s);for(var r,a=0;r=s.elements[a++];)n.highlightElement(r,!0===e,s.callback)},highlightElement:function(i,s,r){var a=n.util.getLanguage(i),o=n.languages[a];i.className=i.className.replace(e,"").replace(/\s+/g," ")+" language-"+a;var l=i.parentElement;l&&"pre"===l.nodeName.toLowerCase()&&(l.className=l.className.replace(e,"").replace(/\s+/g," ")+" language-"+a);var h={element:i,language:a,grammar:o,code:i.textContent};function c(t){h.highlightedCode=t,n.hooks.run("before-insert",h),h.element.innerHTML=h.highlightedCode,n.hooks.run("after-highlight",h),n.hooks.run("complete",h),r&&r.call(h.element)}if(n.hooks.run("before-sanity-check",h),!h.code)return n.hooks.run("complete",h),void(r&&r.call(h.element));if(n.hooks.run("before-highlight",h),h.grammar)if(s&&t.Worker){var u=new Worker(n.filename);u.onmessage=function(t){c(t.data)},u.postMessage(JSON.stringify({language:h.language,code:h.code,immediateClose:!0}))}else c(n.highlight(h.code,h.grammar,h.language));else c(n.util.encode(h.code))},highlight:function(t,e,i){var r={code:t,grammar:e,language:i};return n.hooks.run("before-tokenize",r),r.tokens=n.tokenize(r.code,r.grammar),n.hooks.run("after-tokenize",r),s.stringify(n.util.encode(r.tokens),r.language)},tokenize:function(t,e){var i=e.rest;if(i){for(var l in i)e[l]=i[l];delete e.rest}var h=new function(){var t={value:null,prev:null,next:null},e={value:null,prev:t,next:null};t.next=e,this.head=t,this.tail=e,this.length=0};return a(h,h.head,t),function t(e,i,l,h,c,u){for(var d in l)if(l.hasOwnProperty(d)&&l[d]){var p=l[d];p=Array.isArray(p)?p:[p];for(var m=0;m<p.length;++m){if(u&&u.cause==d+","+m)return;var f=p[m],g=f.inside,v=!!f.lookbehind,x=!!f.greedy,y=f.alias;if(x&&!f.pattern.global){var b=f.pattern.toString().match(/[imsuy]*$/)[0];f.pattern=RegExp(f.pattern.source,b+"g")}for(var w=f.pattern||f,_=h.next,M=c;_!==i.tail&&!(u&&M>=u.reach);M+=_.value.length,_=_.next){var S=_.value;if(i.length>e.length)return;if(!(S instanceof s)){var T,A=1;if(x){if(!(T=r(w,M,e,v)))break;var E=T.index,L=T.index+T[0].length,C=M;for(C+=_.value.length;E>=C;)C+=(_=_.next).value.length;if(M=C-=_.value.length,_.value instanceof s)continue;for(var P=_;P!==i.tail&&(C<L||"string"==typeof P.value);P=P.next)A++,C+=P.value.length;A--,S=e.slice(M,C),T.index-=M}else if(!(T=r(w,0,S,v)))continue;E=T.index;var R=T[0],F=S.slice(0,E),I=S.slice(E+R.length),D=M+S.length;u&&D>u.reach&&(u.reach=D);var N=_.prev;F&&(N=a(i,N,F),M+=F.length),o(i,N,A),_=a(i,N,new s(d,g?n.tokenize(R,g):R,y,R)),I&&a(i,_,I),A>1&&t(e,i,l,_.prev,M,{cause:d+","+m,reach:D})}}}}}(t,h,e,h.head,0),function(t){for(var e=[],i=t.head.next;i!==t.tail;)e.push(i.value),i=i.next;return e}(h)},hooks:{all:{},add:function(t,e){var i=n.hooks.all;i[t]=i[t]||[],i[t].push(e)},run:function(t,e){var i=n.hooks.all[t];if(i&&i.length)for(var s,r=0;s=i[r++];)s(e)}},Token:s};function s(t,e,i,n){this.type=t,this.content=e,this.alias=i,this.length=0|(n||"").length}function r(t,e,i,n){t.lastIndex=e;var s=t.exec(i);if(s&&n&&s[1]){var r=s[1].length;s.index+=r,s[0]=s[0].slice(r)}return s}function a(t,e,i){var n=e.next,s={value:i,prev:e,next:n};return e.next=s,n.prev=s,t.length++,s}function o(t,e,i){for(var n=e.next,s=0;s<i&&n!==t.tail;s++)n=n.next;e.next=n,n.prev=e,t.length-=s}if(t.Prism=n,s.stringify=function t(e,i){if("string"==typeof e)return e;if(Array.isArray(e)){var s="";return e.forEach((function(e){s+=t(e,i)})),s}var r={type:e.type,content:t(e.content,i),tag:"span",classes:["token",e.type],attributes:{},language:i},a=e.alias;a&&(Array.isArray(a)?Array.prototype.push.apply(r.classes,a):r.classes.push(a)),n.hooks.run("wrap",r);var o="";for(var l in r.attributes)o+=" "+l+'="'+(r.attributes[l]||"").replace(/"/g,"&quot;")+'"';return"<"+r.tag+' class="'+r.classes.join(" ")+'"'+o+">"+r.content+"</"+r.tag+">"},!t.document)return t.addEventListener?(n.disableWorkerMessageHandler||t.addEventListener("message",(function(e){var i=JSON.parse(e.data),s=i.language,r=i.code,a=i.immediateClose;t.postMessage(n.highlight(r,n.languages[s],s)),a&&t.close()}),!1),n):n;var l=n.util.currentScript();function h(){n.manual||n.highlightAll()}if(l&&(n.filename=l.src,l.hasAttribute("data-manual")&&(n.manual=!0)),!n.manual){var c=document.readyState;"loading"===c||"interactive"===c&&l&&l.defer?document.addEventListener("DOMContentLoaded",h):window.requestAnimationFrame?window.requestAnimationFrame(h):window.setTimeout(h,16)}return n}("undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{});t.exports&&(t.exports=e),void 0!==of&&(of.Prism=e),e.languages.markup={comment:/<!--[\s\S]*?-->/,prolog:/<\?[\s\S]+?\?>/,doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/,name:/[^\s<>'"]+/}},cdata:/<!\[CDATA\[[\s\S]*?]]>/i,tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},e.languages.markup.tag.inside["attr-value"].inside.entity=e.languages.markup.entity,e.languages.markup.doctype.inside["internal-subset"].inside=e.languages.markup,e.hooks.add("wrap",(function(t){"entity"===t.type&&(t.attributes.title=t.content.replace(/&amp;/,"&"))})),Object.defineProperty(e.languages.markup.tag,"addInlined",{value:function(t,i){var n={};n["language-"+i]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:e.languages[i]},n.cdata=/^<!\[CDATA\[|\]\]>$/i;var s={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:n}};s["language-"+i]={pattern:/[\s\S]+/,inside:e.languages[i]};var r={};r[t]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,(function(){return t})),"i"),lookbehind:!0,greedy:!0,inside:s},e.languages.insertBefore("markup","cdata",r)}}),e.languages.html=e.languages.markup,e.languages.mathml=e.languages.markup,e.languages.svg=e.languages.markup,e.languages.xml=e.languages.extend("markup",{}),e.languages.ssml=e.languages.xml,e.languages.atom=e.languages.xml,e.languages.rss=e.languages.xml,function(t){var e=/("|')(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/;t.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:/@[\w-](?:[^;{\s]|\s+(?![\s{]))*(?:;|(?=\s*\{))/,inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+e.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+e.source+"$"),alias:"url"}}},selector:RegExp("[^{}\\s](?:[^{};\"'\\s]|\\s+(?![\\s{])|"+e.source+")*(?=\\s*\\{)"),string:{pattern:e,greedy:!0},property:/(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,important:/!important\b/i,function:/[-a-z0-9]+(?=\()/i,punctuation:/[(){};:,]/},t.languages.css.atrule.inside.rest=t.languages.css;var i=t.languages.markup;i&&(i.tag.addInlined("style","css"),t.languages.insertBefore("inside","attr-value",{"style-attr":{pattern:/(^|["'\s])style\s*=\s*(?:"[^"]*"|'[^']*')/i,lookbehind:!0,inside:{"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{style:{pattern:/(["'])[\s\S]+(?=["']$)/,lookbehind:!0,alias:"language-css",inside:t.languages.css},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}},"attr-name":/^style/i}}},i.tag))}(e),e.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|interface|extends|implements|trait|instanceof|new)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:if|else|while|do|for|return|in|instanceof|function|new|try|throw|catch|finally|null|break|continue)\b/,boolean:/\b(?:true|false)\b/,function:/\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},e.languages.javascript=e.languages.extend("clike",{"class-name":[e.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:prototype|constructor))/,lookbehind:!0}],keyword:[{pattern:/((?:^|})\s*)(?:catch|finally)\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|for|from|function|(?:get|set)(?=\s*[\[$\w\xA0-\uFFFF])|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:/\b(?:(?:0[xX](?:[\dA-Fa-f](?:_[\dA-Fa-f])?)+|0[bB](?:[01](?:_[01])?)+|0[oO](?:[0-7](?:_[0-7])?)+)n?|(?:\d(?:_\d)?)+n|NaN|Infinity)\b|(?:\b(?:\d(?:_\d)?)+\.?(?:\d(?:_\d)?)*|\B\.(?:\d(?:_\d)?)+)(?:[Ee][+-]?(?:\d(?:_\d)?)+)?/,operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),e.languages.javascript["class-name"][0].pattern=/(\b(?:class|interface|extends|implements|instanceof|new)\s+)[\w.\\]+/,e.languages.insertBefore("javascript","keyword",{regex:{pattern:/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)\/(?:\[(?:[^\]\\\r\n]|\\.)*]|\\.|[^/\\\[\r\n])+\/[gimyus]{0,6}(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/,lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:e.languages.regex},"regex-flags":/[a-z]+$/,"regex-delimiter":/^\/|\/$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:e.languages.javascript},{pattern:/(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,inside:e.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:e.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:e.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),e.languages.insertBefore("javascript","string",{"template-string":{pattern:/`(?:\\[\s\S]|\${(?:[^{}]|{(?:[^{}]|{[^}]*})*})+}|(?!\${)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\${(?:[^{}]|{(?:[^{}]|{[^}]*})*})+}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\${|}$/,alias:"punctuation"},rest:e.languages.javascript}},string:/[\s\S]+/}}}),e.languages.markup&&e.languages.markup.tag.addInlined("script","javascript"),e.languages.js=e.languages.javascript,function(){if("undefined"!=typeof self&&self.Prism&&self.document){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var t=window.Prism,e={js:"javascript",py:"python",rb:"ruby",ps1:"powershell",psm1:"powershell",sh:"bash",bat:"batch",h:"c",tex:"latex"},i='pre[data-src]:not([data-src-status="loaded"]):not([data-src-status="loading"])',n=/\blang(?:uage)?-([\w-]+)\b/i;t.hooks.add("before-highlightall",(function(t){t.selector+=", "+i})),t.hooks.add("before-sanity-check",(function(n){var s=n.element;if(s.matches(i)){n.code="",s.setAttribute("data-src-status","loading");var a=s.appendChild(document.createElement("CODE"));a.textContent="Loading";var o=s.getAttribute("data-src"),l=n.language;if("none"===l){var h=(/\.(\w+)$/.exec(o)||[,"none"])[1];l=e[h]||h}r(a,l),r(s,l);var c=t.plugins.autoloader;c&&c.loadLanguages(l);var u=new XMLHttpRequest;u.open("GET",o,!0),u.onreadystatechange=function(){4==u.readyState&&(u.status<400&&u.responseText?(s.setAttribute("data-src-status","loaded"),a.textContent=u.responseText,t.highlightElement(a)):(s.setAttribute("data-src-status","failed"),u.status>=400?a.textContent=" Error "+u.status+" while fetching file: "+u.statusText:a.textContent=" Error: File does not exist or is empty"))},u.send(null)}})),t.plugins.fileHighlight={highlight:function(e){for(var n,s=(e||document).querySelectorAll(i),r=0;n=s[r++];)t.highlightElement(n)}};var s=!1;t.fileHighlight=function(){s||(console.warn("Prism.fileHighlight is deprecated. Use `Prism.plugins.fileHighlight.highlight` instead."),s=!0),t.plugins.fileHighlight.highlight.apply(this,arguments)}}function r(t,e){var i=t.className;i=i.replace(n," ")+" language-"+e,t.className=i.replace(/\s+/g," ").trim()}}()})),hf=function(t,e){if(lf.languages.javascript.operator=/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~]/,!t)throw Error("CodeFlask expects a parameter which is Element or a String selector");if(!e)throw Error("CodeFlask expects an object containing options as second parameter");if(t.nodeType)this.editorRoot=t;else{var i=document.querySelector(t);i&&(this.editorRoot=i)}this.opts=e,this.startEditor()};hf.prototype.clear=function(){this.elPre.removeChild(this.elCode),this.opts.lineNumbers&&this.elWrapper.removeChild(this.elLineNumbers),this.elWrapper.removeChild(this.elPre),this.elWrapper.removeChild(this.elTextarea),this.editorRoot.removeChild(this.elWrapper),this.code="",this.editorRoot.innerHTML=""},hf.prototype.startEditor=function(){if(!sf(nf,null,this.opts.styleParent))throw Error("Failed to inject CodeFlask CSS.");this.isEdit=!1,this.createWrapper(),this.createTextarea(),this.createPre(),this.createCode(),this.runOptions(),this.listenTextarea(),this.populateDefault(),this.updateCode(this.code)},hf.prototype.getDom=function(){return this.elWrapper},hf.prototype.getText=function(){return this.elTextarea},hf.prototype.createWrapper=function(){this.code=this.editorRoot.innerHTML,this.editorRoot.innerHTML="",this.elWrapper=this.createElement("div",this.editorRoot),this.elWrapper.classList.add("codeflask")},hf.prototype.createTextarea=function(){this.elTextarea=this.createElement("textarea",this.elWrapper),this.elTextarea.classList.add("codeflask__textarea","codeflask__flatten")},hf.prototype.createPre=function(){this.elPre=this.createElement("pre",this.elWrapper),this.elPre.classList.add("codeflask__pre","codeflask__flatten")},hf.prototype.createCode=function(){this.elCode=this.createElement("code",this.elPre),this.elCode.classList.add("codeflask__code","language-"+(this.opts.language||"html"))},hf.prototype.createLineNumbers=function(){this.elLineNumbers=this.createElement("div",this.elWrapper),this.elLineNumbers.classList.add("codeflask__lines"),this.setLineNumber()},hf.prototype.createElement=function(t,e){var i=document.createElement(t);return e.appendChild(i),i},hf.prototype.runOptions=function(){this.opts.rtl=this.opts.rtl||!1,this.opts.tabSize=this.opts.tabSize||4,this.opts.enableAutocorrect=this.opts.enableAutocorrect||!1,this.opts.lineNumbers=this.opts.lineNumbers||!1,this.opts.defaultTheme=!1!==this.opts.defaultTheme,this.opts.areaId=this.opts.areaId||null,this.opts.ariaLabelledby=this.opts.ariaLabelledby||null,this.opts.readonly=this.opts.readonly||null,"boolean"!=typeof this.opts.handleTabs&&(this.opts.handleTabs=!0),"boolean"!=typeof this.opts.handleSelfClosingCharacters&&(this.opts.handleSelfClosingCharacters=!0),"boolean"!=typeof this.opts.handleNewLineIndentation&&(this.opts.handleNewLineIndentation=!0),!0===this.opts.rtl&&(this.elTextarea.setAttribute("dir","rtl"),this.elPre.setAttribute("dir","rtl")),!1===this.opts.enableAutocorrect&&(this.elTextarea.setAttribute("spellcheck","false"),this.elTextarea.setAttribute("autocapitalize","off"),this.elTextarea.setAttribute("autocomplete","off"),this.elTextarea.setAttribute("autocorrect","off")),this.opts.lineNumbers&&(this.elWrapper.classList.add("codeflask--has-line-numbers"),this.createLineNumbers()),this.opts.defaultTheme&&sf("\n.codeflask {\n  background: rgba(39, 40, 34, 1);\n  color: #f8f8f2;\n  //border-radius: 12px;\n  //text-shadow: 1px 1px 1px black;\n  //resize: true;\n}\n\n.codeflask ::-webkit-scrollbar {\n  width: 15px;\n  height:15px;\n}\n\n.codeflask ::-webkit-scrollbar-track {\n  background:none;\n  /*background-clip: content-box;*/\n  \n}\n\n.codeflask ::-webkit-scrollbar-thumb {\n  background-color: #555652; \n  width: 7px;\n  //border-radius: 12px;\n  border: 4px solid rgba(39, 40, 34, 1);\n}\n\n.codeflask ::-webkit-scrollbar-corner {\n  background-color: rgba(0,0,0,0);\n}\n\n\n\n.codeflask ::selection {\n  color: white;\n  background: rgba(71, 71, 61, 0.5);\n}\n\n.codeflask ::-moz-selection{\n  color: white;\n  background: rgba(71, 71, 61, 0.5);\n}\n\n.codeflask .token.punctuation { color: #f8f8f2; }\n\n.codeflask .token.keyword { color: #67d8ef; font-style: italic;}\n.codeflask .token.string { color: #e7db75; }\n.codeflask .token.comment { color: #75715e; }\n.codeflask .token.function { color: #a6e22c }\n.codeflask .token.function-variable { color: #a6e22c }\n.codeflask .token.number { color: #ae81ff; }\n.codeflask .token.operator { color: #ff5598; }\n.codeflask .token.boolean { color: #ae81ff; }\n.codeflask .token.parameter { color: #fd9621; }\n\n.codeflask .token-template-string { color: #FF0000 }\n.codeflask .token-class-name { color: #FF0000 }\n\n.codeflask .token-regex { color: #FF0000 }\n\n.codeflask .token.selector {\n  color: #00FF00;\n}\n\n.codeflask .token.property {\n  color: #ac80ff;\n}\n\n.codeflask .token.tag {\n  color: #FFFF00;\n}\n\n.codeflask .token.attr-value {\n  color: #0000FF;\n}\n","theme-default",this.opts.styleParent),this.opts.areaId&&this.elTextarea.setAttribute("id",this.opts.areaId),this.opts.ariaLabelledby&&this.elTextarea.setAttribute("aria-labelledby",this.opts.ariaLabelledby),this.opts.readonly&&this.enableReadonlyMode()},hf.prototype.updateLineNumbersCount=function(){for(var t="",e=1;e<=this.lineNumber;e++)t=t+'<span class="codeflask__lines__line">'+e+"</span>";this.elLineNumbers.innerHTML=t},hf.prototype.listenTextarea=function(){var t=this;this.elTextarea.addEventListener("input",(function(e){t.code=e.target.value,t.elCode.innerHTML=af(e.target.value),t.highlight(),setTimeout((function(){t.runUpdate(),t.setLineNumber()}),1)})),this.elTextarea.addEventListener("keydown",(function(e){t.opts.readonly||(t.handleTabs(e),t.handleSelfClosingCharacters(e),t.handleNewLineIndentation(e),t.isEdit=!0)})),this.elTextarea.addEventListener("scroll",(function(e){t.elPre.style.transform="translate3d(-"+e.target.scrollLeft+"px, -"+e.target.scrollTop+"px, 0)",t.elLineNumbers&&(t.elLineNumbers.style.transform="translate3d(0, -"+e.target.scrollTop+"px, 0)")}))},hf.prototype.handleTabs=function(t){if(this.opts.handleTabs){if(9!==t.keyCode)return!1;t.preventDefault();var e=this.elTextarea,i=e.selectionDirection,n=e.selectionStart,s=e.selectionEnd,r=e.value,a=r.substr(0,n),o=r.substring(n,s),l=r.substring(s),h=" ".repeat(this.opts.tabSize);if(n!==s&&o.length>=h.length){var c=n-a.split("\n").pop().length,u=h.length,d=h.length;t.shiftKey?(r.substr(c,h.length)===h?(u=-u,c>n?(o=o.substring(0,c)+o.substring(c+h.length),d=0):c===n?(u=0,d=0,o=o.substring(h.length)):(d=-d,a=a.substring(0,c)+a.substring(c+h.length))):(u=0,d=0),o=o.replace(new RegExp("\n"+h.split("").join("\\"),"g"),"\n")):(a=a.substr(0,c)+h+a.substring(c,n),o=o.replace(/\n/g,"\n"+h)),e.value=a+o+l,e.selectionStart=n+u,e.selectionEnd=n+o.length+d,e.selectionDirection=i}else e.value=a+h+l,e.selectionStart=n+h.length,e.selectionEnd=n+h.length;var p=e.value;this.updateCode(p),this.elTextarea.selectionEnd=s+this.opts.tabSize}return!0},hf.prototype.handleSelfClosingCharacters=function(t){if(this.opts.handleSelfClosingCharacters){var e=t.key;if(!["(","[","{","<","'",'"'].includes(e)&&![")","]","}",">","'",'"'].includes(e))return!1;switch(e){case"(":case")":this.closeCharacter(e);break;case"[":case"]":this.closeCharacter(e);break;case"{":case"}":this.closeCharacter(e);break;case"<":case">":case"'":case'"':this.closeCharacter(e)}return!0}},hf.prototype.setLineNumber=function(){this.lineNumber=this.code.split("\n").length,this.opts.lineNumbers&&this.updateLineNumbersCount()},hf.prototype.handleNewLineIndentation=function(t){if(!this.opts.handleNewLineIndentation)return!1;if(13!==t.keyCode)return!1;t.preventDefault();var e=this.elTextarea,i=e.selectionStart,n=e.selectionEnd,s=e.value,r=s.substr(0,i),a=s.substring(n),o=s.lastIndexOf("\n",i-1),l=o+s.slice(o+1).search(/[^ ]|$/),h=l>o?l-o:0,c=r+"\n"+" ".repeat(h)+a;return e.value=c,e.selectionStart=i+h+1,e.selectionEnd=i+h+1,this.updateCode(e.value),!0},hf.prototype.closeCharacter=function(t){var e=this.elTextarea.selectionStart,i=this.elTextarea.selectionEnd;if(this.skipCloseChar(t)){var n=this.code.substr(i,1)===t,s=n?i+1:i,r=!n&&["'",'"'].includes(t)?t:"",a=""+this.code.substring(0,e)+r+this.code.substring(s);this.updateCode(a),this.elTextarea.selectionEnd=++this.elTextarea.selectionStart}else{var o=t;switch(t){case"(":o=String.fromCharCode(t.charCodeAt()+1);break;case"<":case"{":case"[":o=String.fromCharCode(t.charCodeAt()+2)}var l=this.code.substring(e,i),h=""+this.code.substring(0,e)+l+o+this.code.substring(i);this.updateCode(h)}this.elTextarea.selectionEnd=e},hf.prototype.skipCloseChar=function(t){var e=this.elTextarea.selectionStart,i=this.elTextarea.selectionEnd,n=Math.abs(i-e)>0;return[")","}","]",">"].includes(t)||["'",'"'].includes(t)&&!n},hf.prototype.updateCode=function(t){this.isEdit=!1,this.code=t,this.elTextarea.value=t,this.elCode.innerHTML=af(t),this.highlight(),this.setLineNumber(),setTimeout(this.runUpdate.bind(this),1)},hf.prototype.updateLanguage=function(t){var e=this.opts.language;this.elCode.classList.remove("language-"+e),this.elCode.classList.add("language-"+t),this.opts.language=t,this.highlight()},hf.prototype.addLanguage=function(t,e){lf.languages[t]=e},hf.prototype.populateDefault=function(){this.updateCode(this.code)},hf.prototype.highlight=function(){lf.highlightElement(this.elCode,!1)},hf.prototype.onUpdate=function(t){if(t&&"[object Function]"!=={}.toString.call(t))throw Error("CodeFlask expects callback of type Function");this.updateCallBack=t},hf.prototype.getCode=function(){return this.code},hf.prototype.runUpdate=function(){this.updateCallBack&&this.updateCallBack(this.code)},hf.prototype.enableReadonlyMode=function(){this.elTextarea.setAttribute("readonly",!0)},hf.prototype.disableReadonlyMode=function(){this.elTextarea.removeAttribute("readonly")};class cf{constructor(){this.isOpen=!1,this.left=0}show(){this.isOpen?this.close():this.open(),Main.setLeft(this.left)}open(){this.left=.5*window.innerWidth-200,this.isOpen=!0;let t="-o-user-select:none; -ms-user-select:none; -khtml-user-select:none; -webkit-user-select:none; -moz-user-select: none; pointer-events:none; ";this.content=document.createElement("div"),this.content.style.cssText="position:absolute; margin:0; padding:0; top:0px; left:0px; width:"+this.left+"px;  height:100%; ",this.content.style.cssText+="font-size:18px; font-family:Tahoma; color:#f8f8f2; background: #20211c;",document.body.appendChild(this.content),this.codeContent=document.createElement("div"),this.codeContent.style.cssText="font-smooth: antialiased; -webkit-font-smoothing : antialiased; -moz-osx-font-smoothing: grayscale;position:absolute; margin:0; padding:0; top:30px; left:3px; width:calc( 100% - 6px); height:calc( 100% - 60px); border-top: 1px solid #3e4036; border-bottom: 1px solid #3e4036;",this.code=new hf(this.codeContent,{language:"js",lineNumbers:!0,handleTabs:!0,lineNumbers:!1}),this.code.onUpdate(function(t){this.onUpdate(t)}.bind(this)),this.content.appendChild(this.codeContent),this.title=document.createElement("div"),this.title.style.cssText=t+"position:absolute; top:3px; left:10px; width:calc( 100% - 20px); color:#7c806c; text-shadow: 1px 1px 1px #000;",this.content.appendChild(this.title),this.info=document.createElement("div"),this.info.style.cssText=t+"position:absolute; bottom:2px; left:10px; width:calc( 100% - 20px); text-shadow: 1px 1px 1px #000;",this.content.appendChild(this.info),this.separator=document.createElement("div"),this.separator.style.cssText=t+"background:none; position:absolute; top:0px; right:0px; width:3px; height:100%; cursor: e-resize; pointer-events:auto; z-index: 5; display:block; ",this.content.appendChild(this.separator),this.midDown=function(t){this.isDown=!0}.bind(this),this.midUp=function(t){this.isDown=!1,document.body.style.cursor="auto",this.codeContent.style.pointerEvents="auto"}.bind(this),this.midMove=function(t){this.isDown&&(this.codeContent.style.pointerEvents="none",document.body.style.cursor="e-resize",this.left=t.clientX+2,this.content.style.width=this.left+"px",Main.setLeft(this.left))}.bind(this),this.separator.addEventListener("pointerdown",this.midDown,!1),document.addEventListener("pointermove",this.midMove,!1),document.addEventListener("pointerup",this.midUp,!1),this.code.updateCode(Main.getCode()),this.setTitle(Main.getCodeName())}setTitle(t){this.codeName=t,this.title.innerHTML="&#x2022;&#160;&#160;"+this.codeName}close(){this.left=0,this.isOpen=!1,document.removeEventListener("pointerdown",this.midDown),document.removeEventListener("pointerup",this.midUp),document.removeEventListener("pointermove",this.midMove),this.code.clear(),this.content.innerHTML="",document.body.removeChild(this.content)}onUpdate(t){this.validate(t)&&this.code.isEdit&&Main.injectCode(t)}set(t,e){this.isOpen&&(this.setTitle(e),this.code.updateCode(t))}get(){return this.code.getCode()}save(t){t.preventDefault();var e=new Blob([this.get()],{type:"text/plain"});saveAs(e,fileName+".js")}setInfo(t,e=0){this.info.style.color=e?"#ff0000":"#7c806c",this.info.innerHTML=t}validate(t){if(t)try{var e=esprima.parse(t,{tolerant:!0,loc:!0,range:!0});if(e.errors.length>0){for(var i=0;i<e.errors.length;++i)var n=e.errors[i];return this.setInfo("Invalid code. Total issues: "+e.errors.length,1),!1}return 0===e.body.length&&this.setInfo("info","Empty code. Nothing to validate."),this.setInfo("&#2039;"),!0}catch(n){return this.setInfo(n.toString(),1),!1}}}const uf=new Map,df={engine:"OIMO",scene:null,scenePlus:null,post:null,tmpMesh:[],tmpGeo:[],tmpMat:[],tmpTex:[],flow:{tmp:[],key:[],add:[],remove:[]},reflow:{ray:[],stat:{fps:0}}};class pf{static byName(t){return uf.has(t)?uf.get(t):null}static add(t,e){if("contact"!==t.type)if(e)e.add(t);else switch(t.type){case"solid":case"joint":case"ray":df.scenePlus.add(t);break;default:df.scene.add(t)}uf.set(t.name,t)}static remove(t){t.dispose&&t.dispose(),t.parent&&t.parent.remove(t),uf.delete(t.name)}}const mf={plane:new wn(1,1),box:new tn(1,1,1),sphere:new Il(1,16,12),cylinder:new bo(1,1,1,16),cone:new bo(.001,1,1,16),highSphere:new Il(1,32,24),joint:(new ru).geometry};mf.plane.rotateX(.5*-Math.PI),mf.joint.scale(.05,.05,.05);const ff=new vo(new class{constructor(t="rgb(127,127,255)",e="rgb(100,100,255)"){const i=document.createElement("canvas");i.width=i.height=16;const n=i.getContext("2d");return n.fillStyle=t,n.fillRect(0,0,16,16),n.beginPath(),n.rect(0,0,8,8),n.rect(8,8,8,8),n.fillStyle=e,n.fill(),i}});ff.wrapS=ff.wrapT=v,ff.repeat.x=2,ff.repeat.y=2;const gf={clearcoat:1,clearcoatRoughness:.1,metalness:.9,roughness:.15,normalMap:ff,normalScale:new Et(.25,.25)},vf={body:new Vl({name:"body",color:16746496,...gf}),sleep:new Vl({name:"sleep",color:8947848,...gf}),solid:new Vl({name:"solid",color:35071,...gf}),hero:new Vl({name:"body",color:65416,...gf}),skin:new Vl({name:"skin",color:9262372,...gf}),glass:new Vl({name:"glass",color:10066431,transparent:!0,opacity:.25,depthTest:!0,depthWrite:!1,reflectivity:.5,roughness:0,metalness:1,side:2,premultipliedAlpha:!0}),chrome:new Vl({name:"chrome",color:8421504,metalness:1,roughness:0}),joint:new Za({name:"joint",color:65280,toneMapped:!1}),ray:new Za({name:"ray",vertexColors:!0,toneMapped:!1}),debug:new pi({name:"debug",color:16776960,wireframe:!0}),debug2:new pi({name:"debug2",color:65535,wireframe:!0}),hide:new pi({name:"hide",visible:!1})},xf=Math.PI/180,yf=new Re,bf=new Vt;class wf{static int(t){return Math.floor(t)}static lerp(t,e,i){return(1-i)*t+i*e}static rand(t,e){return t+Math.random()*(e-t)}static randInt(t,e){return t+Math.floor(Math.random()*(e-t+1))}static autoSize(t=[1,1,1],e="box"){1===t.length&&(t[1]=t[0]);let i=t[0],n=t[1];return"sphere"===e&&(t=[i,i,i]),"cylinder"!==e&&"wheel"!==e&&"capsule"!==e||(t=[i,n,i]),"cone"!==e&&"pyramid"!==e||(t=[i,n,i]),2===t.length&&(t[2]=t[0]),t}static toQuatArray(t=[0,0,0]){return bf.setFromEuler(yf.fromArray(wf.vectorad(t))).toArray()}static toLocalQuatArray(t=[0,0,0],e){return bf.setFromEuler(yf.fromArray(wf.vectorad(t))),bf.premultiply(e.quaternion.invert()),bf.toArray()}static vecAdd(t,e){let i=t.length,n=[];for(;i--;)n[i]=t[i]+e[i];return n}static vectorad(t){let e=3,i=[];for(;e--;)i[e]=t[e]*xf;return i[3]=t[3],i}static getIndex(t){return t.index.array||null}static getVertex(t,e){let i=t.attributes.position.array;if(e){i=t.clone().toNonIndexed().attributes.position.array}return i}}class _f{constructor(){this.id=0,this.list=[],this.type="item",this.Utils=null}reset(){let t=this.list.length;for(;t--;)this.dispose(this.list[t]);this.id=0,this.list=[]}byName(t){return this.Utils.byName(t)}setName(t={}){let e=void 0!==t.name?t.name:this.type+this.id++;return t.id=this.remove(e,!0),e}addToWorld(t,e=-1){this.Utils.add(t),-1!==e?this.list[e]=t:this.list.push(t)}remove(t,e){let i=this.byName(t);return i?this.clear(i,e):-1}clear(t,e){let i=this.list.indexOf(t);return-1===i||e?this.list[i]=null:this.list.splice(i,1),this.dispose(t),i}dispose(t){null!==t&&this.Utils.remove(t)}add(t={}){}set(t={}){}step(t,e){}}class Mf extends io{constructor(t={},e){super(new Di,e),this.data={hit:!1,body:"",point:[0,0,0],normal:[0,0,0],distance:0},this.type="ray",this.name=t.name,this.linked=void 0!==t.parent,this.linked&&(this.parent=t.parent),this.callback=t.callback||function(){},this.matrix=this.linked?this.parent.matrixWorld:new we,this.inv=new we,this.c0=[.4,.4,.4],this.c1=[.15,.15,.15],this.c2=[1,0,0],this._begin=(new Wt).fromArray(t.begin||[0,3,0]),this._end=(new Wt).fromArray(t.end||[0,0,0]),this.begin=(new Wt).copy(this._begin),this.end=(new Wt).copy(this._end),this.tmp=new Wt,this.normal=new Wt;this.geometry.setAttribute("position",new Ti([0,0,0,0,0,0,0,0,0],3)),this.geometry.setAttribute("color",new Ti([0,0,0,0,0,0,0,0,0],3)),this.vertices=this.geometry.attributes.position,this.colors=this.geometry.attributes.color,this.local=[0,0,0,0,0,0],this.updateGeometry(),this.matrixAutoUpdate=!1}update(t,e=0,i=null){if(this.updateMatrix(),this.linked&&(this.inv.copy(this.matrix).invert(),this.begin.copy(this._begin).applyMatrix4(this.inv),this.end.copy(this._end).applyMatrix4(this.inv)),this.data.hit=0!==t[e],this.data.body=i||"",this.data.hit){this.tmp.fromArray(t,e+1),this.normal.fromArray(t,e+4).normalize(),this.data.point=this.tmp.toArray(),this.data.normal=this.normal.toArray(),this.data.distance=this.begin.distanceTo(this.tmp),this.tmp.toArray(this.local,0);let i=this.tmp.distanceTo(this.end);this.tmp.addScaledVector(this.normal,i),this.tmp.toArray(this.local,3)}this.updateGeometry(),this.callback(this.data)}updateGeometry(){if(!this.visible)return;let t,e,i,n=this.vertices.array,s=this.colors.array,r=this.local;if(this.data.hit)s[3]=s[6]=this.c2[0],s[4]=s[7]=this.c2[1],s[5]=s[8]=this.c2[2],n[0]=this._begin.x,n[1]=this._begin.y,n[2]=this._begin.z,n[3]=r[0],n[4]=r[1],n[5]=r[2],n[6]=r[3],n[7]=r[4],n[8]=r[5];else for(i=3;i--;)t=3*i,e=0===i,s[t]=e?this.c0[0]:this.c1[0],s[t+1]=e?this.c0[1]:this.c1[0],s[t+2]=e?this.c0[2]:this.c1[0],n[t]=e?this._begin.x:this._end.x,n[t+1]=e?this._begin.y:this._end.y,n[t+2]=e?this._begin.z:this._end.z;this.vertices.needsUpdate=!0,this.colors.needsUpdate=!0}}Mf.prototype.isRay=!0;class Sf extends Di{constructor(t=1,e=1,i=12,n=1){super(),this.type="CapsuleGeometry";let s=Math.PI;i=Math.floor(i),n=Math.floor(n);let r=Math.floor(.5*i),a=2*Math.PI,o=.5*Math.PI,l=new Lf(t,t,e,i,n,!0),h=new we,c=new Il(t,i,r,0,a,0,o),u=new Il(t,i,r,0,a,o,o),d=(new we).makeTranslation(0,0,0),p=(new we).makeTranslation(0,.5*e,0),m=(new we).makeTranslation(0,.5*-e,0);h.makeRotationZ(s),l.applyMatrix4(d.multiply(h)),c.applyMatrix4(p),u.applyMatrix4(m);let f=Im.mergeVertices(Im.mergeBufferGeometries([l,c,u]));this.copy(f)}}class Tf extends Di{constructor(t=1,e=.4,i=8,n=6,s=2*Math.PI,r=0,a=Math.PI){super(),this.type="TorusGeometryFix",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:s},i=Math.floor(i),n=Math.floor(n);const o=[],l=[],h=[],c=[],u=new Wt,d=new Wt,p=new Wt;let m,f;for(m=0;m<=i;m++)for(f=0;f<=n;f++){const o=f/n*s,g=m/i*a+r;d.x=(t+e*Math.cos(g))*Math.cos(o),d.y=(t+e*Math.cos(g))*Math.sin(o),d.z=e*Math.sin(g),l.push(d.x,d.y,d.z),u.x=t*Math.cos(o),u.y=t*Math.sin(o),p.subVectors(d,u).normalize(),h.push(p.x,p.y,p.z),c.push(f/n),c.push(m/i)}for(m=1;m<=i;m++)for(f=1;f<=n;f++){const t=(n+1)*m+f-1,e=(n+1)*(m-1)+f-1,i=(n+1)*(m-1)+f,s=(n+1)*m+f;o.push(t,e,s),o.push(e,i,s)}this.setIndex(o),this.setAttribute("position",new Ti(l,3)),this.setAttribute("normal",new Ti(h,3)),this.setAttribute("uv",new Ti(c,2))}}class Af extends Di{constructor(t=1,e=1,i=1,n=.01,s=12,r=1,a=3){super(),this.type="ChamferCyl",s=Math.floor(s),r=Math.floor(r),a=Math.floor(a);let o=new we,l=new we,h=Math.PI,c=.5*h,u=2*h,d=new Lf(e,t,i-2*n,s,r,!0,0),p=new Tf(t-n,n,a,s,u,0,c),m=new yo(t-n,s);l.makeTranslation(0,0,n),m.applyMatrix4(l);let f=Im.mergeBufferGeometries([p,m]);o.makeTranslation(0,0,.5*i-n),l.makeRotationX(-c),f.applyMatrix4(l.multiply(o)),p=new Tf(e-n,n,a,s,u,0,c),m=new yo(e-n,s),l.makeTranslation(0,0,n),m.applyMatrix4(l);let g=Im.mergeBufferGeometries([p,m]);o.makeTranslation(0,0,.5*i-n),l.makeRotationX(c),g.applyMatrix4(l.multiply(o));let v=Im.mergeVertices(Im.mergeBufferGeometries([f,d,g]));this.copy(v)}}class Ef extends Di{constructor(t=1,e=1,i=1,n=.01,s=1,r=1,a=1,o=3){super(),this.type="ChamferBox",s=Math.floor(s),r=Math.floor(r),a=Math.floor(a),o=Math.floor(o);let l=Math.PI,h=.5*l,c=2*n,u=.5*t,d=.5*e,p=.5*i,m=new we,f=new we,g=new we,v=new wn(t-c,e-c,s,r),x=new bo(n,n,t-c,o,s,!0,0,h),y=new bo(n,n,e-c,o,r,!0,0,h),b=new Cf(n,o,o,0,h,0,-h),w=new Cf(n,o,o,0,h,0,-h);f.makeTranslation(0,d-n,0),m.makeRotationX(h),b.applyMatrix4(f.multiply(m)),f.makeTranslation(0,-d+n,0),m.makeRotationX(h),g.makeRotationY(-h),w.applyMatrix4(f.multiply(m).multiply(g));let _=Im.mergeBufferGeometries([y,b,w]),M=_.clone();f.makeTranslation(u-n,0,-n),_.applyMatrix4(f),f.makeTranslation(-u+n,0,-n),m.makeRotationZ(l),M.applyMatrix4(f.multiply(m));let S=x.clone();m.makeRotationZ(h),f.makeTranslation(0,d-n,-n),x.applyMatrix4(f.multiply(m)),f.makeTranslation(0,-d+n,-n),m.makeRotationZ(-h),S.applyMatrix4(f.multiply(m));let T=Im.mergeBufferGeometries([x,S,v,_,M]),A=T.clone();f.makeTranslation(0,0,p),T.applyMatrix4(f),f.makeTranslation(0,0,-p),m.makeRotationY(l),A.applyMatrix4(f.multiply(m)),v=new wn(i-c,e-c,a,r),x=new bo(n,n,i-c,o,a,!0,0,h),S=x.clone(),f.makeTranslation(0,-(d-n),-n,0),m.makeRotationZ(-h),x.applyMatrix4(f.multiply(m)),f.makeTranslation(0,d-n,-n,0),m.makeRotationZ(h),S.applyMatrix4(f.multiply(m));let E=Im.mergeBufferGeometries([x,S,v]),L=E.clone();f.makeTranslation(-u,0,0),m.makeRotationY(-h),E.applyMatrix4(f.multiply(m)),f.makeTranslation(u,0,0),m.makeRotationY(h),L.applyMatrix4(f.multiply(m)),v=new wn(t-c,i-c,s,a);let C=v.clone();f.makeTranslation(0,d,0),m.makeRotationX(-h),v.applyMatrix4(f.multiply(m)),f.makeTranslation(0,-d,0),m.makeRotationX(h),C.applyMatrix4(f.multiply(m));let P=Im.mergeVertices(Im.mergeBufferGeometries([T,A,E,L,v,C]));this.copy(P)}}class Lf extends Di{constructor(t=1,e=1,i=1,n=8,s=1,r=!0,a=0,o=2*Math.PI){super(),this.type="CylinderGeometryFix",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:s,openEnded:r,thetaStart:a,thetaLength:o};const l=this;n=Math.floor(n),s=Math.floor(s);const h=[],c=[],u=[],d=[];let p=0;const m=[],f=i/2;let g=0;!function(){const r=new Wt,v=new Wt;let x=0;const y=(e-t)/i;for(let l=0;l<=s;l++){const h=[],g=l/s,x=g*(e-t)+t;for(let t=0;t<=n;t++){const e=t/n,s=e*o+a,l=Math.sin(s),m=Math.cos(s);v.x=x*m,v.y=g*i-f,v.z=x*l,c.push(v.x,v.y,v.z),r.set(m,-y,l).normalize(),u.push(r.x,r.y,r.z),d.push(e,1-g),h.push(p++)}m.push(h)}for(let t=0;t<n;t++)for(let e=0;e<s;e++){const i=m[e][t],n=m[e+1][t],s=m[e+1][t+1],r=m[e][t+1];h.push(i,n,r),h.push(n,s,r),x+=6}l.addGroup(g,x,0),g+=x}(),this.setIndex(h),this.setAttribute("position",new Ti(c,3)),this.setAttribute("normal",new Ti(u,3)),this.setAttribute("uv",new Ti(d,2))}}class Cf extends Di{constructor(t=1,e=8,i=6,n=0,s=2*Math.PI,r=0,a=Math.PI){super(),this.type="SphereGeometryFix",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:s,thetaStart:r,thetaLength:a},e=Math.floor(e),i=Math.floor(i);const o=Math.min(r+a,Math.PI);let l=0;const h=[],c=new Wt,u=new Wt,d=[],p=[],m=[],f=[];for(let d=0;d<=i;d++){const g=[],v=d/i;let x=0;0==d&&0==r?x=.5/e:d==i&&o==Math.PI&&(x=-.5/e);for(let i=0;i<=e;i++){const o=i/e;c.x=-t*Math.cos(n+o*s)*Math.sin(r+v*a),c.y=t*Math.cos(r+v*a),c.z=t*Math.sin(n+o*s)*Math.sin(r+v*a),p.push(c.x,c.y,c.z),u.copy(c).normalize(),m.push(u.x,u.y,u.z),f.push(o+x,1-v),g.push(l++)}h.push(g)}for(let t=0;t<i;t++)for(let n=0;n<e;n++){const e=h[t][n+1],s=h[t][n],a=h[t+1][n],l=h[t+1][n+1];(0!==t||r>0)&&d.push(e,s,l),(t!==i-1||o<Math.PI)&&d.push(s,a,l)}this.setIndex(d),this.setAttribute("position",new Ti(p,3)),this.setAttribute("normal",new Ti(m,3)),this.setAttribute("uv",new Ti(f,2))}}const Pf=new Wt,Rf=new Bc,Ff=new fn,If=new Wt,Df=new ni;class Nf{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new Of,this.unassigned=new Of,this.vertices=[]}setFromPoints(t){!0!==Array.isArray(t)&&console.error("THREE.ConvexHull: Points parameter is not an array."),t.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.vertices.push(new Uf(t[e]));return this.compute(),this}setFromObject(t){const e=[];return t.updateMatrixWorld(!0),t.traverse((function(t){const i=t.geometry;if(void 0!==i){if(i.isGeometry)return void console.error("THREE.ConvexHull no longer supports Geometry. Use THREE.BufferGeometry instead.");if(i.isBufferGeometry){const n=i.attributes.position;if(void 0!==n)for(let i=0,s=n.count;i<s;i++){const s=new Wt;s.fromBufferAttribute(n,i).applyMatrix4(t.matrixWorld),e.push(s)}}}})),this.setFromPoints(e)}containsPoint(t){const e=this.faces;for(let i=0,n=e.length;i<n;i++){if(e[i].distanceToPoint(t)>this.tolerance)return!1}return!0}intersectRay(t,e){const i=this.faces;let n=-1/0,s=1/0;for(let e=0,r=i.length;e<r;e++){const r=i[e],a=r.distanceToPoint(t.origin),o=r.normal.dot(t.direction);if(a>0&&o>=0)return null;const l=0!==o?-a/o:0;if(!(l<=0)&&(o>0?s=Math.min(l,s):n=Math.max(l,n),n>s))return null}return n!==-1/0?t.at(n,e):t.at(s,e),e}intersectsRay(t){return null!==this.intersectRay(t,Pf)}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(t,e){return t.face=e,null===e.outside?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this}removeVertexFromFace(t,e){return t===e.outside&&(null!==t.next&&t.next.face===e?e.outside=t.next:e.outside=null),this.assigned.remove(t),this}removeAllVerticesFromFace(t){if(null!==t.outside){const e=t.outside;let i=t.outside;for(;null!==i.next&&i.next.face===t;)i=i.next;return this.assigned.removeSubList(e,i),e.prev=i.next=null,t.outside=null,e}}deleteFaceVertices(t,e){const i=this.removeAllVerticesFromFace(t);if(void 0!==i)if(void 0===e)this.unassigned.appendChain(i);else{let t=i;do{const i=t.next;e.distanceToPoint(t.point)>this.tolerance?this.addVertexToFace(t,e):this.unassigned.append(t),t=i}while(null!==t)}return this}resolveUnassignedPoints(t){if(!1===this.unassigned.isEmpty()){let e=this.unassigned.first();do{const i=e.next;let n=this.tolerance,s=null;for(let i=0;i<t.length;i++){const r=t[i];if(0===r.mark){const t=r.distanceToPoint(e.point);if(t>n&&(n=t,s=r),n>1e3*this.tolerance)break}}null!==s&&this.addVertexToFace(e,s),e=i}while(null!==e)}return this}computeExtremes(){const t=new Wt,e=new Wt,i=[],n=[];for(let t=0;t<3;t++)i[t]=n[t]=this.vertices[0];t.copy(this.vertices[0].point),e.copy(this.vertices[0].point);for(let s=0,r=this.vertices.length;s<r;s++){const r=this.vertices[s],a=r.point;for(let e=0;e<3;e++)a.getComponent(e)<t.getComponent(e)&&(t.setComponent(e,a.getComponent(e)),i[e]=r);for(let t=0;t<3;t++)a.getComponent(t)>e.getComponent(t)&&(e.setComponent(t,a.getComponent(t)),n[t]=r)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(t.x),Math.abs(e.x))+Math.max(Math.abs(t.y),Math.abs(e.y))+Math.max(Math.abs(t.z),Math.abs(e.z))),{min:i,max:n}}computeInitialHull(){const t=this.vertices,e=this.computeExtremes(),i=e.min,n=e.max;let s=0,r=0;for(let t=0;t<3;t++){const e=n[t].point.getComponent(t)-i[t].point.getComponent(t);e>s&&(s=e,r=t)}const a=i[r],o=n[r];let l,h;s=0,Rf.set(a.point,o.point);for(let e=0,i=this.vertices.length;e<i;e++){const i=t[e];if(i!==a&&i!==o){Rf.closestPointToPoint(i.point,!0,If);const t=If.distanceToSquared(i.point);t>s&&(s=t,l=i)}}s=-1,Ff.setFromCoplanarPoints(a.point,o.point,l.point);for(let e=0,i=this.vertices.length;e<i;e++){const i=t[e];if(i!==a&&i!==o&&i!==l){const t=Math.abs(Ff.distanceToPoint(i.point));t>s&&(s=t,h=i)}}const c=[];if(Ff.distanceToPoint(h.point)<0){c.push(kf.create(a,o,l),kf.create(h,o,a),kf.create(h,l,o),kf.create(h,a,l));for(let t=0;t<3;t++){const e=(t+1)%3;c[t+1].getEdge(2).setTwin(c[0].getEdge(e)),c[t+1].getEdge(1).setTwin(c[e+1].getEdge(0))}}else{c.push(kf.create(a,l,o),kf.create(h,a,o),kf.create(h,o,l),kf.create(h,l,a));for(let t=0;t<3;t++){const e=(t+1)%3;c[t+1].getEdge(2).setTwin(c[0].getEdge((3-t)%3)),c[t+1].getEdge(0).setTwin(c[e+1].getEdge(1))}}for(let t=0;t<4;t++)this.faces.push(c[t]);for(let e=0,i=t.length;e<i;e++){const i=t[e];if(i!==a&&i!==o&&i!==l&&i!==h){s=this.tolerance;let t=null;for(let e=0;e<4;e++){const n=this.faces[e].distanceToPoint(i.point);n>s&&(s=n,t=this.faces[e])}null!==t&&this.addVertexToFace(i,t)}}return this}reindexFaces(){const t=[];for(let e=0;e<this.faces.length;e++){const i=this.faces[e];0===i.mark&&t.push(i)}return this.faces=t,this}nextVertexToAdd(){if(!1===this.assigned.isEmpty()){let t,e=0;const i=this.assigned.first().face;let n=i.outside;do{const s=i.distanceToPoint(n.point);s>e&&(e=s,t=n),n=n.next}while(null!==n&&n.face===i);return t}}computeHorizon(t,e,i,n){let s;this.deleteFaceVertices(i),i.mark=1,s=null===e?e=i.getEdge(0):e.next;do{const e=s.twin,i=e.face;0===i.mark&&(i.distanceToPoint(t)>this.tolerance?this.computeHorizon(t,e,i,n):n.push(s)),s=s.next}while(s!==e);return this}addAdjoiningFace(t,e){const i=kf.create(t,e.tail(),e.head());return this.faces.push(i),i.getEdge(-1).setTwin(e.twin),i.getEdge(0)}addNewFaces(t,e){this.newFaces=[];let i=null,n=null;for(let s=0;s<e.length;s++){const r=e[s],a=this.addAdjoiningFace(t,r);null===i?i=a:a.next.setTwin(n),this.newFaces.push(a.face),n=a}return i.next.setTwin(n),this}addVertexToHull(t){const e=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),this.addNewFaces(t,e),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let t;for(this.computeInitialHull();void 0!==(t=this.nextVertexToAdd());)this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}class kf{constructor(){this.normal=new Wt,this.midpoint=new Wt,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}static create(t,e,i){const n=new kf,s=new zf(t,n),r=new zf(e,n),a=new zf(i,n);return s.next=a.prev=r,r.next=s.prev=a,a.next=r.prev=s,n.edge=s,n.compute()}getEdge(t){let e=this.edge;for(;t>0;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e}compute(){const t=this.edge.tail(),e=this.edge.head(),i=this.edge.next.head();return Df.set(t.point,e.point,i.point),Df.getNormal(this.normal),Df.getMidpoint(this.midpoint),this.area=Df.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(t){return this.normal.dot(t)-this.constant}}class zf{constructor(t,e){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=e}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const t=this.head(),e=this.tail();return null!==e?e.point.distanceTo(t.point):-1}lengthSquared(){const t=this.head(),e=this.tail();return null!==e?e.point.distanceToSquared(t.point):-1}setTwin(t){return this.twin=t,t.twin=this,this}}class Uf{constructor(t){this.point=t,this.prev=null,this.next=null,this.face=null}}class Of{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(t,e){return e.prev=t.prev,e.next=t,null===e.prev?this.head=e:e.prev.next=e,t.prev=e,this}insertAfter(t,e){return e.prev=t,e.next=t.next,null===e.next?this.tail=e:e.next.prev=e,t.next=e,this}append(t){return null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this}appendChain(t){for(null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail;null!==t.next;)t=t.next;return this.tail=t,this}remove(t){return null===t.prev?this.head=t.next:t.prev.next=t.next,null===t.next?this.tail=t.prev:t.next.prev=t.prev,this}removeSubList(t,e){return null===t.prev?this.head=e.next:t.prev.next=e.next,null===e.next?this.tail=t.prev:e.next.prev=t.prev,this}isEmpty(){return null===this.head}}class Bf extends Di{constructor(t){super();const e=[],i=[];void 0===Nf&&console.error("THREE.ConvexBufferGeometry: ConvexBufferGeometry relies on ConvexHull");const n=(new Nf).setFromPoints(t).faces;for(let t=0;t<n.length;t++){const s=n[t];let r=s.edge;do{const t=r.head().point;e.push(t.x,t.y,t.z),i.push(s.normal.x,s.normal.y,s.normal.z),r=r.next}while(r!==s.edge)}this.setAttribute("position",new Ti(e,3)),this.setAttribute("normal",new Ti(i,3))}}class Hf extends _f{constructor(){super(),this.Utils=pf,this.type="body",this.extraConvex=!1}step(t,e){let i,n,s,r=this.list.length;for(;r--;)if(i=this.list[r],null!==i){if(n=e+11*r,!i.actif){if(s=t[n+0]+t[n+1]+t[n+2]+t[n+3]+t[n+4]+t[n+5]+t[n+6]+t[n+7],0===s)continue;i.actif=!0}i.sleep=!(t[n]>0),i.position.fromArray(t,n+1),i.quaternion.fromArray(t,n+4),i.velocity.fromArray(t,n+8),i.auto||i.updateMatrix(),i.defMat&&(i.sleep||"sleep"!==i.material.name||(i.material=vf.body),i.sleep&&"body"===i.material.name&&(i.material=vf.sleep))}}geometry(t={},e,i){let n,s,r,a=t.size,o=t.type,l=!1,h=!1;if("mesh"!==o&&"convex"!==o||(t.shape?t.shape.isMesh&&(t.shape=t.shape.geometry):t.mesh&&!t.v&&(t.shape=t.mesh.geometry)),t.radius&&("box"===o&&(o="ChamferBox"),"cylinder"===o&&(o="ChamferCyl")),t.geometry&&("convex"===o?t.shape=t.geometry:o="direct"),this.extraConvex&&("cylinder"===t.type||"cone"===t.type)){let e=new bo("cone"===t.type?0:t.size[0],t.size[0],t.size[1],t.segment||24,1);t.v=wf.getVertex(e),t.type="convex"}switch(o){case"direct":n=t.geometry.clone(),t.size&&n.scale(t.size[0],t.size[1],t.size[2]),h=!0,l=!0;break;case"convex":if(t.v){if(t.nogeo)n=new Di;else{let e=[];for(s=Math.floor(t.v.length/3);s--;)r=3*s,e.push(new Wt(t.v[r],t.v[r+1],t.v[r+2]));n=new Bf(e)}h=!0,l=!0}t.shape&&(n=t.shape.clone(),t.size&&n.scale(t.size[0],t.size[0],t.size[0]),t.v=wf.getVertex(n),h=!0,l=!0);break;case"mesh":n=t.shape.clone(),t.size&&n.scale(t.size[0],t.size[0],t.size[0]),"OIMO"===df.engine?(t.v=wf.getVertex(n,!0),t.index=null):(t.v=wf.getVertex(n),t.index=wf.getIndex(n)),h=!0,l=!0;break;case"capsule":n=new Sf(a[0],a[1],t.seg||24),function(t,e,i,n){e=e||"sphere",void 0===i&&(i=new we),t.computeBoundingBox();let s=t.boundingBox;n=Math.max(s.max.x-s.min.x,s.max.y-s.min.y,s.max.z-s.min.z);let r=s,a=[];a.length=2*t.attributes.position.array.length/3,void 0===t.attributes.uv&&t.addAttribute("uv",new Ti(a,2));let o,l,h,c,u,d=function(t,e,n){t.applyMatrix4(i),e.applyMatrix4(i),n.applyMatrix4(i);let s=1/(2*Math.PI),r=1/Math.PI;return t.normalize(),e.normalize(),n.normalize(),{uv0:new Et(.5-Math.atan(t.z,-t.x)*s,.5-Math.asin(t.y)*r),uv1:new Et(.5-Math.atan(e.z,-e.x)*s,.5-Math.asin(e.y)*r),uv2:new Et(.5-Math.atan(n.z,-n.x)*s,.5-Math.asin(n.y)*r)}},p=function(t,e,s){t.applyMatrix4(i),e.applyMatrix4(i),s.applyMatrix4(i);let a=new Wt;a.crossVectors(e.clone().sub(t),e.clone().sub(s)).normalize(),a.x=Math.abs(a.x),a.y=Math.abs(a.y),a.z=Math.abs(a.z);let o=new Et,l=new Et,h=new Et,c=1/n;return a.y>a.x&&a.y>a.z?(o.set(t.x-r.min.x,r.max.z-t.z).multiplyScalar(c),l.set(e.x-r.min.x,r.max.z-e.z).multiplyScalar(c),h.set(s.x-r.min.x,r.max.z-s.z).multiplyScalar(c)):a.x>a.y&&a.x>a.z?(o.set(t.z-r.min.z,t.y-r.min.y).multiplyScalar(c),l.set(e.z-r.min.z,e.y-r.min.y).multiplyScalar(c),h.set(s.z-r.min.z,s.y-r.min.y).multiplyScalar(c)):a.z>a.y&&a.z>a.x&&(o.set(t.x-r.min.x,t.y-r.min.y).multiplyScalar(c),l.set(e.x-r.min.x,e.y-r.min.y).multiplyScalar(c),h.set(s.x-r.min.x,s.y-r.min.y).multiplyScalar(c)),{uv0:o,uv1:l,uv2:h}},m=new Wt,f=new Wt,g=new Wt;const v=t.getAttribute("position");if(t.index)for(o=0;o<t.index.count;o+=3)l=t.index.getX(o+0),h=t.index.getX(o+1),c=t.index.getX(o+2),m.fromBufferAttribute(v,l),f.fromBufferAttribute(v,h),g.fromBufferAttribute(v,c),u="sphere"===e?d(m,f,g):p(m,f,g),a[2*l]=u.uv0.x,a[2*l+1]=u.uv0.y,a[2*h]=u.uv1.x,a[2*h+1]=u.uv1.y,a[2*c]=u.uv2.x,a[2*c+1]=u.uv2.y;else for(o=0;o<v.count;o+=3){m.fromBufferAttribute(v,o+0),f.fromBufferAttribute(v,o+1),g.fromBufferAttribute(v,o+2),u="sphere"===e?d(m,f,g):p(m,f,g);let t=o,i=o+1,n=o+2;a[2*t]=u.uv0.x,a[2*t+1]=u.uv0.y,a[2*i]=u.uv1.x,a[2*i+1]=u.uv1.y,a[2*n]=u.uv2.x,a[2*n+1]=u.uv2.y}t.attributes.uv.array=new Float32Array(a),t.attributes.uv.needsUpdate=!0}(n),h=!0,l=!0;break;case"ChamferBox":n=new Ef(a[0],a[1],a[2],t.radius,t.seg||24),h=!0,l=!0;break;case"ChamferCyl":n=new Af(a[0],a[0],a[1],t.radius,t.seg||24),h=!0,l=!0;break;default:n=mf[o]}"highSphere"===o&&(t.type="sphere");let c=new Ki(n,i);t.localRot&&(t.localQuat=wf.toQuatArray(t.localRot)),t.localPos&&c.position.fromArray(t.localPos),t.localQuat&&c.quaternion.fromArray(t.localQuat),l||c.scale.fromArray(t.size),h&&(c.unic=!0),t.meshRemplace&&!t.debug||e.add(c),t.shape&&delete t.shape,t.geometry&&delete t.geometry}add(t={}){let e,i,n=this.setName(t);if(t.type=void 0===t.type?"box":t.type,"plane"!==t.type||t.visible||(t.visible=!1),t.massCenter)if("compound"!==t.type)t.shapes=[{type:t.type,pos:t.massCenter,size:t.size}],t.segment&&(t.shapes[0].segment=t.segment),t.radius&&(t.shapes[0].radius=t.radius),delete t.size,t.type="compound";else for(e=0;e<t.shapes.length;e++)i=t.shapes[e],i.pos?i.pos=pf.vecAdd(i.pos,t.massCenter):i.pos=t.massCenter;t.pos=void 0===t.pos?[0,0,0]:t.pos,t.quat=void 0===t.quat?[0,0,0,1]:t.quat,void 0!==t.rot&&(t.quat=wf.toQuatArray(t.rot),delete t.rot),void 0!==t.meshRot&&(t.meshQuat=wf.toQuatArray(t.meshRot),delete t.meshRot),t.size=wf.autoSize(t.size,t.type),t.meshScale&&(t.meshScale=wf.autoSize(t.meshScale));let s,r=!1;void 0!==t.material?s=t.material.constructor===String?vf[t.material]:t.material:(r=!0,s=vf[this.type]),t.material&&delete t.material;let a=new Gf;if(t.mesh){t.isTerrain&&(t.noClone=!0);let e=t.noClone?t.mesh:t.mesh.clone();e.position.fromArray(t.meshPos||[0,0,0]),t.meshQuat&&e.quaternion.fromArray(t.meshQuat),t.meshScale&&e.scale.fromArray(t.meshScale),r||(e.material=s),t.meshRemplace=!0,a.add(e)}switch(t.type){case"null":break;case"compound":for(e=0;e<t.shapes.length;e++)i=t.shapes[e],i.type=void 0===i.type?"box":i.type,i.size=wf.autoSize(i.size,i.type),i.pos&&(i.localPos=i.pos),void 0!==i.rot&&(i.quat=wf.toQuatArray(i.rot),delete i.rot),i.quat&&(i.localQuat=i.quat),i.debug=t.debug||!1,i.meshRemplace=t.meshRemplace||!1,this.geometry(i,a,s);break;default:this.geometry(t,a,s)}return a.name=n,a.type=this.type,a.size=t.size,a.shapetype=t.type,r||(a.material=s),a.defMat=!1,a.material&&(a.defMat="body"===a.material.name),a.visible=void 0===t.visible||t.visible,t.renderOrder&&(a.renderOrder=t.renderOrder),t.order&&(a.rotation.order=t.order),t.mesh&&delete t.mesh,a.receiveShadow=void 0===t.shadow||t.shadow,a.castShadow=void 0===t.shadow||t.shadow,a.visible||(a.receiveShadow=!1,a.castShadow=!1),this.set(t,a),this.addToWorld(a,t.id),df.post({m:"add",o:t}),a}set(t={},e=null){null===e&&(e=this.byName(t.name)),null!==e&&(t.pos&&e.position.fromArray(t.pos),t.quat&&e.quaternion.fromArray(t.quat),e.auto=t.auto||!1,e.auto||(e.matrixAutoUpdate=!1,e.updateMatrix()))}}class Gf extends Xe{constructor(){super(),this.type="",this.shapetype="box",this.data={},this._size=new Wt,this.velocity=new Wt,this.defMat=!1,this.actif=!1,this.mesh=null,this.linked=[],Object.defineProperty(this,"size",{get:function(){return this._size.toArray()},set:function(t){this._size.fromArray(t)}}),Object.defineProperty(this,"material",{get:function(){let t=null;return this.children[0]&&(t=this.children[0].material),t},set:function(t){this.children.forEach((function(e){e.isMesh&&(e.material=t)}))}}),Object.defineProperty(this,"receiveShadow",{get:function(){return this.children[0].receiveShadow},set:function(t){this.children.forEach((function(e){e.isMesh&&(e.receiveShadow=t)}))}}),Object.defineProperty(this,"castShadow",{get:function(){return this.children[0].castShadow},set:function(t){this.children.forEach((function(e){e.isMesh&&(e.castShadow=t)}))}})}select(t){}dispose(){this.traverse((function(t){t.isMesh&&t.unic&&t.geometry.dispose()})),this.children=[]}}Gf.prototype.isGroup=!0;class Vf extends Xe{constructor(t,e){super(),this.type="joint",this.mode="revolute",this.mtx=new we,this.matrixAutoUpdate=!1;let i=new ro(t,e);this.add(i),this.m2=new ro(t,e),this.add(this.m2),this.m2.matrixAutoUpdate=!1;const n=new Di;n.setAttribute("position",new Ti([0,0,0,0,0,0],3)),n.computeBoundingSphere(),this.m3=new ro(n,e),this.add(this.m3)}update(t,e=0){if(!this.visible)return;this.position.fromArray(t,e),this.quaternion.fromArray(t,e+3),this.updateMatrix(),this.m2.position.fromArray(t,e+7),this.m2.quaternion.fromArray(t,e+10),this.m2.matrix.compose(this.m2.position,this.m2.quaternion,{x:1,y:1,z:1}),this.mtx.copy(this.matrix).invert().multiply(this.m2.matrix),this.mtx.decompose(this.m2.position,this.m2.quaternion,{x:1,y:1,z:1}),this.m2.updateMatrix();const i=this.m3.geometry.attributes.position;i.setXYZ(1,this.m2.position.x,this.m2.position.y,this.m2.position.z),i.needsUpdate=!0}}Vf.prototype.isJoint=!0;class Wf{constructor(t={}){this.type="contact",this.name=t.name,this.callback=t.callback||function(){},this.b1=t.b1||null,this.b2=t.b2||null,this.ignore=t.ignore||[],this.always=void 0===t.always||t.always,this.simple=t.simple||!1,this.data={hit:!1,point:[0,0,0],normal:[0,0,0]}}update(t,e=0){this.data.hit=t[e]>0,this.simple||(this.data.point=[t[e+1],t[e+2],t[e+3]],this.data.normal=[t[e+4],t[e+5],t[e+6]]),(this.data.hit||this.always)&&this.callback(this.data)}}class jf{constructor(t){this.values=[],this.ready=0,this.key=t}update(){var t,e,i,n,s,r,a=this.fix,o=navigator.getGamepads();for(t=0;t<o.length;t++)if(r=o[t])if(i=r.axes.length,n=r.buttons.length){for(this.values[t]||(this.values[t]=[]),e=0;e<i;e++)s=a(r.axes[e],.08),0==this.ready&&0!==s&&(this.ready=1),this.values[t][e]=s;for(e=0;e<n;e++)s=a(r.buttons[e].value),0==this.ready&&0!==s&&(this.ready=1),this.values[t][i+e]=s}else this.values[t]&&(this.values[t]=null)}getValue(t){for(var e,i=19;i--;)e=this.values[t][i],0==this.ready&&0!==e&&(this.ready=1),this.key[i]=e}reset(){this.ready=0}fix(t,e){let i=Number(t.toString().substring(0,5));return e&&i<e&&i>-e&&(i=0),i}}let Xf,Yf=null,qf={},Qf=0,Zf=null,Jf=!1,Kf=!1,$f=!0,tg=null,eg=null,ig=!0;const ng=new Hf,sg=new class extends Hf{constructor(){super(),this.type="solid"}step(t,e){}},rg=new class extends _f{constructor(){super(),this.Utils=pf,this.type="joint"}step(t,e){let i,n,s=this.list.length;for(;s--;)i=this.list[s],n=e+16*s,i.update(t,n)}add(t={}){let e=this.setName(t);t.b1&&"string"!=typeof t.b1&&(t.b1=t.b1.name),t.b2&&"string"!=typeof t.b2&&(t.b2=t.b2.name),void 0!==t.rot1&&(t.quat1=wf.toQuatArray(t.rot1),delete t.rot1),void 0!==t.rot2&&(t.quat2=wf.toQuatArray(t.rot2),delete t.rot2),t.drivePosition&&void 0!==t.drivePosition.rot&&(t.drivePosition.quat=wf.toQuatArray(t.drivePosition.rot),delete t.drivePosition.rot);let i=new Vf(mf.joint,vf.joint);return i.name=e,i.visible=void 0===t.visible||t.visible,this.addToWorld(i,t.id),df.post({m:"add",o:t}),i}set(t={}){}},ag=new class extends _f{constructor(){super(),this.Utils=pf,this.type="ray"}step(t,e){let i,n,s=this.list.length;for(;s--;)i=this.list[s],n=e+8*s,i.update(t,n,df.reflow.ray[s]||null),i.begin.toArray(t,n+1),i.end.toArray(t,n+4)}add(t={}){this.setName(t),t.link&&"string"!=typeof t.link&&(t.link=t.link.name);let e=new Mf(t,vf.ray);return e.visible=void 0===t.visible||t.visible,this.addToWorld(e,t.id),t.parent&&delete t.parent,t.callback&&delete t.callback,df.post({m:"add",o:t}),e}set(t={},e=null){null===e&&(e=this.byName(t.name)),null!==e&&(void 0!==t.begin&&e._begin.fromrray(t.begin),void 0!==t.end&&e._end.fromrray(t.end))}},og=new class extends _f{constructor(){super(),this.Utils=pf,this.type="contact"}step(t,e){let i,n,s=this.list.length;for(;s--;)i=this.list[s],n=e+8*s,i.update(t,n)}add(t={}){this.setName(t);let e=new Wf(t);return t.callback&&delete t.callback,this.addToWorld(e,t.id),df.post({m:"add",o:t}),e}},lg=new class{constructor(){this.key=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.key2=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.gamepad=new jf(this.key),this.useGamepad=!1,this.sameAxis=!1,document.addEventListener("keydown",function(t){this.keyDown(t)}.bind(this),!1),document.addEventListener("keyup",function(t){this.keyUp(t)}.bind(this),!1)}update(){return this.gamepad.update(),this.gamepad.ready&&(this.useGamepad||(this.useGamepad=!0),this.gamepad.getValue(0)),this.sameAxis&&(this.key[2]=this.key[0],this.key[3]=this.key[1]),this.key}keyDown(t){var e=this.key,i=this.key2;if(t=t||window.event,this.sameAxis)switch(t.which){case 65:case 81:case 37:e[0]=-1,i[0]=1;break;case 68:case 39:e[0]=1,i[1]=1;break;case 87:case 90:case 38:e[1]=-1;break;case 83:case 40:e[1]=1;break;case 32:e[4]=1;break;case 17:case 67:case 69:e[5]=1;break;case 16:e[7]=1}else switch(t.which){case 65:case 81:e[0]=-1,i[0]=1;break;case 68:e[0]=1,i[1]=1;break;case 87:case 90:e[1]=-1;break;case 83:e[1]=1;break;case 37:e[2]=-1,i[0]=1;break;case 39:e[2]=1,i[1]=1;break;case 38:e[3]=-1;break;case 40:e[3]=1;break;case 32:e[4]=1;break;case 17:case 67:case 69:e[5]=1;break;case 16:e[7]=1}this.gamepad.reset()}keyUp(t){var e=this.key,i=this.key2;if(t=t||window.event,this.sameAxis)switch(t.which){case 65:case 81:case 37:e[0]=e[0]<0?0:e[0],i[0]=0;break;case 68:case 39:e[0]=e[0]>0?0:e[0],i[1]=0;break;case 87:case 90:case 38:e[1]=e[1]<0?0:e[1];break;case 83:case 40:e[1]=e[1]>0?0:e[1];break;case 32:e[4]=0;break;case 17:case 67:case 69:e[5]=0;break;case 16:e[7]=0}else switch(t.which){case 65:case 81:e[0]=e[0]<0?0:e[0],i[0]=0;break;case 68:e[0]=e[0]>0?0:e[0],i[1]=0;break;case 87:case 90:e[1]=e[1]<0?0:e[1];break;case 83:e[1]=e[1]>0?0:e[1];break;case 37:e[2]=e[2]<0?0:e[2],i[0]=0;break;case 39:e[2]=e[2]>0?0:e[2],i[1]=0;break;case 38:e[3]=e[3]<0?0:e[3];break;case 40:e[3]=e[3]>0?0:e[3];break;case 32:e[4]=0;break;case 17:case 67:case 69:e[5]=0;break;case 16:e[7]=0}}};let hg=function(){},cg=function(){return 0},ug=function(){},dg=function(){},pg=function(){};class mg{static setExtraTexture(t){dg=t}static setExtraMaterial(t){pg=t}static setPostUpdate(t){hg=null===t?function(){}:t}static setAzimut(t){cg=t}static getKey(){return lg.key}static getKey2(){return lg.key2}static getAzimut(){return cg()}static setContent(t){t.add(df.scene),t.add(df.scenePlus)}static setControl(t){eg=t,cg=eg.getAzimuthalAngle}static message(t){let e=t.data;e.Ar&&(Xf=e.Ar),e.reflow&&(df.reflow=e.reflow),mg[e.m](e.o)}static post(t,e){Jf?"add"===t.m?df.flow.add.push(t.o):"remove"===t.m?df.flow.remove.push(t.o):Zf.postMessage(t,e):tg({data:t})}static makeView(){}static getScene(){return df.scene}static getMat(){return vf}static init(t={}){let e=t.type||"OIMO",i=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;if(ng.extraConvex=t.extraConvex||!1,t.callback&&(Yf=t.callback,delete t.callback),mg.initArray(),t.ArPos=qf,t.ArMax=Qf,df.scene=new ea,df.scenePlus=new ea,df.post=mg.post,t.direct)tg=t.direct,t.returnMessage=mg.message,console.log(e+" is direct");else{let n,s,r="";switch(e){case"OIMO":if(i)Zf=new Worker("./build/Oimo.min.js");else try{Zf=new Worker("./build/Oimo.module.js",{type:"module"}),r="ES6"}catch(t){Zf=new Worker("./build/Oimo.min.js")}break;default:n=e.toLowerCase(),s=n.charAt(0).toUpperCase()+n.slice(1),t.blob=document.location.href.replace(/\/[^/]*$/,"/")+"./build/"+n+".wasm.js",Zf=new Worker("./build/"+s+".min.js")}Zf.postMessage=Zf.webkitPostMessage||Zf.postMessage,Zf.onmessage=mg.message;let a=new ArrayBuffer(1);Zf.postMessage({m:"test",ab:a},[a]),Kf=!a.byteLength,t.isBuffer=Kf,console.log(r+" Worker "+e+(t.isBuffer?" with Shared Buffer":"")),Jf=!0}df.engine=e,mg.post({m:"init",o:t})}static pause(){mg.post({m:"pause"})}static flowReset(){df.flow={tmp:[],key:[],add:[],remove:[]}}static reset(t){if(ig)return ig=!1,void t();let e,i;for(e in eg&&eg.resetAll(),ug=t,hg=function(){},mg.flowReset(),ng.reset(),sg.reset(),rg.reset(),ag.reset(),og.reset(),df.tmpMesh)df.tmpMesh[e].dispose?df.tmpMesh[e].dispose():df.scene.remove(df.tmpMesh[e]);for(e in df.tmpMesh=[],df.tmpGeo)df.tmpGeo[e].dispose();for(e in df.tmpGeo=[],df.tmpMat)i=df.tmpMat[e],vf[i]&&(vf[i].dispose(),delete vf[i]);for(e in df.tmpMat=[],df.tmpTex)df.tmpTex[e].dispose();df.tmpTex=[],mg.post({m:"reset"})}static resetCallback(){ug()}static ready(){console.log("Motor is ready !!"),Yf&&Yf()}static start(t={}){mg.post({m:"start",o:t})}static setTimeout(t){$f=t}static getTimeout(t){return $f}static set(t={}){t.isTimeout=$f,t.gravity||(t.gravity=[0,-9.81,0]),t.substep||(t.substep=2),t.fps||(t.fps=60),mg.post({m:"set",o:t})}static getFps(){return df.reflow.stat.fps}static getDelta(){return df.reflow.stat.delta}static step(t){mg.stepItems(),df.flow.key=lg.update(),hg(),this.changes(df.flow.tmp),Kf?df.post({m:"poststep",flow:df.flow,Ar:Xf},[Xf.buffer]):df.post({m:"poststep",flow:df.flow,Ar:Xf}),mg.flowReset()}static stepItems(){ng.step(Xf,qf.body),rg.step(Xf,qf.joint),ag.step(Xf,qf.ray),og.step(Xf,qf.contact),eg&&eg.follow(this.getDelta())}static up(t){t instanceof Array?this.changes(t,!0):this.change(t,!0)}static update(t){t instanceof Array?df.flow.tmp.push(...t):df.flow.tmp.push(t)}static initArray(t={}){let e={body:11*(t.body||1e3),joint:16*(t.joint||100),ray:8*(t.ray||50),contact:8*(t.contact||50)},i=0;for(let t in e)qf[t]=i,Qf+=e[t],i+=e[t]}static adds(t=[]){for(let e in t)this.add(t[e])}static add(t={}){if(t.constructor===Array)return this.adds(t);let e,i=t.type||"box";switch(void 0!==t.mass&&(t.density=t.mass),void 0!==t.bounce&&(t.restitution=t.bounce),i){case"ray":e=ag.add(t);break;case"joint":e=rg.add(t);break;case"contact":e=og.add(t);break;default:e=t.density||t.kinematic?ng.add(t):sg.add(t)}return e}static removes(t=[]){for(let e in t)this.remove(t[e])}static remove(t){if(t.constructor===Array)return this.removes(o);let e=this.byName(t);if(null===e)return;let i=e.type;switch(i){case"ray":e=ag.clear(e);break;case"joint":e=rg.clear(e);break;case"contact":e=og.clear(e);break;case"solid":e=sg.clear(e);break;case"body":e=ng.clear(e)}df.post({m:"remove",o:{name:t,type:i}})}static changes(t=[],e=!1){for(let i in t)this.change(t[i],e)}static change(t={},e=!1){let i=this.byName(t.name);if(null===i)return null;let n=i.type;switch(void 0!==t.rot&&(t.quat=wf.toQuatArray(t.rot),delete t.rot),void 0!==t.localRot&&(t.quat=wf.toLocalQuatArray(t.localRot,i),delete t.localRot),n){case"solid":i=sg.set(t,i);break;case"ray":i=ag.set(t,i),e=!1}e&&df.post({m:"change",o:t})}static addDirect(t){df.scene.add(t),df.tmpMesh.push(t)}static texture(t={}){let e=dg(t);return df.tmpTex.push(e),e}static material(t={}){let e;return e=t.isMaterial?t:new Gl(t),vf[e.name]?null:(df.tmpMat.push(e.name),vf[e.name]=e,pg(e),e)}static byName(t){return pf.byName(t)}static getAllBody(t){return ng.list}static explosion(t=[0,0,0],e=10,i=100){let n,s,r=[],a=(new Wt).fromArray(t),o=new Wt,l=ng.list.length;for(;l--;)n=ng.list[l],o.copy(n.position).sub(a),s=1-o.length()/e,s<0||(o.setLength(s),o.multiplyScalar(i),r.push({name:n.name,linearImpulse:o.toArray()}));this.update(r)}static setCamera(t={}){eg.moveCam(t)}static follow(t="",e={}){let i=null;"string"==typeof t||t instanceof String?i=""===t?null:this.byName(t):(t.isMesh||t.isGroup)&&(i=t),null===i?eg.resetFollow():eg.startFollow(i,e)}}var fg;fg=function(){const t=5121,e=5126,i=5131,n=36193;let s;function r(t,e,i){return function(n,s,r){return((n+t-1)/t|0)*((s+e-1)/e|0)*i*r}}function a(t,e,i){return function(n,s,r){return(Math.max(n,t)*Math.max(s,e)/i|0)*r}}const o=new Map([[33776,r(4,4,8)],[33777,r(4,4,8)],[33778,r(4,4,16)],[33779,r(4,4,16)],[36196,r(4,4,8)],[35840,a(8,8,2)],[35842,a(8,8,2)],[35841,a(16,8,4)],[35843,a(16,8,4)],[37488,r(4,4,8)],[37489,r(4,4,8)],[37492,r(4,4,8)],[37493,r(4,4,8)],[37494,r(4,4,8)],[37495,r(4,4,8)],[37490,r(4,4,16)],[37491,r(4,4,16)],[37496,r(4,4,16)],[37497,r(4,4,16)],[37808,r(4,4,16)],[37840,r(4,4,16)],[37809,r(5,4,16)],[37841,r(5,4,16)],[37810,r(5,5,16)],[37842,r(5,5,16)],[37811,r(6,5,16)],[37843,r(6,5,16)],[37812,r(6,6,16)],[37844,r(6,6,16)],[37813,r(8,5,16)],[37845,r(8,5,16)],[37814,r(8,6,16)],[37846,r(8,6,16)],[37815,r(8,8,16)],[37847,r(8,8,16)],[37816,r(10,5,16)],[37848,r(10,5,16)],[37817,r(10,6,16)],[37849,r(10,6,16)],[37818,r(10,8,16)],[37850,r(10,8,16)],[37819,r(10,10,16)],[37851,r(10,10,16)],[37820,r(12,10,16)],[37852,r(12,10,16)],[37821,r(12,12,16)],[37853,r(12,12,16)],[35916,r(4,4,8)],[35917,r(4,4,8)],[35918,r(4,4,16)],[35919,r(4,4,16)]]);function l(r,a){const o=function(r){if(!s){const r={};r[6406]={bytesPerElement:[1,2,2,4],type:[t,i,n,e]},r[6409]={bytesPerElement:[1,2,2,4],type:[t,i,n,e]},r[6410]={bytesPerElement:[2,4,4,8],type:[t,i,n,e]},r[6407]={bytesPerElement:[3,6,6,12,2],type:[t,i,n,e,33635]},r[6408]={bytesPerElement:[4,8,8,16,2,2],type:[t,i,n,e,32819,32820]},r[6402]={bytesPerElement:[2,4],type:[5125,5123]},r[34041]={bytesPerElement:[4]},r[33321]={bytesPerElement:[1]},r[36756]={bytesPerElement:[1]},r[33325]={bytesPerElement:[2]},r[33326]={bytesPerElement:[4]},r[33330]={bytesPerElement:[1]},r[33329]={bytesPerElement:[1]},r[33332]={bytesPerElement:[2]},r[33331]={bytesPerElement:[2]},r[33334]={bytesPerElement:[4]},r[33333]={bytesPerElement:[4]},r[33323]={bytesPerElement:[2]},r[36757]={bytesPerElement:[2]},r[33327]={bytesPerElement:[4]},r[33328]={bytesPerElement:[8]},r[33336]={bytesPerElement:[2]},r[33335]={bytesPerElement:[2]},r[33338]={bytesPerElement:[4]},r[33337]={bytesPerElement:[4]},r[33340]={bytesPerElement:[8]},r[33339]={bytesPerElement:[8]},r[32849]={bytesPerElement:[3]},r[35905]={bytesPerElement:[3]},r[36194]={bytesPerElement:[2]},r[36758]={bytesPerElement:[3]},r[35898]={bytesPerElement:[4]},r[35901]={bytesPerElement:[4]},r[34843]={bytesPerElement:[6]},r[34837]={bytesPerElement:[12]},r[36221]={bytesPerElement:[3]},r[36239]={bytesPerElement:[3]},r[36215]={bytesPerElement:[6]},r[36233]={bytesPerElement:[6]},r[36209]={bytesPerElement:[12]},r[36227]={bytesPerElement:[12]},r[32856]={bytesPerElement:[4]},r[35907]={bytesPerElement:[4]},r[36759]={bytesPerElement:[4]},r[32855]={bytesPerElement:[2]},r[32854]={bytesPerElement:[2]},r[32857]={bytesPerElement:[4]},r[34842]={bytesPerElement:[8]},r[34836]={bytesPerElement:[16]},r[36220]={bytesPerElement:[4]},r[36238]={bytesPerElement:[4]},r[36975]={bytesPerElement:[4]},r[36214]={bytesPerElement:[8]},r[36232]={bytesPerElement:[8]},r[36226]={bytesPerElement:[16]},r[36208]={bytesPerElement:[16]},r[33189]={bytesPerElement:[2]},r[33190]={bytesPerElement:[4]},r[36012]={bytesPerElement:[4]},r[35056]={bytesPerElement:[4]},r[36013]={bytesPerElement:[4]},s=r}return s[r]}(r);if(!o)throw"unknown internal format";if(o.type){const t=o.type.indexOf(a);if(t<0)throw new Error(`unsupported type ${a} for internalformat ${r}`);return o.bytesPerElement[t]}return o.bytesPerElement[0]}function h(t,e,i,n,s){const r=o.get(t);return r?r(e,i,n):function(t,e,i,n,s){return e*i*n*l(t,s)}(t,e,i,n,s)}function c(t){return function(t){return t&&t.buffer&&t.buffer instanceof ArrayBuffer}(t)||t instanceof ArrayBuffer}function u(t,e,i={}){const n=i.origGLErrorFn||t.getError,s=i.sharedState||function(t){const e={samples:(n=t).getParameter(n.SAMPLES),depthBits:n.getParameter(n.DEPTH_BITS),contextAttributes:n.getContextAttributes()};var n;const s={baseContext:t,config:i,apis:{gman_webgl_memory:{ctx:{getMemoryInfo(){const i=function(t,e){const{samples:i,depthBits:n,contextAttributes:s}=e,{width:r,height:a}=t.canvas,o=r*a*4,l=s.depth?1:0,h=s.stencil?1:0;return o+o*i+o*l*Math.min(h+n>16?4:2,4)}(t,e);return{memory:{...d,drawingbuffer:i,total:i+d.buffer+d.texture+d.renderbuffer},resources:{...p}}}}}},resources:{},memory:{texture:0,buffer:0,renderbuffer:0},bindings:new Map,defaultVertexArray:{},webglObjectToMemory:new Map};return s.webglObjectToMemory.set(s.defaultVertexArray,{}),s.currentVertexArray=s.defaultVertexArray,s}(t);i.sharedState=s;const{apis:r,baseContext:a,bindings:o,config:l,memory:d,resources:p,webglObjectToMemory:m}=s,f={};function g(){}function v(t,e,i){if(t[i||`create${e[0].toUpperCase()}${e.substr(1)}`])return p[e]=0,function(t,i,n,s){++p[e],m.set(s,{size:0})}}function x(e,i=g,n){const s=n||`delete${e[0].toUpperCase()}${e.substr(1)}`;if(t[s])return function(t,n,s){const[r]=s,a=m.get(r);a&&(--p[e],i(r,a),m.delete(r))}}function y(t,e,i,n,s){const r=o.get(t);if(!r)throw new Error(`no renderbuffer bound to ${t}`);const a=m.get(r);if(!a)throw new Error(`unknown renderbuffer ${r}`);const l=h(i,n,s,1)*e;d.renderbuffer-=a.size,a.size=l,d.renderbuffer+=l}const b=5121,w=34067,_=35866,M=34069,S=new Set([M,34070,34071,34072,34073,34074]);function T(t){return S.has(t)}function A(t){t=T(t)?w:t;const e=o.get(t);if(!e)throw new Error(`no texture bound to ${t}`);const i=m.get(e);if(!i)throw new Error(`unknown texture ${e}`);return i}function E(t,e,i,n,s,r,a,o){const l=t.size,c=h(n,s,r,a,o),u=T(e)?e-M:0;t.mips=t.mips||[],t.mips[i]=t.mips[i]||[];const p=t.mips[i][u]||{};t.size-=p.size||0,p.size=c,p.internalFormat=n,p.type=o,p.width=s,p.height=r,p.depth=a,t.mips[i][u]=p,t.size+=c,d.texture-=l,d.texture+=t.size}function L(t,e,i,n,s,r){const a=A(t),o=t===w?6:1,l=t===w?M:t;for(let h=0;h<e;++h){for(let t=0;t<o;++t)E(a,l+t,h,i,n,s,r);n=Math.ceil(Math.max(n/2,1)),s=Math.ceil(Math.max(s/2,1)),r=t===_?r:Math.ceil(Math.max(r/2,1))}}function C(t,e,i){const[n]=i;s.currentVertexArray=n||s.defaultVertexArray}function P(t,e){switch(t){case 34963:m.get(s.currentVertexArray).elementArrayBuffer=e;break;default:o.set(t,e)}}const R={},F={bufferData(t,e,i){const[n,r,,a=0,l]=i;let h;switch(n){case 34963:h=m.get(s.currentVertexArray).elementArrayBuffer;break;default:h=o.get(n)}if(!h)throw new Error(`no buffer bound to ${n}`);let u=0;if(void 0!==l)u=l;else if(c(r))u=r.byteLength;else{if(!function(t){return"number"==typeof t}(r))throw new Error(`unsupported bufferData src type ${r}`);u=r}const p=m.get(h);if(!p)throw new Error(`unknown buffer ${h}`);d.buffer-=p.size,p.size=u,d.buffer+=u},bindVertexArray:C,bindVertexArrayOES:C,bindBuffer(t,e,i){const[n,s]=i;P(n,s)},bindBufferBase(t,e,i){const[n,s,r]=i;P(n,r)},bindBufferRange(t,e,i){const[n,s,r,a,o]=i;P(n,r)},bindRenderbuffer(t,e,i){const[n,s]=i;o.set(n,s)},bindTexture(t,e,i){const[n,s]=i;o.set(n,s)},copyTexImage2D(t,e,i){const[n,s,r,a,o,l,h,c]=i;E(A(n),n,s,r,l,h,1,b)},createBuffer:v(t,"buffer"),createFramebuffer:v(t,"framebuffer"),createRenderbuffer:v(t,"renderbuffer"),createProgram:v(t,"program"),createQuery:v(t,"query"),createShader:v(t,"shader"),createSampler:v(t,"sampler"),createTexture:v(t,"texture"),createTransformFeedback:v(t,"transformFeedback"),createVertexArray:v(t,"vertexArray"),createVertexArrayOES:v(t,"vertexArray","createVertexArrayOES"),compressedTexImage2D(t,e,i){const[n,s,r,a,o]=i;E(A(n),n,s,r,a,o,1,b)},compressedTexImage3D(t,e,i){const[n,s,r,a,o,l]=i;E(A(n),n,s,r,a,o,l,b)},deleteBuffer:x("buffer",(function(t,e){d.buffer-=e.size})),deleteFramebuffer:x("framebuffer"),deleteProgram:x("program"),deleteQuery:x("query"),deleteRenderbuffer:x("renderbuffer",(function(t,e){d.renderbuffer-=e.size})),deleteSampler:x("sampler"),deleteShader:x("shader"),deleteSync:x("sync"),deleteTexture:x("texture",(function(t,e){d.texture-=e.size})),deleteTransformFeedback:x("transformFeedback"),deleteVertexArray:x("vertexArray"),deleteVertexArrayOES:x("vertexArray",g,"deleteVertexArrayOES"),fenceSync:function(t){if(t.fenceSync)return p.sync=0,function(t,e,i,n){++p.sync,m.set(obj,{size:0})}}(t),generateMipmap(t,e,i){const[n]=i,s=A(n),r=s.parameters&&s.parameters.get(33084)||0,a=s.parameters&&s.parameters.get(33085)||1024;let{width:o,height:l,depth:h,internalFormat:c,type:u}=s.mips[r][0],d=r+1;const p=n===w?6:1,m=n===w?M:n;for(;d<=a&&(1!==o||1!==l||1!==h&&n!==_);){o=Math.ceil(Math.max(o/2,1)),l=Math.ceil(Math.max(l/2,1)),h=n===_?h:Math.ceil(Math.max(h/2,1));for(let t=0;t<p;++t)E(s,m+t,d,c,o,l,h,u);++d}},getSupportedExtensions(t,e,i,n){n.push("GMAN_webgl_memory")},renderbufferStorage(t,e,i){const[n,s,r,a]=i;y(n,1,s,r,a)},renderbufferStorageMultisample(t,e,i){const[n,s,r,a,o]=i;y(n,s,r,a,o)},texImage2D(t,e,i){let n,s,r,[a,o,l]=i;if(6==i.length){const t=i[5];n=t.width,s=t.height,r=i[4]}else n=i[3],s=i[4],r=i[7];E(A(a),a,o,l,n,s,1,r)},texImage3D(t,e,i){let[n,s,r,a,o,l,h,c,u]=i;E(A(n),n,s,r,a,o,l,u)},texParameteri(t,e,i){let[n,s,r]=i;const a=A(n);a.parameters=a.parameters||new Map,a.parameters.set(s,r)},texStorage2D(t,e,i){let[n,s,r,a,o]=i;L(n,s,r,a,o,1)},texStorage3D(t,e,i){let[n,s,r,a,o,l]=i;L(n,s,r,a,o,l)}},I={getExtension(t,e){const s=t[e];t[e]=function(...e){const a=e[0].toLowerCase(),o=r[a];if(o)return o.ctx;const l=s.call(t,...e);return l&&u(l,a,{...i,origGLErrorFn:n}),l}}};function D(t,e){const i=t[e],s=R[e]||g,r=F[e]||g;if(s===g&&F===g)return;t[e]=function(...n){s(t,e,n);const a=i.call(t,...n);return r(t,e,n,a),a};const a=I[e];a&&a(t,e,n)}for(const e in t)"function"==typeof t[e]&&(f[e]=t[e],D(t,e));r[e.toLowerCase()]={ctx:t,origFuncs:f}}function d(t){const e=t.prototype.getContext;t.prototype.getContext=function(t,...i){const n=e.call(this,t,...i);return n&&n.bindTexture&&(u(n,t,{}),n.getExtension("GMAN_webgl_memory")),n}}"undefined"!=typeof HTMLCanvasElement&&d(HTMLCanvasElement),"undefined"!=typeof OffscreenCanvas&&d(OffscreenCanvas)},"function"==typeof define&&define.amd?define(fg):fg();let gg,vg,xg,yg,bg=!1,wg=["OIMO","AMMO"];const _g={envmap:"basic",groundSize:[200,200],groundAlpha:!0,groundOpacity:1,ground:!0},Mg={demo:"start",envmap:"basic",substep:1,fps:60,gravity:[0,-9.81,0],Exposure:1.25,Shadow:.5,ShadowGamma:1,ShadowLuma:.75,ShadowContrast:2.5,renderMode:0,shadowPCSS:!0,lightSizeUV:1.3,nearPlane:9.5,rings:11,nSample:17};let Sg,Tg,Ag,Eg,Lg,Cg,Pg,Rg,Fg,Ig,Dg,Ng,kg,zg,Ug,Og,Bg,Hg=null,Gg=null,Vg=!1,Wg=!1,jg=null,Xg=!1,Yg=!0,qg=null,Qg=null,Zg="",Jg=!0,Kg=!0;const $g=["start","basic","joint","capsule","compound","bridge","gears","raycast","terrain","character","car","collision","mesh","kinematic","add_remove","tower"],tv=["diamond","ragdoll","chess","pinball","million","desk","life"];$g.sort(),tv.sort();const ev=["basic","factory","studio","beach","tomoco","tatami","box","park","color","room","tokyo","gallery","river","cave","histo","bed","forest"],iv={w:0,h:0,r:0,left:0},nv={now:0,delta:0,then:0,inter:1e3/60,tmp:0,n:0,dt:0,fps:0};let sv=null;class rv{static start(t={}){let e={...t};gg=e.type||"OIMO",vg=e.version||"1.2.2",xg=!e.direct,yg=(xg?"WORKER ":"")+gg+" "+vg,e.extra&&(bg=!0,wg.push("HIDE"),$g.push("empty")),e.callback=av,mg.engine=gg,mg.init(e)}static view(t={}){t.envmap&&t.envmap!==Mg.envmap&&(Mg.envmap=t.envmap,zg.setValue(Mg.envmap),vd.load("./assets/textures/equirectangular/"+Mg.envmap+".hdr")),t.ground?(null===Gg&&(Gg=new Rm({textureSize:2048,clipBias:.003,encoding:!0,reflect:.8,round:!0}),Cg.add(Gg)),Gg.setSize(t.groundSize),Gg.setAlphaMap(t.groundAlpha),Gg.setOpacity(t.groundOpacity)):function(){if(null===Gg)return;Cg.remove(Gg),Gg=null}()}static injectCode(t){cv(t)}static getScene(){return Cg}static getRenderer(){return Pg}static getControler(){return Lg}static setLeft(t){iv.left=t,dv()}static getCode(){return Zg}static getCodeName(){return Mg.demo}static setCode(t){}static getMouseDown(){return Wg}}function av(){let t=window.devicePixelRatio,e=!(t>1);t>2&&(t=2),Fg=mg.getScene(),Og=new Et,Bg=new Et,Ug=new Fc,iv.w=window.innerWidth,iv.h=window.innerHeight,iv.r=iv.w/iv.h,rd.init(Mg),Cg=new ca,Cg.background=new di(0),Pg=new aa({antialias:e}),Pg.setPixelRatio(t),Pg.setSize(iv.w,iv.h),Pg.outputEncoding=it,Pg.toneMapping=4,Pg.physicallyCorrectLights=!0,Pg.toneMappingExposure=0,rd.setGl2(Pg.capabilities.isWebGL2),bg&&(sv=Pg.getContext().getExtension("GMAN_webgl_memory")),document.body.appendChild(Pg.domElement),Ag=Pg.domElement,Ag.style.position="absolute",Dg=new ea,Cg.add(Dg),kg=new kh(16777215,3),kg.position.set(1,8,0),kg.distance=20;let i=kg.shadow;i.mapSize.setScalar(2048),i.camera.top=i.camera.right=20,i.camera.bottom=i.camera.left=-20,i.camera.near=5,i.camera.far=33,i.bias=-5e-4,i.normalBias=.0075,i.radius=2,i.blurSamples=8,kg.castShadow=!0,Pg.shadowMap.enabled=!0,Pg.shadowMap.type=2,Dg.add(kg),Dg.add(kg.target),Hg=new kh(16711680,1.5),Hg.position.set(-1,0,0),Hg.distance=2,Dg.add(Hg),Dg.add(Hg.target),Eg=new on(45,iv.r,1,1e3),Eg.position.set(0,8,10),Eg.lookAt(0,2,0),Lg=new Qd(Eg,Pg.domElement,Dg),Lg.target.y=2,Lg.minDistance=1,Lg.maxDistance=100,Lg.enableDamping=!0,Lg.dampingFactor=.5,Lg.screenSpacePanning=!0,Lg.update(),Lg.addEventListener("end",(function(t){Yg=!0,Xg=!0})),Lg.addEventListener("change",(function(t){-1!==Lg.getState()&&(Yg?Yg=!1:Xg=!1)})),Cg.add(Eg),Rg=new Xd(Pg,Cg,Eg,Lg,iv),window.addEventListener("resize",dv),function(t){t?Vg||(Ag.addEventListener("pointermove",yv,!1),Ag.addEventListener("pointerdown",vv,!1),document.addEventListener("pointerup",xv,!1),Vg=!0,Xg=!0):Vg&&(Ag.removeEventListener("pointermove",yv),Ag.removeEventListener("pointerdown",vv),document.removeEventListener("pointerup",xv),Vg=!1)}(!0),Pm.init(Eg,iv,yg),qg=new cf,vd.load("./assets/textures/equirectangular/"+Mg.envmap+".hdr",ov,Pg,Cg,kg,Hg)}function ov(){let t=mg.getMat();for(let e in t)rd.add(t[e]);Ng=t.hide,mg.setContent(Cg),mg.setControl(Lg),mg.setExtraTexture((function(t){return cm.directTexture(t.url,t)})),mg.setExtraMaterial((function(t){t&&rd.add(t)})),pv();var e=location.hash.substr(1);""!==e&&(Mg.demo=e),function(){Au.setStyle({background:"none",backgroundOver:"none",fontShadow:"#000000",fontFamily:"Tahoma"});var t=new Ku({w:200,h:20,close:!1,bottomText:["OPTIONS","CLOSE"]});t.add("empty",{h:6}),t.add("button",{name:"GITHUB / ABOUT",p:0,h:24}).onChange(mv),t.add("empty",{h:6}),t.add("selector",{values:wg,selectable:!0,p:0,h:24,value:gg}).onChange(fv),t.add("bool",{name:"WORKER",h:20,value:xg}).onChange((function(t){xg=t})),t.add("bool",{name:"SHOW CODE",onName:"HIDE CODE",h:24,mode:1}).onChange((function(){qg.show()})),t.add("bool",{name:"PAUSE",onName:"RUN",h:24,mode:1}).onChange(mg.pause),t.add("empty",{h:6});let e=t.add("group",{name:"DISPLAY",h:30});e.add(Mg,"renderMode",{type:"selector",values:[0,1,2,3],selectable:!0,p:0,h:24}).onChange((function(t){1===t?vd.setBackgroud(0):2===t?vd.setBackgroud(7829503):3===t?vd.setBackgroud(16777215):vd.setBackgroud(),Pm.setRenderMode(t),rd.up(Mg)})),e.add(Mg,"Exposure",{min:0,max:4}).onChange((function(t){Pg.toneMappingExposure=t})),e.add(Mg,"Shadow",{min:0,max:1}).onChange((function(){rd.up(Mg)})),e.add(Mg,"lightSizeUV",{min:1,max:10,precision:4}).onChange((function(){rd.up(Mg)})),e.add(Mg,"nearPlane",{min:1,max:20,precision:2}).onChange((function(){rd.up(Mg)})),e.add(Mg,"rings",{min:1,max:30,precision:0}).onChange((function(){rd.up(Mg)})),zg=e.add("list",{list:ev,value:Mg.envmap,path:"assets/textures/equirectangular/mini/",format:".jpg",imageSize:[128,64],h:64,p:0}).onChange(gv),e.add("empty",{h:6}),e.add(Rg,"enabled",{type:"bool",rename:"POST PROCESS ON",onName:"POST PROCESS OFF",mode:1,h:30}),e.add(Rg.pass.lut,"enabled",{type:"bool",rename:"lut"}),e.add(Rg.pass.distortion,"enabled",{type:"bool",rename:"distortion"}),e.add("empty",{h:6}),e.add(Rg.pass.sao,"enabled",{type:"bool",rename:"sao"}),e.add(Rg.options,"saoBias",{min:-1,max:1}).onChange((function(){Rg.update()})),e.add(Rg.options,"saoIntensity",{min:0,max:1}).onChange((function(){Rg.update()})),e.add(Rg.options,"saoScale",{min:0,max:50}).onChange((function(){Rg.update()})),e.add(Rg.options,"saoKernelRadius",{min:1,max:100}).onChange((function(){Rg.update()})),e.add(Rg.options,"saoMinResolution",{min:0,max:1}).onChange((function(){Rg.update()})),e.add("empty",{h:6}),e.add(Rg.pass.bloom,"enabled",{type:"bool",rename:"bloom"}),e.add(Rg.options,"threshold",{min:0,max:1}).onChange((function(){Rg.update()})),e.add(Rg.options,"strength",{min:0,max:10}).onChange((function(){Rg.update()})),e.add(Rg.options,"bloomRadius",{min:0,max:1,step:.01}).onChange((function(){Rg.update()})),e.add("empty",{h:6});let i=t.add("group",{name:"BASIC",h:30});Sg=i.add(Mg,"demo",{type:"grid",values:$g,selectable:!0,h:20}).onChange(hv),i.open();let n=t.add("group",{name:"ADVANCED",h:30});Tg=n.add(Mg,"demo",{type:"grid",values:tv,selectable:!0,h:20}).onChange(hv),n.open()}(),Pm.endLoading(),new wu({a:0}).to({a:Mg.Exposure},3e3).onUpdate((function(t){Pg.toneMappingExposure=Yd.toFixed(t.a,3)})).easing(fu.Quadratic.In).start(),cm.load(["./assets/libs/esprima.hex"],lv)}function lv(t){cm.getCompactScript("esprima"),hv(Mg.demo)}function hv(t){-1!==tv.indexOf(t)?(Sg.setValue(t),Sg.reset()):(Tg.setValue(t),Tg.reset()),wv(),Mg.demo=t,location.hash=t,cm.load("./demos/"+Mg.demo+".js",cv)}function cv(t){Jg=!t,Zg=Jg?cm.getScript(Mg.demo):t,window.onReset&&window.onReset(),Pm.log(),phy.reset(uv)}function uv(){null!==Qg&&(document.body.removeChild(Qg),Qg=null),Qg=document.createElement("script"),Qg.language="javascript",Qg.type="text/javascript",Qg.id="demo",Qg.innerHTML="{"+Zg+"}",document.body.appendChild(Qg),Jg&&qg.set(Zg,Mg.demo),-1===Zg.search("phy.view")&&rv.view(_g),window.demo()}function dv(){iv.w=window.innerWidth-iv.left,iv.h=window.innerHeight,iv.r=iv.w/iv.h,Kg=!0}function pv(t){requestAnimationFrame(pv),nv.now=t,nv.delta=nv.now-nv.then,nv.dt=.001*nv.delta,Kg&&(Ag.style.left=iv.left+"px",Eg.aspect=iv.r,Eg.updateProjectionMatrix(),Pg.setSize(iv.w,iv.h),Rg.resize(iv),Pm.update(iv,""),Kg=!1),Su(t),Rg.enabled?Rg.render(nv.dt):Pg.render(Cg,Eg),nv.now-1e3>nv.tmp&&(nv.tmp=nv.now,nv.fps=nv.n,nv.n=0),nv.n++,Pm.setFps("T: "+nv.fps+" | P: "+mg.getFps()),function(){if(sv){const t=sv.getMemoryInfo();Pm.setStats(t)}}()}function mv(){window.open("https://github.com/lo-th/phy","_self")}function fv(t){let e=t.toLowerCase(),i=location.hash,n="index";"oimo"!==e&&(n=e),xg||(n+="_d"),wg.length>2&&(n+="ev"),window.open(n+".html"+i,"_self")}function gv(t){Mg.envmap=t,vd.load("./assets/textures/equirectangular/"+Mg.envmap+".hdr")}function vv(t){Wg||Bg.copy(Og),Wg=!0,bv()}function xv(t){Bg.distanceTo(Og),Wg=!1,wv()}function yv(t){Og.x=(t.clientX-iv.left)/iv.w*2-1,Og.y=-t.clientY/iv.h*2+1,bv()}function bv(){let t,e,i,n,s="auto";null!==jg&&(Ug.setFromCamera(Og,Eg),t=Ug.intersectObject(Ig),t.length&&mg.change({name:"mouse",pos:t[0].point.toArray()},!0)),Xg&&(Ug.setFromCamera(Og,Eg),t=Ug.intersectObjects(Fg.children,!0),t.length>0&&(i=t[0].object,i.parent!==Fg?(n=i.parent,e=n.parent!==Fg?n.parent:n):e=i,"body"===e.type&&(s=function(t,e){if(!Wg||jg===t)return"pointer";jg=t,Ig=new Ki(new wn(1,1),Ng),Ig.castShadow=!1,Ig.receiveShadow=!1,Ig.scale.set(1,1,1).multiplyScalar(200),Cg.add(Ig),Ig.rotation.set(0,Lg.getAzimuthalAngle(),0),Ig.position.copy(e);let i=e.toArray();return mg.add({name:"mouse",type:"null",size:[.1],pos:i}),mg.add({name:"mouseJoint",type:"joint",mode:"spherical",b1:jg.name,b2:"mouse",worldAnchor:i,sd:[4,1]}),Xg=!1,Lg.enabled=!1,"move"}(e,t[0].point))),document.body.style.cursor=s)}function wv(){null!==jg&&(Cg.remove(Ig),mg.remove("mouseJoint"),mg.remove("mouse"),Xg=!0,jg=null,Lg.enabled=!0)}mg.load=cm.load,mg.getMesh=cm.getMesh,mg.getGroup=cm.getGroup,mg.getMap=cm.getMap,mg.get=cm.get,cm.setExtraMaterial((function(t){t&&rd.add(t)})),mg.log=Pm.log,mg.view=rv.view,window.phy=mg,window.math=Yd,window.Main=rv,window.THREE=mu,window.Landscape=class extends Ki{constructor(t={}){super(),this.ready=!1,this.type="terrain",this.mapN=0,this.mapMax=6,this.ttype=t.terrainType||"terrain",this.callback=t.callback||function(){},this.uvx=[t.uv||18,t.uv||18],this.sample=null==t.sample?[128,128]:t.sample,this.size=void 0===t.size?[100,30,100]:t.size,this.data={level:t.level||[1,.2,.05],frequency:t.frequency||[.016,.05,.2],expo:t.expo||1},this.isWater=t.water||!1,this.isBorder=!1,this.wantBorder=t.border||!1,this.isBottom=!1,this.wantBottom=t.bottom||!1,this.wantBorder=t.border||!1,this.colorBase=this.isWater?{r:0,g:.7,b:1}:{r:.25,g:.25,b:.25},this.maxspeed=t.maxSpeed||.1,this.acc=null==t.acc?.01:t.acc,this.dec=null==t.dec?.01:t.dec,this.deep=null==t.deep?0:t.deep,this.ease=new Et,this.complexity=null==t.complexity?30:t.complexity,this.complexity2=null==t.complexity2?null:t.complexity2,this.local=new Wt,t.local&&this.local.fromArray(t.local),this.pp=new Wt,this.lng=this.sample[0]*this.sample[1];var e=this.sample[0]-1,i=this.sample[1]-1;this.rx=e/this.size[0],this.rz=i/this.size[2],this.ratio=1/this.sample[0],this.ruvx=1/(this.size[0]/this.uvx[0]),this.ruvy=-1/(this.size[2]/this.uvx[1]),this.is64=t.is64||!1,this.isTurn=t.turn||!1,this.heightData=[],this.height=[],this.isAbsolute=t.isAbsolute||!1,this.isReverse=t.isReverse||!1,this.isReverse&&this.getReverseID(),this.colors=new Float32Array(3*this.lng),this.geometry=new wn(this.size[0],this.size[2],this.sample[0]-1,this.sample[1]-1),this.geometry.rotateX(-Yd.PI90),this.isTurn&&this.geometry.rotateY(-Yd.PI90),this.geometry.setAttribute("color",new gi(this.colors,3)),this.vertices=this.geometry.attributes.position.array;var n=new Vt(.95,.8,.1,.05);t.maplevels&&n.fromArray(t.maplevels);var s,r=Dm,a=t.maps||["sand","grass","rock"],o={};this.isWater&&(a=["water"]);for(let e in a)s=a[e],o[s]=cm.directTexture("./assets/textures/terrain/"+s+".jpg",{flip:!1,repeat:this.uvx,encoding:t.encoding||!0,callback:this.mapcallback.bind(this)}),o[s+"_n"]=cm.directTexture("./assets/textures/terrain/"+s+"_n.jpg",{flip:!1,repeat:this.uvx,callback:this.mapcallback.bind(this)});this.material=new Gl({name:"terrain",vertexColors:2,color:16777215,map:o[a[0]],normalMap:o[a[0]+"_n"],format:it}),void 0!==t.envmap&&(this.material.envMap=t.envmap),this.isWater?(this.material.transparent=!0,this.material.opacity=t.opacity||.4,this.material.side=2,this.material.alphaMap=o[a[0]],this.material.map=null,this.material.metalnes=.9,this.material.roughness=.1):(this.material.metalnes=.25,this.material.roughness=.75);var l=t.nScale||1;if(this.material.normalScale.set(l,l),this.isWater?this.material.onBeforeCompile=function(t){var e=t.fragmentShader;e=e.replace("#include <alphamap_fragment>",r.alphamap),t.fragmentShader=e}:this.material.onBeforeCompile=function(t){var e=t.uniforms;e.clevels={value:n},e.map1={value:o[a[1]]},e.map2={value:o[a[2]]},e.normalMap1={value:o[a[1]+"_n"]},e.normalMap2={value:o[a[2]+"_n"]},t.uniforms=e;var i=t.fragmentShader;i=(i=(i=(i=i.replace("uniform vec3 diffuse;",r.baseRemplace)).replace("#include <map_fragment>",r.map)).replace("#include <normal_fragment_maps>",r.normal)).replace("#include <color_fragment>",""),t.fragmentShader=i,rd.modify(t)},t.debuger){var h=new Ki(this.geometry,new pi({vertexColors:2,wireframe:!0,transparent:!0,opacity:.25}));this.add(h)}this.wantBorder&&this.addBorder(t),this.wantBottom&&this.addBottom(t),this.name=void 0===t.name?"terrain":t.name,t.pos&&this.position.fromArray(t.pos),t.decal&&(this.position.y+=t.decal),this.castShadow=!0,this.receiveShadow=!0,this.update()}mapcallback(){this.mapN++,this.mapN==this.mapMax&&this.callback()}addBottom(t){var e=new wn(this.size[0],this.size[2],1,1);e.rotateX(Yd.PI90),this.bottomMesh=new Ki(e,this.borderMaterial),this.add(this.bottomMesh),this.isBottom=!0}addBorder(t){this.borderMaterial=new Gl({vertexColors:2,metalness:this.isWater?.8:.4,roughness:this.isWater?.2:.6,normalScale:this.isWater?[.25,.25]:[-1,-1],transparent:!!this.isWater,opacity:this.isWater?t.opacity||.8:1,envMap:t.envmap||null});var e=new wn(this.size[0],2,this.sample[0]-1,1),i=new wn(this.size[0],2,this.sample[0]-1,1),n=new wn(this.size[2],2,this.sample[1]-1,1),s=new wn(this.size[2],2,this.sample[1]-1,1);e.translate(0,1,.5*this.size[2]),i.rotateY(-Yd.Pi),i.translate(0,1,.5*-this.size[2]),n.rotateY(-Yd.PI90),n.translate(.5*-this.size[0],1,0),s.rotateY(Yd.PI90),s.translate(.5*this.size[0],1,0),this.borderGeometry=Im.mergeVertices(Im.mergeBufferGeometries([e,i,n,s])),this.borderVertices=this.borderGeometry.attributes.position.array,this.lng2=this.borderVertices.length/3,this.list=new Array(this.lng2),this.borderColors=new Float32Array(3*this.lng),this.borderGeometry.setAttribute("color",new gi(this.borderColors,3)),this.borderMesh=new Ki(this.borderGeometry,this.borderMaterial);for(var r,a,o=this.lng2;o--;)r=3*o,a=this.borderVertices[r+1]>0?this.findPoint(this.borderVertices[r],this.borderVertices[r+2]):-1,this.list[o]=a;this.add(this.borderMesh),this.borderMesh.castShadow=!0,this.borderMesh.receiveShadow=!0,this.isBorder=!0}dispose(){this.geometry.dispose(),this.material.dispose()}easing(t,e){var i=user.key;if(i[0]&&i[1]){var n=t||0;i[7]?this.maxspeed=1.5:this.maxspeed=.25,this.ease.y+=i[1]*this.acc,this.ease.x+=i[0]*this.acc,this.ease.x=this.ease.x>this.maxspeed?this.maxspeed:this.ease.x,this.ease.x=this.ease.x<-this.maxspeed?-this.maxspeed:this.ease.x,this.ease.y=this.ease.y>this.maxspeed?this.maxspeed:this.ease.y,this.ease.y=this.ease.y<-this.maxspeed?-this.maxspeed:this.ease.y,i[1]||(this.ease.y>this.dec?this.ease.y-=this.dec:this.ease.y<-this.dec?this.ease.y+=this.dec:this.ease.y=0),i[0]||(this.ease.x>this.dec?this.ease.x-=this.dec:this.ease.x<-this.dec?this.ease.x+=this.dec:this.ease.x=0),(this.ease.x||this.ease.y)&&(this.local.z+=Math.sin(n)*this.ease.x+Math.cos(n)*this.ease.y,this.local.x+=Math.cos(n)*this.ease.x-Math.sin(n)*this.ease.y,this.update(e))}}getTri(){return this.geometry}getHeight(t,e){return t*=this.rx,e*=this.rz,t+=.5*this.sample[0],e+=.5*this.sample[1],t=Math.floor(t),e=Math.floor(e),(this.isTurn?this.height[this.findId2(t,e)]:this.height[this.findId(t,e)])*this.size[1]+this.position.y}findId(t,e){return t+e*this.sample[1]||1}findId2(t,e){return e+-t*this.sample[0]||1}findPoint(t,e){for(var i,n=this.lng;n--;)if(i=3*n,this.vertices[i]===t&&this.vertices[i+2]===e)return n;return-1}getReverseID(){this.invId=[];for(var t,e,i=this.lng,n=this.sample[1]-1;i--;)t=i%this.sample[0],e=n-Math.floor(i*this.ratio),this.invId[i]=this.findId(t,e)}update(t){this.isWater?(this.material.normalMap.offset.x+=.002,this.material.normalMap.offset.y+=.001):this.material.map&&(this.material.map.offset.x=this.local.x*this.ruvx,this.material.map.offset.y=this.local.z*this.ruvy);for(var e,i,n,s,r,a,o,l,h,c=this.pp,u=[1,1,1],d=this.lng;d--;){e=3*d,i=d%this.sample[0],n=Math.floor(d*this.ratio),c.set(i+this.local.x*this.rx,this.local.y,n+this.local.z*this.rz),s=Yd.noise(c,this.data),s=(s=(s=Math.pow(s,this.data.expo))>1?1:s)<0?0:s,"road"===this.ttype&&(o===n?s=1===i||2===i||29===i||30===i?l+.1:l:(o=n,l=s)),this.height[d]=s,r=this.isReverse?this.invId[d]:d,a=this.isAbsolute?s:s*this.size[1],this.heightData[r]=a,h=s*this.size[1]+this.deep,this.vertices[e+1]=h,u=this.isWater?[s*this.colorBase.r,s*this.colorBase.g,s*this.colorBase.b]:[s,0,0];var p=Yd.clamp(u[0]+.25,.25,1);this.colors[e]=p,this.colors[e+1]=p,this.colors[e+2]=p}if(this.isBorder)for(var m,f=this.lng2;f--;)if(e=3*f,-1!==this.list[f]){m=this.height[this.list[f]],this.borderVertices[e+1]=m*this.size[1]+this.deep;p=Yd.clamp(m+.25,.25,1);this.borderColors[e]=p,this.borderColors[e+1]=p,this.borderColors[e+2]=p}else this.borderColors[e]=this.colorBase.r,this.borderColors[e+1]=this.colorBase.g,this.borderColors[e+2]=this.colorBase.b;this.updateGeometry(),this.ready=!0}updateGeometry(){this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0,this.geometry.computeVertexNormals(),this.isBorder&&(this.borderGeometry.attributes.position.needsUpdate=!0,this.borderGeometry.attributes.color.needsUpdate=!0)}},window.Building=class extends Gl{constructor(t={},e={}){t.metalness=1,t.roughness=.2,t.side=2,t.envMapIntensity=1,t.normalScale=new Et(2,2),super(t),this.onBeforeCompile=function(t){var i=t.uniforms;i.insideMap={value:e.insideMap||null},i.wallFreq={value:(new Wt).fromArray(e.freq||[1,1,1])},i.wallsBias={value:e.bias||.01},i.time={value:e.time||1},i.lightning={value:1},i.isNoise={value:1},i.isNoSection={value:0},t.uniforms=i;var n=t.vertexShader;n=(n=n.replace("varying vec3 vViewPosition;",rd.getGl2()?km:Nm+km)).replace("#include <fog_vertex>",zm),t.vertexShader=n;var s=t.fragmentShader;s=(s=(s=(s=s.replace("void main() {",Um)).replace("#include <map_fragment>",Om)).replace("#include <normal_fragment_maps>",Hm)).replace("#include <emissivemap_fragment>",Bm),t.fragmentShader=s,rd.modify(t)}}},window.Diamond=class extends Vl{constructor(t={},e={}){t.metalness=1,t.roughness=0,t.opacity=.9,t.side=2,t.envMapIntensity=1,t.opacity=1,super(t),this.onBeforeCompile=function(i){var n=i.uniforms;n.normalCube={value:this.cubeNormal(e)},n.bDebugBounces={value:0},n.mFresnelBias={value:.02},n.mFresnelScale={value:.1},n.mFresnelPower={value:1},n.aberration={value:.012},n.refraction={value:2.417},n.normalOffset={value:0},n.squashFactor={value:.98},n.distanceOffset={value:0},n.geometryFactor={value:.28},n.absorbption={value:new di(0,0,0)},n.correction={value:new di(t.color||16777215)},n.boost={value:new di(.892,.892,.98595025)},n.radius={value:1.5},n.centreOffset={value:new Wt(0,0,0)},i.uniforms=n;var s=i.vertexShader;s=(s=s.replace("varying vec3 vViewPosition;",rd.getGl2()?Vm:Gm+Vm)).replace("#include <fog_vertex>",Wm),i.vertexShader=s;var r=i.fragmentShader;r=(r=r.replace("void main() {",Xm)).replace("#include <output_fragment>","#include <output_fragment>"+jm),i.fragmentShader=r,rd.modify(i)}}cubeNormal(t={}){let e=new un(1024,{format:I}),i=new hn(.01,10,e),n=new ca;n.add(i);let s=new rn({vertexShader:["varying vec3 vNormalm;","void main() {","vNormalm = normal;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec3 vNormalm;","void main() {","vec3 color = normalize(vNormalm);","color = color * 0.5 + 0.5;","gl_FragColor = vec4( color.xyz, 1.0 );","}"].join("\n"),side:1}),r=new Ki(t.geometry,s);return r.scale.set(10,10,10),r.frustumCulled=!1,r.geometry.center(),n.add(r),i.update(t.renderer,n),n.remove(r),n.remove(i),r.material.dispose(),r.geometry.dispose(),e.texture}},window.Sparkle=class extends po{constructor(t={}){super(),this.num=t.num||12,this.controler=t.controler||null,this.sampler=new Qm(new Ki((new tn).toNonIndexed())),this.v=new Wt,this.objectList=t.objectList,this.lng=this.objectList.length,this.numParticle=this.lng*this.num,this.range=t.range||[2,2,2],this.speed=t.speed||[.002,.001],this.disp=t.disp||[.5,.5,.5];let e=new di;this.velocities=[],this.pos=[];let i=[],n=[],s=[],r=[],a=[];this.tt=[];let o,l,h,c=this.numParticle;for(;c--;)r.push(0,0,0),a.push(1,1,1),n.push(Yd.rand(.2,1.5)),i.push(Yd.rand(0,1)),s.push(0),this.tt.push(Yd.randInt(-300,1));for(c=this.lng;c--;)for(this.setSamplerGeometry(this.objectList[c].children[0].geometry),h=this.objectList[c].children[0].material.color,o=this.num;o--;)l=3*(c*this.num+o),this.v.set(Yd.rand(-5,5),Yd.rand(-5,5),Yd.rand(-5,5)),this.sampler.sample(this.v),this.v.toArray(this.pos,l),e.copy(h),a[l]=h.r,a[l+1]=h.g,a[l+2]=h.b;this.positions=new Float32Array(r),this.angles=new Float32Array(s),this.alphas=new Float32Array(i),this.sizes=new Float32Array(n),this.geometry.setAttribute("position",new gi(this.positions,3)),this.geometry.setAttribute("color",new gi(new Float32Array(a),3)),this.geometry.setAttribute("sizer",new gi(this.sizes,1)),this.geometry.setAttribute("alphas",new gi(this.alphas,1)),this.geometry.setAttribute("angles",new gi(this.angles,1)),this.texture=this.makeTexture(),this.material=new oo({name:"snow",size:1,color:16777215,vertexColors:!0,map:this.texture,blending:2,transparent:!0,fog:!1,depthWrite:!1,depthTest:!1}),this.material.onBeforeCompile=function(t){var e=t.vertexShader;e=(e=e.replace("#include <clipping_planes_pars_vertex>",Zm)).replace("#include <fog_vertex>",Jm),t.vertexShader=e;var i=t.fragmentShader;i=(i=(i=i.replace("#include <clipping_planes_pars_fragment>",Km)).replace("#include <output_fragment>","#include <output_fragment>"+$m)).replace("#include <map_particle_fragment>",tf),t.fragmentShader=i},this.mTime=0,this.castShadow=!1,this.receiveShadow=!1}setSamplerGeometry(t){this.sampler.geometry.dispose(),this.sampler.geometry=t.clone().toNonIndexed(),this.sampler.positionAttribute=this.sampler.geometry.getAttribute("position"),this.sampler.build()}makeTexture(){let t=document.createElement("canvas"),e=t.getContext("2d"),i=64;t.width=i,t.height=i;let n=32,s=e.createRadialGradient(n,n,0,n,n,n);s.addColorStop(0,"rgba(255,255,255,0.4)"),s.addColorStop(.5,"rgba(255,255,255,0.2)"),s.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=s,e.fillRect(0,0,i,i),s=e.createRadialGradient(n,n,0,n,n,n),s.addColorStop(0,"rgba(255,255,255,1.0)"),s.addColorStop(.5,"rgba(255,255,255,0.5)"),s.addColorStop(1,"rgba(255,255,255,0)"),e.strokeStyle=s,e.beginPath(),e.moveTo(0,n),e.lineTo(i,n),e.lineWidth=2,e.stroke(),e.beginPath(),e.moveTo(n,0),e.lineTo(n,i),e.lineWidth=2,e.stroke(),s=e.createRadialGradient(n,n,0,n,n,n),s.addColorStop(0,"rgba(255,255,255,0.4)"),s.addColorStop(.5,"rgba(255,255,255,0.2)"),s.addColorStop(1,"rgba(255,255,255,0)"),e.strokeStyle=s,e.beginPath(),e.moveTo(0,0),e.lineTo(i,i),e.lineWidth=1,e.stroke(),e.beginPath(),e.moveTo(i,0),e.lineTo(0,i),e.lineWidth=1,e.stroke();var r=new zt(t);return r.type=C,r.needsUpdate=!0,r}updateMatrixWorld(t){let e=.01666,i=this.v;this.mTime+=e;let n=0;this.controler&&(n=this.controler.getAzimuthalAngle());let s,r,a,o,l,h,c=this.lng;for(;c--;)for(r=this.objectList[c].position,o=this.objectList[c].quaternion,s=this.num;s--;)a=c*this.num+s,l=this.alphas[a],h=this.tt[a],0===h?(l+=.1*e,l>.5&&(h=1)):1===h?(l-=.1*e,l<0&&(h=Yd.randInt(-300,0),this.sizes[a]=Yd.rand(.2,1.5))):h++,this.alphas[a]=Yd.clamp(l,0,1),this.tt[a]=h,this.angles[a]=-n,this.alphas[a]>1&&(this.alphas[a]=Yd.rand(-5,0)),a*=3,i.fromArray(this.pos,a).applyQuaternion(o).add(r),i.toArray(this.positions,a);this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.alphas.needsUpdate=!0,this.geometry.attributes.angles.needsUpdate=!0,this.geometry.attributes.sizer.needsUpdate=!0}dispose(){this.parent.remove(this),this.geometry.dispose(),this.material.map.dispose(),this.material.dispose()}},t.Main=rv,Object.defineProperty(t,"__esModule",{value:!0})}));
